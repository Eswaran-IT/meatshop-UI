var HM=i=>{throw TypeError(i)};var O2=(i,o,c)=>o.has(i)||HM("Cannot "+c);var qt=(i,o,c)=>(O2(i,o,"read from private field"),c?c.call(i):o.get(i)),Pr=(i,o,c)=>o.has(i)?HM("Cannot add the same private member more than once"):o instanceof WeakSet?o.add(i):o.set(i,c),Hn=(i,o,c,m)=>(O2(i,o,"write to private field"),m?m.call(i,c):o.set(i,c),c),So=(i,o,c)=>(O2(i,o,"access private method"),c);var r0=(i,o,c,m)=>({set _(v){Hn(i,o,v,c)},get _(){return qt(i,o,m)}});function gV(i,o){for(var c=0;c<o.length;c++){const m=o[c];if(typeof m!="string"&&!Array.isArray(m)){for(const v in m)if(v!=="default"&&!(v in i)){const E=Object.getOwnPropertyDescriptor(m,v);E&&Object.defineProperty(i,v,E.get?E:{enumerable:!0,get:()=>m[v]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))m(v);new MutationObserver(v=>{for(const E of v)if(E.type==="childList")for(const I of E.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&m(I)}).observe(document,{childList:!0,subtree:!0});function c(v){const E={};return v.integrity&&(E.integrity=v.integrity),v.referrerPolicy&&(E.referrerPolicy=v.referrerPolicy),v.crossOrigin==="use-credentials"?E.credentials="include":v.crossOrigin==="anonymous"?E.credentials="omit":E.credentials="same-origin",E}function m(v){if(v.ep)return;v.ep=!0;const E=c(v);fetch(v.href,E)}})();var _V=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function eE(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Tk={exports:{}},j1={},Ek={exports:{}},er={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fy=Symbol.for("react.element"),yV=Symbol.for("react.portal"),xV=Symbol.for("react.fragment"),vV=Symbol.for("react.strict_mode"),wV=Symbol.for("react.profiler"),bV=Symbol.for("react.provider"),SV=Symbol.for("react.context"),TV=Symbol.for("react.forward_ref"),EV=Symbol.for("react.suspense"),CV=Symbol.for("react.memo"),AV=Symbol.for("react.lazy"),qM=Symbol.iterator;function IV(i){return i===null||typeof i!="object"?null:(i=qM&&i[qM]||i["@@iterator"],typeof i=="function"?i:null)}var Ck={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ak=Object.assign,Ik={};function vm(i,o,c){this.props=i,this.context=o,this.refs=Ik,this.updater=c||Ck}vm.prototype.isReactComponent={};vm.prototype.setState=function(i,o){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,o,"setState")};vm.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function Pk(){}Pk.prototype=vm.prototype;function tE(i,o,c){this.props=i,this.context=o,this.refs=Ik,this.updater=c||Ck}var iE=tE.prototype=new Pk;iE.constructor=tE;Ak(iE,vm.prototype);iE.isPureReactComponent=!0;var WM=Array.isArray,Mk=Object.prototype.hasOwnProperty,nE={current:null},Rk={key:!0,ref:!0,__self:!0,__source:!0};function Dk(i,o,c){var m,v={},E=null,I=null;if(o!=null)for(m in o.ref!==void 0&&(I=o.ref),o.key!==void 0&&(E=""+o.key),o)Mk.call(o,m)&&!Rk.hasOwnProperty(m)&&(v[m]=o[m]);var s=arguments.length-2;if(s===1)v.children=c;else if(1<s){for(var O=Array(s),j=0;j<s;j++)O[j]=arguments[j+2];v.children=O}if(i&&i.defaultProps)for(m in s=i.defaultProps,s)v[m]===void 0&&(v[m]=s[m]);return{$$typeof:Fy,type:i,key:E,ref:I,props:v,_owner:nE.current}}function PV(i,o){return{$$typeof:Fy,type:i.type,key:o,ref:i.ref,props:i.props,_owner:i._owner}}function rE(i){return typeof i=="object"&&i!==null&&i.$$typeof===Fy}function MV(i){var o={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(c){return o[c]})}var ZM=/\/+/g;function F2(i,o){return typeof i=="object"&&i!==null&&i.key!=null?MV(""+i.key):o.toString(36)}function k0(i,o,c,m,v){var E=typeof i;(E==="undefined"||E==="boolean")&&(i=null);var I=!1;if(i===null)I=!0;else switch(E){case"string":case"number":I=!0;break;case"object":switch(i.$$typeof){case Fy:case yV:I=!0}}if(I)return I=i,v=v(I),i=m===""?"."+F2(I,0):m,WM(v)?(c="",i!=null&&(c=i.replace(ZM,"$&/")+"/"),k0(v,o,c,"",function(j){return j})):v!=null&&(rE(v)&&(v=PV(v,c+(!v.key||I&&I.key===v.key?"":(""+v.key).replace(ZM,"$&/")+"/")+i)),o.push(v)),1;if(I=0,m=m===""?".":m+":",WM(i))for(var s=0;s<i.length;s++){E=i[s];var O=m+F2(E,s);I+=k0(E,o,c,O,v)}else if(O=IV(i),typeof O=="function")for(i=O.call(i),s=0;!(E=i.next()).done;)E=E.value,O=m+F2(E,s++),I+=k0(E,o,c,O,v);else if(E==="object")throw o=String(i),Error("Objects are not valid as a React child (found: "+(o==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":o)+"). If you meant to render a collection of children, use an array instead.");return I}function s0(i,o,c){if(i==null)return i;var m=[],v=0;return k0(i,m,"","",function(E){return o.call(c,E,v++)}),m}function RV(i){if(i._status===-1){var o=i._result;o=o(),o.then(function(c){(i._status===0||i._status===-1)&&(i._status=1,i._result=c)},function(c){(i._status===0||i._status===-1)&&(i._status=2,i._result=c)}),i._status===-1&&(i._status=0,i._result=o)}if(i._status===1)return i._result.default;throw i._result}var Zo={current:null},N0={transition:null},DV={ReactCurrentDispatcher:Zo,ReactCurrentBatchConfig:N0,ReactCurrentOwner:nE};function kk(){throw Error("act(...) is not supported in production builds of React.")}er.Children={map:s0,forEach:function(i,o,c){s0(i,function(){o.apply(this,arguments)},c)},count:function(i){var o=0;return s0(i,function(){o++}),o},toArray:function(i){return s0(i,function(o){return o})||[]},only:function(i){if(!rE(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};er.Component=vm;er.Fragment=xV;er.Profiler=wV;er.PureComponent=tE;er.StrictMode=vV;er.Suspense=EV;er.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=DV;er.act=kk;er.cloneElement=function(i,o,c){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var m=Ak({},i.props),v=i.key,E=i.ref,I=i._owner;if(o!=null){if(o.ref!==void 0&&(E=o.ref,I=nE.current),o.key!==void 0&&(v=""+o.key),i.type&&i.type.defaultProps)var s=i.type.defaultProps;for(O in o)Mk.call(o,O)&&!Rk.hasOwnProperty(O)&&(m[O]=o[O]===void 0&&s!==void 0?s[O]:o[O])}var O=arguments.length-2;if(O===1)m.children=c;else if(1<O){s=Array(O);for(var j=0;j<O;j++)s[j]=arguments[j+2];m.children=s}return{$$typeof:Fy,type:i.type,key:v,ref:E,props:m,_owner:I}};er.createContext=function(i){return i={$$typeof:SV,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:bV,_context:i},i.Consumer=i};er.createElement=Dk;er.createFactory=function(i){var o=Dk.bind(null,i);return o.type=i,o};er.createRef=function(){return{current:null}};er.forwardRef=function(i){return{$$typeof:TV,render:i}};er.isValidElement=rE;er.lazy=function(i){return{$$typeof:AV,_payload:{_status:-1,_result:i},_init:RV}};er.memo=function(i,o){return{$$typeof:CV,type:i,compare:o===void 0?null:o}};er.startTransition=function(i){var o=N0.transition;N0.transition={};try{i()}finally{N0.transition=o}};er.unstable_act=kk;er.useCallback=function(i,o){return Zo.current.useCallback(i,o)};er.useContext=function(i){return Zo.current.useContext(i)};er.useDebugValue=function(){};er.useDeferredValue=function(i){return Zo.current.useDeferredValue(i)};er.useEffect=function(i,o){return Zo.current.useEffect(i,o)};er.useId=function(){return Zo.current.useId()};er.useImperativeHandle=function(i,o,c){return Zo.current.useImperativeHandle(i,o,c)};er.useInsertionEffect=function(i,o){return Zo.current.useInsertionEffect(i,o)};er.useLayoutEffect=function(i,o){return Zo.current.useLayoutEffect(i,o)};er.useMemo=function(i,o){return Zo.current.useMemo(i,o)};er.useReducer=function(i,o,c){return Zo.current.useReducer(i,o,c)};er.useRef=function(i){return Zo.current.useRef(i)};er.useState=function(i){return Zo.current.useState(i)};er.useSyncExternalStore=function(i,o,c){return Zo.current.useSyncExternalStore(i,o,c)};er.useTransition=function(){return Zo.current.useTransition()};er.version="18.3.1";Ek.exports=er;var V=Ek.exports;const Vt=eE(V),Nk=gV({__proto__:null,default:Vt},[V]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kV=V,NV=Symbol.for("react.element"),LV=Symbol.for("react.fragment"),zV=Object.prototype.hasOwnProperty,OV=kV.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,FV={key:!0,ref:!0,__self:!0,__source:!0};function Lk(i,o,c){var m,v={},E=null,I=null;c!==void 0&&(E=""+c),o.key!==void 0&&(E=""+o.key),o.ref!==void 0&&(I=o.ref);for(m in o)zV.call(o,m)&&!FV.hasOwnProperty(m)&&(v[m]=o[m]);if(i&&i.defaultProps)for(m in o=i.defaultProps,o)v[m]===void 0&&(v[m]=o[m]);return{$$typeof:NV,type:i,key:E,ref:I,props:v,_owner:OV.current}}j1.Fragment=LV;j1.jsx=Lk;j1.jsxs=Lk;Tk.exports=j1;var x=Tk.exports,zk={exports:{}},Ia={},Ok={exports:{}},Fk={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function o(ot,Tt){var ii=ot.length;ot.push(Tt);e:for(;0<ii;){var jt=ii-1>>>1,gi=ot[jt];if(0<v(gi,Tt))ot[jt]=Tt,ot[ii]=gi,ii=jt;else break e}}function c(ot){return ot.length===0?null:ot[0]}function m(ot){if(ot.length===0)return null;var Tt=ot[0],ii=ot.pop();if(ii!==Tt){ot[0]=ii;e:for(var jt=0,gi=ot.length,en=gi>>>1;jt<en;){var Dn=2*(jt+1)-1,ir=ot[Dn],wi=Dn+1,ni=ot[wi];if(0>v(ir,ii))wi<gi&&0>v(ni,ir)?(ot[jt]=ni,ot[wi]=ii,jt=wi):(ot[jt]=ir,ot[Dn]=ii,jt=Dn);else if(wi<gi&&0>v(ni,ii))ot[jt]=ni,ot[wi]=ii,jt=wi;else break e}}return Tt}function v(ot,Tt){var ii=ot.sortIndex-Tt.sortIndex;return ii!==0?ii:ot.id-Tt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var E=performance;i.unstable_now=function(){return E.now()}}else{var I=Date,s=I.now();i.unstable_now=function(){return I.now()-s}}var O=[],j=[],G=1,W=null,B=3,te=!1,ue=!1,J=!1,ce=typeof setTimeout=="function"?setTimeout:null,oe=typeof clearTimeout=="function"?clearTimeout:null,ee=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Q(ot){for(var Tt=c(j);Tt!==null;){if(Tt.callback===null)m(j);else if(Tt.startTime<=ot)m(j),Tt.sortIndex=Tt.expirationTime,o(O,Tt);else break;Tt=c(j)}}function Ie(ot){if(J=!1,Q(ot),!ue)if(c(O)!==null)ue=!0,Nt(pe);else{var Tt=c(j);Tt!==null&&bi(Ie,Tt.startTime-ot)}}function pe(ot,Tt){ue=!1,J&&(J=!1,oe(at),at=-1),te=!0;var ii=B;try{for(Q(Tt),W=c(O);W!==null&&(!(W.expirationTime>Tt)||ot&&!mt());){var jt=W.callback;if(typeof jt=="function"){W.callback=null,B=W.priorityLevel;var gi=jt(W.expirationTime<=Tt);Tt=i.unstable_now(),typeof gi=="function"?W.callback=gi:W===c(O)&&m(O),Q(Tt)}else m(O);W=c(O)}if(W!==null)var en=!0;else{var Dn=c(j);Dn!==null&&bi(Ie,Dn.startTime-Tt),en=!1}return en}finally{W=null,B=ii,te=!1}}var Ke=!1,et=null,at=-1,Xt=5,Ct=-1;function mt(){return!(i.unstable_now()-Ct<Xt)}function Dt(){if(et!==null){var ot=i.unstable_now();Ct=ot;var Tt=!0;try{Tt=et(!0,ot)}finally{Tt?Kt():(Ke=!1,et=null)}}else Ke=!1}var Kt;if(typeof ee=="function")Kt=function(){ee(Dt)};else if(typeof MessageChannel<"u"){var Pt=new MessageChannel,ti=Pt.port2;Pt.port1.onmessage=Dt,Kt=function(){ti.postMessage(null)}}else Kt=function(){ce(Dt,0)};function Nt(ot){et=ot,Ke||(Ke=!0,Kt())}function bi(ot,Tt){at=ce(function(){ot(i.unstable_now())},Tt)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(ot){ot.callback=null},i.unstable_continueExecution=function(){ue||te||(ue=!0,Nt(pe))},i.unstable_forceFrameRate=function(ot){0>ot||125<ot?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Xt=0<ot?Math.floor(1e3/ot):5},i.unstable_getCurrentPriorityLevel=function(){return B},i.unstable_getFirstCallbackNode=function(){return c(O)},i.unstable_next=function(ot){switch(B){case 1:case 2:case 3:var Tt=3;break;default:Tt=B}var ii=B;B=Tt;try{return ot()}finally{B=ii}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(ot,Tt){switch(ot){case 1:case 2:case 3:case 4:case 5:break;default:ot=3}var ii=B;B=ot;try{return Tt()}finally{B=ii}},i.unstable_scheduleCallback=function(ot,Tt,ii){var jt=i.unstable_now();switch(typeof ii=="object"&&ii!==null?(ii=ii.delay,ii=typeof ii=="number"&&0<ii?jt+ii:jt):ii=jt,ot){case 1:var gi=-1;break;case 2:gi=250;break;case 5:gi=1073741823;break;case 4:gi=1e4;break;default:gi=5e3}return gi=ii+gi,ot={id:G++,callback:Tt,priorityLevel:ot,startTime:ii,expirationTime:gi,sortIndex:-1},ii>jt?(ot.sortIndex=ii,o(j,ot),c(O)===null&&ot===c(j)&&(J?(oe(at),at=-1):J=!0,bi(Ie,ii-jt))):(ot.sortIndex=gi,o(O,ot),ue||te||(ue=!0,Nt(pe))),ot},i.unstable_shouldYield=mt,i.unstable_wrapCallback=function(ot){var Tt=B;return function(){var ii=B;B=Tt;try{return ot.apply(this,arguments)}finally{B=ii}}}})(Fk);Ok.exports=Fk;var jV=Ok.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var BV=V,Aa=jV;function oi(i){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+i,c=1;c<arguments.length;c++)o+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+i+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var jk=new Set,uy={};function rf(i,o){um(i,o),um(i+"Capture",o)}function um(i,o){for(uy[i]=o,i=0;i<o.length;i++)jk.add(o[i])}var Wc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),RS=Object.prototype.hasOwnProperty,VV=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,XM={},KM={};function UV(i){return RS.call(KM,i)?!0:RS.call(XM,i)?!1:VV.test(i)?KM[i]=!0:(XM[i]=!0,!1)}function GV(i,o,c,m){if(c!==null&&c.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return m?!1:c!==null?!c.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function $V(i,o,c,m){if(o===null||typeof o>"u"||GV(i,o,c,m))return!0;if(m)return!1;if(c!==null)switch(c.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function Xo(i,o,c,m,v,E,I){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=m,this.attributeNamespace=v,this.mustUseProperty=c,this.propertyName=i,this.type=o,this.sanitizeURL=E,this.removeEmptyString=I}var fo={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){fo[i]=new Xo(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var o=i[0];fo[o]=new Xo(o,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){fo[i]=new Xo(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){fo[i]=new Xo(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){fo[i]=new Xo(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){fo[i]=new Xo(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){fo[i]=new Xo(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){fo[i]=new Xo(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){fo[i]=new Xo(i,5,!1,i.toLowerCase(),null,!1,!1)});var sE=/[\-:]([a-z])/g;function oE(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var o=i.replace(sE,oE);fo[o]=new Xo(o,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var o=i.replace(sE,oE);fo[o]=new Xo(o,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var o=i.replace(sE,oE);fo[o]=new Xo(o,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){fo[i]=new Xo(i,1,!1,i.toLowerCase(),null,!1,!1)});fo.xlinkHref=new Xo("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){fo[i]=new Xo(i,1,!1,i.toLowerCase(),null,!0,!0)});function aE(i,o,c,m){var v=fo.hasOwnProperty(o)?fo[o]:null;(v!==null?v.type!==0:m||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&($V(o,c,v,m)&&(c=null),m||v===null?UV(o)&&(c===null?i.removeAttribute(o):i.setAttribute(o,""+c)):v.mustUseProperty?i[v.propertyName]=c===null?v.type===3?!1:"":c:(o=v.attributeName,m=v.attributeNamespace,c===null?i.removeAttribute(o):(v=v.type,c=v===3||v===4&&c===!0?"":""+c,m?i.setAttributeNS(m,o,c):i.setAttribute(o,c))))}var tu=BV.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,o0=Symbol.for("react.element"),Np=Symbol.for("react.portal"),Lp=Symbol.for("react.fragment"),lE=Symbol.for("react.strict_mode"),DS=Symbol.for("react.profiler"),Bk=Symbol.for("react.provider"),Vk=Symbol.for("react.context"),cE=Symbol.for("react.forward_ref"),kS=Symbol.for("react.suspense"),NS=Symbol.for("react.suspense_list"),uE=Symbol.for("react.memo"),ed=Symbol.for("react.lazy"),Uk=Symbol.for("react.offscreen"),YM=Symbol.iterator;function D_(i){return i===null||typeof i!="object"?null:(i=YM&&i[YM]||i["@@iterator"],typeof i=="function"?i:null)}var os=Object.assign,j2;function $_(i){if(j2===void 0)try{throw Error()}catch(c){var o=c.stack.trim().match(/\n( *(at )?)/);j2=o&&o[1]||""}return`
`+j2+i}var B2=!1;function V2(i,o){if(!i||B2)return"";B2=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(j){var m=j}Reflect.construct(i,[],o)}else{try{o.call()}catch(j){m=j}i.call(o.prototype)}else{try{throw Error()}catch(j){m=j}i()}}catch(j){if(j&&m&&typeof j.stack=="string"){for(var v=j.stack.split(`
`),E=m.stack.split(`
`),I=v.length-1,s=E.length-1;1<=I&&0<=s&&v[I]!==E[s];)s--;for(;1<=I&&0<=s;I--,s--)if(v[I]!==E[s]){if(I!==1||s!==1)do if(I--,s--,0>s||v[I]!==E[s]){var O=`
`+v[I].replace(" at new "," at ");return i.displayName&&O.includes("<anonymous>")&&(O=O.replace("<anonymous>",i.displayName)),O}while(1<=I&&0<=s);break}}}finally{B2=!1,Error.prepareStackTrace=c}return(i=i?i.displayName||i.name:"")?$_(i):""}function HV(i){switch(i.tag){case 5:return $_(i.type);case 16:return $_("Lazy");case 13:return $_("Suspense");case 19:return $_("SuspenseList");case 0:case 2:case 15:return i=V2(i.type,!1),i;case 11:return i=V2(i.type.render,!1),i;case 1:return i=V2(i.type,!0),i;default:return""}}function LS(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case Lp:return"Fragment";case Np:return"Portal";case DS:return"Profiler";case lE:return"StrictMode";case kS:return"Suspense";case NS:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case Vk:return(i.displayName||"Context")+".Consumer";case Bk:return(i._context.displayName||"Context")+".Provider";case cE:var o=i.render;return i=i.displayName,i||(i=o.displayName||o.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case uE:return o=i.displayName||null,o!==null?o:LS(i.type)||"Memo";case ed:o=i._payload,i=i._init;try{return LS(i(o))}catch{}}return null}function qV(i){var o=i.type;switch(i.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=o.render,i=i.displayName||i.name||"",o.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return LS(o);case 8:return o===lE?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function Td(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Gk(i){var o=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function WV(i){var o=Gk(i)?"checked":"value",c=Object.getOwnPropertyDescriptor(i.constructor.prototype,o),m=""+i[o];if(!i.hasOwnProperty(o)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var v=c.get,E=c.set;return Object.defineProperty(i,o,{configurable:!0,get:function(){return v.call(this)},set:function(I){m=""+I,E.call(this,I)}}),Object.defineProperty(i,o,{enumerable:c.enumerable}),{getValue:function(){return m},setValue:function(I){m=""+I},stopTracking:function(){i._valueTracker=null,delete i[o]}}}}function a0(i){i._valueTracker||(i._valueTracker=WV(i))}function $k(i){if(!i)return!1;var o=i._valueTracker;if(!o)return!0;var c=o.getValue(),m="";return i&&(m=Gk(i)?i.checked?"true":"false":i.value),i=m,i!==c?(o.setValue(i),!0):!1}function Y0(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function zS(i,o){var c=o.checked;return os({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:c??i._wrapperState.initialChecked})}function JM(i,o){var c=o.defaultValue==null?"":o.defaultValue,m=o.checked!=null?o.checked:o.defaultChecked;c=Td(o.value!=null?o.value:c),i._wrapperState={initialChecked:m,initialValue:c,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function Hk(i,o){o=o.checked,o!=null&&aE(i,"checked",o,!1)}function OS(i,o){Hk(i,o);var c=Td(o.value),m=o.type;if(c!=null)m==="number"?(c===0&&i.value===""||i.value!=c)&&(i.value=""+c):i.value!==""+c&&(i.value=""+c);else if(m==="submit"||m==="reset"){i.removeAttribute("value");return}o.hasOwnProperty("value")?FS(i,o.type,c):o.hasOwnProperty("defaultValue")&&FS(i,o.type,Td(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(i.defaultChecked=!!o.defaultChecked)}function QM(i,o,c){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var m=o.type;if(!(m!=="submit"&&m!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+i._wrapperState.initialValue,c||o===i.value||(i.value=o),i.defaultValue=o}c=i.name,c!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,c!==""&&(i.name=c)}function FS(i,o,c){(o!=="number"||Y0(i.ownerDocument)!==i)&&(c==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+c&&(i.defaultValue=""+c))}var H_=Array.isArray;function qp(i,o,c,m){if(i=i.options,o){o={};for(var v=0;v<c.length;v++)o["$"+c[v]]=!0;for(c=0;c<i.length;c++)v=o.hasOwnProperty("$"+i[c].value),i[c].selected!==v&&(i[c].selected=v),v&&m&&(i[c].defaultSelected=!0)}else{for(c=""+Td(c),o=null,v=0;v<i.length;v++){if(i[v].value===c){i[v].selected=!0,m&&(i[v].defaultSelected=!0);return}o!==null||i[v].disabled||(o=i[v])}o!==null&&(o.selected=!0)}}function jS(i,o){if(o.dangerouslySetInnerHTML!=null)throw Error(oi(91));return os({},o,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function eR(i,o){var c=o.value;if(c==null){if(c=o.children,o=o.defaultValue,c!=null){if(o!=null)throw Error(oi(92));if(H_(c)){if(1<c.length)throw Error(oi(93));c=c[0]}o=c}o==null&&(o=""),c=o}i._wrapperState={initialValue:Td(c)}}function qk(i,o){var c=Td(o.value),m=Td(o.defaultValue);c!=null&&(c=""+c,c!==i.value&&(i.value=c),o.defaultValue==null&&i.defaultValue!==c&&(i.defaultValue=c)),m!=null&&(i.defaultValue=""+m)}function tR(i){var o=i.textContent;o===i._wrapperState.initialValue&&o!==""&&o!==null&&(i.value=o)}function Wk(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function BS(i,o){return i==null||i==="http://www.w3.org/1999/xhtml"?Wk(o):i==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var l0,Zk=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,c,m,v){MSApp.execUnsafeLocalFunction(function(){return i(o,c,m,v)})}:i}(function(i,o){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=o;else{for(l0=l0||document.createElement("div"),l0.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=l0.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;o.firstChild;)i.appendChild(o.firstChild)}});function dy(i,o){if(o){var c=i.firstChild;if(c&&c===i.lastChild&&c.nodeType===3){c.nodeValue=o;return}}i.textContent=o}var J_={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ZV=["Webkit","ms","Moz","O"];Object.keys(J_).forEach(function(i){ZV.forEach(function(o){o=o+i.charAt(0).toUpperCase()+i.substring(1),J_[o]=J_[i]})});function Xk(i,o,c){return o==null||typeof o=="boolean"||o===""?"":c||typeof o!="number"||o===0||J_.hasOwnProperty(i)&&J_[i]?(""+o).trim():o+"px"}function Kk(i,o){i=i.style;for(var c in o)if(o.hasOwnProperty(c)){var m=c.indexOf("--")===0,v=Xk(c,o[c],m);c==="float"&&(c="cssFloat"),m?i.setProperty(c,v):i[c]=v}}var XV=os({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function VS(i,o){if(o){if(XV[i]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(oi(137,i));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(oi(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(oi(61))}if(o.style!=null&&typeof o.style!="object")throw Error(oi(62))}}function US(i,o){if(i.indexOf("-")===-1)return typeof o.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var GS=null;function dE(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var $S=null,Wp=null,Zp=null;function iR(i){if(i=Vy(i)){if(typeof $S!="function")throw Error(oi(280));var o=i.stateNode;o&&(o=$1(o),$S(i.stateNode,i.type,o))}}function Yk(i){Wp?Zp?Zp.push(i):Zp=[i]:Wp=i}function Jk(){if(Wp){var i=Wp,o=Zp;if(Zp=Wp=null,iR(i),o)for(i=0;i<o.length;i++)iR(o[i])}}function Qk(i,o){return i(o)}function eN(){}var U2=!1;function tN(i,o,c){if(U2)return i(o,c);U2=!0;try{return Qk(i,o,c)}finally{U2=!1,(Wp!==null||Zp!==null)&&(eN(),Jk())}}function hy(i,o){var c=i.stateNode;if(c===null)return null;var m=$1(c);if(m===null)return null;c=m[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(i=i.type,m=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!m;break e;default:i=!1}if(i)return null;if(c&&typeof c!="function")throw Error(oi(231,o,typeof c));return c}var HS=!1;if(Wc)try{var k_={};Object.defineProperty(k_,"passive",{get:function(){HS=!0}}),window.addEventListener("test",k_,k_),window.removeEventListener("test",k_,k_)}catch{HS=!1}function KV(i,o,c,m,v,E,I,s,O){var j=Array.prototype.slice.call(arguments,3);try{o.apply(c,j)}catch(G){this.onError(G)}}var Q_=!1,J0=null,Q0=!1,qS=null,YV={onError:function(i){Q_=!0,J0=i}};function JV(i,o,c,m,v,E,I,s,O){Q_=!1,J0=null,KV.apply(YV,arguments)}function QV(i,o,c,m,v,E,I,s,O){if(JV.apply(this,arguments),Q_){if(Q_){var j=J0;Q_=!1,J0=null}else throw Error(oi(198));Q0||(Q0=!0,qS=j)}}function sf(i){var o=i,c=i;if(i.alternate)for(;o.return;)o=o.return;else{i=o;do o=i,o.flags&4098&&(c=o.return),i=o.return;while(i)}return o.tag===3?c:null}function iN(i){if(i.tag===13){var o=i.memoizedState;if(o===null&&(i=i.alternate,i!==null&&(o=i.memoizedState)),o!==null)return o.dehydrated}return null}function nR(i){if(sf(i)!==i)throw Error(oi(188))}function e6(i){var o=i.alternate;if(!o){if(o=sf(i),o===null)throw Error(oi(188));return o!==i?null:i}for(var c=i,m=o;;){var v=c.return;if(v===null)break;var E=v.alternate;if(E===null){if(m=v.return,m!==null){c=m;continue}break}if(v.child===E.child){for(E=v.child;E;){if(E===c)return nR(v),i;if(E===m)return nR(v),o;E=E.sibling}throw Error(oi(188))}if(c.return!==m.return)c=v,m=E;else{for(var I=!1,s=v.child;s;){if(s===c){I=!0,c=v,m=E;break}if(s===m){I=!0,m=v,c=E;break}s=s.sibling}if(!I){for(s=E.child;s;){if(s===c){I=!0,c=E,m=v;break}if(s===m){I=!0,m=E,c=v;break}s=s.sibling}if(!I)throw Error(oi(189))}}if(c.alternate!==m)throw Error(oi(190))}if(c.tag!==3)throw Error(oi(188));return c.stateNode.current===c?i:o}function nN(i){return i=e6(i),i!==null?rN(i):null}function rN(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var o=rN(i);if(o!==null)return o;i=i.sibling}return null}var sN=Aa.unstable_scheduleCallback,rR=Aa.unstable_cancelCallback,t6=Aa.unstable_shouldYield,i6=Aa.unstable_requestPaint,xs=Aa.unstable_now,n6=Aa.unstable_getCurrentPriorityLevel,hE=Aa.unstable_ImmediatePriority,oN=Aa.unstable_UserBlockingPriority,e1=Aa.unstable_NormalPriority,r6=Aa.unstable_LowPriority,aN=Aa.unstable_IdlePriority,B1=null,cc=null;function s6(i){if(cc&&typeof cc.onCommitFiberRoot=="function")try{cc.onCommitFiberRoot(B1,i,void 0,(i.current.flags&128)===128)}catch{}}var yl=Math.clz32?Math.clz32:l6,o6=Math.log,a6=Math.LN2;function l6(i){return i>>>=0,i===0?32:31-(o6(i)/a6|0)|0}var c0=64,u0=4194304;function q_(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function t1(i,o){var c=i.pendingLanes;if(c===0)return 0;var m=0,v=i.suspendedLanes,E=i.pingedLanes,I=c&268435455;if(I!==0){var s=I&~v;s!==0?m=q_(s):(E&=I,E!==0&&(m=q_(E)))}else I=c&~v,I!==0?m=q_(I):E!==0&&(m=q_(E));if(m===0)return 0;if(o!==0&&o!==m&&!(o&v)&&(v=m&-m,E=o&-o,v>=E||v===16&&(E&4194240)!==0))return o;if(m&4&&(m|=c&16),o=i.entangledLanes,o!==0)for(i=i.entanglements,o&=m;0<o;)c=31-yl(o),v=1<<c,m|=i[c],o&=~v;return m}function c6(i,o){switch(i){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function u6(i,o){for(var c=i.suspendedLanes,m=i.pingedLanes,v=i.expirationTimes,E=i.pendingLanes;0<E;){var I=31-yl(E),s=1<<I,O=v[I];O===-1?(!(s&c)||s&m)&&(v[I]=c6(s,o)):O<=o&&(i.expiredLanes|=s),E&=~s}}function WS(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function lN(){var i=c0;return c0<<=1,!(c0&4194240)&&(c0=64),i}function G2(i){for(var o=[],c=0;31>c;c++)o.push(i);return o}function jy(i,o,c){i.pendingLanes|=o,o!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,o=31-yl(o),i[o]=c}function d6(i,o){var c=i.pendingLanes&~o;i.pendingLanes=o,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=o,i.mutableReadLanes&=o,i.entangledLanes&=o,o=i.entanglements;var m=i.eventTimes;for(i=i.expirationTimes;0<c;){var v=31-yl(c),E=1<<v;o[v]=0,m[v]=-1,i[v]=-1,c&=~E}}function fE(i,o){var c=i.entangledLanes|=o;for(i=i.entanglements;c;){var m=31-yl(c),v=1<<m;v&o|i[m]&o&&(i[m]|=o),c&=~v}}var Lr=0;function cN(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var uN,pE,dN,hN,fN,ZS=!1,d0=[],pd=null,md=null,gd=null,fy=new Map,py=new Map,nd=[],h6="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function sR(i,o){switch(i){case"focusin":case"focusout":pd=null;break;case"dragenter":case"dragleave":md=null;break;case"mouseover":case"mouseout":gd=null;break;case"pointerover":case"pointerout":fy.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":py.delete(o.pointerId)}}function N_(i,o,c,m,v,E){return i===null||i.nativeEvent!==E?(i={blockedOn:o,domEventName:c,eventSystemFlags:m,nativeEvent:E,targetContainers:[v]},o!==null&&(o=Vy(o),o!==null&&pE(o)),i):(i.eventSystemFlags|=m,o=i.targetContainers,v!==null&&o.indexOf(v)===-1&&o.push(v),i)}function f6(i,o,c,m,v){switch(o){case"focusin":return pd=N_(pd,i,o,c,m,v),!0;case"dragenter":return md=N_(md,i,o,c,m,v),!0;case"mouseover":return gd=N_(gd,i,o,c,m,v),!0;case"pointerover":var E=v.pointerId;return fy.set(E,N_(fy.get(E)||null,i,o,c,m,v)),!0;case"gotpointercapture":return E=v.pointerId,py.set(E,N_(py.get(E)||null,i,o,c,m,v)),!0}return!1}function pN(i){var o=Fh(i.target);if(o!==null){var c=sf(o);if(c!==null){if(o=c.tag,o===13){if(o=iN(c),o!==null){i.blockedOn=o,fN(i.priority,function(){dN(c)});return}}else if(o===3&&c.stateNode.current.memoizedState.isDehydrated){i.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}i.blockedOn=null}function L0(i){if(i.blockedOn!==null)return!1;for(var o=i.targetContainers;0<o.length;){var c=XS(i.domEventName,i.eventSystemFlags,o[0],i.nativeEvent);if(c===null){c=i.nativeEvent;var m=new c.constructor(c.type,c);GS=m,c.target.dispatchEvent(m),GS=null}else return o=Vy(c),o!==null&&pE(o),i.blockedOn=c,!1;o.shift()}return!0}function oR(i,o,c){L0(i)&&c.delete(o)}function p6(){ZS=!1,pd!==null&&L0(pd)&&(pd=null),md!==null&&L0(md)&&(md=null),gd!==null&&L0(gd)&&(gd=null),fy.forEach(oR),py.forEach(oR)}function L_(i,o){i.blockedOn===o&&(i.blockedOn=null,ZS||(ZS=!0,Aa.unstable_scheduleCallback(Aa.unstable_NormalPriority,p6)))}function my(i){function o(v){return L_(v,i)}if(0<d0.length){L_(d0[0],i);for(var c=1;c<d0.length;c++){var m=d0[c];m.blockedOn===i&&(m.blockedOn=null)}}for(pd!==null&&L_(pd,i),md!==null&&L_(md,i),gd!==null&&L_(gd,i),fy.forEach(o),py.forEach(o),c=0;c<nd.length;c++)m=nd[c],m.blockedOn===i&&(m.blockedOn=null);for(;0<nd.length&&(c=nd[0],c.blockedOn===null);)pN(c),c.blockedOn===null&&nd.shift()}var Xp=tu.ReactCurrentBatchConfig,i1=!0;function m6(i,o,c,m){var v=Lr,E=Xp.transition;Xp.transition=null;try{Lr=1,mE(i,o,c,m)}finally{Lr=v,Xp.transition=E}}function g6(i,o,c,m){var v=Lr,E=Xp.transition;Xp.transition=null;try{Lr=4,mE(i,o,c,m)}finally{Lr=v,Xp.transition=E}}function mE(i,o,c,m){if(i1){var v=XS(i,o,c,m);if(v===null)Q2(i,o,m,n1,c),sR(i,m);else if(f6(v,i,o,c,m))m.stopPropagation();else if(sR(i,m),o&4&&-1<h6.indexOf(i)){for(;v!==null;){var E=Vy(v);if(E!==null&&uN(E),E=XS(i,o,c,m),E===null&&Q2(i,o,m,n1,c),E===v)break;v=E}v!==null&&m.stopPropagation()}else Q2(i,o,m,null,c)}}var n1=null;function XS(i,o,c,m){if(n1=null,i=dE(m),i=Fh(i),i!==null)if(o=sf(i),o===null)i=null;else if(c=o.tag,c===13){if(i=iN(o),i!==null)return i;i=null}else if(c===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;i=null}else o!==i&&(i=null);return n1=i,null}function mN(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(n6()){case hE:return 1;case oN:return 4;case e1:case r6:return 16;case aN:return 536870912;default:return 16}default:return 16}}var dd=null,gE=null,z0=null;function gN(){if(z0)return z0;var i,o=gE,c=o.length,m,v="value"in dd?dd.value:dd.textContent,E=v.length;for(i=0;i<c&&o[i]===v[i];i++);var I=c-i;for(m=1;m<=I&&o[c-m]===v[E-m];m++);return z0=v.slice(i,1<m?1-m:void 0)}function O0(i){var o=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&o===13&&(i=13)):i=o,i===10&&(i=13),32<=i||i===13?i:0}function h0(){return!0}function aR(){return!1}function Pa(i){function o(c,m,v,E,I){this._reactName=c,this._targetInst=v,this.type=m,this.nativeEvent=E,this.target=I,this.currentTarget=null;for(var s in i)i.hasOwnProperty(s)&&(c=i[s],this[s]=c?c(E):E[s]);return this.isDefaultPrevented=(E.defaultPrevented!=null?E.defaultPrevented:E.returnValue===!1)?h0:aR,this.isPropagationStopped=aR,this}return os(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=h0)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=h0)},persist:function(){},isPersistent:h0}),o}var wm={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},_E=Pa(wm),By=os({},wm,{view:0,detail:0}),_6=Pa(By),$2,H2,z_,V1=os({},By,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:yE,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==z_&&(z_&&i.type==="mousemove"?($2=i.screenX-z_.screenX,H2=i.screenY-z_.screenY):H2=$2=0,z_=i),$2)},movementY:function(i){return"movementY"in i?i.movementY:H2}}),lR=Pa(V1),y6=os({},V1,{dataTransfer:0}),x6=Pa(y6),v6=os({},By,{relatedTarget:0}),q2=Pa(v6),w6=os({},wm,{animationName:0,elapsedTime:0,pseudoElement:0}),b6=Pa(w6),S6=os({},wm,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),T6=Pa(S6),E6=os({},wm,{data:0}),cR=Pa(E6),C6={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},A6={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},I6={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function P6(i){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(i):(i=I6[i])?!!o[i]:!1}function yE(){return P6}var M6=os({},By,{key:function(i){if(i.key){var o=C6[i.key]||i.key;if(o!=="Unidentified")return o}return i.type==="keypress"?(i=O0(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?A6[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:yE,charCode:function(i){return i.type==="keypress"?O0(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?O0(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),R6=Pa(M6),D6=os({},V1,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),uR=Pa(D6),k6=os({},By,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:yE}),N6=Pa(k6),L6=os({},wm,{propertyName:0,elapsedTime:0,pseudoElement:0}),z6=Pa(L6),O6=os({},V1,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),F6=Pa(O6),j6=[9,13,27,32],xE=Wc&&"CompositionEvent"in window,ey=null;Wc&&"documentMode"in document&&(ey=document.documentMode);var B6=Wc&&"TextEvent"in window&&!ey,_N=Wc&&(!xE||ey&&8<ey&&11>=ey),dR=" ",hR=!1;function yN(i,o){switch(i){case"keyup":return j6.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function xN(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var zp=!1;function V6(i,o){switch(i){case"compositionend":return xN(o);case"keypress":return o.which!==32?null:(hR=!0,dR);case"textInput":return i=o.data,i===dR&&hR?null:i;default:return null}}function U6(i,o){if(zp)return i==="compositionend"||!xE&&yN(i,o)?(i=gN(),z0=gE=dd=null,zp=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return _N&&o.locale!=="ko"?null:o.data;default:return null}}var G6={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function fR(i){var o=i&&i.nodeName&&i.nodeName.toLowerCase();return o==="input"?!!G6[i.type]:o==="textarea"}function vN(i,o,c,m){Yk(m),o=r1(o,"onChange"),0<o.length&&(c=new _E("onChange","change",null,c,m),i.push({event:c,listeners:o}))}var ty=null,gy=null;function $6(i){RN(i,0)}function U1(i){var o=jp(i);if($k(o))return i}function H6(i,o){if(i==="change")return o}var wN=!1;if(Wc){var W2;if(Wc){var Z2="oninput"in document;if(!Z2){var pR=document.createElement("div");pR.setAttribute("oninput","return;"),Z2=typeof pR.oninput=="function"}W2=Z2}else W2=!1;wN=W2&&(!document.documentMode||9<document.documentMode)}function mR(){ty&&(ty.detachEvent("onpropertychange",bN),gy=ty=null)}function bN(i){if(i.propertyName==="value"&&U1(gy)){var o=[];vN(o,gy,i,dE(i)),tN($6,o)}}function q6(i,o,c){i==="focusin"?(mR(),ty=o,gy=c,ty.attachEvent("onpropertychange",bN)):i==="focusout"&&mR()}function W6(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return U1(gy)}function Z6(i,o){if(i==="click")return U1(o)}function X6(i,o){if(i==="input"||i==="change")return U1(o)}function K6(i,o){return i===o&&(i!==0||1/i===1/o)||i!==i&&o!==o}var wl=typeof Object.is=="function"?Object.is:K6;function _y(i,o){if(wl(i,o))return!0;if(typeof i!="object"||i===null||typeof o!="object"||o===null)return!1;var c=Object.keys(i),m=Object.keys(o);if(c.length!==m.length)return!1;for(m=0;m<c.length;m++){var v=c[m];if(!RS.call(o,v)||!wl(i[v],o[v]))return!1}return!0}function gR(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function _R(i,o){var c=gR(i);i=0;for(var m;c;){if(c.nodeType===3){if(m=i+c.textContent.length,i<=o&&m>=o)return{node:c,offset:o-i};i=m}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=gR(c)}}function SN(i,o){return i&&o?i===o?!0:i&&i.nodeType===3?!1:o&&o.nodeType===3?SN(i,o.parentNode):"contains"in i?i.contains(o):i.compareDocumentPosition?!!(i.compareDocumentPosition(o)&16):!1:!1}function TN(){for(var i=window,o=Y0();o instanceof i.HTMLIFrameElement;){try{var c=typeof o.contentWindow.location.href=="string"}catch{c=!1}if(c)i=o.contentWindow;else break;o=Y0(i.document)}return o}function vE(i){var o=i&&i.nodeName&&i.nodeName.toLowerCase();return o&&(o==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||o==="textarea"||i.contentEditable==="true")}function Y6(i){var o=TN(),c=i.focusedElem,m=i.selectionRange;if(o!==c&&c&&c.ownerDocument&&SN(c.ownerDocument.documentElement,c)){if(m!==null&&vE(c)){if(o=m.start,i=m.end,i===void 0&&(i=o),"selectionStart"in c)c.selectionStart=o,c.selectionEnd=Math.min(i,c.value.length);else if(i=(o=c.ownerDocument||document)&&o.defaultView||window,i.getSelection){i=i.getSelection();var v=c.textContent.length,E=Math.min(m.start,v);m=m.end===void 0?E:Math.min(m.end,v),!i.extend&&E>m&&(v=m,m=E,E=v),v=_R(c,E);var I=_R(c,m);v&&I&&(i.rangeCount!==1||i.anchorNode!==v.node||i.anchorOffset!==v.offset||i.focusNode!==I.node||i.focusOffset!==I.offset)&&(o=o.createRange(),o.setStart(v.node,v.offset),i.removeAllRanges(),E>m?(i.addRange(o),i.extend(I.node,I.offset)):(o.setEnd(I.node,I.offset),i.addRange(o)))}}for(o=[],i=c;i=i.parentNode;)i.nodeType===1&&o.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof c.focus=="function"&&c.focus(),c=0;c<o.length;c++)i=o[c],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var J6=Wc&&"documentMode"in document&&11>=document.documentMode,Op=null,KS=null,iy=null,YS=!1;function yR(i,o,c){var m=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;YS||Op==null||Op!==Y0(m)||(m=Op,"selectionStart"in m&&vE(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),iy&&_y(iy,m)||(iy=m,m=r1(KS,"onSelect"),0<m.length&&(o=new _E("onSelect","select",null,o,c),i.push({event:o,listeners:m}),o.target=Op)))}function f0(i,o){var c={};return c[i.toLowerCase()]=o.toLowerCase(),c["Webkit"+i]="webkit"+o,c["Moz"+i]="moz"+o,c}var Fp={animationend:f0("Animation","AnimationEnd"),animationiteration:f0("Animation","AnimationIteration"),animationstart:f0("Animation","AnimationStart"),transitionend:f0("Transition","TransitionEnd")},X2={},EN={};Wc&&(EN=document.createElement("div").style,"AnimationEvent"in window||(delete Fp.animationend.animation,delete Fp.animationiteration.animation,delete Fp.animationstart.animation),"TransitionEvent"in window||delete Fp.transitionend.transition);function G1(i){if(X2[i])return X2[i];if(!Fp[i])return i;var o=Fp[i],c;for(c in o)if(o.hasOwnProperty(c)&&c in EN)return X2[i]=o[c];return i}var CN=G1("animationend"),AN=G1("animationiteration"),IN=G1("animationstart"),PN=G1("transitionend"),MN=new Map,xR="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Md(i,o){MN.set(i,o),rf(o,[i])}for(var K2=0;K2<xR.length;K2++){var Y2=xR[K2],Q6=Y2.toLowerCase(),eU=Y2[0].toUpperCase()+Y2.slice(1);Md(Q6,"on"+eU)}Md(CN,"onAnimationEnd");Md(AN,"onAnimationIteration");Md(IN,"onAnimationStart");Md("dblclick","onDoubleClick");Md("focusin","onFocus");Md("focusout","onBlur");Md(PN,"onTransitionEnd");um("onMouseEnter",["mouseout","mouseover"]);um("onMouseLeave",["mouseout","mouseover"]);um("onPointerEnter",["pointerout","pointerover"]);um("onPointerLeave",["pointerout","pointerover"]);rf("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));rf("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));rf("onBeforeInput",["compositionend","keypress","textInput","paste"]);rf("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));rf("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));rf("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var W_="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),tU=new Set("cancel close invalid load scroll toggle".split(" ").concat(W_));function vR(i,o,c){var m=i.type||"unknown-event";i.currentTarget=c,QV(m,o,void 0,i),i.currentTarget=null}function RN(i,o){o=(o&4)!==0;for(var c=0;c<i.length;c++){var m=i[c],v=m.event;m=m.listeners;e:{var E=void 0;if(o)for(var I=m.length-1;0<=I;I--){var s=m[I],O=s.instance,j=s.currentTarget;if(s=s.listener,O!==E&&v.isPropagationStopped())break e;vR(v,s,j),E=O}else for(I=0;I<m.length;I++){if(s=m[I],O=s.instance,j=s.currentTarget,s=s.listener,O!==E&&v.isPropagationStopped())break e;vR(v,s,j),E=O}}}if(Q0)throw i=qS,Q0=!1,qS=null,i}function Jr(i,o){var c=o[iT];c===void 0&&(c=o[iT]=new Set);var m=i+"__bubble";c.has(m)||(DN(o,i,2,!1),c.add(m))}function J2(i,o,c){var m=0;o&&(m|=4),DN(c,i,m,o)}var p0="_reactListening"+Math.random().toString(36).slice(2);function yy(i){if(!i[p0]){i[p0]=!0,jk.forEach(function(c){c!=="selectionchange"&&(tU.has(c)||J2(c,!1,i),J2(c,!0,i))});var o=i.nodeType===9?i:i.ownerDocument;o===null||o[p0]||(o[p0]=!0,J2("selectionchange",!1,o))}}function DN(i,o,c,m){switch(mN(o)){case 1:var v=m6;break;case 4:v=g6;break;default:v=mE}c=v.bind(null,o,c,i),v=void 0,!HS||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(v=!0),m?v!==void 0?i.addEventListener(o,c,{capture:!0,passive:v}):i.addEventListener(o,c,!0):v!==void 0?i.addEventListener(o,c,{passive:v}):i.addEventListener(o,c,!1)}function Q2(i,o,c,m,v){var E=m;if(!(o&1)&&!(o&2)&&m!==null)e:for(;;){if(m===null)return;var I=m.tag;if(I===3||I===4){var s=m.stateNode.containerInfo;if(s===v||s.nodeType===8&&s.parentNode===v)break;if(I===4)for(I=m.return;I!==null;){var O=I.tag;if((O===3||O===4)&&(O=I.stateNode.containerInfo,O===v||O.nodeType===8&&O.parentNode===v))return;I=I.return}for(;s!==null;){if(I=Fh(s),I===null)return;if(O=I.tag,O===5||O===6){m=E=I;continue e}s=s.parentNode}}m=m.return}tN(function(){var j=E,G=dE(c),W=[];e:{var B=MN.get(i);if(B!==void 0){var te=_E,ue=i;switch(i){case"keypress":if(O0(c)===0)break e;case"keydown":case"keyup":te=R6;break;case"focusin":ue="focus",te=q2;break;case"focusout":ue="blur",te=q2;break;case"beforeblur":case"afterblur":te=q2;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":te=lR;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":te=x6;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":te=N6;break;case CN:case AN:case IN:te=b6;break;case PN:te=z6;break;case"scroll":te=_6;break;case"wheel":te=F6;break;case"copy":case"cut":case"paste":te=T6;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":te=uR}var J=(o&4)!==0,ce=!J&&i==="scroll",oe=J?B!==null?B+"Capture":null:B;J=[];for(var ee=j,Q;ee!==null;){Q=ee;var Ie=Q.stateNode;if(Q.tag===5&&Ie!==null&&(Q=Ie,oe!==null&&(Ie=hy(ee,oe),Ie!=null&&J.push(xy(ee,Ie,Q)))),ce)break;ee=ee.return}0<J.length&&(B=new te(B,ue,null,c,G),W.push({event:B,listeners:J}))}}if(!(o&7)){e:{if(B=i==="mouseover"||i==="pointerover",te=i==="mouseout"||i==="pointerout",B&&c!==GS&&(ue=c.relatedTarget||c.fromElement)&&(Fh(ue)||ue[Zc]))break e;if((te||B)&&(B=G.window===G?G:(B=G.ownerDocument)?B.defaultView||B.parentWindow:window,te?(ue=c.relatedTarget||c.toElement,te=j,ue=ue?Fh(ue):null,ue!==null&&(ce=sf(ue),ue!==ce||ue.tag!==5&&ue.tag!==6)&&(ue=null)):(te=null,ue=j),te!==ue)){if(J=lR,Ie="onMouseLeave",oe="onMouseEnter",ee="mouse",(i==="pointerout"||i==="pointerover")&&(J=uR,Ie="onPointerLeave",oe="onPointerEnter",ee="pointer"),ce=te==null?B:jp(te),Q=ue==null?B:jp(ue),B=new J(Ie,ee+"leave",te,c,G),B.target=ce,B.relatedTarget=Q,Ie=null,Fh(G)===j&&(J=new J(oe,ee+"enter",ue,c,G),J.target=Q,J.relatedTarget=ce,Ie=J),ce=Ie,te&&ue)t:{for(J=te,oe=ue,ee=0,Q=J;Q;Q=Ip(Q))ee++;for(Q=0,Ie=oe;Ie;Ie=Ip(Ie))Q++;for(;0<ee-Q;)J=Ip(J),ee--;for(;0<Q-ee;)oe=Ip(oe),Q--;for(;ee--;){if(J===oe||oe!==null&&J===oe.alternate)break t;J=Ip(J),oe=Ip(oe)}J=null}else J=null;te!==null&&wR(W,B,te,J,!1),ue!==null&&ce!==null&&wR(W,ce,ue,J,!0)}}e:{if(B=j?jp(j):window,te=B.nodeName&&B.nodeName.toLowerCase(),te==="select"||te==="input"&&B.type==="file")var pe=H6;else if(fR(B))if(wN)pe=X6;else{pe=W6;var Ke=q6}else(te=B.nodeName)&&te.toLowerCase()==="input"&&(B.type==="checkbox"||B.type==="radio")&&(pe=Z6);if(pe&&(pe=pe(i,j))){vN(W,pe,c,G);break e}Ke&&Ke(i,B,j),i==="focusout"&&(Ke=B._wrapperState)&&Ke.controlled&&B.type==="number"&&FS(B,"number",B.value)}switch(Ke=j?jp(j):window,i){case"focusin":(fR(Ke)||Ke.contentEditable==="true")&&(Op=Ke,KS=j,iy=null);break;case"focusout":iy=KS=Op=null;break;case"mousedown":YS=!0;break;case"contextmenu":case"mouseup":case"dragend":YS=!1,yR(W,c,G);break;case"selectionchange":if(J6)break;case"keydown":case"keyup":yR(W,c,G)}var et;if(xE)e:{switch(i){case"compositionstart":var at="onCompositionStart";break e;case"compositionend":at="onCompositionEnd";break e;case"compositionupdate":at="onCompositionUpdate";break e}at=void 0}else zp?yN(i,c)&&(at="onCompositionEnd"):i==="keydown"&&c.keyCode===229&&(at="onCompositionStart");at&&(_N&&c.locale!=="ko"&&(zp||at!=="onCompositionStart"?at==="onCompositionEnd"&&zp&&(et=gN()):(dd=G,gE="value"in dd?dd.value:dd.textContent,zp=!0)),Ke=r1(j,at),0<Ke.length&&(at=new cR(at,i,null,c,G),W.push({event:at,listeners:Ke}),et?at.data=et:(et=xN(c),et!==null&&(at.data=et)))),(et=B6?V6(i,c):U6(i,c))&&(j=r1(j,"onBeforeInput"),0<j.length&&(G=new cR("onBeforeInput","beforeinput",null,c,G),W.push({event:G,listeners:j}),G.data=et))}RN(W,o)})}function xy(i,o,c){return{instance:i,listener:o,currentTarget:c}}function r1(i,o){for(var c=o+"Capture",m=[];i!==null;){var v=i,E=v.stateNode;v.tag===5&&E!==null&&(v=E,E=hy(i,c),E!=null&&m.unshift(xy(i,E,v)),E=hy(i,o),E!=null&&m.push(xy(i,E,v))),i=i.return}return m}function Ip(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function wR(i,o,c,m,v){for(var E=o._reactName,I=[];c!==null&&c!==m;){var s=c,O=s.alternate,j=s.stateNode;if(O!==null&&O===m)break;s.tag===5&&j!==null&&(s=j,v?(O=hy(c,E),O!=null&&I.unshift(xy(c,O,s))):v||(O=hy(c,E),O!=null&&I.push(xy(c,O,s)))),c=c.return}I.length!==0&&i.push({event:o,listeners:I})}var iU=/\r\n?/g,nU=/\u0000|\uFFFD/g;function bR(i){return(typeof i=="string"?i:""+i).replace(iU,`
`).replace(nU,"")}function m0(i,o,c){if(o=bR(o),bR(i)!==o&&c)throw Error(oi(425))}function s1(){}var JS=null,QS=null;function eT(i,o){return i==="textarea"||i==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var tT=typeof setTimeout=="function"?setTimeout:void 0,rU=typeof clearTimeout=="function"?clearTimeout:void 0,SR=typeof Promise=="function"?Promise:void 0,sU=typeof queueMicrotask=="function"?queueMicrotask:typeof SR<"u"?function(i){return SR.resolve(null).then(i).catch(oU)}:tT;function oU(i){setTimeout(function(){throw i})}function eS(i,o){var c=o,m=0;do{var v=c.nextSibling;if(i.removeChild(c),v&&v.nodeType===8)if(c=v.data,c==="/$"){if(m===0){i.removeChild(v),my(o);return}m--}else c!=="$"&&c!=="$?"&&c!=="$!"||m++;c=v}while(c);my(o)}function _d(i){for(;i!=null;i=i.nextSibling){var o=i.nodeType;if(o===1||o===3)break;if(o===8){if(o=i.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return i}function TR(i){i=i.previousSibling;for(var o=0;i;){if(i.nodeType===8){var c=i.data;if(c==="$"||c==="$!"||c==="$?"){if(o===0)return i;o--}else c==="/$"&&o++}i=i.previousSibling}return null}var bm=Math.random().toString(36).slice(2),sc="__reactFiber$"+bm,vy="__reactProps$"+bm,Zc="__reactContainer$"+bm,iT="__reactEvents$"+bm,aU="__reactListeners$"+bm,lU="__reactHandles$"+bm;function Fh(i){var o=i[sc];if(o)return o;for(var c=i.parentNode;c;){if(o=c[Zc]||c[sc]){if(c=o.alternate,o.child!==null||c!==null&&c.child!==null)for(i=TR(i);i!==null;){if(c=i[sc])return c;i=TR(i)}return o}i=c,c=i.parentNode}return null}function Vy(i){return i=i[sc]||i[Zc],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function jp(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(oi(33))}function $1(i){return i[vy]||null}var nT=[],Bp=-1;function Rd(i){return{current:i}}function Qr(i){0>Bp||(i.current=nT[Bp],nT[Bp]=null,Bp--)}function Wr(i,o){Bp++,nT[Bp]=i.current,i.current=o}var Ed={},Io=Rd(Ed),la=Rd(!1),Zh=Ed;function dm(i,o){var c=i.type.contextTypes;if(!c)return Ed;var m=i.stateNode;if(m&&m.__reactInternalMemoizedUnmaskedChildContext===o)return m.__reactInternalMemoizedMaskedChildContext;var v={},E;for(E in c)v[E]=o[E];return m&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=o,i.__reactInternalMemoizedMaskedChildContext=v),v}function ca(i){return i=i.childContextTypes,i!=null}function o1(){Qr(la),Qr(Io)}function ER(i,o,c){if(Io.current!==Ed)throw Error(oi(168));Wr(Io,o),Wr(la,c)}function kN(i,o,c){var m=i.stateNode;if(o=o.childContextTypes,typeof m.getChildContext!="function")return c;m=m.getChildContext();for(var v in m)if(!(v in o))throw Error(oi(108,qV(i)||"Unknown",v));return os({},c,m)}function a1(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||Ed,Zh=Io.current,Wr(Io,i),Wr(la,la.current),!0}function CR(i,o,c){var m=i.stateNode;if(!m)throw Error(oi(169));c?(i=kN(i,o,Zh),m.__reactInternalMemoizedMergedChildContext=i,Qr(la),Qr(Io),Wr(Io,i)):Qr(la),Wr(la,c)}var Vc=null,H1=!1,tS=!1;function NN(i){Vc===null?Vc=[i]:Vc.push(i)}function cU(i){H1=!0,NN(i)}function Dd(){if(!tS&&Vc!==null){tS=!0;var i=0,o=Lr;try{var c=Vc;for(Lr=1;i<c.length;i++){var m=c[i];do m=m(!0);while(m!==null)}Vc=null,H1=!1}catch(v){throw Vc!==null&&(Vc=Vc.slice(i+1)),sN(hE,Dd),v}finally{Lr=o,tS=!1}}return null}var Vp=[],Up=0,l1=null,c1=0,Ua=[],Ga=0,Xh=null,Gc=1,$c="";function zh(i,o){Vp[Up++]=c1,Vp[Up++]=l1,l1=i,c1=o}function LN(i,o,c){Ua[Ga++]=Gc,Ua[Ga++]=$c,Ua[Ga++]=Xh,Xh=i;var m=Gc;i=$c;var v=32-yl(m)-1;m&=~(1<<v),c+=1;var E=32-yl(o)+v;if(30<E){var I=v-v%5;E=(m&(1<<I)-1).toString(32),m>>=I,v-=I,Gc=1<<32-yl(o)+v|c<<v|m,$c=E+i}else Gc=1<<E|c<<v|m,$c=i}function wE(i){i.return!==null&&(zh(i,1),LN(i,1,0))}function bE(i){for(;i===l1;)l1=Vp[--Up],Vp[Up]=null,c1=Vp[--Up],Vp[Up]=null;for(;i===Xh;)Xh=Ua[--Ga],Ua[Ga]=null,$c=Ua[--Ga],Ua[Ga]=null,Gc=Ua[--Ga],Ua[Ga]=null}var Ea=null,Ta=null,is=!1,pl=null;function zN(i,o){var c=$a(5,null,null,0);c.elementType="DELETED",c.stateNode=o,c.return=i,o=i.deletions,o===null?(i.deletions=[c],i.flags|=16):o.push(c)}function AR(i,o){switch(i.tag){case 5:var c=i.type;return o=o.nodeType!==1||c.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(i.stateNode=o,Ea=i,Ta=_d(o.firstChild),!0):!1;case 6:return o=i.pendingProps===""||o.nodeType!==3?null:o,o!==null?(i.stateNode=o,Ea=i,Ta=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(c=Xh!==null?{id:Gc,overflow:$c}:null,i.memoizedState={dehydrated:o,treeContext:c,retryLane:1073741824},c=$a(18,null,null,0),c.stateNode=o,c.return=i,i.child=c,Ea=i,Ta=null,!0):!1;default:return!1}}function rT(i){return(i.mode&1)!==0&&(i.flags&128)===0}function sT(i){if(is){var o=Ta;if(o){var c=o;if(!AR(i,o)){if(rT(i))throw Error(oi(418));o=_d(c.nextSibling);var m=Ea;o&&AR(i,o)?zN(m,c):(i.flags=i.flags&-4097|2,is=!1,Ea=i)}}else{if(rT(i))throw Error(oi(418));i.flags=i.flags&-4097|2,is=!1,Ea=i}}}function IR(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;Ea=i}function g0(i){if(i!==Ea)return!1;if(!is)return IR(i),is=!0,!1;var o;if((o=i.tag!==3)&&!(o=i.tag!==5)&&(o=i.type,o=o!=="head"&&o!=="body"&&!eT(i.type,i.memoizedProps)),o&&(o=Ta)){if(rT(i))throw ON(),Error(oi(418));for(;o;)zN(i,o),o=_d(o.nextSibling)}if(IR(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(oi(317));e:{for(i=i.nextSibling,o=0;i;){if(i.nodeType===8){var c=i.data;if(c==="/$"){if(o===0){Ta=_d(i.nextSibling);break e}o--}else c!=="$"&&c!=="$!"&&c!=="$?"||o++}i=i.nextSibling}Ta=null}}else Ta=Ea?_d(i.stateNode.nextSibling):null;return!0}function ON(){for(var i=Ta;i;)i=_d(i.nextSibling)}function hm(){Ta=Ea=null,is=!1}function SE(i){pl===null?pl=[i]:pl.push(i)}var uU=tu.ReactCurrentBatchConfig;function O_(i,o,c){if(i=c.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(c._owner){if(c=c._owner,c){if(c.tag!==1)throw Error(oi(309));var m=c.stateNode}if(!m)throw Error(oi(147,i));var v=m,E=""+i;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===E?o.ref:(o=function(I){var s=v.refs;I===null?delete s[E]:s[E]=I},o._stringRef=E,o)}if(typeof i!="string")throw Error(oi(284));if(!c._owner)throw Error(oi(290,i))}return i}function _0(i,o){throw i=Object.prototype.toString.call(o),Error(oi(31,i==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":i))}function PR(i){var o=i._init;return o(i._payload)}function FN(i){function o(oe,ee){if(i){var Q=oe.deletions;Q===null?(oe.deletions=[ee],oe.flags|=16):Q.push(ee)}}function c(oe,ee){if(!i)return null;for(;ee!==null;)o(oe,ee),ee=ee.sibling;return null}function m(oe,ee){for(oe=new Map;ee!==null;)ee.key!==null?oe.set(ee.key,ee):oe.set(ee.index,ee),ee=ee.sibling;return oe}function v(oe,ee){return oe=wd(oe,ee),oe.index=0,oe.sibling=null,oe}function E(oe,ee,Q){return oe.index=Q,i?(Q=oe.alternate,Q!==null?(Q=Q.index,Q<ee?(oe.flags|=2,ee):Q):(oe.flags|=2,ee)):(oe.flags|=1048576,ee)}function I(oe){return i&&oe.alternate===null&&(oe.flags|=2),oe}function s(oe,ee,Q,Ie){return ee===null||ee.tag!==6?(ee=lS(Q,oe.mode,Ie),ee.return=oe,ee):(ee=v(ee,Q),ee.return=oe,ee)}function O(oe,ee,Q,Ie){var pe=Q.type;return pe===Lp?G(oe,ee,Q.props.children,Ie,Q.key):ee!==null&&(ee.elementType===pe||typeof pe=="object"&&pe!==null&&pe.$$typeof===ed&&PR(pe)===ee.type)?(Ie=v(ee,Q.props),Ie.ref=O_(oe,ee,Q),Ie.return=oe,Ie):(Ie=$0(Q.type,Q.key,Q.props,null,oe.mode,Ie),Ie.ref=O_(oe,ee,Q),Ie.return=oe,Ie)}function j(oe,ee,Q,Ie){return ee===null||ee.tag!==4||ee.stateNode.containerInfo!==Q.containerInfo||ee.stateNode.implementation!==Q.implementation?(ee=cS(Q,oe.mode,Ie),ee.return=oe,ee):(ee=v(ee,Q.children||[]),ee.return=oe,ee)}function G(oe,ee,Q,Ie,pe){return ee===null||ee.tag!==7?(ee=Wh(Q,oe.mode,Ie,pe),ee.return=oe,ee):(ee=v(ee,Q),ee.return=oe,ee)}function W(oe,ee,Q){if(typeof ee=="string"&&ee!==""||typeof ee=="number")return ee=lS(""+ee,oe.mode,Q),ee.return=oe,ee;if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case o0:return Q=$0(ee.type,ee.key,ee.props,null,oe.mode,Q),Q.ref=O_(oe,null,ee),Q.return=oe,Q;case Np:return ee=cS(ee,oe.mode,Q),ee.return=oe,ee;case ed:var Ie=ee._init;return W(oe,Ie(ee._payload),Q)}if(H_(ee)||D_(ee))return ee=Wh(ee,oe.mode,Q,null),ee.return=oe,ee;_0(oe,ee)}return null}function B(oe,ee,Q,Ie){var pe=ee!==null?ee.key:null;if(typeof Q=="string"&&Q!==""||typeof Q=="number")return pe!==null?null:s(oe,ee,""+Q,Ie);if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case o0:return Q.key===pe?O(oe,ee,Q,Ie):null;case Np:return Q.key===pe?j(oe,ee,Q,Ie):null;case ed:return pe=Q._init,B(oe,ee,pe(Q._payload),Ie)}if(H_(Q)||D_(Q))return pe!==null?null:G(oe,ee,Q,Ie,null);_0(oe,Q)}return null}function te(oe,ee,Q,Ie,pe){if(typeof Ie=="string"&&Ie!==""||typeof Ie=="number")return oe=oe.get(Q)||null,s(ee,oe,""+Ie,pe);if(typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case o0:return oe=oe.get(Ie.key===null?Q:Ie.key)||null,O(ee,oe,Ie,pe);case Np:return oe=oe.get(Ie.key===null?Q:Ie.key)||null,j(ee,oe,Ie,pe);case ed:var Ke=Ie._init;return te(oe,ee,Q,Ke(Ie._payload),pe)}if(H_(Ie)||D_(Ie))return oe=oe.get(Q)||null,G(ee,oe,Ie,pe,null);_0(ee,Ie)}return null}function ue(oe,ee,Q,Ie){for(var pe=null,Ke=null,et=ee,at=ee=0,Xt=null;et!==null&&at<Q.length;at++){et.index>at?(Xt=et,et=null):Xt=et.sibling;var Ct=B(oe,et,Q[at],Ie);if(Ct===null){et===null&&(et=Xt);break}i&&et&&Ct.alternate===null&&o(oe,et),ee=E(Ct,ee,at),Ke===null?pe=Ct:Ke.sibling=Ct,Ke=Ct,et=Xt}if(at===Q.length)return c(oe,et),is&&zh(oe,at),pe;if(et===null){for(;at<Q.length;at++)et=W(oe,Q[at],Ie),et!==null&&(ee=E(et,ee,at),Ke===null?pe=et:Ke.sibling=et,Ke=et);return is&&zh(oe,at),pe}for(et=m(oe,et);at<Q.length;at++)Xt=te(et,oe,at,Q[at],Ie),Xt!==null&&(i&&Xt.alternate!==null&&et.delete(Xt.key===null?at:Xt.key),ee=E(Xt,ee,at),Ke===null?pe=Xt:Ke.sibling=Xt,Ke=Xt);return i&&et.forEach(function(mt){return o(oe,mt)}),is&&zh(oe,at),pe}function J(oe,ee,Q,Ie){var pe=D_(Q);if(typeof pe!="function")throw Error(oi(150));if(Q=pe.call(Q),Q==null)throw Error(oi(151));for(var Ke=pe=null,et=ee,at=ee=0,Xt=null,Ct=Q.next();et!==null&&!Ct.done;at++,Ct=Q.next()){et.index>at?(Xt=et,et=null):Xt=et.sibling;var mt=B(oe,et,Ct.value,Ie);if(mt===null){et===null&&(et=Xt);break}i&&et&&mt.alternate===null&&o(oe,et),ee=E(mt,ee,at),Ke===null?pe=mt:Ke.sibling=mt,Ke=mt,et=Xt}if(Ct.done)return c(oe,et),is&&zh(oe,at),pe;if(et===null){for(;!Ct.done;at++,Ct=Q.next())Ct=W(oe,Ct.value,Ie),Ct!==null&&(ee=E(Ct,ee,at),Ke===null?pe=Ct:Ke.sibling=Ct,Ke=Ct);return is&&zh(oe,at),pe}for(et=m(oe,et);!Ct.done;at++,Ct=Q.next())Ct=te(et,oe,at,Ct.value,Ie),Ct!==null&&(i&&Ct.alternate!==null&&et.delete(Ct.key===null?at:Ct.key),ee=E(Ct,ee,at),Ke===null?pe=Ct:Ke.sibling=Ct,Ke=Ct);return i&&et.forEach(function(Dt){return o(oe,Dt)}),is&&zh(oe,at),pe}function ce(oe,ee,Q,Ie){if(typeof Q=="object"&&Q!==null&&Q.type===Lp&&Q.key===null&&(Q=Q.props.children),typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case o0:e:{for(var pe=Q.key,Ke=ee;Ke!==null;){if(Ke.key===pe){if(pe=Q.type,pe===Lp){if(Ke.tag===7){c(oe,Ke.sibling),ee=v(Ke,Q.props.children),ee.return=oe,oe=ee;break e}}else if(Ke.elementType===pe||typeof pe=="object"&&pe!==null&&pe.$$typeof===ed&&PR(pe)===Ke.type){c(oe,Ke.sibling),ee=v(Ke,Q.props),ee.ref=O_(oe,Ke,Q),ee.return=oe,oe=ee;break e}c(oe,Ke);break}else o(oe,Ke);Ke=Ke.sibling}Q.type===Lp?(ee=Wh(Q.props.children,oe.mode,Ie,Q.key),ee.return=oe,oe=ee):(Ie=$0(Q.type,Q.key,Q.props,null,oe.mode,Ie),Ie.ref=O_(oe,ee,Q),Ie.return=oe,oe=Ie)}return I(oe);case Np:e:{for(Ke=Q.key;ee!==null;){if(ee.key===Ke)if(ee.tag===4&&ee.stateNode.containerInfo===Q.containerInfo&&ee.stateNode.implementation===Q.implementation){c(oe,ee.sibling),ee=v(ee,Q.children||[]),ee.return=oe,oe=ee;break e}else{c(oe,ee);break}else o(oe,ee);ee=ee.sibling}ee=cS(Q,oe.mode,Ie),ee.return=oe,oe=ee}return I(oe);case ed:return Ke=Q._init,ce(oe,ee,Ke(Q._payload),Ie)}if(H_(Q))return ue(oe,ee,Q,Ie);if(D_(Q))return J(oe,ee,Q,Ie);_0(oe,Q)}return typeof Q=="string"&&Q!==""||typeof Q=="number"?(Q=""+Q,ee!==null&&ee.tag===6?(c(oe,ee.sibling),ee=v(ee,Q),ee.return=oe,oe=ee):(c(oe,ee),ee=lS(Q,oe.mode,Ie),ee.return=oe,oe=ee),I(oe)):c(oe,ee)}return ce}var fm=FN(!0),jN=FN(!1),u1=Rd(null),d1=null,Gp=null,TE=null;function EE(){TE=Gp=d1=null}function CE(i){var o=u1.current;Qr(u1),i._currentValue=o}function oT(i,o,c){for(;i!==null;){var m=i.alternate;if((i.childLanes&o)!==o?(i.childLanes|=o,m!==null&&(m.childLanes|=o)):m!==null&&(m.childLanes&o)!==o&&(m.childLanes|=o),i===c)break;i=i.return}}function Kp(i,o){d1=i,TE=Gp=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&o&&(aa=!0),i.firstContext=null)}function Za(i){var o=i._currentValue;if(TE!==i)if(i={context:i,memoizedValue:o,next:null},Gp===null){if(d1===null)throw Error(oi(308));Gp=i,d1.dependencies={lanes:0,firstContext:i}}else Gp=Gp.next=i;return o}var jh=null;function AE(i){jh===null?jh=[i]:jh.push(i)}function BN(i,o,c,m){var v=o.interleaved;return v===null?(c.next=c,AE(o)):(c.next=v.next,v.next=c),o.interleaved=c,Xc(i,m)}function Xc(i,o){i.lanes|=o;var c=i.alternate;for(c!==null&&(c.lanes|=o),c=i,i=i.return;i!==null;)i.childLanes|=o,c=i.alternate,c!==null&&(c.childLanes|=o),c=i,i=i.return;return c.tag===3?c.stateNode:null}var td=!1;function IE(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function VN(i,o){i=i.updateQueue,o.updateQueue===i&&(o.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function Hc(i,o){return{eventTime:i,lane:o,tag:0,payload:null,callback:null,next:null}}function yd(i,o,c){var m=i.updateQueue;if(m===null)return null;if(m=m.shared,mr&2){var v=m.pending;return v===null?o.next=o:(o.next=v.next,v.next=o),m.pending=o,Xc(i,c)}return v=m.interleaved,v===null?(o.next=o,AE(m)):(o.next=v.next,v.next=o),m.interleaved=o,Xc(i,c)}function F0(i,o,c){if(o=o.updateQueue,o!==null&&(o=o.shared,(c&4194240)!==0)){var m=o.lanes;m&=i.pendingLanes,c|=m,o.lanes=c,fE(i,c)}}function MR(i,o){var c=i.updateQueue,m=i.alternate;if(m!==null&&(m=m.updateQueue,c===m)){var v=null,E=null;if(c=c.firstBaseUpdate,c!==null){do{var I={eventTime:c.eventTime,lane:c.lane,tag:c.tag,payload:c.payload,callback:c.callback,next:null};E===null?v=E=I:E=E.next=I,c=c.next}while(c!==null);E===null?v=E=o:E=E.next=o}else v=E=o;c={baseState:m.baseState,firstBaseUpdate:v,lastBaseUpdate:E,shared:m.shared,effects:m.effects},i.updateQueue=c;return}i=c.lastBaseUpdate,i===null?c.firstBaseUpdate=o:i.next=o,c.lastBaseUpdate=o}function h1(i,o,c,m){var v=i.updateQueue;td=!1;var E=v.firstBaseUpdate,I=v.lastBaseUpdate,s=v.shared.pending;if(s!==null){v.shared.pending=null;var O=s,j=O.next;O.next=null,I===null?E=j:I.next=j,I=O;var G=i.alternate;G!==null&&(G=G.updateQueue,s=G.lastBaseUpdate,s!==I&&(s===null?G.firstBaseUpdate=j:s.next=j,G.lastBaseUpdate=O))}if(E!==null){var W=v.baseState;I=0,G=j=O=null,s=E;do{var B=s.lane,te=s.eventTime;if((m&B)===B){G!==null&&(G=G.next={eventTime:te,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var ue=i,J=s;switch(B=o,te=c,J.tag){case 1:if(ue=J.payload,typeof ue=="function"){W=ue.call(te,W,B);break e}W=ue;break e;case 3:ue.flags=ue.flags&-65537|128;case 0:if(ue=J.payload,B=typeof ue=="function"?ue.call(te,W,B):ue,B==null)break e;W=os({},W,B);break e;case 2:td=!0}}s.callback!==null&&s.lane!==0&&(i.flags|=64,B=v.effects,B===null?v.effects=[s]:B.push(s))}else te={eventTime:te,lane:B,tag:s.tag,payload:s.payload,callback:s.callback,next:null},G===null?(j=G=te,O=W):G=G.next=te,I|=B;if(s=s.next,s===null){if(s=v.shared.pending,s===null)break;B=s,s=B.next,B.next=null,v.lastBaseUpdate=B,v.shared.pending=null}}while(!0);if(G===null&&(O=W),v.baseState=O,v.firstBaseUpdate=j,v.lastBaseUpdate=G,o=v.shared.interleaved,o!==null){v=o;do I|=v.lane,v=v.next;while(v!==o)}else E===null&&(v.shared.lanes=0);Yh|=I,i.lanes=I,i.memoizedState=W}}function RR(i,o,c){if(i=o.effects,o.effects=null,i!==null)for(o=0;o<i.length;o++){var m=i[o],v=m.callback;if(v!==null){if(m.callback=null,m=c,typeof v!="function")throw Error(oi(191,v));v.call(m)}}}var Uy={},uc=Rd(Uy),wy=Rd(Uy),by=Rd(Uy);function Bh(i){if(i===Uy)throw Error(oi(174));return i}function PE(i,o){switch(Wr(by,o),Wr(wy,i),Wr(uc,Uy),i=o.nodeType,i){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:BS(null,"");break;default:i=i===8?o.parentNode:o,o=i.namespaceURI||null,i=i.tagName,o=BS(o,i)}Qr(uc),Wr(uc,o)}function pm(){Qr(uc),Qr(wy),Qr(by)}function UN(i){Bh(by.current);var o=Bh(uc.current),c=BS(o,i.type);o!==c&&(Wr(wy,i),Wr(uc,c))}function ME(i){wy.current===i&&(Qr(uc),Qr(wy))}var rs=Rd(0);function f1(i){for(var o=i;o!==null;){if(o.tag===13){var c=o.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||c.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if(o.flags&128)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===i)break;for(;o.sibling===null;){if(o.return===null||o.return===i)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var iS=[];function RE(){for(var i=0;i<iS.length;i++)iS[i]._workInProgressVersionPrimary=null;iS.length=0}var j0=tu.ReactCurrentDispatcher,nS=tu.ReactCurrentBatchConfig,Kh=0,ss=null,Vs=null,Ys=null,p1=!1,ny=!1,Sy=0,dU=0;function To(){throw Error(oi(321))}function DE(i,o){if(o===null)return!1;for(var c=0;c<o.length&&c<i.length;c++)if(!wl(i[c],o[c]))return!1;return!0}function kE(i,o,c,m,v,E){if(Kh=E,ss=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,j0.current=i===null||i.memoizedState===null?mU:gU,i=c(m,v),ny){E=0;do{if(ny=!1,Sy=0,25<=E)throw Error(oi(301));E+=1,Ys=Vs=null,o.updateQueue=null,j0.current=_U,i=c(m,v)}while(ny)}if(j0.current=m1,o=Vs!==null&&Vs.next!==null,Kh=0,Ys=Vs=ss=null,p1=!1,o)throw Error(oi(300));return i}function NE(){var i=Sy!==0;return Sy=0,i}function tc(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ys===null?ss.memoizedState=Ys=i:Ys=Ys.next=i,Ys}function Xa(){if(Vs===null){var i=ss.alternate;i=i!==null?i.memoizedState:null}else i=Vs.next;var o=Ys===null?ss.memoizedState:Ys.next;if(o!==null)Ys=o,Vs=i;else{if(i===null)throw Error(oi(310));Vs=i,i={memoizedState:Vs.memoizedState,baseState:Vs.baseState,baseQueue:Vs.baseQueue,queue:Vs.queue,next:null},Ys===null?ss.memoizedState=Ys=i:Ys=Ys.next=i}return Ys}function Ty(i,o){return typeof o=="function"?o(i):o}function rS(i){var o=Xa(),c=o.queue;if(c===null)throw Error(oi(311));c.lastRenderedReducer=i;var m=Vs,v=m.baseQueue,E=c.pending;if(E!==null){if(v!==null){var I=v.next;v.next=E.next,E.next=I}m.baseQueue=v=E,c.pending=null}if(v!==null){E=v.next,m=m.baseState;var s=I=null,O=null,j=E;do{var G=j.lane;if((Kh&G)===G)O!==null&&(O=O.next={lane:0,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null}),m=j.hasEagerState?j.eagerState:i(m,j.action);else{var W={lane:G,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null};O===null?(s=O=W,I=m):O=O.next=W,ss.lanes|=G,Yh|=G}j=j.next}while(j!==null&&j!==E);O===null?I=m:O.next=s,wl(m,o.memoizedState)||(aa=!0),o.memoizedState=m,o.baseState=I,o.baseQueue=O,c.lastRenderedState=m}if(i=c.interleaved,i!==null){v=i;do E=v.lane,ss.lanes|=E,Yh|=E,v=v.next;while(v!==i)}else v===null&&(c.lanes=0);return[o.memoizedState,c.dispatch]}function sS(i){var o=Xa(),c=o.queue;if(c===null)throw Error(oi(311));c.lastRenderedReducer=i;var m=c.dispatch,v=c.pending,E=o.memoizedState;if(v!==null){c.pending=null;var I=v=v.next;do E=i(E,I.action),I=I.next;while(I!==v);wl(E,o.memoizedState)||(aa=!0),o.memoizedState=E,o.baseQueue===null&&(o.baseState=E),c.lastRenderedState=E}return[E,m]}function GN(){}function $N(i,o){var c=ss,m=Xa(),v=o(),E=!wl(m.memoizedState,v);if(E&&(m.memoizedState=v,aa=!0),m=m.queue,LE(WN.bind(null,c,m,i),[i]),m.getSnapshot!==o||E||Ys!==null&&Ys.memoizedState.tag&1){if(c.flags|=2048,Ey(9,qN.bind(null,c,m,v,o),void 0,null),eo===null)throw Error(oi(349));Kh&30||HN(c,o,v)}return v}function HN(i,o,c){i.flags|=16384,i={getSnapshot:o,value:c},o=ss.updateQueue,o===null?(o={lastEffect:null,stores:null},ss.updateQueue=o,o.stores=[i]):(c=o.stores,c===null?o.stores=[i]:c.push(i))}function qN(i,o,c,m){o.value=c,o.getSnapshot=m,ZN(o)&&XN(i)}function WN(i,o,c){return c(function(){ZN(o)&&XN(i)})}function ZN(i){var o=i.getSnapshot;i=i.value;try{var c=o();return!wl(i,c)}catch{return!0}}function XN(i){var o=Xc(i,1);o!==null&&xl(o,i,1,-1)}function DR(i){var o=tc();return typeof i=="function"&&(i=i()),o.memoizedState=o.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ty,lastRenderedState:i},o.queue=i,i=i.dispatch=pU.bind(null,ss,i),[o.memoizedState,i]}function Ey(i,o,c,m){return i={tag:i,create:o,destroy:c,deps:m,next:null},o=ss.updateQueue,o===null?(o={lastEffect:null,stores:null},ss.updateQueue=o,o.lastEffect=i.next=i):(c=o.lastEffect,c===null?o.lastEffect=i.next=i:(m=c.next,c.next=i,i.next=m,o.lastEffect=i)),i}function KN(){return Xa().memoizedState}function B0(i,o,c,m){var v=tc();ss.flags|=i,v.memoizedState=Ey(1|o,c,void 0,m===void 0?null:m)}function q1(i,o,c,m){var v=Xa();m=m===void 0?null:m;var E=void 0;if(Vs!==null){var I=Vs.memoizedState;if(E=I.destroy,m!==null&&DE(m,I.deps)){v.memoizedState=Ey(o,c,E,m);return}}ss.flags|=i,v.memoizedState=Ey(1|o,c,E,m)}function kR(i,o){return B0(8390656,8,i,o)}function LE(i,o){return q1(2048,8,i,o)}function YN(i,o){return q1(4,2,i,o)}function JN(i,o){return q1(4,4,i,o)}function QN(i,o){if(typeof o=="function")return i=i(),o(i),function(){o(null)};if(o!=null)return i=i(),o.current=i,function(){o.current=null}}function eL(i,o,c){return c=c!=null?c.concat([i]):null,q1(4,4,QN.bind(null,o,i),c)}function zE(){}function tL(i,o){var c=Xa();o=o===void 0?null:o;var m=c.memoizedState;return m!==null&&o!==null&&DE(o,m[1])?m[0]:(c.memoizedState=[i,o],i)}function iL(i,o){var c=Xa();o=o===void 0?null:o;var m=c.memoizedState;return m!==null&&o!==null&&DE(o,m[1])?m[0]:(i=i(),c.memoizedState=[i,o],i)}function nL(i,o,c){return Kh&21?(wl(c,o)||(c=lN(),ss.lanes|=c,Yh|=c,i.baseState=!0),o):(i.baseState&&(i.baseState=!1,aa=!0),i.memoizedState=c)}function hU(i,o){var c=Lr;Lr=c!==0&&4>c?c:4,i(!0);var m=nS.transition;nS.transition={};try{i(!1),o()}finally{Lr=c,nS.transition=m}}function rL(){return Xa().memoizedState}function fU(i,o,c){var m=vd(i);if(c={lane:m,action:c,hasEagerState:!1,eagerState:null,next:null},sL(i))oL(o,c);else if(c=BN(i,o,c,m),c!==null){var v=Wo();xl(c,i,m,v),aL(c,o,m)}}function pU(i,o,c){var m=vd(i),v={lane:m,action:c,hasEagerState:!1,eagerState:null,next:null};if(sL(i))oL(o,v);else{var E=i.alternate;if(i.lanes===0&&(E===null||E.lanes===0)&&(E=o.lastRenderedReducer,E!==null))try{var I=o.lastRenderedState,s=E(I,c);if(v.hasEagerState=!0,v.eagerState=s,wl(s,I)){var O=o.interleaved;O===null?(v.next=v,AE(o)):(v.next=O.next,O.next=v),o.interleaved=v;return}}catch{}finally{}c=BN(i,o,v,m),c!==null&&(v=Wo(),xl(c,i,m,v),aL(c,o,m))}}function sL(i){var o=i.alternate;return i===ss||o!==null&&o===ss}function oL(i,o){ny=p1=!0;var c=i.pending;c===null?o.next=o:(o.next=c.next,c.next=o),i.pending=o}function aL(i,o,c){if(c&4194240){var m=o.lanes;m&=i.pendingLanes,c|=m,o.lanes=c,fE(i,c)}}var m1={readContext:Za,useCallback:To,useContext:To,useEffect:To,useImperativeHandle:To,useInsertionEffect:To,useLayoutEffect:To,useMemo:To,useReducer:To,useRef:To,useState:To,useDebugValue:To,useDeferredValue:To,useTransition:To,useMutableSource:To,useSyncExternalStore:To,useId:To,unstable_isNewReconciler:!1},mU={readContext:Za,useCallback:function(i,o){return tc().memoizedState=[i,o===void 0?null:o],i},useContext:Za,useEffect:kR,useImperativeHandle:function(i,o,c){return c=c!=null?c.concat([i]):null,B0(4194308,4,QN.bind(null,o,i),c)},useLayoutEffect:function(i,o){return B0(4194308,4,i,o)},useInsertionEffect:function(i,o){return B0(4,2,i,o)},useMemo:function(i,o){var c=tc();return o=o===void 0?null:o,i=i(),c.memoizedState=[i,o],i},useReducer:function(i,o,c){var m=tc();return o=c!==void 0?c(o):o,m.memoizedState=m.baseState=o,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:o},m.queue=i,i=i.dispatch=fU.bind(null,ss,i),[m.memoizedState,i]},useRef:function(i){var o=tc();return i={current:i},o.memoizedState=i},useState:DR,useDebugValue:zE,useDeferredValue:function(i){return tc().memoizedState=i},useTransition:function(){var i=DR(!1),o=i[0];return i=hU.bind(null,i[1]),tc().memoizedState=i,[o,i]},useMutableSource:function(){},useSyncExternalStore:function(i,o,c){var m=ss,v=tc();if(is){if(c===void 0)throw Error(oi(407));c=c()}else{if(c=o(),eo===null)throw Error(oi(349));Kh&30||HN(m,o,c)}v.memoizedState=c;var E={value:c,getSnapshot:o};return v.queue=E,kR(WN.bind(null,m,E,i),[i]),m.flags|=2048,Ey(9,qN.bind(null,m,E,c,o),void 0,null),c},useId:function(){var i=tc(),o=eo.identifierPrefix;if(is){var c=$c,m=Gc;c=(m&~(1<<32-yl(m)-1)).toString(32)+c,o=":"+o+"R"+c,c=Sy++,0<c&&(o+="H"+c.toString(32)),o+=":"}else c=dU++,o=":"+o+"r"+c.toString(32)+":";return i.memoizedState=o},unstable_isNewReconciler:!1},gU={readContext:Za,useCallback:tL,useContext:Za,useEffect:LE,useImperativeHandle:eL,useInsertionEffect:YN,useLayoutEffect:JN,useMemo:iL,useReducer:rS,useRef:KN,useState:function(){return rS(Ty)},useDebugValue:zE,useDeferredValue:function(i){var o=Xa();return nL(o,Vs.memoizedState,i)},useTransition:function(){var i=rS(Ty)[0],o=Xa().memoizedState;return[i,o]},useMutableSource:GN,useSyncExternalStore:$N,useId:rL,unstable_isNewReconciler:!1},_U={readContext:Za,useCallback:tL,useContext:Za,useEffect:LE,useImperativeHandle:eL,useInsertionEffect:YN,useLayoutEffect:JN,useMemo:iL,useReducer:sS,useRef:KN,useState:function(){return sS(Ty)},useDebugValue:zE,useDeferredValue:function(i){var o=Xa();return Vs===null?o.memoizedState=i:nL(o,Vs.memoizedState,i)},useTransition:function(){var i=sS(Ty)[0],o=Xa().memoizedState;return[i,o]},useMutableSource:GN,useSyncExternalStore:$N,useId:rL,unstable_isNewReconciler:!1};function ul(i,o){if(i&&i.defaultProps){o=os({},o),i=i.defaultProps;for(var c in i)o[c]===void 0&&(o[c]=i[c]);return o}return o}function aT(i,o,c,m){o=i.memoizedState,c=c(m,o),c=c==null?o:os({},o,c),i.memoizedState=c,i.lanes===0&&(i.updateQueue.baseState=c)}var W1={isMounted:function(i){return(i=i._reactInternals)?sf(i)===i:!1},enqueueSetState:function(i,o,c){i=i._reactInternals;var m=Wo(),v=vd(i),E=Hc(m,v);E.payload=o,c!=null&&(E.callback=c),o=yd(i,E,v),o!==null&&(xl(o,i,v,m),F0(o,i,v))},enqueueReplaceState:function(i,o,c){i=i._reactInternals;var m=Wo(),v=vd(i),E=Hc(m,v);E.tag=1,E.payload=o,c!=null&&(E.callback=c),o=yd(i,E,v),o!==null&&(xl(o,i,v,m),F0(o,i,v))},enqueueForceUpdate:function(i,o){i=i._reactInternals;var c=Wo(),m=vd(i),v=Hc(c,m);v.tag=2,o!=null&&(v.callback=o),o=yd(i,v,m),o!==null&&(xl(o,i,m,c),F0(o,i,m))}};function NR(i,o,c,m,v,E,I){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(m,E,I):o.prototype&&o.prototype.isPureReactComponent?!_y(c,m)||!_y(v,E):!0}function lL(i,o,c){var m=!1,v=Ed,E=o.contextType;return typeof E=="object"&&E!==null?E=Za(E):(v=ca(o)?Zh:Io.current,m=o.contextTypes,E=(m=m!=null)?dm(i,v):Ed),o=new o(c,E),i.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=W1,i.stateNode=o,o._reactInternals=i,m&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=v,i.__reactInternalMemoizedMaskedChildContext=E),o}function LR(i,o,c,m){i=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(c,m),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(c,m),o.state!==i&&W1.enqueueReplaceState(o,o.state,null)}function lT(i,o,c,m){var v=i.stateNode;v.props=c,v.state=i.memoizedState,v.refs={},IE(i);var E=o.contextType;typeof E=="object"&&E!==null?v.context=Za(E):(E=ca(o)?Zh:Io.current,v.context=dm(i,E)),v.state=i.memoizedState,E=o.getDerivedStateFromProps,typeof E=="function"&&(aT(i,o,E,c),v.state=i.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof v.getSnapshotBeforeUpdate=="function"||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(o=v.state,typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount(),o!==v.state&&W1.enqueueReplaceState(v,v.state,null),h1(i,c,v,m),v.state=i.memoizedState),typeof v.componentDidMount=="function"&&(i.flags|=4194308)}function mm(i,o){try{var c="",m=o;do c+=HV(m),m=m.return;while(m);var v=c}catch(E){v=`
Error generating stack: `+E.message+`
`+E.stack}return{value:i,source:o,stack:v,digest:null}}function oS(i,o,c){return{value:i,source:null,stack:c??null,digest:o??null}}function cT(i,o){try{console.error(o.value)}catch(c){setTimeout(function(){throw c})}}var yU=typeof WeakMap=="function"?WeakMap:Map;function cL(i,o,c){c=Hc(-1,c),c.tag=3,c.payload={element:null};var m=o.value;return c.callback=function(){_1||(_1=!0,xT=m),cT(i,o)},c}function uL(i,o,c){c=Hc(-1,c),c.tag=3;var m=i.type.getDerivedStateFromError;if(typeof m=="function"){var v=o.value;c.payload=function(){return m(v)},c.callback=function(){cT(i,o)}}var E=i.stateNode;return E!==null&&typeof E.componentDidCatch=="function"&&(c.callback=function(){cT(i,o),typeof m!="function"&&(xd===null?xd=new Set([this]):xd.add(this));var I=o.stack;this.componentDidCatch(o.value,{componentStack:I!==null?I:""})}),c}function zR(i,o,c){var m=i.pingCache;if(m===null){m=i.pingCache=new yU;var v=new Set;m.set(o,v)}else v=m.get(o),v===void 0&&(v=new Set,m.set(o,v));v.has(c)||(v.add(c),i=DU.bind(null,i,o,c),o.then(i,i))}function OR(i){do{var o;if((o=i.tag===13)&&(o=i.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return i;i=i.return}while(i!==null);return null}function FR(i,o,c,m,v){return i.mode&1?(i.flags|=65536,i.lanes=v,i):(i===o?i.flags|=65536:(i.flags|=128,c.flags|=131072,c.flags&=-52805,c.tag===1&&(c.alternate===null?c.tag=17:(o=Hc(-1,1),o.tag=2,yd(c,o,1))),c.lanes|=1),i)}var xU=tu.ReactCurrentOwner,aa=!1;function Go(i,o,c,m){o.child=i===null?jN(o,null,c,m):fm(o,i.child,c,m)}function jR(i,o,c,m,v){c=c.render;var E=o.ref;return Kp(o,v),m=kE(i,o,c,m,E,v),c=NE(),i!==null&&!aa?(o.updateQueue=i.updateQueue,o.flags&=-2053,i.lanes&=~v,Kc(i,o,v)):(is&&c&&wE(o),o.flags|=1,Go(i,o,m,v),o.child)}function BR(i,o,c,m,v){if(i===null){var E=c.type;return typeof E=="function"&&!$E(E)&&E.defaultProps===void 0&&c.compare===null&&c.defaultProps===void 0?(o.tag=15,o.type=E,dL(i,o,E,m,v)):(i=$0(c.type,null,m,o,o.mode,v),i.ref=o.ref,i.return=o,o.child=i)}if(E=i.child,!(i.lanes&v)){var I=E.memoizedProps;if(c=c.compare,c=c!==null?c:_y,c(I,m)&&i.ref===o.ref)return Kc(i,o,v)}return o.flags|=1,i=wd(E,m),i.ref=o.ref,i.return=o,o.child=i}function dL(i,o,c,m,v){if(i!==null){var E=i.memoizedProps;if(_y(E,m)&&i.ref===o.ref)if(aa=!1,o.pendingProps=m=E,(i.lanes&v)!==0)i.flags&131072&&(aa=!0);else return o.lanes=i.lanes,Kc(i,o,v)}return uT(i,o,c,m,v)}function hL(i,o,c){var m=o.pendingProps,v=m.children,E=i!==null?i.memoizedState:null;if(m.mode==="hidden")if(!(o.mode&1))o.memoizedState={baseLanes:0,cachePool:null,transitions:null},Wr(Hp,wa),wa|=c;else{if(!(c&1073741824))return i=E!==null?E.baseLanes|c:c,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:i,cachePool:null,transitions:null},o.updateQueue=null,Wr(Hp,wa),wa|=i,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},m=E!==null?E.baseLanes:c,Wr(Hp,wa),wa|=m}else E!==null?(m=E.baseLanes|c,o.memoizedState=null):m=c,Wr(Hp,wa),wa|=m;return Go(i,o,v,c),o.child}function fL(i,o){var c=o.ref;(i===null&&c!==null||i!==null&&i.ref!==c)&&(o.flags|=512,o.flags|=2097152)}function uT(i,o,c,m,v){var E=ca(c)?Zh:Io.current;return E=dm(o,E),Kp(o,v),c=kE(i,o,c,m,E,v),m=NE(),i!==null&&!aa?(o.updateQueue=i.updateQueue,o.flags&=-2053,i.lanes&=~v,Kc(i,o,v)):(is&&m&&wE(o),o.flags|=1,Go(i,o,c,v),o.child)}function VR(i,o,c,m,v){if(ca(c)){var E=!0;a1(o)}else E=!1;if(Kp(o,v),o.stateNode===null)V0(i,o),lL(o,c,m),lT(o,c,m,v),m=!0;else if(i===null){var I=o.stateNode,s=o.memoizedProps;I.props=s;var O=I.context,j=c.contextType;typeof j=="object"&&j!==null?j=Za(j):(j=ca(c)?Zh:Io.current,j=dm(o,j));var G=c.getDerivedStateFromProps,W=typeof G=="function"||typeof I.getSnapshotBeforeUpdate=="function";W||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(s!==m||O!==j)&&LR(o,I,m,j),td=!1;var B=o.memoizedState;I.state=B,h1(o,m,I,v),O=o.memoizedState,s!==m||B!==O||la.current||td?(typeof G=="function"&&(aT(o,c,G,m),O=o.memoizedState),(s=td||NR(o,c,s,m,B,O,j))?(W||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount()),typeof I.componentDidMount=="function"&&(o.flags|=4194308)):(typeof I.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=m,o.memoizedState=O),I.props=m,I.state=O,I.context=j,m=s):(typeof I.componentDidMount=="function"&&(o.flags|=4194308),m=!1)}else{I=o.stateNode,VN(i,o),s=o.memoizedProps,j=o.type===o.elementType?s:ul(o.type,s),I.props=j,W=o.pendingProps,B=I.context,O=c.contextType,typeof O=="object"&&O!==null?O=Za(O):(O=ca(c)?Zh:Io.current,O=dm(o,O));var te=c.getDerivedStateFromProps;(G=typeof te=="function"||typeof I.getSnapshotBeforeUpdate=="function")||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(s!==W||B!==O)&&LR(o,I,m,O),td=!1,B=o.memoizedState,I.state=B,h1(o,m,I,v);var ue=o.memoizedState;s!==W||B!==ue||la.current||td?(typeof te=="function"&&(aT(o,c,te,m),ue=o.memoizedState),(j=td||NR(o,c,j,m,B,ue,O)||!1)?(G||typeof I.UNSAFE_componentWillUpdate!="function"&&typeof I.componentWillUpdate!="function"||(typeof I.componentWillUpdate=="function"&&I.componentWillUpdate(m,ue,O),typeof I.UNSAFE_componentWillUpdate=="function"&&I.UNSAFE_componentWillUpdate(m,ue,O)),typeof I.componentDidUpdate=="function"&&(o.flags|=4),typeof I.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof I.componentDidUpdate!="function"||s===i.memoizedProps&&B===i.memoizedState||(o.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||s===i.memoizedProps&&B===i.memoizedState||(o.flags|=1024),o.memoizedProps=m,o.memoizedState=ue),I.props=m,I.state=ue,I.context=O,m=j):(typeof I.componentDidUpdate!="function"||s===i.memoizedProps&&B===i.memoizedState||(o.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||s===i.memoizedProps&&B===i.memoizedState||(o.flags|=1024),m=!1)}return dT(i,o,c,m,E,v)}function dT(i,o,c,m,v,E){fL(i,o);var I=(o.flags&128)!==0;if(!m&&!I)return v&&CR(o,c,!1),Kc(i,o,E);m=o.stateNode,xU.current=o;var s=I&&typeof c.getDerivedStateFromError!="function"?null:m.render();return o.flags|=1,i!==null&&I?(o.child=fm(o,i.child,null,E),o.child=fm(o,null,s,E)):Go(i,o,s,E),o.memoizedState=m.state,v&&CR(o,c,!0),o.child}function pL(i){var o=i.stateNode;o.pendingContext?ER(i,o.pendingContext,o.pendingContext!==o.context):o.context&&ER(i,o.context,!1),PE(i,o.containerInfo)}function UR(i,o,c,m,v){return hm(),SE(v),o.flags|=256,Go(i,o,c,m),o.child}var hT={dehydrated:null,treeContext:null,retryLane:0};function fT(i){return{baseLanes:i,cachePool:null,transitions:null}}function mL(i,o,c){var m=o.pendingProps,v=rs.current,E=!1,I=(o.flags&128)!==0,s;if((s=I)||(s=i!==null&&i.memoizedState===null?!1:(v&2)!==0),s?(E=!0,o.flags&=-129):(i===null||i.memoizedState!==null)&&(v|=1),Wr(rs,v&1),i===null)return sT(o),i=o.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(o.mode&1?i.data==="$!"?o.lanes=8:o.lanes=1073741824:o.lanes=1,null):(I=m.children,i=m.fallback,E?(m=o.mode,E=o.child,I={mode:"hidden",children:I},!(m&1)&&E!==null?(E.childLanes=0,E.pendingProps=I):E=K1(I,m,0,null),i=Wh(i,m,c,null),E.return=o,i.return=o,E.sibling=i,o.child=E,o.child.memoizedState=fT(c),o.memoizedState=hT,i):OE(o,I));if(v=i.memoizedState,v!==null&&(s=v.dehydrated,s!==null))return vU(i,o,I,m,s,v,c);if(E){E=m.fallback,I=o.mode,v=i.child,s=v.sibling;var O={mode:"hidden",children:m.children};return!(I&1)&&o.child!==v?(m=o.child,m.childLanes=0,m.pendingProps=O,o.deletions=null):(m=wd(v,O),m.subtreeFlags=v.subtreeFlags&14680064),s!==null?E=wd(s,E):(E=Wh(E,I,c,null),E.flags|=2),E.return=o,m.return=o,m.sibling=E,o.child=m,m=E,E=o.child,I=i.child.memoizedState,I=I===null?fT(c):{baseLanes:I.baseLanes|c,cachePool:null,transitions:I.transitions},E.memoizedState=I,E.childLanes=i.childLanes&~c,o.memoizedState=hT,m}return E=i.child,i=E.sibling,m=wd(E,{mode:"visible",children:m.children}),!(o.mode&1)&&(m.lanes=c),m.return=o,m.sibling=null,i!==null&&(c=o.deletions,c===null?(o.deletions=[i],o.flags|=16):c.push(i)),o.child=m,o.memoizedState=null,m}function OE(i,o){return o=K1({mode:"visible",children:o},i.mode,0,null),o.return=i,i.child=o}function y0(i,o,c,m){return m!==null&&SE(m),fm(o,i.child,null,c),i=OE(o,o.pendingProps.children),i.flags|=2,o.memoizedState=null,i}function vU(i,o,c,m,v,E,I){if(c)return o.flags&256?(o.flags&=-257,m=oS(Error(oi(422))),y0(i,o,I,m)):o.memoizedState!==null?(o.child=i.child,o.flags|=128,null):(E=m.fallback,v=o.mode,m=K1({mode:"visible",children:m.children},v,0,null),E=Wh(E,v,I,null),E.flags|=2,m.return=o,E.return=o,m.sibling=E,o.child=m,o.mode&1&&fm(o,i.child,null,I),o.child.memoizedState=fT(I),o.memoizedState=hT,E);if(!(o.mode&1))return y0(i,o,I,null);if(v.data==="$!"){if(m=v.nextSibling&&v.nextSibling.dataset,m)var s=m.dgst;return m=s,E=Error(oi(419)),m=oS(E,m,void 0),y0(i,o,I,m)}if(s=(I&i.childLanes)!==0,aa||s){if(m=eo,m!==null){switch(I&-I){case 4:v=2;break;case 16:v=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:v=32;break;case 536870912:v=268435456;break;default:v=0}v=v&(m.suspendedLanes|I)?0:v,v!==0&&v!==E.retryLane&&(E.retryLane=v,Xc(i,v),xl(m,i,v,-1))}return GE(),m=oS(Error(oi(421))),y0(i,o,I,m)}return v.data==="$?"?(o.flags|=128,o.child=i.child,o=kU.bind(null,i),v._reactRetry=o,null):(i=E.treeContext,Ta=_d(v.nextSibling),Ea=o,is=!0,pl=null,i!==null&&(Ua[Ga++]=Gc,Ua[Ga++]=$c,Ua[Ga++]=Xh,Gc=i.id,$c=i.overflow,Xh=o),o=OE(o,m.children),o.flags|=4096,o)}function GR(i,o,c){i.lanes|=o;var m=i.alternate;m!==null&&(m.lanes|=o),oT(i.return,o,c)}function aS(i,o,c,m,v){var E=i.memoizedState;E===null?i.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:m,tail:c,tailMode:v}:(E.isBackwards=o,E.rendering=null,E.renderingStartTime=0,E.last=m,E.tail=c,E.tailMode=v)}function gL(i,o,c){var m=o.pendingProps,v=m.revealOrder,E=m.tail;if(Go(i,o,m.children,c),m=rs.current,m&2)m=m&1|2,o.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=o.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&GR(i,c,o);else if(i.tag===19)GR(i,c,o);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===o)break e;for(;i.sibling===null;){if(i.return===null||i.return===o)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}m&=1}if(Wr(rs,m),!(o.mode&1))o.memoizedState=null;else switch(v){case"forwards":for(c=o.child,v=null;c!==null;)i=c.alternate,i!==null&&f1(i)===null&&(v=c),c=c.sibling;c=v,c===null?(v=o.child,o.child=null):(v=c.sibling,c.sibling=null),aS(o,!1,v,c,E);break;case"backwards":for(c=null,v=o.child,o.child=null;v!==null;){if(i=v.alternate,i!==null&&f1(i)===null){o.child=v;break}i=v.sibling,v.sibling=c,c=v,v=i}aS(o,!0,c,null,E);break;case"together":aS(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function V0(i,o){!(o.mode&1)&&i!==null&&(i.alternate=null,o.alternate=null,o.flags|=2)}function Kc(i,o,c){if(i!==null&&(o.dependencies=i.dependencies),Yh|=o.lanes,!(c&o.childLanes))return null;if(i!==null&&o.child!==i.child)throw Error(oi(153));if(o.child!==null){for(i=o.child,c=wd(i,i.pendingProps),o.child=c,c.return=o;i.sibling!==null;)i=i.sibling,c=c.sibling=wd(i,i.pendingProps),c.return=o;c.sibling=null}return o.child}function wU(i,o,c){switch(o.tag){case 3:pL(o),hm();break;case 5:UN(o);break;case 1:ca(o.type)&&a1(o);break;case 4:PE(o,o.stateNode.containerInfo);break;case 10:var m=o.type._context,v=o.memoizedProps.value;Wr(u1,m._currentValue),m._currentValue=v;break;case 13:if(m=o.memoizedState,m!==null)return m.dehydrated!==null?(Wr(rs,rs.current&1),o.flags|=128,null):c&o.child.childLanes?mL(i,o,c):(Wr(rs,rs.current&1),i=Kc(i,o,c),i!==null?i.sibling:null);Wr(rs,rs.current&1);break;case 19:if(m=(c&o.childLanes)!==0,i.flags&128){if(m)return gL(i,o,c);o.flags|=128}if(v=o.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),Wr(rs,rs.current),m)break;return null;case 22:case 23:return o.lanes=0,hL(i,o,c)}return Kc(i,o,c)}var _L,pT,yL,xL;_L=function(i,o){for(var c=o.child;c!==null;){if(c.tag===5||c.tag===6)i.appendChild(c.stateNode);else if(c.tag!==4&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===o)break;for(;c.sibling===null;){if(c.return===null||c.return===o)return;c=c.return}c.sibling.return=c.return,c=c.sibling}};pT=function(){};yL=function(i,o,c,m){var v=i.memoizedProps;if(v!==m){i=o.stateNode,Bh(uc.current);var E=null;switch(c){case"input":v=zS(i,v),m=zS(i,m),E=[];break;case"select":v=os({},v,{value:void 0}),m=os({},m,{value:void 0}),E=[];break;case"textarea":v=jS(i,v),m=jS(i,m),E=[];break;default:typeof v.onClick!="function"&&typeof m.onClick=="function"&&(i.onclick=s1)}VS(c,m);var I;c=null;for(j in v)if(!m.hasOwnProperty(j)&&v.hasOwnProperty(j)&&v[j]!=null)if(j==="style"){var s=v[j];for(I in s)s.hasOwnProperty(I)&&(c||(c={}),c[I]="")}else j!=="dangerouslySetInnerHTML"&&j!=="children"&&j!=="suppressContentEditableWarning"&&j!=="suppressHydrationWarning"&&j!=="autoFocus"&&(uy.hasOwnProperty(j)?E||(E=[]):(E=E||[]).push(j,null));for(j in m){var O=m[j];if(s=v!=null?v[j]:void 0,m.hasOwnProperty(j)&&O!==s&&(O!=null||s!=null))if(j==="style")if(s){for(I in s)!s.hasOwnProperty(I)||O&&O.hasOwnProperty(I)||(c||(c={}),c[I]="");for(I in O)O.hasOwnProperty(I)&&s[I]!==O[I]&&(c||(c={}),c[I]=O[I])}else c||(E||(E=[]),E.push(j,c)),c=O;else j==="dangerouslySetInnerHTML"?(O=O?O.__html:void 0,s=s?s.__html:void 0,O!=null&&s!==O&&(E=E||[]).push(j,O)):j==="children"?typeof O!="string"&&typeof O!="number"||(E=E||[]).push(j,""+O):j!=="suppressContentEditableWarning"&&j!=="suppressHydrationWarning"&&(uy.hasOwnProperty(j)?(O!=null&&j==="onScroll"&&Jr("scroll",i),E||s===O||(E=[])):(E=E||[]).push(j,O))}c&&(E=E||[]).push("style",c);var j=E;(o.updateQueue=j)&&(o.flags|=4)}};xL=function(i,o,c,m){c!==m&&(o.flags|=4)};function F_(i,o){if(!is)switch(i.tailMode){case"hidden":o=i.tail;for(var c=null;o!==null;)o.alternate!==null&&(c=o),o=o.sibling;c===null?i.tail=null:c.sibling=null;break;case"collapsed":c=i.tail;for(var m=null;c!==null;)c.alternate!==null&&(m=c),c=c.sibling;m===null?o||i.tail===null?i.tail=null:i.tail.sibling=null:m.sibling=null}}function Eo(i){var o=i.alternate!==null&&i.alternate.child===i.child,c=0,m=0;if(o)for(var v=i.child;v!==null;)c|=v.lanes|v.childLanes,m|=v.subtreeFlags&14680064,m|=v.flags&14680064,v.return=i,v=v.sibling;else for(v=i.child;v!==null;)c|=v.lanes|v.childLanes,m|=v.subtreeFlags,m|=v.flags,v.return=i,v=v.sibling;return i.subtreeFlags|=m,i.childLanes=c,o}function bU(i,o,c){var m=o.pendingProps;switch(bE(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Eo(o),null;case 1:return ca(o.type)&&o1(),Eo(o),null;case 3:return m=o.stateNode,pm(),Qr(la),Qr(Io),RE(),m.pendingContext&&(m.context=m.pendingContext,m.pendingContext=null),(i===null||i.child===null)&&(g0(o)?o.flags|=4:i===null||i.memoizedState.isDehydrated&&!(o.flags&256)||(o.flags|=1024,pl!==null&&(bT(pl),pl=null))),pT(i,o),Eo(o),null;case 5:ME(o);var v=Bh(by.current);if(c=o.type,i!==null&&o.stateNode!=null)yL(i,o,c,m,v),i.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!m){if(o.stateNode===null)throw Error(oi(166));return Eo(o),null}if(i=Bh(uc.current),g0(o)){m=o.stateNode,c=o.type;var E=o.memoizedProps;switch(m[sc]=o,m[vy]=E,i=(o.mode&1)!==0,c){case"dialog":Jr("cancel",m),Jr("close",m);break;case"iframe":case"object":case"embed":Jr("load",m);break;case"video":case"audio":for(v=0;v<W_.length;v++)Jr(W_[v],m);break;case"source":Jr("error",m);break;case"img":case"image":case"link":Jr("error",m),Jr("load",m);break;case"details":Jr("toggle",m);break;case"input":JM(m,E),Jr("invalid",m);break;case"select":m._wrapperState={wasMultiple:!!E.multiple},Jr("invalid",m);break;case"textarea":eR(m,E),Jr("invalid",m)}VS(c,E),v=null;for(var I in E)if(E.hasOwnProperty(I)){var s=E[I];I==="children"?typeof s=="string"?m.textContent!==s&&(E.suppressHydrationWarning!==!0&&m0(m.textContent,s,i),v=["children",s]):typeof s=="number"&&m.textContent!==""+s&&(E.suppressHydrationWarning!==!0&&m0(m.textContent,s,i),v=["children",""+s]):uy.hasOwnProperty(I)&&s!=null&&I==="onScroll"&&Jr("scroll",m)}switch(c){case"input":a0(m),QM(m,E,!0);break;case"textarea":a0(m),tR(m);break;case"select":case"option":break;default:typeof E.onClick=="function"&&(m.onclick=s1)}m=v,o.updateQueue=m,m!==null&&(o.flags|=4)}else{I=v.nodeType===9?v:v.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=Wk(c)),i==="http://www.w3.org/1999/xhtml"?c==="script"?(i=I.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof m.is=="string"?i=I.createElement(c,{is:m.is}):(i=I.createElement(c),c==="select"&&(I=i,m.multiple?I.multiple=!0:m.size&&(I.size=m.size))):i=I.createElementNS(i,c),i[sc]=o,i[vy]=m,_L(i,o,!1,!1),o.stateNode=i;e:{switch(I=US(c,m),c){case"dialog":Jr("cancel",i),Jr("close",i),v=m;break;case"iframe":case"object":case"embed":Jr("load",i),v=m;break;case"video":case"audio":for(v=0;v<W_.length;v++)Jr(W_[v],i);v=m;break;case"source":Jr("error",i),v=m;break;case"img":case"image":case"link":Jr("error",i),Jr("load",i),v=m;break;case"details":Jr("toggle",i),v=m;break;case"input":JM(i,m),v=zS(i,m),Jr("invalid",i);break;case"option":v=m;break;case"select":i._wrapperState={wasMultiple:!!m.multiple},v=os({},m,{value:void 0}),Jr("invalid",i);break;case"textarea":eR(i,m),v=jS(i,m),Jr("invalid",i);break;default:v=m}VS(c,v),s=v;for(E in s)if(s.hasOwnProperty(E)){var O=s[E];E==="style"?Kk(i,O):E==="dangerouslySetInnerHTML"?(O=O?O.__html:void 0,O!=null&&Zk(i,O)):E==="children"?typeof O=="string"?(c!=="textarea"||O!=="")&&dy(i,O):typeof O=="number"&&dy(i,""+O):E!=="suppressContentEditableWarning"&&E!=="suppressHydrationWarning"&&E!=="autoFocus"&&(uy.hasOwnProperty(E)?O!=null&&E==="onScroll"&&Jr("scroll",i):O!=null&&aE(i,E,O,I))}switch(c){case"input":a0(i),QM(i,m,!1);break;case"textarea":a0(i),tR(i);break;case"option":m.value!=null&&i.setAttribute("value",""+Td(m.value));break;case"select":i.multiple=!!m.multiple,E=m.value,E!=null?qp(i,!!m.multiple,E,!1):m.defaultValue!=null&&qp(i,!!m.multiple,m.defaultValue,!0);break;default:typeof v.onClick=="function"&&(i.onclick=s1)}switch(c){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}}m&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return Eo(o),null;case 6:if(i&&o.stateNode!=null)xL(i,o,i.memoizedProps,m);else{if(typeof m!="string"&&o.stateNode===null)throw Error(oi(166));if(c=Bh(by.current),Bh(uc.current),g0(o)){if(m=o.stateNode,c=o.memoizedProps,m[sc]=o,(E=m.nodeValue!==c)&&(i=Ea,i!==null))switch(i.tag){case 3:m0(m.nodeValue,c,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&m0(m.nodeValue,c,(i.mode&1)!==0)}E&&(o.flags|=4)}else m=(c.nodeType===9?c:c.ownerDocument).createTextNode(m),m[sc]=o,o.stateNode=m}return Eo(o),null;case 13:if(Qr(rs),m=o.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(is&&Ta!==null&&o.mode&1&&!(o.flags&128))ON(),hm(),o.flags|=98560,E=!1;else if(E=g0(o),m!==null&&m.dehydrated!==null){if(i===null){if(!E)throw Error(oi(318));if(E=o.memoizedState,E=E!==null?E.dehydrated:null,!E)throw Error(oi(317));E[sc]=o}else hm(),!(o.flags&128)&&(o.memoizedState=null),o.flags|=4;Eo(o),E=!1}else pl!==null&&(bT(pl),pl=null),E=!0;if(!E)return o.flags&65536?o:null}return o.flags&128?(o.lanes=c,o):(m=m!==null,m!==(i!==null&&i.memoizedState!==null)&&m&&(o.child.flags|=8192,o.mode&1&&(i===null||rs.current&1?Gs===0&&(Gs=3):GE())),o.updateQueue!==null&&(o.flags|=4),Eo(o),null);case 4:return pm(),pT(i,o),i===null&&yy(o.stateNode.containerInfo),Eo(o),null;case 10:return CE(o.type._context),Eo(o),null;case 17:return ca(o.type)&&o1(),Eo(o),null;case 19:if(Qr(rs),E=o.memoizedState,E===null)return Eo(o),null;if(m=(o.flags&128)!==0,I=E.rendering,I===null)if(m)F_(E,!1);else{if(Gs!==0||i!==null&&i.flags&128)for(i=o.child;i!==null;){if(I=f1(i),I!==null){for(o.flags|=128,F_(E,!1),m=I.updateQueue,m!==null&&(o.updateQueue=m,o.flags|=4),o.subtreeFlags=0,m=c,c=o.child;c!==null;)E=c,i=m,E.flags&=14680066,I=E.alternate,I===null?(E.childLanes=0,E.lanes=i,E.child=null,E.subtreeFlags=0,E.memoizedProps=null,E.memoizedState=null,E.updateQueue=null,E.dependencies=null,E.stateNode=null):(E.childLanes=I.childLanes,E.lanes=I.lanes,E.child=I.child,E.subtreeFlags=0,E.deletions=null,E.memoizedProps=I.memoizedProps,E.memoizedState=I.memoizedState,E.updateQueue=I.updateQueue,E.type=I.type,i=I.dependencies,E.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),c=c.sibling;return Wr(rs,rs.current&1|2),o.child}i=i.sibling}E.tail!==null&&xs()>gm&&(o.flags|=128,m=!0,F_(E,!1),o.lanes=4194304)}else{if(!m)if(i=f1(I),i!==null){if(o.flags|=128,m=!0,c=i.updateQueue,c!==null&&(o.updateQueue=c,o.flags|=4),F_(E,!0),E.tail===null&&E.tailMode==="hidden"&&!I.alternate&&!is)return Eo(o),null}else 2*xs()-E.renderingStartTime>gm&&c!==1073741824&&(o.flags|=128,m=!0,F_(E,!1),o.lanes=4194304);E.isBackwards?(I.sibling=o.child,o.child=I):(c=E.last,c!==null?c.sibling=I:o.child=I,E.last=I)}return E.tail!==null?(o=E.tail,E.rendering=o,E.tail=o.sibling,E.renderingStartTime=xs(),o.sibling=null,c=rs.current,Wr(rs,m?c&1|2:c&1),o):(Eo(o),null);case 22:case 23:return UE(),m=o.memoizedState!==null,i!==null&&i.memoizedState!==null!==m&&(o.flags|=8192),m&&o.mode&1?wa&1073741824&&(Eo(o),o.subtreeFlags&6&&(o.flags|=8192)):Eo(o),null;case 24:return null;case 25:return null}throw Error(oi(156,o.tag))}function SU(i,o){switch(bE(o),o.tag){case 1:return ca(o.type)&&o1(),i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 3:return pm(),Qr(la),Qr(Io),RE(),i=o.flags,i&65536&&!(i&128)?(o.flags=i&-65537|128,o):null;case 5:return ME(o),null;case 13:if(Qr(rs),i=o.memoizedState,i!==null&&i.dehydrated!==null){if(o.alternate===null)throw Error(oi(340));hm()}return i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 19:return Qr(rs),null;case 4:return pm(),null;case 10:return CE(o.type._context),null;case 22:case 23:return UE(),null;case 24:return null;default:return null}}var x0=!1,Ao=!1,TU=typeof WeakSet=="function"?WeakSet:Set,Oi=null;function $p(i,o){var c=i.ref;if(c!==null)if(typeof c=="function")try{c(null)}catch(m){ms(i,o,m)}else c.current=null}function mT(i,o,c){try{c()}catch(m){ms(i,o,m)}}var $R=!1;function EU(i,o){if(JS=i1,i=TN(),vE(i)){if("selectionStart"in i)var c={start:i.selectionStart,end:i.selectionEnd};else e:{c=(c=i.ownerDocument)&&c.defaultView||window;var m=c.getSelection&&c.getSelection();if(m&&m.rangeCount!==0){c=m.anchorNode;var v=m.anchorOffset,E=m.focusNode;m=m.focusOffset;try{c.nodeType,E.nodeType}catch{c=null;break e}var I=0,s=-1,O=-1,j=0,G=0,W=i,B=null;t:for(;;){for(var te;W!==c||v!==0&&W.nodeType!==3||(s=I+v),W!==E||m!==0&&W.nodeType!==3||(O=I+m),W.nodeType===3&&(I+=W.nodeValue.length),(te=W.firstChild)!==null;)B=W,W=te;for(;;){if(W===i)break t;if(B===c&&++j===v&&(s=I),B===E&&++G===m&&(O=I),(te=W.nextSibling)!==null)break;W=B,B=W.parentNode}W=te}c=s===-1||O===-1?null:{start:s,end:O}}else c=null}c=c||{start:0,end:0}}else c=null;for(QS={focusedElem:i,selectionRange:c},i1=!1,Oi=o;Oi!==null;)if(o=Oi,i=o.child,(o.subtreeFlags&1028)!==0&&i!==null)i.return=o,Oi=i;else for(;Oi!==null;){o=Oi;try{var ue=o.alternate;if(o.flags&1024)switch(o.tag){case 0:case 11:case 15:break;case 1:if(ue!==null){var J=ue.memoizedProps,ce=ue.memoizedState,oe=o.stateNode,ee=oe.getSnapshotBeforeUpdate(o.elementType===o.type?J:ul(o.type,J),ce);oe.__reactInternalSnapshotBeforeUpdate=ee}break;case 3:var Q=o.stateNode.containerInfo;Q.nodeType===1?Q.textContent="":Q.nodeType===9&&Q.documentElement&&Q.removeChild(Q.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(oi(163))}}catch(Ie){ms(o,o.return,Ie)}if(i=o.sibling,i!==null){i.return=o.return,Oi=i;break}Oi=o.return}return ue=$R,$R=!1,ue}function ry(i,o,c){var m=o.updateQueue;if(m=m!==null?m.lastEffect:null,m!==null){var v=m=m.next;do{if((v.tag&i)===i){var E=v.destroy;v.destroy=void 0,E!==void 0&&mT(o,c,E)}v=v.next}while(v!==m)}}function Z1(i,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var c=o=o.next;do{if((c.tag&i)===i){var m=c.create;c.destroy=m()}c=c.next}while(c!==o)}}function gT(i){var o=i.ref;if(o!==null){var c=i.stateNode;switch(i.tag){case 5:i=c;break;default:i=c}typeof o=="function"?o(i):o.current=i}}function vL(i){var o=i.alternate;o!==null&&(i.alternate=null,vL(o)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(o=i.stateNode,o!==null&&(delete o[sc],delete o[vy],delete o[iT],delete o[aU],delete o[lU])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function wL(i){return i.tag===5||i.tag===3||i.tag===4}function HR(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||wL(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function _T(i,o,c){var m=i.tag;if(m===5||m===6)i=i.stateNode,o?c.nodeType===8?c.parentNode.insertBefore(i,o):c.insertBefore(i,o):(c.nodeType===8?(o=c.parentNode,o.insertBefore(i,c)):(o=c,o.appendChild(i)),c=c._reactRootContainer,c!=null||o.onclick!==null||(o.onclick=s1));else if(m!==4&&(i=i.child,i!==null))for(_T(i,o,c),i=i.sibling;i!==null;)_T(i,o,c),i=i.sibling}function yT(i,o,c){var m=i.tag;if(m===5||m===6)i=i.stateNode,o?c.insertBefore(i,o):c.appendChild(i);else if(m!==4&&(i=i.child,i!==null))for(yT(i,o,c),i=i.sibling;i!==null;)yT(i,o,c),i=i.sibling}var uo=null,fl=!1;function Xu(i,o,c){for(c=c.child;c!==null;)bL(i,o,c),c=c.sibling}function bL(i,o,c){if(cc&&typeof cc.onCommitFiberUnmount=="function")try{cc.onCommitFiberUnmount(B1,c)}catch{}switch(c.tag){case 5:Ao||$p(c,o);case 6:var m=uo,v=fl;uo=null,Xu(i,o,c),uo=m,fl=v,uo!==null&&(fl?(i=uo,c=c.stateNode,i.nodeType===8?i.parentNode.removeChild(c):i.removeChild(c)):uo.removeChild(c.stateNode));break;case 18:uo!==null&&(fl?(i=uo,c=c.stateNode,i.nodeType===8?eS(i.parentNode,c):i.nodeType===1&&eS(i,c),my(i)):eS(uo,c.stateNode));break;case 4:m=uo,v=fl,uo=c.stateNode.containerInfo,fl=!0,Xu(i,o,c),uo=m,fl=v;break;case 0:case 11:case 14:case 15:if(!Ao&&(m=c.updateQueue,m!==null&&(m=m.lastEffect,m!==null))){v=m=m.next;do{var E=v,I=E.destroy;E=E.tag,I!==void 0&&(E&2||E&4)&&mT(c,o,I),v=v.next}while(v!==m)}Xu(i,o,c);break;case 1:if(!Ao&&($p(c,o),m=c.stateNode,typeof m.componentWillUnmount=="function"))try{m.props=c.memoizedProps,m.state=c.memoizedState,m.componentWillUnmount()}catch(s){ms(c,o,s)}Xu(i,o,c);break;case 21:Xu(i,o,c);break;case 22:c.mode&1?(Ao=(m=Ao)||c.memoizedState!==null,Xu(i,o,c),Ao=m):Xu(i,o,c);break;default:Xu(i,o,c)}}function qR(i){var o=i.updateQueue;if(o!==null){i.updateQueue=null;var c=i.stateNode;c===null&&(c=i.stateNode=new TU),o.forEach(function(m){var v=NU.bind(null,i,m);c.has(m)||(c.add(m),m.then(v,v))})}}function ll(i,o){var c=o.deletions;if(c!==null)for(var m=0;m<c.length;m++){var v=c[m];try{var E=i,I=o,s=I;e:for(;s!==null;){switch(s.tag){case 5:uo=s.stateNode,fl=!1;break e;case 3:uo=s.stateNode.containerInfo,fl=!0;break e;case 4:uo=s.stateNode.containerInfo,fl=!0;break e}s=s.return}if(uo===null)throw Error(oi(160));bL(E,I,v),uo=null,fl=!1;var O=v.alternate;O!==null&&(O.return=null),v.return=null}catch(j){ms(v,o,j)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)SL(o,i),o=o.sibling}function SL(i,o){var c=i.alternate,m=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(ll(o,i),ec(i),m&4){try{ry(3,i,i.return),Z1(3,i)}catch(J){ms(i,i.return,J)}try{ry(5,i,i.return)}catch(J){ms(i,i.return,J)}}break;case 1:ll(o,i),ec(i),m&512&&c!==null&&$p(c,c.return);break;case 5:if(ll(o,i),ec(i),m&512&&c!==null&&$p(c,c.return),i.flags&32){var v=i.stateNode;try{dy(v,"")}catch(J){ms(i,i.return,J)}}if(m&4&&(v=i.stateNode,v!=null)){var E=i.memoizedProps,I=c!==null?c.memoizedProps:E,s=i.type,O=i.updateQueue;if(i.updateQueue=null,O!==null)try{s==="input"&&E.type==="radio"&&E.name!=null&&Hk(v,E),US(s,I);var j=US(s,E);for(I=0;I<O.length;I+=2){var G=O[I],W=O[I+1];G==="style"?Kk(v,W):G==="dangerouslySetInnerHTML"?Zk(v,W):G==="children"?dy(v,W):aE(v,G,W,j)}switch(s){case"input":OS(v,E);break;case"textarea":qk(v,E);break;case"select":var B=v._wrapperState.wasMultiple;v._wrapperState.wasMultiple=!!E.multiple;var te=E.value;te!=null?qp(v,!!E.multiple,te,!1):B!==!!E.multiple&&(E.defaultValue!=null?qp(v,!!E.multiple,E.defaultValue,!0):qp(v,!!E.multiple,E.multiple?[]:"",!1))}v[vy]=E}catch(J){ms(i,i.return,J)}}break;case 6:if(ll(o,i),ec(i),m&4){if(i.stateNode===null)throw Error(oi(162));v=i.stateNode,E=i.memoizedProps;try{v.nodeValue=E}catch(J){ms(i,i.return,J)}}break;case 3:if(ll(o,i),ec(i),m&4&&c!==null&&c.memoizedState.isDehydrated)try{my(o.containerInfo)}catch(J){ms(i,i.return,J)}break;case 4:ll(o,i),ec(i);break;case 13:ll(o,i),ec(i),v=i.child,v.flags&8192&&(E=v.memoizedState!==null,v.stateNode.isHidden=E,!E||v.alternate!==null&&v.alternate.memoizedState!==null||(BE=xs())),m&4&&qR(i);break;case 22:if(G=c!==null&&c.memoizedState!==null,i.mode&1?(Ao=(j=Ao)||G,ll(o,i),Ao=j):ll(o,i),ec(i),m&8192){if(j=i.memoizedState!==null,(i.stateNode.isHidden=j)&&!G&&i.mode&1)for(Oi=i,G=i.child;G!==null;){for(W=Oi=G;Oi!==null;){switch(B=Oi,te=B.child,B.tag){case 0:case 11:case 14:case 15:ry(4,B,B.return);break;case 1:$p(B,B.return);var ue=B.stateNode;if(typeof ue.componentWillUnmount=="function"){m=B,c=B.return;try{o=m,ue.props=o.memoizedProps,ue.state=o.memoizedState,ue.componentWillUnmount()}catch(J){ms(m,c,J)}}break;case 5:$p(B,B.return);break;case 22:if(B.memoizedState!==null){ZR(W);continue}}te!==null?(te.return=B,Oi=te):ZR(W)}G=G.sibling}e:for(G=null,W=i;;){if(W.tag===5){if(G===null){G=W;try{v=W.stateNode,j?(E=v.style,typeof E.setProperty=="function"?E.setProperty("display","none","important"):E.display="none"):(s=W.stateNode,O=W.memoizedProps.style,I=O!=null&&O.hasOwnProperty("display")?O.display:null,s.style.display=Xk("display",I))}catch(J){ms(i,i.return,J)}}}else if(W.tag===6){if(G===null)try{W.stateNode.nodeValue=j?"":W.memoizedProps}catch(J){ms(i,i.return,J)}}else if((W.tag!==22&&W.tag!==23||W.memoizedState===null||W===i)&&W.child!==null){W.child.return=W,W=W.child;continue}if(W===i)break e;for(;W.sibling===null;){if(W.return===null||W.return===i)break e;G===W&&(G=null),W=W.return}G===W&&(G=null),W.sibling.return=W.return,W=W.sibling}}break;case 19:ll(o,i),ec(i),m&4&&qR(i);break;case 21:break;default:ll(o,i),ec(i)}}function ec(i){var o=i.flags;if(o&2){try{e:{for(var c=i.return;c!==null;){if(wL(c)){var m=c;break e}c=c.return}throw Error(oi(160))}switch(m.tag){case 5:var v=m.stateNode;m.flags&32&&(dy(v,""),m.flags&=-33);var E=HR(i);yT(i,E,v);break;case 3:case 4:var I=m.stateNode.containerInfo,s=HR(i);_T(i,s,I);break;default:throw Error(oi(161))}}catch(O){ms(i,i.return,O)}i.flags&=-3}o&4096&&(i.flags&=-4097)}function CU(i,o,c){Oi=i,TL(i)}function TL(i,o,c){for(var m=(i.mode&1)!==0;Oi!==null;){var v=Oi,E=v.child;if(v.tag===22&&m){var I=v.memoizedState!==null||x0;if(!I){var s=v.alternate,O=s!==null&&s.memoizedState!==null||Ao;s=x0;var j=Ao;if(x0=I,(Ao=O)&&!j)for(Oi=v;Oi!==null;)I=Oi,O=I.child,I.tag===22&&I.memoizedState!==null?XR(v):O!==null?(O.return=I,Oi=O):XR(v);for(;E!==null;)Oi=E,TL(E),E=E.sibling;Oi=v,x0=s,Ao=j}WR(i)}else v.subtreeFlags&8772&&E!==null?(E.return=v,Oi=E):WR(i)}}function WR(i){for(;Oi!==null;){var o=Oi;if(o.flags&8772){var c=o.alternate;try{if(o.flags&8772)switch(o.tag){case 0:case 11:case 15:Ao||Z1(5,o);break;case 1:var m=o.stateNode;if(o.flags&4&&!Ao)if(c===null)m.componentDidMount();else{var v=o.elementType===o.type?c.memoizedProps:ul(o.type,c.memoizedProps);m.componentDidUpdate(v,c.memoizedState,m.__reactInternalSnapshotBeforeUpdate)}var E=o.updateQueue;E!==null&&RR(o,E,m);break;case 3:var I=o.updateQueue;if(I!==null){if(c=null,o.child!==null)switch(o.child.tag){case 5:c=o.child.stateNode;break;case 1:c=o.child.stateNode}RR(o,I,c)}break;case 5:var s=o.stateNode;if(c===null&&o.flags&4){c=s;var O=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":O.autoFocus&&c.focus();break;case"img":O.src&&(c.src=O.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var j=o.alternate;if(j!==null){var G=j.memoizedState;if(G!==null){var W=G.dehydrated;W!==null&&my(W)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(oi(163))}Ao||o.flags&512&&gT(o)}catch(B){ms(o,o.return,B)}}if(o===i){Oi=null;break}if(c=o.sibling,c!==null){c.return=o.return,Oi=c;break}Oi=o.return}}function ZR(i){for(;Oi!==null;){var o=Oi;if(o===i){Oi=null;break}var c=o.sibling;if(c!==null){c.return=o.return,Oi=c;break}Oi=o.return}}function XR(i){for(;Oi!==null;){var o=Oi;try{switch(o.tag){case 0:case 11:case 15:var c=o.return;try{Z1(4,o)}catch(O){ms(o,c,O)}break;case 1:var m=o.stateNode;if(typeof m.componentDidMount=="function"){var v=o.return;try{m.componentDidMount()}catch(O){ms(o,v,O)}}var E=o.return;try{gT(o)}catch(O){ms(o,E,O)}break;case 5:var I=o.return;try{gT(o)}catch(O){ms(o,I,O)}}}catch(O){ms(o,o.return,O)}if(o===i){Oi=null;break}var s=o.sibling;if(s!==null){s.return=o.return,Oi=s;break}Oi=o.return}}var AU=Math.ceil,g1=tu.ReactCurrentDispatcher,FE=tu.ReactCurrentOwner,qa=tu.ReactCurrentBatchConfig,mr=0,eo=null,ks=null,ho=0,wa=0,Hp=Rd(0),Gs=0,Cy=null,Yh=0,X1=0,jE=0,sy=null,oa=null,BE=0,gm=1/0,Bc=null,_1=!1,xT=null,xd=null,v0=!1,hd=null,y1=0,oy=0,vT=null,U0=-1,G0=0;function Wo(){return mr&6?xs():U0!==-1?U0:U0=xs()}function vd(i){return i.mode&1?mr&2&&ho!==0?ho&-ho:uU.transition!==null?(G0===0&&(G0=lN()),G0):(i=Lr,i!==0||(i=window.event,i=i===void 0?16:mN(i.type)),i):1}function xl(i,o,c,m){if(50<oy)throw oy=0,vT=null,Error(oi(185));jy(i,c,m),(!(mr&2)||i!==eo)&&(i===eo&&(!(mr&2)&&(X1|=c),Gs===4&&rd(i,ho)),ua(i,m),c===1&&mr===0&&!(o.mode&1)&&(gm=xs()+500,H1&&Dd()))}function ua(i,o){var c=i.callbackNode;u6(i,o);var m=t1(i,i===eo?ho:0);if(m===0)c!==null&&rR(c),i.callbackNode=null,i.callbackPriority=0;else if(o=m&-m,i.callbackPriority!==o){if(c!=null&&rR(c),o===1)i.tag===0?cU(KR.bind(null,i)):NN(KR.bind(null,i)),sU(function(){!(mr&6)&&Dd()}),c=null;else{switch(cN(m)){case 1:c=hE;break;case 4:c=oN;break;case 16:c=e1;break;case 536870912:c=aN;break;default:c=e1}c=DL(c,EL.bind(null,i))}i.callbackPriority=o,i.callbackNode=c}}function EL(i,o){if(U0=-1,G0=0,mr&6)throw Error(oi(327));var c=i.callbackNode;if(Yp()&&i.callbackNode!==c)return null;var m=t1(i,i===eo?ho:0);if(m===0)return null;if(m&30||m&i.expiredLanes||o)o=x1(i,m);else{o=m;var v=mr;mr|=2;var E=AL();(eo!==i||ho!==o)&&(Bc=null,gm=xs()+500,qh(i,o));do try{MU();break}catch(s){CL(i,s)}while(!0);EE(),g1.current=E,mr=v,ks!==null?o=0:(eo=null,ho=0,o=Gs)}if(o!==0){if(o===2&&(v=WS(i),v!==0&&(m=v,o=wT(i,v))),o===1)throw c=Cy,qh(i,0),rd(i,m),ua(i,xs()),c;if(o===6)rd(i,m);else{if(v=i.current.alternate,!(m&30)&&!IU(v)&&(o=x1(i,m),o===2&&(E=WS(i),E!==0&&(m=E,o=wT(i,E))),o===1))throw c=Cy,qh(i,0),rd(i,m),ua(i,xs()),c;switch(i.finishedWork=v,i.finishedLanes=m,o){case 0:case 1:throw Error(oi(345));case 2:Oh(i,oa,Bc);break;case 3:if(rd(i,m),(m&130023424)===m&&(o=BE+500-xs(),10<o)){if(t1(i,0)!==0)break;if(v=i.suspendedLanes,(v&m)!==m){Wo(),i.pingedLanes|=i.suspendedLanes&v;break}i.timeoutHandle=tT(Oh.bind(null,i,oa,Bc),o);break}Oh(i,oa,Bc);break;case 4:if(rd(i,m),(m&4194240)===m)break;for(o=i.eventTimes,v=-1;0<m;){var I=31-yl(m);E=1<<I,I=o[I],I>v&&(v=I),m&=~E}if(m=v,m=xs()-m,m=(120>m?120:480>m?480:1080>m?1080:1920>m?1920:3e3>m?3e3:4320>m?4320:1960*AU(m/1960))-m,10<m){i.timeoutHandle=tT(Oh.bind(null,i,oa,Bc),m);break}Oh(i,oa,Bc);break;case 5:Oh(i,oa,Bc);break;default:throw Error(oi(329))}}}return ua(i,xs()),i.callbackNode===c?EL.bind(null,i):null}function wT(i,o){var c=sy;return i.current.memoizedState.isDehydrated&&(qh(i,o).flags|=256),i=x1(i,o),i!==2&&(o=oa,oa=c,o!==null&&bT(o)),i}function bT(i){oa===null?oa=i:oa.push.apply(oa,i)}function IU(i){for(var o=i;;){if(o.flags&16384){var c=o.updateQueue;if(c!==null&&(c=c.stores,c!==null))for(var m=0;m<c.length;m++){var v=c[m],E=v.getSnapshot;v=v.value;try{if(!wl(E(),v))return!1}catch{return!1}}}if(c=o.child,o.subtreeFlags&16384&&c!==null)c.return=o,o=c;else{if(o===i)break;for(;o.sibling===null;){if(o.return===null||o.return===i)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function rd(i,o){for(o&=~jE,o&=~X1,i.suspendedLanes|=o,i.pingedLanes&=~o,i=i.expirationTimes;0<o;){var c=31-yl(o),m=1<<c;i[c]=-1,o&=~m}}function KR(i){if(mr&6)throw Error(oi(327));Yp();var o=t1(i,0);if(!(o&1))return ua(i,xs()),null;var c=x1(i,o);if(i.tag!==0&&c===2){var m=WS(i);m!==0&&(o=m,c=wT(i,m))}if(c===1)throw c=Cy,qh(i,0),rd(i,o),ua(i,xs()),c;if(c===6)throw Error(oi(345));return i.finishedWork=i.current.alternate,i.finishedLanes=o,Oh(i,oa,Bc),ua(i,xs()),null}function VE(i,o){var c=mr;mr|=1;try{return i(o)}finally{mr=c,mr===0&&(gm=xs()+500,H1&&Dd())}}function Jh(i){hd!==null&&hd.tag===0&&!(mr&6)&&Yp();var o=mr;mr|=1;var c=qa.transition,m=Lr;try{if(qa.transition=null,Lr=1,i)return i()}finally{Lr=m,qa.transition=c,mr=o,!(mr&6)&&Dd()}}function UE(){wa=Hp.current,Qr(Hp)}function qh(i,o){i.finishedWork=null,i.finishedLanes=0;var c=i.timeoutHandle;if(c!==-1&&(i.timeoutHandle=-1,rU(c)),ks!==null)for(c=ks.return;c!==null;){var m=c;switch(bE(m),m.tag){case 1:m=m.type.childContextTypes,m!=null&&o1();break;case 3:pm(),Qr(la),Qr(Io),RE();break;case 5:ME(m);break;case 4:pm();break;case 13:Qr(rs);break;case 19:Qr(rs);break;case 10:CE(m.type._context);break;case 22:case 23:UE()}c=c.return}if(eo=i,ks=i=wd(i.current,null),ho=wa=o,Gs=0,Cy=null,jE=X1=Yh=0,oa=sy=null,jh!==null){for(o=0;o<jh.length;o++)if(c=jh[o],m=c.interleaved,m!==null){c.interleaved=null;var v=m.next,E=c.pending;if(E!==null){var I=E.next;E.next=v,m.next=I}c.pending=m}jh=null}return i}function CL(i,o){do{var c=ks;try{if(EE(),j0.current=m1,p1){for(var m=ss.memoizedState;m!==null;){var v=m.queue;v!==null&&(v.pending=null),m=m.next}p1=!1}if(Kh=0,Ys=Vs=ss=null,ny=!1,Sy=0,FE.current=null,c===null||c.return===null){Gs=1,Cy=o,ks=null;break}e:{var E=i,I=c.return,s=c,O=o;if(o=ho,s.flags|=32768,O!==null&&typeof O=="object"&&typeof O.then=="function"){var j=O,G=s,W=G.tag;if(!(G.mode&1)&&(W===0||W===11||W===15)){var B=G.alternate;B?(G.updateQueue=B.updateQueue,G.memoizedState=B.memoizedState,G.lanes=B.lanes):(G.updateQueue=null,G.memoizedState=null)}var te=OR(I);if(te!==null){te.flags&=-257,FR(te,I,s,E,o),te.mode&1&&zR(E,j,o),o=te,O=j;var ue=o.updateQueue;if(ue===null){var J=new Set;J.add(O),o.updateQueue=J}else ue.add(O);break e}else{if(!(o&1)){zR(E,j,o),GE();break e}O=Error(oi(426))}}else if(is&&s.mode&1){var ce=OR(I);if(ce!==null){!(ce.flags&65536)&&(ce.flags|=256),FR(ce,I,s,E,o),SE(mm(O,s));break e}}E=O=mm(O,s),Gs!==4&&(Gs=2),sy===null?sy=[E]:sy.push(E),E=I;do{switch(E.tag){case 3:E.flags|=65536,o&=-o,E.lanes|=o;var oe=cL(E,O,o);MR(E,oe);break e;case 1:s=O;var ee=E.type,Q=E.stateNode;if(!(E.flags&128)&&(typeof ee.getDerivedStateFromError=="function"||Q!==null&&typeof Q.componentDidCatch=="function"&&(xd===null||!xd.has(Q)))){E.flags|=65536,o&=-o,E.lanes|=o;var Ie=uL(E,s,o);MR(E,Ie);break e}}E=E.return}while(E!==null)}PL(c)}catch(pe){o=pe,ks===c&&c!==null&&(ks=c=c.return);continue}break}while(!0)}function AL(){var i=g1.current;return g1.current=m1,i===null?m1:i}function GE(){(Gs===0||Gs===3||Gs===2)&&(Gs=4),eo===null||!(Yh&268435455)&&!(X1&268435455)||rd(eo,ho)}function x1(i,o){var c=mr;mr|=2;var m=AL();(eo!==i||ho!==o)&&(Bc=null,qh(i,o));do try{PU();break}catch(v){CL(i,v)}while(!0);if(EE(),mr=c,g1.current=m,ks!==null)throw Error(oi(261));return eo=null,ho=0,Gs}function PU(){for(;ks!==null;)IL(ks)}function MU(){for(;ks!==null&&!t6();)IL(ks)}function IL(i){var o=RL(i.alternate,i,wa);i.memoizedProps=i.pendingProps,o===null?PL(i):ks=o,FE.current=null}function PL(i){var o=i;do{var c=o.alternate;if(i=o.return,o.flags&32768){if(c=SU(c,o),c!==null){c.flags&=32767,ks=c;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{Gs=6,ks=null;return}}else if(c=bU(c,o,wa),c!==null){ks=c;return}if(o=o.sibling,o!==null){ks=o;return}ks=o=i}while(o!==null);Gs===0&&(Gs=5)}function Oh(i,o,c){var m=Lr,v=qa.transition;try{qa.transition=null,Lr=1,RU(i,o,c,m)}finally{qa.transition=v,Lr=m}return null}function RU(i,o,c,m){do Yp();while(hd!==null);if(mr&6)throw Error(oi(327));c=i.finishedWork;var v=i.finishedLanes;if(c===null)return null;if(i.finishedWork=null,i.finishedLanes=0,c===i.current)throw Error(oi(177));i.callbackNode=null,i.callbackPriority=0;var E=c.lanes|c.childLanes;if(d6(i,E),i===eo&&(ks=eo=null,ho=0),!(c.subtreeFlags&2064)&&!(c.flags&2064)||v0||(v0=!0,DL(e1,function(){return Yp(),null})),E=(c.flags&15990)!==0,c.subtreeFlags&15990||E){E=qa.transition,qa.transition=null;var I=Lr;Lr=1;var s=mr;mr|=4,FE.current=null,EU(i,c),SL(c,i),Y6(QS),i1=!!JS,QS=JS=null,i.current=c,CU(c),i6(),mr=s,Lr=I,qa.transition=E}else i.current=c;if(v0&&(v0=!1,hd=i,y1=v),E=i.pendingLanes,E===0&&(xd=null),s6(c.stateNode),ua(i,xs()),o!==null)for(m=i.onRecoverableError,c=0;c<o.length;c++)v=o[c],m(v.value,{componentStack:v.stack,digest:v.digest});if(_1)throw _1=!1,i=xT,xT=null,i;return y1&1&&i.tag!==0&&Yp(),E=i.pendingLanes,E&1?i===vT?oy++:(oy=0,vT=i):oy=0,Dd(),null}function Yp(){if(hd!==null){var i=cN(y1),o=qa.transition,c=Lr;try{if(qa.transition=null,Lr=16>i?16:i,hd===null)var m=!1;else{if(i=hd,hd=null,y1=0,mr&6)throw Error(oi(331));var v=mr;for(mr|=4,Oi=i.current;Oi!==null;){var E=Oi,I=E.child;if(Oi.flags&16){var s=E.deletions;if(s!==null){for(var O=0;O<s.length;O++){var j=s[O];for(Oi=j;Oi!==null;){var G=Oi;switch(G.tag){case 0:case 11:case 15:ry(8,G,E)}var W=G.child;if(W!==null)W.return=G,Oi=W;else for(;Oi!==null;){G=Oi;var B=G.sibling,te=G.return;if(vL(G),G===j){Oi=null;break}if(B!==null){B.return=te,Oi=B;break}Oi=te}}}var ue=E.alternate;if(ue!==null){var J=ue.child;if(J!==null){ue.child=null;do{var ce=J.sibling;J.sibling=null,J=ce}while(J!==null)}}Oi=E}}if(E.subtreeFlags&2064&&I!==null)I.return=E,Oi=I;else e:for(;Oi!==null;){if(E=Oi,E.flags&2048)switch(E.tag){case 0:case 11:case 15:ry(9,E,E.return)}var oe=E.sibling;if(oe!==null){oe.return=E.return,Oi=oe;break e}Oi=E.return}}var ee=i.current;for(Oi=ee;Oi!==null;){I=Oi;var Q=I.child;if(I.subtreeFlags&2064&&Q!==null)Q.return=I,Oi=Q;else e:for(I=ee;Oi!==null;){if(s=Oi,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:Z1(9,s)}}catch(pe){ms(s,s.return,pe)}if(s===I){Oi=null;break e}var Ie=s.sibling;if(Ie!==null){Ie.return=s.return,Oi=Ie;break e}Oi=s.return}}if(mr=v,Dd(),cc&&typeof cc.onPostCommitFiberRoot=="function")try{cc.onPostCommitFiberRoot(B1,i)}catch{}m=!0}return m}finally{Lr=c,qa.transition=o}}return!1}function YR(i,o,c){o=mm(c,o),o=cL(i,o,1),i=yd(i,o,1),o=Wo(),i!==null&&(jy(i,1,o),ua(i,o))}function ms(i,o,c){if(i.tag===3)YR(i,i,c);else for(;o!==null;){if(o.tag===3){YR(o,i,c);break}else if(o.tag===1){var m=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(xd===null||!xd.has(m))){i=mm(c,i),i=uL(o,i,1),o=yd(o,i,1),i=Wo(),o!==null&&(jy(o,1,i),ua(o,i));break}}o=o.return}}function DU(i,o,c){var m=i.pingCache;m!==null&&m.delete(o),o=Wo(),i.pingedLanes|=i.suspendedLanes&c,eo===i&&(ho&c)===c&&(Gs===4||Gs===3&&(ho&130023424)===ho&&500>xs()-BE?qh(i,0):jE|=c),ua(i,o)}function ML(i,o){o===0&&(i.mode&1?(o=u0,u0<<=1,!(u0&130023424)&&(u0=4194304)):o=1);var c=Wo();i=Xc(i,o),i!==null&&(jy(i,o,c),ua(i,c))}function kU(i){var o=i.memoizedState,c=0;o!==null&&(c=o.retryLane),ML(i,c)}function NU(i,o){var c=0;switch(i.tag){case 13:var m=i.stateNode,v=i.memoizedState;v!==null&&(c=v.retryLane);break;case 19:m=i.stateNode;break;default:throw Error(oi(314))}m!==null&&m.delete(o),ML(i,c)}var RL;RL=function(i,o,c){if(i!==null)if(i.memoizedProps!==o.pendingProps||la.current)aa=!0;else{if(!(i.lanes&c)&&!(o.flags&128))return aa=!1,wU(i,o,c);aa=!!(i.flags&131072)}else aa=!1,is&&o.flags&1048576&&LN(o,c1,o.index);switch(o.lanes=0,o.tag){case 2:var m=o.type;V0(i,o),i=o.pendingProps;var v=dm(o,Io.current);Kp(o,c),v=kE(null,o,m,i,v,c);var E=NE();return o.flags|=1,typeof v=="object"&&v!==null&&typeof v.render=="function"&&v.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,ca(m)?(E=!0,a1(o)):E=!1,o.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,IE(o),v.updater=W1,o.stateNode=v,v._reactInternals=o,lT(o,m,i,c),o=dT(null,o,m,!0,E,c)):(o.tag=0,is&&E&&wE(o),Go(null,o,v,c),o=o.child),o;case 16:m=o.elementType;e:{switch(V0(i,o),i=o.pendingProps,v=m._init,m=v(m._payload),o.type=m,v=o.tag=zU(m),i=ul(m,i),v){case 0:o=uT(null,o,m,i,c);break e;case 1:o=VR(null,o,m,i,c);break e;case 11:o=jR(null,o,m,i,c);break e;case 14:o=BR(null,o,m,ul(m.type,i),c);break e}throw Error(oi(306,m,""))}return o;case 0:return m=o.type,v=o.pendingProps,v=o.elementType===m?v:ul(m,v),uT(i,o,m,v,c);case 1:return m=o.type,v=o.pendingProps,v=o.elementType===m?v:ul(m,v),VR(i,o,m,v,c);case 3:e:{if(pL(o),i===null)throw Error(oi(387));m=o.pendingProps,E=o.memoizedState,v=E.element,VN(i,o),h1(o,m,null,c);var I=o.memoizedState;if(m=I.element,E.isDehydrated)if(E={element:m,isDehydrated:!1,cache:I.cache,pendingSuspenseBoundaries:I.pendingSuspenseBoundaries,transitions:I.transitions},o.updateQueue.baseState=E,o.memoizedState=E,o.flags&256){v=mm(Error(oi(423)),o),o=UR(i,o,m,c,v);break e}else if(m!==v){v=mm(Error(oi(424)),o),o=UR(i,o,m,c,v);break e}else for(Ta=_d(o.stateNode.containerInfo.firstChild),Ea=o,is=!0,pl=null,c=jN(o,null,m,c),o.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(hm(),m===v){o=Kc(i,o,c);break e}Go(i,o,m,c)}o=o.child}return o;case 5:return UN(o),i===null&&sT(o),m=o.type,v=o.pendingProps,E=i!==null?i.memoizedProps:null,I=v.children,eT(m,v)?I=null:E!==null&&eT(m,E)&&(o.flags|=32),fL(i,o),Go(i,o,I,c),o.child;case 6:return i===null&&sT(o),null;case 13:return mL(i,o,c);case 4:return PE(o,o.stateNode.containerInfo),m=o.pendingProps,i===null?o.child=fm(o,null,m,c):Go(i,o,m,c),o.child;case 11:return m=o.type,v=o.pendingProps,v=o.elementType===m?v:ul(m,v),jR(i,o,m,v,c);case 7:return Go(i,o,o.pendingProps,c),o.child;case 8:return Go(i,o,o.pendingProps.children,c),o.child;case 12:return Go(i,o,o.pendingProps.children,c),o.child;case 10:e:{if(m=o.type._context,v=o.pendingProps,E=o.memoizedProps,I=v.value,Wr(u1,m._currentValue),m._currentValue=I,E!==null)if(wl(E.value,I)){if(E.children===v.children&&!la.current){o=Kc(i,o,c);break e}}else for(E=o.child,E!==null&&(E.return=o);E!==null;){var s=E.dependencies;if(s!==null){I=E.child;for(var O=s.firstContext;O!==null;){if(O.context===m){if(E.tag===1){O=Hc(-1,c&-c),O.tag=2;var j=E.updateQueue;if(j!==null){j=j.shared;var G=j.pending;G===null?O.next=O:(O.next=G.next,G.next=O),j.pending=O}}E.lanes|=c,O=E.alternate,O!==null&&(O.lanes|=c),oT(E.return,c,o),s.lanes|=c;break}O=O.next}}else if(E.tag===10)I=E.type===o.type?null:E.child;else if(E.tag===18){if(I=E.return,I===null)throw Error(oi(341));I.lanes|=c,s=I.alternate,s!==null&&(s.lanes|=c),oT(I,c,o),I=E.sibling}else I=E.child;if(I!==null)I.return=E;else for(I=E;I!==null;){if(I===o){I=null;break}if(E=I.sibling,E!==null){E.return=I.return,I=E;break}I=I.return}E=I}Go(i,o,v.children,c),o=o.child}return o;case 9:return v=o.type,m=o.pendingProps.children,Kp(o,c),v=Za(v),m=m(v),o.flags|=1,Go(i,o,m,c),o.child;case 14:return m=o.type,v=ul(m,o.pendingProps),v=ul(m.type,v),BR(i,o,m,v,c);case 15:return dL(i,o,o.type,o.pendingProps,c);case 17:return m=o.type,v=o.pendingProps,v=o.elementType===m?v:ul(m,v),V0(i,o),o.tag=1,ca(m)?(i=!0,a1(o)):i=!1,Kp(o,c),lL(o,m,v),lT(o,m,v,c),dT(null,o,m,!0,i,c);case 19:return gL(i,o,c);case 22:return hL(i,o,c)}throw Error(oi(156,o.tag))};function DL(i,o){return sN(i,o)}function LU(i,o,c,m){this.tag=i,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function $a(i,o,c,m){return new LU(i,o,c,m)}function $E(i){return i=i.prototype,!(!i||!i.isReactComponent)}function zU(i){if(typeof i=="function")return $E(i)?1:0;if(i!=null){if(i=i.$$typeof,i===cE)return 11;if(i===uE)return 14}return 2}function wd(i,o){var c=i.alternate;return c===null?(c=$a(i.tag,o,i.key,i.mode),c.elementType=i.elementType,c.type=i.type,c.stateNode=i.stateNode,c.alternate=i,i.alternate=c):(c.pendingProps=o,c.type=i.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=i.flags&14680064,c.childLanes=i.childLanes,c.lanes=i.lanes,c.child=i.child,c.memoizedProps=i.memoizedProps,c.memoizedState=i.memoizedState,c.updateQueue=i.updateQueue,o=i.dependencies,c.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},c.sibling=i.sibling,c.index=i.index,c.ref=i.ref,c}function $0(i,o,c,m,v,E){var I=2;if(m=i,typeof i=="function")$E(i)&&(I=1);else if(typeof i=="string")I=5;else e:switch(i){case Lp:return Wh(c.children,v,E,o);case lE:I=8,v|=8;break;case DS:return i=$a(12,c,o,v|2),i.elementType=DS,i.lanes=E,i;case kS:return i=$a(13,c,o,v),i.elementType=kS,i.lanes=E,i;case NS:return i=$a(19,c,o,v),i.elementType=NS,i.lanes=E,i;case Uk:return K1(c,v,E,o);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case Bk:I=10;break e;case Vk:I=9;break e;case cE:I=11;break e;case uE:I=14;break e;case ed:I=16,m=null;break e}throw Error(oi(130,i==null?i:typeof i,""))}return o=$a(I,c,o,v),o.elementType=i,o.type=m,o.lanes=E,o}function Wh(i,o,c,m){return i=$a(7,i,m,o),i.lanes=c,i}function K1(i,o,c,m){return i=$a(22,i,m,o),i.elementType=Uk,i.lanes=c,i.stateNode={isHidden:!1},i}function lS(i,o,c){return i=$a(6,i,null,o),i.lanes=c,i}function cS(i,o,c){return o=$a(4,i.children!==null?i.children:[],i.key,o),o.lanes=c,o.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},o}function OU(i,o,c,m,v){this.tag=o,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=G2(0),this.expirationTimes=G2(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=G2(0),this.identifierPrefix=m,this.onRecoverableError=v,this.mutableSourceEagerHydrationData=null}function HE(i,o,c,m,v,E,I,s,O){return i=new OU(i,o,c,s,O),o===1?(o=1,E===!0&&(o|=8)):o=0,E=$a(3,null,null,o),i.current=E,E.stateNode=i,E.memoizedState={element:m,isDehydrated:c,cache:null,transitions:null,pendingSuspenseBoundaries:null},IE(E),i}function FU(i,o,c){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Np,key:m==null?null:""+m,children:i,containerInfo:o,implementation:c}}function kL(i){if(!i)return Ed;i=i._reactInternals;e:{if(sf(i)!==i||i.tag!==1)throw Error(oi(170));var o=i;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(ca(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(oi(171))}if(i.tag===1){var c=i.type;if(ca(c))return kN(i,c,o)}return o}function NL(i,o,c,m,v,E,I,s,O){return i=HE(c,m,!0,i,v,E,I,s,O),i.context=kL(null),c=i.current,m=Wo(),v=vd(c),E=Hc(m,v),E.callback=o??null,yd(c,E,v),i.current.lanes=v,jy(i,v,m),ua(i,m),i}function Y1(i,o,c,m){var v=o.current,E=Wo(),I=vd(v);return c=kL(c),o.context===null?o.context=c:o.pendingContext=c,o=Hc(E,I),o.payload={element:i},m=m===void 0?null:m,m!==null&&(o.callback=m),i=yd(v,o,I),i!==null&&(xl(i,v,I,E),F0(i,v,I)),I}function v1(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function JR(i,o){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var c=i.retryLane;i.retryLane=c!==0&&c<o?c:o}}function qE(i,o){JR(i,o),(i=i.alternate)&&JR(i,o)}function jU(){return null}var LL=typeof reportError=="function"?reportError:function(i){console.error(i)};function WE(i){this._internalRoot=i}J1.prototype.render=WE.prototype.render=function(i){var o=this._internalRoot;if(o===null)throw Error(oi(409));Y1(i,o,null,null)};J1.prototype.unmount=WE.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var o=i.containerInfo;Jh(function(){Y1(null,i,null,null)}),o[Zc]=null}};function J1(i){this._internalRoot=i}J1.prototype.unstable_scheduleHydration=function(i){if(i){var o=hN();i={blockedOn:null,target:i,priority:o};for(var c=0;c<nd.length&&o!==0&&o<nd[c].priority;c++);nd.splice(c,0,i),c===0&&pN(i)}};function ZE(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function Q1(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function QR(){}function BU(i,o,c,m,v){if(v){if(typeof m=="function"){var E=m;m=function(){var j=v1(I);E.call(j)}}var I=NL(o,m,i,0,null,!1,!1,"",QR);return i._reactRootContainer=I,i[Zc]=I.current,yy(i.nodeType===8?i.parentNode:i),Jh(),I}for(;v=i.lastChild;)i.removeChild(v);if(typeof m=="function"){var s=m;m=function(){var j=v1(O);s.call(j)}}var O=HE(i,0,!1,null,null,!1,!1,"",QR);return i._reactRootContainer=O,i[Zc]=O.current,yy(i.nodeType===8?i.parentNode:i),Jh(function(){Y1(o,O,c,m)}),O}function ew(i,o,c,m,v){var E=c._reactRootContainer;if(E){var I=E;if(typeof v=="function"){var s=v;v=function(){var O=v1(I);s.call(O)}}Y1(o,I,i,v)}else I=BU(c,o,i,v,m);return v1(I)}uN=function(i){switch(i.tag){case 3:var o=i.stateNode;if(o.current.memoizedState.isDehydrated){var c=q_(o.pendingLanes);c!==0&&(fE(o,c|1),ua(o,xs()),!(mr&6)&&(gm=xs()+500,Dd()))}break;case 13:Jh(function(){var m=Xc(i,1);if(m!==null){var v=Wo();xl(m,i,1,v)}}),qE(i,1)}};pE=function(i){if(i.tag===13){var o=Xc(i,134217728);if(o!==null){var c=Wo();xl(o,i,134217728,c)}qE(i,134217728)}};dN=function(i){if(i.tag===13){var o=vd(i),c=Xc(i,o);if(c!==null){var m=Wo();xl(c,i,o,m)}qE(i,o)}};hN=function(){return Lr};fN=function(i,o){var c=Lr;try{return Lr=i,o()}finally{Lr=c}};$S=function(i,o,c){switch(o){case"input":if(OS(i,c),o=c.name,c.type==="radio"&&o!=null){for(c=i;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<c.length;o++){var m=c[o];if(m!==i&&m.form===i.form){var v=$1(m);if(!v)throw Error(oi(90));$k(m),OS(m,v)}}}break;case"textarea":qk(i,c);break;case"select":o=c.value,o!=null&&qp(i,!!c.multiple,o,!1)}};Qk=VE;eN=Jh;var VU={usingClientEntryPoint:!1,Events:[Vy,jp,$1,Yk,Jk,VE]},j_={findFiberByHostInstance:Fh,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},UU={bundleType:j_.bundleType,version:j_.version,rendererPackageName:j_.rendererPackageName,rendererConfig:j_.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:tu.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=nN(i),i===null?null:i.stateNode},findFiberByHostInstance:j_.findFiberByHostInstance||jU,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var w0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!w0.isDisabled&&w0.supportsFiber)try{B1=w0.inject(UU),cc=w0}catch{}}Ia.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=VU;Ia.createPortal=function(i,o){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ZE(o))throw Error(oi(200));return FU(i,o,null,c)};Ia.createRoot=function(i,o){if(!ZE(i))throw Error(oi(299));var c=!1,m="",v=LL;return o!=null&&(o.unstable_strictMode===!0&&(c=!0),o.identifierPrefix!==void 0&&(m=o.identifierPrefix),o.onRecoverableError!==void 0&&(v=o.onRecoverableError)),o=HE(i,1,!1,null,null,c,!1,m,v),i[Zc]=o.current,yy(i.nodeType===8?i.parentNode:i),new WE(o)};Ia.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var o=i._reactInternals;if(o===void 0)throw typeof i.render=="function"?Error(oi(188)):(i=Object.keys(i).join(","),Error(oi(268,i)));return i=nN(o),i=i===null?null:i.stateNode,i};Ia.flushSync=function(i){return Jh(i)};Ia.hydrate=function(i,o,c){if(!Q1(o))throw Error(oi(200));return ew(null,i,o,!0,c)};Ia.hydrateRoot=function(i,o,c){if(!ZE(i))throw Error(oi(405));var m=c!=null&&c.hydratedSources||null,v=!1,E="",I=LL;if(c!=null&&(c.unstable_strictMode===!0&&(v=!0),c.identifierPrefix!==void 0&&(E=c.identifierPrefix),c.onRecoverableError!==void 0&&(I=c.onRecoverableError)),o=NL(o,null,i,1,c??null,v,!1,E,I),i[Zc]=o.current,yy(i),m)for(i=0;i<m.length;i++)c=m[i],v=c._getVersion,v=v(c._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[c,v]:o.mutableSourceEagerHydrationData.push(c,v);return new J1(o)};Ia.render=function(i,o,c){if(!Q1(o))throw Error(oi(200));return ew(null,i,o,!1,c)};Ia.unmountComponentAtNode=function(i){if(!Q1(i))throw Error(oi(40));return i._reactRootContainer?(Jh(function(){ew(null,null,i,!1,function(){i._reactRootContainer=null,i[Zc]=null})}),!0):!1};Ia.unstable_batchedUpdates=VE;Ia.unstable_renderSubtreeIntoContainer=function(i,o,c,m){if(!Q1(c))throw Error(oi(200));if(i==null||i._reactInternals===void 0)throw Error(oi(38));return ew(i,o,c,!1,m)};Ia.version="18.3.1-next-f1338f8080-20240426";function zL(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(zL)}catch(i){console.error(i)}}zL(),zk.exports=Ia;var of=zk.exports;const OL=eE(of);var FL,eD=of;FL=eD.createRoot,eD.hydrateRoot;/**
 * @remix-run/router v1.20.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ay(){return Ay=Object.assign?Object.assign.bind():function(i){for(var o=1;o<arguments.length;o++){var c=arguments[o];for(var m in c)Object.prototype.hasOwnProperty.call(c,m)&&(i[m]=c[m])}return i},Ay.apply(this,arguments)}var fd;(function(i){i.Pop="POP",i.Push="PUSH",i.Replace="REPLACE"})(fd||(fd={}));const tD="popstate";function GU(i){i===void 0&&(i={});function o(m,v){let{pathname:E,search:I,hash:s}=m.location;return ST("",{pathname:E,search:I,hash:s},v.state&&v.state.usr||null,v.state&&v.state.key||"default")}function c(m,v){return typeof v=="string"?v:w1(v)}return HU(o,c,null,i)}function vs(i,o){if(i===!1||i===null||typeof i>"u")throw new Error(o)}function jL(i,o){if(!i){typeof console<"u"&&console.warn(o);try{throw new Error(o)}catch{}}}function $U(){return Math.random().toString(36).substr(2,8)}function iD(i,o){return{usr:i.state,key:i.key,idx:o}}function ST(i,o,c,m){return c===void 0&&(c=null),Ay({pathname:typeof i=="string"?i:i.pathname,search:"",hash:""},typeof o=="string"?Sm(o):o,{state:c,key:o&&o.key||m||$U()})}function w1(i){let{pathname:o="/",search:c="",hash:m=""}=i;return c&&c!=="?"&&(o+=c.charAt(0)==="?"?c:"?"+c),m&&m!=="#"&&(o+=m.charAt(0)==="#"?m:"#"+m),o}function Sm(i){let o={};if(i){let c=i.indexOf("#");c>=0&&(o.hash=i.substr(c),i=i.substr(0,c));let m=i.indexOf("?");m>=0&&(o.search=i.substr(m),i=i.substr(0,m)),i&&(o.pathname=i)}return o}function HU(i,o,c,m){m===void 0&&(m={});let{window:v=document.defaultView,v5Compat:E=!1}=m,I=v.history,s=fd.Pop,O=null,j=G();j==null&&(j=0,I.replaceState(Ay({},I.state,{idx:j}),""));function G(){return(I.state||{idx:null}).idx}function W(){s=fd.Pop;let ce=G(),oe=ce==null?null:ce-j;j=ce,O&&O({action:s,location:J.location,delta:oe})}function B(ce,oe){s=fd.Push;let ee=ST(J.location,ce,oe);j=G()+1;let Q=iD(ee,j),Ie=J.createHref(ee);try{I.pushState(Q,"",Ie)}catch(pe){if(pe instanceof DOMException&&pe.name==="DataCloneError")throw pe;v.location.assign(Ie)}E&&O&&O({action:s,location:J.location,delta:1})}function te(ce,oe){s=fd.Replace;let ee=ST(J.location,ce,oe);j=G();let Q=iD(ee,j),Ie=J.createHref(ee);I.replaceState(Q,"",Ie),E&&O&&O({action:s,location:J.location,delta:0})}function ue(ce){let oe=v.location.origin!=="null"?v.location.origin:v.location.href,ee=typeof ce=="string"?ce:w1(ce);return ee=ee.replace(/ $/,"%20"),vs(oe,"No window.location.(origin|href) available to create URL for href: "+ee),new URL(ee,oe)}let J={get action(){return s},get location(){return i(v,I)},listen(ce){if(O)throw new Error("A history only accepts one active listener");return v.addEventListener(tD,W),O=ce,()=>{v.removeEventListener(tD,W),O=null}},createHref(ce){return o(v,ce)},createURL:ue,encodeLocation(ce){let oe=ue(ce);return{pathname:oe.pathname,search:oe.search,hash:oe.hash}},push:B,replace:te,go(ce){return I.go(ce)}};return J}var nD;(function(i){i.data="data",i.deferred="deferred",i.redirect="redirect",i.error="error"})(nD||(nD={}));function qU(i,o,c){return c===void 0&&(c="/"),WU(i,o,c,!1)}function WU(i,o,c,m){let v=typeof o=="string"?Sm(o):o,E=XE(v.pathname||"/",c);if(E==null)return null;let I=BL(i);ZU(I);let s=null;for(let O=0;s==null&&O<I.length;++O){let j=s8(E);s=n8(I[O],j,m)}return s}function BL(i,o,c,m){o===void 0&&(o=[]),c===void 0&&(c=[]),m===void 0&&(m="");let v=(E,I,s)=>{let O={relativePath:s===void 0?E.path||"":s,caseSensitive:E.caseSensitive===!0,childrenIndex:I,route:E};O.relativePath.startsWith("/")&&(vs(O.relativePath.startsWith(m),'Absolute route path "'+O.relativePath+'" nested under path '+('"'+m+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),O.relativePath=O.relativePath.slice(m.length));let j=bd([m,O.relativePath]),G=c.concat(O);E.children&&E.children.length>0&&(vs(E.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+j+'".')),BL(E.children,o,G,j)),!(E.path==null&&!E.index)&&o.push({path:j,score:t8(j,E.index),routesMeta:G})};return i.forEach((E,I)=>{var s;if(E.path===""||!((s=E.path)!=null&&s.includes("?")))v(E,I);else for(let O of VL(E.path))v(E,I,O)}),o}function VL(i){let o=i.split("/");if(o.length===0)return[];let[c,...m]=o,v=c.endsWith("?"),E=c.replace(/\?$/,"");if(m.length===0)return v?[E,""]:[E];let I=VL(m.join("/")),s=[];return s.push(...I.map(O=>O===""?E:[E,O].join("/"))),v&&s.push(...I),s.map(O=>i.startsWith("/")&&O===""?"/":O)}function ZU(i){i.sort((o,c)=>o.score!==c.score?c.score-o.score:i8(o.routesMeta.map(m=>m.childrenIndex),c.routesMeta.map(m=>m.childrenIndex)))}const XU=/^:[\w-]+$/,KU=3,YU=2,JU=1,QU=10,e8=-2,rD=i=>i==="*";function t8(i,o){let c=i.split("/"),m=c.length;return c.some(rD)&&(m+=e8),o&&(m+=YU),c.filter(v=>!rD(v)).reduce((v,E)=>v+(XU.test(E)?KU:E===""?JU:QU),m)}function i8(i,o){return i.length===o.length&&i.slice(0,-1).every((m,v)=>m===o[v])?i[i.length-1]-o[o.length-1]:0}function n8(i,o,c){let{routesMeta:m}=i,v={},E="/",I=[];for(let s=0;s<m.length;++s){let O=m[s],j=s===m.length-1,G=E==="/"?o:o.slice(E.length)||"/",W=sD({path:O.relativePath,caseSensitive:O.caseSensitive,end:j},G),B=O.route;if(!W&&j&&c&&!m[m.length-1].route.index&&(W=sD({path:O.relativePath,caseSensitive:O.caseSensitive,end:!1},G)),!W)return null;Object.assign(v,W.params),I.push({params:v,pathname:bd([E,W.pathname]),pathnameBase:c8(bd([E,W.pathnameBase])),route:B}),W.pathnameBase!=="/"&&(E=bd([E,W.pathnameBase]))}return I}function sD(i,o){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[c,m]=r8(i.path,i.caseSensitive,i.end),v=o.match(c);if(!v)return null;let E=v[0],I=E.replace(/(.)\/+$/,"$1"),s=v.slice(1);return{params:m.reduce((j,G,W)=>{let{paramName:B,isOptional:te}=G;if(B==="*"){let J=s[W]||"";I=E.slice(0,E.length-J.length).replace(/(.)\/+$/,"$1")}const ue=s[W];return te&&!ue?j[B]=void 0:j[B]=(ue||"").replace(/%2F/g,"/"),j},{}),pathname:E,pathnameBase:I,pattern:i}}function r8(i,o,c){o===void 0&&(o=!1),c===void 0&&(c=!0),jL(i==="*"||!i.endsWith("*")||i.endsWith("/*"),'Route path "'+i+'" will be treated as if it were '+('"'+i.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+i.replace(/\*$/,"/*")+'".'));let m=[],v="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(I,s,O)=>(m.push({paramName:s,isOptional:O!=null}),O?"/?([^\\/]+)?":"/([^\\/]+)"));return i.endsWith("*")?(m.push({paramName:"*"}),v+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):c?v+="\\/*$":i!==""&&i!=="/"&&(v+="(?:(?=\\/|$))"),[new RegExp(v,o?void 0:"i"),m]}function s8(i){try{return i.split("/").map(o=>decodeURIComponent(o).replace(/\//g,"%2F")).join("/")}catch(o){return jL(!1,'The URL path "'+i+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+o+").")),i}}function XE(i,o){if(o==="/")return i;if(!i.toLowerCase().startsWith(o.toLowerCase()))return null;let c=o.endsWith("/")?o.length-1:o.length,m=i.charAt(c);return m&&m!=="/"?null:i.slice(c)||"/"}function o8(i,o){o===void 0&&(o="/");let{pathname:c,search:m="",hash:v=""}=typeof i=="string"?Sm(i):i;return{pathname:c?c.startsWith("/")?c:a8(c,o):o,search:u8(m),hash:d8(v)}}function a8(i,o){let c=o.replace(/\/+$/,"").split("/");return i.split("/").forEach(v=>{v===".."?c.length>1&&c.pop():v!=="."&&c.push(v)}),c.length>1?c.join("/"):"/"}function uS(i,o,c,m){return"Cannot include a '"+i+"' character in a manually specified "+("`to."+o+"` field ["+JSON.stringify(m)+"].  Please separate it out to the ")+("`to."+c+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function l8(i){return i.filter((o,c)=>c===0||o.route.path&&o.route.path.length>0)}function KE(i,o){let c=l8(i);return o?c.map((m,v)=>v===c.length-1?m.pathname:m.pathnameBase):c.map(m=>m.pathnameBase)}function YE(i,o,c,m){m===void 0&&(m=!1);let v;typeof i=="string"?v=Sm(i):(v=Ay({},i),vs(!v.pathname||!v.pathname.includes("?"),uS("?","pathname","search",v)),vs(!v.pathname||!v.pathname.includes("#"),uS("#","pathname","hash",v)),vs(!v.search||!v.search.includes("#"),uS("#","search","hash",v)));let E=i===""||v.pathname==="",I=E?"/":v.pathname,s;if(I==null)s=c;else{let W=o.length-1;if(!m&&I.startsWith("..")){let B=I.split("/");for(;B[0]==="..";)B.shift(),W-=1;v.pathname=B.join("/")}s=W>=0?o[W]:"/"}let O=o8(v,s),j=I&&I!=="/"&&I.endsWith("/"),G=(E||I===".")&&c.endsWith("/");return!O.pathname.endsWith("/")&&(j||G)&&(O.pathname+="/"),O}const bd=i=>i.join("/").replace(/\/\/+/g,"/"),c8=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),u8=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,d8=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i;function h8(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}const UL=["post","put","patch","delete"];new Set(UL);const f8=["get",...UL];new Set(f8);/**
 * React Router v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Iy(){return Iy=Object.assign?Object.assign.bind():function(i){for(var o=1;o<arguments.length;o++){var c=arguments[o];for(var m in c)Object.prototype.hasOwnProperty.call(c,m)&&(i[m]=c[m])}return i},Iy.apply(this,arguments)}const JE=V.createContext(null),p8=V.createContext(null),kd=V.createContext(null),tw=V.createContext(null),hc=V.createContext({outlet:null,matches:[],isDataRoute:!1}),GL=V.createContext(null);function m8(i,o){let{relative:c}=o===void 0?{}:o;Tm()||vs(!1);let{basename:m,navigator:v}=V.useContext(kd),{hash:E,pathname:I,search:s}=HL(i,{relative:c}),O=I;return m!=="/"&&(O=I==="/"?m:bd([m,I])),v.createHref({pathname:O,search:s,hash:E})}function Tm(){return V.useContext(tw)!=null}function Nd(){return Tm()||vs(!1),V.useContext(tw).location}function $L(i){V.useContext(kd).static||V.useLayoutEffect(i)}function iw(){let{isDataRoute:i}=V.useContext(hc);return i?R8():g8()}function g8(){Tm()||vs(!1);let i=V.useContext(JE),{basename:o,future:c,navigator:m}=V.useContext(kd),{matches:v}=V.useContext(hc),{pathname:E}=Nd(),I=JSON.stringify(KE(v,c.v7_relativeSplatPath)),s=V.useRef(!1);return $L(()=>{s.current=!0}),V.useCallback(function(j,G){if(G===void 0&&(G={}),!s.current)return;if(typeof j=="number"){m.go(j);return}let W=YE(j,JSON.parse(I),E,G.relative==="path");i==null&&o!=="/"&&(W.pathname=W.pathname==="/"?o:bd([o,W.pathname])),(G.replace?m.replace:m.push)(W,G.state,G)},[o,m,I,E,i])}const _8=V.createContext(null);function y8(i){let o=V.useContext(hc).outlet;return o&&V.createElement(_8.Provider,{value:i},o)}function x8(){let{matches:i}=V.useContext(hc),o=i[i.length-1];return o?o.params:{}}function HL(i,o){let{relative:c}=o===void 0?{}:o,{future:m}=V.useContext(kd),{matches:v}=V.useContext(hc),{pathname:E}=Nd(),I=JSON.stringify(KE(v,m.v7_relativeSplatPath));return V.useMemo(()=>YE(i,JSON.parse(I),E,c==="path"),[i,I,E,c])}function v8(i,o){return w8(i,o)}function w8(i,o,c,m){Tm()||vs(!1);let{navigator:v}=V.useContext(kd),{matches:E}=V.useContext(hc),I=E[E.length-1],s=I?I.params:{};I&&I.pathname;let O=I?I.pathnameBase:"/";I&&I.route;let j=Nd(),G;if(o){var W;let ce=typeof o=="string"?Sm(o):o;O==="/"||(W=ce.pathname)!=null&&W.startsWith(O)||vs(!1),G=ce}else G=j;let B=G.pathname||"/",te=B;if(O!=="/"){let ce=O.replace(/^\//,"").split("/");te="/"+B.replace(/^\//,"").split("/").slice(ce.length).join("/")}let ue=qU(i,{pathname:te}),J=C8(ue&&ue.map(ce=>Object.assign({},ce,{params:Object.assign({},s,ce.params),pathname:bd([O,v.encodeLocation?v.encodeLocation(ce.pathname).pathname:ce.pathname]),pathnameBase:ce.pathnameBase==="/"?O:bd([O,v.encodeLocation?v.encodeLocation(ce.pathnameBase).pathname:ce.pathnameBase])})),E,c,m);return o&&J?V.createElement(tw.Provider,{value:{location:Iy({pathname:"/",search:"",hash:"",state:null,key:"default"},G),navigationType:fd.Pop}},J):J}function b8(){let i=M8(),o=h8(i)?i.status+" "+i.statusText:i instanceof Error?i.message:JSON.stringify(i),c=i instanceof Error?i.stack:null,v={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return V.createElement(V.Fragment,null,V.createElement("h2",null,"Unexpected Application Error!"),V.createElement("h3",{style:{fontStyle:"italic"}},o),c?V.createElement("pre",{style:v},c):null,null)}const S8=V.createElement(b8,null);class T8 extends V.Component{constructor(o){super(o),this.state={location:o.location,revalidation:o.revalidation,error:o.error}}static getDerivedStateFromError(o){return{error:o}}static getDerivedStateFromProps(o,c){return c.location!==o.location||c.revalidation!=="idle"&&o.revalidation==="idle"?{error:o.error,location:o.location,revalidation:o.revalidation}:{error:o.error!==void 0?o.error:c.error,location:c.location,revalidation:o.revalidation||c.revalidation}}componentDidCatch(o,c){console.error("React Router caught the following error during render",o,c)}render(){return this.state.error!==void 0?V.createElement(hc.Provider,{value:this.props.routeContext},V.createElement(GL.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function E8(i){let{routeContext:o,match:c,children:m}=i,v=V.useContext(JE);return v&&v.static&&v.staticContext&&(c.route.errorElement||c.route.ErrorBoundary)&&(v.staticContext._deepestRenderedBoundaryId=c.route.id),V.createElement(hc.Provider,{value:o},m)}function C8(i,o,c,m){var v;if(o===void 0&&(o=[]),c===void 0&&(c=null),m===void 0&&(m=null),i==null){var E;if(!c)return null;if(c.errors)i=c.matches;else if((E=m)!=null&&E.v7_partialHydration&&o.length===0&&!c.initialized&&c.matches.length>0)i=c.matches;else return null}let I=i,s=(v=c)==null?void 0:v.errors;if(s!=null){let G=I.findIndex(W=>W.route.id&&(s==null?void 0:s[W.route.id])!==void 0);G>=0||vs(!1),I=I.slice(0,Math.min(I.length,G+1))}let O=!1,j=-1;if(c&&m&&m.v7_partialHydration)for(let G=0;G<I.length;G++){let W=I[G];if((W.route.HydrateFallback||W.route.hydrateFallbackElement)&&(j=G),W.route.id){let{loaderData:B,errors:te}=c,ue=W.route.loader&&B[W.route.id]===void 0&&(!te||te[W.route.id]===void 0);if(W.route.lazy||ue){O=!0,j>=0?I=I.slice(0,j+1):I=[I[0]];break}}}return I.reduceRight((G,W,B)=>{let te,ue=!1,J=null,ce=null;c&&(te=s&&W.route.id?s[W.route.id]:void 0,J=W.route.errorElement||S8,O&&(j<0&&B===0?(ue=!0,ce=null):j===B&&(ue=!0,ce=W.route.hydrateFallbackElement||null)));let oe=o.concat(I.slice(0,B+1)),ee=()=>{let Q;return te?Q=J:ue?Q=ce:W.route.Component?Q=V.createElement(W.route.Component,null):W.route.element?Q=W.route.element:Q=G,V.createElement(E8,{match:W,routeContext:{outlet:G,matches:oe,isDataRoute:c!=null},children:Q})};return c&&(W.route.ErrorBoundary||W.route.errorElement||B===0)?V.createElement(T8,{location:c.location,revalidation:c.revalidation,component:J,error:te,children:ee(),routeContext:{outlet:null,matches:oe,isDataRoute:!0}}):ee()},null)}var qL=function(i){return i.UseBlocker="useBlocker",i.UseRevalidator="useRevalidator",i.UseNavigateStable="useNavigate",i}(qL||{}),b1=function(i){return i.UseBlocker="useBlocker",i.UseLoaderData="useLoaderData",i.UseActionData="useActionData",i.UseRouteError="useRouteError",i.UseNavigation="useNavigation",i.UseRouteLoaderData="useRouteLoaderData",i.UseMatches="useMatches",i.UseRevalidator="useRevalidator",i.UseNavigateStable="useNavigate",i.UseRouteId="useRouteId",i}(b1||{});function A8(i){let o=V.useContext(JE);return o||vs(!1),o}function I8(i){let o=V.useContext(p8);return o||vs(!1),o}function P8(i){let o=V.useContext(hc);return o||vs(!1),o}function WL(i){let o=P8(),c=o.matches[o.matches.length-1];return c.route.id||vs(!1),c.route.id}function M8(){var i;let o=V.useContext(GL),c=I8(b1.UseRouteError),m=WL(b1.UseRouteError);return o!==void 0?o:(i=c.errors)==null?void 0:i[m]}function R8(){let{router:i}=A8(qL.UseNavigateStable),o=WL(b1.UseNavigateStable),c=V.useRef(!1);return $L(()=>{c.current=!0}),V.useCallback(function(v,E){E===void 0&&(E={}),c.current&&(typeof v=="number"?i.navigate(v):i.navigate(v,Iy({fromRouteId:o},E)))},[i,o])}function oD(i){let{to:o,replace:c,state:m,relative:v}=i;Tm()||vs(!1);let{future:E,static:I}=V.useContext(kd),{matches:s}=V.useContext(hc),{pathname:O}=Nd(),j=iw(),G=YE(o,KE(s,E.v7_relativeSplatPath),O,v==="path"),W=JSON.stringify(G);return V.useEffect(()=>j(JSON.parse(W),{replace:c,state:m,relative:v}),[j,W,v,c,m]),null}function ZL(i){return y8(i.context)}function fs(i){vs(!1)}function D8(i){let{basename:o="/",children:c=null,location:m,navigationType:v=fd.Pop,navigator:E,static:I=!1,future:s}=i;Tm()&&vs(!1);let O=o.replace(/^\/*/,"/"),j=V.useMemo(()=>({basename:O,navigator:E,static:I,future:Iy({v7_relativeSplatPath:!1},s)}),[O,s,E,I]);typeof m=="string"&&(m=Sm(m));let{pathname:G="/",search:W="",hash:B="",state:te=null,key:ue="default"}=m,J=V.useMemo(()=>{let ce=XE(G,O);return ce==null?null:{location:{pathname:ce,search:W,hash:B,state:te,key:ue},navigationType:v}},[O,G,W,B,te,ue,v]);return J==null?null:V.createElement(kd.Provider,{value:j},V.createElement(tw.Provider,{children:c,value:J}))}function k8(i){let{children:o,location:c}=i;return v8(TT(o),c)}new Promise(()=>{});function TT(i,o){o===void 0&&(o=[]);let c=[];return V.Children.forEach(i,(m,v)=>{if(!V.isValidElement(m))return;let E=[...o,v];if(m.type===V.Fragment){c.push.apply(c,TT(m.props.children,E));return}m.type!==fs&&vs(!1),!m.props.index||!m.props.children||vs(!1);let I={id:m.props.id||E.join("-"),caseSensitive:m.props.caseSensitive,element:m.props.element,Component:m.props.Component,index:m.props.index,path:m.props.path,loader:m.props.loader,action:m.props.action,errorElement:m.props.errorElement,ErrorBoundary:m.props.ErrorBoundary,hasErrorBoundary:m.props.ErrorBoundary!=null||m.props.errorElement!=null,shouldRevalidate:m.props.shouldRevalidate,handle:m.props.handle,lazy:m.props.lazy};m.props.children&&(I.children=TT(m.props.children,E)),c.push(I)}),c}/**
 * React Router DOM v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ET(){return ET=Object.assign?Object.assign.bind():function(i){for(var o=1;o<arguments.length;o++){var c=arguments[o];for(var m in c)Object.prototype.hasOwnProperty.call(c,m)&&(i[m]=c[m])}return i},ET.apply(this,arguments)}function N8(i,o){if(i==null)return{};var c={},m=Object.keys(i),v,E;for(E=0;E<m.length;E++)v=m[E],!(o.indexOf(v)>=0)&&(c[v]=i[v]);return c}function L8(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function z8(i,o){return i.button===0&&(!o||o==="_self")&&!L8(i)}const O8=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],F8="6";try{window.__reactRouterVersion=F8}catch{}const j8="startTransition",aD=Nk[j8];function B8(i){let{basename:o,children:c,future:m,window:v}=i,E=V.useRef();E.current==null&&(E.current=GU({window:v,v5Compat:!0}));let I=E.current,[s,O]=V.useState({action:I.action,location:I.location}),{v7_startTransition:j}=m||{},G=V.useCallback(W=>{j&&aD?aD(()=>O(W)):O(W)},[O,j]);return V.useLayoutEffect(()=>I.listen(G),[I,G]),V.createElement(D8,{basename:o,children:c,location:s.location,navigationType:s.action,navigator:I,future:m})}const V8=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",U8=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ho=V.forwardRef(function(o,c){let{onClick:m,relative:v,reloadDocument:E,replace:I,state:s,target:O,to:j,preventScrollReset:G,viewTransition:W}=o,B=N8(o,O8),{basename:te}=V.useContext(kd),ue,J=!1;if(typeof j=="string"&&U8.test(j)&&(ue=j,V8))try{let Q=new URL(window.location.href),Ie=j.startsWith("//")?new URL(Q.protocol+j):new URL(j),pe=XE(Ie.pathname,te);Ie.origin===Q.origin&&pe!=null?j=pe+Ie.search+Ie.hash:J=!0}catch{}let ce=m8(j,{relative:v}),oe=G8(j,{replace:I,state:s,target:O,preventScrollReset:G,relative:v,viewTransition:W});function ee(Q){m&&m(Q),Q.defaultPrevented||oe(Q)}return V.createElement("a",ET({},B,{href:ue||ce,onClick:J||E?m:ee,ref:c,target:O}))});var lD;(function(i){i.UseScrollRestoration="useScrollRestoration",i.UseSubmit="useSubmit",i.UseSubmitFetcher="useSubmitFetcher",i.UseFetcher="useFetcher",i.useViewTransitionState="useViewTransitionState"})(lD||(lD={}));var cD;(function(i){i.UseFetcher="useFetcher",i.UseFetchers="useFetchers",i.UseScrollRestoration="useScrollRestoration"})(cD||(cD={}));function G8(i,o){let{target:c,replace:m,state:v,preventScrollReset:E,relative:I,viewTransition:s}=o===void 0?{}:o,O=iw(),j=Nd(),G=HL(i,{relative:I});return V.useCallback(W=>{if(z8(W,c)){W.preventDefault();let B=m!==void 0?m:w1(j)===w1(G);O(i,{replace:B,state:v,preventScrollReset:E,relative:I,viewTransition:s})}},[j,O,G,m,v,c,i,E,I,s])}const $8="modulepreload",H8=function(i){return"/meatshop-UI/"+i},uD={},q8=function(o,c,m){let v=Promise.resolve();if(c&&c.length>0){document.getElementsByTagName("link");const I=document.querySelector("meta[property=csp-nonce]"),s=(I==null?void 0:I.nonce)||(I==null?void 0:I.getAttribute("nonce"));v=Promise.allSettled(c.map(O=>{if(O=H8(O),O in uD)return;uD[O]=!0;const j=O.endsWith(".css"),G=j?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${O}"]${G}`))return;const W=document.createElement("link");if(W.rel=j?"stylesheet":$8,j||(W.as="script"),W.crossOrigin="",W.href=O,s&&W.setAttribute("nonce",s),document.head.appendChild(W),j)return new Promise((B,te)=>{W.addEventListener("load",B),W.addEventListener("error",()=>te(new Error(`Unable to preload CSS for ${O}`)))})}))}function E(I){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=I,window.dispatchEvent(s),!s.defaultPrevented)throw I}return v.then(I=>{for(const s of I||[])s.status==="rejected"&&E(s.reason);return o().catch(E)})},W8=3,Z8=3e3;let dS=0;function X8(){return dS=(dS+1)%Number.MAX_SAFE_INTEGER,dS.toString()}const hS=new Map,dD=i=>{if(hS.has(i))return;const o=setTimeout(()=>{hS.delete(i),ay({type:"REMOVE_TOAST",toastId:i})},Z8);hS.set(i,o)},K8=(i,o)=>{switch(o.type){case"ADD_TOAST":return{...i,toasts:[o.toast,...i.toasts].slice(0,W8)};case"UPDATE_TOAST":return{...i,toasts:i.toasts.map(c=>c.id===o.toast.id?{...c,...o.toast}:c)};case"DISMISS_TOAST":{const{toastId:c}=o;return c?dD(c):i.toasts.forEach(m=>{dD(m.id)}),{...i,toasts:i.toasts.map(m=>m.id===c||c===void 0?{...m,open:!1}:m)}}case"REMOVE_TOAST":return o.toastId===void 0?{...i,toasts:[]}:{...i,toasts:i.toasts.filter(c=>c.id!==o.toastId)}}},H0=[];let q0={toasts:[]};function ay(i){q0=K8(q0,i),H0.forEach(o=>{o(q0)})}function Y8({...i}){const o=X8(),c=v=>ay({type:"UPDATE_TOAST",toast:{...v,id:o}}),m=()=>ay({type:"DISMISS_TOAST",toastId:o});return ay({type:"ADD_TOAST",toast:{...i,id:o,open:!0,onOpenChange:v=>{v||m()}}}),{id:o,dismiss:m,update:c}}function ha(){const[i,o]=V.useState(q0);return V.useEffect(()=>(H0.push(o),()=>{const c=H0.indexOf(o);c>-1&&H0.splice(c,1)}),[i]),{...i,toast:Y8,dismiss:c=>ay({type:"DISMISS_TOAST",toastId:c})}}function Ai(i,o,{checkForDefaultPrevented:c=!0}={}){return function(v){if(i==null||i(v),c===!1||!v.defaultPrevented)return o==null?void 0:o(v)}}function J8(i,o){typeof i=="function"?i(o):i!=null&&(i.current=o)}function nw(...i){return o=>i.forEach(c=>J8(c,o))}function vr(...i){return V.useCallback(nw(...i),i)}function Q8(i,o=[]){let c=[];function m(E,I){const s=V.createContext(I),O=c.length;c=[...c,I];function j(W){const{scope:B,children:te,...ue}=W,J=(B==null?void 0:B[i][O])||s,ce=V.useMemo(()=>ue,Object.values(ue));return x.jsx(J.Provider,{value:ce,children:te})}function G(W,B){const te=(B==null?void 0:B[i][O])||s,ue=V.useContext(te);if(ue)return ue;if(I!==void 0)return I;throw new Error(`\`${W}\` must be used within \`${E}\``)}return j.displayName=E+"Provider",[j,G]}const v=()=>{const E=c.map(I=>V.createContext(I));return function(s){const O=(s==null?void 0:s[i])||E;return V.useMemo(()=>({[`__scope${i}`]:{...s,[i]:O}}),[s,O])}};return v.scopeName=i,[m,eG(v,...o)]}function eG(...i){const o=i[0];if(i.length===1)return o;const c=()=>{const m=i.map(v=>({useScope:v(),scopeName:v.scopeName}));return function(E){const I=m.reduce((s,{useScope:O,scopeName:j})=>{const W=O(E)[`__scope${j}`];return{...s,...W}},{});return V.useMemo(()=>({[`__scope${o.scopeName}`]:I}),[I])}};return c.scopeName=o.scopeName,c}var da=V.forwardRef((i,o)=>{const{children:c,...m}=i,v=V.Children.toArray(c),E=v.find(tG);if(E){const I=E.props.children,s=v.map(O=>O===E?V.Children.count(I)>1?V.Children.only(null):V.isValidElement(I)?I.props.children:null:O);return x.jsx(CT,{...m,ref:o,children:V.isValidElement(I)?V.cloneElement(I,void 0,s):null})}return x.jsx(CT,{...m,ref:o,children:c})});da.displayName="Slot";var CT=V.forwardRef((i,o)=>{const{children:c,...m}=i;if(V.isValidElement(c)){const v=nG(c);return V.cloneElement(c,{...iG(m,c.props),ref:o?nw(o,v):v})}return V.Children.count(c)>1?V.Children.only(null):null});CT.displayName="SlotClone";var XL=({children:i})=>x.jsx(x.Fragment,{children:i});function tG(i){return V.isValidElement(i)&&i.type===XL}function iG(i,o){const c={...o};for(const m in o){const v=i[m],E=o[m];/^on[A-Z]/.test(m)?v&&E?c[m]=(...s)=>{E(...s),v(...s)}:v&&(c[m]=v):m==="style"?c[m]={...v,...E}:m==="className"&&(c[m]=[v,E].filter(Boolean).join(" "))}return{...i,...c}}function nG(i){var m,v;let o=(m=Object.getOwnPropertyDescriptor(i.props,"ref"))==null?void 0:m.get,c=o&&"isReactWarning"in o&&o.isReactWarning;return c?i.ref:(o=(v=Object.getOwnPropertyDescriptor(i,"ref"))==null?void 0:v.get,c=o&&"isReactWarning"in o&&o.isReactWarning,c?i.props.ref:i.props.ref||i.ref)}function rw(i){const o=i+"CollectionProvider",[c,m]=Q8(o),[v,E]=c(o,{collectionRef:{current:null},itemMap:new Map}),I=te=>{const{scope:ue,children:J}=te,ce=Vt.useRef(null),oe=Vt.useRef(new Map).current;return x.jsx(v,{scope:ue,itemMap:oe,collectionRef:ce,children:J})};I.displayName=o;const s=i+"CollectionSlot",O=Vt.forwardRef((te,ue)=>{const{scope:J,children:ce}=te,oe=E(s,J),ee=vr(ue,oe.collectionRef);return x.jsx(da,{ref:ee,children:ce})});O.displayName=s;const j=i+"CollectionItemSlot",G="data-radix-collection-item",W=Vt.forwardRef((te,ue)=>{const{scope:J,children:ce,...oe}=te,ee=Vt.useRef(null),Q=vr(ue,ee),Ie=E(j,J);return Vt.useEffect(()=>(Ie.itemMap.set(ee,{ref:ee,...oe}),()=>void Ie.itemMap.delete(ee))),x.jsx(da,{[G]:"",ref:Q,children:ce})});W.displayName=j;function B(te){const ue=E(i+"CollectionConsumer",te);return Vt.useCallback(()=>{const ce=ue.collectionRef.current;if(!ce)return[];const oe=Array.from(ce.querySelectorAll(`[${G}]`));return Array.from(ue.itemMap.values()).sort((Ie,pe)=>oe.indexOf(Ie.ref.current)-oe.indexOf(pe.ref.current))},[ue.collectionRef,ue.itemMap])}return[{Provider:I,Slot:O,ItemSlot:W},B,m]}function rG(i,o){const c=V.createContext(o),m=E=>{const{children:I,...s}=E,O=V.useMemo(()=>s,Object.values(s));return x.jsx(c.Provider,{value:O,children:I})};m.displayName=i+"Provider";function v(E){const I=V.useContext(c);if(I)return I;if(o!==void 0)return o;throw new Error(`\`${E}\` must be used within \`${i}\``)}return[m,v]}function iu(i,o=[]){let c=[];function m(E,I){const s=V.createContext(I),O=c.length;c=[...c,I];const j=W=>{var oe;const{scope:B,children:te,...ue}=W,J=((oe=B==null?void 0:B[i])==null?void 0:oe[O])||s,ce=V.useMemo(()=>ue,Object.values(ue));return x.jsx(J.Provider,{value:ce,children:te})};j.displayName=E+"Provider";function G(W,B){var J;const te=((J=B==null?void 0:B[i])==null?void 0:J[O])||s,ue=V.useContext(te);if(ue)return ue;if(I!==void 0)return I;throw new Error(`\`${W}\` must be used within \`${E}\``)}return[j,G]}const v=()=>{const E=c.map(I=>V.createContext(I));return function(s){const O=(s==null?void 0:s[i])||E;return V.useMemo(()=>({[`__scope${i}`]:{...s,[i]:O}}),[s,O])}};return v.scopeName=i,[m,sG(v,...o)]}function sG(...i){const o=i[0];if(i.length===1)return o;const c=()=>{const m=i.map(v=>({useScope:v(),scopeName:v.scopeName}));return function(E){const I=m.reduce((s,{useScope:O,scopeName:j})=>{const W=O(E)[`__scope${j}`];return{...s,...W}},{});return V.useMemo(()=>({[`__scope${o.scopeName}`]:I}),[I])}};return c.scopeName=o.scopeName,c}var oG=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],fn=oG.reduce((i,o)=>{const c=V.forwardRef((m,v)=>{const{asChild:E,...I}=m,s=E?da:o;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),x.jsx(s,{...I,ref:v})});return c.displayName=`Primitive.${o}`,{...i,[o]:c}},{});function QE(i,o){i&&of.flushSync(()=>i.dispatchEvent(o))}function po(i){const o=V.useRef(i);return V.useEffect(()=>{o.current=i}),V.useMemo(()=>(...c)=>{var m;return(m=o.current)==null?void 0:m.call(o,...c)},[])}function aG(i,o=globalThis==null?void 0:globalThis.document){const c=po(i);V.useEffect(()=>{const m=v=>{v.key==="Escape"&&c(v)};return o.addEventListener("keydown",m,{capture:!0}),()=>o.removeEventListener("keydown",m,{capture:!0})},[c,o])}var lG="DismissableLayer",AT="dismissableLayer.update",cG="dismissableLayer.pointerDownOutside",uG="dismissableLayer.focusOutside",hD,KL=V.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Em=V.forwardRef((i,o)=>{const{disableOutsidePointerEvents:c=!1,onEscapeKeyDown:m,onPointerDownOutside:v,onFocusOutside:E,onInteractOutside:I,onDismiss:s,...O}=i,j=V.useContext(KL),[G,W]=V.useState(null),B=(G==null?void 0:G.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,te]=V.useState({}),ue=vr(o,et=>W(et)),J=Array.from(j.layers),[ce]=[...j.layersWithOutsidePointerEventsDisabled].slice(-1),oe=J.indexOf(ce),ee=G?J.indexOf(G):-1,Q=j.layersWithOutsidePointerEventsDisabled.size>0,Ie=ee>=oe,pe=hG(et=>{const at=et.target,Xt=[...j.branches].some(Ct=>Ct.contains(at));!Ie||Xt||(v==null||v(et),I==null||I(et),et.defaultPrevented||s==null||s())},B),Ke=fG(et=>{const at=et.target;[...j.branches].some(Ct=>Ct.contains(at))||(E==null||E(et),I==null||I(et),et.defaultPrevented||s==null||s())},B);return aG(et=>{ee===j.layers.size-1&&(m==null||m(et),!et.defaultPrevented&&s&&(et.preventDefault(),s()))},B),V.useEffect(()=>{if(G)return c&&(j.layersWithOutsidePointerEventsDisabled.size===0&&(hD=B.body.style.pointerEvents,B.body.style.pointerEvents="none"),j.layersWithOutsidePointerEventsDisabled.add(G)),j.layers.add(G),fD(),()=>{c&&j.layersWithOutsidePointerEventsDisabled.size===1&&(B.body.style.pointerEvents=hD)}},[G,B,c,j]),V.useEffect(()=>()=>{G&&(j.layers.delete(G),j.layersWithOutsidePointerEventsDisabled.delete(G),fD())},[G,j]),V.useEffect(()=>{const et=()=>te({});return document.addEventListener(AT,et),()=>document.removeEventListener(AT,et)},[]),x.jsx(fn.div,{...O,ref:ue,style:{pointerEvents:Q?Ie?"auto":"none":void 0,...i.style},onFocusCapture:Ai(i.onFocusCapture,Ke.onFocusCapture),onBlurCapture:Ai(i.onBlurCapture,Ke.onBlurCapture),onPointerDownCapture:Ai(i.onPointerDownCapture,pe.onPointerDownCapture)})});Em.displayName=lG;var dG="DismissableLayerBranch",YL=V.forwardRef((i,o)=>{const c=V.useContext(KL),m=V.useRef(null),v=vr(o,m);return V.useEffect(()=>{const E=m.current;if(E)return c.branches.add(E),()=>{c.branches.delete(E)}},[c.branches]),x.jsx(fn.div,{...i,ref:v})});YL.displayName=dG;function hG(i,o=globalThis==null?void 0:globalThis.document){const c=po(i),m=V.useRef(!1),v=V.useRef(()=>{});return V.useEffect(()=>{const E=s=>{if(s.target&&!m.current){let O=function(){JL(cG,c,j,{discrete:!0})};const j={originalEvent:s};s.pointerType==="touch"?(o.removeEventListener("click",v.current),v.current=O,o.addEventListener("click",v.current,{once:!0})):O()}else o.removeEventListener("click",v.current);m.current=!1},I=window.setTimeout(()=>{o.addEventListener("pointerdown",E)},0);return()=>{window.clearTimeout(I),o.removeEventListener("pointerdown",E),o.removeEventListener("click",v.current)}},[o,c]),{onPointerDownCapture:()=>m.current=!0}}function fG(i,o=globalThis==null?void 0:globalThis.document){const c=po(i),m=V.useRef(!1);return V.useEffect(()=>{const v=E=>{E.target&&!m.current&&JL(uG,c,{originalEvent:E},{discrete:!1})};return o.addEventListener("focusin",v),()=>o.removeEventListener("focusin",v)},[o,c]),{onFocusCapture:()=>m.current=!0,onBlurCapture:()=>m.current=!1}}function fD(){const i=new CustomEvent(AT);document.dispatchEvent(i)}function JL(i,o,c,{discrete:m}){const v=c.originalEvent.target,E=new CustomEvent(i,{bubbles:!1,cancelable:!0,detail:c});o&&v.addEventListener(i,o,{once:!0}),m?QE(v,E):v.dispatchEvent(E)}var pG=Em,mG=YL,to=globalThis!=null&&globalThis.document?V.useLayoutEffect:()=>{},gG="Portal",Gy=V.forwardRef((i,o)=>{var s;const{container:c,...m}=i,[v,E]=V.useState(!1);to(()=>E(!0),[]);const I=c||v&&((s=globalThis==null?void 0:globalThis.document)==null?void 0:s.body);return I?OL.createPortal(x.jsx(fn.div,{...m,ref:o}),I):null});Gy.displayName=gG;function _G(i,o){return V.useReducer((c,m)=>o[c][m]??c,i)}var El=i=>{const{present:o,children:c}=i,m=yG(o),v=typeof c=="function"?c({present:m.isPresent}):V.Children.only(c),E=vr(m.ref,xG(v));return typeof c=="function"||m.isPresent?V.cloneElement(v,{ref:E}):null};El.displayName="Presence";function yG(i){const[o,c]=V.useState(),m=V.useRef({}),v=V.useRef(i),E=V.useRef("none"),I=i?"mounted":"unmounted",[s,O]=_G(I,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return V.useEffect(()=>{const j=b0(m.current);E.current=s==="mounted"?j:"none"},[s]),to(()=>{const j=m.current,G=v.current;if(G!==i){const B=E.current,te=b0(j);i?O("MOUNT"):te==="none"||(j==null?void 0:j.display)==="none"?O("UNMOUNT"):O(G&&B!==te?"ANIMATION_OUT":"UNMOUNT"),v.current=i}},[i,O]),to(()=>{if(o){let j;const G=o.ownerDocument.defaultView??window,W=te=>{const J=b0(m.current).includes(te.animationName);if(te.target===o&&J&&(O("ANIMATION_END"),!v.current)){const ce=o.style.animationFillMode;o.style.animationFillMode="forwards",j=G.setTimeout(()=>{o.style.animationFillMode==="forwards"&&(o.style.animationFillMode=ce)})}},B=te=>{te.target===o&&(E.current=b0(m.current))};return o.addEventListener("animationstart",B),o.addEventListener("animationcancel",W),o.addEventListener("animationend",W),()=>{G.clearTimeout(j),o.removeEventListener("animationstart",B),o.removeEventListener("animationcancel",W),o.removeEventListener("animationend",W)}}else O("ANIMATION_END")},[o,O]),{isPresent:["mounted","unmountSuspended"].includes(s),ref:V.useCallback(j=>{j&&(m.current=getComputedStyle(j)),c(j)},[])}}function b0(i){return(i==null?void 0:i.animationName)||"none"}function xG(i){var m,v;let o=(m=Object.getOwnPropertyDescriptor(i.props,"ref"))==null?void 0:m.get,c=o&&"isReactWarning"in o&&o.isReactWarning;return c?i.ref:(o=(v=Object.getOwnPropertyDescriptor(i,"ref"))==null?void 0:v.get,c=o&&"isReactWarning"in o&&o.isReactWarning,c?i.props.ref:i.props.ref||i.ref)}function Yc({prop:i,defaultProp:o,onChange:c=()=>{}}){const[m,v]=vG({defaultProp:o,onChange:c}),E=i!==void 0,I=E?i:m,s=po(c),O=V.useCallback(j=>{if(E){const W=typeof j=="function"?j(i):j;W!==i&&s(W)}else v(j)},[E,i,v,s]);return[I,O]}function vG({defaultProp:i,onChange:o}){const c=V.useState(i),[m]=c,v=V.useRef(m),E=po(o);return V.useEffect(()=>{v.current!==m&&(E(m),v.current=m)},[m,v,E]),c}var wG="VisuallyHidden",$y=V.forwardRef((i,o)=>x.jsx(fn.span,{...i,ref:o,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...i.style}}));$y.displayName=wG;var bG=$y,eC="ToastProvider",[tC,SG,TG]=rw("Toast"),[QL,pK]=iu("Toast",[TG]),[EG,sw]=QL(eC),ez=i=>{const{__scopeToast:o,label:c="Notification",duration:m=5e3,swipeDirection:v="right",swipeThreshold:E=50,children:I}=i,[s,O]=V.useState(null),[j,G]=V.useState(0),W=V.useRef(!1),B=V.useRef(!1);return c.trim()||console.error(`Invalid prop \`label\` supplied to \`${eC}\`. Expected non-empty \`string\`.`),x.jsx(tC.Provider,{scope:o,children:x.jsx(EG,{scope:o,label:c,duration:m,swipeDirection:v,swipeThreshold:E,toastCount:j,viewport:s,onViewportChange:O,onToastAdd:V.useCallback(()=>G(te=>te+1),[]),onToastRemove:V.useCallback(()=>G(te=>te-1),[]),isFocusedToastEscapeKeyDownRef:W,isClosePausedRef:B,children:I})})};ez.displayName=eC;var tz="ToastViewport",CG=["F8"],IT="toast.viewportPause",PT="toast.viewportResume",iz=V.forwardRef((i,o)=>{const{__scopeToast:c,hotkey:m=CG,label:v="Notifications ({hotkey})",...E}=i,I=sw(tz,c),s=SG(c),O=V.useRef(null),j=V.useRef(null),G=V.useRef(null),W=V.useRef(null),B=vr(o,W,I.onViewportChange),te=m.join("+").replace(/Key/g,"").replace(/Digit/g,""),ue=I.toastCount>0;V.useEffect(()=>{const ce=oe=>{var Q;m.length!==0&&m.every(Ie=>oe[Ie]||oe.code===Ie)&&((Q=W.current)==null||Q.focus())};return document.addEventListener("keydown",ce),()=>document.removeEventListener("keydown",ce)},[m]),V.useEffect(()=>{const ce=O.current,oe=W.current;if(ue&&ce&&oe){const ee=()=>{if(!I.isClosePausedRef.current){const Ke=new CustomEvent(IT);oe.dispatchEvent(Ke),I.isClosePausedRef.current=!0}},Q=()=>{if(I.isClosePausedRef.current){const Ke=new CustomEvent(PT);oe.dispatchEvent(Ke),I.isClosePausedRef.current=!1}},Ie=Ke=>{!ce.contains(Ke.relatedTarget)&&Q()},pe=()=>{ce.contains(document.activeElement)||Q()};return ce.addEventListener("focusin",ee),ce.addEventListener("focusout",Ie),ce.addEventListener("pointermove",ee),ce.addEventListener("pointerleave",pe),window.addEventListener("blur",ee),window.addEventListener("focus",Q),()=>{ce.removeEventListener("focusin",ee),ce.removeEventListener("focusout",Ie),ce.removeEventListener("pointermove",ee),ce.removeEventListener("pointerleave",pe),window.removeEventListener("blur",ee),window.removeEventListener("focus",Q)}}},[ue,I.isClosePausedRef]);const J=V.useCallback(({tabbingDirection:ce})=>{const ee=s().map(Q=>{const Ie=Q.ref.current,pe=[Ie,...jG(Ie)];return ce==="forwards"?pe:pe.reverse()});return(ce==="forwards"?ee.reverse():ee).flat()},[s]);return V.useEffect(()=>{const ce=W.current;if(ce){const oe=ee=>{var pe,Ke,et;const Q=ee.altKey||ee.ctrlKey||ee.metaKey;if(ee.key==="Tab"&&!Q){const at=document.activeElement,Xt=ee.shiftKey;if(ee.target===ce&&Xt){(pe=j.current)==null||pe.focus();return}const Dt=J({tabbingDirection:Xt?"backwards":"forwards"}),Kt=Dt.findIndex(Pt=>Pt===at);fS(Dt.slice(Kt+1))?ee.preventDefault():Xt?(Ke=j.current)==null||Ke.focus():(et=G.current)==null||et.focus()}};return ce.addEventListener("keydown",oe),()=>ce.removeEventListener("keydown",oe)}},[s,J]),x.jsxs(mG,{ref:O,role:"region","aria-label":v.replace("{hotkey}",te),tabIndex:-1,style:{pointerEvents:ue?void 0:"none"},children:[ue&&x.jsx(MT,{ref:j,onFocusFromOutsideViewport:()=>{const ce=J({tabbingDirection:"forwards"});fS(ce)}}),x.jsx(tC.Slot,{scope:c,children:x.jsx(fn.ol,{tabIndex:-1,...E,ref:B})}),ue&&x.jsx(MT,{ref:G,onFocusFromOutsideViewport:()=>{const ce=J({tabbingDirection:"backwards"});fS(ce)}})]})});iz.displayName=tz;var nz="ToastFocusProxy",MT=V.forwardRef((i,o)=>{const{__scopeToast:c,onFocusFromOutsideViewport:m,...v}=i,E=sw(nz,c);return x.jsx($y,{"aria-hidden":!0,tabIndex:0,...v,ref:o,style:{position:"fixed"},onFocus:I=>{var j;const s=I.relatedTarget;!((j=E.viewport)!=null&&j.contains(s))&&m()}})});MT.displayName=nz;var ow="Toast",AG="toast.swipeStart",IG="toast.swipeMove",PG="toast.swipeCancel",MG="toast.swipeEnd",rz=V.forwardRef((i,o)=>{const{forceMount:c,open:m,defaultOpen:v,onOpenChange:E,...I}=i,[s=!0,O]=Yc({prop:m,defaultProp:v,onChange:E});return x.jsx(El,{present:c||s,children:x.jsx(kG,{open:s,...I,ref:o,onClose:()=>O(!1),onPause:po(i.onPause),onResume:po(i.onResume),onSwipeStart:Ai(i.onSwipeStart,j=>{j.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Ai(i.onSwipeMove,j=>{const{x:G,y:W}=j.detail.delta;j.currentTarget.setAttribute("data-swipe","move"),j.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${G}px`),j.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${W}px`)}),onSwipeCancel:Ai(i.onSwipeCancel,j=>{j.currentTarget.setAttribute("data-swipe","cancel"),j.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),j.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),j.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),j.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Ai(i.onSwipeEnd,j=>{const{x:G,y:W}=j.detail.delta;j.currentTarget.setAttribute("data-swipe","end"),j.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),j.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),j.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${G}px`),j.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${W}px`),O(!1)})})})});rz.displayName=ow;var[RG,DG]=QL(ow,{onClose(){}}),kG=V.forwardRef((i,o)=>{const{__scopeToast:c,type:m="foreground",duration:v,open:E,onClose:I,onEscapeKeyDown:s,onPause:O,onResume:j,onSwipeStart:G,onSwipeMove:W,onSwipeCancel:B,onSwipeEnd:te,...ue}=i,J=sw(ow,c),[ce,oe]=V.useState(null),ee=vr(o,Pt=>oe(Pt)),Q=V.useRef(null),Ie=V.useRef(null),pe=v||J.duration,Ke=V.useRef(0),et=V.useRef(pe),at=V.useRef(0),{onToastAdd:Xt,onToastRemove:Ct}=J,mt=po(()=>{var ti;(ce==null?void 0:ce.contains(document.activeElement))&&((ti=J.viewport)==null||ti.focus()),I()}),Dt=V.useCallback(Pt=>{!Pt||Pt===1/0||(window.clearTimeout(at.current),Ke.current=new Date().getTime(),at.current=window.setTimeout(mt,Pt))},[mt]);V.useEffect(()=>{const Pt=J.viewport;if(Pt){const ti=()=>{Dt(et.current),j==null||j()},Nt=()=>{const bi=new Date().getTime()-Ke.current;et.current=et.current-bi,window.clearTimeout(at.current),O==null||O()};return Pt.addEventListener(IT,Nt),Pt.addEventListener(PT,ti),()=>{Pt.removeEventListener(IT,Nt),Pt.removeEventListener(PT,ti)}}},[J.viewport,pe,O,j,Dt]),V.useEffect(()=>{E&&!J.isClosePausedRef.current&&Dt(pe)},[E,pe,J.isClosePausedRef,Dt]),V.useEffect(()=>(Xt(),()=>Ct()),[Xt,Ct]);const Kt=V.useMemo(()=>ce?dz(ce):null,[ce]);return J.viewport?x.jsxs(x.Fragment,{children:[Kt&&x.jsx(NG,{__scopeToast:c,role:"status","aria-live":m==="foreground"?"assertive":"polite","aria-atomic":!0,children:Kt}),x.jsx(RG,{scope:c,onClose:mt,children:of.createPortal(x.jsx(tC.ItemSlot,{scope:c,children:x.jsx(pG,{asChild:!0,onEscapeKeyDown:Ai(s,()=>{J.isFocusedToastEscapeKeyDownRef.current||mt(),J.isFocusedToastEscapeKeyDownRef.current=!1}),children:x.jsx(fn.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":E?"open":"closed","data-swipe-direction":J.swipeDirection,...ue,ref:ee,style:{userSelect:"none",touchAction:"none",...i.style},onKeyDown:Ai(i.onKeyDown,Pt=>{Pt.key==="Escape"&&(s==null||s(Pt.nativeEvent),Pt.nativeEvent.defaultPrevented||(J.isFocusedToastEscapeKeyDownRef.current=!0,mt()))}),onPointerDown:Ai(i.onPointerDown,Pt=>{Pt.button===0&&(Q.current={x:Pt.clientX,y:Pt.clientY})}),onPointerMove:Ai(i.onPointerMove,Pt=>{if(!Q.current)return;const ti=Pt.clientX-Q.current.x,Nt=Pt.clientY-Q.current.y,bi=!!Ie.current,ot=["left","right"].includes(J.swipeDirection),Tt=["left","up"].includes(J.swipeDirection)?Math.min:Math.max,ii=ot?Tt(0,ti):0,jt=ot?0:Tt(0,Nt),gi=Pt.pointerType==="touch"?10:2,en={x:ii,y:jt},Dn={originalEvent:Pt,delta:en};bi?(Ie.current=en,S0(IG,W,Dn,{discrete:!1})):pD(en,J.swipeDirection,gi)?(Ie.current=en,S0(AG,G,Dn,{discrete:!1}),Pt.target.setPointerCapture(Pt.pointerId)):(Math.abs(ti)>gi||Math.abs(Nt)>gi)&&(Q.current=null)}),onPointerUp:Ai(i.onPointerUp,Pt=>{const ti=Ie.current,Nt=Pt.target;if(Nt.hasPointerCapture(Pt.pointerId)&&Nt.releasePointerCapture(Pt.pointerId),Ie.current=null,Q.current=null,ti){const bi=Pt.currentTarget,ot={originalEvent:Pt,delta:ti};pD(ti,J.swipeDirection,J.swipeThreshold)?S0(MG,te,ot,{discrete:!0}):S0(PG,B,ot,{discrete:!0}),bi.addEventListener("click",Tt=>Tt.preventDefault(),{once:!0})}})})})}),J.viewport)})]}):null}),NG=i=>{const{__scopeToast:o,children:c,...m}=i,v=sw(ow,o),[E,I]=V.useState(!1),[s,O]=V.useState(!1);return OG(()=>I(!0)),V.useEffect(()=>{const j=window.setTimeout(()=>O(!0),1e3);return()=>window.clearTimeout(j)},[]),s?null:x.jsx(Gy,{asChild:!0,children:x.jsx($y,{...m,children:E&&x.jsxs(x.Fragment,{children:[v.label," ",c]})})})},LG="ToastTitle",sz=V.forwardRef((i,o)=>{const{__scopeToast:c,...m}=i;return x.jsx(fn.div,{...m,ref:o})});sz.displayName=LG;var zG="ToastDescription",oz=V.forwardRef((i,o)=>{const{__scopeToast:c,...m}=i;return x.jsx(fn.div,{...m,ref:o})});oz.displayName=zG;var az="ToastAction",lz=V.forwardRef((i,o)=>{const{altText:c,...m}=i;return c.trim()?x.jsx(uz,{altText:c,asChild:!0,children:x.jsx(iC,{...m,ref:o})}):(console.error(`Invalid prop \`altText\` supplied to \`${az}\`. Expected non-empty \`string\`.`),null)});lz.displayName=az;var cz="ToastClose",iC=V.forwardRef((i,o)=>{const{__scopeToast:c,...m}=i,v=DG(cz,c);return x.jsx(uz,{asChild:!0,children:x.jsx(fn.button,{type:"button",...m,ref:o,onClick:Ai(i.onClick,v.onClose)})})});iC.displayName=cz;var uz=V.forwardRef((i,o)=>{const{__scopeToast:c,altText:m,...v}=i;return x.jsx(fn.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":m||void 0,...v,ref:o})});function dz(i){const o=[];return Array.from(i.childNodes).forEach(m=>{if(m.nodeType===m.TEXT_NODE&&m.textContent&&o.push(m.textContent),FG(m)){const v=m.ariaHidden||m.hidden||m.style.display==="none",E=m.dataset.radixToastAnnounceExclude==="";if(!v)if(E){const I=m.dataset.radixToastAnnounceAlt;I&&o.push(I)}else o.push(...dz(m))}}),o}function S0(i,o,c,{discrete:m}){const v=c.originalEvent.currentTarget,E=new CustomEvent(i,{bubbles:!0,cancelable:!0,detail:c});o&&v.addEventListener(i,o,{once:!0}),m?QE(v,E):v.dispatchEvent(E)}var pD=(i,o,c=0)=>{const m=Math.abs(i.x),v=Math.abs(i.y),E=m>v;return o==="left"||o==="right"?E&&m>c:!E&&v>c};function OG(i=()=>{}){const o=po(i);to(()=>{let c=0,m=0;return c=window.requestAnimationFrame(()=>m=window.requestAnimationFrame(o)),()=>{window.cancelAnimationFrame(c),window.cancelAnimationFrame(m)}},[o])}function FG(i){return i.nodeType===i.ELEMENT_NODE}function jG(i){const o=[],c=document.createTreeWalker(i,NodeFilter.SHOW_ELEMENT,{acceptNode:m=>{const v=m.tagName==="INPUT"&&m.type==="hidden";return m.disabled||m.hidden||v?NodeFilter.FILTER_SKIP:m.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;c.nextNode();)o.push(c.currentNode);return o}function fS(i){const o=document.activeElement;return i.some(c=>c===o?!0:(c.focus(),document.activeElement!==o))}var BG=ez,hz=iz,fz=rz,pz=sz,mz=oz,gz=lz,_z=iC;function yz(i){var o,c,m="";if(typeof i=="string"||typeof i=="number")m+=i;else if(typeof i=="object")if(Array.isArray(i)){var v=i.length;for(o=0;o<v;o++)i[o]&&(c=yz(i[o]))&&(m&&(m+=" "),m+=c)}else for(c in i)i[c]&&(m&&(m+=" "),m+=c);return m}function xz(){for(var i,o,c=0,m="",v=arguments.length;c<v;c++)(i=arguments[c])&&(o=yz(i))&&(m&&(m+=" "),m+=o);return m}const mD=i=>typeof i=="boolean"?`${i}`:i===0?"0":i,gD=xz,Cm=(i,o)=>c=>{var m;if((o==null?void 0:o.variants)==null)return gD(i,c==null?void 0:c.class,c==null?void 0:c.className);const{variants:v,defaultVariants:E}=o,I=Object.keys(v).map(j=>{const G=c==null?void 0:c[j],W=E==null?void 0:E[j];if(G===null)return null;const B=mD(G)||mD(W);return v[j][B]}),s=c&&Object.entries(c).reduce((j,G)=>{let[W,B]=G;return B===void 0||(j[W]=B),j},{}),O=o==null||(m=o.compoundVariants)===null||m===void 0?void 0:m.reduce((j,G)=>{let{class:W,className:B,...te}=G;return Object.entries(te).every(ue=>{let[J,ce]=ue;return Array.isArray(ce)?ce.includes({...E,...s}[J]):{...E,...s}[J]===ce})?[...j,W,B]:j},[]);return gD(i,I,O,c==null?void 0:c.class,c==null?void 0:c.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VG=i=>i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),vz=(...i)=>i.filter((o,c,m)=>!!o&&o.trim()!==""&&m.indexOf(o)===c).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var UG={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GG=V.forwardRef(({color:i="currentColor",size:o=24,strokeWidth:c=2,absoluteStrokeWidth:m,className:v="",children:E,iconNode:I,...s},O)=>V.createElement("svg",{ref:O,...UG,width:o,height:o,stroke:i,strokeWidth:m?Number(c)*24/Number(o):c,className:vz("lucide",v),...s},[...I.map(([j,G])=>V.createElement(j,G)),...Array.isArray(E)?E:[E]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sn=(i,o)=>{const c=V.forwardRef(({className:m,...v},E)=>V.createElement(GG,{ref:E,iconNode:o,className:vz(`lucide-${VG(i)}`,m),...v}));return c.displayName=`${i}`,c};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RT=sn("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $G=sn("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HG=sn("Beef",[["circle",{cx:"12.5",cy:"8.5",r:"2.5",key:"9738u8"}],["path",{d:"M12.5 2a6.5 6.5 0 0 0-6.22 4.6c-1.1 3.13-.78 3.9-3.18 6.08A3 3 0 0 0 5 18c4 0 8.4-1.8 11.4-4.3A6.5 6.5 0 0 0 12.5 2Z",key:"o0f6za"}],["path",{d:"m18.5 6 2.19 4.5a6.48 6.48 0 0 1 .31 2 6.49 6.49 0 0 1-2.6 5.2C15.4 20.2 11 22 7 22a3 3 0 0 1-2.68-1.66L2.4 16.5",key:"k7p6i0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nC=sn("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wz=sn("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qG=sn("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bz=sn("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sz=sn("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WG=sn("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZG=sn("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sd=sn("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _D=sn("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XG=sn("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KG=sn("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sd=sn("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YG=sn("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aw=sn("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qh=sn("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lw=sn("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DT=sn("FolderTree",[["path",{d:"M20 10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"hod4my"}],["path",{d:"M20 21a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.9a1 1 0 0 1-.88-.55l-.42-.85a1 1 0 0 0-.92-.6H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"w4yl2u"}],["path",{d:"M3 5a2 2 0 0 0 2 2h3",key:"f2jnh7"}],["path",{d:"M3 3v13a2 2 0 0 0 2 2h3",key:"k8epm1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yD=sn("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JG=sn("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xD=sn("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const id=sn("IndianRupee",[["path",{d:"M6 3h12",key:"ggurg9"}],["path",{d:"M6 8h12",key:"6g4wlu"}],["path",{d:"m6 13 8.5 8",key:"u1kupk"}],["path",{d:"M6 13h3",key:"wdp6ag"}],["path",{d:"M9 13c6.667 0 6.667-10 0-10",key:"1nkvk2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S1=sn("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tz=sn("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kT=sn("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QG=sn("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cw=sn("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e$=sn("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ez=sn("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ml=sn("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t$=sn("PanelLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T1=sn("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uw=sn("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bl=sn("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vD=sn("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z_=sn("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Am=sn("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i$=sn("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n$=sn("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r$=sn("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s$=sn("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rC=sn("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Py=sn("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sC=sn("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o$=sn("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hy=sn("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T0=sn("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pS=sn("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qc=sn("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E1=sn("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a$=sn("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oC=sn("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),aC="-",l$=i=>{const o=u$(i),{conflictingClassGroups:c,conflictingClassGroupModifiers:m}=i;return{getClassGroupId:I=>{const s=I.split(aC);return s[0]===""&&s.length!==1&&s.shift(),Cz(s,o)||c$(I)},getConflictingClassGroupIds:(I,s)=>{const O=c[I]||[];return s&&m[I]?[...O,...m[I]]:O}}},Cz=(i,o)=>{var I;if(i.length===0)return o.classGroupId;const c=i[0],m=o.nextPart.get(c),v=m?Cz(i.slice(1),m):void 0;if(v)return v;if(o.validators.length===0)return;const E=i.join(aC);return(I=o.validators.find(({validator:s})=>s(E)))==null?void 0:I.classGroupId},wD=/^\[(.+)\]$/,c$=i=>{if(wD.test(i)){const o=wD.exec(i)[1],c=o==null?void 0:o.substring(0,o.indexOf(":"));if(c)return"arbitrary.."+c}},u$=i=>{const{theme:o,prefix:c}=i,m={nextPart:new Map,validators:[]};return h$(Object.entries(i.classGroups),c).forEach(([E,I])=>{NT(I,m,E,o)}),m},NT=(i,o,c,m)=>{i.forEach(v=>{if(typeof v=="string"){const E=v===""?o:bD(o,v);E.classGroupId=c;return}if(typeof v=="function"){if(d$(v)){NT(v(m),o,c,m);return}o.validators.push({validator:v,classGroupId:c});return}Object.entries(v).forEach(([E,I])=>{NT(I,bD(o,E),c,m)})})},bD=(i,o)=>{let c=i;return o.split(aC).forEach(m=>{c.nextPart.has(m)||c.nextPart.set(m,{nextPart:new Map,validators:[]}),c=c.nextPart.get(m)}),c},d$=i=>i.isThemeGetter,h$=(i,o)=>o?i.map(([c,m])=>{const v=m.map(E=>typeof E=="string"?o+E:typeof E=="object"?Object.fromEntries(Object.entries(E).map(([I,s])=>[o+I,s])):E);return[c,v]}):i,f$=i=>{if(i<1)return{get:()=>{},set:()=>{}};let o=0,c=new Map,m=new Map;const v=(E,I)=>{c.set(E,I),o++,o>i&&(o=0,m=c,c=new Map)};return{get(E){let I=c.get(E);if(I!==void 0)return I;if((I=m.get(E))!==void 0)return v(E,I),I},set(E,I){c.has(E)?c.set(E,I):v(E,I)}}},Az="!",p$=i=>{const{separator:o,experimentalParseClassName:c}=i,m=o.length===1,v=o[0],E=o.length,I=s=>{const O=[];let j=0,G=0,W;for(let ce=0;ce<s.length;ce++){let oe=s[ce];if(j===0){if(oe===v&&(m||s.slice(ce,ce+E)===o)){O.push(s.slice(G,ce)),G=ce+E;continue}if(oe==="/"){W=ce;continue}}oe==="["?j++:oe==="]"&&j--}const B=O.length===0?s:s.substring(G),te=B.startsWith(Az),ue=te?B.substring(1):B,J=W&&W>G?W-G:void 0;return{modifiers:O,hasImportantModifier:te,baseClassName:ue,maybePostfixModifierPosition:J}};return c?s=>c({className:s,parseClassName:I}):I},m$=i=>{if(i.length<=1)return i;const o=[];let c=[];return i.forEach(m=>{m[0]==="["?(o.push(...c.sort(),m),c=[]):c.push(m)}),o.push(...c.sort()),o},g$=i=>({cache:f$(i.cacheSize),parseClassName:p$(i),...l$(i)}),_$=/\s+/,y$=(i,o)=>{const{parseClassName:c,getClassGroupId:m,getConflictingClassGroupIds:v}=o,E=[],I=i.trim().split(_$);let s="";for(let O=I.length-1;O>=0;O-=1){const j=I[O],{modifiers:G,hasImportantModifier:W,baseClassName:B,maybePostfixModifierPosition:te}=c(j);let ue=!!te,J=m(ue?B.substring(0,te):B);if(!J){if(!ue){s=j+(s.length>0?" "+s:s);continue}if(J=m(B),!J){s=j+(s.length>0?" "+s:s);continue}ue=!1}const ce=m$(G).join(":"),oe=W?ce+Az:ce,ee=oe+J;if(E.includes(ee))continue;E.push(ee);const Q=v(J,ue);for(let Ie=0;Ie<Q.length;++Ie){const pe=Q[Ie];E.push(oe+pe)}s=j+(s.length>0?" "+s:s)}return s};function x$(){let i=0,o,c,m="";for(;i<arguments.length;)(o=arguments[i++])&&(c=Iz(o))&&(m&&(m+=" "),m+=c);return m}const Iz=i=>{if(typeof i=="string")return i;let o,c="";for(let m=0;m<i.length;m++)i[m]&&(o=Iz(i[m]))&&(c&&(c+=" "),c+=o);return c};function v$(i,...o){let c,m,v,E=I;function I(O){const j=o.reduce((G,W)=>W(G),i());return c=g$(j),m=c.cache.get,v=c.cache.set,E=s,s(O)}function s(O){const j=m(O);if(j)return j;const G=y$(O,c);return v(O,G),G}return function(){return E(x$.apply(null,arguments))}}const Yr=i=>{const o=c=>c[i]||[];return o.isThemeGetter=!0,o},Pz=/^\[(?:([a-z-]+):)?(.+)\]$/i,w$=/^\d+\/\d+$/,b$=new Set(["px","full","screen"]),S$=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,T$=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,E$=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,C$=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,A$=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Oc=i=>Jp(i)||b$.has(i)||w$.test(i),Ku=i=>Im(i,"length",L$),Jp=i=>!!i&&!Number.isNaN(Number(i)),mS=i=>Im(i,"number",Jp),B_=i=>!!i&&Number.isInteger(Number(i)),I$=i=>i.endsWith("%")&&Jp(i.slice(0,-1)),Gn=i=>Pz.test(i),Yu=i=>S$.test(i),P$=new Set(["length","size","percentage"]),M$=i=>Im(i,P$,Mz),R$=i=>Im(i,"position",Mz),D$=new Set(["image","url"]),k$=i=>Im(i,D$,O$),N$=i=>Im(i,"",z$),V_=()=>!0,Im=(i,o,c)=>{const m=Pz.exec(i);return m?m[1]?typeof o=="string"?m[1]===o:o.has(m[1]):c(m[2]):!1},L$=i=>T$.test(i)&&!E$.test(i),Mz=()=>!1,z$=i=>C$.test(i),O$=i=>A$.test(i),F$=()=>{const i=Yr("colors"),o=Yr("spacing"),c=Yr("blur"),m=Yr("brightness"),v=Yr("borderColor"),E=Yr("borderRadius"),I=Yr("borderSpacing"),s=Yr("borderWidth"),O=Yr("contrast"),j=Yr("grayscale"),G=Yr("hueRotate"),W=Yr("invert"),B=Yr("gap"),te=Yr("gradientColorStops"),ue=Yr("gradientColorStopPositions"),J=Yr("inset"),ce=Yr("margin"),oe=Yr("opacity"),ee=Yr("padding"),Q=Yr("saturate"),Ie=Yr("scale"),pe=Yr("sepia"),Ke=Yr("skew"),et=Yr("space"),at=Yr("translate"),Xt=()=>["auto","contain","none"],Ct=()=>["auto","hidden","clip","visible","scroll"],mt=()=>["auto",Gn,o],Dt=()=>[Gn,o],Kt=()=>["",Oc,Ku],Pt=()=>["auto",Jp,Gn],ti=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Nt=()=>["solid","dashed","dotted","double","none"],bi=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],ot=()=>["start","end","center","between","around","evenly","stretch"],Tt=()=>["","0",Gn],ii=()=>["auto","avoid","all","avoid-page","page","left","right","column"],jt=()=>[Jp,Gn];return{cacheSize:500,separator:":",theme:{colors:[V_],spacing:[Oc,Ku],blur:["none","",Yu,Gn],brightness:jt(),borderColor:[i],borderRadius:["none","","full",Yu,Gn],borderSpacing:Dt(),borderWidth:Kt(),contrast:jt(),grayscale:Tt(),hueRotate:jt(),invert:Tt(),gap:Dt(),gradientColorStops:[i],gradientColorStopPositions:[I$,Ku],inset:mt(),margin:mt(),opacity:jt(),padding:Dt(),saturate:jt(),scale:jt(),sepia:Tt(),skew:jt(),space:Dt(),translate:Dt()},classGroups:{aspect:[{aspect:["auto","square","video",Gn]}],container:["container"],columns:[{columns:[Yu]}],"break-after":[{"break-after":ii()}],"break-before":[{"break-before":ii()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...ti(),Gn]}],overflow:[{overflow:Ct()}],"overflow-x":[{"overflow-x":Ct()}],"overflow-y":[{"overflow-y":Ct()}],overscroll:[{overscroll:Xt()}],"overscroll-x":[{"overscroll-x":Xt()}],"overscroll-y":[{"overscroll-y":Xt()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[J]}],"inset-x":[{"inset-x":[J]}],"inset-y":[{"inset-y":[J]}],start:[{start:[J]}],end:[{end:[J]}],top:[{top:[J]}],right:[{right:[J]}],bottom:[{bottom:[J]}],left:[{left:[J]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",B_,Gn]}],basis:[{basis:mt()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Gn]}],grow:[{grow:Tt()}],shrink:[{shrink:Tt()}],order:[{order:["first","last","none",B_,Gn]}],"grid-cols":[{"grid-cols":[V_]}],"col-start-end":[{col:["auto",{span:["full",B_,Gn]},Gn]}],"col-start":[{"col-start":Pt()}],"col-end":[{"col-end":Pt()}],"grid-rows":[{"grid-rows":[V_]}],"row-start-end":[{row:["auto",{span:[B_,Gn]},Gn]}],"row-start":[{"row-start":Pt()}],"row-end":[{"row-end":Pt()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Gn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Gn]}],gap:[{gap:[B]}],"gap-x":[{"gap-x":[B]}],"gap-y":[{"gap-y":[B]}],"justify-content":[{justify:["normal",...ot()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...ot(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...ot(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[ee]}],px:[{px:[ee]}],py:[{py:[ee]}],ps:[{ps:[ee]}],pe:[{pe:[ee]}],pt:[{pt:[ee]}],pr:[{pr:[ee]}],pb:[{pb:[ee]}],pl:[{pl:[ee]}],m:[{m:[ce]}],mx:[{mx:[ce]}],my:[{my:[ce]}],ms:[{ms:[ce]}],me:[{me:[ce]}],mt:[{mt:[ce]}],mr:[{mr:[ce]}],mb:[{mb:[ce]}],ml:[{ml:[ce]}],"space-x":[{"space-x":[et]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[et]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Gn,o]}],"min-w":[{"min-w":[Gn,o,"min","max","fit"]}],"max-w":[{"max-w":[Gn,o,"none","full","min","max","fit","prose",{screen:[Yu]},Yu]}],h:[{h:[Gn,o,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Gn,o,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Gn,o,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Gn,o,"auto","min","max","fit"]}],"font-size":[{text:["base",Yu,Ku]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",mS]}],"font-family":[{font:[V_]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Gn]}],"line-clamp":[{"line-clamp":["none",Jp,mS]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Oc,Gn]}],"list-image":[{"list-image":["none",Gn]}],"list-style-type":[{list:["none","disc","decimal",Gn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[i]}],"placeholder-opacity":[{"placeholder-opacity":[oe]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[i]}],"text-opacity":[{"text-opacity":[oe]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Nt(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Oc,Ku]}],"underline-offset":[{"underline-offset":["auto",Oc,Gn]}],"text-decoration-color":[{decoration:[i]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Dt()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Gn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Gn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[oe]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...ti(),R$]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",M$]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},k$]}],"bg-color":[{bg:[i]}],"gradient-from-pos":[{from:[ue]}],"gradient-via-pos":[{via:[ue]}],"gradient-to-pos":[{to:[ue]}],"gradient-from":[{from:[te]}],"gradient-via":[{via:[te]}],"gradient-to":[{to:[te]}],rounded:[{rounded:[E]}],"rounded-s":[{"rounded-s":[E]}],"rounded-e":[{"rounded-e":[E]}],"rounded-t":[{"rounded-t":[E]}],"rounded-r":[{"rounded-r":[E]}],"rounded-b":[{"rounded-b":[E]}],"rounded-l":[{"rounded-l":[E]}],"rounded-ss":[{"rounded-ss":[E]}],"rounded-se":[{"rounded-se":[E]}],"rounded-ee":[{"rounded-ee":[E]}],"rounded-es":[{"rounded-es":[E]}],"rounded-tl":[{"rounded-tl":[E]}],"rounded-tr":[{"rounded-tr":[E]}],"rounded-br":[{"rounded-br":[E]}],"rounded-bl":[{"rounded-bl":[E]}],"border-w":[{border:[s]}],"border-w-x":[{"border-x":[s]}],"border-w-y":[{"border-y":[s]}],"border-w-s":[{"border-s":[s]}],"border-w-e":[{"border-e":[s]}],"border-w-t":[{"border-t":[s]}],"border-w-r":[{"border-r":[s]}],"border-w-b":[{"border-b":[s]}],"border-w-l":[{"border-l":[s]}],"border-opacity":[{"border-opacity":[oe]}],"border-style":[{border:[...Nt(),"hidden"]}],"divide-x":[{"divide-x":[s]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[s]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[oe]}],"divide-style":[{divide:Nt()}],"border-color":[{border:[v]}],"border-color-x":[{"border-x":[v]}],"border-color-y":[{"border-y":[v]}],"border-color-s":[{"border-s":[v]}],"border-color-e":[{"border-e":[v]}],"border-color-t":[{"border-t":[v]}],"border-color-r":[{"border-r":[v]}],"border-color-b":[{"border-b":[v]}],"border-color-l":[{"border-l":[v]}],"divide-color":[{divide:[v]}],"outline-style":[{outline:["",...Nt()]}],"outline-offset":[{"outline-offset":[Oc,Gn]}],"outline-w":[{outline:[Oc,Ku]}],"outline-color":[{outline:[i]}],"ring-w":[{ring:Kt()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[i]}],"ring-opacity":[{"ring-opacity":[oe]}],"ring-offset-w":[{"ring-offset":[Oc,Ku]}],"ring-offset-color":[{"ring-offset":[i]}],shadow:[{shadow:["","inner","none",Yu,N$]}],"shadow-color":[{shadow:[V_]}],opacity:[{opacity:[oe]}],"mix-blend":[{"mix-blend":[...bi(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":bi()}],filter:[{filter:["","none"]}],blur:[{blur:[c]}],brightness:[{brightness:[m]}],contrast:[{contrast:[O]}],"drop-shadow":[{"drop-shadow":["","none",Yu,Gn]}],grayscale:[{grayscale:[j]}],"hue-rotate":[{"hue-rotate":[G]}],invert:[{invert:[W]}],saturate:[{saturate:[Q]}],sepia:[{sepia:[pe]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[c]}],"backdrop-brightness":[{"backdrop-brightness":[m]}],"backdrop-contrast":[{"backdrop-contrast":[O]}],"backdrop-grayscale":[{"backdrop-grayscale":[j]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[G]}],"backdrop-invert":[{"backdrop-invert":[W]}],"backdrop-opacity":[{"backdrop-opacity":[oe]}],"backdrop-saturate":[{"backdrop-saturate":[Q]}],"backdrop-sepia":[{"backdrop-sepia":[pe]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[I]}],"border-spacing-x":[{"border-spacing-x":[I]}],"border-spacing-y":[{"border-spacing-y":[I]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Gn]}],duration:[{duration:jt()}],ease:[{ease:["linear","in","out","in-out",Gn]}],delay:[{delay:jt()}],animate:[{animate:["none","spin","ping","pulse","bounce",Gn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[Ie]}],"scale-x":[{"scale-x":[Ie]}],"scale-y":[{"scale-y":[Ie]}],rotate:[{rotate:[B_,Gn]}],"translate-x":[{"translate-x":[at]}],"translate-y":[{"translate-y":[at]}],"skew-x":[{"skew-x":[Ke]}],"skew-y":[{"skew-y":[Ke]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Gn]}],accent:[{accent:["auto",i]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Gn]}],"caret-color":[{caret:[i]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Dt()}],"scroll-mx":[{"scroll-mx":Dt()}],"scroll-my":[{"scroll-my":Dt()}],"scroll-ms":[{"scroll-ms":Dt()}],"scroll-me":[{"scroll-me":Dt()}],"scroll-mt":[{"scroll-mt":Dt()}],"scroll-mr":[{"scroll-mr":Dt()}],"scroll-mb":[{"scroll-mb":Dt()}],"scroll-ml":[{"scroll-ml":Dt()}],"scroll-p":[{"scroll-p":Dt()}],"scroll-px":[{"scroll-px":Dt()}],"scroll-py":[{"scroll-py":Dt()}],"scroll-ps":[{"scroll-ps":Dt()}],"scroll-pe":[{"scroll-pe":Dt()}],"scroll-pt":[{"scroll-pt":Dt()}],"scroll-pr":[{"scroll-pr":Dt()}],"scroll-pb":[{"scroll-pb":Dt()}],"scroll-pl":[{"scroll-pl":Dt()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Gn]}],fill:[{fill:[i,"none"]}],"stroke-w":[{stroke:[Oc,Ku,mS]}],stroke:[{stroke:[i,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},j$=v$(F$);function ui(...i){return j$(xz(i))}const B$=BG,Rz=V.forwardRef(({className:i,...o},c)=>x.jsx(hz,{ref:c,className:ui("fixed top-0 left-1/2 -translate-x-1/2 z-[100] flex max-h-screen w-full flex-col-reverse p-4 md:max-w-[420px]",i),...o}));Rz.displayName=hz.displayName;const V$=Cm("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Dz=V.forwardRef(({className:i,variant:o,...c},m)=>x.jsx(fz,{ref:m,className:ui(V$({variant:o}),i),...c}));Dz.displayName=fz.displayName;const U$=V.forwardRef(({className:i,...o},c)=>x.jsx(gz,{ref:c,className:ui("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",i),...o}));U$.displayName=gz.displayName;const kz=V.forwardRef(({className:i,...o},c)=>x.jsx(_z,{ref:c,className:ui("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",i),"toast-close":"",...o,children:x.jsx(oC,{className:"h-4 w-4"})}));kz.displayName=_z.displayName;const Nz=V.forwardRef(({className:i,...o},c)=>x.jsx(pz,{ref:c,className:ui("text-sm font-semibold",i),...o}));Nz.displayName=pz.displayName;const Lz=V.forwardRef(({className:i,...o},c)=>x.jsx(mz,{ref:c,className:ui("text-sm opacity-90",i),...o}));Lz.displayName=mz.displayName;function G$(){const{toasts:i}=ha();return x.jsxs(B$,{children:[i.map(function({id:o,title:c,description:m,action:v,...E}){return x.jsxs(Dz,{...E,children:[x.jsxs("div",{className:"grid gap-1",children:[c&&x.jsx(Nz,{children:c}),m&&x.jsx(Lz,{children:m})]}),v,x.jsx(kz,{})]},o)}),x.jsx(Rz,{})]})}var SD=["light","dark"],$$="(prefers-color-scheme: dark)",H$=V.createContext(void 0),q$={setTheme:i=>{},themes:[]},W$=()=>{var i;return(i=V.useContext(H$))!=null?i:q$};V.memo(({forcedTheme:i,storageKey:o,attribute:c,enableSystem:m,enableColorScheme:v,defaultTheme:E,value:I,attrs:s,nonce:O})=>{let j=E==="system",G=c==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${s.map(ue=>`'${ue}'`).join(",")})`};`:`var d=document.documentElement,n='${c}',s='setAttribute';`,W=v?SD.includes(E)&&E?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${E}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",B=(ue,J=!1,ce=!0)=>{let oe=I?I[ue]:ue,ee=J?ue+"|| ''":`'${oe}'`,Q="";return v&&ce&&!J&&SD.includes(ue)&&(Q+=`d.style.colorScheme = '${ue}';`),c==="class"?J||oe?Q+=`c.add(${ee})`:Q+="null":oe&&(Q+=`d[s](n,${ee})`),Q},te=i?`!function(){${G}${B(i)}}()`:m?`!function(){try{${G}var e=localStorage.getItem('${o}');if('system'===e||(!e&&${j})){var t='${$$}',m=window.matchMedia(t);if(m.media!==t||m.matches){${B("dark")}}else{${B("light")}}}else if(e){${I?`var x=${JSON.stringify(I)};`:""}${B(I?"x[e]":"e",!0)}}${j?"":"else{"+B(E,!1,!1)+"}"}${W}}catch(e){}}()`:`!function(){try{${G}var e=localStorage.getItem('${o}');if(e){${I?`var x=${JSON.stringify(I)};`:""}${B(I?"x[e]":"e",!0)}}else{${B(E,!1,!1)};}${W}}catch(t){}}();`;return V.createElement("script",{nonce:O,dangerouslySetInnerHTML:{__html:te}})});var Z$=i=>{switch(i){case"success":return Y$;case"info":return Q$;case"warning":return J$;case"error":return eH;default:return null}},X$=Array(12).fill(0),K$=({visible:i})=>Vt.createElement("div",{className:"sonner-loading-wrapper","data-visible":i},Vt.createElement("div",{className:"sonner-spinner"},X$.map((o,c)=>Vt.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${c}`})))),Y$=Vt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Vt.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),J$=Vt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},Vt.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),Q$=Vt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Vt.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),eH=Vt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Vt.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),tH=()=>{let[i,o]=Vt.useState(document.hidden);return Vt.useEffect(()=>{let c=()=>{o(document.hidden)};return document.addEventListener("visibilitychange",c),()=>window.removeEventListener("visibilitychange",c)},[]),i},LT=1,iH=class{constructor(){this.subscribe=i=>(this.subscribers.push(i),()=>{let o=this.subscribers.indexOf(i);this.subscribers.splice(o,1)}),this.publish=i=>{this.subscribers.forEach(o=>o(i))},this.addToast=i=>{this.publish(i),this.toasts=[...this.toasts,i]},this.create=i=>{var o;let{message:c,...m}=i,v=typeof(i==null?void 0:i.id)=="number"||((o=i.id)==null?void 0:o.length)>0?i.id:LT++,E=this.toasts.find(s=>s.id===v),I=i.dismissible===void 0?!0:i.dismissible;return E?this.toasts=this.toasts.map(s=>s.id===v?(this.publish({...s,...i,id:v,title:c}),{...s,...i,id:v,dismissible:I,title:c}):s):this.addToast({title:c,...m,dismissible:I,id:v}),v},this.dismiss=i=>(i||this.toasts.forEach(o=>{this.subscribers.forEach(c=>c({id:o.id,dismiss:!0}))}),this.subscribers.forEach(o=>o({id:i,dismiss:!0})),i),this.message=(i,o)=>this.create({...o,message:i}),this.error=(i,o)=>this.create({...o,message:i,type:"error"}),this.success=(i,o)=>this.create({...o,type:"success",message:i}),this.info=(i,o)=>this.create({...o,type:"info",message:i}),this.warning=(i,o)=>this.create({...o,type:"warning",message:i}),this.loading=(i,o)=>this.create({...o,type:"loading",message:i}),this.promise=(i,o)=>{if(!o)return;let c;o.loading!==void 0&&(c=this.create({...o,promise:i,type:"loading",message:o.loading,description:typeof o.description!="function"?o.description:void 0}));let m=i instanceof Promise?i:i(),v=c!==void 0;return m.then(async E=>{if(rH(E)&&!E.ok){v=!1;let I=typeof o.error=="function"?await o.error(`HTTP error! status: ${E.status}`):o.error,s=typeof o.description=="function"?await o.description(`HTTP error! status: ${E.status}`):o.description;this.create({id:c,type:"error",message:I,description:s})}else if(o.success!==void 0){v=!1;let I=typeof o.success=="function"?await o.success(E):o.success,s=typeof o.description=="function"?await o.description(E):o.description;this.create({id:c,type:"success",message:I,description:s})}}).catch(async E=>{if(o.error!==void 0){v=!1;let I=typeof o.error=="function"?await o.error(E):o.error,s=typeof o.description=="function"?await o.description(E):o.description;this.create({id:c,type:"error",message:I,description:s})}}).finally(()=>{var E;v&&(this.dismiss(c),c=void 0),(E=o.finally)==null||E.call(o)}),c},this.custom=(i,o)=>{let c=(o==null?void 0:o.id)||LT++;return this.create({jsx:i(c),id:c,...o}),c},this.subscribers=[],this.toasts=[]}},va=new iH,nH=(i,o)=>{let c=(o==null?void 0:o.id)||LT++;return va.addToast({title:i,...o,id:c}),c},rH=i=>i&&typeof i=="object"&&"ok"in i&&typeof i.ok=="boolean"&&"status"in i&&typeof i.status=="number",sH=nH,oH=()=>va.toasts;Object.assign(sH,{success:va.success,info:va.info,warning:va.warning,error:va.error,custom:va.custom,message:va.message,promise:va.promise,dismiss:va.dismiss,loading:va.loading},{getHistory:oH});function aH(i,{insertAt:o}={}){if(typeof document>"u")return;let c=document.head||document.getElementsByTagName("head")[0],m=document.createElement("style");m.type="text/css",o==="top"&&c.firstChild?c.insertBefore(m,c.firstChild):c.appendChild(m),m.styleSheet?m.styleSheet.cssText=i:m.appendChild(document.createTextNode(i))}aH(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999}:where([data-sonner-toaster][data-x-position="right"]){right:max(var(--offset),env(safe-area-inset-right))}:where([data-sonner-toaster][data-x-position="left"]){left:max(var(--offset),env(safe-area-inset-left))}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:max(var(--offset),env(safe-area-inset-top))}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:max(var(--offset),env(safe-area-inset-bottom))}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;background:var(--gray1);color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:0;right:0;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount, 0px));transition:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation:swipe-out .2s ease-out forwards}@keyframes swipe-out{0%{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount)));opacity:1}to{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount) + var(--lift) * -100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;--mobile-offset: 16px;right:var(--mobile-offset);left:var(--mobile-offset);width:100%}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset)}[data-sonner-toaster][data-y-position=bottom]{bottom:20px}[data-sonner-toaster][data-y-position=top]{top:20px}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset);right:var(--mobile-offset);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function E0(i){return i.label!==void 0}var lH=3,cH="32px",uH=4e3,dH=356,hH=14,fH=20,pH=200;function mH(...i){return i.filter(Boolean).join(" ")}var gH=i=>{var o,c,m,v,E,I,s,O,j,G;let{invert:W,toast:B,unstyled:te,interacting:ue,setHeights:J,visibleToasts:ce,heights:oe,index:ee,toasts:Q,expanded:Ie,removeToast:pe,defaultRichColors:Ke,closeButton:et,style:at,cancelButtonStyle:Xt,actionButtonStyle:Ct,className:mt="",descriptionClassName:Dt="",duration:Kt,position:Pt,gap:ti,loadingIcon:Nt,expandByDefault:bi,classNames:ot,icons:Tt,closeButtonAriaLabel:ii="Close toast",pauseWhenPageIsHidden:jt,cn:gi}=i,[en,Dn]=Vt.useState(!1),[ir,wi]=Vt.useState(!1),[ni,Fi]=Vt.useState(!1),[nn,Ri]=Vt.useState(!1),[kn,Cn]=Vt.useState(0),[Zr,wr]=Vt.useState(0),On=Vt.useRef(null),gr=Vt.useRef(null),bs=ee===0,Ma=ee+1<=ce,_r=B.type,Ge=B.dismissible!==!1,rt=B.className||"",Rt=B.descriptionClassName||"",fi=Vt.useMemo(()=>oe.findIndex(yi=>yi.toastId===B.id)||0,[oe,B.id]),di=Vt.useMemo(()=>{var yi;return(yi=B.closeButton)!=null?yi:et},[B.closeButton,et]),ri=Vt.useMemo(()=>B.duration||Kt||uH,[B.duration,Kt]),Ci=Vt.useRef(0),an=Vt.useRef(0),Jn=Vt.useRef(0),br=Vt.useRef(null),[mo,Ar]=Pt.split("-"),Ss=Vt.useMemo(()=>oe.reduce((yi,hr,lr)=>lr>=fi?yi:yi+hr.height,0),[oe,fi]),io=tH(),no=B.invert||W,go=_r==="loading";an.current=Vt.useMemo(()=>fi*ti+Ss,[fi,Ss]),Vt.useEffect(()=>{Dn(!0)},[]),Vt.useLayoutEffect(()=>{if(!en)return;let yi=gr.current,hr=yi.style.height;yi.style.height="auto";let lr=yi.getBoundingClientRect().height;yi.style.height=hr,wr(lr),J(jr=>jr.find($s=>$s.toastId===B.id)?jr.map($s=>$s.toastId===B.id?{...$s,height:lr}:$s):[{toastId:B.id,height:lr,position:B.position},...jr])},[en,B.title,B.description,J,B.id]);let as=Vt.useCallback(()=>{wi(!0),Cn(an.current),J(yi=>yi.filter(hr=>hr.toastId!==B.id)),setTimeout(()=>{pe(B)},pH)},[B,pe,J,an]);Vt.useEffect(()=>{if(B.promise&&_r==="loading"||B.duration===1/0||B.type==="loading")return;let yi,hr=ri;return Ie||ue||jt&&io?(()=>{if(Jn.current<Ci.current){let lr=new Date().getTime()-Ci.current;hr=hr-lr}Jn.current=new Date().getTime()})():hr!==1/0&&(Ci.current=new Date().getTime(),yi=setTimeout(()=>{var lr;(lr=B.onAutoClose)==null||lr.call(B,B),as()},hr)),()=>clearTimeout(yi)},[Ie,ue,bi,B,ri,as,B.promise,_r,jt,io]),Vt.useEffect(()=>{let yi=gr.current;if(yi){let hr=yi.getBoundingClientRect().height;return wr(hr),J(lr=>[{toastId:B.id,height:hr,position:B.position},...lr]),()=>J(lr=>lr.filter(jr=>jr.toastId!==B.id))}},[J,B.id]),Vt.useEffect(()=>{B.delete&&as()},[as,B.delete]);function Ra(){return Tt!=null&&Tt.loading?Vt.createElement("div",{className:"sonner-loader","data-visible":_r==="loading"},Tt.loading):Nt?Vt.createElement("div",{className:"sonner-loader","data-visible":_r==="loading"},Nt):Vt.createElement(K$,{visible:_r==="loading"})}return Vt.createElement("li",{"aria-live":B.important?"assertive":"polite","aria-atomic":"true",role:"status",tabIndex:0,ref:gr,className:gi(mt,rt,ot==null?void 0:ot.toast,(o=B==null?void 0:B.classNames)==null?void 0:o.toast,ot==null?void 0:ot.default,ot==null?void 0:ot[_r],(c=B==null?void 0:B.classNames)==null?void 0:c[_r]),"data-sonner-toast":"","data-rich-colors":(m=B.richColors)!=null?m:Ke,"data-styled":!(B.jsx||B.unstyled||te),"data-mounted":en,"data-promise":!!B.promise,"data-removed":ir,"data-visible":Ma,"data-y-position":mo,"data-x-position":Ar,"data-index":ee,"data-front":bs,"data-swiping":ni,"data-dismissible":Ge,"data-type":_r,"data-invert":no,"data-swipe-out":nn,"data-expanded":!!(Ie||bi&&en),style:{"--index":ee,"--toasts-before":ee,"--z-index":Q.length-ee,"--offset":`${ir?kn:an.current}px`,"--initial-height":bi?"auto":`${Zr}px`,...at,...B.style},onPointerDown:yi=>{go||!Ge||(On.current=new Date,Cn(an.current),yi.target.setPointerCapture(yi.pointerId),yi.target.tagName!=="BUTTON"&&(Fi(!0),br.current={x:yi.clientX,y:yi.clientY}))},onPointerUp:()=>{var yi,hr,lr,jr;if(nn||!Ge)return;br.current=null;let $s=Number(((yi=gr.current)==null?void 0:yi.style.getPropertyValue("--swipe-amount").replace("px",""))||0),Al=new Date().getTime()-((hr=On.current)==null?void 0:hr.getTime()),Il=Math.abs($s)/Al;if(Math.abs($s)>=fH||Il>.11){Cn(an.current),(lr=B.onDismiss)==null||lr.call(B,B),as(),Ri(!0);return}(jr=gr.current)==null||jr.style.setProperty("--swipe-amount","0px"),Fi(!1)},onPointerMove:yi=>{var hr;if(!br.current||!Ge)return;let lr=yi.clientY-br.current.y,jr=yi.clientX-br.current.x,$s=(mo==="top"?Math.min:Math.max)(0,lr),Al=yi.pointerType==="touch"?10:2;Math.abs($s)>Al?(hr=gr.current)==null||hr.style.setProperty("--swipe-amount",`${lr}px`):Math.abs(jr)>Al&&(br.current=null)}},di&&!B.jsx?Vt.createElement("button",{"aria-label":ii,"data-disabled":go,"data-close-button":!0,onClick:go||!Ge?()=>{}:()=>{var yi;as(),(yi=B.onDismiss)==null||yi.call(B,B)},className:gi(ot==null?void 0:ot.closeButton,(v=B==null?void 0:B.classNames)==null?void 0:v.closeButton)},Vt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},Vt.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),Vt.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))):null,B.jsx||Vt.isValidElement(B.title)?B.jsx||B.title:Vt.createElement(Vt.Fragment,null,_r||B.icon||B.promise?Vt.createElement("div",{"data-icon":"",className:gi(ot==null?void 0:ot.icon,(E=B==null?void 0:B.classNames)==null?void 0:E.icon)},B.promise||B.type==="loading"&&!B.icon?B.icon||Ra():null,B.type!=="loading"?B.icon||(Tt==null?void 0:Tt[_r])||Z$(_r):null):null,Vt.createElement("div",{"data-content":"",className:gi(ot==null?void 0:ot.content,(I=B==null?void 0:B.classNames)==null?void 0:I.content)},Vt.createElement("div",{"data-title":"",className:gi(ot==null?void 0:ot.title,(s=B==null?void 0:B.classNames)==null?void 0:s.title)},B.title),B.description?Vt.createElement("div",{"data-description":"",className:gi(Dt,Rt,ot==null?void 0:ot.description,(O=B==null?void 0:B.classNames)==null?void 0:O.description)},B.description):null),Vt.isValidElement(B.cancel)?B.cancel:B.cancel&&E0(B.cancel)?Vt.createElement("button",{"data-button":!0,"data-cancel":!0,style:B.cancelButtonStyle||Xt,onClick:yi=>{var hr,lr;E0(B.cancel)&&Ge&&((lr=(hr=B.cancel).onClick)==null||lr.call(hr,yi),as())},className:gi(ot==null?void 0:ot.cancelButton,(j=B==null?void 0:B.classNames)==null?void 0:j.cancelButton)},B.cancel.label):null,Vt.isValidElement(B.action)?B.action:B.action&&E0(B.action)?Vt.createElement("button",{"data-button":!0,"data-action":!0,style:B.actionButtonStyle||Ct,onClick:yi=>{var hr,lr;E0(B.action)&&(yi.defaultPrevented||((lr=(hr=B.action).onClick)==null||lr.call(hr,yi),as()))},className:gi(ot==null?void 0:ot.actionButton,(G=B==null?void 0:B.classNames)==null?void 0:G.actionButton)},B.action.label):null))};function TD(){if(typeof window>"u"||typeof document>"u")return"ltr";let i=document.documentElement.getAttribute("dir");return i==="auto"||!i?window.getComputedStyle(document.documentElement).direction:i}var _H=i=>{let{invert:o,position:c="bottom-right",hotkey:m=["altKey","KeyT"],expand:v,closeButton:E,className:I,offset:s,theme:O="light",richColors:j,duration:G,style:W,visibleToasts:B=lH,toastOptions:te,dir:ue=TD(),gap:J=hH,loadingIcon:ce,icons:oe,containerAriaLabel:ee="Notifications",pauseWhenPageIsHidden:Q,cn:Ie=mH}=i,[pe,Ke]=Vt.useState([]),et=Vt.useMemo(()=>Array.from(new Set([c].concat(pe.filter(jt=>jt.position).map(jt=>jt.position)))),[pe,c]),[at,Xt]=Vt.useState([]),[Ct,mt]=Vt.useState(!1),[Dt,Kt]=Vt.useState(!1),[Pt,ti]=Vt.useState(O!=="system"?O:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Nt=Vt.useRef(null),bi=m.join("+").replace(/Key/g,"").replace(/Digit/g,""),ot=Vt.useRef(null),Tt=Vt.useRef(!1),ii=Vt.useCallback(jt=>{var gi;(gi=pe.find(en=>en.id===jt.id))!=null&&gi.delete||va.dismiss(jt.id),Ke(en=>en.filter(({id:Dn})=>Dn!==jt.id))},[pe]);return Vt.useEffect(()=>va.subscribe(jt=>{if(jt.dismiss){Ke(gi=>gi.map(en=>en.id===jt.id?{...en,delete:!0}:en));return}setTimeout(()=>{OL.flushSync(()=>{Ke(gi=>{let en=gi.findIndex(Dn=>Dn.id===jt.id);return en!==-1?[...gi.slice(0,en),{...gi[en],...jt},...gi.slice(en+1)]:[jt,...gi]})})})}),[]),Vt.useEffect(()=>{if(O!=="system"){ti(O);return}O==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?ti("dark"):ti("light")),typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:jt})=>{ti(jt?"dark":"light")})},[O]),Vt.useEffect(()=>{pe.length<=1&&mt(!1)},[pe]),Vt.useEffect(()=>{let jt=gi=>{var en,Dn;m.every(ir=>gi[ir]||gi.code===ir)&&(mt(!0),(en=Nt.current)==null||en.focus()),gi.code==="Escape"&&(document.activeElement===Nt.current||(Dn=Nt.current)!=null&&Dn.contains(document.activeElement))&&mt(!1)};return document.addEventListener("keydown",jt),()=>document.removeEventListener("keydown",jt)},[m]),Vt.useEffect(()=>{if(Nt.current)return()=>{ot.current&&(ot.current.focus({preventScroll:!0}),ot.current=null,Tt.current=!1)}},[Nt.current]),pe.length?Vt.createElement("section",{"aria-label":`${ee} ${bi}`,tabIndex:-1},et.map((jt,gi)=>{var en;let[Dn,ir]=jt.split("-");return Vt.createElement("ol",{key:jt,dir:ue==="auto"?TD():ue,tabIndex:-1,ref:Nt,className:I,"data-sonner-toaster":!0,"data-theme":Pt,"data-y-position":Dn,"data-x-position":ir,style:{"--front-toast-height":`${((en=at[0])==null?void 0:en.height)||0}px`,"--offset":typeof s=="number"?`${s}px`:s||cH,"--width":`${dH}px`,"--gap":`${J}px`,...W},onBlur:wi=>{Tt.current&&!wi.currentTarget.contains(wi.relatedTarget)&&(Tt.current=!1,ot.current&&(ot.current.focus({preventScroll:!0}),ot.current=null))},onFocus:wi=>{wi.target instanceof HTMLElement&&wi.target.dataset.dismissible==="false"||Tt.current||(Tt.current=!0,ot.current=wi.relatedTarget)},onMouseEnter:()=>mt(!0),onMouseMove:()=>mt(!0),onMouseLeave:()=>{Dt||mt(!1)},onPointerDown:wi=>{wi.target instanceof HTMLElement&&wi.target.dataset.dismissible==="false"||Kt(!0)},onPointerUp:()=>Kt(!1)},pe.filter(wi=>!wi.position&&gi===0||wi.position===jt).map((wi,ni)=>{var Fi,nn;return Vt.createElement(gH,{key:wi.id,icons:oe,index:ni,toast:wi,defaultRichColors:j,duration:(Fi=te==null?void 0:te.duration)!=null?Fi:G,className:te==null?void 0:te.className,descriptionClassName:te==null?void 0:te.descriptionClassName,invert:o,visibleToasts:B,closeButton:(nn=te==null?void 0:te.closeButton)!=null?nn:E,interacting:Dt,position:jt,style:te==null?void 0:te.style,unstyled:te==null?void 0:te.unstyled,classNames:te==null?void 0:te.classNames,cancelButtonStyle:te==null?void 0:te.cancelButtonStyle,actionButtonStyle:te==null?void 0:te.actionButtonStyle,removeToast:ii,toasts:pe.filter(Ri=>Ri.position==wi.position),heights:at.filter(Ri=>Ri.position==wi.position),setHeights:Xt,expandByDefault:v,gap:J,loadingIcon:ce,expanded:Ct,pauseWhenPageIsHidden:Q,cn:Ie})}))})):null};const yH=({...i})=>{const{theme:o="system"}=W$();return x.jsx(_H,{theme:o,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...i})};var xH=Nk.useId||(()=>{}),vH=0;function vl(i){const[o,c]=V.useState(xH());return to(()=>{i||c(m=>m??String(vH++))},[i]),i||(o?`radix-${o}`:"")}const wH=["top","right","bottom","left"],Cd=Math.min,Sa=Math.max,C1=Math.round,C0=Math.floor,Ad=i=>({x:i,y:i}),bH={left:"right",right:"left",bottom:"top",top:"bottom"},SH={start:"end",end:"start"};function zT(i,o,c){return Sa(i,Cd(o,c))}function Jc(i,o){return typeof i=="function"?i(o):i}function Qc(i){return i.split("-")[0]}function Pm(i){return i.split("-")[1]}function lC(i){return i==="x"?"y":"x"}function cC(i){return i==="y"?"height":"width"}function Id(i){return["top","bottom"].includes(Qc(i))?"y":"x"}function uC(i){return lC(Id(i))}function TH(i,o,c){c===void 0&&(c=!1);const m=Pm(i),v=uC(i),E=cC(v);let I=v==="x"?m===(c?"end":"start")?"right":"left":m==="start"?"bottom":"top";return o.reference[E]>o.floating[E]&&(I=A1(I)),[I,A1(I)]}function EH(i){const o=A1(i);return[OT(i),o,OT(o)]}function OT(i){return i.replace(/start|end/g,o=>SH[o])}function CH(i,o,c){const m=["left","right"],v=["right","left"],E=["top","bottom"],I=["bottom","top"];switch(i){case"top":case"bottom":return c?o?v:m:o?m:v;case"left":case"right":return o?E:I;default:return[]}}function AH(i,o,c,m){const v=Pm(i);let E=CH(Qc(i),c==="start",m);return v&&(E=E.map(I=>I+"-"+v),o&&(E=E.concat(E.map(OT)))),E}function A1(i){return i.replace(/left|right|bottom|top/g,o=>bH[o])}function IH(i){return{top:0,right:0,bottom:0,left:0,...i}}function zz(i){return typeof i!="number"?IH(i):{top:i,right:i,bottom:i,left:i}}function I1(i){const{x:o,y:c,width:m,height:v}=i;return{width:m,height:v,top:c,left:o,right:o+m,bottom:c+v,x:o,y:c}}function ED(i,o,c){let{reference:m,floating:v}=i;const E=Id(o),I=uC(o),s=cC(I),O=Qc(o),j=E==="y",G=m.x+m.width/2-v.width/2,W=m.y+m.height/2-v.height/2,B=m[s]/2-v[s]/2;let te;switch(O){case"top":te={x:G,y:m.y-v.height};break;case"bottom":te={x:G,y:m.y+m.height};break;case"right":te={x:m.x+m.width,y:W};break;case"left":te={x:m.x-v.width,y:W};break;default:te={x:m.x,y:m.y}}switch(Pm(o)){case"start":te[I]-=B*(c&&j?-1:1);break;case"end":te[I]+=B*(c&&j?-1:1);break}return te}const PH=async(i,o,c)=>{const{placement:m="bottom",strategy:v="absolute",middleware:E=[],platform:I}=c,s=E.filter(Boolean),O=await(I.isRTL==null?void 0:I.isRTL(o));let j=await I.getElementRects({reference:i,floating:o,strategy:v}),{x:G,y:W}=ED(j,m,O),B=m,te={},ue=0;for(let J=0;J<s.length;J++){const{name:ce,fn:oe}=s[J],{x:ee,y:Q,data:Ie,reset:pe}=await oe({x:G,y:W,initialPlacement:m,placement:B,strategy:v,middlewareData:te,rects:j,platform:I,elements:{reference:i,floating:o}});G=ee??G,W=Q??W,te={...te,[ce]:{...te[ce],...Ie}},pe&&ue<=50&&(ue++,typeof pe=="object"&&(pe.placement&&(B=pe.placement),pe.rects&&(j=pe.rects===!0?await I.getElementRects({reference:i,floating:o,strategy:v}):pe.rects),{x:G,y:W}=ED(j,B,O)),J=-1)}return{x:G,y:W,placement:B,strategy:v,middlewareData:te}};async function My(i,o){var c;o===void 0&&(o={});const{x:m,y:v,platform:E,rects:I,elements:s,strategy:O}=i,{boundary:j="clippingAncestors",rootBoundary:G="viewport",elementContext:W="floating",altBoundary:B=!1,padding:te=0}=Jc(o,i),ue=zz(te),ce=s[B?W==="floating"?"reference":"floating":W],oe=I1(await E.getClippingRect({element:(c=await(E.isElement==null?void 0:E.isElement(ce)))==null||c?ce:ce.contextElement||await(E.getDocumentElement==null?void 0:E.getDocumentElement(s.floating)),boundary:j,rootBoundary:G,strategy:O})),ee=W==="floating"?{x:m,y:v,width:I.floating.width,height:I.floating.height}:I.reference,Q=await(E.getOffsetParent==null?void 0:E.getOffsetParent(s.floating)),Ie=await(E.isElement==null?void 0:E.isElement(Q))?await(E.getScale==null?void 0:E.getScale(Q))||{x:1,y:1}:{x:1,y:1},pe=I1(E.convertOffsetParentRelativeRectToViewportRelativeRect?await E.convertOffsetParentRelativeRectToViewportRelativeRect({elements:s,rect:ee,offsetParent:Q,strategy:O}):ee);return{top:(oe.top-pe.top+ue.top)/Ie.y,bottom:(pe.bottom-oe.bottom+ue.bottom)/Ie.y,left:(oe.left-pe.left+ue.left)/Ie.x,right:(pe.right-oe.right+ue.right)/Ie.x}}const MH=i=>({name:"arrow",options:i,async fn(o){const{x:c,y:m,placement:v,rects:E,platform:I,elements:s,middlewareData:O}=o,{element:j,padding:G=0}=Jc(i,o)||{};if(j==null)return{};const W=zz(G),B={x:c,y:m},te=uC(v),ue=cC(te),J=await I.getDimensions(j),ce=te==="y",oe=ce?"top":"left",ee=ce?"bottom":"right",Q=ce?"clientHeight":"clientWidth",Ie=E.reference[ue]+E.reference[te]-B[te]-E.floating[ue],pe=B[te]-E.reference[te],Ke=await(I.getOffsetParent==null?void 0:I.getOffsetParent(j));let et=Ke?Ke[Q]:0;(!et||!await(I.isElement==null?void 0:I.isElement(Ke)))&&(et=s.floating[Q]||E.floating[ue]);const at=Ie/2-pe/2,Xt=et/2-J[ue]/2-1,Ct=Cd(W[oe],Xt),mt=Cd(W[ee],Xt),Dt=Ct,Kt=et-J[ue]-mt,Pt=et/2-J[ue]/2+at,ti=zT(Dt,Pt,Kt),Nt=!O.arrow&&Pm(v)!=null&&Pt!==ti&&E.reference[ue]/2-(Pt<Dt?Ct:mt)-J[ue]/2<0,bi=Nt?Pt<Dt?Pt-Dt:Pt-Kt:0;return{[te]:B[te]+bi,data:{[te]:ti,centerOffset:Pt-ti-bi,...Nt&&{alignmentOffset:bi}},reset:Nt}}}),RH=function(i){return i===void 0&&(i={}),{name:"flip",options:i,async fn(o){var c,m;const{placement:v,middlewareData:E,rects:I,initialPlacement:s,platform:O,elements:j}=o,{mainAxis:G=!0,crossAxis:W=!0,fallbackPlacements:B,fallbackStrategy:te="bestFit",fallbackAxisSideDirection:ue="none",flipAlignment:J=!0,...ce}=Jc(i,o);if((c=E.arrow)!=null&&c.alignmentOffset)return{};const oe=Qc(v),ee=Id(s),Q=Qc(s)===s,Ie=await(O.isRTL==null?void 0:O.isRTL(j.floating)),pe=B||(Q||!J?[A1(s)]:EH(s)),Ke=ue!=="none";!B&&Ke&&pe.push(...AH(s,J,ue,Ie));const et=[s,...pe],at=await My(o,ce),Xt=[];let Ct=((m=E.flip)==null?void 0:m.overflows)||[];if(G&&Xt.push(at[oe]),W){const Pt=TH(v,I,Ie);Xt.push(at[Pt[0]],at[Pt[1]])}if(Ct=[...Ct,{placement:v,overflows:Xt}],!Xt.every(Pt=>Pt<=0)){var mt,Dt;const Pt=(((mt=E.flip)==null?void 0:mt.index)||0)+1,ti=et[Pt];if(ti)return{data:{index:Pt,overflows:Ct},reset:{placement:ti}};let Nt=(Dt=Ct.filter(bi=>bi.overflows[0]<=0).sort((bi,ot)=>bi.overflows[1]-ot.overflows[1])[0])==null?void 0:Dt.placement;if(!Nt)switch(te){case"bestFit":{var Kt;const bi=(Kt=Ct.filter(ot=>{if(Ke){const Tt=Id(ot.placement);return Tt===ee||Tt==="y"}return!0}).map(ot=>[ot.placement,ot.overflows.filter(Tt=>Tt>0).reduce((Tt,ii)=>Tt+ii,0)]).sort((ot,Tt)=>ot[1]-Tt[1])[0])==null?void 0:Kt[0];bi&&(Nt=bi);break}case"initialPlacement":Nt=s;break}if(v!==Nt)return{reset:{placement:Nt}}}return{}}}};function CD(i,o){return{top:i.top-o.height,right:i.right-o.width,bottom:i.bottom-o.height,left:i.left-o.width}}function AD(i){return wH.some(o=>i[o]>=0)}const DH=function(i){return i===void 0&&(i={}),{name:"hide",options:i,async fn(o){const{rects:c}=o,{strategy:m="referenceHidden",...v}=Jc(i,o);switch(m){case"referenceHidden":{const E=await My(o,{...v,elementContext:"reference"}),I=CD(E,c.reference);return{data:{referenceHiddenOffsets:I,referenceHidden:AD(I)}}}case"escaped":{const E=await My(o,{...v,altBoundary:!0}),I=CD(E,c.floating);return{data:{escapedOffsets:I,escaped:AD(I)}}}default:return{}}}}};async function kH(i,o){const{placement:c,platform:m,elements:v}=i,E=await(m.isRTL==null?void 0:m.isRTL(v.floating)),I=Qc(c),s=Pm(c),O=Id(c)==="y",j=["left","top"].includes(I)?-1:1,G=E&&O?-1:1,W=Jc(o,i);let{mainAxis:B,crossAxis:te,alignmentAxis:ue}=typeof W=="number"?{mainAxis:W,crossAxis:0,alignmentAxis:null}:{mainAxis:W.mainAxis||0,crossAxis:W.crossAxis||0,alignmentAxis:W.alignmentAxis};return s&&typeof ue=="number"&&(te=s==="end"?ue*-1:ue),O?{x:te*G,y:B*j}:{x:B*j,y:te*G}}const NH=function(i){return i===void 0&&(i=0),{name:"offset",options:i,async fn(o){var c,m;const{x:v,y:E,placement:I,middlewareData:s}=o,O=await kH(o,i);return I===((c=s.offset)==null?void 0:c.placement)&&(m=s.arrow)!=null&&m.alignmentOffset?{}:{x:v+O.x,y:E+O.y,data:{...O,placement:I}}}}},LH=function(i){return i===void 0&&(i={}),{name:"shift",options:i,async fn(o){const{x:c,y:m,placement:v}=o,{mainAxis:E=!0,crossAxis:I=!1,limiter:s={fn:ce=>{let{x:oe,y:ee}=ce;return{x:oe,y:ee}}},...O}=Jc(i,o),j={x:c,y:m},G=await My(o,O),W=Id(Qc(v)),B=lC(W);let te=j[B],ue=j[W];if(E){const ce=B==="y"?"top":"left",oe=B==="y"?"bottom":"right",ee=te+G[ce],Q=te-G[oe];te=zT(ee,te,Q)}if(I){const ce=W==="y"?"top":"left",oe=W==="y"?"bottom":"right",ee=ue+G[ce],Q=ue-G[oe];ue=zT(ee,ue,Q)}const J=s.fn({...o,[B]:te,[W]:ue});return{...J,data:{x:J.x-c,y:J.y-m,enabled:{[B]:E,[W]:I}}}}}},zH=function(i){return i===void 0&&(i={}),{options:i,fn(o){const{x:c,y:m,placement:v,rects:E,middlewareData:I}=o,{offset:s=0,mainAxis:O=!0,crossAxis:j=!0}=Jc(i,o),G={x:c,y:m},W=Id(v),B=lC(W);let te=G[B],ue=G[W];const J=Jc(s,o),ce=typeof J=="number"?{mainAxis:J,crossAxis:0}:{mainAxis:0,crossAxis:0,...J};if(O){const Q=B==="y"?"height":"width",Ie=E.reference[B]-E.floating[Q]+ce.mainAxis,pe=E.reference[B]+E.reference[Q]-ce.mainAxis;te<Ie?te=Ie:te>pe&&(te=pe)}if(j){var oe,ee;const Q=B==="y"?"width":"height",Ie=["top","left"].includes(Qc(v)),pe=E.reference[W]-E.floating[Q]+(Ie&&((oe=I.offset)==null?void 0:oe[W])||0)+(Ie?0:ce.crossAxis),Ke=E.reference[W]+E.reference[Q]+(Ie?0:((ee=I.offset)==null?void 0:ee[W])||0)-(Ie?ce.crossAxis:0);ue<pe?ue=pe:ue>Ke&&(ue=Ke)}return{[B]:te,[W]:ue}}}},OH=function(i){return i===void 0&&(i={}),{name:"size",options:i,async fn(o){var c,m;const{placement:v,rects:E,platform:I,elements:s}=o,{apply:O=()=>{},...j}=Jc(i,o),G=await My(o,j),W=Qc(v),B=Pm(v),te=Id(v)==="y",{width:ue,height:J}=E.floating;let ce,oe;W==="top"||W==="bottom"?(ce=W,oe=B===(await(I.isRTL==null?void 0:I.isRTL(s.floating))?"start":"end")?"left":"right"):(oe=W,ce=B==="end"?"top":"bottom");const ee=J-G.top-G.bottom,Q=ue-G.left-G.right,Ie=Cd(J-G[ce],ee),pe=Cd(ue-G[oe],Q),Ke=!o.middlewareData.shift;let et=Ie,at=pe;if((c=o.middlewareData.shift)!=null&&c.enabled.x&&(at=Q),(m=o.middlewareData.shift)!=null&&m.enabled.y&&(et=ee),Ke&&!B){const Ct=Sa(G.left,0),mt=Sa(G.right,0),Dt=Sa(G.top,0),Kt=Sa(G.bottom,0);te?at=ue-2*(Ct!==0||mt!==0?Ct+mt:Sa(G.left,G.right)):et=J-2*(Dt!==0||Kt!==0?Dt+Kt:Sa(G.top,G.bottom))}await O({...o,availableWidth:at,availableHeight:et});const Xt=await I.getDimensions(s.floating);return ue!==Xt.width||J!==Xt.height?{reset:{rects:!0}}:{}}}};function dw(){return typeof window<"u"}function Mm(i){return Oz(i)?(i.nodeName||"").toLowerCase():"#document"}function Ca(i){var o;return(i==null||(o=i.ownerDocument)==null?void 0:o.defaultView)||window}function fc(i){var o;return(o=(Oz(i)?i.ownerDocument:i.document)||window.document)==null?void 0:o.documentElement}function Oz(i){return dw()?i instanceof Node||i instanceof Ca(i).Node:!1}function Sl(i){return dw()?i instanceof Element||i instanceof Ca(i).Element:!1}function dc(i){return dw()?i instanceof HTMLElement||i instanceof Ca(i).HTMLElement:!1}function ID(i){return!dw()||typeof ShadowRoot>"u"?!1:i instanceof ShadowRoot||i instanceof Ca(i).ShadowRoot}function qy(i){const{overflow:o,overflowX:c,overflowY:m,display:v}=Tl(i);return/auto|scroll|overlay|hidden|clip/.test(o+m+c)&&!["inline","contents"].includes(v)}function FH(i){return["table","td","th"].includes(Mm(i))}function hw(i){return[":popover-open",":modal"].some(o=>{try{return i.matches(o)}catch{return!1}})}function dC(i){const o=hC(),c=Sl(i)?Tl(i):i;return c.transform!=="none"||c.perspective!=="none"||(c.containerType?c.containerType!=="normal":!1)||!o&&(c.backdropFilter?c.backdropFilter!=="none":!1)||!o&&(c.filter?c.filter!=="none":!1)||["transform","perspective","filter"].some(m=>(c.willChange||"").includes(m))||["paint","layout","strict","content"].some(m=>(c.contain||"").includes(m))}function jH(i){let o=Pd(i);for(;dc(o)&&!_m(o);){if(dC(o))return o;if(hw(o))return null;o=Pd(o)}return null}function hC(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function _m(i){return["html","body","#document"].includes(Mm(i))}function Tl(i){return Ca(i).getComputedStyle(i)}function fw(i){return Sl(i)?{scrollLeft:i.scrollLeft,scrollTop:i.scrollTop}:{scrollLeft:i.scrollX,scrollTop:i.scrollY}}function Pd(i){if(Mm(i)==="html")return i;const o=i.assignedSlot||i.parentNode||ID(i)&&i.host||fc(i);return ID(o)?o.host:o}function Fz(i){const o=Pd(i);return _m(o)?i.ownerDocument?i.ownerDocument.body:i.body:dc(o)&&qy(o)?o:Fz(o)}function Ry(i,o,c){var m;o===void 0&&(o=[]),c===void 0&&(c=!0);const v=Fz(i),E=v===((m=i.ownerDocument)==null?void 0:m.body),I=Ca(v);if(E){const s=FT(I);return o.concat(I,I.visualViewport||[],qy(v)?v:[],s&&c?Ry(s):[])}return o.concat(v,Ry(v,[],c))}function FT(i){return i.parent&&Object.getPrototypeOf(i.parent)?i.frameElement:null}function jz(i){const o=Tl(i);let c=parseFloat(o.width)||0,m=parseFloat(o.height)||0;const v=dc(i),E=v?i.offsetWidth:c,I=v?i.offsetHeight:m,s=C1(c)!==E||C1(m)!==I;return s&&(c=E,m=I),{width:c,height:m,$:s}}function fC(i){return Sl(i)?i:i.contextElement}function Qp(i){const o=fC(i);if(!dc(o))return Ad(1);const c=o.getBoundingClientRect(),{width:m,height:v,$:E}=jz(o);let I=(E?C1(c.width):c.width)/m,s=(E?C1(c.height):c.height)/v;return(!I||!Number.isFinite(I))&&(I=1),(!s||!Number.isFinite(s))&&(s=1),{x:I,y:s}}const BH=Ad(0);function Bz(i){const o=Ca(i);return!hC()||!o.visualViewport?BH:{x:o.visualViewport.offsetLeft,y:o.visualViewport.offsetTop}}function VH(i,o,c){return o===void 0&&(o=!1),!c||o&&c!==Ca(i)?!1:o}function ef(i,o,c,m){o===void 0&&(o=!1),c===void 0&&(c=!1);const v=i.getBoundingClientRect(),E=fC(i);let I=Ad(1);o&&(m?Sl(m)&&(I=Qp(m)):I=Qp(i));const s=VH(E,c,m)?Bz(E):Ad(0);let O=(v.left+s.x)/I.x,j=(v.top+s.y)/I.y,G=v.width/I.x,W=v.height/I.y;if(E){const B=Ca(E),te=m&&Sl(m)?Ca(m):m;let ue=B,J=FT(ue);for(;J&&m&&te!==ue;){const ce=Qp(J),oe=J.getBoundingClientRect(),ee=Tl(J),Q=oe.left+(J.clientLeft+parseFloat(ee.paddingLeft))*ce.x,Ie=oe.top+(J.clientTop+parseFloat(ee.paddingTop))*ce.y;O*=ce.x,j*=ce.y,G*=ce.x,W*=ce.y,O+=Q,j+=Ie,ue=Ca(J),J=FT(ue)}}return I1({width:G,height:W,x:O,y:j})}function UH(i){let{elements:o,rect:c,offsetParent:m,strategy:v}=i;const E=v==="fixed",I=fc(m),s=o?hw(o.floating):!1;if(m===I||s&&E)return c;let O={scrollLeft:0,scrollTop:0},j=Ad(1);const G=Ad(0),W=dc(m);if((W||!W&&!E)&&((Mm(m)!=="body"||qy(I))&&(O=fw(m)),dc(m))){const B=ef(m);j=Qp(m),G.x=B.x+m.clientLeft,G.y=B.y+m.clientTop}return{width:c.width*j.x,height:c.height*j.y,x:c.x*j.x-O.scrollLeft*j.x+G.x,y:c.y*j.y-O.scrollTop*j.y+G.y}}function GH(i){return Array.from(i.getClientRects())}function jT(i,o){const c=fw(i).scrollLeft;return o?o.left+c:ef(fc(i)).left+c}function $H(i){const o=fc(i),c=fw(i),m=i.ownerDocument.body,v=Sa(o.scrollWidth,o.clientWidth,m.scrollWidth,m.clientWidth),E=Sa(o.scrollHeight,o.clientHeight,m.scrollHeight,m.clientHeight);let I=-c.scrollLeft+jT(i);const s=-c.scrollTop;return Tl(m).direction==="rtl"&&(I+=Sa(o.clientWidth,m.clientWidth)-v),{width:v,height:E,x:I,y:s}}function HH(i,o){const c=Ca(i),m=fc(i),v=c.visualViewport;let E=m.clientWidth,I=m.clientHeight,s=0,O=0;if(v){E=v.width,I=v.height;const j=hC();(!j||j&&o==="fixed")&&(s=v.offsetLeft,O=v.offsetTop)}return{width:E,height:I,x:s,y:O}}function qH(i,o){const c=ef(i,!0,o==="fixed"),m=c.top+i.clientTop,v=c.left+i.clientLeft,E=dc(i)?Qp(i):Ad(1),I=i.clientWidth*E.x,s=i.clientHeight*E.y,O=v*E.x,j=m*E.y;return{width:I,height:s,x:O,y:j}}function PD(i,o,c){let m;if(o==="viewport")m=HH(i,c);else if(o==="document")m=$H(fc(i));else if(Sl(o))m=qH(o,c);else{const v=Bz(i);m={...o,x:o.x-v.x,y:o.y-v.y}}return I1(m)}function Vz(i,o){const c=Pd(i);return c===o||!Sl(c)||_m(c)?!1:Tl(c).position==="fixed"||Vz(c,o)}function WH(i,o){const c=o.get(i);if(c)return c;let m=Ry(i,[],!1).filter(s=>Sl(s)&&Mm(s)!=="body"),v=null;const E=Tl(i).position==="fixed";let I=E?Pd(i):i;for(;Sl(I)&&!_m(I);){const s=Tl(I),O=dC(I);!O&&s.position==="fixed"&&(v=null),(E?!O&&!v:!O&&s.position==="static"&&!!v&&["absolute","fixed"].includes(v.position)||qy(I)&&!O&&Vz(i,I))?m=m.filter(G=>G!==I):v=s,I=Pd(I)}return o.set(i,m),m}function ZH(i){let{element:o,boundary:c,rootBoundary:m,strategy:v}=i;const I=[...c==="clippingAncestors"?hw(o)?[]:WH(o,this._c):[].concat(c),m],s=I[0],O=I.reduce((j,G)=>{const W=PD(o,G,v);return j.top=Sa(W.top,j.top),j.right=Cd(W.right,j.right),j.bottom=Cd(W.bottom,j.bottom),j.left=Sa(W.left,j.left),j},PD(o,s,v));return{width:O.right-O.left,height:O.bottom-O.top,x:O.left,y:O.top}}function XH(i){const{width:o,height:c}=jz(i);return{width:o,height:c}}function KH(i,o,c){const m=dc(o),v=fc(o),E=c==="fixed",I=ef(i,!0,E,o);let s={scrollLeft:0,scrollTop:0};const O=Ad(0);if(m||!m&&!E)if((Mm(o)!=="body"||qy(v))&&(s=fw(o)),m){const te=ef(o,!0,E,o);O.x=te.x+o.clientLeft,O.y=te.y+o.clientTop}else v&&(O.x=jT(v));let j=0,G=0;if(v&&!m&&!E){const te=v.getBoundingClientRect();G=te.top+s.scrollTop,j=te.left+s.scrollLeft-jT(v,te)}const W=I.left+s.scrollLeft-O.x-j,B=I.top+s.scrollTop-O.y-G;return{x:W,y:B,width:I.width,height:I.height}}function gS(i){return Tl(i).position==="static"}function MD(i,o){if(!dc(i)||Tl(i).position==="fixed")return null;if(o)return o(i);let c=i.offsetParent;return fc(i)===c&&(c=c.ownerDocument.body),c}function Uz(i,o){const c=Ca(i);if(hw(i))return c;if(!dc(i)){let v=Pd(i);for(;v&&!_m(v);){if(Sl(v)&&!gS(v))return v;v=Pd(v)}return c}let m=MD(i,o);for(;m&&FH(m)&&gS(m);)m=MD(m,o);return m&&_m(m)&&gS(m)&&!dC(m)?c:m||jH(i)||c}const YH=async function(i){const o=this.getOffsetParent||Uz,c=this.getDimensions,m=await c(i.floating);return{reference:KH(i.reference,await o(i.floating),i.strategy),floating:{x:0,y:0,width:m.width,height:m.height}}};function JH(i){return Tl(i).direction==="rtl"}const QH={convertOffsetParentRelativeRectToViewportRelativeRect:UH,getDocumentElement:fc,getClippingRect:ZH,getOffsetParent:Uz,getElementRects:YH,getClientRects:GH,getDimensions:XH,getScale:Qp,isElement:Sl,isRTL:JH};function e7(i,o){let c=null,m;const v=fc(i);function E(){var s;clearTimeout(m),(s=c)==null||s.disconnect(),c=null}function I(s,O){s===void 0&&(s=!1),O===void 0&&(O=1),E();const{left:j,top:G,width:W,height:B}=i.getBoundingClientRect();if(s||o(),!W||!B)return;const te=C0(G),ue=C0(v.clientWidth-(j+W)),J=C0(v.clientHeight-(G+B)),ce=C0(j),ee={rootMargin:-te+"px "+-ue+"px "+-J+"px "+-ce+"px",threshold:Sa(0,Cd(1,O))||1};let Q=!0;function Ie(pe){const Ke=pe[0].intersectionRatio;if(Ke!==O){if(!Q)return I();Ke?I(!1,Ke):m=setTimeout(()=>{I(!1,1e-7)},1e3)}Q=!1}try{c=new IntersectionObserver(Ie,{...ee,root:v.ownerDocument})}catch{c=new IntersectionObserver(Ie,ee)}c.observe(i)}return I(!0),E}function t7(i,o,c,m){m===void 0&&(m={});const{ancestorScroll:v=!0,ancestorResize:E=!0,elementResize:I=typeof ResizeObserver=="function",layoutShift:s=typeof IntersectionObserver=="function",animationFrame:O=!1}=m,j=fC(i),G=v||E?[...j?Ry(j):[],...Ry(o)]:[];G.forEach(oe=>{v&&oe.addEventListener("scroll",c,{passive:!0}),E&&oe.addEventListener("resize",c)});const W=j&&s?e7(j,c):null;let B=-1,te=null;I&&(te=new ResizeObserver(oe=>{let[ee]=oe;ee&&ee.target===j&&te&&(te.unobserve(o),cancelAnimationFrame(B),B=requestAnimationFrame(()=>{var Q;(Q=te)==null||Q.observe(o)})),c()}),j&&!O&&te.observe(j),te.observe(o));let ue,J=O?ef(i):null;O&&ce();function ce(){const oe=ef(i);J&&(oe.x!==J.x||oe.y!==J.y||oe.width!==J.width||oe.height!==J.height)&&c(),J=oe,ue=requestAnimationFrame(ce)}return c(),()=>{var oe;G.forEach(ee=>{v&&ee.removeEventListener("scroll",c),E&&ee.removeEventListener("resize",c)}),W==null||W(),(oe=te)==null||oe.disconnect(),te=null,O&&cancelAnimationFrame(ue)}}const i7=NH,n7=LH,r7=RH,s7=OH,o7=DH,RD=MH,a7=zH,l7=(i,o,c)=>{const m=new Map,v={platform:QH,...c},E={...v.platform,_c:m};return PH(i,o,{...v,platform:E})};var W0=typeof document<"u"?V.useLayoutEffect:V.useEffect;function P1(i,o){if(i===o)return!0;if(typeof i!=typeof o)return!1;if(typeof i=="function"&&i.toString()===o.toString())return!0;let c,m,v;if(i&&o&&typeof i=="object"){if(Array.isArray(i)){if(c=i.length,c!==o.length)return!1;for(m=c;m--!==0;)if(!P1(i[m],o[m]))return!1;return!0}if(v=Object.keys(i),c=v.length,c!==Object.keys(o).length)return!1;for(m=c;m--!==0;)if(!{}.hasOwnProperty.call(o,v[m]))return!1;for(m=c;m--!==0;){const E=v[m];if(!(E==="_owner"&&i.$$typeof)&&!P1(i[E],o[E]))return!1}return!0}return i!==i&&o!==o}function Gz(i){return typeof window>"u"?1:(i.ownerDocument.defaultView||window).devicePixelRatio||1}function DD(i,o){const c=Gz(i);return Math.round(o*c)/c}function _S(i){const o=V.useRef(i);return W0(()=>{o.current=i}),o}function c7(i){i===void 0&&(i={});const{placement:o="bottom",strategy:c="absolute",middleware:m=[],platform:v,elements:{reference:E,floating:I}={},transform:s=!0,whileElementsMounted:O,open:j}=i,[G,W]=V.useState({x:0,y:0,strategy:c,placement:o,middlewareData:{},isPositioned:!1}),[B,te]=V.useState(m);P1(B,m)||te(m);const[ue,J]=V.useState(null),[ce,oe]=V.useState(null),ee=V.useCallback(ot=>{ot!==Ke.current&&(Ke.current=ot,J(ot))},[]),Q=V.useCallback(ot=>{ot!==et.current&&(et.current=ot,oe(ot))},[]),Ie=E||ue,pe=I||ce,Ke=V.useRef(null),et=V.useRef(null),at=V.useRef(G),Xt=O!=null,Ct=_S(O),mt=_S(v),Dt=_S(j),Kt=V.useCallback(()=>{if(!Ke.current||!et.current)return;const ot={placement:o,strategy:c,middleware:B};mt.current&&(ot.platform=mt.current),l7(Ke.current,et.current,ot).then(Tt=>{const ii={...Tt,isPositioned:Dt.current!==!1};Pt.current&&!P1(at.current,ii)&&(at.current=ii,of.flushSync(()=>{W(ii)}))})},[B,o,c,mt,Dt]);W0(()=>{j===!1&&at.current.isPositioned&&(at.current.isPositioned=!1,W(ot=>({...ot,isPositioned:!1})))},[j]);const Pt=V.useRef(!1);W0(()=>(Pt.current=!0,()=>{Pt.current=!1}),[]),W0(()=>{if(Ie&&(Ke.current=Ie),pe&&(et.current=pe),Ie&&pe){if(Ct.current)return Ct.current(Ie,pe,Kt);Kt()}},[Ie,pe,Kt,Ct,Xt]);const ti=V.useMemo(()=>({reference:Ke,floating:et,setReference:ee,setFloating:Q}),[ee,Q]),Nt=V.useMemo(()=>({reference:Ie,floating:pe}),[Ie,pe]),bi=V.useMemo(()=>{const ot={position:c,left:0,top:0};if(!Nt.floating)return ot;const Tt=DD(Nt.floating,G.x),ii=DD(Nt.floating,G.y);return s?{...ot,transform:"translate("+Tt+"px, "+ii+"px)",...Gz(Nt.floating)>=1.5&&{willChange:"transform"}}:{position:c,left:Tt,top:ii}},[c,s,Nt.floating,G.x,G.y]);return V.useMemo(()=>({...G,update:Kt,refs:ti,elements:Nt,floatingStyles:bi}),[G,Kt,ti,Nt,bi])}const u7=i=>{function o(c){return{}.hasOwnProperty.call(c,"current")}return{name:"arrow",options:i,fn(c){const{element:m,padding:v}=typeof i=="function"?i(c):i;return m&&o(m)?m.current!=null?RD({element:m.current,padding:v}).fn(c):{}:m?RD({element:m,padding:v}).fn(c):{}}}},d7=(i,o)=>({...i7(i),options:[i,o]}),h7=(i,o)=>({...n7(i),options:[i,o]}),f7=(i,o)=>({...a7(i),options:[i,o]}),p7=(i,o)=>({...r7(i),options:[i,o]}),m7=(i,o)=>({...s7(i),options:[i,o]}),g7=(i,o)=>({...o7(i),options:[i,o]}),_7=(i,o)=>({...u7(i),options:[i,o]});var y7="Arrow",$z=V.forwardRef((i,o)=>{const{children:c,width:m=10,height:v=5,...E}=i;return x.jsx(fn.svg,{...E,ref:o,width:m,height:v,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:i.asChild?c:x.jsx("polygon",{points:"0,0 30,0 15,10"})})});$z.displayName=y7;var x7=$z;function v7(i,o=[]){let c=[];function m(E,I){const s=V.createContext(I),O=c.length;c=[...c,I];function j(W){const{scope:B,children:te,...ue}=W,J=(B==null?void 0:B[i][O])||s,ce=V.useMemo(()=>ue,Object.values(ue));return x.jsx(J.Provider,{value:ce,children:te})}function G(W,B){const te=(B==null?void 0:B[i][O])||s,ue=V.useContext(te);if(ue)return ue;if(I!==void 0)return I;throw new Error(`\`${W}\` must be used within \`${E}\``)}return j.displayName=E+"Provider",[j,G]}const v=()=>{const E=c.map(I=>V.createContext(I));return function(s){const O=(s==null?void 0:s[i])||E;return V.useMemo(()=>({[`__scope${i}`]:{...s,[i]:O}}),[s,O])}};return v.scopeName=i,[m,w7(v,...o)]}function w7(...i){const o=i[0];if(i.length===1)return o;const c=()=>{const m=i.map(v=>({useScope:v(),scopeName:v.scopeName}));return function(E){const I=m.reduce((s,{useScope:O,scopeName:j})=>{const W=O(E)[`__scope${j}`];return{...s,...W}},{});return V.useMemo(()=>({[`__scope${o.scopeName}`]:I}),[I])}};return c.scopeName=o.scopeName,c}function Hz(i){const[o,c]=V.useState(void 0);return to(()=>{if(i){c({width:i.offsetWidth,height:i.offsetHeight});const m=new ResizeObserver(v=>{if(!Array.isArray(v)||!v.length)return;const E=v[0];let I,s;if("borderBoxSize"in E){const O=E.borderBoxSize,j=Array.isArray(O)?O[0]:O;I=j.inlineSize,s=j.blockSize}else I=i.offsetWidth,s=i.offsetHeight;c({width:I,height:s})});return m.observe(i,{box:"border-box"}),()=>m.unobserve(i)}else c(void 0)},[i]),o}var pC="Popper",[qz,Rm]=v7(pC),[b7,Wz]=qz(pC),Zz=i=>{const{__scopePopper:o,children:c}=i,[m,v]=V.useState(null);return x.jsx(b7,{scope:o,anchor:m,onAnchorChange:v,children:c})};Zz.displayName=pC;var Xz="PopperAnchor",Kz=V.forwardRef((i,o)=>{const{__scopePopper:c,virtualRef:m,...v}=i,E=Wz(Xz,c),I=V.useRef(null),s=vr(o,I);return V.useEffect(()=>{E.onAnchorChange((m==null?void 0:m.current)||I.current)}),m?null:x.jsx(fn.div,{...v,ref:s})});Kz.displayName=Xz;var mC="PopperContent",[S7,T7]=qz(mC),Yz=V.forwardRef((i,o)=>{var ni,Fi,nn,Ri,kn,Cn;const{__scopePopper:c,side:m="bottom",sideOffset:v=0,align:E="center",alignOffset:I=0,arrowPadding:s=0,avoidCollisions:O=!0,collisionBoundary:j=[],collisionPadding:G=0,sticky:W="partial",hideWhenDetached:B=!1,updatePositionStrategy:te="optimized",onPlaced:ue,...J}=i,ce=Wz(mC,c),[oe,ee]=V.useState(null),Q=vr(o,Zr=>ee(Zr)),[Ie,pe]=V.useState(null),Ke=Hz(Ie),et=(Ke==null?void 0:Ke.width)??0,at=(Ke==null?void 0:Ke.height)??0,Xt=m+(E!=="center"?"-"+E:""),Ct=typeof G=="number"?G:{top:0,right:0,bottom:0,left:0,...G},mt=Array.isArray(j)?j:[j],Dt=mt.length>0,Kt={padding:Ct,boundary:mt.filter(C7),altBoundary:Dt},{refs:Pt,floatingStyles:ti,placement:Nt,isPositioned:bi,middlewareData:ot}=c7({strategy:"fixed",placement:Xt,whileElementsMounted:(...Zr)=>t7(...Zr,{animationFrame:te==="always"}),elements:{reference:ce.anchor},middleware:[d7({mainAxis:v+at,alignmentAxis:I}),O&&h7({mainAxis:!0,crossAxis:!1,limiter:W==="partial"?f7():void 0,...Kt}),O&&p7({...Kt}),m7({...Kt,apply:({elements:Zr,rects:wr,availableWidth:On,availableHeight:gr})=>{const{width:bs,height:Ma}=wr.reference,_r=Zr.floating.style;_r.setProperty("--radix-popper-available-width",`${On}px`),_r.setProperty("--radix-popper-available-height",`${gr}px`),_r.setProperty("--radix-popper-anchor-width",`${bs}px`),_r.setProperty("--radix-popper-anchor-height",`${Ma}px`)}}),Ie&&_7({element:Ie,padding:s}),A7({arrowWidth:et,arrowHeight:at}),B&&g7({strategy:"referenceHidden",...Kt})]}),[Tt,ii]=e3(Nt),jt=po(ue);to(()=>{bi&&(jt==null||jt())},[bi,jt]);const gi=(ni=ot.arrow)==null?void 0:ni.x,en=(Fi=ot.arrow)==null?void 0:Fi.y,Dn=((nn=ot.arrow)==null?void 0:nn.centerOffset)!==0,[ir,wi]=V.useState();return to(()=>{oe&&wi(window.getComputedStyle(oe).zIndex)},[oe]),x.jsx("div",{ref:Pt.setFloating,"data-radix-popper-content-wrapper":"",style:{...ti,transform:bi?ti.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:ir,"--radix-popper-transform-origin":[(Ri=ot.transformOrigin)==null?void 0:Ri.x,(kn=ot.transformOrigin)==null?void 0:kn.y].join(" "),...((Cn=ot.hide)==null?void 0:Cn.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:i.dir,children:x.jsx(S7,{scope:c,placedSide:Tt,onArrowChange:pe,arrowX:gi,arrowY:en,shouldHideArrow:Dn,children:x.jsx(fn.div,{"data-side":Tt,"data-align":ii,...J,ref:Q,style:{...J.style,animation:bi?void 0:"none"}})})})});Yz.displayName=mC;var Jz="PopperArrow",E7={top:"bottom",right:"left",bottom:"top",left:"right"},Qz=V.forwardRef(function(o,c){const{__scopePopper:m,...v}=o,E=T7(Jz,m),I=E7[E.placedSide];return x.jsx("span",{ref:E.onArrowChange,style:{position:"absolute",left:E.arrowX,top:E.arrowY,[I]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[E.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[E.placedSide],visibility:E.shouldHideArrow?"hidden":void 0},children:x.jsx(x7,{...v,ref:c,style:{...v.style,display:"block"}})})});Qz.displayName=Jz;function C7(i){return i!==null}var A7=i=>({name:"transformOrigin",options:i,fn(o){var ce,oe,ee;const{placement:c,rects:m,middlewareData:v}=o,I=((ce=v.arrow)==null?void 0:ce.centerOffset)!==0,s=I?0:i.arrowWidth,O=I?0:i.arrowHeight,[j,G]=e3(c),W={start:"0%",center:"50%",end:"100%"}[G],B=(((oe=v.arrow)==null?void 0:oe.x)??0)+s/2,te=(((ee=v.arrow)==null?void 0:ee.y)??0)+O/2;let ue="",J="";return j==="bottom"?(ue=I?W:`${B}px`,J=`${-O}px`):j==="top"?(ue=I?W:`${B}px`,J=`${m.floating.height+O}px`):j==="right"?(ue=`${-O}px`,J=I?W:`${te}px`):j==="left"&&(ue=`${m.floating.width+O}px`,J=I?W:`${te}px`),{data:{x:ue,y:J}}}});function e3(i){const[o,c="center"]=i.split("-");return[o,c]}var gC=Zz,_C=Kz,yC=Yz,xC=Qz,[pw,mK]=iu("Tooltip",[Rm]),mw=Rm(),t3="TooltipProvider",I7=700,BT="tooltip.open",[P7,vC]=pw(t3),i3=i=>{const{__scopeTooltip:o,delayDuration:c=I7,skipDelayDuration:m=300,disableHoverableContent:v=!1,children:E}=i,[I,s]=V.useState(!0),O=V.useRef(!1),j=V.useRef(0);return V.useEffect(()=>{const G=j.current;return()=>window.clearTimeout(G)},[]),x.jsx(P7,{scope:o,isOpenDelayed:I,delayDuration:c,onOpen:V.useCallback(()=>{window.clearTimeout(j.current),s(!1)},[]),onClose:V.useCallback(()=>{window.clearTimeout(j.current),j.current=window.setTimeout(()=>s(!0),m)},[m]),isPointerInTransitRef:O,onPointerInTransitChange:V.useCallback(G=>{O.current=G},[]),disableHoverableContent:v,children:E})};i3.displayName=t3;var gw="Tooltip",[M7,_w]=pw(gw),n3=i=>{const{__scopeTooltip:o,children:c,open:m,defaultOpen:v=!1,onOpenChange:E,disableHoverableContent:I,delayDuration:s}=i,O=vC(gw,i.__scopeTooltip),j=mw(o),[G,W]=V.useState(null),B=vl(),te=V.useRef(0),ue=I??O.disableHoverableContent,J=s??O.delayDuration,ce=V.useRef(!1),[oe=!1,ee]=Yc({prop:m,defaultProp:v,onChange:et=>{et?(O.onOpen(),document.dispatchEvent(new CustomEvent(BT))):O.onClose(),E==null||E(et)}}),Q=V.useMemo(()=>oe?ce.current?"delayed-open":"instant-open":"closed",[oe]),Ie=V.useCallback(()=>{window.clearTimeout(te.current),te.current=0,ce.current=!1,ee(!0)},[ee]),pe=V.useCallback(()=>{window.clearTimeout(te.current),te.current=0,ee(!1)},[ee]),Ke=V.useCallback(()=>{window.clearTimeout(te.current),te.current=window.setTimeout(()=>{ce.current=!0,ee(!0),te.current=0},J)},[J,ee]);return V.useEffect(()=>()=>{te.current&&(window.clearTimeout(te.current),te.current=0)},[]),x.jsx(gC,{...j,children:x.jsx(M7,{scope:o,contentId:B,open:oe,stateAttribute:Q,trigger:G,onTriggerChange:W,onTriggerEnter:V.useCallback(()=>{O.isOpenDelayed?Ke():Ie()},[O.isOpenDelayed,Ke,Ie]),onTriggerLeave:V.useCallback(()=>{ue?pe():(window.clearTimeout(te.current),te.current=0)},[pe,ue]),onOpen:Ie,onClose:pe,disableHoverableContent:ue,children:c})})};n3.displayName=gw;var VT="TooltipTrigger",r3=V.forwardRef((i,o)=>{const{__scopeTooltip:c,...m}=i,v=_w(VT,c),E=vC(VT,c),I=mw(c),s=V.useRef(null),O=vr(o,s,v.onTriggerChange),j=V.useRef(!1),G=V.useRef(!1),W=V.useCallback(()=>j.current=!1,[]);return V.useEffect(()=>()=>document.removeEventListener("pointerup",W),[W]),x.jsx(_C,{asChild:!0,...I,children:x.jsx(fn.button,{"aria-describedby":v.open?v.contentId:void 0,"data-state":v.stateAttribute,...m,ref:O,onPointerMove:Ai(i.onPointerMove,B=>{B.pointerType!=="touch"&&!G.current&&!E.isPointerInTransitRef.current&&(v.onTriggerEnter(),G.current=!0)}),onPointerLeave:Ai(i.onPointerLeave,()=>{v.onTriggerLeave(),G.current=!1}),onPointerDown:Ai(i.onPointerDown,()=>{j.current=!0,document.addEventListener("pointerup",W,{once:!0})}),onFocus:Ai(i.onFocus,()=>{j.current||v.onOpen()}),onBlur:Ai(i.onBlur,v.onClose),onClick:Ai(i.onClick,v.onClose)})})});r3.displayName=VT;var R7="TooltipPortal",[gK,D7]=pw(R7,{forceMount:void 0}),ym="TooltipContent",s3=V.forwardRef((i,o)=>{const c=D7(ym,i.__scopeTooltip),{forceMount:m=c.forceMount,side:v="top",...E}=i,I=_w(ym,i.__scopeTooltip);return x.jsx(El,{present:m||I.open,children:I.disableHoverableContent?x.jsx(o3,{side:v,...E,ref:o}):x.jsx(k7,{side:v,...E,ref:o})})}),k7=V.forwardRef((i,o)=>{const c=_w(ym,i.__scopeTooltip),m=vC(ym,i.__scopeTooltip),v=V.useRef(null),E=vr(o,v),[I,s]=V.useState(null),{trigger:O,onClose:j}=c,G=v.current,{onPointerInTransitChange:W}=m,B=V.useCallback(()=>{s(null),W(!1)},[W]),te=V.useCallback((ue,J)=>{const ce=ue.currentTarget,oe={x:ue.clientX,y:ue.clientY},ee=O7(oe,ce.getBoundingClientRect()),Q=F7(oe,ee),Ie=j7(J.getBoundingClientRect()),pe=V7([...Q,...Ie]);s(pe),W(!0)},[W]);return V.useEffect(()=>()=>B(),[B]),V.useEffect(()=>{if(O&&G){const ue=ce=>te(ce,G),J=ce=>te(ce,O);return O.addEventListener("pointerleave",ue),G.addEventListener("pointerleave",J),()=>{O.removeEventListener("pointerleave",ue),G.removeEventListener("pointerleave",J)}}},[O,G,te,B]),V.useEffect(()=>{if(I){const ue=J=>{const ce=J.target,oe={x:J.clientX,y:J.clientY},ee=(O==null?void 0:O.contains(ce))||(G==null?void 0:G.contains(ce)),Q=!B7(oe,I);ee?B():Q&&(B(),j())};return document.addEventListener("pointermove",ue),()=>document.removeEventListener("pointermove",ue)}},[O,G,I,j,B]),x.jsx(o3,{...i,ref:E})}),[N7,L7]=pw(gw,{isInside:!1}),o3=V.forwardRef((i,o)=>{const{__scopeTooltip:c,children:m,"aria-label":v,onEscapeKeyDown:E,onPointerDownOutside:I,...s}=i,O=_w(ym,c),j=mw(c),{onClose:G}=O;return V.useEffect(()=>(document.addEventListener(BT,G),()=>document.removeEventListener(BT,G)),[G]),V.useEffect(()=>{if(O.trigger){const W=B=>{const te=B.target;te!=null&&te.contains(O.trigger)&&G()};return window.addEventListener("scroll",W,{capture:!0}),()=>window.removeEventListener("scroll",W,{capture:!0})}},[O.trigger,G]),x.jsx(Em,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:E,onPointerDownOutside:I,onFocusOutside:W=>W.preventDefault(),onDismiss:G,children:x.jsxs(yC,{"data-state":O.stateAttribute,...j,...s,ref:o,style:{...s.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[x.jsx(XL,{children:m}),x.jsx(N7,{scope:c,isInside:!0,children:x.jsx(bG,{id:O.contentId,role:"tooltip",children:v||m})})]})})});s3.displayName=ym;var a3="TooltipArrow",z7=V.forwardRef((i,o)=>{const{__scopeTooltip:c,...m}=i,v=mw(c);return L7(a3,c).isInside?null:x.jsx(xC,{...v,...m,ref:o})});z7.displayName=a3;function O7(i,o){const c=Math.abs(o.top-i.y),m=Math.abs(o.bottom-i.y),v=Math.abs(o.right-i.x),E=Math.abs(o.left-i.x);switch(Math.min(c,m,v,E)){case E:return"left";case v:return"right";case c:return"top";case m:return"bottom";default:throw new Error("unreachable")}}function F7(i,o,c=5){const m=[];switch(o){case"top":m.push({x:i.x-c,y:i.y+c},{x:i.x+c,y:i.y+c});break;case"bottom":m.push({x:i.x-c,y:i.y-c},{x:i.x+c,y:i.y-c});break;case"left":m.push({x:i.x+c,y:i.y-c},{x:i.x+c,y:i.y+c});break;case"right":m.push({x:i.x-c,y:i.y-c},{x:i.x-c,y:i.y+c});break}return m}function j7(i){const{top:o,right:c,bottom:m,left:v}=i;return[{x:v,y:o},{x:c,y:o},{x:c,y:m},{x:v,y:m}]}function B7(i,o){const{x:c,y:m}=i;let v=!1;for(let E=0,I=o.length-1;E<o.length;I=E++){const s=o[E].x,O=o[E].y,j=o[I].x,G=o[I].y;O>m!=G>m&&c<(j-s)*(m-O)/(G-O)+s&&(v=!v)}return v}function V7(i){const o=i.slice();return o.sort((c,m)=>c.x<m.x?-1:c.x>m.x?1:c.y<m.y?-1:c.y>m.y?1:0),U7(o)}function U7(i){if(i.length<=1)return i.slice();const o=[];for(let m=0;m<i.length;m++){const v=i[m];for(;o.length>=2;){const E=o[o.length-1],I=o[o.length-2];if((E.x-I.x)*(v.y-I.y)>=(E.y-I.y)*(v.x-I.x))o.pop();else break}o.push(v)}o.pop();const c=[];for(let m=i.length-1;m>=0;m--){const v=i[m];for(;c.length>=2;){const E=c[c.length-1],I=c[c.length-2];if((E.x-I.x)*(v.y-I.y)>=(E.y-I.y)*(v.x-I.x))c.pop();else break}c.push(v)}return c.pop(),o.length===1&&c.length===1&&o[0].x===c[0].x&&o[0].y===c[0].y?o:o.concat(c)}var G7=i3,$7=n3,H7=r3,l3=s3;const c3=G7,q7=$7,W7=H7,u3=V.forwardRef(({className:i,sideOffset:o=4,...c},m)=>x.jsx(l3,{ref:m,sideOffset:o,className:ui("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",i),...c}));u3.displayName=l3.displayName;var yw=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(i){return this.listeners.add(i),this.onSubscribe(),()=>{this.listeners.delete(i),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},xw=typeof window>"u"||"Deno"in globalThis;function dl(){}function Z7(i,o){return typeof i=="function"?i(o):i}function X7(i){return typeof i=="number"&&i>=0&&i!==1/0}function K7(i,o){return Math.max(i+(o||0)-Date.now(),0)}function kD(i,o){return typeof i=="function"?i(o):i}function Y7(i,o){return typeof i=="function"?i(o):i}function ND(i,o){const{type:c="all",exact:m,fetchStatus:v,predicate:E,queryKey:I,stale:s}=i;if(I){if(m){if(o.queryHash!==wC(I,o.options))return!1}else if(!ky(o.queryKey,I))return!1}if(c!=="all"){const O=o.isActive();if(c==="active"&&!O||c==="inactive"&&O)return!1}return!(typeof s=="boolean"&&o.isStale()!==s||v&&v!==o.state.fetchStatus||E&&!E(o))}function LD(i,o){const{exact:c,status:m,predicate:v,mutationKey:E}=i;if(E){if(!o.options.mutationKey)return!1;if(c){if(Dy(o.options.mutationKey)!==Dy(E))return!1}else if(!ky(o.options.mutationKey,E))return!1}return!(m&&o.state.status!==m||v&&!v(o))}function wC(i,o){return((o==null?void 0:o.queryKeyHashFn)||Dy)(i)}function Dy(i){return JSON.stringify(i,(o,c)=>UT(c)?Object.keys(c).sort().reduce((m,v)=>(m[v]=c[v],m),{}):c)}function ky(i,o){return i===o?!0:typeof i!=typeof o?!1:i&&o&&typeof i=="object"&&typeof o=="object"?!Object.keys(o).some(c=>!ky(i[c],o[c])):!1}function d3(i,o){if(i===o)return i;const c=zD(i)&&zD(o);if(c||UT(i)&&UT(o)){const m=c?i:Object.keys(i),v=m.length,E=c?o:Object.keys(o),I=E.length,s=c?[]:{};let O=0;for(let j=0;j<I;j++){const G=c?j:E[j];(!c&&m.includes(G)||c)&&i[G]===void 0&&o[G]===void 0?(s[G]=void 0,O++):(s[G]=d3(i[G],o[G]),s[G]===i[G]&&i[G]!==void 0&&O++)}return v===I&&O===v?i:s}return o}function zD(i){return Array.isArray(i)&&i.length===Object.keys(i).length}function UT(i){if(!OD(i))return!1;const o=i.constructor;if(o===void 0)return!0;const c=o.prototype;return!(!OD(c)||!c.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(i)!==Object.prototype)}function OD(i){return Object.prototype.toString.call(i)==="[object Object]"}function J7(i){return new Promise(o=>{setTimeout(o,i)})}function Q7(i,o,c){return typeof c.structuralSharing=="function"?c.structuralSharing(i,o):c.structuralSharing!==!1?d3(i,o):o}function e9(i,o,c=0){const m=[...i,o];return c&&m.length>c?m.slice(1):m}function t9(i,o,c=0){const m=[o,...i];return c&&m.length>c?m.slice(0,-1):m}var bC=Symbol();function h3(i,o){return!i.queryFn&&(o!=null&&o.initialPromise)?()=>o.initialPromise:!i.queryFn||i.queryFn===bC?()=>Promise.reject(new Error(`Missing queryFn: '${i.queryHash}'`)):i.queryFn}var Uh,od,tm,gk,i9=(gk=class extends yw{constructor(){super();Pr(this,Uh);Pr(this,od);Pr(this,tm);Hn(this,tm,o=>{if(!xw&&window.addEventListener){const c=()=>o();return window.addEventListener("visibilitychange",c,!1),()=>{window.removeEventListener("visibilitychange",c)}}})}onSubscribe(){qt(this,od)||this.setEventListener(qt(this,tm))}onUnsubscribe(){var o;this.hasListeners()||((o=qt(this,od))==null||o.call(this),Hn(this,od,void 0))}setEventListener(o){var c;Hn(this,tm,o),(c=qt(this,od))==null||c.call(this),Hn(this,od,o(m=>{typeof m=="boolean"?this.setFocused(m):this.onFocus()}))}setFocused(o){qt(this,Uh)!==o&&(Hn(this,Uh,o),this.onFocus())}onFocus(){const o=this.isFocused();this.listeners.forEach(c=>{c(o)})}isFocused(){var o;return typeof qt(this,Uh)=="boolean"?qt(this,Uh):((o=globalThis.document)==null?void 0:o.visibilityState)!=="hidden"}},Uh=new WeakMap,od=new WeakMap,tm=new WeakMap,gk),f3=new i9,im,ad,nm,_k,n9=(_k=class extends yw{constructor(){super();Pr(this,im,!0);Pr(this,ad);Pr(this,nm);Hn(this,nm,o=>{if(!xw&&window.addEventListener){const c=()=>o(!0),m=()=>o(!1);return window.addEventListener("online",c,!1),window.addEventListener("offline",m,!1),()=>{window.removeEventListener("online",c),window.removeEventListener("offline",m)}}})}onSubscribe(){qt(this,ad)||this.setEventListener(qt(this,nm))}onUnsubscribe(){var o;this.hasListeners()||((o=qt(this,ad))==null||o.call(this),Hn(this,ad,void 0))}setEventListener(o){var c;Hn(this,nm,o),(c=qt(this,ad))==null||c.call(this),Hn(this,ad,o(this.setOnline.bind(this)))}setOnline(o){qt(this,im)!==o&&(Hn(this,im,o),this.listeners.forEach(m=>{m(o)}))}isOnline(){return qt(this,im)}},im=new WeakMap,ad=new WeakMap,nm=new WeakMap,_k),M1=new n9;function r9(){let i,o;const c=new Promise((v,E)=>{i=v,o=E});c.status="pending",c.catch(()=>{});function m(v){Object.assign(c,v),delete c.resolve,delete c.reject}return c.resolve=v=>{m({status:"fulfilled",value:v}),i(v)},c.reject=v=>{m({status:"rejected",reason:v}),o(v)},c}function s9(i){return Math.min(1e3*2**i,3e4)}function p3(i){return(i??"online")==="online"?M1.isOnline():!0}var m3=class extends Error{constructor(i){super("CancelledError"),this.revert=i==null?void 0:i.revert,this.silent=i==null?void 0:i.silent}};function yS(i){return i instanceof m3}function g3(i){let o=!1,c=0,m=!1,v;const E=r9(),I=J=>{var ce;m||(B(new m3(J)),(ce=i.abort)==null||ce.call(i))},s=()=>{o=!0},O=()=>{o=!1},j=()=>f3.isFocused()&&(i.networkMode==="always"||M1.isOnline())&&i.canRun(),G=()=>p3(i.networkMode)&&i.canRun(),W=J=>{var ce;m||(m=!0,(ce=i.onSuccess)==null||ce.call(i,J),v==null||v(),E.resolve(J))},B=J=>{var ce;m||(m=!0,(ce=i.onError)==null||ce.call(i,J),v==null||v(),E.reject(J))},te=()=>new Promise(J=>{var ce;v=oe=>{(m||j())&&J(oe)},(ce=i.onPause)==null||ce.call(i)}).then(()=>{var J;v=void 0,m||(J=i.onContinue)==null||J.call(i)}),ue=()=>{if(m)return;let J;const ce=c===0?i.initialPromise:void 0;try{J=ce??i.fn()}catch(oe){J=Promise.reject(oe)}Promise.resolve(J).then(W).catch(oe=>{var Ke;if(m)return;const ee=i.retry??(xw?0:3),Q=i.retryDelay??s9,Ie=typeof Q=="function"?Q(c,oe):Q,pe=ee===!0||typeof ee=="number"&&c<ee||typeof ee=="function"&&ee(c,oe);if(o||!pe){B(oe);return}c++,(Ke=i.onFail)==null||Ke.call(i,c,oe),J7(Ie).then(()=>j()?void 0:te()).then(()=>{o?B(oe):ue()})})};return{promise:E,cancel:I,continue:()=>(v==null||v(),E),cancelRetry:s,continueRetry:O,canStart:G,start:()=>(G()?ue():te().then(ue),E)}}function o9(){let i=[],o=0,c=s=>{s()},m=s=>{s()},v=s=>setTimeout(s,0);const E=s=>{o?i.push(s):v(()=>{c(s)})},I=()=>{const s=i;i=[],s.length&&v(()=>{m(()=>{s.forEach(O=>{c(O)})})})};return{batch:s=>{let O;o++;try{O=s()}finally{o--,o||I()}return O},batchCalls:s=>(...O)=>{E(()=>{s(...O)})},schedule:E,setNotifyFunction:s=>{c=s},setBatchNotifyFunction:s=>{m=s},setScheduler:s=>{v=s}}}var qo=o9(),Gh,yk,_3=(yk=class{constructor(){Pr(this,Gh)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),X7(this.gcTime)&&Hn(this,Gh,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(i){this.gcTime=Math.max(this.gcTime||0,i??(xw?1/0:5*60*1e3))}clearGcTimeout(){qt(this,Gh)&&(clearTimeout(qt(this,Gh)),Hn(this,Gh,void 0))}},Gh=new WeakMap,yk),rm,sm,Ba,Co,zy,$h,hl,jc,xk,a9=(xk=class extends _3{constructor(o){super();Pr(this,hl);Pr(this,rm);Pr(this,sm);Pr(this,Ba);Pr(this,Co);Pr(this,zy);Pr(this,$h);Hn(this,$h,!1),Hn(this,zy,o.defaultOptions),this.setOptions(o.options),this.observers=[],Hn(this,Ba,o.cache),this.queryKey=o.queryKey,this.queryHash=o.queryHash,Hn(this,rm,c9(this.options)),this.state=o.state??qt(this,rm),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var o;return(o=qt(this,Co))==null?void 0:o.promise}setOptions(o){this.options={...qt(this,zy),...o},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&qt(this,Ba).remove(this)}setData(o,c){const m=Q7(this.state.data,o,this.options);return So(this,hl,jc).call(this,{data:m,type:"success",dataUpdatedAt:c==null?void 0:c.updatedAt,manual:c==null?void 0:c.manual}),m}setState(o,c){So(this,hl,jc).call(this,{type:"setState",state:o,setStateOptions:c})}cancel(o){var m,v;const c=(m=qt(this,Co))==null?void 0:m.promise;return(v=qt(this,Co))==null||v.cancel(o),c?c.then(dl).catch(dl):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(qt(this,rm))}isActive(){return this.observers.some(o=>Y7(o.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===bC||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(o=>o.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(o=0){return this.state.isInvalidated||this.state.data===void 0||!K7(this.state.dataUpdatedAt,o)}onFocus(){var c;const o=this.observers.find(m=>m.shouldFetchOnWindowFocus());o==null||o.refetch({cancelRefetch:!1}),(c=qt(this,Co))==null||c.continue()}onOnline(){var c;const o=this.observers.find(m=>m.shouldFetchOnReconnect());o==null||o.refetch({cancelRefetch:!1}),(c=qt(this,Co))==null||c.continue()}addObserver(o){this.observers.includes(o)||(this.observers.push(o),this.clearGcTimeout(),qt(this,Ba).notify({type:"observerAdded",query:this,observer:o}))}removeObserver(o){this.observers.includes(o)&&(this.observers=this.observers.filter(c=>c!==o),this.observers.length||(qt(this,Co)&&(qt(this,$h)?qt(this,Co).cancel({revert:!0}):qt(this,Co).cancelRetry()),this.scheduleGc()),qt(this,Ba).notify({type:"observerRemoved",query:this,observer:o}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||So(this,hl,jc).call(this,{type:"invalidate"})}fetch(o,c){var O,j,G;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(c!=null&&c.cancelRefetch))this.cancel({silent:!0});else if(qt(this,Co))return qt(this,Co).continueRetry(),qt(this,Co).promise}if(o&&this.setOptions(o),!this.options.queryFn){const W=this.observers.find(B=>B.options.queryFn);W&&this.setOptions(W.options)}const m=new AbortController,v=W=>{Object.defineProperty(W,"signal",{enumerable:!0,get:()=>(Hn(this,$h,!0),m.signal)})},E=()=>{const W=h3(this.options,c),B={queryKey:this.queryKey,meta:this.meta};return v(B),Hn(this,$h,!1),this.options.persister?this.options.persister(W,B,this):W(B)},I={fetchOptions:c,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:E};v(I),(O=this.options.behavior)==null||O.onFetch(I,this),Hn(this,sm,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((j=I.fetchOptions)==null?void 0:j.meta))&&So(this,hl,jc).call(this,{type:"fetch",meta:(G=I.fetchOptions)==null?void 0:G.meta});const s=W=>{var B,te,ue,J;yS(W)&&W.silent||So(this,hl,jc).call(this,{type:"error",error:W}),yS(W)||((te=(B=qt(this,Ba).config).onError)==null||te.call(B,W,this),(J=(ue=qt(this,Ba).config).onSettled)==null||J.call(ue,this.state.data,W,this)),this.scheduleGc()};return Hn(this,Co,g3({initialPromise:c==null?void 0:c.initialPromise,fn:I.fetchFn,abort:m.abort.bind(m),onSuccess:W=>{var B,te,ue,J;if(W===void 0){s(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(W)}catch(ce){s(ce);return}(te=(B=qt(this,Ba).config).onSuccess)==null||te.call(B,W,this),(J=(ue=qt(this,Ba).config).onSettled)==null||J.call(ue,W,this.state.error,this),this.scheduleGc()},onError:s,onFail:(W,B)=>{So(this,hl,jc).call(this,{type:"failed",failureCount:W,error:B})},onPause:()=>{So(this,hl,jc).call(this,{type:"pause"})},onContinue:()=>{So(this,hl,jc).call(this,{type:"continue"})},retry:I.options.retry,retryDelay:I.options.retryDelay,networkMode:I.options.networkMode,canRun:()=>!0})),qt(this,Co).start()}},rm=new WeakMap,sm=new WeakMap,Ba=new WeakMap,Co=new WeakMap,zy=new WeakMap,$h=new WeakMap,hl=new WeakSet,jc=function(o){const c=m=>{switch(o.type){case"failed":return{...m,fetchFailureCount:o.failureCount,fetchFailureReason:o.error};case"pause":return{...m,fetchStatus:"paused"};case"continue":return{...m,fetchStatus:"fetching"};case"fetch":return{...m,...l9(m.data,this.options),fetchMeta:o.meta??null};case"success":return{...m,data:o.data,dataUpdateCount:m.dataUpdateCount+1,dataUpdatedAt:o.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!o.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const v=o.error;return yS(v)&&v.revert&&qt(this,sm)?{...qt(this,sm),fetchStatus:"idle"}:{...m,error:v,errorUpdateCount:m.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:m.fetchFailureCount+1,fetchFailureReason:v,fetchStatus:"idle",status:"error"};case"invalidate":return{...m,isInvalidated:!0};case"setState":return{...m,...o.state}}};this.state=c(this.state),qo.batch(()=>{this.observers.forEach(m=>{m.onQueryUpdate()}),qt(this,Ba).notify({query:this,type:"updated",action:o})})},xk);function l9(i,o){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:p3(o.networkMode)?"fetching":"paused",...i===void 0&&{error:null,status:"pending"}}}function c9(i){const o=typeof i.initialData=="function"?i.initialData():i.initialData,c=o!==void 0,m=c?typeof i.initialDataUpdatedAt=="function"?i.initialDataUpdatedAt():i.initialDataUpdatedAt:0;return{data:o,dataUpdateCount:0,dataUpdatedAt:c?m??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:c?"success":"pending",fetchStatus:"idle"}}var ic,vk,u9=(vk=class extends yw{constructor(o={}){super();Pr(this,ic);this.config=o,Hn(this,ic,new Map)}build(o,c,m){const v=c.queryKey,E=c.queryHash??wC(v,c);let I=this.get(E);return I||(I=new a9({cache:this,queryKey:v,queryHash:E,options:o.defaultQueryOptions(c),state:m,defaultOptions:o.getQueryDefaults(v)}),this.add(I)),I}add(o){qt(this,ic).has(o.queryHash)||(qt(this,ic).set(o.queryHash,o),this.notify({type:"added",query:o}))}remove(o){const c=qt(this,ic).get(o.queryHash);c&&(o.destroy(),c===o&&qt(this,ic).delete(o.queryHash),this.notify({type:"removed",query:o}))}clear(){qo.batch(()=>{this.getAll().forEach(o=>{this.remove(o)})})}get(o){return qt(this,ic).get(o)}getAll(){return[...qt(this,ic).values()]}find(o){const c={exact:!0,...o};return this.getAll().find(m=>ND(c,m))}findAll(o={}){const c=this.getAll();return Object.keys(o).length>0?c.filter(m=>ND(o,m)):c}notify(o){qo.batch(()=>{this.listeners.forEach(c=>{c(o)})})}onFocus(){qo.batch(()=>{this.getAll().forEach(o=>{o.onFocus()})})}onOnline(){qo.batch(()=>{this.getAll().forEach(o=>{o.onOnline()})})}},ic=new WeakMap,vk),nc,Uo,Hh,rc,Ju,wk,d9=(wk=class extends _3{constructor(o){super();Pr(this,rc);Pr(this,nc);Pr(this,Uo);Pr(this,Hh);this.mutationId=o.mutationId,Hn(this,Uo,o.mutationCache),Hn(this,nc,[]),this.state=o.state||h9(),this.setOptions(o.options),this.scheduleGc()}setOptions(o){this.options=o,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(o){qt(this,nc).includes(o)||(qt(this,nc).push(o),this.clearGcTimeout(),qt(this,Uo).notify({type:"observerAdded",mutation:this,observer:o}))}removeObserver(o){Hn(this,nc,qt(this,nc).filter(c=>c!==o)),this.scheduleGc(),qt(this,Uo).notify({type:"observerRemoved",mutation:this,observer:o})}optionalRemove(){qt(this,nc).length||(this.state.status==="pending"?this.scheduleGc():qt(this,Uo).remove(this))}continue(){var o;return((o=qt(this,Hh))==null?void 0:o.continue())??this.execute(this.state.variables)}async execute(o){var v,E,I,s,O,j,G,W,B,te,ue,J,ce,oe,ee,Q,Ie,pe,Ke,et;Hn(this,Hh,g3({fn:()=>this.options.mutationFn?this.options.mutationFn(o):Promise.reject(new Error("No mutationFn found")),onFail:(at,Xt)=>{So(this,rc,Ju).call(this,{type:"failed",failureCount:at,error:Xt})},onPause:()=>{So(this,rc,Ju).call(this,{type:"pause"})},onContinue:()=>{So(this,rc,Ju).call(this,{type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>qt(this,Uo).canRun(this)}));const c=this.state.status==="pending",m=!qt(this,Hh).canStart();try{if(!c){So(this,rc,Ju).call(this,{type:"pending",variables:o,isPaused:m}),await((E=(v=qt(this,Uo).config).onMutate)==null?void 0:E.call(v,o,this));const Xt=await((s=(I=this.options).onMutate)==null?void 0:s.call(I,o));Xt!==this.state.context&&So(this,rc,Ju).call(this,{type:"pending",context:Xt,variables:o,isPaused:m})}const at=await qt(this,Hh).start();return await((j=(O=qt(this,Uo).config).onSuccess)==null?void 0:j.call(O,at,o,this.state.context,this)),await((W=(G=this.options).onSuccess)==null?void 0:W.call(G,at,o,this.state.context)),await((te=(B=qt(this,Uo).config).onSettled)==null?void 0:te.call(B,at,null,this.state.variables,this.state.context,this)),await((J=(ue=this.options).onSettled)==null?void 0:J.call(ue,at,null,o,this.state.context)),So(this,rc,Ju).call(this,{type:"success",data:at}),at}catch(at){try{throw await((oe=(ce=qt(this,Uo).config).onError)==null?void 0:oe.call(ce,at,o,this.state.context,this)),await((Q=(ee=this.options).onError)==null?void 0:Q.call(ee,at,o,this.state.context)),await((pe=(Ie=qt(this,Uo).config).onSettled)==null?void 0:pe.call(Ie,void 0,at,this.state.variables,this.state.context,this)),await((et=(Ke=this.options).onSettled)==null?void 0:et.call(Ke,void 0,at,o,this.state.context)),at}finally{So(this,rc,Ju).call(this,{type:"error",error:at})}}finally{qt(this,Uo).runNext(this)}}},nc=new WeakMap,Uo=new WeakMap,Hh=new WeakMap,rc=new WeakSet,Ju=function(o){const c=m=>{switch(o.type){case"failed":return{...m,failureCount:o.failureCount,failureReason:o.error};case"pause":return{...m,isPaused:!0};case"continue":return{...m,isPaused:!1};case"pending":return{...m,context:o.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:o.isPaused,status:"pending",variables:o.variables,submittedAt:Date.now()};case"success":return{...m,data:o.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...m,data:void 0,error:o.error,failureCount:m.failureCount+1,failureReason:o.error,isPaused:!1,status:"error"}}};this.state=c(this.state),qo.batch(()=>{qt(this,nc).forEach(m=>{m.onMutationUpdate(o)}),qt(this,Uo).notify({mutation:this,type:"updated",action:o})})},wk);function h9(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var xa,Oy,bk,f9=(bk=class extends yw{constructor(o={}){super();Pr(this,xa);Pr(this,Oy);this.config=o,Hn(this,xa,new Map),Hn(this,Oy,Date.now())}build(o,c,m){const v=new d9({mutationCache:this,mutationId:++r0(this,Oy)._,options:o.defaultMutationOptions(c),state:m});return this.add(v),v}add(o){const c=A0(o),m=qt(this,xa).get(c)??[];m.push(o),qt(this,xa).set(c,m),this.notify({type:"added",mutation:o})}remove(o){var m;const c=A0(o);if(qt(this,xa).has(c)){const v=(m=qt(this,xa).get(c))==null?void 0:m.filter(E=>E!==o);v&&(v.length===0?qt(this,xa).delete(c):qt(this,xa).set(c,v))}this.notify({type:"removed",mutation:o})}canRun(o){var m;const c=(m=qt(this,xa).get(A0(o)))==null?void 0:m.find(v=>v.state.status==="pending");return!c||c===o}runNext(o){var m;const c=(m=qt(this,xa).get(A0(o)))==null?void 0:m.find(v=>v!==o&&v.state.isPaused);return(c==null?void 0:c.continue())??Promise.resolve()}clear(){qo.batch(()=>{this.getAll().forEach(o=>{this.remove(o)})})}getAll(){return[...qt(this,xa).values()].flat()}find(o){const c={exact:!0,...o};return this.getAll().find(m=>LD(c,m))}findAll(o={}){return this.getAll().filter(c=>LD(o,c))}notify(o){qo.batch(()=>{this.listeners.forEach(c=>{c(o)})})}resumePausedMutations(){const o=this.getAll().filter(c=>c.state.isPaused);return qo.batch(()=>Promise.all(o.map(c=>c.continue().catch(dl))))}},xa=new WeakMap,Oy=new WeakMap,bk);function A0(i){var o;return((o=i.options.scope)==null?void 0:o.id)??String(i.mutationId)}function FD(i){return{onFetch:(o,c)=>{var G,W,B,te,ue;const m=o.options,v=(B=(W=(G=o.fetchOptions)==null?void 0:G.meta)==null?void 0:W.fetchMore)==null?void 0:B.direction,E=((te=o.state.data)==null?void 0:te.pages)||[],I=((ue=o.state.data)==null?void 0:ue.pageParams)||[];let s={pages:[],pageParams:[]},O=0;const j=async()=>{let J=!1;const ce=Q=>{Object.defineProperty(Q,"signal",{enumerable:!0,get:()=>(o.signal.aborted?J=!0:o.signal.addEventListener("abort",()=>{J=!0}),o.signal)})},oe=h3(o.options,o.fetchOptions),ee=async(Q,Ie,pe)=>{if(J)return Promise.reject();if(Ie==null&&Q.pages.length)return Promise.resolve(Q);const Ke={queryKey:o.queryKey,pageParam:Ie,direction:pe?"backward":"forward",meta:o.options.meta};ce(Ke);const et=await oe(Ke),{maxPages:at}=o.options,Xt=pe?t9:e9;return{pages:Xt(Q.pages,et,at),pageParams:Xt(Q.pageParams,Ie,at)}};if(v&&E.length){const Q=v==="backward",Ie=Q?p9:jD,pe={pages:E,pageParams:I},Ke=Ie(m,pe);s=await ee(pe,Ke,Q)}else{const Q=i??E.length;do{const Ie=O===0?I[0]??m.initialPageParam:jD(m,s);if(O>0&&Ie==null)break;s=await ee(s,Ie),O++}while(O<Q)}return s};o.options.persister?o.fetchFn=()=>{var J,ce;return(ce=(J=o.options).persister)==null?void 0:ce.call(J,j,{queryKey:o.queryKey,meta:o.options.meta,signal:o.signal},c)}:o.fetchFn=j}}}function jD(i,{pages:o,pageParams:c}){const m=o.length-1;return o.length>0?i.getNextPageParam(o[m],o,c[m],c):void 0}function p9(i,{pages:o,pageParams:c}){var m;return o.length>0?(m=i.getPreviousPageParam)==null?void 0:m.call(i,o[0],o,c[0],c):void 0}var ps,ld,cd,om,am,ud,lm,cm,Sk,m9=(Sk=class{constructor(i={}){Pr(this,ps);Pr(this,ld);Pr(this,cd);Pr(this,om);Pr(this,am);Pr(this,ud);Pr(this,lm);Pr(this,cm);Hn(this,ps,i.queryCache||new u9),Hn(this,ld,i.mutationCache||new f9),Hn(this,cd,i.defaultOptions||{}),Hn(this,om,new Map),Hn(this,am,new Map),Hn(this,ud,0)}mount(){r0(this,ud)._++,qt(this,ud)===1&&(Hn(this,lm,f3.subscribe(async i=>{i&&(await this.resumePausedMutations(),qt(this,ps).onFocus())})),Hn(this,cm,M1.subscribe(async i=>{i&&(await this.resumePausedMutations(),qt(this,ps).onOnline())})))}unmount(){var i,o;r0(this,ud)._--,qt(this,ud)===0&&((i=qt(this,lm))==null||i.call(this),Hn(this,lm,void 0),(o=qt(this,cm))==null||o.call(this),Hn(this,cm,void 0))}isFetching(i){return qt(this,ps).findAll({...i,fetchStatus:"fetching"}).length}isMutating(i){return qt(this,ld).findAll({...i,status:"pending"}).length}getQueryData(i){var c;const o=this.defaultQueryOptions({queryKey:i});return(c=qt(this,ps).get(o.queryHash))==null?void 0:c.state.data}ensureQueryData(i){const o=this.getQueryData(i.queryKey);if(o===void 0)return this.fetchQuery(i);{const c=this.defaultQueryOptions(i),m=qt(this,ps).build(this,c);return i.revalidateIfStale&&m.isStaleByTime(kD(c.staleTime,m))&&this.prefetchQuery(c),Promise.resolve(o)}}getQueriesData(i){return qt(this,ps).findAll(i).map(({queryKey:o,state:c})=>{const m=c.data;return[o,m]})}setQueryData(i,o,c){const m=this.defaultQueryOptions({queryKey:i}),v=qt(this,ps).get(m.queryHash),E=v==null?void 0:v.state.data,I=Z7(o,E);if(I!==void 0)return qt(this,ps).build(this,m).setData(I,{...c,manual:!0})}setQueriesData(i,o,c){return qo.batch(()=>qt(this,ps).findAll(i).map(({queryKey:m})=>[m,this.setQueryData(m,o,c)]))}getQueryState(i){var c;const o=this.defaultQueryOptions({queryKey:i});return(c=qt(this,ps).get(o.queryHash))==null?void 0:c.state}removeQueries(i){const o=qt(this,ps);qo.batch(()=>{o.findAll(i).forEach(c=>{o.remove(c)})})}resetQueries(i,o){const c=qt(this,ps),m={type:"active",...i};return qo.batch(()=>(c.findAll(i).forEach(v=>{v.reset()}),this.refetchQueries(m,o)))}cancelQueries(i={},o={}){const c={revert:!0,...o},m=qo.batch(()=>qt(this,ps).findAll(i).map(v=>v.cancel(c)));return Promise.all(m).then(dl).catch(dl)}invalidateQueries(i={},o={}){return qo.batch(()=>{if(qt(this,ps).findAll(i).forEach(m=>{m.invalidate()}),i.refetchType==="none")return Promise.resolve();const c={...i,type:i.refetchType??i.type??"active"};return this.refetchQueries(c,o)})}refetchQueries(i={},o){const c={...o,cancelRefetch:(o==null?void 0:o.cancelRefetch)??!0},m=qo.batch(()=>qt(this,ps).findAll(i).filter(v=>!v.isDisabled()).map(v=>{let E=v.fetch(void 0,c);return c.throwOnError||(E=E.catch(dl)),v.state.fetchStatus==="paused"?Promise.resolve():E}));return Promise.all(m).then(dl)}fetchQuery(i){const o=this.defaultQueryOptions(i);o.retry===void 0&&(o.retry=!1);const c=qt(this,ps).build(this,o);return c.isStaleByTime(kD(o.staleTime,c))?c.fetch(o):Promise.resolve(c.state.data)}prefetchQuery(i){return this.fetchQuery(i).then(dl).catch(dl)}fetchInfiniteQuery(i){return i.behavior=FD(i.pages),this.fetchQuery(i)}prefetchInfiniteQuery(i){return this.fetchInfiniteQuery(i).then(dl).catch(dl)}ensureInfiniteQueryData(i){return i.behavior=FD(i.pages),this.ensureQueryData(i)}resumePausedMutations(){return M1.isOnline()?qt(this,ld).resumePausedMutations():Promise.resolve()}getQueryCache(){return qt(this,ps)}getMutationCache(){return qt(this,ld)}getDefaultOptions(){return qt(this,cd)}setDefaultOptions(i){Hn(this,cd,i)}setQueryDefaults(i,o){qt(this,om).set(Dy(i),{queryKey:i,defaultOptions:o})}getQueryDefaults(i){const o=[...qt(this,om).values()];let c={};return o.forEach(m=>{ky(i,m.queryKey)&&(c={...c,...m.defaultOptions})}),c}setMutationDefaults(i,o){qt(this,am).set(Dy(i),{mutationKey:i,defaultOptions:o})}getMutationDefaults(i){const o=[...qt(this,am).values()];let c={};return o.forEach(m=>{ky(i,m.mutationKey)&&(c={...c,...m.defaultOptions})}),c}defaultQueryOptions(i){if(i._defaulted)return i;const o={...qt(this,cd).queries,...this.getQueryDefaults(i.queryKey),...i,_defaulted:!0};return o.queryHash||(o.queryHash=wC(o.queryKey,o)),o.refetchOnReconnect===void 0&&(o.refetchOnReconnect=o.networkMode!=="always"),o.throwOnError===void 0&&(o.throwOnError=!!o.suspense),!o.networkMode&&o.persister&&(o.networkMode="offlineFirst"),o.enabled!==!0&&o.queryFn===bC&&(o.enabled=!1),o}defaultMutationOptions(i){return i!=null&&i._defaulted?i:{...qt(this,cd).mutations,...(i==null?void 0:i.mutationKey)&&this.getMutationDefaults(i.mutationKey),...i,_defaulted:!0}}clear(){qt(this,ps).clear(),qt(this,ld).clear()}},ps=new WeakMap,ld=new WeakMap,cd=new WeakMap,om=new WeakMap,am=new WeakMap,ud=new WeakMap,lm=new WeakMap,cm=new WeakMap,Sk),g9=V.createContext(void 0),_9=({client:i,children:o})=>(V.useEffect(()=>(i.mount(),()=>{i.unmount()}),[i]),x.jsx(g9.Provider,{value:i,children:o}));const y3=V.createContext(void 0),Pp={CUSTOMER:{mobile:"9876543210",password:"customer123",name:"Demo Customer",isAdmin:!1},ADMIN:{mobile:"9999999999",password:"admin123",name:"Admin User",isAdmin:!0}},y9=({children:i})=>{const[o,c]=V.useState(null),[m,v]=V.useState(!0);V.useEffect(()=>{const j=localStorage.getItem("user");j&&c(JSON.parse(j)),v(!1)},[]);const O={user:o,loading:m,login:async(j,G)=>{let W=null;return j===Pp.CUSTOMER.mobile&&G===Pp.CUSTOMER.password?W={id:Date.now().toString(),mobile:j,name:Pp.CUSTOMER.name,isAdmin:!1}:j===Pp.ADMIN.mobile&&G===Pp.ADMIN.password&&(W={id:Date.now().toString(),mobile:j,name:Pp.ADMIN.name,isAdmin:!0}),W?(c(W),localStorage.setItem("user",JSON.stringify(W)),!0):!1},register:async(j,G,W)=>{const B={id:Date.now().toString(),mobile:j,name:G,isAdmin:!1};return c(B),localStorage.setItem("user",JSON.stringify(B)),!0},logout:()=>{c(null),localStorage.removeItem("user"),localStorage.removeItem("cart")},isAuthenticated:!!o,isAdmin:(o==null?void 0:o.isAdmin)||!1};return x.jsx(y3.Provider,{value:O,children:i})},Ld=()=>{const i=V.useContext(y3);if(i===void 0)throw new Error("useAuth must be used within an AuthProvider");return i},x3=V.createContext(void 0),x9=({children:i})=>{const[o,c]=V.useState([]);V.useEffect(()=>{if(!localStorage.getItem("user")){localStorage.removeItem("cart"),c([]);return}const W=localStorage.getItem("cart");W&&c(JSON.parse(W))},[]),V.useEffect(()=>{localStorage.setItem("cart",JSON.stringify(o))},[o]);const m=G=>{const W=G.price*G.weight,B=o.find(te=>te.id===G.id);c(B?o.map(te=>te.id===G.id?{...te,weight:G.weight,total:W}:te):[...o,{...G,total:W}])},v=(G,W)=>{c(o.map(B=>B.id===G?{...B,weight:W,total:B.price*W}:B))},E=G=>{c(o.filter(W=>W.id!==G))},I=()=>{c([]),localStorage.removeItem("cart")},s=o.reduce((G,W)=>G+W.total,0),O=o.reduce((G,W)=>G+W.weight,0),j={items:o,totalAmount:s,itemCount:O,addToCart:m,updateQuantity:v,removeFromCart:E,clearCart:I};return x.jsx(x3.Provider,{value:j,children:i})},vw=()=>{const i=V.useContext(x3);if(i===void 0)throw new Error("useCart must be used within a CartProvider");return i},v9=Cm("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-md hover:shadow-lg",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 shadow-md hover:shadow-lg",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground shadow-sm hover:shadow-md",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 shadow-sm hover:shadow-md",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",meat:"bg-meat-red text-white hover:bg-meat-red-hover shadow-lg hover:shadow-xl transform hover:scale-105",success:"bg-success text-success-foreground hover:bg-success/90 shadow-md hover:shadow-lg",warning:"bg-warning text-warning-foreground hover:bg-warning/90 shadow-md hover:shadow-lg"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",xl:"h-12 rounded-lg px-10 text-base",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Si=V.forwardRef(({className:i,variant:o,size:c,asChild:m=!1,...v},E)=>{const I=m?da:"button";return x.jsx(I,{className:ui(v9({variant:o,size:c,className:i})),ref:E,...v})});Si.displayName="Button";const w9=Cm("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function es({className:i,variant:o,...c}){return x.jsx("div",{className:ui(w9({variant:o}),i),...c})}var xS="focusScope.autoFocusOnMount",vS="focusScope.autoFocusOnUnmount",BD={bubbles:!1,cancelable:!0},b9="FocusScope",ww=V.forwardRef((i,o)=>{const{loop:c=!1,trapped:m=!1,onMountAutoFocus:v,onUnmountAutoFocus:E,...I}=i,[s,O]=V.useState(null),j=po(v),G=po(E),W=V.useRef(null),B=vr(o,J=>O(J)),te=V.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;V.useEffect(()=>{if(m){let J=function(Q){if(te.paused||!s)return;const Ie=Q.target;s.contains(Ie)?W.current=Ie:Qu(W.current,{select:!0})},ce=function(Q){if(te.paused||!s)return;const Ie=Q.relatedTarget;Ie!==null&&(s.contains(Ie)||Qu(W.current,{select:!0}))},oe=function(Q){if(document.activeElement===document.body)for(const pe of Q)pe.removedNodes.length>0&&Qu(s)};document.addEventListener("focusin",J),document.addEventListener("focusout",ce);const ee=new MutationObserver(oe);return s&&ee.observe(s,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",J),document.removeEventListener("focusout",ce),ee.disconnect()}}},[m,s,te.paused]),V.useEffect(()=>{if(s){UD.add(te);const J=document.activeElement;if(!s.contains(J)){const oe=new CustomEvent(xS,BD);s.addEventListener(xS,j),s.dispatchEvent(oe),oe.defaultPrevented||(S9(I9(v3(s)),{select:!0}),document.activeElement===J&&Qu(s))}return()=>{s.removeEventListener(xS,j),setTimeout(()=>{const oe=new CustomEvent(vS,BD);s.addEventListener(vS,G),s.dispatchEvent(oe),oe.defaultPrevented||Qu(J??document.body,{select:!0}),s.removeEventListener(vS,G),UD.remove(te)},0)}}},[s,j,G,te]);const ue=V.useCallback(J=>{if(!c&&!m||te.paused)return;const ce=J.key==="Tab"&&!J.altKey&&!J.ctrlKey&&!J.metaKey,oe=document.activeElement;if(ce&&oe){const ee=J.currentTarget,[Q,Ie]=T9(ee);Q&&Ie?!J.shiftKey&&oe===Ie?(J.preventDefault(),c&&Qu(Q,{select:!0})):J.shiftKey&&oe===Q&&(J.preventDefault(),c&&Qu(Ie,{select:!0})):oe===ee&&J.preventDefault()}},[c,m,te.paused]);return x.jsx(fn.div,{tabIndex:-1,...I,ref:B,onKeyDown:ue})});ww.displayName=b9;function S9(i,{select:o=!1}={}){const c=document.activeElement;for(const m of i)if(Qu(m,{select:o}),document.activeElement!==c)return}function T9(i){const o=v3(i),c=VD(o,i),m=VD(o.reverse(),i);return[c,m]}function v3(i){const o=[],c=document.createTreeWalker(i,NodeFilter.SHOW_ELEMENT,{acceptNode:m=>{const v=m.tagName==="INPUT"&&m.type==="hidden";return m.disabled||m.hidden||v?NodeFilter.FILTER_SKIP:m.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;c.nextNode();)o.push(c.currentNode);return o}function VD(i,o){for(const c of i)if(!E9(c,{upTo:o}))return c}function E9(i,{upTo:o}){if(getComputedStyle(i).visibility==="hidden")return!0;for(;i;){if(o!==void 0&&i===o)return!1;if(getComputedStyle(i).display==="none")return!0;i=i.parentElement}return!1}function C9(i){return i instanceof HTMLInputElement&&"select"in i}function Qu(i,{select:o=!1}={}){if(i&&i.focus){const c=document.activeElement;i.focus({preventScroll:!0}),i!==c&&C9(i)&&o&&i.select()}}var UD=A9();function A9(){let i=[];return{add(o){const c=i[0];o!==c&&(c==null||c.pause()),i=GD(i,o),i.unshift(o)},remove(o){var c;i=GD(i,o),(c=i[0])==null||c.resume()}}}function GD(i,o){const c=[...i],m=c.indexOf(o);return m!==-1&&c.splice(m,1),c}function I9(i){return i.filter(o=>o.tagName!=="A")}var wS=0;function SC(){V.useEffect(()=>{const i=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",i[0]??$D()),document.body.insertAdjacentElement("beforeend",i[1]??$D()),wS++,()=>{wS===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(o=>o.remove()),wS--}},[])}function $D(){const i=document.createElement("span");return i.setAttribute("data-radix-focus-guard",""),i.tabIndex=0,i.style.outline="none",i.style.opacity="0",i.style.position="fixed",i.style.pointerEvents="none",i}var oc=function(){return oc=Object.assign||function(o){for(var c,m=1,v=arguments.length;m<v;m++){c=arguments[m];for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(o[E]=c[E])}return o},oc.apply(this,arguments)};function w3(i,o){var c={};for(var m in i)Object.prototype.hasOwnProperty.call(i,m)&&o.indexOf(m)<0&&(c[m]=i[m]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var v=0,m=Object.getOwnPropertySymbols(i);v<m.length;v++)o.indexOf(m[v])<0&&Object.prototype.propertyIsEnumerable.call(i,m[v])&&(c[m[v]]=i[m[v]]);return c}function P9(i,o,c){if(c||arguments.length===2)for(var m=0,v=o.length,E;m<v;m++)(E||!(m in o))&&(E||(E=Array.prototype.slice.call(o,0,m)),E[m]=o[m]);return i.concat(E||Array.prototype.slice.call(o))}var Z0="right-scroll-bar-position",X0="width-before-scroll-bar",M9="with-scroll-bars-hidden",R9="--removed-body-scroll-bar-size";function bS(i,o){return typeof i=="function"?i(o):i&&(i.current=o),i}function D9(i,o){var c=V.useState(function(){return{value:i,callback:o,facade:{get current(){return c.value},set current(m){var v=c.value;v!==m&&(c.value=m,c.callback(m,v))}}}})[0];return c.callback=o,c.facade}var k9=typeof window<"u"?V.useLayoutEffect:V.useEffect,HD=new WeakMap;function N9(i,o){var c=D9(null,function(m){return i.forEach(function(v){return bS(v,m)})});return k9(function(){var m=HD.get(c);if(m){var v=new Set(m),E=new Set(i),I=c.current;v.forEach(function(s){E.has(s)||bS(s,null)}),E.forEach(function(s){v.has(s)||bS(s,I)})}HD.set(c,i)},[i]),c}function L9(i){return i}function z9(i,o){o===void 0&&(o=L9);var c=[],m=!1,v={read:function(){if(m)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return c.length?c[c.length-1]:i},useMedium:function(E){var I=o(E,m);return c.push(I),function(){c=c.filter(function(s){return s!==I})}},assignSyncMedium:function(E){for(m=!0;c.length;){var I=c;c=[],I.forEach(E)}c={push:function(s){return E(s)},filter:function(){return c}}},assignMedium:function(E){m=!0;var I=[];if(c.length){var s=c;c=[],s.forEach(E),I=c}var O=function(){var G=I;I=[],G.forEach(E)},j=function(){return Promise.resolve().then(O)};j(),c={push:function(G){I.push(G),j()},filter:function(G){return I=I.filter(G),c}}}};return v}function O9(i){i===void 0&&(i={});var o=z9(null);return o.options=oc({async:!0,ssr:!1},i),o}var b3=function(i){var o=i.sideCar,c=w3(i,["sideCar"]);if(!o)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var m=o.read();if(!m)throw new Error("Sidecar medium not found");return V.createElement(m,oc({},c))};b3.isSideCarExport=!0;function F9(i,o){return i.useMedium(o),b3}var S3=O9(),SS=function(){},bw=V.forwardRef(function(i,o){var c=V.useRef(null),m=V.useState({onScrollCapture:SS,onWheelCapture:SS,onTouchMoveCapture:SS}),v=m[0],E=m[1],I=i.forwardProps,s=i.children,O=i.className,j=i.removeScrollBar,G=i.enabled,W=i.shards,B=i.sideCar,te=i.noIsolation,ue=i.inert,J=i.allowPinchZoom,ce=i.as,oe=ce===void 0?"div":ce,ee=i.gapMode,Q=w3(i,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),Ie=B,pe=N9([c,o]),Ke=oc(oc({},Q),v);return V.createElement(V.Fragment,null,G&&V.createElement(Ie,{sideCar:S3,removeScrollBar:j,shards:W,noIsolation:te,inert:ue,setCallbacks:E,allowPinchZoom:!!J,lockRef:c,gapMode:ee}),I?V.cloneElement(V.Children.only(s),oc(oc({},Ke),{ref:pe})):V.createElement(oe,oc({},Ke,{className:O,ref:pe}),s))});bw.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};bw.classNames={fullWidth:X0,zeroRight:Z0};var j9=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function B9(){if(!document)return null;var i=document.createElement("style");i.type="text/css";var o=j9();return o&&i.setAttribute("nonce",o),i}function V9(i,o){i.styleSheet?i.styleSheet.cssText=o:i.appendChild(document.createTextNode(o))}function U9(i){var o=document.head||document.getElementsByTagName("head")[0];o.appendChild(i)}var G9=function(){var i=0,o=null;return{add:function(c){i==0&&(o=B9())&&(V9(o,c),U9(o)),i++},remove:function(){i--,!i&&o&&(o.parentNode&&o.parentNode.removeChild(o),o=null)}}},$9=function(){var i=G9();return function(o,c){V.useEffect(function(){return i.add(o),function(){i.remove()}},[o&&c])}},T3=function(){var i=$9(),o=function(c){var m=c.styles,v=c.dynamic;return i(m,v),null};return o},H9={left:0,top:0,right:0,gap:0},TS=function(i){return parseInt(i||"",10)||0},q9=function(i){var o=window.getComputedStyle(document.body),c=o[i==="padding"?"paddingLeft":"marginLeft"],m=o[i==="padding"?"paddingTop":"marginTop"],v=o[i==="padding"?"paddingRight":"marginRight"];return[TS(c),TS(m),TS(v)]},W9=function(i){if(i===void 0&&(i="margin"),typeof window>"u")return H9;var o=q9(i),c=document.documentElement.clientWidth,m=window.innerWidth;return{left:o[0],top:o[1],right:o[2],gap:Math.max(0,m-c+o[2]-o[0])}},Z9=T3(),em="data-scroll-locked",X9=function(i,o,c,m){var v=i.left,E=i.top,I=i.right,s=i.gap;return c===void 0&&(c="margin"),`
  .`.concat(M9,` {
   overflow: hidden `).concat(m,`;
   padding-right: `).concat(s,"px ").concat(m,`;
  }
  body[`).concat(em,`] {
    overflow: hidden `).concat(m,`;
    overscroll-behavior: contain;
    `).concat([o&&"position: relative ".concat(m,";"),c==="margin"&&`
    padding-left: `.concat(v,`px;
    padding-top: `).concat(E,`px;
    padding-right: `).concat(I,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(s,"px ").concat(m,`;
    `),c==="padding"&&"padding-right: ".concat(s,"px ").concat(m,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Z0,` {
    right: `).concat(s,"px ").concat(m,`;
  }
  
  .`).concat(X0,` {
    margin-right: `).concat(s,"px ").concat(m,`;
  }
  
  .`).concat(Z0," .").concat(Z0,` {
    right: 0 `).concat(m,`;
  }
  
  .`).concat(X0," .").concat(X0,` {
    margin-right: 0 `).concat(m,`;
  }
  
  body[`).concat(em,`] {
    `).concat(R9,": ").concat(s,`px;
  }
`)},qD=function(){var i=parseInt(document.body.getAttribute(em)||"0",10);return isFinite(i)?i:0},K9=function(){V.useEffect(function(){return document.body.setAttribute(em,(qD()+1).toString()),function(){var i=qD()-1;i<=0?document.body.removeAttribute(em):document.body.setAttribute(em,i.toString())}},[])},Y9=function(i){var o=i.noRelative,c=i.noImportant,m=i.gapMode,v=m===void 0?"margin":m;K9();var E=V.useMemo(function(){return W9(v)},[v]);return V.createElement(Z9,{styles:X9(E,!o,v,c?"":"!important")})},GT=!1;if(typeof window<"u")try{var I0=Object.defineProperty({},"passive",{get:function(){return GT=!0,!0}});window.addEventListener("test",I0,I0),window.removeEventListener("test",I0,I0)}catch{GT=!1}var Mp=GT?{passive:!1}:!1,J9=function(i){return i.tagName==="TEXTAREA"},E3=function(i,o){if(!(i instanceof Element))return!1;var c=window.getComputedStyle(i);return c[o]!=="hidden"&&!(c.overflowY===c.overflowX&&!J9(i)&&c[o]==="visible")},Q9=function(i){return E3(i,"overflowY")},eq=function(i){return E3(i,"overflowX")},WD=function(i,o){var c=o.ownerDocument,m=o;do{typeof ShadowRoot<"u"&&m instanceof ShadowRoot&&(m=m.host);var v=C3(i,m);if(v){var E=A3(i,m),I=E[1],s=E[2];if(I>s)return!0}m=m.parentNode}while(m&&m!==c.body);return!1},tq=function(i){var o=i.scrollTop,c=i.scrollHeight,m=i.clientHeight;return[o,c,m]},iq=function(i){var o=i.scrollLeft,c=i.scrollWidth,m=i.clientWidth;return[o,c,m]},C3=function(i,o){return i==="v"?Q9(o):eq(o)},A3=function(i,o){return i==="v"?tq(o):iq(o)},nq=function(i,o){return i==="h"&&o==="rtl"?-1:1},rq=function(i,o,c,m,v){var E=nq(i,window.getComputedStyle(o).direction),I=E*m,s=c.target,O=o.contains(s),j=!1,G=I>0,W=0,B=0;do{var te=A3(i,s),ue=te[0],J=te[1],ce=te[2],oe=J-ce-E*ue;(ue||oe)&&C3(i,s)&&(W+=oe,B+=ue),s instanceof ShadowRoot?s=s.host:s=s.parentNode}while(!O&&s!==document.body||O&&(o.contains(s)||o===s));return(G&&(Math.abs(W)<1||!v)||!G&&(Math.abs(B)<1||!v))&&(j=!0),j},P0=function(i){return"changedTouches"in i?[i.changedTouches[0].clientX,i.changedTouches[0].clientY]:[0,0]},ZD=function(i){return[i.deltaX,i.deltaY]},XD=function(i){return i&&"current"in i?i.current:i},sq=function(i,o){return i[0]===o[0]&&i[1]===o[1]},oq=function(i){return`
  .block-interactivity-`.concat(i,` {pointer-events: none;}
  .allow-interactivity-`).concat(i,` {pointer-events: all;}
`)},aq=0,Rp=[];function lq(i){var o=V.useRef([]),c=V.useRef([0,0]),m=V.useRef(),v=V.useState(aq++)[0],E=V.useState(T3)[0],I=V.useRef(i);V.useEffect(function(){I.current=i},[i]),V.useEffect(function(){if(i.inert){document.body.classList.add("block-interactivity-".concat(v));var J=P9([i.lockRef.current],(i.shards||[]).map(XD),!0).filter(Boolean);return J.forEach(function(ce){return ce.classList.add("allow-interactivity-".concat(v))}),function(){document.body.classList.remove("block-interactivity-".concat(v)),J.forEach(function(ce){return ce.classList.remove("allow-interactivity-".concat(v))})}}},[i.inert,i.lockRef.current,i.shards]);var s=V.useCallback(function(J,ce){if("touches"in J&&J.touches.length===2||J.type==="wheel"&&J.ctrlKey)return!I.current.allowPinchZoom;var oe=P0(J),ee=c.current,Q="deltaX"in J?J.deltaX:ee[0]-oe[0],Ie="deltaY"in J?J.deltaY:ee[1]-oe[1],pe,Ke=J.target,et=Math.abs(Q)>Math.abs(Ie)?"h":"v";if("touches"in J&&et==="h"&&Ke.type==="range")return!1;var at=WD(et,Ke);if(!at)return!0;if(at?pe=et:(pe=et==="v"?"h":"v",at=WD(et,Ke)),!at)return!1;if(!m.current&&"changedTouches"in J&&(Q||Ie)&&(m.current=pe),!pe)return!0;var Xt=m.current||pe;return rq(Xt,ce,J,Xt==="h"?Q:Ie,!0)},[]),O=V.useCallback(function(J){var ce=J;if(!(!Rp.length||Rp[Rp.length-1]!==E)){var oe="deltaY"in ce?ZD(ce):P0(ce),ee=o.current.filter(function(pe){return pe.name===ce.type&&(pe.target===ce.target||ce.target===pe.shadowParent)&&sq(pe.delta,oe)})[0];if(ee&&ee.should){ce.cancelable&&ce.preventDefault();return}if(!ee){var Q=(I.current.shards||[]).map(XD).filter(Boolean).filter(function(pe){return pe.contains(ce.target)}),Ie=Q.length>0?s(ce,Q[0]):!I.current.noIsolation;Ie&&ce.cancelable&&ce.preventDefault()}}},[]),j=V.useCallback(function(J,ce,oe,ee){var Q={name:J,delta:ce,target:oe,should:ee,shadowParent:cq(oe)};o.current.push(Q),setTimeout(function(){o.current=o.current.filter(function(Ie){return Ie!==Q})},1)},[]),G=V.useCallback(function(J){c.current=P0(J),m.current=void 0},[]),W=V.useCallback(function(J){j(J.type,ZD(J),J.target,s(J,i.lockRef.current))},[]),B=V.useCallback(function(J){j(J.type,P0(J),J.target,s(J,i.lockRef.current))},[]);V.useEffect(function(){return Rp.push(E),i.setCallbacks({onScrollCapture:W,onWheelCapture:W,onTouchMoveCapture:B}),document.addEventListener("wheel",O,Mp),document.addEventListener("touchmove",O,Mp),document.addEventListener("touchstart",G,Mp),function(){Rp=Rp.filter(function(J){return J!==E}),document.removeEventListener("wheel",O,Mp),document.removeEventListener("touchmove",O,Mp),document.removeEventListener("touchstart",G,Mp)}},[]);var te=i.removeScrollBar,ue=i.inert;return V.createElement(V.Fragment,null,ue?V.createElement(E,{styles:oq(v)}):null,te?V.createElement(Y9,{gapMode:i.gapMode}):null)}function cq(i){for(var o=null;i!==null;)i instanceof ShadowRoot&&(o=i.host,i=i.host),i=i.parentNode;return o}const uq=F9(S3,lq);var Sw=V.forwardRef(function(i,o){return V.createElement(bw,oc({},i,{ref:o,sideCar:uq}))});Sw.classNames=bw.classNames;var dq=function(i){if(typeof document>"u")return null;var o=Array.isArray(i)?i[0]:i;return o.ownerDocument.body},Dp=new WeakMap,M0=new WeakMap,R0={},ES=0,I3=function(i){return i&&(i.host||I3(i.parentNode))},hq=function(i,o){return o.map(function(c){if(i.contains(c))return c;var m=I3(c);return m&&i.contains(m)?m:(console.error("aria-hidden",c,"in not contained inside",i,". Doing nothing"),null)}).filter(function(c){return!!c})},fq=function(i,o,c,m){var v=hq(o,Array.isArray(i)?i:[i]);R0[c]||(R0[c]=new WeakMap);var E=R0[c],I=[],s=new Set,O=new Set(v),j=function(W){!W||s.has(W)||(s.add(W),j(W.parentNode))};v.forEach(j);var G=function(W){!W||O.has(W)||Array.prototype.forEach.call(W.children,function(B){if(s.has(B))G(B);else try{var te=B.getAttribute(m),ue=te!==null&&te!=="false",J=(Dp.get(B)||0)+1,ce=(E.get(B)||0)+1;Dp.set(B,J),E.set(B,ce),I.push(B),J===1&&ue&&M0.set(B,!0),ce===1&&B.setAttribute(c,"true"),ue||B.setAttribute(m,"true")}catch(oe){console.error("aria-hidden: cannot operate on ",B,oe)}})};return G(o),s.clear(),ES++,function(){I.forEach(function(W){var B=Dp.get(W)-1,te=E.get(W)-1;Dp.set(W,B),E.set(W,te),B||(M0.has(W)||W.removeAttribute(m),M0.delete(W)),te||W.removeAttribute(c)}),ES--,ES||(Dp=new WeakMap,Dp=new WeakMap,M0=new WeakMap,R0={})}},TC=function(i,o,c){c===void 0&&(c="data-aria-hidden");var m=Array.from(Array.isArray(i)?i:[i]),v=dq(i);return v?(m.push.apply(m,Array.from(v.querySelectorAll("[aria-live]"))),fq(m,v,c,"aria-hidden")):function(){return null}},EC="Dialog",[P3,_K]=iu(EC),[pq,Cl]=P3(EC),M3=i=>{const{__scopeDialog:o,children:c,open:m,defaultOpen:v,onOpenChange:E,modal:I=!0}=i,s=V.useRef(null),O=V.useRef(null),[j=!1,G]=Yc({prop:m,defaultProp:v,onChange:E});return x.jsx(pq,{scope:o,triggerRef:s,contentRef:O,contentId:vl(),titleId:vl(),descriptionId:vl(),open:j,onOpenChange:G,onOpenToggle:V.useCallback(()=>G(W=>!W),[G]),modal:I,children:c})};M3.displayName=EC;var R3="DialogTrigger",D3=V.forwardRef((i,o)=>{const{__scopeDialog:c,...m}=i,v=Cl(R3,c),E=vr(o,v.triggerRef);return x.jsx(fn.button,{type:"button","aria-haspopup":"dialog","aria-expanded":v.open,"aria-controls":v.contentId,"data-state":IC(v.open),...m,ref:E,onClick:Ai(i.onClick,v.onOpenToggle)})});D3.displayName=R3;var CC="DialogPortal",[mq,k3]=P3(CC,{forceMount:void 0}),N3=i=>{const{__scopeDialog:o,forceMount:c,children:m,container:v}=i,E=Cl(CC,o);return x.jsx(mq,{scope:o,forceMount:c,children:V.Children.map(m,I=>x.jsx(El,{present:c||E.open,children:x.jsx(Gy,{asChild:!0,container:v,children:I})}))})};N3.displayName=CC;var R1="DialogOverlay",L3=V.forwardRef((i,o)=>{const c=k3(R1,i.__scopeDialog),{forceMount:m=c.forceMount,...v}=i,E=Cl(R1,i.__scopeDialog);return E.modal?x.jsx(El,{present:m||E.open,children:x.jsx(gq,{...v,ref:o})}):null});L3.displayName=R1;var gq=V.forwardRef((i,o)=>{const{__scopeDialog:c,...m}=i,v=Cl(R1,c);return x.jsx(Sw,{as:da,allowPinchZoom:!0,shards:[v.contentRef],children:x.jsx(fn.div,{"data-state":IC(v.open),...m,ref:o,style:{pointerEvents:"auto",...m.style}})})}),tf="DialogContent",z3=V.forwardRef((i,o)=>{const c=k3(tf,i.__scopeDialog),{forceMount:m=c.forceMount,...v}=i,E=Cl(tf,i.__scopeDialog);return x.jsx(El,{present:m||E.open,children:E.modal?x.jsx(_q,{...v,ref:o}):x.jsx(yq,{...v,ref:o})})});z3.displayName=tf;var _q=V.forwardRef((i,o)=>{const c=Cl(tf,i.__scopeDialog),m=V.useRef(null),v=vr(o,c.contentRef,m);return V.useEffect(()=>{const E=m.current;if(E)return TC(E)},[]),x.jsx(O3,{...i,ref:v,trapFocus:c.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ai(i.onCloseAutoFocus,E=>{var I;E.preventDefault(),(I=c.triggerRef.current)==null||I.focus()}),onPointerDownOutside:Ai(i.onPointerDownOutside,E=>{const I=E.detail.originalEvent,s=I.button===0&&I.ctrlKey===!0;(I.button===2||s)&&E.preventDefault()}),onFocusOutside:Ai(i.onFocusOutside,E=>E.preventDefault())})}),yq=V.forwardRef((i,o)=>{const c=Cl(tf,i.__scopeDialog),m=V.useRef(!1),v=V.useRef(!1);return x.jsx(O3,{...i,ref:o,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:E=>{var I,s;(I=i.onCloseAutoFocus)==null||I.call(i,E),E.defaultPrevented||(m.current||(s=c.triggerRef.current)==null||s.focus(),E.preventDefault()),m.current=!1,v.current=!1},onInteractOutside:E=>{var O,j;(O=i.onInteractOutside)==null||O.call(i,E),E.defaultPrevented||(m.current=!0,E.detail.originalEvent.type==="pointerdown"&&(v.current=!0));const I=E.target;((j=c.triggerRef.current)==null?void 0:j.contains(I))&&E.preventDefault(),E.detail.originalEvent.type==="focusin"&&v.current&&E.preventDefault()}})}),O3=V.forwardRef((i,o)=>{const{__scopeDialog:c,trapFocus:m,onOpenAutoFocus:v,onCloseAutoFocus:E,...I}=i,s=Cl(tf,c),O=V.useRef(null),j=vr(o,O);return SC(),x.jsxs(x.Fragment,{children:[x.jsx(ww,{asChild:!0,loop:!0,trapped:m,onMountAutoFocus:v,onUnmountAutoFocus:E,children:x.jsx(Em,{role:"dialog",id:s.contentId,"aria-describedby":s.descriptionId,"aria-labelledby":s.titleId,"data-state":IC(s.open),...I,ref:j,onDismiss:()=>s.onOpenChange(!1)})}),x.jsxs(x.Fragment,{children:[x.jsx(xq,{titleId:s.titleId}),x.jsx(wq,{contentRef:O,descriptionId:s.descriptionId})]})]})}),AC="DialogTitle",F3=V.forwardRef((i,o)=>{const{__scopeDialog:c,...m}=i,v=Cl(AC,c);return x.jsx(fn.h2,{id:v.titleId,...m,ref:o})});F3.displayName=AC;var j3="DialogDescription",B3=V.forwardRef((i,o)=>{const{__scopeDialog:c,...m}=i,v=Cl(j3,c);return x.jsx(fn.p,{id:v.descriptionId,...m,ref:o})});B3.displayName=j3;var V3="DialogClose",U3=V.forwardRef((i,o)=>{const{__scopeDialog:c,...m}=i,v=Cl(V3,c);return x.jsx(fn.button,{type:"button",...m,ref:o,onClick:Ai(i.onClick,()=>v.onOpenChange(!1))})});U3.displayName=V3;function IC(i){return i?"open":"closed"}var G3="DialogTitleWarning",[yK,$3]=rG(G3,{contentName:tf,titleName:AC,docsSlug:"dialog"}),xq=({titleId:i})=>{const o=$3(G3),c=`\`${o.contentName}\` requires a \`${o.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${o.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${o.docsSlug}`;return V.useEffect(()=>{i&&(document.getElementById(i)||console.error(c))},[c,i]),null},vq="DialogDescriptionWarning",wq=({contentRef:i,descriptionId:o})=>{const m=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${$3(vq).contentName}}.`;return V.useEffect(()=>{var E;const v=(E=i.current)==null?void 0:E.getAttribute("aria-describedby");o&&v&&(document.getElementById(o)||console.warn(m))},[m,i,o]),null},H3=M3,q3=D3,W3=N3,Tw=L3,Ew=z3,Cw=F3,Aw=B3,Z3=U3;const X3=H3,bq=q3,Sq=W3,K3=V.forwardRef(({className:i,...o},c)=>x.jsx(Tw,{className:ui("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",i),...o,ref:c}));K3.displayName=Tw.displayName;const Tq=Cm("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),PC=V.forwardRef(({side:i="right",className:o,children:c,...m},v)=>x.jsxs(Sq,{children:[x.jsx(K3,{}),x.jsxs(Ew,{ref:v,className:ui(Tq({side:i}),o),...m,children:[c,x.jsxs(Z3,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[x.jsx(oC,{className:"h-4 w-4"}),x.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));PC.displayName=Ew.displayName;const Eq=V.forwardRef(({className:i,...o},c)=>x.jsx(Cw,{ref:c,className:ui("text-lg font-semibold text-foreground",i),...o}));Eq.displayName=Cw.displayName;const Cq=V.forwardRef(({className:i,...o},c)=>x.jsx(Aw,{ref:c,className:ui("text-sm text-muted-foreground",i),...o}));Cq.displayName=Aw.displayName;var MC="Avatar",[Aq,xK]=iu(MC),[Iq,Y3]=Aq(MC),J3=V.forwardRef((i,o)=>{const{__scopeAvatar:c,...m}=i,[v,E]=V.useState("idle");return x.jsx(Iq,{scope:c,imageLoadingStatus:v,onImageLoadingStatusChange:E,children:x.jsx(fn.span,{...m,ref:o})})});J3.displayName=MC;var Q3="AvatarImage",eO=V.forwardRef((i,o)=>{const{__scopeAvatar:c,src:m,onLoadingStatusChange:v=()=>{},...E}=i,I=Y3(Q3,c),s=Pq(m,E.referrerPolicy),O=po(j=>{v(j),I.onImageLoadingStatusChange(j)});return to(()=>{s!=="idle"&&O(s)},[s,O]),s==="loaded"?x.jsx(fn.img,{...E,ref:o,src:m}):null});eO.displayName=Q3;var tO="AvatarFallback",iO=V.forwardRef((i,o)=>{const{__scopeAvatar:c,delayMs:m,...v}=i,E=Y3(tO,c),[I,s]=V.useState(m===void 0);return V.useEffect(()=>{if(m!==void 0){const O=window.setTimeout(()=>s(!0),m);return()=>window.clearTimeout(O)}},[m]),I&&E.imageLoadingStatus!=="loaded"?x.jsx(fn.span,{...v,ref:o}):null});iO.displayName=tO;function Pq(i,o){const[c,m]=V.useState("idle");return to(()=>{if(!i){m("error");return}let v=!0;const E=new window.Image,I=s=>()=>{v&&m(s)};return m("loading"),E.onload=I("loaded"),E.onerror=I("error"),E.src=i,o&&(E.referrerPolicy=o),()=>{v=!1}},[i,o]),c}var nO=J3,rO=eO,sO=iO;const oO=V.forwardRef(({className:i,...o},c)=>x.jsx(nO,{ref:c,className:ui("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",i),...o}));oO.displayName=nO.displayName;const Mq=V.forwardRef(({className:i,...o},c)=>x.jsx(rO,{ref:c,className:ui("aspect-square h-full w-full",i),...o}));Mq.displayName=rO.displayName;const aO=V.forwardRef(({className:i,...o},c)=>x.jsx(sO,{ref:c,className:ui("flex h-full w-full items-center justify-center rounded-full bg-muted",i),...o}));aO.displayName=sO.displayName;const Rq=()=>{var G;const{user:i,logout:o}=Ld(),{itemCount:c,clearCart:m}=vw(),v=Nd(),[E,I]=V.useState(!1),{toast:s}=ha(),O=()=>{if(v.pathname==="/"){const W=document.getElementById("special-offers");W&&W.scrollIntoView({behavior:"smooth"})}else window.location.href="/#special-offers"},j=()=>{if(v.pathname==="/"){const W=document.getElementById("meats-section");W&&W.scrollIntoView({behavior:"smooth"})}else window.location.href="/#meats-section"};return x.jsxs("div",{className:"min-h-screen bg-background",children:[x.jsx("header",{className:"bg-white border-b shadow-sm sticky top-0 z-40",children:x.jsx("div",{className:"container mx-auto px-4",children:x.jsxs("div",{className:"flex items-center justify-between h-16",children:[x.jsxs(Ho,{to:"/",className:"flex items-center space-x-2",children:[x.jsx("div",{className:"w-10 h-10 bg-red-600 rounded-lg flex items-center justify-center",children:x.jsx("span",{className:"text-white font-bold text-lg",children:"B"})}),x.jsx("span",{className:"font-bold text-xl text-red-600",children:"Butcher Blend"})]}),x.jsxs("nav",{className:"hidden md:flex items-center space-x-6",children:[x.jsxs("button",{className:"flex items-center gap-2 text-gray-700 hover:text-red-600 font-medium",onClick:()=>window.location.assign("/"),children:[x.jsx(xD,{className:"h-4 w-4"}),"Home"]}),x.jsxs("button",{onClick:O,className:"flex items-center gap-2 text-gray-700 hover:text-red-600 font-medium",children:[x.jsx(yD,{className:"h-4 w-4"}),"Special Offers"]}),x.jsx("button",{onClick:j,className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 font-medium",children:"Buy Now"})]}),x.jsxs("div",{className:"flex items-center space-x-4",children:[x.jsxs("button",{onClick:()=>{i?window.location.href="/cart":(window.location.href="/login?redirect=cart",s({title:"Login Required",description:"Please log in or register to view your cart",variant:"default"}))},className:"relative flex items-center gap-2 text-gray-700 hover:text-red-600",children:[x.jsxs("div",{className:"relative",children:[x.jsx(rC,{className:"h-6 w-6"}),c>0&&x.jsx(es,{className:"absolute -top-2 -right-2 bg-red-600 text-white text-xs min-w-5 h-5 rounded-full flex items-center justify-center",children:Math.round(c)})]}),x.jsx("span",{className:"hidden lg:block",children:"Cart"})]}),i?x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx(Ho,{to:"/profile",className:"flex items-center justify-center rounded-full bg-gray-100 hover:bg-gray-200 w-10 h-10",children:x.jsx(_D,{className:"h-6 w-6 text-red-600"})}),x.jsx(Si,{onClick:()=>{m(),o()},variant:"ghost",size:"icon",title:"Logout",className:"hover:bg-red-100",children:x.jsx(kT,{className:"h-6 w-6 text-red-600"})})]}):x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsx(Ho,{to:"/login",children:x.jsx(Si,{variant:"outline",size:"sm",children:"Login"})}),x.jsx(Ho,{to:"/register",children:x.jsx(Si,{size:"sm",className:"bg-red-600 hover:bg-red-700",children:"Register"})})]}),x.jsxs(X3,{open:E,onOpenChange:I,children:[x.jsx(bq,{asChild:!0,children:x.jsx(Si,{variant:"ghost",size:"sm",className:"md:hidden",children:x.jsx(e$,{className:"h-5 w-5"})})}),x.jsx(PC,{side:"right",className:"w-80",children:x.jsxs("div",{className:"flex flex-col space-y-4 mt-8",children:[!i&&x.jsxs("div",{className:"flex gap-2 mb-2",children:[x.jsx(Si,{variant:"outline",className:"flex-1",onClick:()=>{window.location.href="/login",I(!1)},children:"Login"}),x.jsx(Si,{className:"flex-1 bg-red-600 hover:bg-red-700",onClick:()=>{window.location.href="/register",I(!1)},children:"Register"})]}),x.jsxs("button",{className:"flex items-center gap-3 p-3 rounded-lg hover:bg-gray-100",onClick:()=>{I(!1),window.location.assign("/")},children:[x.jsx(xD,{className:"h-5 w-5"}),"Home"]}),x.jsxs("button",{onClick:()=>{O(),I(!1)},className:"flex items-center gap-3 p-3 rounded-lg hover:bg-gray-100 text-left",children:[x.jsx(yD,{className:"h-5 w-5"}),"Special Offers"]}),x.jsx("button",{onClick:()=>{j(),I(!1)},className:"flex items-center gap-3 p-3 rounded-lg bg-red-600 text-white font-medium",children:"Buy Now"}),i&&x.jsxs(x.Fragment,{children:[x.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-gray-50",children:[x.jsx(oO,{className:"h-10 w-10",children:x.jsx(aO,{className:"bg-red-100 text-red-600",children:((G=i.name)==null?void 0:G.charAt(0).toUpperCase())||"U"})}),x.jsxs("div",{children:[x.jsx("div",{className:"font-medium",children:i.name}),i.isAdmin&&x.jsx(es,{className:"mt-1 text-xs bg-red-100 text-red-600",children:"Admin"})]})]}),x.jsxs(Ho,{to:"/profile",className:"flex items-center gap-3 p-3 rounded-lg hover:bg-gray-100",onClick:()=>I(!1),children:[x.jsx(_D,{className:"h-5 w-5"}),"My Profile"]}),x.jsxs(Ho,{to:"/orders",className:"flex items-center gap-3 p-3 rounded-lg hover:bg-gray-100",onClick:()=>I(!1),children:[x.jsx(ml,{className:"h-5 w-5"}),"My Orders"]}),i.isAdmin&&x.jsxs(Ho,{to:"/admin",className:"flex items-center gap-3 p-3 rounded-lg hover:bg-gray-100",onClick:()=>I(!1),children:[x.jsx(Tz,{className:"h-5 w-5"}),"Admin Dashboard"]}),x.jsxs(Si,{onClick:()=>{m(),o(),I(!1)},className:"w-full mt-2 flex items-center gap-3 bg-red-50 text-red-600 hover:bg-red-100 hover:text-red-700 border border-red-200",children:[x.jsx(kT,{className:"h-5 w-5"}),"Logout"]})]})]})})]})]})]})})}),x.jsx("main",{children:x.jsx(ZL,{})})]})},CS=768;function Dq(){const[i,o]=V.useState(void 0);return V.useEffect(()=>{const c=window.matchMedia(`(max-width: ${CS-1}px)`),m=()=>{o(window.innerWidth<CS)};return c.addEventListener("change",m),o(window.innerWidth<CS),()=>c.removeEventListener("change",m)},[]),!!i}const tn=V.forwardRef(({className:i,type:o,...c},m)=>x.jsx("input",{type:o,className:ui("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",i),ref:m,...c}));tn.displayName="Input";var kq="Separator",KD="horizontal",Nq=["horizontal","vertical"],lO=V.forwardRef((i,o)=>{const{decorative:c,orientation:m=KD,...v}=i,E=Lq(m)?m:KD,s=c?{role:"none"}:{"aria-orientation":E==="vertical"?E:void 0,role:"separator"};return x.jsx(fn.div,{"data-orientation":E,...s,...v,ref:o})});lO.displayName=kq;function Lq(i){return Nq.includes(i)}var cO=lO;const ac=V.forwardRef(({className:i,orientation:o="horizontal",decorative:c=!0,...m},v)=>x.jsx(cO,{ref:v,decorative:c,orientation:o,className:ui("shrink-0 bg-border",o==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",i),...m}));ac.displayName=cO.displayName;function Cr({className:i,...o}){return x.jsx("div",{className:ui("animate-pulse rounded-md bg-muted",i),...o})}const zq="sidebar:state",Oq=60*60*24*7,Fq="16rem",jq="18rem",Bq="3rem",Vq="b",uO=V.createContext(null);function Wy(){const i=V.useContext(uO);if(!i)throw new Error("useSidebar must be used within a SidebarProvider.");return i}const dO=V.forwardRef(({defaultOpen:i=!0,open:o,onOpenChange:c,className:m,style:v,children:E,...I},s)=>{const O=Dq(),[j,G]=V.useState(!1),[W,B]=V.useState(i),te=o??W,ue=V.useCallback(ee=>{const Q=typeof ee=="function"?ee(te):ee;c?c(Q):B(Q),document.cookie=`${zq}=${Q}; path=/; max-age=${Oq}`},[c,te]),J=V.useCallback(()=>O?G(ee=>!ee):ue(ee=>!ee),[O,ue,G]);V.useEffect(()=>{const ee=Q=>{Q.key===Vq&&(Q.metaKey||Q.ctrlKey)&&(Q.preventDefault(),J())};return window.addEventListener("keydown",ee),()=>window.removeEventListener("keydown",ee)},[J]);const ce=te?"expanded":"collapsed",oe=V.useMemo(()=>({state:ce,open:te,setOpen:ue,isMobile:O,openMobile:j,setOpenMobile:G,toggleSidebar:J}),[ce,te,ue,O,j,G,J]);return x.jsx(uO.Provider,{value:oe,children:x.jsx(c3,{delayDuration:0,children:x.jsx("div",{style:{"--sidebar-width":Fq,"--sidebar-width-icon":Bq,...v},className:ui("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",m),ref:s,...I,children:E})})})});dO.displayName="SidebarProvider";const hO=V.forwardRef(({side:i="left",variant:o="sidebar",collapsible:c="offcanvas",className:m,children:v,...E},I)=>{const{isMobile:s,state:O,openMobile:j,setOpenMobile:G}=Wy();return c==="none"?x.jsx("div",{className:ui("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",m),ref:I,...E,children:v}):s?x.jsx(X3,{open:j,onOpenChange:G,...E,children:x.jsx(PC,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":jq},side:i,children:x.jsx("div",{className:"flex h-full w-full flex-col",children:v})})}):x.jsxs("div",{ref:I,className:"group peer hidden md:block text-sidebar-foreground","data-state":O,"data-collapsible":O==="collapsed"?c:"","data-variant":o,"data-side":i,children:[x.jsx("div",{className:ui("duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",o==="floating"||o==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]")}),x.jsx("div",{className:ui("duration-200 fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex",i==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",o==="floating"||o==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",m),...E,children:x.jsx("div",{"data-sidebar":"sidebar",className:"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow",children:v})})]})});hO.displayName="Sidebar";const fO=V.forwardRef(({className:i,onClick:o,...c},m)=>{const{toggleSidebar:v}=Wy();return x.jsxs(Si,{ref:m,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:ui("h-7 w-7",i),onClick:E=>{o==null||o(E),v()},...c,children:[x.jsx(t$,{}),x.jsx("span",{className:"sr-only",children:"Toggle Sidebar"})]})});fO.displayName="SidebarTrigger";const Uq=V.forwardRef(({className:i,...o},c)=>{const{toggleSidebar:m}=Wy();return x.jsx("button",{ref:c,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:m,title:"Toggle Sidebar",className:ui("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",i),...o})});Uq.displayName="SidebarRail";const Gq=V.forwardRef(({className:i,...o},c)=>x.jsx("main",{ref:c,className:ui("relative flex min-h-svh flex-1 flex-col bg-background","peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",i),...o}));Gq.displayName="SidebarInset";const $q=V.forwardRef(({className:i,...o},c)=>x.jsx(tn,{ref:c,"data-sidebar":"input",className:ui("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",i),...o}));$q.displayName="SidebarInput";const Hq=V.forwardRef(({className:i,...o},c)=>x.jsx("div",{ref:c,"data-sidebar":"header",className:ui("flex flex-col gap-2 p-2",i),...o}));Hq.displayName="SidebarHeader";const qq=V.forwardRef(({className:i,...o},c)=>x.jsx("div",{ref:c,"data-sidebar":"footer",className:ui("flex flex-col gap-2 p-2",i),...o}));qq.displayName="SidebarFooter";const Wq=V.forwardRef(({className:i,...o},c)=>x.jsx(ac,{ref:c,"data-sidebar":"separator",className:ui("mx-2 w-auto bg-sidebar-border",i),...o}));Wq.displayName="SidebarSeparator";const pO=V.forwardRef(({className:i,...o},c)=>x.jsx("div",{ref:c,"data-sidebar":"content",className:ui("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",i),...o}));pO.displayName="SidebarContent";const mO=V.forwardRef(({className:i,...o},c)=>x.jsx("div",{ref:c,"data-sidebar":"group",className:ui("relative flex w-full min-w-0 flex-col p-2",i),...o}));mO.displayName="SidebarGroup";const gO=V.forwardRef(({className:i,asChild:o=!1,...c},m)=>{const v=o?da:"div";return x.jsx(v,{ref:m,"data-sidebar":"group-label",className:ui("duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",i),...c})});gO.displayName="SidebarGroupLabel";const Zq=V.forwardRef(({className:i,asChild:o=!1,...c},m)=>{const v=o?da:"button";return x.jsx(v,{ref:m,"data-sidebar":"group-action",className:ui("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden",i),...c})});Zq.displayName="SidebarGroupAction";const _O=V.forwardRef(({className:i,...o},c)=>x.jsx("div",{ref:c,"data-sidebar":"group-content",className:ui("w-full text-sm",i),...o}));_O.displayName="SidebarGroupContent";const yO=V.forwardRef(({className:i,...o},c)=>x.jsx("ul",{ref:c,"data-sidebar":"menu",className:ui("flex w-full min-w-0 flex-col gap-1",i),...o}));yO.displayName="SidebarMenu";const xO=V.forwardRef(({className:i,...o},c)=>x.jsx("li",{ref:c,"data-sidebar":"menu-item",className:ui("group/menu-item relative",i),...o}));xO.displayName="SidebarMenuItem";const Xq=Cm("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),vO=V.forwardRef(({asChild:i=!1,isActive:o=!1,variant:c="default",size:m="default",tooltip:v,className:E,...I},s)=>{const O=i?da:"button",{isMobile:j,state:G}=Wy(),W=x.jsx(O,{ref:s,"data-sidebar":"menu-button","data-size":m,"data-active":o,className:ui(Xq({variant:c,size:m}),E),...I});return v?(typeof v=="string"&&(v={children:v}),x.jsxs(q7,{children:[x.jsx(W7,{asChild:!0,children:W}),x.jsx(u3,{side:"right",align:"center",hidden:G!=="collapsed"||j,...v})]})):W});vO.displayName="SidebarMenuButton";const Kq=V.forwardRef(({className:i,asChild:o=!1,showOnHover:c=!1,...m},v)=>{const E=o?da:"button";return x.jsx(E,{ref:v,"data-sidebar":"menu-action",className:ui("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",c&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",i),...m})});Kq.displayName="SidebarMenuAction";const Yq=V.forwardRef(({className:i,...o},c)=>x.jsx("div",{ref:c,"data-sidebar":"menu-badge",className:ui("absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",i),...o}));Yq.displayName="SidebarMenuBadge";const Jq=V.forwardRef(({className:i,showIcon:o=!1,...c},m)=>{const v=V.useMemo(()=>`${Math.floor(Math.random()*40)+50}%`,[]);return x.jsxs("div",{ref:m,"data-sidebar":"menu-skeleton",className:ui("rounded-md h-8 flex gap-2 px-2 items-center",i),...c,children:[o&&x.jsx(Cr,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),x.jsx(Cr,{className:"h-4 flex-1 max-w-[--skeleton-width]","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":v}})]})});Jq.displayName="SidebarMenuSkeleton";const Qq=V.forwardRef(({className:i,...o},c)=>x.jsx("ul",{ref:c,"data-sidebar":"menu-sub",className:ui("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",i),...o}));Qq.displayName="SidebarMenuSub";const eW=V.forwardRef(({...i},o)=>x.jsx("li",{ref:o,...i}));eW.displayName="SidebarMenuSubItem";const tW=V.forwardRef(({asChild:i=!1,size:o="md",isActive:c,className:m,...v},E)=>{const I=i?da:"a";return x.jsx(I,{ref:E,"data-sidebar":"menu-sub-button","data-size":o,"data-active":c,className:ui("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",o==="sm"&&"text-xs",o==="md"&&"text-sm","group-data-[collapsible=icon]:hidden",m),...v})});tW.displayName="SidebarMenuSubButton";const iW=()=>{const{user:i,logout:o}=Ld(),c=Nd(),m=[{title:"Dashboard",url:"/admin",icon:Tz},{title:"Manage Meats",url:"/admin/meats",icon:HG},{title:"Categories",url:"/admin/categories",icon:DT},{title:"Offers & Combos",url:"/admin/offers",icon:T1},{title:"Orders",url:"/admin/orders",icon:ml},{title:"Loyalty Rewards",url:"/admin/loyalty-rewards",icon:T1},{title:"Settings",url:"/admin/settings",icon:i$}],v=I=>I==="/admin"?c.pathname==="/admin":c.pathname.startsWith(I),E=()=>{const{state:I}=Wy(),s=I==="collapsed";return x.jsx(hO,{className:s?"w-14":"w-64",children:x.jsx(pO,{children:x.jsxs(mO,{children:[x.jsx(gO,{children:"Admin Panel"}),x.jsx(_O,{children:x.jsx(yO,{children:m.map(O=>x.jsx(xO,{children:x.jsx(vO,{asChild:!0,children:x.jsxs(Ho,{to:O.url,className:v(O.url)?"bg-primary text-primary-foreground font-medium":"hover:bg-accent",children:[x.jsx(O.icon,{className:"mr-2 h-4 w-4"}),!s&&x.jsx("span",{children:O.title})]})})},O.title))})})]})})})};return x.jsx(dO,{children:x.jsxs("div",{className:"min-h-screen flex w-full bg-background",children:[x.jsx(E,{}),x.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[x.jsx("header",{className:"sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:x.jsxs("div",{className:"flex h-16 items-center justify-between px-6",children:[x.jsxs("div",{className:"flex items-center space-x-4",children:[x.jsx(fO,{}),x.jsxs("div",{children:[x.jsx("h1",{className:"text-xl font-semibold",children:"MeatShop Admin"}),x.jsxs("p",{className:"text-sm text-muted-foreground",children:["Welcome back, ",i==null?void 0:i.name]})]})]}),x.jsx("div",{className:"hidden md:flex flex-1 max-w-md mx-8",children:x.jsxs("div",{className:"relative w-full",children:[x.jsx(Am,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),x.jsx("input",{type:"text",placeholder:"Search orders, products...",className:"w-full pl-10 pr-4 py-2 border border-input rounded-lg bg-background focus:ring-2 focus:ring-ring focus:border-transparent"})]})}),x.jsxs("div",{className:"flex items-center space-x-4",children:[x.jsxs(Si,{variant:"ghost",size:"icon",className:"relative",children:[x.jsx(nC,{className:"h-5 w-5"}),x.jsx(es,{className:"absolute -top-1 -right-1 h-4 w-4 flex items-center justify-center p-0 text-xs",variant:"destructive",children:"3"})]}),x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsxs("div",{className:"hidden sm:block text-right",children:[x.jsx("p",{className:"text-sm font-medium",children:i==null?void 0:i.name}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"Administrator"})]}),x.jsxs(Si,{onClick:o,variant:"ghost",size:"sm",children:[x.jsx(kT,{className:"h-4 w-4"}),x.jsx("span",{className:"hidden sm:inline ml-2",children:"Logout"})]})]})]})]})}),x.jsx("main",{className:"flex-1 overflow-auto bg-background",children:x.jsx("div",{className:"container mx-auto p-6 max-w-7xl",children:x.jsx(ZL,{})})})]})]})})},$i=V.forwardRef(({className:i,...o},c)=>x.jsx("div",{ref:c,className:ui("rounded-lg border bg-card text-card-foreground shadow-sm",i),...o}));$i.displayName="Card";const dr=V.forwardRef(({className:i,...o},c)=>x.jsx("div",{ref:c,className:ui("flex flex-col space-y-1.5 p-6",i),...o}));dr.displayName="CardHeader";const Mr=V.forwardRef(({className:i,...o},c)=>x.jsx("h3",{ref:c,className:ui("text-2xl font-semibold leading-none tracking-tight",i),...o}));Mr.displayName="CardTitle";const Ha=V.forwardRef(({className:i,...o},c)=>x.jsx("p",{ref:c,className:ui("text-sm text-muted-foreground",i),...o}));Ha.displayName="CardDescription";const Hi=V.forwardRef(({className:i,...o},c)=>x.jsx("div",{ref:c,className:ui("p-6 pt-0",i),...o}));Hi.displayName="CardContent";const nW=V.forwardRef(({className:i,...o},c)=>x.jsx("div",{ref:c,className:ui("flex items-center p-6 pt-0",i),...o}));nW.displayName="CardFooter";function rW(i,o=[]){let c=[];function m(E,I){const s=V.createContext(I),O=c.length;c=[...c,I];function j(W){const{scope:B,children:te,...ue}=W,J=(B==null?void 0:B[i][O])||s,ce=V.useMemo(()=>ue,Object.values(ue));return x.jsx(J.Provider,{value:ce,children:te})}function G(W,B){const te=(B==null?void 0:B[i][O])||s,ue=V.useContext(te);if(ue)return ue;if(I!==void 0)return I;throw new Error(`\`${W}\` must be used within \`${E}\``)}return j.displayName=E+"Provider",[j,G]}const v=()=>{const E=c.map(I=>V.createContext(I));return function(s){const O=(s==null?void 0:s[i])||E;return V.useMemo(()=>({[`__scope${i}`]:{...s,[i]:O}}),[s,O])}};return v.scopeName=i,[m,sW(v,...o)]}function sW(...i){const o=i[0];if(i.length===1)return o;const c=()=>{const m=i.map(v=>({useScope:v(),scopeName:v.scopeName}));return function(E){const I=m.reduce((s,{useScope:O,scopeName:j})=>{const W=O(E)[`__scope${j}`];return{...s,...W}},{});return V.useMemo(()=>({[`__scope${o.scopeName}`]:I}),[I])}};return c.scopeName=o.scopeName,c}var oW=V.createContext(void 0);function Iw(i){const o=V.useContext(oW);return i||o||"ltr"}var AS="rovingFocusGroup.onEntryFocus",aW={bubbles:!1,cancelable:!0},Pw="RovingFocusGroup",[$T,wO,lW]=rw(Pw),[cW,Mw]=rW(Pw,[lW]),[uW,dW]=cW(Pw),bO=V.forwardRef((i,o)=>x.jsx($T.Provider,{scope:i.__scopeRovingFocusGroup,children:x.jsx($T.Slot,{scope:i.__scopeRovingFocusGroup,children:x.jsx(hW,{...i,ref:o})})}));bO.displayName=Pw;var hW=V.forwardRef((i,o)=>{const{__scopeRovingFocusGroup:c,orientation:m,loop:v=!1,dir:E,currentTabStopId:I,defaultCurrentTabStopId:s,onCurrentTabStopIdChange:O,onEntryFocus:j,preventScrollOnEntryFocus:G=!1,...W}=i,B=V.useRef(null),te=vr(o,B),ue=Iw(E),[J=null,ce]=Yc({prop:I,defaultProp:s,onChange:O}),[oe,ee]=V.useState(!1),Q=po(j),Ie=wO(c),pe=V.useRef(!1),[Ke,et]=V.useState(0);return V.useEffect(()=>{const at=B.current;if(at)return at.addEventListener(AS,Q),()=>at.removeEventListener(AS,Q)},[Q]),x.jsx(uW,{scope:c,orientation:m,dir:ue,loop:v,currentTabStopId:J,onItemFocus:V.useCallback(at=>ce(at),[ce]),onItemShiftTab:V.useCallback(()=>ee(!0),[]),onFocusableItemAdd:V.useCallback(()=>et(at=>at+1),[]),onFocusableItemRemove:V.useCallback(()=>et(at=>at-1),[]),children:x.jsx(fn.div,{tabIndex:oe||Ke===0?-1:0,"data-orientation":m,...W,ref:te,style:{outline:"none",...i.style},onMouseDown:Ai(i.onMouseDown,()=>{pe.current=!0}),onFocus:Ai(i.onFocus,at=>{const Xt=!pe.current;if(at.target===at.currentTarget&&Xt&&!oe){const Ct=new CustomEvent(AS,aW);if(at.currentTarget.dispatchEvent(Ct),!Ct.defaultPrevented){const mt=Ie().filter(Nt=>Nt.focusable),Dt=mt.find(Nt=>Nt.active),Kt=mt.find(Nt=>Nt.id===J),ti=[Dt,Kt,...mt].filter(Boolean).map(Nt=>Nt.ref.current);EO(ti,G)}}pe.current=!1}),onBlur:Ai(i.onBlur,()=>ee(!1))})})}),SO="RovingFocusGroupItem",TO=V.forwardRef((i,o)=>{const{__scopeRovingFocusGroup:c,focusable:m=!0,active:v=!1,tabStopId:E,...I}=i,s=vl(),O=E||s,j=dW(SO,c),G=j.currentTabStopId===O,W=wO(c),{onFocusableItemAdd:B,onFocusableItemRemove:te}=j;return V.useEffect(()=>{if(m)return B(),()=>te()},[m,B,te]),x.jsx($T.ItemSlot,{scope:c,id:O,focusable:m,active:v,children:x.jsx(fn.span,{tabIndex:G?0:-1,"data-orientation":j.orientation,...I,ref:o,onMouseDown:Ai(i.onMouseDown,ue=>{m?j.onItemFocus(O):ue.preventDefault()}),onFocus:Ai(i.onFocus,()=>j.onItemFocus(O)),onKeyDown:Ai(i.onKeyDown,ue=>{if(ue.key==="Tab"&&ue.shiftKey){j.onItemShiftTab();return}if(ue.target!==ue.currentTarget)return;const J=mW(ue,j.orientation,j.dir);if(J!==void 0){if(ue.metaKey||ue.ctrlKey||ue.altKey||ue.shiftKey)return;ue.preventDefault();let oe=W().filter(ee=>ee.focusable).map(ee=>ee.ref.current);if(J==="last")oe.reverse();else if(J==="prev"||J==="next"){J==="prev"&&oe.reverse();const ee=oe.indexOf(ue.currentTarget);oe=j.loop?gW(oe,ee+1):oe.slice(ee+1)}setTimeout(()=>EO(oe))}})})})});TO.displayName=SO;var fW={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function pW(i,o){return o!=="rtl"?i:i==="ArrowLeft"?"ArrowRight":i==="ArrowRight"?"ArrowLeft":i}function mW(i,o,c){const m=pW(i.key,c);if(!(o==="vertical"&&["ArrowLeft","ArrowRight"].includes(m))&&!(o==="horizontal"&&["ArrowUp","ArrowDown"].includes(m)))return fW[m]}function EO(i,o=!1){const c=document.activeElement;for(const m of i)if(m===c||(m.focus({preventScroll:o}),document.activeElement!==c))return}function gW(i,o){return i.map((c,m)=>i[(o+m)%i.length])}var CO=bO,AO=TO,RC="Tabs",[_W,vK]=iu(RC,[Mw]),IO=Mw(),[yW,DC]=_W(RC),PO=V.forwardRef((i,o)=>{const{__scopeTabs:c,value:m,onValueChange:v,defaultValue:E,orientation:I="horizontal",dir:s,activationMode:O="automatic",...j}=i,G=Iw(s),[W,B]=Yc({prop:m,onChange:v,defaultProp:E});return x.jsx(yW,{scope:c,baseId:vl(),value:W,onValueChange:B,orientation:I,dir:G,activationMode:O,children:x.jsx(fn.div,{dir:G,"data-orientation":I,...j,ref:o})})});PO.displayName=RC;var MO="TabsList",RO=V.forwardRef((i,o)=>{const{__scopeTabs:c,loop:m=!0,...v}=i,E=DC(MO,c),I=IO(c);return x.jsx(CO,{asChild:!0,...I,orientation:E.orientation,dir:E.dir,loop:m,children:x.jsx(fn.div,{role:"tablist","aria-orientation":E.orientation,...v,ref:o})})});RO.displayName=MO;var DO="TabsTrigger",kO=V.forwardRef((i,o)=>{const{__scopeTabs:c,value:m,disabled:v=!1,...E}=i,I=DC(DO,c),s=IO(c),O=zO(I.baseId,m),j=OO(I.baseId,m),G=m===I.value;return x.jsx(AO,{asChild:!0,...s,focusable:!v,active:G,children:x.jsx(fn.button,{type:"button",role:"tab","aria-selected":G,"aria-controls":j,"data-state":G?"active":"inactive","data-disabled":v?"":void 0,disabled:v,id:O,...E,ref:o,onMouseDown:Ai(i.onMouseDown,W=>{!v&&W.button===0&&W.ctrlKey===!1?I.onValueChange(m):W.preventDefault()}),onKeyDown:Ai(i.onKeyDown,W=>{[" ","Enter"].includes(W.key)&&I.onValueChange(m)}),onFocus:Ai(i.onFocus,()=>{const W=I.activationMode!=="manual";!G&&!v&&W&&I.onValueChange(m)})})})});kO.displayName=DO;var NO="TabsContent",LO=V.forwardRef((i,o)=>{const{__scopeTabs:c,value:m,forceMount:v,children:E,...I}=i,s=DC(NO,c),O=zO(s.baseId,m),j=OO(s.baseId,m),G=m===s.value,W=V.useRef(G);return V.useEffect(()=>{const B=requestAnimationFrame(()=>W.current=!1);return()=>cancelAnimationFrame(B)},[]),x.jsx(El,{present:v||G,children:({present:B})=>x.jsx(fn.div,{"data-state":G?"active":"inactive","data-orientation":s.orientation,role:"tabpanel","aria-labelledby":O,hidden:!B,id:j,tabIndex:0,...I,ref:o,style:{...i.style,animationDuration:W.current?"0s":void 0},children:B&&E})})});LO.displayName=NO;function zO(i,o){return`${i}-trigger-${o}`}function OO(i,o){return`${i}-content-${o}`}var xW=PO,FO=RO,jO=kO,BO=LO;const YD=xW,HT=V.forwardRef(({className:i,...o},c)=>x.jsx(FO,{ref:c,className:ui("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",i),...o}));HT.displayName=FO.displayName;const X_=V.forwardRef(({className:i,...o},c)=>x.jsx(jO,{ref:c,className:ui("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",i),...o}));X_.displayName=jO.displayName;const qT=V.forwardRef(({className:i,...o},c)=>x.jsx(BO,{ref:c,className:ui("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",i),...o}));qT.displayName=BO.displayName;const IS=[{id:1,name:"Chicken",count:12},{id:2,name:"Mutton",count:8},{id:3,name:"Fish",count:15},{id:4,name:"Beef",count:6},{id:5,name:"Pork",count:4}],PS=[{id:5,name:"Chicken Drumsticks",description:"Juicy chicken drumsticks, perfect for grilling",price:260,originalPrice:300,discount:13,rating:4.7,reviews:110,category:"Chicken"},{id:6,name:"Chicken Thighs",description:"Tender chicken thighs for curries and roasts",price:270,originalPrice:310,discount:12,rating:4.6,reviews:90,category:"Chicken"},{id:7,name:"Mutton Chops",description:"Succulent mutton chops for grilling",price:600,originalPrice:700,discount:14,rating:4.8,reviews:80,category:"Mutton"},{id:8,name:"Mutton Mince",description:"Fresh mutton mince for kebabs and curries",price:590,originalPrice:670,discount:12,rating:4.7,reviews:70,category:"Mutton"},{id:9,name:"Fish Steaks",description:"Firm fish steaks, ideal for frying",price:360,originalPrice:410,discount:12,rating:4.6,reviews:60,category:"Fish"},{id:10,name:"Fish Curry Cut",description:"Fish pieces ready for curry",price:340,originalPrice:390,discount:13,rating:4.5,reviews:55,category:"Fish"},{id:11,name:"Beef Mince",description:"Lean beef mince for burgers and kebabs",price:630,originalPrice:720,discount:13,rating:4.7,reviews:50,category:"Beef"},{id:12,name:"Beef Ribs",description:"Juicy beef ribs for slow cooking",price:670,originalPrice:760,discount:12,rating:4.6,reviews:45,category:"Beef"},{id:13,name:"Pork Chops",description:"Tender pork chops for grilling",price:400,originalPrice:450,discount:11,rating:4.5,reviews:40,category:"Pork"},{id:14,name:"Pork Belly",description:"Rich pork belly for roasting",price:420,originalPrice:470,discount:11,rating:4.4,reviews:35,category:"Pork"},{id:1,name:"Premium Chicken Breast",description:"Boneless, skinless chicken breast pieces",price:280,originalPrice:320,discount:13,rating:4.8,reviews:156,category:"Chicken"},{id:2,name:"Mutton Curry Cut",description:"Fresh mutton pieces with bone",price:580,originalPrice:650,discount:11,rating:4.9,reviews:124,category:"Mutton"},{id:3,name:"Fresh River Fish",description:"Cleaned and ready to cook river fish",price:350,originalPrice:400,discount:13,rating:4.7,reviews:98,category:"Fish"},{id:4,name:"Premium Beef Cut",description:"Tender beef cuts for steak and roast",price:650,originalPrice:750,discount:13,rating:4.8,reviews:86,category:"Beef"}],vW=[{id:1,name:"Central Market Branch",address:"123 Market Street, Central Area",hours:"9:00 AM - 9:00 PM",mapsLink:"https://maps.google.com"},{id:2,name:"North City Branch",address:"456 North Avenue, Business District",hours:"8:30 AM - 9:30 PM",mapsLink:"https://maps.google.com"},{id:3,name:"East Side Branch",address:"789 East Road, Shopping Complex",hours:"9:00 AM - 8:00 PM",mapsLink:"https://maps.google.com"}],wW=()=>{const{addToCart:i}=vw(),{isAuthenticated:o,user:c}=Ld(),{toast:m}=ha(),[v,E]=V.useState(""),[I,s]=V.useState(null),[O,j]=V.useState({}),G=B=>{if(!o){m({title:"Login Required",description:"Please login or register to add items to cart",position:"top-center"});return}const te=O[B]||.5,ue=PS.find(J=>J.id===B);ue&&(i({id:ue.id.toString(),name:ue.name,price:ue.price,minWeight:.5,weight:te,image:""}),m({title:"Added to Cart",description:`${te}kg of ${ue.name} added to your cart.`,position:"top-center"}))};let W=PS.filter(B=>{var J;const te=B.name.toLowerCase().includes(v.toLowerCase())||B.description.toLowerCase().includes(v.toLowerCase())||B.category.toLowerCase().includes(v.toLowerCase()),ue=I===null||((J=IS.find(ce=>ce.id===I))==null?void 0:J.name)===B.category;return te&&ue});if(I===null){const B={};IS.forEach(te=>{B[te.name]=PS.filter(ue=>ue.category===te.name).slice(0,3)}),W=Object.values(B).flat()}return x.jsx(x.Fragment,{children:x.jsxs("div",{className:"min-h-screen",style:{margin:0,padding:0,width:"100%",boxSizing:"border-box",overflowX:"hidden"},children:[x.jsxs("section",{className:"relative h-[350px]",children:[x.jsx("img",{src:"https://images.unsplash.com/photo-1607623814075-e51df1bdc82f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",alt:"Fresh Meat Hero",className:"absolute inset-0 w-full h-full object-cover z-0"}),x.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black/70 to-black/40 flex items-center z-10",children:x.jsx("div",{className:"container px-4 md:px-6",children:x.jsxs("div",{className:"max-w-2xl space-y-6",children:[x.jsx(es,{className:"mb-4 bg-red-600 hover:bg-red-700",children:"Premium Quality"}),x.jsx("h1",{className:"text-4xl md:text-6xl font-bold text-white tracking-tight",children:"Fresh & Premium Quality Meat"}),x.jsx("p",{className:"text-lg text-gray-200",children:"Experience the finest cuts of meat, sourced from trusted farms and delivered fresh to your doorstep."})]})})})]}),x.jsx("section",{className:"py-12 bg-white",children:x.jsx("div",{className:"container px-4 md:px-6 mx-auto",children:x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[x.jsx($i,{children:x.jsxs(Hi,{className:"p-6 flex items-center gap-4",children:[x.jsx("div",{className:"h-12 w-12 rounded-full bg-green-100 flex items-center justify-center",children:x.jsx(qc,{className:"h-6 w-6 text-green-600"})}),x.jsxs("div",{children:[x.jsx("h3",{className:"font-bold",children:"Free Same Day Delivery"}),x.jsx("p",{className:"text-sm text-muted-foreground",children:"On orders above ₹500"})]})]})}),x.jsx($i,{children:x.jsxs(Hi,{className:"p-6 flex items-center gap-4",children:[x.jsx("div",{className:"h-12 w-12 rounded-full bg-blue-100 flex items-center justify-center",children:x.jsx(sd,{className:"h-6 w-6 text-blue-600"})}),x.jsxs("div",{children:[x.jsx("h3",{className:"font-bold",children:"Premium Quality Meat"}),x.jsx("p",{className:"text-sm text-muted-foreground",children:"Fresh from trusted farms"})]})]})}),x.jsx($i,{children:x.jsxs(Hi,{className:"p-6 flex items-center gap-4",children:[x.jsx("div",{className:"h-12 w-12 rounded-full bg-red-100 flex items-center justify-center",children:x.jsx(o$,{className:"h-6 w-6 text-red-600"})}),x.jsxs("div",{children:[x.jsx("h3",{className:"font-bold",children:"100% Satisfaction"}),x.jsx("p",{className:"text-sm text-muted-foreground",children:"Quality guaranteed"})]})]})})]})})}),x.jsx("section",{id:"special-offers",className:"py-12 bg-white",children:x.jsxs("div",{className:"container px-4 md:px-6 mx-auto",children:[x.jsx("h2",{className:"text-3xl font-bold tracking-tight mb-8",children:"Special Offers"}),x.jsx("div",{className:"text-gray-700 mb-6",children:"Check out our latest deals and discounts on select products!"}),x.jsxs(YD,{defaultValue:"coupons",className:"w-full",children:[x.jsxs(HT,{className:"flex w-full mb-8 bg-gray-100 rounded-lg p-1",children:[x.jsx(X_,{value:"coupons",className:"flex-1 text-lg py-3 transition rounded-lg data-[state=active]:bg-red-600 data-[state=active]:text-white data-[state=inactive]:bg-gray-100 data-[state=inactive]:text-red-700",children:"Coupon Codes"}),x.jsx(X_,{value:"combos",className:"flex-1 text-lg py-3 transition rounded-lg data-[state=active]:bg-red-600 data-[state=active]:text-white data-[state=inactive]:bg-gray-100 data-[state=inactive]:text-red-700",children:"Combo Offers"})]}),x.jsx(qT,{value:"coupons",children:x.jsxs("div",{className:"flex flex-wrap gap-6 justify-start",children:[x.jsx($i,{className:"flex-1 min-w-[260px] max-w-xs bg-white border border-gray-200 overflow-hidden shadow-lg flex flex-col min-h-[410px]",children:x.jsxs(Hi,{className:"p-0 flex flex-col h-full",children:[x.jsx("img",{src:"https://images.unsplash.com/photo-1519864600265-abb23847ef2c?auto=format&fit=crop&w=400&q=80",alt:"Special Offer - Chicken Coupon",className:"w-full h-40 object-cover"}),x.jsxs("div",{className:"flex flex-col flex-1 p-4 justify-between",children:[x.jsxs("div",{children:[x.jsx("h3",{className:"font-bold text-xl mb-2 text-red-700 min-h-[56px] flex items-center",children:"Flat 10% Off on All Chicken Products"}),x.jsxs("p",{className:"text-gray-600 mb-2 min-h-[40px] flex items-center",children:["Use code ",x.jsx("span",{className:"font-mono bg-gray-100 px-2 py-1 rounded",children:"CHICKEN10"})," at checkout."]})]}),x.jsx(Si,{className:"bg-red-600 hover:bg-red-700 text-white mt-2 w-full",style:{marginTop:"auto"},onClick:()=>{var B;navigator.clipboard.writeText("CHICKEN10"),(B=document.getElementById("meats-section"))==null||B.scrollIntoView({behavior:"smooth"})},children:"Use Now"})]})]})}),x.jsx($i,{className:"flex-1 min-w-[260px] max-w-xs bg-white border border-gray-200 overflow-hidden shadow-lg flex flex-col min-h-[410px]",children:x.jsxs(Hi,{className:"p-0 flex flex-col h-full",children:[x.jsx("img",{src:"https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=400&q=80",alt:"Special Offer - Mutton Coupon",className:"w-full h-40 object-cover"}),x.jsxs("div",{className:"flex flex-col flex-1 p-4 justify-between",children:[x.jsxs("div",{children:[x.jsx("h3",{className:"font-bold text-xl mb-2 text-red-700 min-h-[56px] flex items-center",children:"15% Off on Mutton for New Users"}),x.jsx("p",{className:"text-gray-600 mb-2 min-h-[40px] flex items-center",children:"Sign up and get instant discount on your first mutton order."})]}),x.jsx(Si,{className:"bg-red-600 hover:bg-red-700 text-white mt-2 w-full",style:{marginTop:"auto"},onClick:()=>{var B;navigator.clipboard.writeText("MUTTON15"),(B=document.getElementById("meats-section"))==null||B.scrollIntoView({behavior:"smooth"})},children:"Use Now"})]})]})})]})}),x.jsx(qT,{value:"combos",children:x.jsxs("div",{className:"flex flex-wrap gap-6 justify-start",children:[x.jsx($i,{className:"flex-1 min-w-[260px] max-w-xs bg-white border border-gray-200 overflow-hidden shadow-lg flex flex-col min-h-[410px]",children:x.jsxs(Hi,{className:"p-0 flex flex-col h-full",children:[x.jsx("img",{src:"https://images.unsplash.com/photo-1519864342061-cd7d1e8e39c4?auto=format&fit=crop&w=400&q=80",alt:"Special Offer - Chicken Mutton Combo",className:"w-full h-40 object-cover"}),x.jsxs("div",{className:"flex flex-col flex-1 p-4 justify-between",children:[x.jsxs("div",{children:[x.jsx("h3",{className:"font-bold text-xl mb-2 text-red-700 min-h-[56px] flex items-center",children:"Chicken + Mutton Combo"}),x.jsx("p",{className:"text-gray-600 mb-2 min-h-[40px] flex items-center",children:"Buy 1kg Chicken and get 500g Mutton at 50% off. Limited time combo!"})]}),x.jsx(Si,{className:"bg-red-600 hover:bg-red-700 text-white mt-2 w-full",style:{marginTop:"auto"},onClick:()=>{if(!o){m({title:"Login Required",description:"Please login or register to add items to cart",position:"top-center"});return}i({id:"combo-chicken-mutton",name:"Chicken + Mutton Combo",price:280+580*.5,minWeight:1.5,weight:1.5,image:""}),m({title:"Combo Added to Cart",description:"Chicken + Mutton Combo added to your cart!",position:"top-center"})},children:"Add to Cart"})]})]})}),x.jsx($i,{className:"flex-1 min-w-[260px] max-w-xs bg-white border border-gray-200 overflow-hidden shadow-lg flex flex-col min-h-[410px]",children:x.jsxs(Hi,{className:"p-0 flex flex-col h-full",children:[x.jsx("img",{src:"https://images.unsplash.com/photo-1502741338009-cac2772e18bc?auto=format&fit=crop&w=400&q=80",alt:"Special Offer - Fish Beef Combo",className:"w-full h-40 object-cover"}),x.jsxs("div",{className:"flex flex-col flex-1 p-4 justify-between",children:[x.jsxs("div",{children:[x.jsx("h3",{className:"font-bold text-xl mb-2 text-red-700 min-h-[56px] flex items-center",children:"Fish + Beef Combo"}),x.jsx("p",{className:"text-gray-600 mb-2 min-h-[40px] flex items-center",children:"Get 10% off when you buy both Fish and Beef together. Perfect for family feasts!"})]}),x.jsx(Si,{className:"bg-red-600 hover:bg-red-700 text-white mt-2 w-full",style:{marginTop:"auto"},onClick:()=>{if(!o){m({title:"Login Required",description:"Please login or register to add items to cart",position:"top-center"});return}i({id:"combo-fish-beef",name:"Fish + Beef Combo",price:1e3,minWeight:2,weight:2,image:""}),m({title:"Combo Added to Cart",description:"Fish + Beef Combo added to your cart!",position:"top-center"})},children:"Add to Cart"})]})]})})]})})]})]})}),x.jsx("section",{id:"meats-section",className:"py-12",children:x.jsxs("div",{className:"container px-4 md:px-6 mx-auto",children:[x.jsx("h2",{className:"text-3xl font-bold tracking-tight mb-6",children:"Meats"}),x.jsxs("div",{className:"flex flex-row gap-4 mb-8",children:[x.jsxs("div",{className:"w-1/2 relative",children:[x.jsx(Am,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),x.jsx(tn,{placeholder:"Search meats...",value:v,onChange:B=>E(B.target.value),className:"pl-10"})]}),x.jsx("div",{className:"w-1/2",children:x.jsx(YD,{defaultValue:"all",children:x.jsxs(HT,{className:"w-full overflow-x-auto flex-nowrap justify-start",children:[x.jsx(X_,{value:"all",onClick:()=>s(null),className:"px-6",children:"All"}),IS.map(B=>x.jsx(X_,{value:B.name.toLowerCase(),onClick:()=>s(B.id),className:"px-6",children:B.name},B.id))]})})})]}),x.jsx("div",{className:"flex flex-wrap gap-6",children:W.length>0?W.map(B=>x.jsxs($i,{className:"overflow-hidden group flex-1 min-w-[260px] max-w-xs flex flex-col min-h-[410px]",children:[x.jsx("div",{className:"relative",children:B.discount>0&&x.jsxs(es,{className:"absolute top-2 right-2 bg-red-500",children:[B.discount,"% OFF"]})}),x.jsxs(Hi,{className:"p-4 flex flex-col flex-1 justify-between h-full",children:[x.jsxs("div",{children:[x.jsx(es,{variant:"secondary",className:"mb-2",children:B.category}),x.jsx("h3",{className:"font-semibold text-lg min-h-[32px] flex items-center",children:B.name}),x.jsx("p",{className:"text-sm text-muted-foreground mb-2 min-h-[36px] flex items-center",children:B.description}),x.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[x.jsxs("div",{className:"flex items-center text-yellow-500",children:[x.jsx(sC,{className:"fill-current h-4 w-4"}),x.jsx("span",{className:"ml-1 text-sm font-medium",children:B.rating})]}),x.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",B.reviews," reviews)"]})]})]}),x.jsxs("div",{className:"space-y-4 mt-auto",children:[x.jsx("div",{className:"flex justify-between items-center",children:x.jsxs("div",{className:"space-y-1",children:[x.jsxs("div",{className:"flex items-center gap-1",children:[x.jsxs("span",{className:"text-lg font-bold",children:["₹",B.price]}),B.discount>0&&x.jsxs("span",{className:"text-sm text-muted-foreground line-through",children:["₹",B.originalPrice]})]}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"per kg"})]})}),x.jsxs("div",{className:"flex justify-between items-center border rounded-md p-2",children:[x.jsx("span",{className:"text-sm font-medium",children:"Weight:"}),x.jsxs("div",{className:"flex items-center",children:[x.jsx(Si,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-full",onClick:()=>{const te=O[B.id]||.5;te>.5&&j({...O,[B.id]:parseFloat((te-.5).toFixed(1))})},children:"-"}),x.jsxs("span",{className:"w-14 text-center",children:[O[B.id]||.5," kg"]}),x.jsx(Si,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-full",onClick:()=>{const te=O[B.id]||.5;j({...O,[B.id]:parseFloat((te+.5).toFixed(1))})},children:"+"})]})]}),x.jsxs(Si,{className:"w-full bg-red-600 hover:bg-red-700",onClick:()=>G(B.id),children:[x.jsx(rC,{className:"h-4 w-4 mr-2"}),"Add to Cart"]})]})]})]},B.id)):x.jsxs("div",{className:"w-full text-center py-12",children:[x.jsx("h3",{className:"text-lg font-medium",children:"No meats found"}),x.jsx("p",{className:"text-muted-foreground",children:"Try changing your search or filter criteria"})]})})]})}),x.jsx("section",{className:"py-12 bg-gray-50",children:x.jsxs("div",{className:"container px-4 md:px-6 mx-auto",children:[x.jsx("h2",{className:"text-3xl font-bold tracking-tight mb-8",children:"Our Branches"}),x.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:vW.map(B=>x.jsx($i,{children:x.jsxs(Hi,{className:"p-6 space-y-4",children:[x.jsx("h3",{className:"font-bold text-xl",children:B.name}),x.jsxs("div",{className:"space-y-3 text-sm",children:[x.jsx("div",{className:"flex items-start gap-2",children:x.jsx("span",{children:B.address})}),x.jsx("div",{className:"flex items-center gap-2"}),x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx(Sd,{className:"h-4 w-4 text-muted-foreground"}),x.jsx("span",{children:B.hours})]})]}),x.jsx(Si,{variant:"outline",className:"w-full",asChild:!0,children:x.jsxs("a",{href:B.mapsLink,target:"_blank",rel:"noopener noreferrer",children:["View on Maps",x.jsx($G,{className:"ml-2 h-4 w-4"})]})})]})},B.id))})]})}),x.jsx("footer",{className:"bg-gray-900 text-white pt-12 pb-6",children:x.jsxs("div",{className:"container px-4 md:px-6 mx-auto",children:[x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8 mb-8",children:[x.jsxs("div",{children:[x.jsx("h3",{className:"text-xl font-bold mb-4",children:"Butcher Blend"}),x.jsx("p",{className:"text-gray-400",children:"Premium quality meat delivered fresh to your doorstep. Our products are sourced from trusted farms and suppliers."})]}),x.jsxs("div",{children:[x.jsx("h4",{className:"font-semibold mb-4",children:"Contact Us"}),x.jsxs("ul",{className:"space-y-2 text-gray-400",children:[x.jsx("li",{className:"flex items-center gap-2"}),x.jsx("li",{className:"flex items-center gap-2"}),x.jsxs("li",{className:"flex items-center gap-2",children:[x.jsx(QG,{className:"h-4 w-4"}),x.jsx("span",{children:"info@butcherblend.com"})]})]})]})]}),x.jsx("div",{className:"border-t border-gray-800 pt-6 mt-6",children:x.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4",children:[x.jsxs("p",{className:"text-gray-400 text-sm",children:["© ",new Date().getFullYear()," Butcher Blend. All rights reserved."]}),x.jsxs("div",{className:"flex gap-4 text-sm text-gray-400",children:[x.jsx(Ho,{to:"/privacy",className:"hover:text-white",children:"Privacy Policy"}),x.jsx(Ho,{to:"/terms",className:"hover:text-white",children:"Terms of Service"})]})]})})]})})]})})};var bW="Label",VO=V.forwardRef((i,o)=>x.jsx(fn.label,{...i,ref:o,onMouseDown:c=>{var v;c.target.closest("button, input, select, textarea")||((v=i.onMouseDown)==null||v.call(i,c),!c.defaultPrevented&&c.detail>1&&c.preventDefault())}}));VO.displayName=bW;var UO=VO;const SW=Cm("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),En=V.forwardRef(({className:i,...o},c)=>x.jsx(UO,{ref:c,className:ui(SW(),i),...o}));En.displayName=UO.displayName;const TW={id:"1",name:"Premium Chicken Breast",description:"Fresh, boneless chicken breast perfect for grilling, roasting, or pan-frying. Our chickens are farm-raised without antibiotics and hormones. Rich in protein and ideal for healthy meals.",pricePerKg:280,minKg:.5,image:"https://images.unsplash.com/photo-1604503468506-a8da13d82791?w=600",categoryId:"1",inStock:!0,createdAt:"2024-01-01",updatedAt:"2024-01-01"},EW=()=>{const{id:i}=x8(),[o,c]=V.useState(!0),[m,v]=V.useState(null),[E,I]=V.useState(.5),[s,O]=V.useState(!1),{addToCart:j}=vw(),{isAuthenticated:G}=Ld(),{toast:W}=ha();iw(),V.useEffect(()=>{(async()=>{c(!0),await new Promise(ce=>setTimeout(ce,800)),v(TW),c(!1)})()},[i]);const B=J=>{m&&J>=m.minKg&&J<=10&&I(J)},te=async()=>{if(m){if(!G){W({title:"Login Required",description:"Please login or register to add items to cart",position:"top-center"});return}O(!0);try{j({id:m.id,name:m.name,price:m.pricePerKg,minWeight:m.minKg,weight:E,image:m.image}),W({title:"Added to Cart",description:`${E}kg of ${m.name} added to your cart`,position:"top-center"})}catch{W({title:"Error",description:"Failed to add item to cart",variant:"destructive",position:"top-center"})}O(!1)}};if(o||!m)return x.jsxs("div",{className:"container mx-auto px-4 py-8",children:[x.jsx(Cr,{className:"h-8 w-32 mb-6"}),x.jsxs("div",{className:"grid lg:grid-cols-2 gap-8",children:[x.jsx(Cr,{className:"aspect-square rounded-lg"}),x.jsxs("div",{className:"space-y-6",children:[x.jsx(Cr,{className:"h-8 w-3/4"}),x.jsx(Cr,{className:"h-20 w-full"}),x.jsx(Cr,{className:"h-12 w-32"}),x.jsx(Cr,{className:"h-40 w-full"})]})]})]});const ue=m.pricePerKg*E;return x.jsxs("div",{className:"container mx-auto px-4 py-8 pb-20 md:pb-8",children:[x.jsxs(Ho,{to:"/",className:"inline-flex items-center gap-2 text-muted-foreground hover:text-foreground mb-6",children:[x.jsx(RT,{className:"h-4 w-4"}),"Back to Products"]}),x.jsxs("div",{className:"grid lg:grid-cols-2 gap-8",children:[x.jsxs("div",{className:"space-y-4",children:[x.jsx("div",{className:"aspect-square overflow-hidden rounded-lg bg-gray-100",children:x.jsx("img",{src:m.image,alt:m.name,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-300"})}),x.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[x.jsxs("div",{className:"p-3 border rounded-lg",children:[x.jsx(qc,{className:"h-6 w-6 mx-auto mb-2 text-primary"}),x.jsx("div",{className:"text-sm font-medium",children:"Free Delivery"}),x.jsx("div",{className:"text-xs text-muted-foreground",children:"Above ₹500"})]}),x.jsxs("div",{className:"p-3 border rounded-lg",children:[x.jsx(r$,{className:"h-6 w-6 mx-auto mb-2 text-primary"}),x.jsx("div",{className:"text-sm font-medium",children:"Fresh Quality"}),x.jsx("div",{className:"text-xs text-muted-foreground",children:"100% Fresh"})]}),x.jsxs("div",{className:"p-3 border rounded-lg",children:[x.jsx(Sd,{className:"h-6 w-6 mx-auto mb-2 text-primary"}),x.jsx("div",{className:"text-sm font-medium",children:"Same Day"}),x.jsx("div",{className:"text-xs text-muted-foreground",children:"Delivery"})]})]})]}),x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"space-y-2",children:[x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsxs(es,{className:"bg-success",children:[x.jsx(sC,{className:"h-3 w-3 mr-1"}),"Fresh"]}),m.inStock?x.jsx(es,{variant:"outline",className:"text-success border-success",children:"In Stock"}):x.jsx(es,{variant:"destructive",children:"Out of Stock"})]}),x.jsx("h1",{className:"text-3xl font-bold",children:m.name}),x.jsxs("div",{className:"flex items-baseline gap-2",children:[x.jsxs("span",{className:"text-3xl font-bold text-primary",children:["₹",m.pricePerKg]}),x.jsx("span",{className:"text-muted-foreground",children:"per kg"})]}),x.jsx("p",{className:"text-muted-foreground text-lg leading-relaxed",children:m.description})]}),x.jsx($i,{children:x.jsx(Hi,{className:"p-6",children:x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"space-y-2",children:[x.jsx(En,{htmlFor:"weight",className:"text-base font-semibold",children:"Select Weight (kg)"}),x.jsxs("p",{className:"text-sm text-muted-foreground",children:["Minimum: ",m.minKg,"kg • Maximum: 10kg"]})]}),x.jsxs("div",{className:"flex items-center space-x-4",children:[x.jsx(Si,{variant:"outline",size:"icon",onClick:()=>B(E-.1),disabled:E<=m.minKg,children:x.jsx(Ez,{className:"h-4 w-4"})}),x.jsxs("div",{className:"flex-1 space-y-2",children:[x.jsx(tn,{id:"weight",type:"number",value:E,onChange:J=>B(parseFloat(J.target.value)||0),min:m.minKg,max:10,step:.1,className:"text-center text-lg font-semibold"}),x.jsx("div",{className:"flex justify-center space-x-2",children:[.5,1,1.5,2].map(J=>x.jsxs(Si,{variant:E===J?"default":"outline",size:"sm",onClick:()=>B(J),disabled:J<m.minKg,children:[J,"kg"]},J))})]}),x.jsx(Si,{variant:"outline",size:"icon",onClick:()=>B(E+.1),disabled:E>=10,children:x.jsx(bl,{className:"h-4 w-4"})})]}),x.jsxs("div",{className:"bg-accent/50 p-4 rounded-lg",children:[x.jsxs("div",{className:"flex justify-between items-center",children:[x.jsx("span",{className:"font-medium",children:"Total Amount:"}),x.jsxs("span",{className:"text-2xl font-bold text-primary",children:["₹",ue.toFixed(2)]})]}),x.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[E,"kg × ₹",m.pricePerKg,"/kg"]})]}),x.jsxs(Si,{onClick:te,disabled:s||!m.inStock||E<m.minKg,className:"w-full",size:"lg",variant:"meat",children:[x.jsx(rC,{className:"h-5 w-5 mr-2"}),s?"Adding...":`Add to Cart - ₹${ue.toFixed(2)}`]})]})})}),x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"border-t pt-4",children:[x.jsx("h3",{className:"font-semibold mb-2",children:"Nutritional Benefits"}),x.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[x.jsx("li",{children:"• High in protein (25g per 100g)"}),x.jsx("li",{children:"• Low in fat and calories"}),x.jsx("li",{children:"• Rich in vitamins B6 and B12"}),x.jsx("li",{children:"• Contains essential amino acids"})]})]}),x.jsxs("div",{className:"border-t pt-4",children:[x.jsx("h3",{className:"font-semibold mb-2",children:"Storage Instructions"}),x.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[x.jsx("li",{children:"• Store in refrigerator (0-4°C)"}),x.jsx("li",{children:"• Use within 2-3 days of purchase"}),x.jsx("li",{children:"• Can be frozen for up to 6 months"}),x.jsx("li",{children:"• Thaw in refrigerator before cooking"})]})]})]})]})]})]})},CW=()=>{const{items:i,updateQuantity:o,removeFromCart:c,clearCart:m,totalAmount:v}=vw(),{toast:E}=ha();V.useState("1"),V.useState("cod");const[I,s]=V.useState(""),[O,j]=V.useState(!1),G=v>500?0:40,W=I==="SAVE10"?v*.1:0,B=v+G-W,te=(ce,oe,ee)=>{oe>=ee&&oe<=10&&o(ce,oe)},ue=(ce,oe)=>{c(ce),E({title:"Item Removed",description:`${oe} has been removed from your cart`})},J=async()=>{j(!0),await new Promise(ce=>setTimeout(ce,2e3)),E({title:"Order Placed!",description:"Your order has been placed successfully"}),m(),j(!1)};return i.length===0?x.jsxs("div",{className:"container mx-auto px-4 py-8",children:[x.jsxs(Ho,{to:"/",className:"inline-flex items-center gap-2 text-muted-foreground hover:text-foreground mb-6",children:[x.jsx(RT,{className:"h-4 w-4"}),"Continue Shopping"]}),x.jsxs("div",{className:"text-center py-12",children:[x.jsx(s$,{className:"h-24 w-24 mx-auto text-muted-foreground mb-4"}),x.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Your cart is empty"}),x.jsx("p",{className:"text-muted-foreground mb-6",children:"Looks like you haven't added any items to your cart yet."}),x.jsx(Ho,{to:"/",children:x.jsx(Si,{variant:"meat",size:"lg",children:"Start Shopping"})})]})]}):x.jsxs("div",{className:"container mx-auto px-4 py-8 pb-20 md:pb-8",children:[x.jsxs(Ho,{to:"/",className:"inline-flex items-center gap-2 text-muted-foreground hover:text-foreground mb-6",children:[x.jsx(RT,{className:"h-4 w-4"}),"Continue Shopping"]}),x.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[x.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsx("h1",{className:"text-3xl font-bold",children:"Shopping Cart"}),x.jsx(Si,{variant:"ghost",onClick:()=>m(),className:"text-destructive hover:text-destructive",children:"Clear Cart"})]}),x.jsx("div",{className:"space-y-4",children:i.map(ce=>x.jsx($i,{children:x.jsx(Hi,{className:"p-6",children:x.jsxs("div",{className:"flex gap-4",children:[x.jsx("div",{className:"w-20 h-20 rounded-lg overflow-hidden bg-gray-100 flex-shrink-0",children:x.jsx("img",{src:ce.image,alt:ce.name,className:"w-full h-full object-cover"})}),x.jsxs("div",{className:"flex-1 space-y-2",children:[x.jsxs("div",{className:"flex justify-between items-start",children:[x.jsxs("div",{children:[x.jsx("h3",{className:"font-semibold",children:ce.name}),x.jsxs("p",{className:"text-sm text-muted-foreground",children:["₹",ce.price,"/kg • Min: ",ce.minWeight,"kg"]})]}),x.jsx(Si,{variant:"ghost",size:"icon",onClick:()=>ue(ce.id,ce.name),className:"text-destructive hover:text-destructive",children:x.jsx(Hy,{className:"h-4 w-4"})})]}),x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsx(Si,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>te(ce.id,ce.weight-.1,ce.minWeight),disabled:ce.weight<=ce.minWeight,children:x.jsx(Ez,{className:"h-3 w-3"})}),x.jsx(tn,{type:"number",value:ce.weight,onChange:oe=>te(ce.id,parseFloat(oe.target.value)||0,ce.minWeight),min:ce.minWeight,max:10,step:.1,className:"w-20 text-center"}),x.jsx(Si,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>te(ce.id,ce.weight+.1,ce.minWeight),disabled:ce.weight>=10,children:x.jsx(bl,{className:"h-3 w-3"})}),x.jsx("span",{className:"text-sm text-muted-foreground",children:"kg"})]}),x.jsxs("div",{className:"text-right",children:[x.jsxs("div",{className:"font-semibold text-lg",children:["₹",ce.total.toFixed(2)]}),x.jsxs("div",{className:"text-sm text-muted-foreground",children:[ce.weight,"kg × ₹",ce.price]})]})]})]})]})})},ce.id))})]}),x.jsxs("div",{className:"space-y-6",children:[x.jsxs($i,{children:[x.jsx(dr,{children:x.jsx(Mr,{children:"Order Summary"})}),x.jsxs(Hi,{className:"space-y-4",children:[x.jsxs("div",{className:"space-y-2",children:[x.jsxs("div",{className:"flex justify-between",children:[x.jsxs("span",{children:["Subtotal (",i.length," items)"]}),x.jsxs("span",{children:["₹",v.toFixed(2)]})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{children:"Delivery Fee"}),x.jsx("div",{className:"text-right",children:G===0?x.jsxs("div",{children:[x.jsx("span",{className:"text-success font-medium",children:"FREE"}),x.jsx("div",{className:"text-xs text-muted-foreground",children:"Above ₹500"})]}):x.jsxs("span",{children:["₹",G]})})]}),x.jsx(ac,{}),x.jsxs("div",{className:"flex justify-between text-lg font-semibold",children:[x.jsx("span",{children:"Total"}),x.jsxs("span",{children:["₹",B.toFixed(2)]})]})]}),x.jsxs(Si,{onClick:J,disabled:O,className:"w-full",size:"lg",variant:"meat",children:[x.jsx(YG,{className:"h-5 w-5 mr-2"}),O?"Processing...":`Proceed to Checkout - ₹${B.toFixed(2)}`]})]})]}),x.jsx($i,{children:x.jsx(Hi,{className:"p-4",children:x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsx(qc,{className:"h-5 w-5 text-primary"}),x.jsxs("div",{children:[x.jsx("div",{className:"font-medium",children:"Fast Delivery"}),x.jsx("div",{className:"text-sm text-muted-foreground",children:"Same day delivery available"})]})]})})}),v<500&&x.jsx($i,{className:"border-primary/20 bg-primary/5",children:x.jsx(Hi,{className:"p-4",children:x.jsxs("div",{className:"text-center",children:[x.jsxs("div",{className:"font-medium text-primary",children:["Add ₹",(500-v).toFixed(2)," more for FREE delivery!"]}),x.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Save ₹50 on delivery charges"})]})})})]})]})]})},AW={todaySales:45680,totalOrders:156,pendingOrders:23,lowStockItems:8,totalCustomers:1250,monthlyRevenue:1456780},IW=[{id:"ORD001",customerName:"John Doe",amount:1250,status:"pending",items:3,time:"10 mins ago"},{id:"ORD002",customerName:"Jane Smith",amount:890,status:"confirmed",items:2,time:"25 mins ago"},{id:"ORD003",customerName:"Mike Johnson",amount:2340,status:"processing",items:5,time:"1 hour ago"}],PW=[{id:"1",name:"Chicken Breast",stock:2,minStock:10},{id:"2",name:"Mutton Leg",stock:1,minStock:5},{id:"3",name:"Fish Fillet",stock:3,minStock:8}],MW=()=>{const[i,o]=V.useState(!0),[c,m]=V.useState(null),[v,E]=V.useState([]),[I,s]=V.useState([]);V.useEffect(()=>{(async()=>{o(!0),await new Promise(G=>setTimeout(G,1e3)),m(AW),E(IW),s(PW),o(!1)})()},[]);const O=j=>{switch(j){case"pending":return{variant:"secondary",className:"bg-yellow-400 text-black"};case"confirmed":return{variant:"default",className:"bg-green-500 text-white"};case"processing":return{variant:"default",className:"bg-blue-500 text-white"};case"shipped":return{variant:"default",className:"bg-indigo-500 text-white"};case"delivered":return{variant:"default",className:"bg-green-700 text-white"};case"cancelled":return{variant:"destructive",className:""};default:return{variant:"default",className:""}}};return i||!c?x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"space-y-2",children:[x.jsx(Cr,{className:"h-8 w-48"}),x.jsx(Cr,{className:"h-5 w-96"})]}),x.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((j,G)=>x.jsx(Cr,{className:"h-32"},G))}),x.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[x.jsx(Cr,{className:"h-96"}),x.jsx(Cr,{className:"h-96"})]})]}):x.jsxs("div",{className:"space-y-8",children:[x.jsxs("div",{className:"space-y-2",children:[x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Dashboard"}),x.jsxs(es,{className:"bg-red-600 text-white",children:[x.jsx(n$,{className:"h-3 w-3 mr-1"})," Admin Mode"]})]}),x.jsx("p",{className:"text-muted-foreground",children:"Welcome back! Here's what's happening with your meat shop today."})]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[x.jsxs($i,{className:"hover:shadow-lg transition-shadow",children:[x.jsxs(dr,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[x.jsx(Mr,{className:"text-sm font-medium",children:"Today's Sales"}),x.jsx(id,{className:"h-4 w-4 text-muted-foreground"})]}),x.jsxs(Hi,{children:[x.jsxs("div",{className:"text-2xl font-bold",children:["₹",c.todaySales.toLocaleString()]}),x.jsxs("p",{className:"text-xs text-muted-foreground",children:[x.jsx(T0,{className:"inline h-3 w-3 mr-1 text-success"}),"+12% from yesterday"]})]})]}),x.jsxs($i,{className:"hover:shadow-lg transition-shadow",children:[x.jsxs(dr,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[x.jsx(Mr,{className:"text-sm font-medium",children:"Total Orders"}),x.jsx(ml,{className:"h-4 w-4 text-muted-foreground"})]}),x.jsxs(Hi,{children:[x.jsx("div",{className:"text-2xl font-bold",children:c.totalOrders}),x.jsxs("p",{className:"text-xs text-muted-foreground",children:[x.jsx(T0,{className:"inline h-3 w-3 mr-1 text-success"}),"+8% from yesterday"]})]})]}),x.jsxs($i,{className:"hover:shadow-lg transition-shadow",children:[x.jsxs(dr,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[x.jsx(Mr,{className:"text-sm font-medium",children:"Pending Orders"}),x.jsx(Sd,{className:"h-4 w-4 text-muted-foreground"})]}),x.jsxs(Hi,{children:[x.jsx("div",{className:"text-2xl font-bold",children:c.pendingOrders}),x.jsxs("p",{className:"text-xs text-warning",children:[x.jsx(pS,{className:"inline h-3 w-3 mr-1"}),"Needs attention"]})]})]}),x.jsxs($i,{className:"hover:shadow-lg transition-shadow",children:[x.jsxs(dr,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[x.jsx(Mr,{className:"text-sm font-medium",children:"Low Stock Items"}),x.jsx(pS,{className:"h-4 w-4 text-muted-foreground"})]}),x.jsxs(Hi,{children:[x.jsx("div",{className:"text-2xl font-bold",children:c.lowStockItems}),x.jsxs("p",{className:"text-xs text-destructive",children:[x.jsx(pS,{className:"inline h-3 w-3 mr-1"}),"Restock needed"]})]})]}),x.jsxs($i,{className:"hover:shadow-lg transition-shadow",children:[x.jsxs(dr,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[x.jsx(Mr,{className:"text-sm font-medium",children:"Total Customers"}),x.jsx(a$,{className:"h-4 w-4 text-muted-foreground"})]}),x.jsxs(Hi,{children:[x.jsx("div",{className:"text-2xl font-bold",children:c.totalCustomers}),x.jsxs("p",{className:"text-xs text-muted-foreground",children:[x.jsx(T0,{className:"inline h-3 w-3 mr-1 text-success"}),"+15 new this week"]})]})]}),x.jsxs($i,{className:"hover:shadow-lg transition-shadow",children:[x.jsxs(dr,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[x.jsx(Mr,{className:"text-sm font-medium",children:"Monthly Revenue"}),x.jsx(qG,{className:"h-4 w-4 text-muted-foreground"})]}),x.jsxs(Hi,{children:[x.jsxs("div",{className:"text-2xl font-bold",children:["₹",c.monthlyRevenue.toLocaleString()]}),x.jsxs("p",{className:"text-xs text-muted-foreground",children:[x.jsx(T0,{className:"inline h-3 w-3 mr-1 text-success"}),"+25% from last month"]})]})]})]}),x.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[x.jsxs($i,{children:[x.jsx(dr,{children:x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{children:[x.jsx(Mr,{children:"Recent Orders"}),x.jsx(Ha,{children:"Latest orders that need your attention"})]}),x.jsxs(Si,{variant:"outline",size:"sm",children:[x.jsx(Qh,{className:"h-4 w-4 mr-2"}),"View All"]})]})}),x.jsx(Hi,{children:x.jsx("div",{className:"space-y-4",children:v.map(j=>x.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-accent/50 transition-colors",children:[x.jsxs("div",{className:"space-y-1",children:[x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("span",{className:"font-medium",children:j.id}),(()=>{const G=O(j.status);return x.jsx(es,{variant:G.variant,className:G.className,children:j.status})})()]}),x.jsx("p",{className:"text-sm text-muted-foreground",children:j.customerName}),x.jsxs("p",{className:"text-xs text-muted-foreground",children:[j.items," items • ",j.time]})]}),x.jsxs("div",{className:"text-right",children:[x.jsxs("div",{className:"font-semibold",children:["₹",j.amount]}),x.jsx(Si,{variant:"ghost",size:"sm",className:"h-8 px-2",children:x.jsx(Qh,{className:"h-3 w-3"})})]})]},j.id))})})]}),x.jsxs($i,{children:[x.jsx(dr,{children:x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{children:[x.jsx(Mr,{children:"Low Stock Alert"}),x.jsx(Ha,{children:"Items running low on inventory"})]}),x.jsxs(Si,{variant:"outline",size:"sm",children:[x.jsx(bl,{className:"h-4 w-4 mr-2"}),"Add Stock"]})]})}),x.jsx(Hi,{children:x.jsx("div",{className:"space-y-4",children:I.map(j=>x.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-accent/50 transition-colors",children:[x.jsxs("div",{className:"space-y-1",children:[x.jsx("span",{className:"font-medium",children:j.name}),x.jsxs("p",{className:"text-sm text-muted-foreground",children:["Current: ",j.stock,"kg • Min: ",j.minStock,"kg"]})]}),x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx(es,{variant:"destructive",children:"Low Stock"}),x.jsx(Si,{variant:"ghost",size:"sm",className:"h-8 px-2",children:x.jsx(bl,{className:"h-3 w-3"})})]})]},j.id))})})]})]})]})};function GO(i){const o=V.useRef({value:i,previous:i});return V.useMemo(()=>(o.current.value!==i&&(o.current.previous=o.current.value,o.current.value=i),o.current.previous),[i])}var kC="Switch",[RW,wK]=iu(kC),[DW,kW]=RW(kC),$O=V.forwardRef((i,o)=>{const{__scopeSwitch:c,name:m,checked:v,defaultChecked:E,required:I,disabled:s,value:O="on",onCheckedChange:j,form:G,...W}=i,[B,te]=V.useState(null),ue=vr(o,Q=>te(Q)),J=V.useRef(!1),ce=B?G||!!B.closest("form"):!0,[oe=!1,ee]=Yc({prop:v,defaultProp:E,onChange:j});return x.jsxs(DW,{scope:c,checked:oe,disabled:s,children:[x.jsx(fn.button,{type:"button",role:"switch","aria-checked":oe,"aria-required":I,"data-state":WO(oe),"data-disabled":s?"":void 0,disabled:s,value:O,...W,ref:ue,onClick:Ai(i.onClick,Q=>{ee(Ie=>!Ie),ce&&(J.current=Q.isPropagationStopped(),J.current||Q.stopPropagation())})}),ce&&x.jsx(NW,{control:B,bubbles:!J.current,name:m,value:O,checked:oe,required:I,disabled:s,form:G,style:{transform:"translateX(-100%)"}})]})});$O.displayName=kC;var HO="SwitchThumb",qO=V.forwardRef((i,o)=>{const{__scopeSwitch:c,...m}=i,v=kW(HO,c);return x.jsx(fn.span,{"data-state":WO(v.checked),"data-disabled":v.disabled?"":void 0,...m,ref:o})});qO.displayName=HO;var NW=i=>{const{control:o,checked:c,bubbles:m=!0,...v}=i,E=V.useRef(null),I=GO(c),s=Hz(o);return V.useEffect(()=>{const O=E.current,j=window.HTMLInputElement.prototype,W=Object.getOwnPropertyDescriptor(j,"checked").set;if(I!==c&&W){const B=new Event("click",{bubbles:m});W.call(O,c),O.dispatchEvent(B)}},[I,c,m]),x.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:c,...v,tabIndex:-1,ref:E,style:{...i.style,...s,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function WO(i){return i?"checked":"unchecked"}var ZO=$O,LW=qO;const xm=V.forwardRef(({className:i,...o},c)=>x.jsx(ZO,{className:ui("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",i),...o,ref:c,children:x.jsx(LW,{className:ui("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));xm.displayName=ZO.displayName;const Zy=V.forwardRef(({className:i,...o},c)=>x.jsx("div",{className:"relative w-full overflow-auto",children:x.jsx("table",{ref:c,className:ui("w-full caption-bottom text-sm",i),...o})}));Zy.displayName="Table";const Xy=V.forwardRef(({className:i,...o},c)=>x.jsx("thead",{ref:c,className:ui("[&_tr]:border-b",i),...o}));Xy.displayName="TableHeader";const Ky=V.forwardRef(({className:i,...o},c)=>x.jsx("tbody",{ref:c,className:ui("[&_tr:last-child]:border-0",i),...o}));Ky.displayName="TableBody";const zW=V.forwardRef(({className:i,...o},c)=>x.jsx("tfoot",{ref:c,className:ui("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",i),...o}));zW.displayName="TableFooter";const eu=V.forwardRef(({className:i,...o},c)=>x.jsx("tr",{ref:c,className:ui("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",i),...o}));eu.displayName="TableRow";const kr=V.forwardRef(({className:i,...o},c)=>x.jsx("th",{ref:c,className:ui("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",i),...o}));kr.displayName="TableHead";const Nr=V.forwardRef(({className:i,...o},c)=>x.jsx("td",{ref:c,className:ui("p-4 align-middle [&:has([role=checkbox])]:pr-0",i),...o}));Nr.displayName="TableCell";const OW=V.forwardRef(({className:i,...o},c)=>x.jsx("caption",{ref:c,className:ui("mt-4 text-sm text-muted-foreground",i),...o}));OW.displayName="TableCaption";var WT=["Enter"," "],FW=["ArrowDown","PageUp","Home"],XO=["ArrowUp","PageDown","End"],jW=[...FW,...XO],BW={ltr:[...WT,"ArrowRight"],rtl:[...WT,"ArrowLeft"]},VW={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Yy="Menu",[Ny,UW,GW]=rw(Yy),[af,KO]=iu(Yy,[GW,Rm,Mw]),Rw=Rm(),YO=Mw(),[$W,lf]=af(Yy),[HW,Jy]=af(Yy),JO=i=>{const{__scopeMenu:o,open:c=!1,children:m,dir:v,onOpenChange:E,modal:I=!0}=i,s=Rw(o),[O,j]=V.useState(null),G=V.useRef(!1),W=po(E),B=Iw(v);return V.useEffect(()=>{const te=()=>{G.current=!0,document.addEventListener("pointerdown",ue,{capture:!0,once:!0}),document.addEventListener("pointermove",ue,{capture:!0,once:!0})},ue=()=>G.current=!1;return document.addEventListener("keydown",te,{capture:!0}),()=>{document.removeEventListener("keydown",te,{capture:!0}),document.removeEventListener("pointerdown",ue,{capture:!0}),document.removeEventListener("pointermove",ue,{capture:!0})}},[]),x.jsx(gC,{...s,children:x.jsx($W,{scope:o,open:c,onOpenChange:W,content:O,onContentChange:j,children:x.jsx(HW,{scope:o,onClose:V.useCallback(()=>W(!1),[W]),isUsingKeyboardRef:G,dir:B,modal:I,children:m})})})};JO.displayName=Yy;var qW="MenuAnchor",NC=V.forwardRef((i,o)=>{const{__scopeMenu:c,...m}=i,v=Rw(c);return x.jsx(_C,{...v,...m,ref:o})});NC.displayName=qW;var LC="MenuPortal",[WW,QO]=af(LC,{forceMount:void 0}),eF=i=>{const{__scopeMenu:o,forceMount:c,children:m,container:v}=i,E=lf(LC,o);return x.jsx(WW,{scope:o,forceMount:c,children:x.jsx(El,{present:c||E.open,children:x.jsx(Gy,{asChild:!0,container:v,children:m})})})};eF.displayName=LC;var Wa="MenuContent",[ZW,zC]=af(Wa),tF=V.forwardRef((i,o)=>{const c=QO(Wa,i.__scopeMenu),{forceMount:m=c.forceMount,...v}=i,E=lf(Wa,i.__scopeMenu),I=Jy(Wa,i.__scopeMenu);return x.jsx(Ny.Provider,{scope:i.__scopeMenu,children:x.jsx(El,{present:m||E.open,children:x.jsx(Ny.Slot,{scope:i.__scopeMenu,children:I.modal?x.jsx(XW,{...v,ref:o}):x.jsx(KW,{...v,ref:o})})})})}),XW=V.forwardRef((i,o)=>{const c=lf(Wa,i.__scopeMenu),m=V.useRef(null),v=vr(o,m);return V.useEffect(()=>{const E=m.current;if(E)return TC(E)},[]),x.jsx(OC,{...i,ref:v,trapFocus:c.open,disableOutsidePointerEvents:c.open,disableOutsideScroll:!0,onFocusOutside:Ai(i.onFocusOutside,E=>E.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>c.onOpenChange(!1)})}),KW=V.forwardRef((i,o)=>{const c=lf(Wa,i.__scopeMenu);return x.jsx(OC,{...i,ref:o,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>c.onOpenChange(!1)})}),OC=V.forwardRef((i,o)=>{const{__scopeMenu:c,loop:m=!1,trapFocus:v,onOpenAutoFocus:E,onCloseAutoFocus:I,disableOutsidePointerEvents:s,onEntryFocus:O,onEscapeKeyDown:j,onPointerDownOutside:G,onFocusOutside:W,onInteractOutside:B,onDismiss:te,disableOutsideScroll:ue,...J}=i,ce=lf(Wa,c),oe=Jy(Wa,c),ee=Rw(c),Q=YO(c),Ie=UW(c),[pe,Ke]=V.useState(null),et=V.useRef(null),at=vr(o,et,ce.onContentChange),Xt=V.useRef(0),Ct=V.useRef(""),mt=V.useRef(0),Dt=V.useRef(null),Kt=V.useRef("right"),Pt=V.useRef(0),ti=ue?Sw:V.Fragment,Nt=ue?{as:da,allowPinchZoom:!0}:void 0,bi=Tt=>{var ni,Fi;const ii=Ct.current+Tt,jt=Ie().filter(nn=>!nn.disabled),gi=document.activeElement,en=(ni=jt.find(nn=>nn.ref.current===gi))==null?void 0:ni.textValue,Dn=jt.map(nn=>nn.textValue),ir=lZ(Dn,ii,en),wi=(Fi=jt.find(nn=>nn.textValue===ir))==null?void 0:Fi.ref.current;(function nn(Ri){Ct.current=Ri,window.clearTimeout(Xt.current),Ri!==""&&(Xt.current=window.setTimeout(()=>nn(""),1e3))})(ii),wi&&setTimeout(()=>wi.focus())};V.useEffect(()=>()=>window.clearTimeout(Xt.current),[]),SC();const ot=V.useCallback(Tt=>{var jt,gi;return Kt.current===((jt=Dt.current)==null?void 0:jt.side)&&uZ(Tt,(gi=Dt.current)==null?void 0:gi.area)},[]);return x.jsx(ZW,{scope:c,searchRef:Ct,onItemEnter:V.useCallback(Tt=>{ot(Tt)&&Tt.preventDefault()},[ot]),onItemLeave:V.useCallback(Tt=>{var ii;ot(Tt)||((ii=et.current)==null||ii.focus(),Ke(null))},[ot]),onTriggerLeave:V.useCallback(Tt=>{ot(Tt)&&Tt.preventDefault()},[ot]),pointerGraceTimerRef:mt,onPointerGraceIntentChange:V.useCallback(Tt=>{Dt.current=Tt},[]),children:x.jsx(ti,{...Nt,children:x.jsx(ww,{asChild:!0,trapped:v,onMountAutoFocus:Ai(E,Tt=>{var ii;Tt.preventDefault(),(ii=et.current)==null||ii.focus({preventScroll:!0})}),onUnmountAutoFocus:I,children:x.jsx(Em,{asChild:!0,disableOutsidePointerEvents:s,onEscapeKeyDown:j,onPointerDownOutside:G,onFocusOutside:W,onInteractOutside:B,onDismiss:te,children:x.jsx(CO,{asChild:!0,...Q,dir:oe.dir,orientation:"vertical",loop:m,currentTabStopId:pe,onCurrentTabStopIdChange:Ke,onEntryFocus:Ai(O,Tt=>{oe.isUsingKeyboardRef.current||Tt.preventDefault()}),preventScrollOnEntryFocus:!0,children:x.jsx(yC,{role:"menu","aria-orientation":"vertical","data-state":_F(ce.open),"data-radix-menu-content":"",dir:oe.dir,...ee,...J,ref:at,style:{outline:"none",...J.style},onKeyDown:Ai(J.onKeyDown,Tt=>{const jt=Tt.target.closest("[data-radix-menu-content]")===Tt.currentTarget,gi=Tt.ctrlKey||Tt.altKey||Tt.metaKey,en=Tt.key.length===1;jt&&(Tt.key==="Tab"&&Tt.preventDefault(),!gi&&en&&bi(Tt.key));const Dn=et.current;if(Tt.target!==Dn||!jW.includes(Tt.key))return;Tt.preventDefault();const wi=Ie().filter(ni=>!ni.disabled).map(ni=>ni.ref.current);XO.includes(Tt.key)&&wi.reverse(),oZ(wi)}),onBlur:Ai(i.onBlur,Tt=>{Tt.currentTarget.contains(Tt.target)||(window.clearTimeout(Xt.current),Ct.current="")}),onPointerMove:Ai(i.onPointerMove,Ly(Tt=>{const ii=Tt.target,jt=Pt.current!==Tt.clientX;if(Tt.currentTarget.contains(ii)&&jt){const gi=Tt.clientX>Pt.current?"right":"left";Kt.current=gi,Pt.current=Tt.clientX}}))})})})})})})});tF.displayName=Wa;var YW="MenuGroup",FC=V.forwardRef((i,o)=>{const{__scopeMenu:c,...m}=i;return x.jsx(fn.div,{role:"group",...m,ref:o})});FC.displayName=YW;var JW="MenuLabel",iF=V.forwardRef((i,o)=>{const{__scopeMenu:c,...m}=i;return x.jsx(fn.div,{...m,ref:o})});iF.displayName=JW;var D1="MenuItem",JD="menu.itemSelect",Dw=V.forwardRef((i,o)=>{const{disabled:c=!1,onSelect:m,...v}=i,E=V.useRef(null),I=Jy(D1,i.__scopeMenu),s=zC(D1,i.__scopeMenu),O=vr(o,E),j=V.useRef(!1),G=()=>{const W=E.current;if(!c&&W){const B=new CustomEvent(JD,{bubbles:!0,cancelable:!0});W.addEventListener(JD,te=>m==null?void 0:m(te),{once:!0}),QE(W,B),B.defaultPrevented?j.current=!1:I.onClose()}};return x.jsx(nF,{...v,ref:O,disabled:c,onClick:Ai(i.onClick,G),onPointerDown:W=>{var B;(B=i.onPointerDown)==null||B.call(i,W),j.current=!0},onPointerUp:Ai(i.onPointerUp,W=>{var B;j.current||(B=W.currentTarget)==null||B.click()}),onKeyDown:Ai(i.onKeyDown,W=>{const B=s.searchRef.current!=="";c||B&&W.key===" "||WT.includes(W.key)&&(W.currentTarget.click(),W.preventDefault())})})});Dw.displayName=D1;var nF=V.forwardRef((i,o)=>{const{__scopeMenu:c,disabled:m=!1,textValue:v,...E}=i,I=zC(D1,c),s=YO(c),O=V.useRef(null),j=vr(o,O),[G,W]=V.useState(!1),[B,te]=V.useState("");return V.useEffect(()=>{const ue=O.current;ue&&te((ue.textContent??"").trim())},[E.children]),x.jsx(Ny.ItemSlot,{scope:c,disabled:m,textValue:v??B,children:x.jsx(AO,{asChild:!0,...s,focusable:!m,children:x.jsx(fn.div,{role:"menuitem","data-highlighted":G?"":void 0,"aria-disabled":m||void 0,"data-disabled":m?"":void 0,...E,ref:j,onPointerMove:Ai(i.onPointerMove,Ly(ue=>{m?I.onItemLeave(ue):(I.onItemEnter(ue),ue.defaultPrevented||ue.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Ai(i.onPointerLeave,Ly(ue=>I.onItemLeave(ue))),onFocus:Ai(i.onFocus,()=>W(!0)),onBlur:Ai(i.onBlur,()=>W(!1))})})})}),QW="MenuCheckboxItem",rF=V.forwardRef((i,o)=>{const{checked:c=!1,onCheckedChange:m,...v}=i;return x.jsx(cF,{scope:i.__scopeMenu,checked:c,children:x.jsx(Dw,{role:"menuitemcheckbox","aria-checked":k1(c)?"mixed":c,...v,ref:o,"data-state":BC(c),onSelect:Ai(v.onSelect,()=>m==null?void 0:m(k1(c)?!0:!c),{checkForDefaultPrevented:!1})})})});rF.displayName=QW;var sF="MenuRadioGroup",[eZ,tZ]=af(sF,{value:void 0,onValueChange:()=>{}}),oF=V.forwardRef((i,o)=>{const{value:c,onValueChange:m,...v}=i,E=po(m);return x.jsx(eZ,{scope:i.__scopeMenu,value:c,onValueChange:E,children:x.jsx(FC,{...v,ref:o})})});oF.displayName=sF;var aF="MenuRadioItem",lF=V.forwardRef((i,o)=>{const{value:c,...m}=i,v=tZ(aF,i.__scopeMenu),E=c===v.value;return x.jsx(cF,{scope:i.__scopeMenu,checked:E,children:x.jsx(Dw,{role:"menuitemradio","aria-checked":E,...m,ref:o,"data-state":BC(E),onSelect:Ai(m.onSelect,()=>{var I;return(I=v.onValueChange)==null?void 0:I.call(v,c)},{checkForDefaultPrevented:!1})})})});lF.displayName=aF;var jC="MenuItemIndicator",[cF,iZ]=af(jC,{checked:!1}),uF=V.forwardRef((i,o)=>{const{__scopeMenu:c,forceMount:m,...v}=i,E=iZ(jC,c);return x.jsx(El,{present:m||k1(E.checked)||E.checked===!0,children:x.jsx(fn.span,{...v,ref:o,"data-state":BC(E.checked)})})});uF.displayName=jC;var nZ="MenuSeparator",dF=V.forwardRef((i,o)=>{const{__scopeMenu:c,...m}=i;return x.jsx(fn.div,{role:"separator","aria-orientation":"horizontal",...m,ref:o})});dF.displayName=nZ;var rZ="MenuArrow",hF=V.forwardRef((i,o)=>{const{__scopeMenu:c,...m}=i,v=Rw(c);return x.jsx(xC,{...v,...m,ref:o})});hF.displayName=rZ;var sZ="MenuSub",[bK,fF]=af(sZ),K_="MenuSubTrigger",pF=V.forwardRef((i,o)=>{const c=lf(K_,i.__scopeMenu),m=Jy(K_,i.__scopeMenu),v=fF(K_,i.__scopeMenu),E=zC(K_,i.__scopeMenu),I=V.useRef(null),{pointerGraceTimerRef:s,onPointerGraceIntentChange:O}=E,j={__scopeMenu:i.__scopeMenu},G=V.useCallback(()=>{I.current&&window.clearTimeout(I.current),I.current=null},[]);return V.useEffect(()=>G,[G]),V.useEffect(()=>{const W=s.current;return()=>{window.clearTimeout(W),O(null)}},[s,O]),x.jsx(NC,{asChild:!0,...j,children:x.jsx(nF,{id:v.triggerId,"aria-haspopup":"menu","aria-expanded":c.open,"aria-controls":v.contentId,"data-state":_F(c.open),...i,ref:nw(o,v.onTriggerChange),onClick:W=>{var B;(B=i.onClick)==null||B.call(i,W),!(i.disabled||W.defaultPrevented)&&(W.currentTarget.focus(),c.open||c.onOpenChange(!0))},onPointerMove:Ai(i.onPointerMove,Ly(W=>{E.onItemEnter(W),!W.defaultPrevented&&!i.disabled&&!c.open&&!I.current&&(E.onPointerGraceIntentChange(null),I.current=window.setTimeout(()=>{c.onOpenChange(!0),G()},100))})),onPointerLeave:Ai(i.onPointerLeave,Ly(W=>{var te,ue;G();const B=(te=c.content)==null?void 0:te.getBoundingClientRect();if(B){const J=(ue=c.content)==null?void 0:ue.dataset.side,ce=J==="right",oe=ce?-5:5,ee=B[ce?"left":"right"],Q=B[ce?"right":"left"];E.onPointerGraceIntentChange({area:[{x:W.clientX+oe,y:W.clientY},{x:ee,y:B.top},{x:Q,y:B.top},{x:Q,y:B.bottom},{x:ee,y:B.bottom}],side:J}),window.clearTimeout(s.current),s.current=window.setTimeout(()=>E.onPointerGraceIntentChange(null),300)}else{if(E.onTriggerLeave(W),W.defaultPrevented)return;E.onPointerGraceIntentChange(null)}})),onKeyDown:Ai(i.onKeyDown,W=>{var te;const B=E.searchRef.current!=="";i.disabled||B&&W.key===" "||BW[m.dir].includes(W.key)&&(c.onOpenChange(!0),(te=c.content)==null||te.focus(),W.preventDefault())})})})});pF.displayName=K_;var mF="MenuSubContent",gF=V.forwardRef((i,o)=>{const c=QO(Wa,i.__scopeMenu),{forceMount:m=c.forceMount,...v}=i,E=lf(Wa,i.__scopeMenu),I=Jy(Wa,i.__scopeMenu),s=fF(mF,i.__scopeMenu),O=V.useRef(null),j=vr(o,O);return x.jsx(Ny.Provider,{scope:i.__scopeMenu,children:x.jsx(El,{present:m||E.open,children:x.jsx(Ny.Slot,{scope:i.__scopeMenu,children:x.jsx(OC,{id:s.contentId,"aria-labelledby":s.triggerId,...v,ref:j,align:"start",side:I.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:G=>{var W;I.isUsingKeyboardRef.current&&((W=O.current)==null||W.focus()),G.preventDefault()},onCloseAutoFocus:G=>G.preventDefault(),onFocusOutside:Ai(i.onFocusOutside,G=>{G.target!==s.trigger&&E.onOpenChange(!1)}),onEscapeKeyDown:Ai(i.onEscapeKeyDown,G=>{I.onClose(),G.preventDefault()}),onKeyDown:Ai(i.onKeyDown,G=>{var te;const W=G.currentTarget.contains(G.target),B=VW[I.dir].includes(G.key);W&&B&&(E.onOpenChange(!1),(te=s.trigger)==null||te.focus(),G.preventDefault())})})})})})});gF.displayName=mF;function _F(i){return i?"open":"closed"}function k1(i){return i==="indeterminate"}function BC(i){return k1(i)?"indeterminate":i?"checked":"unchecked"}function oZ(i){const o=document.activeElement;for(const c of i)if(c===o||(c.focus(),document.activeElement!==o))return}function aZ(i,o){return i.map((c,m)=>i[(o+m)%i.length])}function lZ(i,o,c){const v=o.length>1&&Array.from(o).every(j=>j===o[0])?o[0]:o,E=c?i.indexOf(c):-1;let I=aZ(i,Math.max(E,0));v.length===1&&(I=I.filter(j=>j!==c));const O=I.find(j=>j.toLowerCase().startsWith(v.toLowerCase()));return O!==c?O:void 0}function cZ(i,o){const{x:c,y:m}=i;let v=!1;for(let E=0,I=o.length-1;E<o.length;I=E++){const s=o[E].x,O=o[E].y,j=o[I].x,G=o[I].y;O>m!=G>m&&c<(j-s)*(m-O)/(G-O)+s&&(v=!v)}return v}function uZ(i,o){if(!o)return!1;const c={x:i.clientX,y:i.clientY};return cZ(c,o)}function Ly(i){return o=>o.pointerType==="mouse"?i(o):void 0}var dZ=JO,hZ=NC,fZ=eF,pZ=tF,mZ=FC,gZ=iF,_Z=Dw,yZ=rF,xZ=oF,vZ=lF,wZ=uF,bZ=dF,SZ=hF,TZ=pF,EZ=gF,VC="DropdownMenu",[CZ,SK]=iu(VC,[KO]),Ko=KO(),[AZ,yF]=CZ(VC),xF=i=>{const{__scopeDropdownMenu:o,children:c,dir:m,open:v,defaultOpen:E,onOpenChange:I,modal:s=!0}=i,O=Ko(o),j=V.useRef(null),[G=!1,W]=Yc({prop:v,defaultProp:E,onChange:I});return x.jsx(AZ,{scope:o,triggerId:vl(),triggerRef:j,contentId:vl(),open:G,onOpenChange:W,onOpenToggle:V.useCallback(()=>W(B=>!B),[W]),modal:s,children:x.jsx(dZ,{...O,open:G,onOpenChange:W,dir:m,modal:s,children:c})})};xF.displayName=VC;var vF="DropdownMenuTrigger",wF=V.forwardRef((i,o)=>{const{__scopeDropdownMenu:c,disabled:m=!1,...v}=i,E=yF(vF,c),I=Ko(c);return x.jsx(hZ,{asChild:!0,...I,children:x.jsx(fn.button,{type:"button",id:E.triggerId,"aria-haspopup":"menu","aria-expanded":E.open,"aria-controls":E.open?E.contentId:void 0,"data-state":E.open?"open":"closed","data-disabled":m?"":void 0,disabled:m,...v,ref:nw(o,E.triggerRef),onPointerDown:Ai(i.onPointerDown,s=>{!m&&s.button===0&&s.ctrlKey===!1&&(E.onOpenToggle(),E.open||s.preventDefault())}),onKeyDown:Ai(i.onKeyDown,s=>{m||(["Enter"," "].includes(s.key)&&E.onOpenToggle(),s.key==="ArrowDown"&&E.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(s.key)&&s.preventDefault())})})})});wF.displayName=vF;var IZ="DropdownMenuPortal",bF=i=>{const{__scopeDropdownMenu:o,...c}=i,m=Ko(o);return x.jsx(fZ,{...m,...c})};bF.displayName=IZ;var SF="DropdownMenuContent",TF=V.forwardRef((i,o)=>{const{__scopeDropdownMenu:c,...m}=i,v=yF(SF,c),E=Ko(c),I=V.useRef(!1);return x.jsx(pZ,{id:v.contentId,"aria-labelledby":v.triggerId,...E,...m,ref:o,onCloseAutoFocus:Ai(i.onCloseAutoFocus,s=>{var O;I.current||(O=v.triggerRef.current)==null||O.focus(),I.current=!1,s.preventDefault()}),onInteractOutside:Ai(i.onInteractOutside,s=>{const O=s.detail.originalEvent,j=O.button===0&&O.ctrlKey===!0,G=O.button===2||j;(!v.modal||G)&&(I.current=!0)}),style:{...i.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});TF.displayName=SF;var PZ="DropdownMenuGroup",MZ=V.forwardRef((i,o)=>{const{__scopeDropdownMenu:c,...m}=i,v=Ko(c);return x.jsx(mZ,{...v,...m,ref:o})});MZ.displayName=PZ;var RZ="DropdownMenuLabel",EF=V.forwardRef((i,o)=>{const{__scopeDropdownMenu:c,...m}=i,v=Ko(c);return x.jsx(gZ,{...v,...m,ref:o})});EF.displayName=RZ;var DZ="DropdownMenuItem",CF=V.forwardRef((i,o)=>{const{__scopeDropdownMenu:c,...m}=i,v=Ko(c);return x.jsx(_Z,{...v,...m,ref:o})});CF.displayName=DZ;var kZ="DropdownMenuCheckboxItem",AF=V.forwardRef((i,o)=>{const{__scopeDropdownMenu:c,...m}=i,v=Ko(c);return x.jsx(yZ,{...v,...m,ref:o})});AF.displayName=kZ;var NZ="DropdownMenuRadioGroup",LZ=V.forwardRef((i,o)=>{const{__scopeDropdownMenu:c,...m}=i,v=Ko(c);return x.jsx(xZ,{...v,...m,ref:o})});LZ.displayName=NZ;var zZ="DropdownMenuRadioItem",IF=V.forwardRef((i,o)=>{const{__scopeDropdownMenu:c,...m}=i,v=Ko(c);return x.jsx(vZ,{...v,...m,ref:o})});IF.displayName=zZ;var OZ="DropdownMenuItemIndicator",PF=V.forwardRef((i,o)=>{const{__scopeDropdownMenu:c,...m}=i,v=Ko(c);return x.jsx(wZ,{...v,...m,ref:o})});PF.displayName=OZ;var FZ="DropdownMenuSeparator",MF=V.forwardRef((i,o)=>{const{__scopeDropdownMenu:c,...m}=i,v=Ko(c);return x.jsx(bZ,{...v,...m,ref:o})});MF.displayName=FZ;var jZ="DropdownMenuArrow",BZ=V.forwardRef((i,o)=>{const{__scopeDropdownMenu:c,...m}=i,v=Ko(c);return x.jsx(SZ,{...v,...m,ref:o})});BZ.displayName=jZ;var VZ="DropdownMenuSubTrigger",RF=V.forwardRef((i,o)=>{const{__scopeDropdownMenu:c,...m}=i,v=Ko(c);return x.jsx(TZ,{...v,...m,ref:o})});RF.displayName=VZ;var UZ="DropdownMenuSubContent",DF=V.forwardRef((i,o)=>{const{__scopeDropdownMenu:c,...m}=i,v=Ko(c);return x.jsx(EZ,{...v,...m,ref:o,style:{...i.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});DF.displayName=UZ;var GZ=xF,$Z=wF,HZ=bF,kF=TF,NF=EF,LF=CF,zF=AF,OF=IF,FF=PF,jF=MF,BF=RF,VF=DF;const kw=GZ,Nw=$Z,qZ=V.forwardRef(({className:i,inset:o,children:c,...m},v)=>x.jsxs(BF,{ref:v,className:ui("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",o&&"pl-8",i),...m,children:[c,x.jsx(WG,{className:"ml-auto h-4 w-4"})]}));qZ.displayName=BF.displayName;const WZ=V.forwardRef(({className:i,...o},c)=>x.jsx(VF,{ref:c,className:ui("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",i),...o}));WZ.displayName=VF.displayName;const Qy=V.forwardRef(({className:i,sideOffset:o=4,...c},m)=>x.jsx(HZ,{children:x.jsx(kF,{ref:m,sideOffset:o,className:ui("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",i),...c})}));Qy.displayName=kF.displayName;const Qs=V.forwardRef(({className:i,inset:o,...c},m)=>x.jsx(LF,{ref:m,className:ui("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",o&&"pl-8",i),...c}));Qs.displayName=LF.displayName;const ZZ=V.forwardRef(({className:i,children:o,checked:c,...m},v)=>x.jsxs(zF,{ref:v,className:ui("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",i),checked:c,...m,children:[x.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:x.jsx(FF,{children:x.jsx(bz,{className:"h-4 w-4"})})}),o]}));ZZ.displayName=zF.displayName;const XZ=V.forwardRef(({className:i,children:o,...c},m)=>x.jsxs(OF,{ref:m,className:ui("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",i),...c,children:[x.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:x.jsx(FF,{children:x.jsx(KG,{className:"h-2 w-2 fill-current"})})}),o]}));XZ.displayName=OF.displayName;const KZ=V.forwardRef(({className:i,inset:o,...c},m)=>x.jsx(NF,{ref:m,className:ui("px-2 py-1.5 text-sm font-semibold",o&&"pl-8",i),...c}));KZ.displayName=NF.displayName;const YZ=V.forwardRef(({className:i,...o},c)=>x.jsx(jF,{ref:c,className:ui("-mx-1 my-1 h-px bg-muted",i),...o}));YZ.displayName=jF.displayName;const Lw=H3,UC=q3,JZ=W3,UF=V.forwardRef(({className:i,...o},c)=>x.jsx(Tw,{ref:c,className:ui("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",i),...o}));UF.displayName=Tw.displayName;const ex=V.forwardRef(({className:i,children:o,...c},m)=>x.jsxs(JZ,{children:[x.jsx(UF,{}),x.jsxs(Ew,{ref:m,className:ui("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",i),...c,children:[o,x.jsxs(Z3,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[x.jsx(oC,{className:"h-4 w-4"}),x.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));ex.displayName=Ew.displayName;const tx=({className:i,...o})=>x.jsx("div",{className:ui("flex flex-col space-y-1.5 text-center sm:text-left",i),...o});tx.displayName="DialogHeader";const ix=V.forwardRef(({className:i,...o},c)=>x.jsx(Cw,{ref:c,className:ui("text-lg font-semibold leading-none tracking-tight",i),...o}));ix.displayName=Cw.displayName;const QZ=V.forwardRef(({className:i,...o},c)=>x.jsx(Aw,{ref:c,className:ui("text-sm text-muted-foreground",i),...o}));QZ.displayName=Aw.displayName;var nx=i=>i.type==="checkbox",Vh=i=>i instanceof Date,$o=i=>i==null;const GF=i=>typeof i=="object";var ws=i=>!$o(i)&&!Array.isArray(i)&&GF(i)&&!Vh(i),$F=i=>ws(i)&&i.target?nx(i.target)?i.target.checked:i.target.value:i,eX=i=>i.substring(0,i.search(/\.\d+(\.|$)/))||i,HF=(i,o)=>i.has(eX(o)),tX=i=>{const o=i.constructor&&i.constructor.prototype;return ws(o)&&o.hasOwnProperty("isPrototypeOf")},GC=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Bs(i){let o;const c=Array.isArray(i),m=typeof FileList<"u"?i instanceof FileList:!1;if(i instanceof Date)o=new Date(i);else if(!(GC&&(i instanceof Blob||m))&&(c||ws(i)))if(o=c?[]:Object.create(Object.getPrototypeOf(i)),!c&&!tX(i))o=i;else for(const v in i)i.hasOwnProperty(v)&&(o[v]=Bs(i[v]));else return i;return o}var zw=i=>/^\w*$/.test(i),ys=i=>i===void 0,$C=i=>Array.isArray(i)?i.filter(Boolean):[],HC=i=>$C(i.replace(/["|']|\]/g,"").split(/\.|\[/)),Pi=(i,o,c)=>{if(!o||!ws(i))return c;const m=(zw(o)?[o]:HC(o)).reduce((v,E)=>$o(v)?v:v[E],i);return ys(m)||m===i?ys(i[o])?c:i[o]:m},ba=i=>typeof i=="boolean",qr=(i,o,c)=>{let m=-1;const v=zw(o)?[o]:HC(o),E=v.length,I=E-1;for(;++m<E;){const s=v[m];let O=c;if(m!==I){const j=i[s];O=ws(j)||Array.isArray(j)?j:isNaN(+v[m+1])?{}:[]}if(s==="__proto__"||s==="constructor"||s==="prototype")return;i[s]=O,i=i[s]}};const N1={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},gl={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Fc={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},qC=Vt.createContext(null);qC.displayName="HookFormContext";const Ow=()=>Vt.useContext(qC),iX=i=>{const{children:o,...c}=i;return Vt.createElement(qC.Provider,{value:c},o)};var qF=(i,o,c,m=!0)=>{const v={defaultValues:o._defaultValues};for(const E in i)Object.defineProperty(v,E,{get:()=>{const I=E;return o._proxyFormState[I]!==gl.all&&(o._proxyFormState[I]=!m||gl.all),c&&(c[I]=!0),i[I]}});return v};const WC=typeof window<"u"?Vt.useLayoutEffect:Vt.useEffect;function nX(i){const o=Ow(),{control:c=o.control,disabled:m,name:v,exact:E}=i||{},[I,s]=Vt.useState(c._formState),O=Vt.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1});return WC(()=>c._subscribe({name:v,formState:O.current,exact:E,callback:j=>{!m&&s({...c._formState,...j})}}),[v,m,E]),Vt.useEffect(()=>{O.current.isValid&&c._setValid(!0)},[c]),Vt.useMemo(()=>qF(I,c,O.current,!1),[I,c])}var lc=i=>typeof i=="string",WF=(i,o,c,m,v)=>lc(i)?(m&&o.watch.add(i),Pi(c,i,v)):Array.isArray(i)?i.map(E=>(m&&o.watch.add(E),Pi(c,E))):(m&&(o.watchAll=!0),c),ZT=i=>$o(i)||!GF(i);function Uc(i,o,c=new WeakSet){if(ZT(i)||ZT(o))return i===o;if(Vh(i)&&Vh(o))return i.getTime()===o.getTime();const m=Object.keys(i),v=Object.keys(o);if(m.length!==v.length)return!1;if(c.has(i)||c.has(o))return!0;c.add(i),c.add(o);for(const E of m){const I=i[E];if(!v.includes(E))return!1;if(E!=="ref"){const s=o[E];if(Vh(I)&&Vh(s)||ws(I)&&ws(s)||Array.isArray(I)&&Array.isArray(s)?!Uc(I,s,c):I!==s)return!1}}return!0}function rX(i){const o=Ow(),{control:c=o.control,name:m,defaultValue:v,disabled:E,exact:I,compute:s}=i||{},O=Vt.useRef(v),j=Vt.useRef(s),G=Vt.useRef(void 0);j.current=s;const W=Vt.useMemo(()=>c._getWatch(m,O.current),[c,m]),[B,te]=Vt.useState(j.current?j.current(W):W);return WC(()=>c._subscribe({name:m,formState:{values:!0},exact:I,callback:ue=>{if(!E){const J=WF(m,c._names,ue.values||c._formValues,!1,O.current);if(j.current){const ce=j.current(J);Uc(ce,G.current)||(te(ce),G.current=ce)}else te(J)}}}),[c,E,m,I]),Vt.useEffect(()=>c._removeUnmounted()),B}function sX(i){const o=Ow(),{name:c,disabled:m,control:v=o.control,shouldUnregister:E,defaultValue:I}=i,s=HF(v._names.array,c),O=Vt.useMemo(()=>Pi(v._formValues,c,Pi(v._defaultValues,c,I)),[v,c,I]),j=rX({control:v,name:c,defaultValue:O,exact:!0}),G=nX({control:v,name:c,exact:!0}),W=Vt.useRef(i),B=Vt.useRef(v.register(c,{...i.rules,value:j,...ba(i.disabled)?{disabled:i.disabled}:{}}));W.current=i;const te=Vt.useMemo(()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!Pi(G.errors,c)},isDirty:{enumerable:!0,get:()=>!!Pi(G.dirtyFields,c)},isTouched:{enumerable:!0,get:()=>!!Pi(G.touchedFields,c)},isValidating:{enumerable:!0,get:()=>!!Pi(G.validatingFields,c)},error:{enumerable:!0,get:()=>Pi(G.errors,c)}}),[G,c]),ue=Vt.useCallback(ee=>B.current.onChange({target:{value:$F(ee),name:c},type:N1.CHANGE}),[c]),J=Vt.useCallback(()=>B.current.onBlur({target:{value:Pi(v._formValues,c),name:c},type:N1.BLUR}),[c,v._formValues]),ce=Vt.useCallback(ee=>{const Q=Pi(v._fields,c);Q&&ee&&(Q._f.ref={focus:()=>ee.focus&&ee.focus(),select:()=>ee.select&&ee.select(),setCustomValidity:Ie=>ee.setCustomValidity(Ie),reportValidity:()=>ee.reportValidity()})},[v._fields,c]),oe=Vt.useMemo(()=>({name:c,value:j,...ba(m)||G.disabled?{disabled:G.disabled||m}:{},onChange:ue,onBlur:J,ref:ce}),[c,m,G.disabled,ue,J,ce,j]);return Vt.useEffect(()=>{const ee=v._options.shouldUnregister||E;v.register(c,{...W.current.rules,...ba(W.current.disabled)?{disabled:W.current.disabled}:{}});const Q=(Ie,pe)=>{const Ke=Pi(v._fields,Ie);Ke&&Ke._f&&(Ke._f.mount=pe)};if(Q(c,!0),ee){const Ie=Bs(Pi(v._options.defaultValues,c));qr(v._defaultValues,c,Ie),ys(Pi(v._formValues,c))&&qr(v._formValues,c,Ie)}return!s&&v.register(c),()=>{(s?ee&&!v._state.action:ee)?v.unregister(c):Q(c,!1)}},[c,v,s,E]),Vt.useEffect(()=>{v._setDisabledField({disabled:m,name:c})},[m,c,v]),Vt.useMemo(()=>({field:oe,formState:G,fieldState:te}),[oe,G,te])}const oX=i=>i.render(sX(i));var aX=(i,o,c,m,v)=>o?{...c[i],types:{...c[i]&&c[i].types?c[i].types:{},[m]:v||!0}}:{},ly=i=>Array.isArray(i)?i:[i],QD=()=>{let i=[];return{get observers(){return i},next:v=>{for(const E of i)E.next&&E.next(v)},subscribe:v=>(i.push(v),{unsubscribe:()=>{i=i.filter(E=>E!==v)}}),unsubscribe:()=>{i=[]}}},sa=i=>ws(i)&&!Object.keys(i).length,ZC=i=>i.type==="file",_l=i=>typeof i=="function",L1=i=>{if(!GC)return!1;const o=i?i.ownerDocument:0;return i instanceof(o&&o.defaultView?o.defaultView.HTMLElement:HTMLElement)},ZF=i=>i.type==="select-multiple",XC=i=>i.type==="radio",lX=i=>XC(i)||nx(i),MS=i=>L1(i)&&i.isConnected;function cX(i,o){const c=o.slice(0,-1).length;let m=0;for(;m<c;)i=ys(i)?m++:i[o[m++]];return i}function uX(i){for(const o in i)if(i.hasOwnProperty(o)&&!ys(i[o]))return!1;return!0}function Ps(i,o){const c=Array.isArray(o)?o:zw(o)?[o]:HC(o),m=c.length===1?i:cX(i,c),v=c.length-1,E=c[v];return m&&delete m[E],v!==0&&(ws(m)&&sa(m)||Array.isArray(m)&&uX(m))&&Ps(i,c.slice(0,-1)),i}var XF=i=>{for(const o in i)if(_l(i[o]))return!0;return!1};function z1(i,o={}){const c=Array.isArray(i);if(ws(i)||c)for(const m in i)Array.isArray(i[m])||ws(i[m])&&!XF(i[m])?(o[m]=Array.isArray(i[m])?[]:{},z1(i[m],o[m])):$o(i[m])||(o[m]=!0);return o}function KF(i,o,c){const m=Array.isArray(i);if(ws(i)||m)for(const v in i)Array.isArray(i[v])||ws(i[v])&&!XF(i[v])?ys(o)||ZT(c[v])?c[v]=Array.isArray(i[v])?z1(i[v],[]):{...z1(i[v])}:KF(i[v],$o(o)?{}:o[v],c[v]):c[v]=!Uc(i[v],o[v]);return c}var U_=(i,o)=>KF(i,o,z1(o));const ek={value:!1,isValid:!1},tk={value:!0,isValid:!0};var YF=i=>{if(Array.isArray(i)){if(i.length>1){const o=i.filter(c=>c&&c.checked&&!c.disabled).map(c=>c.value);return{value:o,isValid:!!o.length}}return i[0].checked&&!i[0].disabled?i[0].attributes&&!ys(i[0].attributes.value)?ys(i[0].value)||i[0].value===""?tk:{value:i[0].value,isValid:!0}:tk:ek}return ek},JF=(i,{valueAsNumber:o,valueAsDate:c,setValueAs:m})=>ys(i)?i:o?i===""?NaN:i&&+i:c&&lc(i)?new Date(i):m?m(i):i;const ik={isValid:!1,value:null};var QF=i=>Array.isArray(i)?i.reduce((o,c)=>c&&c.checked&&!c.disabled?{isValid:!0,value:c.value}:o,ik):ik;function nk(i){const o=i.ref;return ZC(o)?o.files:XC(o)?QF(i.refs).value:ZF(o)?[...o.selectedOptions].map(({value:c})=>c):nx(o)?YF(i.refs).value:JF(ys(o.value)?i.ref.value:o.value,i)}var dX=(i,o,c,m)=>{const v={};for(const E of i){const I=Pi(o,E);I&&qr(v,E,I._f)}return{criteriaMode:c,names:[...i],fields:v,shouldUseNativeValidation:m}},O1=i=>i instanceof RegExp,G_=i=>ys(i)?i:O1(i)?i.source:ws(i)?O1(i.value)?i.value.source:i.value:i,rk=i=>({isOnSubmit:!i||i===gl.onSubmit,isOnBlur:i===gl.onBlur,isOnChange:i===gl.onChange,isOnAll:i===gl.all,isOnTouch:i===gl.onTouched});const sk="AsyncFunction";var hX=i=>!!i&&!!i.validate&&!!(_l(i.validate)&&i.validate.constructor.name===sk||ws(i.validate)&&Object.values(i.validate).find(o=>o.constructor.name===sk)),fX=i=>i.mount&&(i.required||i.min||i.max||i.maxLength||i.minLength||i.pattern||i.validate),ok=(i,o,c)=>!c&&(o.watchAll||o.watch.has(i)||[...o.watch].some(m=>i.startsWith(m)&&/^\.\w+/.test(i.slice(m.length))));const cy=(i,o,c,m)=>{for(const v of c||Object.keys(i)){const E=Pi(i,v);if(E){const{_f:I,...s}=E;if(I){if(I.refs&&I.refs[0]&&o(I.refs[0],v)&&!m)return!0;if(I.ref&&o(I.ref,I.name)&&!m)return!0;if(cy(s,o))break}else if(ws(s)&&cy(s,o))break}}};function ak(i,o,c){const m=Pi(i,c);if(m||zw(c))return{error:m,name:c};const v=c.split(".");for(;v.length;){const E=v.join("."),I=Pi(o,E),s=Pi(i,E);if(I&&!Array.isArray(I)&&c!==E)return{name:c};if(s&&s.type)return{name:E,error:s};if(s&&s.root&&s.root.type)return{name:`${E}.root`,error:s.root};v.pop()}return{name:c}}var pX=(i,o,c,m)=>{c(i);const{name:v,...E}=i;return sa(E)||Object.keys(E).length>=Object.keys(o).length||Object.keys(E).find(I=>o[I]===(!m||gl.all))},mX=(i,o,c)=>!i||!o||i===o||ly(i).some(m=>m&&(c?m===o:m.startsWith(o)||o.startsWith(m))),gX=(i,o,c,m,v)=>v.isOnAll?!1:!c&&v.isOnTouch?!(o||i):(c?m.isOnBlur:v.isOnBlur)?!i:(c?m.isOnChange:v.isOnChange)?i:!0,_X=(i,o)=>!$C(Pi(i,o)).length&&Ps(i,o),yX=(i,o,c)=>{const m=ly(Pi(i,c));return qr(m,"root",o[c]),qr(i,c,m),i},K0=i=>lc(i);function lk(i,o,c="validate"){if(K0(i)||Array.isArray(i)&&i.every(K0)||ba(i)&&!i)return{type:c,message:K0(i)?i:"",ref:o}}var kp=i=>ws(i)&&!O1(i)?i:{value:i,message:""},ck=async(i,o,c,m,v,E)=>{const{ref:I,refs:s,required:O,maxLength:j,minLength:G,min:W,max:B,pattern:te,validate:ue,name:J,valueAsNumber:ce,mount:oe}=i._f,ee=Pi(c,J);if(!oe||o.has(J))return{};const Q=s?s[0]:I,Ie=Dt=>{v&&Q.reportValidity&&(Q.setCustomValidity(ba(Dt)?"":Dt||""),Q.reportValidity())},pe={},Ke=XC(I),et=nx(I),at=Ke||et,Xt=(ce||ZC(I))&&ys(I.value)&&ys(ee)||L1(I)&&I.value===""||ee===""||Array.isArray(ee)&&!ee.length,Ct=aX.bind(null,J,m,pe),mt=(Dt,Kt,Pt,ti=Fc.maxLength,Nt=Fc.minLength)=>{const bi=Dt?Kt:Pt;pe[J]={type:Dt?ti:Nt,message:bi,ref:I,...Ct(Dt?ti:Nt,bi)}};if(E?!Array.isArray(ee)||!ee.length:O&&(!at&&(Xt||$o(ee))||ba(ee)&&!ee||et&&!YF(s).isValid||Ke&&!QF(s).isValid)){const{value:Dt,message:Kt}=K0(O)?{value:!!O,message:O}:kp(O);if(Dt&&(pe[J]={type:Fc.required,message:Kt,ref:Q,...Ct(Fc.required,Kt)},!m))return Ie(Kt),pe}if(!Xt&&(!$o(W)||!$o(B))){let Dt,Kt;const Pt=kp(B),ti=kp(W);if(!$o(ee)&&!isNaN(ee)){const Nt=I.valueAsNumber||ee&&+ee;$o(Pt.value)||(Dt=Nt>Pt.value),$o(ti.value)||(Kt=Nt<ti.value)}else{const Nt=I.valueAsDate||new Date(ee),bi=ii=>new Date(new Date().toDateString()+" "+ii),ot=I.type=="time",Tt=I.type=="week";lc(Pt.value)&&ee&&(Dt=ot?bi(ee)>bi(Pt.value):Tt?ee>Pt.value:Nt>new Date(Pt.value)),lc(ti.value)&&ee&&(Kt=ot?bi(ee)<bi(ti.value):Tt?ee<ti.value:Nt<new Date(ti.value))}if((Dt||Kt)&&(mt(!!Dt,Pt.message,ti.message,Fc.max,Fc.min),!m))return Ie(pe[J].message),pe}if((j||G)&&!Xt&&(lc(ee)||E&&Array.isArray(ee))){const Dt=kp(j),Kt=kp(G),Pt=!$o(Dt.value)&&ee.length>+Dt.value,ti=!$o(Kt.value)&&ee.length<+Kt.value;if((Pt||ti)&&(mt(Pt,Dt.message,Kt.message),!m))return Ie(pe[J].message),pe}if(te&&!Xt&&lc(ee)){const{value:Dt,message:Kt}=kp(te);if(O1(Dt)&&!ee.match(Dt)&&(pe[J]={type:Fc.pattern,message:Kt,ref:I,...Ct(Fc.pattern,Kt)},!m))return Ie(Kt),pe}if(ue){if(_l(ue)){const Dt=await ue(ee,c),Kt=lk(Dt,Q);if(Kt&&(pe[J]={...Kt,...Ct(Fc.validate,Kt.message)},!m))return Ie(Kt.message),pe}else if(ws(ue)){let Dt={};for(const Kt in ue){if(!sa(Dt)&&!m)break;const Pt=lk(await ue[Kt](ee,c),Q,Kt);Pt&&(Dt={...Pt,...Ct(Kt,Pt.message)},Ie(Pt.message),m&&(pe[J]=Dt))}if(!sa(Dt)&&(pe[J]={ref:Q,...Dt},!m))return pe}}return Ie(!0),pe};const xX={mode:gl.onSubmit,reValidateMode:gl.onChange,shouldFocusError:!0};function vX(i={}){let o={...xX,...i},c={submitCount:0,isDirty:!1,isReady:!1,isLoading:_l(o.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:o.errors||{},disabled:o.disabled||!1},m={},v=ws(o.defaultValues)||ws(o.values)?Bs(o.defaultValues||o.values)||{}:{},E=o.shouldUnregister?{}:Bs(v),I={action:!1,mount:!1,watch:!1},s={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},O,j=0;const G={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let W={...G};const B={array:QD(),state:QD()},te=o.criteriaMode===gl.all,ue=Ge=>rt=>{clearTimeout(j),j=setTimeout(Ge,rt)},J=async Ge=>{if(!o.disabled&&(G.isValid||W.isValid||Ge)){const rt=o.resolver?sa((await et()).errors):await Xt(m,!0);rt!==c.isValid&&B.state.next({isValid:rt})}},ce=(Ge,rt)=>{!o.disabled&&(G.isValidating||G.validatingFields||W.isValidating||W.validatingFields)&&((Ge||Array.from(s.mount)).forEach(Rt=>{Rt&&(rt?qr(c.validatingFields,Rt,rt):Ps(c.validatingFields,Rt))}),B.state.next({validatingFields:c.validatingFields,isValidating:!sa(c.validatingFields)}))},oe=(Ge,rt=[],Rt,fi,di=!0,ri=!0)=>{if(fi&&Rt&&!o.disabled){if(I.action=!0,ri&&Array.isArray(Pi(m,Ge))){const Ci=Rt(Pi(m,Ge),fi.argA,fi.argB);di&&qr(m,Ge,Ci)}if(ri&&Array.isArray(Pi(c.errors,Ge))){const Ci=Rt(Pi(c.errors,Ge),fi.argA,fi.argB);di&&qr(c.errors,Ge,Ci),_X(c.errors,Ge)}if((G.touchedFields||W.touchedFields)&&ri&&Array.isArray(Pi(c.touchedFields,Ge))){const Ci=Rt(Pi(c.touchedFields,Ge),fi.argA,fi.argB);di&&qr(c.touchedFields,Ge,Ci)}(G.dirtyFields||W.dirtyFields)&&(c.dirtyFields=U_(v,E)),B.state.next({name:Ge,isDirty:mt(Ge,rt),dirtyFields:c.dirtyFields,errors:c.errors,isValid:c.isValid})}else qr(E,Ge,rt)},ee=(Ge,rt)=>{qr(c.errors,Ge,rt),B.state.next({errors:c.errors})},Q=Ge=>{c.errors=Ge,B.state.next({errors:c.errors,isValid:!1})},Ie=(Ge,rt,Rt,fi)=>{const di=Pi(m,Ge);if(di){const ri=Pi(E,Ge,ys(Rt)?Pi(v,Ge):Rt);ys(ri)||fi&&fi.defaultChecked||rt?qr(E,Ge,rt?ri:nk(di._f)):Pt(Ge,ri),I.mount&&J()}},pe=(Ge,rt,Rt,fi,di)=>{let ri=!1,Ci=!1;const an={name:Ge};if(!o.disabled){if(!Rt||fi){(G.isDirty||W.isDirty)&&(Ci=c.isDirty,c.isDirty=an.isDirty=mt(),ri=Ci!==an.isDirty);const Jn=Uc(Pi(v,Ge),rt);Ci=!!Pi(c.dirtyFields,Ge),Jn?Ps(c.dirtyFields,Ge):qr(c.dirtyFields,Ge,!0),an.dirtyFields=c.dirtyFields,ri=ri||(G.dirtyFields||W.dirtyFields)&&Ci!==!Jn}if(Rt){const Jn=Pi(c.touchedFields,Ge);Jn||(qr(c.touchedFields,Ge,Rt),an.touchedFields=c.touchedFields,ri=ri||(G.touchedFields||W.touchedFields)&&Jn!==Rt)}ri&&di&&B.state.next(an)}return ri?an:{}},Ke=(Ge,rt,Rt,fi)=>{const di=Pi(c.errors,Ge),ri=(G.isValid||W.isValid)&&ba(rt)&&c.isValid!==rt;if(o.delayError&&Rt?(O=ue(()=>ee(Ge,Rt)),O(o.delayError)):(clearTimeout(j),O=null,Rt?qr(c.errors,Ge,Rt):Ps(c.errors,Ge)),(Rt?!Uc(di,Rt):di)||!sa(fi)||ri){const Ci={...fi,...ri&&ba(rt)?{isValid:rt}:{},errors:c.errors,name:Ge};c={...c,...Ci},B.state.next(Ci)}},et=async Ge=>{ce(Ge,!0);const rt=await o.resolver(E,o.context,dX(Ge||s.mount,m,o.criteriaMode,o.shouldUseNativeValidation));return ce(Ge),rt},at=async Ge=>{const{errors:rt}=await et(Ge);if(Ge)for(const Rt of Ge){const fi=Pi(rt,Rt);fi?qr(c.errors,Rt,fi):Ps(c.errors,Rt)}else c.errors=rt;return rt},Xt=async(Ge,rt,Rt={valid:!0})=>{for(const fi in Ge){const di=Ge[fi];if(di){const{_f:ri,...Ci}=di;if(ri){const an=s.array.has(ri.name),Jn=di._f&&hX(di._f);Jn&&G.validatingFields&&ce([fi],!0);const br=await ck(di,s.disabled,E,te,o.shouldUseNativeValidation&&!rt,an);if(Jn&&G.validatingFields&&ce([fi]),br[ri.name]&&(Rt.valid=!1,rt))break;!rt&&(Pi(br,ri.name)?an?yX(c.errors,br,ri.name):qr(c.errors,ri.name,br[ri.name]):Ps(c.errors,ri.name))}!sa(Ci)&&await Xt(Ci,rt,Rt)}}return Rt.valid},Ct=()=>{for(const Ge of s.unMount){const rt=Pi(m,Ge);rt&&(rt._f.refs?rt._f.refs.every(Rt=>!MS(Rt)):!MS(rt._f.ref))&&ni(Ge)}s.unMount=new Set},mt=(Ge,rt)=>!o.disabled&&(Ge&&rt&&qr(E,Ge,rt),!Uc(ii(),v)),Dt=(Ge,rt,Rt)=>WF(Ge,s,{...I.mount?E:ys(rt)?v:lc(Ge)?{[Ge]:rt}:rt},Rt,rt),Kt=Ge=>$C(Pi(I.mount?E:v,Ge,o.shouldUnregister?Pi(v,Ge,[]):[])),Pt=(Ge,rt,Rt={})=>{const fi=Pi(m,Ge);let di=rt;if(fi){const ri=fi._f;ri&&(!ri.disabled&&qr(E,Ge,JF(rt,ri)),di=L1(ri.ref)&&$o(rt)?"":rt,ZF(ri.ref)?[...ri.ref.options].forEach(Ci=>Ci.selected=di.includes(Ci.value)):ri.refs?nx(ri.ref)?ri.refs.forEach(Ci=>{(!Ci.defaultChecked||!Ci.disabled)&&(Array.isArray(di)?Ci.checked=!!di.find(an=>an===Ci.value):Ci.checked=di===Ci.value||!!di)}):ri.refs.forEach(Ci=>Ci.checked=Ci.value===di):ZC(ri.ref)?ri.ref.value="":(ri.ref.value=di,ri.ref.type||B.state.next({name:Ge,values:Bs(E)})))}(Rt.shouldDirty||Rt.shouldTouch)&&pe(Ge,di,Rt.shouldTouch,Rt.shouldDirty,!0),Rt.shouldValidate&&Tt(Ge)},ti=(Ge,rt,Rt)=>{for(const fi in rt){if(!rt.hasOwnProperty(fi))return;const di=rt[fi],ri=Ge+"."+fi,Ci=Pi(m,ri);(s.array.has(Ge)||ws(di)||Ci&&!Ci._f)&&!Vh(di)?ti(ri,di,Rt):Pt(ri,di,Rt)}},Nt=(Ge,rt,Rt={})=>{const fi=Pi(m,Ge),di=s.array.has(Ge),ri=Bs(rt);qr(E,Ge,ri),di?(B.array.next({name:Ge,values:Bs(E)}),(G.isDirty||G.dirtyFields||W.isDirty||W.dirtyFields)&&Rt.shouldDirty&&B.state.next({name:Ge,dirtyFields:U_(v,E),isDirty:mt(Ge,ri)})):fi&&!fi._f&&!$o(ri)?ti(Ge,ri,Rt):Pt(Ge,ri,Rt),ok(Ge,s)&&B.state.next({...c,name:Ge}),B.state.next({name:I.mount?Ge:void 0,values:Bs(E)})},bi=async Ge=>{I.mount=!0;const rt=Ge.target;let Rt=rt.name,fi=!0;const di=Pi(m,Rt),ri=Jn=>{fi=Number.isNaN(Jn)||Vh(Jn)&&isNaN(Jn.getTime())||Uc(Jn,Pi(E,Rt,Jn))},Ci=rk(o.mode),an=rk(o.reValidateMode);if(di){let Jn,br;const mo=rt.type?nk(di._f):$F(Ge),Ar=Ge.type===N1.BLUR||Ge.type===N1.FOCUS_OUT,Ss=!fX(di._f)&&!o.resolver&&!Pi(c.errors,Rt)&&!di._f.deps||gX(Ar,Pi(c.touchedFields,Rt),c.isSubmitted,an,Ci),io=ok(Rt,s,Ar);qr(E,Rt,mo),Ar?(!rt||!rt.readOnly)&&(di._f.onBlur&&di._f.onBlur(Ge),O&&O(0)):di._f.onChange&&di._f.onChange(Ge);const no=pe(Rt,mo,Ar),go=!sa(no)||io;if(!Ar&&B.state.next({name:Rt,type:Ge.type,values:Bs(E)}),Ss)return(G.isValid||W.isValid)&&(o.mode==="onBlur"?Ar&&J():Ar||J()),go&&B.state.next({name:Rt,...io?{}:no});if(!Ar&&io&&B.state.next({...c}),o.resolver){const{errors:as}=await et([Rt]);if(ri(mo),fi){const Ra=ak(c.errors,m,Rt),yi=ak(as,m,Ra.name||Rt);Jn=yi.error,Rt=yi.name,br=sa(as)}}else ce([Rt],!0),Jn=(await ck(di,s.disabled,E,te,o.shouldUseNativeValidation))[Rt],ce([Rt]),ri(mo),fi&&(Jn?br=!1:(G.isValid||W.isValid)&&(br=await Xt(m,!0)));fi&&(di._f.deps&&Tt(di._f.deps),Ke(Rt,br,Jn,no))}},ot=(Ge,rt)=>{if(Pi(c.errors,rt)&&Ge.focus)return Ge.focus(),1},Tt=async(Ge,rt={})=>{let Rt,fi;const di=ly(Ge);if(o.resolver){const ri=await at(ys(Ge)?Ge:di);Rt=sa(ri),fi=Ge?!di.some(Ci=>Pi(ri,Ci)):Rt}else Ge?(fi=(await Promise.all(di.map(async ri=>{const Ci=Pi(m,ri);return await Xt(Ci&&Ci._f?{[ri]:Ci}:Ci)}))).every(Boolean),!(!fi&&!c.isValid)&&J()):fi=Rt=await Xt(m);return B.state.next({...!lc(Ge)||(G.isValid||W.isValid)&&Rt!==c.isValid?{}:{name:Ge},...o.resolver||!Ge?{isValid:Rt}:{},errors:c.errors}),rt.shouldFocus&&!fi&&cy(m,ot,Ge?di:s.mount),fi},ii=Ge=>{const rt={...I.mount?E:v};return ys(Ge)?rt:lc(Ge)?Pi(rt,Ge):Ge.map(Rt=>Pi(rt,Rt))},jt=(Ge,rt)=>({invalid:!!Pi((rt||c).errors,Ge),isDirty:!!Pi((rt||c).dirtyFields,Ge),error:Pi((rt||c).errors,Ge),isValidating:!!Pi(c.validatingFields,Ge),isTouched:!!Pi((rt||c).touchedFields,Ge)}),gi=Ge=>{Ge&&ly(Ge).forEach(rt=>Ps(c.errors,rt)),B.state.next({errors:Ge?c.errors:{}})},en=(Ge,rt,Rt)=>{const fi=(Pi(m,Ge,{_f:{}})._f||{}).ref,di=Pi(c.errors,Ge)||{},{ref:ri,message:Ci,type:an,...Jn}=di;qr(c.errors,Ge,{...Jn,...rt,ref:fi}),B.state.next({name:Ge,errors:c.errors,isValid:!1}),Rt&&Rt.shouldFocus&&fi&&fi.focus&&fi.focus()},Dn=(Ge,rt)=>_l(Ge)?B.state.subscribe({next:Rt=>"values"in Rt&&Ge(Dt(void 0,rt),Rt)}):Dt(Ge,rt,!0),ir=Ge=>B.state.subscribe({next:rt=>{mX(Ge.name,rt.name,Ge.exact)&&pX(rt,Ge.formState||G,bs,Ge.reRenderRoot)&&Ge.callback({values:{...E},...c,...rt,defaultValues:v})}}).unsubscribe,wi=Ge=>(I.mount=!0,W={...W,...Ge.formState},ir({...Ge,formState:W})),ni=(Ge,rt={})=>{for(const Rt of Ge?ly(Ge):s.mount)s.mount.delete(Rt),s.array.delete(Rt),rt.keepValue||(Ps(m,Rt),Ps(E,Rt)),!rt.keepError&&Ps(c.errors,Rt),!rt.keepDirty&&Ps(c.dirtyFields,Rt),!rt.keepTouched&&Ps(c.touchedFields,Rt),!rt.keepIsValidating&&Ps(c.validatingFields,Rt),!o.shouldUnregister&&!rt.keepDefaultValue&&Ps(v,Rt);B.state.next({values:Bs(E)}),B.state.next({...c,...rt.keepDirty?{isDirty:mt()}:{}}),!rt.keepIsValid&&J()},Fi=({disabled:Ge,name:rt})=>{(ba(Ge)&&I.mount||Ge||s.disabled.has(rt))&&(Ge?s.disabled.add(rt):s.disabled.delete(rt))},nn=(Ge,rt={})=>{let Rt=Pi(m,Ge);const fi=ba(rt.disabled)||ba(o.disabled);return qr(m,Ge,{...Rt||{},_f:{...Rt&&Rt._f?Rt._f:{ref:{name:Ge}},name:Ge,mount:!0,...rt}}),s.mount.add(Ge),Rt?Fi({disabled:ba(rt.disabled)?rt.disabled:o.disabled,name:Ge}):Ie(Ge,!0,rt.value),{...fi?{disabled:rt.disabled||o.disabled}:{},...o.progressive?{required:!!rt.required,min:G_(rt.min),max:G_(rt.max),minLength:G_(rt.minLength),maxLength:G_(rt.maxLength),pattern:G_(rt.pattern)}:{},name:Ge,onChange:bi,onBlur:bi,ref:di=>{if(di){nn(Ge,rt),Rt=Pi(m,Ge);const ri=ys(di.value)&&di.querySelectorAll&&di.querySelectorAll("input,select,textarea")[0]||di,Ci=lX(ri),an=Rt._f.refs||[];if(Ci?an.find(Jn=>Jn===ri):ri===Rt._f.ref)return;qr(m,Ge,{_f:{...Rt._f,...Ci?{refs:[...an.filter(MS),ri,...Array.isArray(Pi(v,Ge))?[{}]:[]],ref:{type:ri.type,name:Ge}}:{ref:ri}}}),Ie(Ge,!1,void 0,ri)}else Rt=Pi(m,Ge,{}),Rt._f&&(Rt._f.mount=!1),(o.shouldUnregister||rt.shouldUnregister)&&!(HF(s.array,Ge)&&I.action)&&s.unMount.add(Ge)}}},Ri=()=>o.shouldFocusError&&cy(m,ot,s.mount),kn=Ge=>{ba(Ge)&&(B.state.next({disabled:Ge}),cy(m,(rt,Rt)=>{const fi=Pi(m,Rt);fi&&(rt.disabled=fi._f.disabled||Ge,Array.isArray(fi._f.refs)&&fi._f.refs.forEach(di=>{di.disabled=fi._f.disabled||Ge}))},0,!1))},Cn=(Ge,rt)=>async Rt=>{let fi;Rt&&(Rt.preventDefault&&Rt.preventDefault(),Rt.persist&&Rt.persist());let di=Bs(E);if(B.state.next({isSubmitting:!0}),o.resolver){const{errors:ri,values:Ci}=await et();c.errors=ri,di=Bs(Ci)}else await Xt(m);if(s.disabled.size)for(const ri of s.disabled)Ps(di,ri);if(Ps(c.errors,"root"),sa(c.errors)){B.state.next({errors:{}});try{await Ge(di,Rt)}catch(ri){fi=ri}}else rt&&await rt({...c.errors},Rt),Ri(),setTimeout(Ri);if(B.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:sa(c.errors)&&!fi,submitCount:c.submitCount+1,errors:c.errors}),fi)throw fi},Zr=(Ge,rt={})=>{Pi(m,Ge)&&(ys(rt.defaultValue)?Nt(Ge,Bs(Pi(v,Ge))):(Nt(Ge,rt.defaultValue),qr(v,Ge,Bs(rt.defaultValue))),rt.keepTouched||Ps(c.touchedFields,Ge),rt.keepDirty||(Ps(c.dirtyFields,Ge),c.isDirty=rt.defaultValue?mt(Ge,Bs(Pi(v,Ge))):mt()),rt.keepError||(Ps(c.errors,Ge),G.isValid&&J()),B.state.next({...c}))},wr=(Ge,rt={})=>{const Rt=Ge?Bs(Ge):v,fi=Bs(Rt),di=sa(Ge),ri=di?v:fi;if(rt.keepDefaultValues||(v=Rt),!rt.keepValues){if(rt.keepDirtyValues){const Ci=new Set([...s.mount,...Object.keys(U_(v,E))]);for(const an of Array.from(Ci))Pi(c.dirtyFields,an)?qr(ri,an,Pi(E,an)):Nt(an,Pi(ri,an))}else{if(GC&&ys(Ge))for(const Ci of s.mount){const an=Pi(m,Ci);if(an&&an._f){const Jn=Array.isArray(an._f.refs)?an._f.refs[0]:an._f.ref;if(L1(Jn)){const br=Jn.closest("form");if(br){br.reset();break}}}}if(rt.keepFieldsRef)for(const Ci of s.mount)Nt(Ci,Pi(ri,Ci));else m={}}E=o.shouldUnregister?rt.keepDefaultValues?Bs(v):{}:Bs(ri),B.array.next({values:{...ri}}),B.state.next({values:{...ri}})}s={mount:rt.keepDirtyValues?s.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},I.mount=!G.isValid||!!rt.keepIsValid||!!rt.keepDirtyValues,I.watch=!!o.shouldUnregister,B.state.next({submitCount:rt.keepSubmitCount?c.submitCount:0,isDirty:di?!1:rt.keepDirty?c.isDirty:!!(rt.keepDefaultValues&&!Uc(Ge,v)),isSubmitted:rt.keepIsSubmitted?c.isSubmitted:!1,dirtyFields:di?{}:rt.keepDirtyValues?rt.keepDefaultValues&&E?U_(v,E):c.dirtyFields:rt.keepDefaultValues&&Ge?U_(v,Ge):rt.keepDirty?c.dirtyFields:{},touchedFields:rt.keepTouched?c.touchedFields:{},errors:rt.keepErrors?c.errors:{},isSubmitSuccessful:rt.keepIsSubmitSuccessful?c.isSubmitSuccessful:!1,isSubmitting:!1,defaultValues:v})},On=(Ge,rt)=>wr(_l(Ge)?Ge(E):Ge,rt),gr=(Ge,rt={})=>{const Rt=Pi(m,Ge),fi=Rt&&Rt._f;if(fi){const di=fi.refs?fi.refs[0]:fi.ref;di.focus&&(di.focus(),rt.shouldSelect&&_l(di.select)&&di.select())}},bs=Ge=>{c={...c,...Ge}},_r={control:{register:nn,unregister:ni,getFieldState:jt,handleSubmit:Cn,setError:en,_subscribe:ir,_runSchema:et,_focusError:Ri,_getWatch:Dt,_getDirty:mt,_setValid:J,_setFieldArray:oe,_setDisabledField:Fi,_setErrors:Q,_getFieldArray:Kt,_reset:wr,_resetDefaultValues:()=>_l(o.defaultValues)&&o.defaultValues().then(Ge=>{On(Ge,o.resetOptions),B.state.next({isLoading:!1})}),_removeUnmounted:Ct,_disableForm:kn,_subjects:B,_proxyFormState:G,get _fields(){return m},get _formValues(){return E},get _state(){return I},set _state(Ge){I=Ge},get _defaultValues(){return v},get _names(){return s},set _names(Ge){s=Ge},get _formState(){return c},get _options(){return o},set _options(Ge){o={...o,...Ge}}},subscribe:wi,trigger:Tt,register:nn,handleSubmit:Cn,watch:Dn,setValue:Nt,getValues:ii,reset:On,resetField:Zr,clearErrors:gi,unregister:ni,setError:en,setFocus:gr,getFieldState:jt};return{..._r,formControl:_r}}function KC(i={}){const o=Vt.useRef(void 0),c=Vt.useRef(void 0),[m,v]=Vt.useState({isDirty:!1,isValidating:!1,isLoading:_l(i.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:i.errors||{},disabled:i.disabled||!1,isReady:!1,defaultValues:_l(i.defaultValues)?void 0:i.defaultValues});if(!o.current)if(i.formControl)o.current={...i.formControl,formState:m},i.defaultValues&&!_l(i.defaultValues)&&i.formControl.reset(i.defaultValues,i.resetOptions);else{const{formControl:I,...s}=vX(i);o.current={...s,formState:m}}const E=o.current.control;return E._options=i,WC(()=>{const I=E._subscribe({formState:E._proxyFormState,callback:()=>v({...E._formState}),reRenderRoot:!0});return v(s=>({...s,isReady:!0})),E._formState.isReady=!0,I},[E]),Vt.useEffect(()=>E._disableForm(i.disabled),[E,i.disabled]),Vt.useEffect(()=>{i.mode&&(E._options.mode=i.mode),i.reValidateMode&&(E._options.reValidateMode=i.reValidateMode)},[E,i.mode,i.reValidateMode]),Vt.useEffect(()=>{i.errors&&(E._setErrors(i.errors),E._focusError())},[E,i.errors]),Vt.useEffect(()=>{i.shouldUnregister&&E._subjects.state.next({values:E._getWatch()})},[E,i.shouldUnregister]),Vt.useEffect(()=>{if(E._proxyFormState.isDirty){const I=E._getDirty();I!==m.isDirty&&E._subjects.state.next({isDirty:I})}},[E,m.isDirty]),Vt.useEffect(()=>{i.values&&!Uc(i.values,c.current)?(E._reset(i.values,{keepFieldsRef:!0,...E._options.resetOptions}),c.current=i.values,v(I=>({...I}))):E._resetDefaultValues()},[E,i.values]),Vt.useEffect(()=>{E._state.mount||(E._setValid(),E._state.mount=!0),E._state.watch&&(E._state.watch=!1,E._subjects.state.next({...E._formState})),E._removeUnmounted()}),o.current.formState=qF(m,E),o.current}const YC=iX,ej=V.createContext({}),Us=({...i})=>x.jsx(ej.Provider,{value:{name:i.name},children:x.jsx(oX,{...i})}),Fw=()=>{const i=V.useContext(ej),o=V.useContext(tj),{getFieldState:c,formState:m}=Ow(),v=c(i.name,m);if(!i)throw new Error("useFormField should be used within <FormField>");const{id:E}=o;return{id:E,name:i.name,formItemId:`${E}-form-item`,formDescriptionId:`${E}-form-item-description`,formMessageId:`${E}-form-item-message`,...v}},tj=V.createContext({}),Ms=V.forwardRef(({className:i,...o},c)=>{const m=V.useId();return x.jsx(tj.Provider,{value:{id:m},children:x.jsx("div",{ref:c,className:ui("space-y-2",i),...o})})});Ms.displayName="FormItem";const Rs=V.forwardRef(({className:i,...o},c)=>{const{error:m,formItemId:v}=Fw();return x.jsx(En,{ref:c,className:ui(m&&"text-destructive",i),htmlFor:v,...o})});Rs.displayName="FormLabel";const Ds=V.forwardRef(({...i},o)=>{const{error:c,formItemId:m,formDescriptionId:v,formMessageId:E}=Fw();return x.jsx(da,{ref:o,id:m,"aria-describedby":c?`${v} ${E}`:`${v}`,"aria-invalid":!!c,...i})});Ds.displayName="FormControl";const wX=V.forwardRef(({className:i,...o},c)=>{const{formDescriptionId:m}=Fw();return x.jsx("p",{ref:c,id:m,className:ui("text-sm text-muted-foreground",i),...o})});wX.displayName="FormDescription";const Js=V.forwardRef(({className:i,children:o,...c},m)=>{const{error:v,formMessageId:E}=Fw(),I=v?String(v==null?void 0:v.message):o;return I?x.jsx("p",{ref:m,id:E,className:ui("text-sm font-medium text-destructive",i),...c,children:I}):null});Js.displayName="FormMessage";const uk=[{id:"1",name:"Chicken Breast",description:"Boneless chicken breast, perfect for grilling",pricePerKg:500,minKg:.5,image:"https://images.unsplash.com/photo-1604503468506-a8da13d82791?w=400",categoryId:"1",inStock:!0,createdAt:"2024-01-01",updatedAt:"2024-01-01"},{id:"2",name:"Mutton Leg",description:"Fresh mutton leg, ideal for curries",pricePerKg:500,minKg:1,image:"https://images.unsplash.com/photo-1529692236671-f1f6cf9683ba?w=400",categoryId:"2",inStock:!0,createdAt:"2024-01-01",updatedAt:"2024-01-01"},{id:"3",name:"Fish Fillet",description:"Fresh fish fillet, ready to cook",pricePerKg:420,minKg:.5,image:"https://images.unsplash.com/photo-1544943910-4c1dc44aab44?w=400",categoryId:"3",inStock:!1,createdAt:"2024-01-01",updatedAt:"2024-01-01"},{id:"4",name:"Beef Steak",description:"Premium beef steak cuts",pricePerKg:500,minKg:.5,image:"https://images.unsplash.com/photo-1588347818113-0c3d626ca2db?w=400",categoryId:"4",inStock:!0,createdAt:"2024-01-01",updatedAt:"2024-01-01"}],bX=()=>{const[i,o]=V.useState(!0),[c,m]=V.useState([]),[v,E]=V.useState(""),[I,s]=V.useState([]),[O,j]=V.useState(!1),[G,W]=V.useState(null),{toast:B}=ha(),te=KC();V.useEffect(()=>{(async()=>{o(!0),await new Promise(Ie=>setTimeout(Ie,1e3)),m(uk),s(uk),o(!1)})()},[]),V.useEffect(()=>{const Q=c.filter(Ie=>Ie.name.toLowerCase().includes(v.toLowerCase())||Ie.description.toLowerCase().includes(v.toLowerCase()));s(Q)},[v,c]);const ue=Q=>{if(G)m(Ie=>Ie.map(pe=>pe.id===G.id?{...pe,...Q}:pe)),B({title:"Meat Updated",description:`${Q.name} has been updated successfully`,position:"top-center"});else{const Ie={id:Date.now().toString(),...Q,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};m(pe=>[...pe,Ie]),B({title:"Meat Added",description:`${Q.name} has been added successfully`,position:"top-center"})}j(!1),W(null),te.reset()},J=Q=>{W(Q),te.reset({name:Q.name,description:Q.description,pricePerKg:Q.pricePerKg,minKg:Q.minKg,image:Q.image,categoryId:Q.categoryId,inStock:Q.inStock}),j(!0)},ce=()=>{W(null),te.reset({name:"",description:"",pricePerKg:0,minKg:.5,image:"",categoryId:"",inStock:!0}),j(!0)},oe=Q=>{m(Ie=>Ie.map(pe=>pe.id===Q?{...pe,inStock:!pe.inStock}:pe)),B({title:"Stock Status Updated",description:"Meat stock status has been updated successfully",position:"top-center"})},ee=(Q,Ie)=>{m(pe=>pe.filter(Ke=>Ke.id!==Q)),B({title:"Meat Deleted",description:`${Ie} has been deleted successfully`,position:"top-center"})};return i?x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"flex justify-between items-center",children:[x.jsx(Cr,{className:"h-8 w-48"}),x.jsx(Cr,{className:"h-10 w-32"})]}),x.jsxs($i,{children:[x.jsx(dr,{children:x.jsx(Cr,{className:"h-6 w-32"})}),x.jsx(Hi,{children:x.jsx("div",{className:"space-y-4",children:[...Array(5)].map((Q,Ie)=>x.jsx(Cr,{className:"h-16 w-full"},Ie))})})]})]}):x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"flex justify-between items-center",children:[x.jsxs("div",{children:[x.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Manage Meats"}),x.jsx("p",{className:"text-muted-foreground",children:"Add, edit, and manage your meat inventory"})]}),x.jsxs(Lw,{open:O,onOpenChange:j,children:[x.jsx(UC,{asChild:!0,children:x.jsxs(Si,{variant:"meat",onClick:ce,children:[x.jsx(bl,{className:"h-4 w-4 mr-2"}),"Add New Meat"]})}),x.jsxs(ex,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:[x.jsx(tx,{children:x.jsx(ix,{children:G?"Edit Meat":"Add New Meat"})}),x.jsx(YC,{...te,children:x.jsxs("form",{onSubmit:te.handleSubmit(ue),className:"space-y-4",children:[x.jsx(Us,{control:te.control,name:"name",rules:{required:"Name is required"},render:({field:Q})=>x.jsxs(Ms,{children:[x.jsx(Rs,{children:"Meat Name"}),x.jsx(Ds,{children:x.jsx(tn,{placeholder:"e.g., Chicken Breast",...Q})}),x.jsx(Js,{})]})}),x.jsx(Us,{control:te.control,name:"description",rules:{required:"Description is required"},render:({field:Q})=>x.jsxs(Ms,{children:[x.jsx(Rs,{children:"Description"}),x.jsx(Ds,{children:x.jsx(tn,{placeholder:"e.g., Boneless, skinless, fresh",...Q})}),x.jsx(Js,{})]})}),x.jsx(Us,{control:te.control,name:"pricePerKg",rules:{required:"Price per kg is required",min:{value:1,message:"Price must be positive"}},render:({field:Q})=>x.jsxs(Ms,{children:[x.jsx(Rs,{children:"Price per Kg (₹)"}),x.jsx(Ds,{children:x.jsx(tn,{type:"number",min:1,step:1,placeholder:"e.g., 500",...Q})}),x.jsx(Js,{})]})}),x.jsx(Us,{control:te.control,name:"minKg",rules:{required:"Minimum weight is required",min:{value:.1,message:"Min weight must be positive"}},render:({field:Q})=>x.jsxs(Ms,{children:[x.jsx(Rs,{children:"Minimum Weight (kg)"}),x.jsx(Ds,{children:x.jsx(tn,{type:"number",min:.1,step:.1,placeholder:"e.g., 0.5",...Q})}),x.jsx(Js,{})]})}),x.jsx(Us,{control:te.control,name:"image",rules:{required:"Image URL is required"},render:({field:Q})=>x.jsxs(Ms,{children:[x.jsx(Rs,{children:"Image URL"}),x.jsx(Ds,{children:x.jsx(tn,{placeholder:"Paste image URL here",...Q})}),x.jsx(Js,{})]})}),x.jsx(Us,{control:te.control,name:"categoryId",rules:{required:"Category is required"},render:({field:Q})=>x.jsxs(Ms,{children:[x.jsx(Rs,{children:"Category"}),x.jsx(Ds,{children:x.jsx(tn,{placeholder:"e.g., 1 for Chicken, 2 for Mutton, etc.",...Q})}),x.jsx(Js,{})]})}),x.jsx(Us,{control:te.control,name:"inStock",render:({field:Q})=>x.jsxs(Ms,{children:[x.jsx(Rs,{children:"In Stock"}),x.jsx(Ds,{children:x.jsx(xm,{checked:Q.value,onCheckedChange:Q.onChange})}),x.jsx(Js,{})]})}),x.jsxs("div",{className:"flex gap-2 pt-4",children:[x.jsxs(Si,{type:"submit",variant:"meat",className:"flex-1",children:[G?"Update":"Add"," Meat"]}),x.jsx(Si,{type:"button",variant:"outline",onClick:()=>j(!1),children:"Cancel"})]})]})})]})]})]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[x.jsx($i,{children:x.jsxs(Hi,{className:"p-4",children:[x.jsx("div",{className:"text-2xl font-bold",children:c.length}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Meats"})]})}),x.jsx($i,{children:x.jsxs(Hi,{className:"p-4",children:[x.jsx("div",{className:"text-2xl font-bold text-success",children:c.filter(Q=>Q.inStock).length}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"In Stock"})]})}),x.jsx($i,{children:x.jsxs(Hi,{className:"p-4",children:[x.jsx("div",{className:"text-2xl font-bold text-destructive",children:c.filter(Q=>!Q.inStock).length}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"Out of Stock"})]})}),x.jsx($i,{children:x.jsxs(Hi,{className:"p-4",children:[x.jsxs("div",{className:"text-2xl font-bold",children:["₹",Math.round(c.reduce((Q,Ie)=>Q+Ie.pricePerKg,0)/c.length)]}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"Avg Price/kg"})]})})]}),x.jsxs($i,{children:[x.jsxs(dr,{children:[x.jsx(Mr,{children:"Meat Inventory"}),x.jsxs("div",{className:"flex gap-4",children:[x.jsxs("div",{className:"relative flex-1 max-w-md",children:[x.jsx(Am,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),x.jsx(tn,{placeholder:"Search meats...",value:v,onChange:Q=>E(Q.target.value),className:"pl-10"})]}),x.jsxs(Si,{variant:"outline",children:[x.jsx(lw,{className:"h-4 w-4 mr-2"}),"Filter"]})]})]}),x.jsxs(Hi,{children:[x.jsx("div",{className:"rounded-md border",children:x.jsxs(Zy,{children:[x.jsx(Xy,{children:x.jsxs(eu,{children:[x.jsx(kr,{className:"w-[100px]",children:"Image"}),x.jsx(kr,{children:"Name"}),x.jsx(kr,{children:"Price/kg"}),x.jsx(kr,{children:"Min Weight"}),x.jsx(kr,{children:"Status"}),x.jsx(kr,{children:"Category"}),x.jsx(kr,{className:"text-right",children:"Actions"})]})}),x.jsx(Ky,{children:I.map(Q=>x.jsxs(eu,{children:[x.jsx(Nr,{children:x.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden bg-gray-100",children:x.jsx("img",{src:Q.image,alt:Q.name,className:"w-full h-full object-cover"})})}),x.jsx(Nr,{children:x.jsxs("div",{children:[x.jsx("div",{className:"font-medium",children:Q.name}),x.jsx("div",{className:"text-sm text-muted-foreground line-clamp-1",children:Q.description})]})}),x.jsx(Nr,{children:x.jsxs("span",{className:"font-semibold",children:["₹",Q.pricePerKg]})}),x.jsxs(Nr,{children:[Q.minKg,"kg"]}),x.jsx(Nr,{children:x.jsx(es,{variant:Q.inStock?"default":"destructive",className:`cursor-pointer ${Q.inStock?"bg-success text-success-foreground":""}`,onClick:()=>oe(Q.id),children:Q.inStock?"In Stock":"Out of Stock"})}),x.jsx(Nr,{children:x.jsxs(es,{variant:"outline",children:["Category ",Q.categoryId]})}),x.jsx(Nr,{className:"text-right",children:x.jsxs(kw,{children:[x.jsx(Nw,{asChild:!0,children:x.jsx(Si,{variant:"ghost",size:"icon",children:x.jsx(aw,{className:"h-4 w-4"})})}),x.jsxs(Qy,{align:"end",children:[x.jsxs(Qs,{children:[x.jsx(Qh,{className:"h-4 w-4 mr-2"}),"View Details"]}),x.jsxs(Qs,{onClick:()=>J(Q),children:[x.jsx(Py,{className:"h-4 w-4 mr-2"}),"Edit"]}),x.jsxs(Qs,{onClick:()=>oe(Q.id),children:[x.jsx(es,{className:"h-4 w-4 mr-2"}),"Toggle Stock"]}),x.jsxs(Qs,{onClick:()=>ee(Q.id,Q.name),className:"text-destructive",children:[x.jsx(Hy,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})})]},Q.id))})]})}),I.length===0&&x.jsxs("div",{className:"text-center py-8",children:[x.jsx("p",{className:"text-muted-foreground",children:v?"No meats found matching your search.":"No meats added yet."}),!v&&x.jsxs(Si,{variant:"meat",className:"mt-4",children:[x.jsx(bl,{className:"h-4 w-4 mr-2"}),"Add Your First Meat"]})]})]})]})]})},JC=V.forwardRef(({className:i,...o},c)=>x.jsx("textarea",{className:ui("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i),ref:c,...o}));JC.displayName="Textarea";const dk=[{id:"1",name:"Chicken",description:"Fresh chicken products including breast, thighs, and whole chicken",image:"https://images.unsplash.com/photo-1604503468506-a8da13d82791?w=400",isActive:!0,createdAt:"2024-01-01",updatedAt:"2024-01-01"},{id:"2",name:"Mutton",description:"Premium mutton cuts for traditional recipes",image:"https://images.unsplash.com/photo-1529692236671-f1f6cf9683ba?w=400",isActive:!0,createdAt:"2024-01-01",updatedAt:"2024-01-01"},{id:"3",name:"Fish & Seafood",description:"Fresh fish fillets and seafood varieties",image:"https://images.unsplash.com/photo-1544943910-4c1dc44aab44?w=400",isActive:!0,createdAt:"2024-01-01",updatedAt:"2024-01-01"},{id:"4",name:"Beef",description:"Premium beef cuts and steaks",image:"https://images.unsplash.com/photo-1588347818113-0c3d626ca2db?w=400",isActive:!1,createdAt:"2024-01-01",updatedAt:"2024-01-01"}],SX=()=>{const[i,o]=V.useState(!0),[c,m]=V.useState([]),[v,E]=V.useState(""),[I,s]=V.useState([]),[O,j]=V.useState(!1),[G,W]=V.useState(null),{toast:B}=ha(),te=KC();V.useEffect(()=>{(async()=>{o(!0),await new Promise(Ie=>setTimeout(Ie,1e3)),m(dk),s(dk),o(!1)})()},[]),V.useEffect(()=>{const Q=c.filter(Ie=>Ie.name.toLowerCase().includes(v.toLowerCase())||Ie.description.toLowerCase().includes(v.toLowerCase()));s(Q)},[v,c]);const ue=Q=>{if(G)m(Ie=>Ie.map(pe=>pe.id===G.id?{...pe,...Q,updatedAt:new Date().toISOString()}:pe)),B({title:"Category Updated",description:`${Q.name} has been updated successfully`,position:"top-center"});else{const Ie={id:Date.now().toString(),...Q,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};m(pe=>[...pe,Ie]),B({title:"Category Added",description:`${Q.name} has been added successfully`,position:"top-center"})}j(!1),W(null),te.reset()},J=Q=>{W(Q),te.reset({name:Q.name,description:Q.description,image:Q.image,isActive:Q.isActive}),j(!0)},ce=Q=>{m(Ie=>Ie.map(pe=>pe.id===Q?{...pe,isActive:!pe.isActive}:pe)),B({title:"Category Status Updated",description:"Category status has been updated successfully",position:"top-center"})},oe=(Q,Ie)=>{m(pe=>pe.filter(Ke=>Ke.id!==Q)),B({title:"Category Deleted",description:`${Ie} has been deleted successfully`,position:"top-center"})},ee=()=>{W(null),te.reset({name:"",description:"",image:"",isActive:!0}),j(!0)};return i?x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"flex justify-between items-center",children:[x.jsx(Cr,{className:"h-8 w-48"}),x.jsx(Cr,{className:"h-10 w-32"})]}),x.jsxs($i,{children:[x.jsx(dr,{children:x.jsx(Cr,{className:"h-6 w-32"})}),x.jsx(Hi,{children:x.jsx("div",{className:"space-y-4",children:[...Array(5)].map((Q,Ie)=>x.jsx(Cr,{className:"h-16 w-full"},Ie))})})]})]}):x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"flex justify-between items-center",children:[x.jsxs("div",{children:[x.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Manage Categories"}),x.jsx("p",{className:"text-muted-foreground",children:"Organize your products into categories"})]}),x.jsxs(Lw,{open:O,onOpenChange:j,children:[x.jsx(UC,{asChild:!0,children:x.jsxs(Si,{variant:"meat",onClick:ee,children:[x.jsx(bl,{className:"h-4 w-4 mr-2"}),"Add New Category"]})}),x.jsxs(ex,{className:"max-w-md",children:[x.jsx(tx,{children:x.jsx(ix,{children:G?"Edit Category":"Add New Category"})}),x.jsx(YC,{...te,children:x.jsxs("form",{onSubmit:te.handleSubmit(ue),className:"space-y-4",children:[x.jsx(Us,{control:te.control,name:"name",rules:{required:"Category name is required"},render:({field:Q})=>x.jsxs(Ms,{children:[x.jsx(Rs,{children:"Category Name"}),x.jsx(Ds,{children:x.jsx(tn,{placeholder:"e.g., Chicken",...Q})}),x.jsx(Js,{})]})}),x.jsx(Us,{control:te.control,name:"description",rules:{required:"Description is required"},render:({field:Q})=>x.jsxs(Ms,{children:[x.jsx(Rs,{children:"Description"}),x.jsx(Ds,{children:x.jsx(JC,{placeholder:"Describe this category...",...Q})}),x.jsx(Js,{})]})}),x.jsx(Us,{control:te.control,name:"image",rules:{required:"Image URL is required"},render:({field:Q})=>x.jsxs(Ms,{children:[x.jsx(Rs,{children:"Image URL"}),x.jsx(Ds,{children:x.jsx(tn,{placeholder:"https://example.com/image.jpg",...Q})}),x.jsx(Js,{})]})}),x.jsx(Us,{control:te.control,name:"isActive",render:({field:Q})=>x.jsxs(Ms,{className:"flex items-center justify-between",children:[x.jsx(Rs,{children:"Active Status"}),x.jsx(Ds,{children:x.jsx(xm,{checked:Q.value,onCheckedChange:Q.onChange})})]})}),x.jsxs("div",{className:"flex gap-2 pt-4",children:[x.jsxs(Si,{type:"submit",variant:"meat",className:"flex-1",children:[G?"Update":"Add"," Category"]}),x.jsx(Si,{type:"button",variant:"outline",onClick:()=>j(!1),children:"Cancel"})]})]})})]})]})]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[x.jsx($i,{children:x.jsxs(Hi,{className:"p-4",children:[x.jsx("div",{className:"text-2xl font-bold",children:c.length}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Categories"})]})}),x.jsx($i,{children:x.jsxs(Hi,{className:"p-4",children:[x.jsx("div",{className:"text-2xl font-bold text-success",children:c.filter(Q=>Q.isActive).length}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"Active"})]})}),x.jsx($i,{children:x.jsxs(Hi,{className:"p-4",children:[x.jsx("div",{className:"text-2xl font-bold text-muted-foreground",children:c.filter(Q=>!Q.isActive).length}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"Inactive"})]})}),x.jsx($i,{children:x.jsxs(Hi,{className:"p-4",children:[x.jsxs("div",{className:"text-2xl font-bold",children:[Math.round(c.filter(Q=>Q.isActive).length/c.length*100)||0,"%"]}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"Active Rate"})]})})]}),x.jsxs($i,{children:[x.jsxs(dr,{children:[x.jsx(Mr,{children:"Categories"}),x.jsxs("div",{className:"flex gap-4",children:[x.jsxs("div",{className:"relative flex-1 max-w-md",children:[x.jsx(Am,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),x.jsx(tn,{placeholder:"Search categories...",value:v,onChange:Q=>E(Q.target.value),className:"pl-10"})]}),x.jsxs(Si,{variant:"outline",children:[x.jsx(lw,{className:"h-4 w-4 mr-2"}),"Filter"]})]})]}),x.jsxs(Hi,{children:[x.jsx("div",{className:"rounded-md border",children:x.jsxs(Zy,{children:[x.jsx(Xy,{children:x.jsxs(eu,{children:[x.jsx(kr,{className:"w-[100px]",children:"Image"}),x.jsx(kr,{children:"Name"}),x.jsx(kr,{children:"Description"}),x.jsx(kr,{children:"Status"}),x.jsx(kr,{children:"Created"}),x.jsx(kr,{className:"text-right",children:"Actions"})]})}),x.jsx(Ky,{children:I.map(Q=>x.jsxs(eu,{children:[x.jsx(Nr,{children:x.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden bg-gray-100",children:x.jsx("img",{src:Q.image,alt:Q.name,className:"w-full h-full object-cover"})})}),x.jsx(Nr,{children:x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx(DT,{className:"h-4 w-4 text-muted-foreground"}),x.jsx("span",{className:"font-medium",children:Q.name})]})}),x.jsx(Nr,{children:x.jsx("div",{className:"max-w-xs truncate text-sm text-muted-foreground",children:Q.description})}),x.jsx(Nr,{children:x.jsx(es,{variant:Q.isActive?"default":"secondary",className:`cursor-pointer ${Q.isActive?"bg-success text-success-foreground":""}`,onClick:()=>ce(Q.id),children:Q.isActive?"Active":"Inactive"})}),x.jsx(Nr,{children:x.jsx("div",{className:"text-sm text-muted-foreground",children:new Date(Q.createdAt).toLocaleDateString()})}),x.jsx(Nr,{className:"text-right",children:x.jsxs(kw,{children:[x.jsx(Nw,{asChild:!0,children:x.jsx(Si,{variant:"ghost",size:"icon",children:x.jsx(aw,{className:"h-4 w-4"})})}),x.jsxs(Qy,{align:"end",children:[x.jsxs(Qs,{children:[x.jsx(Qh,{className:"h-4 w-4 mr-2"}),"View Details"]}),x.jsxs(Qs,{onClick:()=>J(Q),children:[x.jsx(Py,{className:"h-4 w-4 mr-2"}),"Edit"]}),x.jsxs(Qs,{onClick:()=>ce(Q.id),children:[x.jsx(xm,{className:"h-4 w-4 mr-2"}),"Toggle Status"]}),x.jsxs(Qs,{onClick:()=>oe(Q.id,Q.name),className:"text-destructive",children:[x.jsx(Hy,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})})]},Q.id))})]})}),I.length===0&&x.jsxs("div",{className:"text-center py-8",children:[x.jsx(DT,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),x.jsx("p",{className:"text-muted-foreground mb-2",children:v?"No categories found matching your search.":"No categories added yet."}),!v&&x.jsxs(Si,{variant:"meat",onClick:ee,children:[x.jsx(bl,{className:"h-4 w-4 mr-2"}),"Add Your First Category"]})]})]})]})]})};function hk(i,[o,c]){return Math.min(c,Math.max(o,i))}var TX=[" ","Enter","ArrowUp","ArrowDown"],EX=[" ","Enter"],rx="Select",[jw,Bw,CX]=rw(rx),[Dm,TK]=iu(rx,[CX,Rm]),Vw=Rm(),[AX,zd]=Dm(rx),[IX,PX]=Dm(rx),ij=i=>{const{__scopeSelect:o,children:c,open:m,defaultOpen:v,onOpenChange:E,value:I,defaultValue:s,onValueChange:O,dir:j,name:G,autoComplete:W,disabled:B,required:te,form:ue}=i,J=Vw(o),[ce,oe]=V.useState(null),[ee,Q]=V.useState(null),[Ie,pe]=V.useState(!1),Ke=Iw(j),[et=!1,at]=Yc({prop:m,defaultProp:v,onChange:E}),[Xt,Ct]=Yc({prop:I,defaultProp:s,onChange:O}),mt=V.useRef(null),Dt=ce?ue||!!ce.closest("form"):!0,[Kt,Pt]=V.useState(new Set),ti=Array.from(Kt).map(Nt=>Nt.props.value).join(";");return x.jsx(gC,{...J,children:x.jsxs(AX,{required:te,scope:o,trigger:ce,onTriggerChange:oe,valueNode:ee,onValueNodeChange:Q,valueNodeHasChildren:Ie,onValueNodeHasChildrenChange:pe,contentId:vl(),value:Xt,onValueChange:Ct,open:et,onOpenChange:at,dir:Ke,triggerPointerDownPosRef:mt,disabled:B,children:[x.jsx(jw.Provider,{scope:o,children:x.jsx(IX,{scope:i.__scopeSelect,onNativeOptionAdd:V.useCallback(Nt=>{Pt(bi=>new Set(bi).add(Nt))},[]),onNativeOptionRemove:V.useCallback(Nt=>{Pt(bi=>{const ot=new Set(bi);return ot.delete(Nt),ot})},[]),children:c})}),Dt?x.jsxs(Aj,{"aria-hidden":!0,required:te,tabIndex:-1,name:G,autoComplete:W,value:Xt,onChange:Nt=>Ct(Nt.target.value),disabled:B,form:ue,children:[Xt===void 0?x.jsx("option",{value:""}):null,Array.from(Kt)]},ti):null]})})};ij.displayName=rx;var nj="SelectTrigger",rj=V.forwardRef((i,o)=>{const{__scopeSelect:c,disabled:m=!1,...v}=i,E=Vw(c),I=zd(nj,c),s=I.disabled||m,O=vr(o,I.onTriggerChange),j=Bw(c),G=V.useRef("touch"),[W,B,te]=Ij(J=>{const ce=j().filter(Q=>!Q.disabled),oe=ce.find(Q=>Q.value===I.value),ee=Pj(ce,J,oe);ee!==void 0&&I.onValueChange(ee.value)}),ue=J=>{s||(I.onOpenChange(!0),te()),J&&(I.triggerPointerDownPosRef.current={x:Math.round(J.pageX),y:Math.round(J.pageY)})};return x.jsx(_C,{asChild:!0,...E,children:x.jsx(fn.button,{type:"button",role:"combobox","aria-controls":I.contentId,"aria-expanded":I.open,"aria-required":I.required,"aria-autocomplete":"none",dir:I.dir,"data-state":I.open?"open":"closed",disabled:s,"data-disabled":s?"":void 0,"data-placeholder":Cj(I.value)?"":void 0,...v,ref:O,onClick:Ai(v.onClick,J=>{J.currentTarget.focus(),G.current!=="mouse"&&ue(J)}),onPointerDown:Ai(v.onPointerDown,J=>{G.current=J.pointerType;const ce=J.target;ce.hasPointerCapture(J.pointerId)&&ce.releasePointerCapture(J.pointerId),J.button===0&&J.ctrlKey===!1&&J.pointerType==="mouse"&&(ue(J),J.preventDefault())}),onKeyDown:Ai(v.onKeyDown,J=>{const ce=W.current!=="";!(J.ctrlKey||J.altKey||J.metaKey)&&J.key.length===1&&B(J.key),!(ce&&J.key===" ")&&TX.includes(J.key)&&(ue(),J.preventDefault())})})})});rj.displayName=nj;var sj="SelectValue",oj=V.forwardRef((i,o)=>{const{__scopeSelect:c,className:m,style:v,children:E,placeholder:I="",...s}=i,O=zd(sj,c),{onValueNodeHasChildrenChange:j}=O,G=E!==void 0,W=vr(o,O.onValueNodeChange);return to(()=>{j(G)},[j,G]),x.jsx(fn.span,{...s,ref:W,style:{pointerEvents:"none"},children:Cj(O.value)?x.jsx(x.Fragment,{children:I}):E})});oj.displayName=sj;var MX="SelectIcon",aj=V.forwardRef((i,o)=>{const{__scopeSelect:c,children:m,...v}=i;return x.jsx(fn.span,{"aria-hidden":!0,...v,ref:o,children:m||"▼"})});aj.displayName=MX;var RX="SelectPortal",lj=i=>x.jsx(Gy,{asChild:!0,...i});lj.displayName=RX;var nf="SelectContent",cj=V.forwardRef((i,o)=>{const c=zd(nf,i.__scopeSelect),[m,v]=V.useState();if(to(()=>{v(new DocumentFragment)},[]),!c.open){const E=m;return E?of.createPortal(x.jsx(uj,{scope:i.__scopeSelect,children:x.jsx(jw.Slot,{scope:i.__scopeSelect,children:x.jsx("div",{children:i.children})})}),E):null}return x.jsx(dj,{...i,ref:o})});cj.displayName=nf;var cl=10,[uj,Od]=Dm(nf),DX="SelectContentImpl",dj=V.forwardRef((i,o)=>{const{__scopeSelect:c,position:m="item-aligned",onCloseAutoFocus:v,onEscapeKeyDown:E,onPointerDownOutside:I,side:s,sideOffset:O,align:j,alignOffset:G,arrowPadding:W,collisionBoundary:B,collisionPadding:te,sticky:ue,hideWhenDetached:J,avoidCollisions:ce,...oe}=i,ee=zd(nf,c),[Q,Ie]=V.useState(null),[pe,Ke]=V.useState(null),et=vr(o,ni=>Ie(ni)),[at,Xt]=V.useState(null),[Ct,mt]=V.useState(null),Dt=Bw(c),[Kt,Pt]=V.useState(!1),ti=V.useRef(!1);V.useEffect(()=>{if(Q)return TC(Q)},[Q]),SC();const Nt=V.useCallback(ni=>{const[Fi,...nn]=Dt().map(Cn=>Cn.ref.current),[Ri]=nn.slice(-1),kn=document.activeElement;for(const Cn of ni)if(Cn===kn||(Cn==null||Cn.scrollIntoView({block:"nearest"}),Cn===Fi&&pe&&(pe.scrollTop=0),Cn===Ri&&pe&&(pe.scrollTop=pe.scrollHeight),Cn==null||Cn.focus(),document.activeElement!==kn))return},[Dt,pe]),bi=V.useCallback(()=>Nt([at,Q]),[Nt,at,Q]);V.useEffect(()=>{Kt&&bi()},[Kt,bi]);const{onOpenChange:ot,triggerPointerDownPosRef:Tt}=ee;V.useEffect(()=>{if(Q){let ni={x:0,y:0};const Fi=Ri=>{var kn,Cn;ni={x:Math.abs(Math.round(Ri.pageX)-(((kn=Tt.current)==null?void 0:kn.x)??0)),y:Math.abs(Math.round(Ri.pageY)-(((Cn=Tt.current)==null?void 0:Cn.y)??0))}},nn=Ri=>{ni.x<=10&&ni.y<=10?Ri.preventDefault():Q.contains(Ri.target)||ot(!1),document.removeEventListener("pointermove",Fi),Tt.current=null};return Tt.current!==null&&(document.addEventListener("pointermove",Fi),document.addEventListener("pointerup",nn,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Fi),document.removeEventListener("pointerup",nn,{capture:!0})}}},[Q,ot,Tt]),V.useEffect(()=>{const ni=()=>ot(!1);return window.addEventListener("blur",ni),window.addEventListener("resize",ni),()=>{window.removeEventListener("blur",ni),window.removeEventListener("resize",ni)}},[ot]);const[ii,jt]=Ij(ni=>{const Fi=Dt().filter(kn=>!kn.disabled),nn=Fi.find(kn=>kn.ref.current===document.activeElement),Ri=Pj(Fi,ni,nn);Ri&&setTimeout(()=>Ri.ref.current.focus())}),gi=V.useCallback((ni,Fi,nn)=>{const Ri=!ti.current&&!nn;(ee.value!==void 0&&ee.value===Fi||Ri)&&(Xt(ni),Ri&&(ti.current=!0))},[ee.value]),en=V.useCallback(()=>Q==null?void 0:Q.focus(),[Q]),Dn=V.useCallback((ni,Fi,nn)=>{const Ri=!ti.current&&!nn;(ee.value!==void 0&&ee.value===Fi||Ri)&&mt(ni)},[ee.value]),ir=m==="popper"?XT:hj,wi=ir===XT?{side:s,sideOffset:O,align:j,alignOffset:G,arrowPadding:W,collisionBoundary:B,collisionPadding:te,sticky:ue,hideWhenDetached:J,avoidCollisions:ce}:{};return x.jsx(uj,{scope:c,content:Q,viewport:pe,onViewportChange:Ke,itemRefCallback:gi,selectedItem:at,onItemLeave:en,itemTextRefCallback:Dn,focusSelectedItem:bi,selectedItemText:Ct,position:m,isPositioned:Kt,searchRef:ii,children:x.jsx(Sw,{as:da,allowPinchZoom:!0,children:x.jsx(ww,{asChild:!0,trapped:ee.open,onMountAutoFocus:ni=>{ni.preventDefault()},onUnmountAutoFocus:Ai(v,ni=>{var Fi;(Fi=ee.trigger)==null||Fi.focus({preventScroll:!0}),ni.preventDefault()}),children:x.jsx(Em,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:E,onPointerDownOutside:I,onFocusOutside:ni=>ni.preventDefault(),onDismiss:()=>ee.onOpenChange(!1),children:x.jsx(ir,{role:"listbox",id:ee.contentId,"data-state":ee.open?"open":"closed",dir:ee.dir,onContextMenu:ni=>ni.preventDefault(),...oe,...wi,onPlaced:()=>Pt(!0),ref:et,style:{display:"flex",flexDirection:"column",outline:"none",...oe.style},onKeyDown:Ai(oe.onKeyDown,ni=>{const Fi=ni.ctrlKey||ni.altKey||ni.metaKey;if(ni.key==="Tab"&&ni.preventDefault(),!Fi&&ni.key.length===1&&jt(ni.key),["ArrowUp","ArrowDown","Home","End"].includes(ni.key)){let Ri=Dt().filter(kn=>!kn.disabled).map(kn=>kn.ref.current);if(["ArrowUp","End"].includes(ni.key)&&(Ri=Ri.slice().reverse()),["ArrowUp","ArrowDown"].includes(ni.key)){const kn=ni.target,Cn=Ri.indexOf(kn);Ri=Ri.slice(Cn+1)}setTimeout(()=>Nt(Ri)),ni.preventDefault()}})})})})})})});dj.displayName=DX;var kX="SelectItemAlignedPosition",hj=V.forwardRef((i,o)=>{const{__scopeSelect:c,onPlaced:m,...v}=i,E=zd(nf,c),I=Od(nf,c),[s,O]=V.useState(null),[j,G]=V.useState(null),W=vr(o,et=>G(et)),B=Bw(c),te=V.useRef(!1),ue=V.useRef(!0),{viewport:J,selectedItem:ce,selectedItemText:oe,focusSelectedItem:ee}=I,Q=V.useCallback(()=>{if(E.trigger&&E.valueNode&&s&&j&&J&&ce&&oe){const et=E.trigger.getBoundingClientRect(),at=j.getBoundingClientRect(),Xt=E.valueNode.getBoundingClientRect(),Ct=oe.getBoundingClientRect();if(E.dir!=="rtl"){const kn=Ct.left-at.left,Cn=Xt.left-kn,Zr=et.left-Cn,wr=et.width+Zr,On=Math.max(wr,at.width),gr=window.innerWidth-cl,bs=hk(Cn,[cl,Math.max(cl,gr-On)]);s.style.minWidth=wr+"px",s.style.left=bs+"px"}else{const kn=at.right-Ct.right,Cn=window.innerWidth-Xt.right-kn,Zr=window.innerWidth-et.right-Cn,wr=et.width+Zr,On=Math.max(wr,at.width),gr=window.innerWidth-cl,bs=hk(Cn,[cl,Math.max(cl,gr-On)]);s.style.minWidth=wr+"px",s.style.right=bs+"px"}const mt=B(),Dt=window.innerHeight-cl*2,Kt=J.scrollHeight,Pt=window.getComputedStyle(j),ti=parseInt(Pt.borderTopWidth,10),Nt=parseInt(Pt.paddingTop,10),bi=parseInt(Pt.borderBottomWidth,10),ot=parseInt(Pt.paddingBottom,10),Tt=ti+Nt+Kt+ot+bi,ii=Math.min(ce.offsetHeight*5,Tt),jt=window.getComputedStyle(J),gi=parseInt(jt.paddingTop,10),en=parseInt(jt.paddingBottom,10),Dn=et.top+et.height/2-cl,ir=Dt-Dn,wi=ce.offsetHeight/2,ni=ce.offsetTop+wi,Fi=ti+Nt+ni,nn=Tt-Fi;if(Fi<=Dn){const kn=mt.length>0&&ce===mt[mt.length-1].ref.current;s.style.bottom="0px";const Cn=j.clientHeight-J.offsetTop-J.offsetHeight,Zr=Math.max(ir,wi+(kn?en:0)+Cn+bi),wr=Fi+Zr;s.style.height=wr+"px"}else{const kn=mt.length>0&&ce===mt[0].ref.current;s.style.top="0px";const Zr=Math.max(Dn,ti+J.offsetTop+(kn?gi:0)+wi)+nn;s.style.height=Zr+"px",J.scrollTop=Fi-Dn+J.offsetTop}s.style.margin=`${cl}px 0`,s.style.minHeight=ii+"px",s.style.maxHeight=Dt+"px",m==null||m(),requestAnimationFrame(()=>te.current=!0)}},[B,E.trigger,E.valueNode,s,j,J,ce,oe,E.dir,m]);to(()=>Q(),[Q]);const[Ie,pe]=V.useState();to(()=>{j&&pe(window.getComputedStyle(j).zIndex)},[j]);const Ke=V.useCallback(et=>{et&&ue.current===!0&&(Q(),ee==null||ee(),ue.current=!1)},[Q,ee]);return x.jsx(LX,{scope:c,contentWrapper:s,shouldExpandOnScrollRef:te,onScrollButtonChange:Ke,children:x.jsx("div",{ref:O,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:Ie},children:x.jsx(fn.div,{...v,ref:W,style:{boxSizing:"border-box",maxHeight:"100%",...v.style}})})})});hj.displayName=kX;var NX="SelectPopperPosition",XT=V.forwardRef((i,o)=>{const{__scopeSelect:c,align:m="start",collisionPadding:v=cl,...E}=i,I=Vw(c);return x.jsx(yC,{...I,...E,ref:o,align:m,collisionPadding:v,style:{boxSizing:"border-box",...E.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});XT.displayName=NX;var[LX,QC]=Dm(nf,{}),KT="SelectViewport",fj=V.forwardRef((i,o)=>{const{__scopeSelect:c,nonce:m,...v}=i,E=Od(KT,c),I=QC(KT,c),s=vr(o,E.onViewportChange),O=V.useRef(0);return x.jsxs(x.Fragment,{children:[x.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:m}),x.jsx(jw.Slot,{scope:c,children:x.jsx(fn.div,{"data-radix-select-viewport":"",role:"presentation",...v,ref:s,style:{position:"relative",flex:1,overflow:"hidden auto",...v.style},onScroll:Ai(v.onScroll,j=>{const G=j.currentTarget,{contentWrapper:W,shouldExpandOnScrollRef:B}=I;if(B!=null&&B.current&&W){const te=Math.abs(O.current-G.scrollTop);if(te>0){const ue=window.innerHeight-cl*2,J=parseFloat(W.style.minHeight),ce=parseFloat(W.style.height),oe=Math.max(J,ce);if(oe<ue){const ee=oe+te,Q=Math.min(ue,ee),Ie=ee-Q;W.style.height=Q+"px",W.style.bottom==="0px"&&(G.scrollTop=Ie>0?Ie:0,W.style.justifyContent="flex-end")}}}O.current=G.scrollTop})})})]})});fj.displayName=KT;var pj="SelectGroup",[zX,OX]=Dm(pj),FX=V.forwardRef((i,o)=>{const{__scopeSelect:c,...m}=i,v=vl();return x.jsx(zX,{scope:c,id:v,children:x.jsx(fn.div,{role:"group","aria-labelledby":v,...m,ref:o})})});FX.displayName=pj;var mj="SelectLabel",gj=V.forwardRef((i,o)=>{const{__scopeSelect:c,...m}=i,v=OX(mj,c);return x.jsx(fn.div,{id:v.id,...m,ref:o})});gj.displayName=mj;var F1="SelectItem",[jX,_j]=Dm(F1),yj=V.forwardRef((i,o)=>{const{__scopeSelect:c,value:m,disabled:v=!1,textValue:E,...I}=i,s=zd(F1,c),O=Od(F1,c),j=s.value===m,[G,W]=V.useState(E??""),[B,te]=V.useState(!1),ue=vr(o,ee=>{var Q;return(Q=O.itemRefCallback)==null?void 0:Q.call(O,ee,m,v)}),J=vl(),ce=V.useRef("touch"),oe=()=>{v||(s.onValueChange(m),s.onOpenChange(!1))};if(m==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return x.jsx(jX,{scope:c,value:m,disabled:v,textId:J,isSelected:j,onItemTextChange:V.useCallback(ee=>{W(Q=>Q||((ee==null?void 0:ee.textContent)??"").trim())},[]),children:x.jsx(jw.ItemSlot,{scope:c,value:m,disabled:v,textValue:G,children:x.jsx(fn.div,{role:"option","aria-labelledby":J,"data-highlighted":B?"":void 0,"aria-selected":j&&B,"data-state":j?"checked":"unchecked","aria-disabled":v||void 0,"data-disabled":v?"":void 0,tabIndex:v?void 0:-1,...I,ref:ue,onFocus:Ai(I.onFocus,()=>te(!0)),onBlur:Ai(I.onBlur,()=>te(!1)),onClick:Ai(I.onClick,()=>{ce.current!=="mouse"&&oe()}),onPointerUp:Ai(I.onPointerUp,()=>{ce.current==="mouse"&&oe()}),onPointerDown:Ai(I.onPointerDown,ee=>{ce.current=ee.pointerType}),onPointerMove:Ai(I.onPointerMove,ee=>{var Q;ce.current=ee.pointerType,v?(Q=O.onItemLeave)==null||Q.call(O):ce.current==="mouse"&&ee.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Ai(I.onPointerLeave,ee=>{var Q;ee.currentTarget===document.activeElement&&((Q=O.onItemLeave)==null||Q.call(O))}),onKeyDown:Ai(I.onKeyDown,ee=>{var Ie;((Ie=O.searchRef)==null?void 0:Ie.current)!==""&&ee.key===" "||(EX.includes(ee.key)&&oe(),ee.key===" "&&ee.preventDefault())})})})})});yj.displayName=F1;var Y_="SelectItemText",xj=V.forwardRef((i,o)=>{const{__scopeSelect:c,className:m,style:v,...E}=i,I=zd(Y_,c),s=Od(Y_,c),O=_j(Y_,c),j=PX(Y_,c),[G,W]=V.useState(null),B=vr(o,oe=>W(oe),O.onItemTextChange,oe=>{var ee;return(ee=s.itemTextRefCallback)==null?void 0:ee.call(s,oe,O.value,O.disabled)}),te=G==null?void 0:G.textContent,ue=V.useMemo(()=>x.jsx("option",{value:O.value,disabled:O.disabled,children:te},O.value),[O.disabled,O.value,te]),{onNativeOptionAdd:J,onNativeOptionRemove:ce}=j;return to(()=>(J(ue),()=>ce(ue)),[J,ce,ue]),x.jsxs(x.Fragment,{children:[x.jsx(fn.span,{id:O.textId,...E,ref:B}),O.isSelected&&I.valueNode&&!I.valueNodeHasChildren?of.createPortal(E.children,I.valueNode):null]})});xj.displayName=Y_;var vj="SelectItemIndicator",wj=V.forwardRef((i,o)=>{const{__scopeSelect:c,...m}=i;return _j(vj,c).isSelected?x.jsx(fn.span,{"aria-hidden":!0,...m,ref:o}):null});wj.displayName=vj;var YT="SelectScrollUpButton",bj=V.forwardRef((i,o)=>{const c=Od(YT,i.__scopeSelect),m=QC(YT,i.__scopeSelect),[v,E]=V.useState(!1),I=vr(o,m.onScrollButtonChange);return to(()=>{if(c.viewport&&c.isPositioned){let s=function(){const j=O.scrollTop>0;E(j)};const O=c.viewport;return s(),O.addEventListener("scroll",s),()=>O.removeEventListener("scroll",s)}},[c.viewport,c.isPositioned]),v?x.jsx(Tj,{...i,ref:I,onAutoScroll:()=>{const{viewport:s,selectedItem:O}=c;s&&O&&(s.scrollTop=s.scrollTop-O.offsetHeight)}}):null});bj.displayName=YT;var JT="SelectScrollDownButton",Sj=V.forwardRef((i,o)=>{const c=Od(JT,i.__scopeSelect),m=QC(JT,i.__scopeSelect),[v,E]=V.useState(!1),I=vr(o,m.onScrollButtonChange);return to(()=>{if(c.viewport&&c.isPositioned){let s=function(){const j=O.scrollHeight-O.clientHeight,G=Math.ceil(O.scrollTop)<j;E(G)};const O=c.viewport;return s(),O.addEventListener("scroll",s),()=>O.removeEventListener("scroll",s)}},[c.viewport,c.isPositioned]),v?x.jsx(Tj,{...i,ref:I,onAutoScroll:()=>{const{viewport:s,selectedItem:O}=c;s&&O&&(s.scrollTop=s.scrollTop+O.offsetHeight)}}):null});Sj.displayName=JT;var Tj=V.forwardRef((i,o)=>{const{__scopeSelect:c,onAutoScroll:m,...v}=i,E=Od("SelectScrollButton",c),I=V.useRef(null),s=Bw(c),O=V.useCallback(()=>{I.current!==null&&(window.clearInterval(I.current),I.current=null)},[]);return V.useEffect(()=>()=>O(),[O]),to(()=>{var G;const j=s().find(W=>W.ref.current===document.activeElement);(G=j==null?void 0:j.ref.current)==null||G.scrollIntoView({block:"nearest"})},[s]),x.jsx(fn.div,{"aria-hidden":!0,...v,ref:o,style:{flexShrink:0,...v.style},onPointerDown:Ai(v.onPointerDown,()=>{I.current===null&&(I.current=window.setInterval(m,50))}),onPointerMove:Ai(v.onPointerMove,()=>{var j;(j=E.onItemLeave)==null||j.call(E),I.current===null&&(I.current=window.setInterval(m,50))}),onPointerLeave:Ai(v.onPointerLeave,()=>{O()})})}),BX="SelectSeparator",Ej=V.forwardRef((i,o)=>{const{__scopeSelect:c,...m}=i;return x.jsx(fn.div,{"aria-hidden":!0,...m,ref:o})});Ej.displayName=BX;var QT="SelectArrow",VX=V.forwardRef((i,o)=>{const{__scopeSelect:c,...m}=i,v=Vw(c),E=zd(QT,c),I=Od(QT,c);return E.open&&I.position==="popper"?x.jsx(xC,{...v,...m,ref:o}):null});VX.displayName=QT;function Cj(i){return i===""||i===void 0}var Aj=V.forwardRef((i,o)=>{const{value:c,...m}=i,v=V.useRef(null),E=vr(o,v),I=GO(c);return V.useEffect(()=>{const s=v.current,O=window.HTMLSelectElement.prototype,G=Object.getOwnPropertyDescriptor(O,"value").set;if(I!==c&&G){const W=new Event("change",{bubbles:!0});G.call(s,c),s.dispatchEvent(W)}},[I,c]),x.jsx($y,{asChild:!0,children:x.jsx("select",{...m,ref:E,defaultValue:c})})});Aj.displayName="BubbleSelect";function Ij(i){const o=po(i),c=V.useRef(""),m=V.useRef(0),v=V.useCallback(I=>{const s=c.current+I;o(s),function O(j){c.current=j,window.clearTimeout(m.current),j!==""&&(m.current=window.setTimeout(()=>O(""),1e3))}(s)},[o]),E=V.useCallback(()=>{c.current="",window.clearTimeout(m.current)},[]);return V.useEffect(()=>()=>window.clearTimeout(m.current),[]),[c,v,E]}function Pj(i,o,c){const v=o.length>1&&Array.from(o).every(j=>j===o[0])?o[0]:o,E=c?i.indexOf(c):-1;let I=UX(i,Math.max(E,0));v.length===1&&(I=I.filter(j=>j!==c));const O=I.find(j=>j.textValue.toLowerCase().startsWith(v.toLowerCase()));return O!==c?O:void 0}function UX(i,o){return i.map((c,m)=>i[(o+m)%i.length])}var GX=ij,Mj=rj,$X=oj,HX=aj,qX=lj,Rj=cj,WX=fj,Dj=gj,kj=yj,ZX=xj,XX=wj,Nj=bj,Lj=Sj,zj=Ej;const Oj=GX,Fj=$X,eA=V.forwardRef(({className:i,children:o,...c},m)=>x.jsxs(Mj,{ref:m,className:ui("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",i),...c,children:[o,x.jsx(HX,{asChild:!0,children:x.jsx(Sz,{className:"h-4 w-4 opacity-50"})})]}));eA.displayName=Mj.displayName;const jj=V.forwardRef(({className:i,...o},c)=>x.jsx(Nj,{ref:c,className:ui("flex cursor-default items-center justify-center py-1",i),...o,children:x.jsx(ZG,{className:"h-4 w-4"})}));jj.displayName=Nj.displayName;const Bj=V.forwardRef(({className:i,...o},c)=>x.jsx(Lj,{ref:c,className:ui("flex cursor-default items-center justify-center py-1",i),...o,children:x.jsx(Sz,{className:"h-4 w-4"})}));Bj.displayName=Lj.displayName;const tA=V.forwardRef(({className:i,children:o,position:c="popper",...m},v)=>x.jsx(qX,{children:x.jsxs(Rj,{ref:v,className:ui("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",c==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",i),position:c,...m,children:[x.jsx(jj,{}),x.jsx(WX,{className:ui("p-1",c==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:o}),x.jsx(Bj,{})]})}));tA.displayName=Rj.displayName;const KX=V.forwardRef(({className:i,...o},c)=>x.jsx(Dj,{ref:c,className:ui("py-1.5 pl-8 pr-2 text-sm font-semibold",i),...o}));KX.displayName=Dj.displayName;const Va=V.forwardRef(({className:i,children:o,...c},m)=>x.jsxs(kj,{ref:m,className:ui("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",i),...c,children:[x.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:x.jsx(XX,{children:x.jsx(bz,{className:"h-4 w-4"})})}),x.jsx(ZX,{children:o})]}));Va.displayName=kj.displayName;const YX=V.forwardRef(({className:i,...o},c)=>x.jsx(zj,{ref:c,className:ui("-mx-1 my-1 h-px bg-muted",i),...o}));YX.displayName=zj.displayName;const fk=[{id:"1",title:"Weekend Special",description:"20% off on all chicken products this weekend",image:"https://images.unsplash.com/photo-1604503468506-a8da13d82791?w=400",type:"discount",value:20,validFrom:"2024-03-01",validTo:"2024-03-03",isActive:!0,items:["1","2"]},{id:"2",title:"Family Combo",description:"Chicken + Mutton combo pack at special price",image:"https://images.unsplash.com/photo-1529692236671-f1f6cf9683ba?w=400",type:"combo",value:1999,validFrom:"2024-03-01",validTo:"2024-03-31",isActive:!0,items:["1","2","3"]},{id:"3",title:"Fish Friday",description:"Special discount on fresh fish every Friday",image:"https://images.unsplash.com/photo-1544943910-4c1dc44aab44?w=400",type:"special",value:15,validFrom:"2024-03-01",validTo:"2024-03-29",isActive:!1,items:["4"]}],JX=()=>{const[i,o]=V.useState(!0),[c,m]=V.useState([]),[v,E]=V.useState(""),[I,s]=V.useState([]),[O,j]=V.useState(!1),[G,W]=V.useState(null),{toast:B}=ha(),te=KC();V.useEffect(()=>{(async()=>{o(!0),await new Promise(Ke=>setTimeout(Ke,1e3)),m(fk),s(fk),o(!1)})()},[]),V.useEffect(()=>{const pe=c.filter(Ke=>Ke.title.toLowerCase().includes(v.toLowerCase())||Ke.description.toLowerCase().includes(v.toLowerCase()));s(pe)},[v,c]);const ue=pe=>{if(G)m(Ke=>Ke.map(et=>et.id===G.id?{...et,...pe}:et)),B({title:"Offer Updated",description:`${pe.title} has been updated successfully`,position:"top-center"});else{const Ke={id:Date.now().toString(),...pe};m(et=>[...et,Ke]),B({title:"Offer Added",description:`${pe.title} has been added successfully`,position:"top-center"})}j(!1),W(null),te.reset()},J=pe=>{W(pe),te.reset({title:pe.title,description:pe.description,image:pe.image,type:pe.type,value:pe.value,validFrom:pe.validFrom,validTo:pe.validTo,isActive:pe.isActive,items:pe.items||[]}),j(!0)},ce=pe=>{m(Ke=>Ke.map(et=>et.id===pe?{...et,isActive:!et.isActive}:et)),B({title:"Offer Status Updated",description:"Offer status has been updated successfully",position:"top-center"})},oe=(pe,Ke)=>{m(et=>et.filter(at=>at.id!==pe)),B({title:"Offer Deleted",description:`${Ke} has been deleted successfully`,position:"top-center"})},ee=()=>{W(null),te.reset({title:"",description:"",image:"",type:"discount",value:0,validFrom:"",validTo:"",isActive:!0,items:[]}),j(!0)},Q=pe=>{switch(pe){case"discount":return"bg-green-100 text-green-800";case"combo":return"bg-blue-100 text-blue-800";case"special":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},Ie=pe=>pe.type==="discount"||pe.type==="special"?`${pe.value}% OFF`:`₹${pe.value}`;return i?x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"flex justify-between items-center",children:[x.jsx(Cr,{className:"h-8 w-48"}),x.jsx(Cr,{className:"h-10 w-32"})]}),x.jsxs($i,{children:[x.jsx(dr,{children:x.jsx(Cr,{className:"h-6 w-32"})}),x.jsx(Hi,{children:x.jsx("div",{className:"space-y-4",children:[...Array(5)].map((pe,Ke)=>x.jsx(Cr,{className:"h-16 w-full"},Ke))})})]})]}):x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"flex justify-between items-center",children:[x.jsxs("div",{children:[x.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Manage Offers & Combos"}),x.jsx("p",{className:"text-muted-foreground",children:"Create and manage special offers, discounts, and combo deals"})]}),x.jsxs(Lw,{open:O,onOpenChange:j,children:[x.jsx(UC,{asChild:!0,children:x.jsxs(Si,{variant:"meat",onClick:ee,children:[x.jsx(bl,{className:"h-4 w-4 mr-2"}),"Add New Offer"]})}),x.jsxs(ex,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:[x.jsx(tx,{children:x.jsx(ix,{children:G?"Edit Offer":"Add New Offer"})}),x.jsx(YC,{...te,children:x.jsxs("form",{onSubmit:te.handleSubmit(ue),className:"space-y-4",children:[x.jsx(Us,{control:te.control,name:"title",rules:{required:"Title is required"},render:({field:pe})=>x.jsxs(Ms,{children:[x.jsx(Rs,{children:"Offer Title"}),x.jsx(Ds,{children:x.jsx(tn,{placeholder:"e.g., Weekend Special",...pe})}),x.jsx(Js,{})]})}),x.jsx(Us,{control:te.control,name:"description",rules:{required:"Description is required"},render:({field:pe})=>x.jsxs(Ms,{children:[x.jsx(Rs,{children:"Description"}),x.jsx(Ds,{children:x.jsx(JC,{placeholder:"Describe this offer...",...pe})}),x.jsx(Js,{})]})}),x.jsx(Us,{control:te.control,name:"type",rules:{required:"Type is required"},render:({field:pe})=>x.jsxs(Ms,{children:[x.jsx(Rs,{children:"Offer Type"}),x.jsxs(Oj,{onValueChange:pe.onChange,defaultValue:pe.value,children:[x.jsx(Ds,{children:x.jsx(eA,{children:x.jsx(Fj,{placeholder:"Select offer type"})})}),x.jsxs(tA,{children:[x.jsx(Va,{value:"discount",children:"Percentage Discount"}),x.jsx(Va,{value:"combo",children:"Fixed Price Combo"}),x.jsx(Va,{value:"special",children:"Special Offer"})]})]}),x.jsx(Js,{})]})}),x.jsx(Us,{control:te.control,name:"value",rules:{required:"Value is required",min:{value:1,message:"Value must be greater than 0"}},render:({field:pe})=>x.jsxs(Ms,{children:[x.jsx(Rs,{children:te.watch("type")==="combo"?"Fixed Price (₹)":"Discount Percentage (%)"}),x.jsx(Ds,{children:x.jsx(tn,{type:"number",placeholder:te.watch("type")==="combo"?"1999":"20",...pe,onChange:Ke=>pe.onChange(Number(Ke.target.value))})}),x.jsx(Js,{})]})}),x.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[x.jsx(Us,{control:te.control,name:"validFrom",rules:{required:"Start date is required"},render:({field:pe})=>x.jsxs(Ms,{children:[x.jsx(Rs,{children:"Valid From"}),x.jsx(Ds,{children:x.jsx(tn,{type:"date",...pe})}),x.jsx(Js,{})]})}),x.jsx(Us,{control:te.control,name:"validTo",rules:{required:"End date is required"},render:({field:pe})=>x.jsxs(Ms,{children:[x.jsx(Rs,{children:"Valid To"}),x.jsx(Ds,{children:x.jsx(tn,{type:"date",...pe})}),x.jsx(Js,{})]})})]}),x.jsx(Us,{control:te.control,name:"image",rules:{required:"Image URL is required"},render:({field:pe})=>x.jsxs(Ms,{children:[x.jsx(Rs,{children:"Image URL"}),x.jsx(Ds,{children:x.jsx(tn,{placeholder:"https://example.com/image.jpg",...pe})}),x.jsx(Js,{})]})}),x.jsx(Us,{control:te.control,name:"isActive",render:({field:pe})=>x.jsxs(Ms,{className:"flex items-center justify-between",children:[x.jsx(Rs,{children:"Active Status"}),x.jsx(Ds,{children:x.jsx(xm,{checked:pe.value,onCheckedChange:pe.onChange})})]})}),x.jsxs("div",{className:"flex gap-2 pt-4",children:[x.jsxs(Si,{type:"submit",variant:"meat",className:"flex-1",children:[G?"Update":"Add"," Offer"]}),x.jsx(Si,{type:"button",variant:"outline",onClick:()=>j(!1),children:"Cancel"})]})]})})]})]})]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[x.jsx($i,{children:x.jsxs(Hi,{className:"p-4",children:[x.jsx("div",{className:"text-2xl font-bold",children:c.length}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Offers"})]})}),x.jsx($i,{children:x.jsxs(Hi,{className:"p-4",children:[x.jsx("div",{className:"text-2xl font-bold text-success",children:c.filter(pe=>pe.isActive).length}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"Active Offers"})]})}),x.jsx($i,{children:x.jsxs(Hi,{className:"p-4",children:[x.jsx("div",{className:"text-2xl font-bold text-blue-600",children:c.filter(pe=>pe.type==="combo").length}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"Combo Deals"})]})}),x.jsx($i,{children:x.jsxs(Hi,{className:"p-4",children:[x.jsx("div",{className:"text-2xl font-bold text-green-600",children:c.filter(pe=>pe.type==="discount").length}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"Discounts"})]})})]}),x.jsxs($i,{children:[x.jsxs(dr,{children:[x.jsx(Mr,{children:"Offers & Combos"}),x.jsxs("div",{className:"flex gap-4",children:[x.jsxs("div",{className:"relative flex-1 max-w-md",children:[x.jsx(Am,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),x.jsx(tn,{placeholder:"Search offers...",value:v,onChange:pe=>E(pe.target.value),className:"pl-10"})]}),x.jsxs(Si,{variant:"outline",children:[x.jsx(lw,{className:"h-4 w-4 mr-2"}),"Filter"]})]})]}),x.jsxs(Hi,{children:[x.jsx("div",{className:"rounded-md border",children:x.jsxs(Zy,{children:[x.jsx(Xy,{children:x.jsxs(eu,{children:[x.jsx(kr,{className:"w-[100px]",children:"Image"}),x.jsx(kr,{children:"Title"}),x.jsx(kr,{children:"Type"}),x.jsx(kr,{children:"Value"}),x.jsx(kr,{children:"Valid Period"}),x.jsx(kr,{children:"Status"}),x.jsx(kr,{className:"text-right",children:"Actions"})]})}),x.jsx(Ky,{children:I.map(pe=>x.jsxs(eu,{children:[x.jsx(Nr,{children:x.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden bg-gray-100",children:x.jsx("img",{src:pe.image,alt:pe.title,className:"w-full h-full object-cover"})})}),x.jsx(Nr,{children:x.jsxs("div",{children:[x.jsx("div",{className:"font-medium",children:pe.title}),x.jsx("div",{className:"text-sm text-muted-foreground line-clamp-1",children:pe.description})]})}),x.jsx(Nr,{children:x.jsx(es,{className:Q(pe.type),children:pe.type})}),x.jsx(Nr,{children:x.jsx("span",{className:"font-semibold",children:Ie(pe)})}),x.jsx(Nr,{children:x.jsxs("div",{className:"text-sm",children:[x.jsxs("div",{className:"flex items-center gap-1",children:[x.jsx(wz,{className:"h-3 w-3"}),new Date(pe.validFrom).toLocaleDateString()]}),x.jsxs("div",{className:"text-muted-foreground",children:["to ",new Date(pe.validTo).toLocaleDateString()]})]})}),x.jsx(Nr,{children:x.jsx(es,{variant:pe.isActive?"default":"secondary",className:`cursor-pointer ${pe.isActive?"bg-success text-success-foreground":""}`,onClick:()=>ce(pe.id),children:pe.isActive?"Active":"Inactive"})}),x.jsx(Nr,{className:"text-right",children:x.jsxs(kw,{children:[x.jsx(Nw,{asChild:!0,children:x.jsx(Si,{variant:"ghost",size:"icon",children:x.jsx(aw,{className:"h-4 w-4"})})}),x.jsxs(Qy,{align:"end",children:[x.jsxs(Qs,{children:[x.jsx(Qh,{className:"h-4 w-4 mr-2"}),"View Details"]}),x.jsxs(Qs,{onClick:()=>J(pe),children:[x.jsx(Py,{className:"h-4 w-4 mr-2"}),"Edit"]}),x.jsxs(Qs,{onClick:()=>ce(pe.id),children:[x.jsx(xm,{className:"h-4 w-4 mr-2"}),"Toggle Status"]}),x.jsxs(Qs,{onClick:()=>oe(pe.id,pe.title),className:"text-destructive",children:[x.jsx(Hy,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})})]},pe.id))})]})}),I.length===0&&x.jsxs("div",{className:"text-center py-8",children:[x.jsx(T1,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),x.jsx("p",{className:"text-muted-foreground mb-2",children:v?"No offers found matching your search.":"No offers added yet."}),!v&&x.jsxs(Si,{variant:"meat",onClick:ee,children:[x.jsx(bl,{className:"h-4 w-4 mr-2"}),"Create Your First Offer"]})]})]})]})]})};var Vj={exports:{}};(function(i,o){(function(c,m){i.exports=m()})(_V,function(){var c,m,v;function E(s,O){if(!c)c=O;else if(!m)m=O;else{var j="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+c+")(sharedChunk); ("+m+")(sharedChunk); self.onerror = null;",G={};c(G),v=O(G),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(v.workerUrl=window.URL.createObjectURL(new Blob([j],{type:"text/javascript"})))}}E(["exports"],function(s){var O=1e-6,j=typeof Float32Array<"u"?Float32Array:Array;function G(r,e){var n=e[0],l=e[1],u=e[2],f=e[3],p=n*f-u*l;return p?(r[0]=f*(p=1/p),r[1]=-l*p,r[2]=-u*p,r[3]=n*p,r):null}function W(){var r=new j(9);return j!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function B(r,e){var n=e[0],l=e[1],u=e[2],f=e[3],p=e[4],y=e[5],b=e[6],S=e[7],A=e[8];return r[0]=p*A-y*S,r[1]=u*S-l*A,r[2]=l*y-u*p,r[3]=y*b-f*A,r[4]=n*A-u*b,r[5]=u*f-n*y,r[6]=f*S-p*b,r[7]=l*b-n*S,r[8]=n*p-l*f,r}function te(r,e,n){var l=e[0],u=e[1],f=e[2],p=e[3],y=e[4],b=e[5],S=e[6],A=e[7],P=e[8],M=n[0],N=n[1],L=n[2],U=n[3],H=n[4],K=n[5],se=n[6],re=n[7],le=n[8];return r[0]=M*l+N*p+L*S,r[1]=M*u+N*y+L*A,r[2]=M*f+N*b+L*P,r[3]=U*l+H*p+K*S,r[4]=U*u+H*y+K*A,r[5]=U*f+H*b+K*P,r[6]=se*l+re*p+le*S,r[7]=se*u+re*y+le*A,r[8]=se*f+re*b+le*P,r}function ue(){var r=new j(16);return j!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function J(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function ce(r,e){var n=e[0],l=e[1],u=e[2],f=e[3],p=e[4],y=e[5],b=e[6],S=e[7],A=e[8],P=e[9],M=e[10],N=e[11],L=e[12],U=e[13],H=e[14],K=e[15],se=n*y-l*p,re=n*b-u*p,le=n*S-f*p,Ee=l*b-u*y,we=l*S-f*y,Se=u*S-f*b,Me=A*U-P*L,De=A*H-M*L,Xe=A*K-N*L,Le=P*H-M*U,Je=P*K-N*U,yt=M*K-N*H,tt=se*yt-re*Je+le*Le+Ee*Xe-we*De+Se*Me;return tt?(r[0]=(y*yt-b*Je+S*Le)*(tt=1/tt),r[1]=(u*Je-l*yt-f*Le)*tt,r[2]=(U*Se-H*we+K*Ee)*tt,r[3]=(M*we-P*Se-N*Ee)*tt,r[4]=(b*Xe-p*yt-S*De)*tt,r[5]=(n*yt-u*Xe+f*De)*tt,r[6]=(H*le-L*Se-K*re)*tt,r[7]=(A*Se-M*le+N*re)*tt,r[8]=(p*Je-y*Xe+S*Me)*tt,r[9]=(l*Xe-n*Je-f*Me)*tt,r[10]=(L*we-U*le+K*se)*tt,r[11]=(P*le-A*we-N*se)*tt,r[12]=(y*De-p*Le-b*Me)*tt,r[13]=(n*Le-l*De+u*Me)*tt,r[14]=(U*re-L*Ee-H*se)*tt,r[15]=(A*Ee-P*re+M*se)*tt,r):null}function oe(r,e,n){var l=e[0],u=e[1],f=e[2],p=e[3],y=e[4],b=e[5],S=e[6],A=e[7],P=e[8],M=e[9],N=e[10],L=e[11],U=e[12],H=e[13],K=e[14],se=e[15],re=n[0],le=n[1],Ee=n[2],we=n[3];return r[0]=re*l+le*y+Ee*P+we*U,r[1]=re*u+le*b+Ee*M+we*H,r[2]=re*f+le*S+Ee*N+we*K,r[3]=re*p+le*A+Ee*L+we*se,r[4]=(re=n[4])*l+(le=n[5])*y+(Ee=n[6])*P+(we=n[7])*U,r[5]=re*u+le*b+Ee*M+we*H,r[6]=re*f+le*S+Ee*N+we*K,r[7]=re*p+le*A+Ee*L+we*se,r[8]=(re=n[8])*l+(le=n[9])*y+(Ee=n[10])*P+(we=n[11])*U,r[9]=re*u+le*b+Ee*M+we*H,r[10]=re*f+le*S+Ee*N+we*K,r[11]=re*p+le*A+Ee*L+we*se,r[12]=(re=n[12])*l+(le=n[13])*y+(Ee=n[14])*P+(we=n[15])*U,r[13]=re*u+le*b+Ee*M+we*H,r[14]=re*f+le*S+Ee*N+we*K,r[15]=re*p+le*A+Ee*L+we*se,r}function ee(r,e,n){var l,u,f,p,y,b,S,A,P,M,N,L,U=n[0],H=n[1],K=n[2];return e===r?(r[12]=e[0]*U+e[4]*H+e[8]*K+e[12],r[13]=e[1]*U+e[5]*H+e[9]*K+e[13],r[14]=e[2]*U+e[6]*H+e[10]*K+e[14],r[15]=e[3]*U+e[7]*H+e[11]*K+e[15]):(u=e[1],f=e[2],p=e[3],y=e[4],b=e[5],S=e[6],A=e[7],P=e[8],M=e[9],N=e[10],L=e[11],r[0]=l=e[0],r[1]=u,r[2]=f,r[3]=p,r[4]=y,r[5]=b,r[6]=S,r[7]=A,r[8]=P,r[9]=M,r[10]=N,r[11]=L,r[12]=l*U+y*H+P*K+e[12],r[13]=u*U+b*H+M*K+e[13],r[14]=f*U+S*H+N*K+e[14],r[15]=p*U+A*H+L*K+e[15]),r}function Q(r,e,n){var l=n[0],u=n[1],f=n[2];return r[0]=e[0]*l,r[1]=e[1]*l,r[2]=e[2]*l,r[3]=e[3]*l,r[4]=e[4]*u,r[5]=e[5]*u,r[6]=e[6]*u,r[7]=e[7]*u,r[8]=e[8]*f,r[9]=e[9]*f,r[10]=e[10]*f,r[11]=e[11]*f,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function Ie(r,e,n){var l=Math.sin(n),u=Math.cos(n),f=e[4],p=e[5],y=e[6],b=e[7],S=e[8],A=e[9],P=e[10],M=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=f*u+S*l,r[5]=p*u+A*l,r[6]=y*u+P*l,r[7]=b*u+M*l,r[8]=S*u-f*l,r[9]=A*u-p*l,r[10]=P*u-y*l,r[11]=M*u-b*l,r}function pe(r,e,n){var l=Math.sin(n),u=Math.cos(n),f=e[0],p=e[1],y=e[2],b=e[3],S=e[8],A=e[9],P=e[10],M=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=f*u-S*l,r[1]=p*u-A*l,r[2]=y*u-P*l,r[3]=b*u-M*l,r[8]=f*l+S*u,r[9]=p*l+A*u,r[10]=y*l+P*u,r[11]=b*l+M*u,r}function Ke(r,e,n){var l=Math.sin(n),u=Math.cos(n),f=e[0],p=e[1],y=e[2],b=e[3],S=e[4],A=e[5],P=e[6],M=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=f*u+S*l,r[1]=p*u+A*l,r[2]=y*u+P*l,r[3]=b*u+M*l,r[4]=S*u-f*l,r[5]=A*u-p*l,r[6]=P*u-y*l,r[7]=M*u-b*l,r}function et(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function at(r,e,n){var l,u,f,p=n[0],y=n[1],b=n[2],S=Math.hypot(p,y,b);return S<O?null:(p*=S=1/S,y*=S,b*=S,l=Math.sin(e),u=Math.cos(e),r[0]=p*p*(f=1-u)+u,r[1]=y*p*f+b*l,r[2]=b*p*f-y*l,r[3]=0,r[4]=p*y*f-b*l,r[5]=y*y*f+u,r[6]=b*y*f+p*l,r[7]=0,r[8]=p*b*f+y*l,r[9]=y*b*f-p*l,r[10]=b*b*f+u,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function Xt(r,e){var n=e[0],l=e[1],u=e[2],f=e[3],p=n+n,y=l+l,b=u+u,S=n*p,A=l*p,P=l*y,M=u*p,N=u*y,L=u*b,U=f*p,H=f*y,K=f*b;return r[0]=1-P-L,r[1]=A+K,r[2]=M-H,r[3]=0,r[4]=A-K,r[5]=1-S-L,r[6]=N+U,r[7]=0,r[8]=M+H,r[9]=N-U,r[10]=1-S-P,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var Ct=oe;function mt(){var r=new j(3);return j!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Dt(r){var e=new j(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function Kt(r){return Math.hypot(r[0],r[1],r[2])}function Pt(r,e,n){var l=new j(3);return l[0]=r,l[1]=e,l[2]=n,l}function ti(r,e,n,l){return r[0]=e,r[1]=n,r[2]=l,r}function Nt(r,e,n){return r[0]=e[0]+n[0],r[1]=e[1]+n[1],r[2]=e[2]+n[2],r}function bi(r,e,n){return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],r}function ot(r,e,n){return r[0]=e[0]*n[0],r[1]=e[1]*n[1],r[2]=e[2]*n[2],r}function Tt(r,e,n){return r[0]=Math.min(e[0],n[0]),r[1]=Math.min(e[1],n[1]),r[2]=Math.min(e[2],n[2]),r}function ii(r,e,n){return r[0]=Math.max(e[0],n[0]),r[1]=Math.max(e[1],n[1]),r[2]=Math.max(e[2],n[2]),r}function jt(r,e,n){return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r}function gi(r,e,n,l){return r[0]=e[0]+n[0]*l,r[1]=e[1]+n[1]*l,r[2]=e[2]+n[2]*l,r}function en(r,e){var n=e[0]-r[0],l=e[1]-r[1],u=e[2]-r[2];return n*n+l*l+u*u}function Dn(r){var e=r[0],n=r[1],l=r[2];return e*e+n*n+l*l}function ir(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function wi(r,e){var n=e[0],l=e[1],u=e[2],f=n*n+l*l+u*u;return f>0&&(f=1/Math.sqrt(f)),r[0]=e[0]*f,r[1]=e[1]*f,r[2]=e[2]*f,r}function ni(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function Fi(r,e,n){var l=e[0],u=e[1],f=e[2],p=n[0],y=n[1],b=n[2];return r[0]=u*b-f*y,r[1]=f*p-l*b,r[2]=l*y-u*p,r}function nn(r,e,n,l){var u=e[0],f=e[1],p=e[2];return r[0]=u+l*(n[0]-u),r[1]=f+l*(n[1]-f),r[2]=p+l*(n[2]-p),r}function Ri(r,e,n){var l=e[0],u=e[1],f=e[2],p=n[3]*l+n[7]*u+n[11]*f+n[15];return r[0]=(n[0]*l+n[4]*u+n[8]*f+n[12])/(p=p||1),r[1]=(n[1]*l+n[5]*u+n[9]*f+n[13])/p,r[2]=(n[2]*l+n[6]*u+n[10]*f+n[14])/p,r}function kn(r,e,n){var l=e[0],u=e[1],f=e[2];return r[0]=l*n[0]+u*n[3]+f*n[6],r[1]=l*n[1]+u*n[4]+f*n[7],r[2]=l*n[2]+u*n[5]+f*n[8],r}function Cn(r,e,n){var l=n[0],u=n[1],f=n[2],p=e[0],y=e[1],b=e[2],S=u*b-f*y,A=f*p-l*b,P=l*y-u*p,M=u*P-f*A,N=f*S-l*P,L=l*A-u*S,U=2*n[3];return A*=U,P*=U,N*=2,L*=2,r[0]=p+(S*=U)+(M*=2),r[1]=y+A+N,r[2]=b+P+L,r}function Zr(r){return r[0]=0,r[1]=0,r[2]=0,r}function wr(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]}var On=bi,gr=ot,bs=Kt;function Ma(){var r=new j(4);return j!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function _r(r,e,n){return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r}function Ge(r,e){var n=e[0],l=e[1],u=e[2],f=e[3],p=n*n+l*l+u*u+f*f;return p>0&&(p=1/Math.sqrt(p)),r[0]=n*p,r[1]=l*p,r[2]=u*p,r[3]=f*p,r}function rt(r,e,n){var l=e[0],u=e[1],f=e[2],p=e[3];return r[0]=n[0]*l+n[4]*u+n[8]*f+n[12]*p,r[1]=n[1]*l+n[5]*u+n[9]*f+n[13]*p,r[2]=n[2]*l+n[6]*u+n[10]*f+n[14]*p,r[3]=n[3]*l+n[7]*u+n[11]*f+n[15]*p,r}function Rt(){var r=new j(4);return j!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function fi(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function di(r,e,n){n*=.5;var l=e[0],u=e[1],f=e[2],p=e[3],y=Math.sin(n),b=Math.cos(n);return r[0]=l*b+p*y,r[1]=u*b+f*y,r[2]=f*b-u*y,r[3]=p*b-l*y,r}function ri(r,e,n){n*=.5;var l=e[0],u=e[1],f=e[2],p=e[3],y=Math.sin(n),b=Math.cos(n);return r[0]=l*b-f*y,r[1]=u*b+p*y,r[2]=f*b+l*y,r[3]=p*b-u*y,r}mt(),Ma();var Ci,an,Jn,br=Ge,mo=(Ci=mt(),an=Pt(1,0,0),Jn=Pt(0,1,0),function(r,e,n){var l=ni(e,n);return l<-.999999?(Fi(Ci,an,e),bs(Ci)<1e-6&&Fi(Ci,Jn,e),wi(Ci,Ci),function(u,f,p){p*=.5;var y=Math.sin(p);u[0]=y*f[0],u[1]=y*f[1],u[2]=y*f[2],u[3]=Math.cos(p)}(r,Ci,Math.PI),r):l>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Fi(Ci,e,n),r[0]=Ci[0],r[1]=Ci[1],r[2]=Ci[2],r[3]=1+l,br(r,r))});function Ar(){var r=new j(2);return j!=Float32Array&&(r[0]=0,r[1]=0),r}function Ss(r,e){var n=new j(2);return n[0]=r,n[1]=e,n}function io(r,e,n){return r[0]=e[0]+n[0],r[1]=e[1]+n[1],r}function no(r,e,n){return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r}function go(r,e,n){return r[0]=e[0]*n,r[1]=e[1]*n,r}function as(r){return Math.hypot(r[0],r[1])}function Ra(r,e){var n=e[0],l=e[1],u=n*n+l*l;return u>0&&(u=1/Math.sqrt(u)),r[0]=e[0]*u,r[1]=e[1]*u,r}function yi(r,e){return r[0]*e[0]+r[1]*e[1]}Rt(),Rt(),W();var hr,lr,jr=no;function $s(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}Ar();var Al=function(){if(lr)return hr;function r(e,n,l,u){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=l,this.p2y=u}return lr=1,hr=r,r.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,u=0;u<8;u++){var f=this.sampleCurveX(l)-e;if(Math.abs(f)<n)return l;var p=this.sampleCurveDerivativeX(l);if(Math.abs(p)<1e-6)break;l-=f/p}var y=0,b=1;for(l=e,u=0;u<20&&(f=this.sampleCurveX(l),!(Math.abs(f-e)<n));u++)e>f?y=l:b=l,l=.5*(b-y)+y;return l},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},hr}(),Il=$s(Al);function ht(r,e){this.x=r,this.y=e}function Ka(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!Ka(r[n],e[n]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const n in r)if(!Ka(r[n],e[n]))return!1;return!0}return r===e}ht.prototype={clone(){return new ht(this.x,this.y)},add(r){return this.clone()._add(r)},sub(r){return this.clone()._sub(r)},multByPoint(r){return this.clone()._multByPoint(r)},divByPoint(r){return this.clone()._divByPoint(r)},mult(r){return this.clone()._mult(r)},div(r){return this.clone()._div(r)},rotate(r){return this.clone()._rotate(r)},rotateAround(r,e){return this.clone()._rotateAround(r,e)},matMult(r){return this.clone()._matMult(r)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(r){return this.x===r.x&&this.y===r.y},dist(r){return Math.sqrt(this.distSqr(r))},distSqr(r){const e=r.x-this.x,n=r.y-this.y;return e*e+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith(r){return this.angleWithSep(r.x,r.y)},angleWithSep(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult(r){const e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add(r){return this.x+=r.x,this.y+=r.y,this},_sub(r){return this.x-=r.x,this.y-=r.y,this},_mult(r){return this.x*=r,this.y*=r,this},_div(r){return this.x/=r,this.y/=r,this},_multByPoint(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint(r){return this.x/=r.x,this.y/=r.y,this},_unit(){return this._div(this.mag()),this},_perp(){const r=this.y;return this.y=this.x,this.x=-r,this},_rotate(r){const e=Math.cos(r),n=Math.sin(r),l=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=l,this},_rotateAround(r,e){const n=Math.cos(r),l=Math.sin(r),u=e.y+l*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-l*(this.y-e.y),this.y=u,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:ht},ht.convert=function(r){if(r instanceof ht)return r;if(Array.isArray(r))return new ht(+r[0],+r[1]);if(r.x!==void 0&&r.y!==void 0)return new ht(+r.x,+r.y);throw new Error("Expected [x, y] or {x, y} point format")};const km=Math.PI/180,Fd=180/Math.PI;function pn(r){return r*km}function Be(r){return r*Fd}const Y=[[0,0],[1,0],[1,1],[0,1]];function ie(r){if(r<=0)return 0;if(r>=1)return 1;const e=r*r,n=e*r;return 4*(r<.5?n:3*(r-e)+n-.75)}function me(r,e,n,l){const u=new Il(r,e,n,l);return function(f){return u.solve(f)}}const Ce=me(.25,.1,.25,1);function ge(r,e,n){return Math.min(n,Math.max(e,r))}function Re(r,e,n){return(n=ge((n-r)/(e-r),0,1))*n*(3-2*n)}function $e(r,e,n){const l=n-e,u=((r-e)%l+l)%l+e;return u===e?n:u}function ke(r,e,n){if(!r.length)return n(null,[]);let l=r.length;const u=new Array(r.length);let f=null;r.forEach((p,y)=>{e(p,(b,S)=>{b&&(f=b),u[y]=S,--l==0&&n(f,u)})})}function Ve(r,...e){for(const n of e)for(const l in n)r[l]=n[l];return r}let vt=1;function it(){return vt++}function ei(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function _i(r,e){r.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function Ti(r,e,n){const l={};for(const u in r)l[u]=e.call(this,r[u],u,r);return l}function Zi(r,e,n){const l={};for(const u in r)e.call(this,r[u],u,r)&&(l[u]=r[u]);return l}function Vi(r){return Array.isArray(r)?r.map(Vi):typeof r=="object"&&r?Ti(r,Vi):r}function Xi(r,e){for(let n=0;n<r.length;n++)if(e.indexOf(r[n])>=0)return!0;return!1}const jn={};function Ki(r){jn[r]||(typeof console<"u"&&console.warn(r),jn[r]=!0)}function Sr(r,e,n){return(n.y-r.y)*(e.x-r.x)>(e.y-r.y)*(n.x-r.x)}function Xr(r){let e=0;for(let n,l,u=0,f=r.length,p=f-1;u<f;p=u++)n=r[u],l=r[p],e+=(l.x-n.x)*(n.y+l.y);return e}function Br([r,e,n]){const l=pn(e+90),u=pn(n);return{x:r*Math.cos(l)*Math.sin(u),y:r*Math.sin(l)*Math.sin(u),z:r*Math.cos(u),azimuthal:e,polar:n}}function Nn(r){return(typeof self<"u"||r!==void 0)&&typeof WorkerGlobalScope<"u"&&(r!==void 0?r:self)instanceof WorkerGlobalScope}function _n(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,l,u,f)=>{const p=u||f;return e[l]=!p||p.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let yr=null;function cr(r,e){return[r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]]}function nr(r,e,n,l){for(;e<n;){const u=e+n>>1;r[u]<l?e=u+1:n=u}return e}function ls(r,e,n,l){for(;e<n;){const u=e+n>>1;r[u]<=l?e=u+1:n=u}return e}function ro(r){return r>0?1/(1.001-r):1+r}function Ns(r){return r>0?1-1/(1.001-r):-r}function jd(r,e,n){return(r-e.min)*(n.max-n.min)/(e.max-e.min)+n.min}const gs={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!gs.API_URL)return null;try{const r=new URL(gs.API_URL);return r.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":r.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.1.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Pl(r){return gs.API_URL_REGEX.test(r)}function cf(r){return gs.API_SPRITE_REGEX.test(r)}let Bd,Vd,uf,df,pc,Ud;function hf(){return Bd==null&&(Bd=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Bd}const fa={now:()=>df!==void 0?df:performance.now(),setNow(r){df=r},restoreNow(){df=void 0},frame(r){const e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){const{width:n,height:l}=r;pc||(pc=document.createElement("canvas"));const u=pc.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(n>pc.width||l>pc.height)&&(pc.width=n,pc.height=l),u.clearRect(-e,-e,n+2*e,l+2*e),u.drawImage(r,0,0,n,l),u.getImageData(-e,-e,n+2*e,l+2*e)},resolveURL:r=>(Vd||(Vd=document.createElement("a")),Vd.href=r,Vd.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(uf==null&&(uf=window.matchMedia("(prefers-reduced-motion: reduce)")),uf.matches)},hasCanvasFingerprintNoise(){if(Ud!==void 0)return Ud;if(!hf())return Ud=!1,!1;const r=new OffscreenCanvas(85,1),e=r.getContext("2d",{willReadFrequently:!0});let n=0;for(let u=0;u<r.width;++u)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(u,0,1,1);const l=e.getImageData(0,0,r.width,r.height);n=0;for(let u=0;u<l.data.length;++u)if(u%4!=3&&n++!==l.data[u])return Ud=!0,!0;return Ud=!1,!1}};function Po(r,e){const n=r.indexOf("?");if(n<0)return`${r}?${new URLSearchParams(e).toString()}`;const l=new URLSearchParams(r.slice(n));for(const u in e)l.set(u,e[u]);return`${r.slice(0,n)}?${l.toString()}`}function Yo(r,e={persistentParams:[]}){const n=r.indexOf("?");if(n<0)return r;const l=new URLSearchParams,u=new URLSearchParams(r.slice(n));for(const p of e.persistentParams){const y=u.get(p);y&&l.set(p,y)}const f=l.toString();return`${r.slice(0,n)}${f.length>0?`?${f}`:""}`}const Ya="mapbox-tiles";let pa=500,Ja=50;const Gd=["language","worldview","jobid"];let Da,$d;function mc(){try{return caches}catch{}}function nu(){const r=mc();r&&Da==null&&(Da=r.open(Ya))}let Nm=1/0;const Lm={supported:!1,testSupport:function(r){!Hd&&gc&&(ru?ox(r):so=r)}};let so,gc,Hd=!1,ru=!1;const sx=typeof self<"u"?self:{};function ox(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,gc),r.isContextLost())return;Lm.supported=!0}catch{}r.deleteTexture(e),Hd=!0}sx.document&&(gc=sx.document.createElement("img"),gc.onload=function(){so&&ox(so),so=null,ru=!0},gc.onerror=function(){Hd=!0,so=null},gc.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const qd={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(qd);class ln extends Error{constructor(e,n,l){n===401&&Pl(l)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ff=Nn()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,su=function(r,e){if(!(/^file:/.test(n=r.url)||/^file:/.test(ff())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(l,u){const f=new AbortController,p=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:ff(),referrerPolicy:l.referrerPolicy,signal:f.signal});let y=!1,b=!1;const S=(A=p.url).indexOf("sku=")>0&&Pl(A);var A;l.type==="json"&&p.headers.set("Accept","application/json");const P=(N,L,U)=>{if(b)return;if(N&&N.message!=="SecurityError"&&Ki(N.toString()),L&&U)return M(L);const H=Date.now();fetch(p).then(K=>{if(K.ok){const se=S?K.clone():null;return M(K,se,H)}return u(new ln(K.statusText,K.status,l.url))}).catch(K=>{K.name!=="AbortError"&&u(new Error(`${K.message} ${l.url}`))})},M=(N,L,U)=>{(l.type==="arrayBuffer"?N.arrayBuffer():l.type==="json"?N.json():N.text()).then(H=>{b||(L&&U&&function(K,se,re){if(nu(),Da==null)return;const le=_n(se.headers.get("Cache-Control")||"");if(le["no-store"])return;const Ee={status:se.status,statusText:se.statusText,headers:new Headers};se.headers.forEach((Me,De)=>Ee.headers.set(De,Me)),le["max-age"]&&Ee.headers.set("Expires",new Date(re+1e3*le["max-age"]).toUTCString());const we=Ee.headers.get("Expires");if(!we||new Date(we).getTime()-re<42e4)return;let Se=Yo(K.url,{persistentParams:Gd});if(se.status===206){const Me=K.headers.get("Range");if(!Me)return;Ee.status=200,Se=Po(Se,{range:Me})}(function(Me,De){if($d===void 0)try{new Response(new ReadableStream),$d=!0}catch{$d=!1}$d?De(Me.body):Me.blob().then(De).catch(Xe=>Ki(Xe.message))})(se,Me=>{const De=new Response((Xe=se.status)!==200&&Xe!==404&&[101,103,204,205,304].includes(Xe)?null:Me,Ee);var Xe;nu(),Da!=null&&Da.then(Le=>Le.put(Se,De)).catch(Le=>Ki(Le.message))})}(p,L,U),y=!0,u(null,H,N.headers.get("Cache-Control"),N.headers.get("Expires")))}).catch(H=>{b||u(new Error(H.message))})};return S?function(N,L){if(nu(),Da==null)return L(null);Da.then(U=>{let H=Yo(N.url,{persistentParams:Gd});const K=N.headers.get("Range");K&&(H=Po(H,{range:K})),U.match(H).then(se=>{const re=function(le){if(!le)return!1;const Ee=new Date(le.headers.get("Expires")||0),we=_n(le.headers.get("Cache-Control")||"");return Number(Ee)>Date.now()&&!we["no-cache"]}(se);U.delete(H).catch(L),re&&U.put(H,se.clone()).catch(L),L(null,se,re)}).catch(L)}).catch(L)}(p,P):P(null,null),{cancel:()=>{b=!0,y||f.abort()}}}(r,e);if(Nn(self)&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var n;return function(l,u){const f=new XMLHttpRequest;f.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(f.responseType="arraybuffer");for(const p in l.headers)f.setRequestHeader(p,l.headers[p]);return l.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=l.credentials==="include",f.onerror=()=>{u(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let p=f.response;if(l.type==="json")try{p=JSON.parse(f.response)}catch(y){return u(y)}u(null,p,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else u(new ln(f.statusText,f.status,l.url))},f.send(l.body),{cancel:()=>f.abort()}}(r,e)},Wd=function(r,e){return su(Ve(r,{type:"arrayBuffer"}),e)};function Uw(r){const e=document.createElement("a");return e.href=r,e.protocol===location.protocol&&e.host===location.host}const Zd="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let _c,Ml;_c=[],Ml=0;const Xd=function(r,e){if(Lm.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),Ml>=gs.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return _c.push(f),f}Ml++;let n=!1;const l=()=>{if(!n)for(n=!0,Ml--;_c.length&&Ml<gs.MAX_PARALLEL_IMAGE_REQUESTS;){const f=_c.shift(),{requestParameters:p,callback:y,cancelled:b}=f;b||(f.cancel=Xd(p,y).cancel)}},u=Wd(r,(f,p,y,b)=>{l(),f?e(f):p&&(self.createImageBitmap?function(S,A){const P=new Blob([new Uint8Array(S)],{type:"image/png"});createImageBitmap(P).then(M=>{A(null,M)}).catch(M=>{A(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(S,A)=>e(S,A,y,b)):function(S,A){const P=new Image;P.onload=()=>{A(null,P),URL.revokeObjectURL(P.src),P.onload=null,requestAnimationFrame(()=>{P.src=Zd})},P.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const M=new Blob([new Uint8Array(S)],{type:"image/png"});P.src=S.byteLength?URL.createObjectURL(M):Zd}(p,(S,A)=>e(S,A,y,b)))});return{cancel:()=>{u.cancel(),l()}}};var ax,pf,lx,ou={exports:{}},yc={exports:{}},cx={exports:{}},Kd=function(){if(lx)return ou.exports;lx=1;var r=(ax||(ax=1,yc.exports=function(n,l){var u,f,p,y,b,S,A,P;for(f=n.length-(u=3&n.length),p=l,b=3432918353,S=461845907,P=0;P<f;)A=255&n.charCodeAt(P)|(255&n.charCodeAt(++P))<<8|(255&n.charCodeAt(++P))<<16|(255&n.charCodeAt(++P))<<24,++P,p=27492+(65535&(y=5*(65535&(p=(p^=A=(65535&(A=(A=(65535&A)*b+(((A>>>16)*b&65535)<<16)&4294967295)<<15|A>>>17))*S+(((A>>>16)*S&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(A=0,u){case 3:A^=(255&n.charCodeAt(P+2))<<16;case 2:A^=(255&n.charCodeAt(P+1))<<8;case 1:p^=A=(65535&(A=(A=(65535&(A^=255&n.charCodeAt(P)))*b+(((A>>>16)*b&65535)<<16)&4294967295)<<15|A>>>17))*S+(((A>>>16)*S&65535)<<16)&4294967295}return p^=n.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}),yc.exports),e=(pf||(pf=1,cx.exports=function(n,l){for(var u,f=n.length,p=l^f,y=0;f>=4;)u=1540483477*(65535&(u=255&n.charCodeAt(y)|(255&n.charCodeAt(++y))<<8|(255&n.charCodeAt(++y))<<16|(255&n.charCodeAt(++y))<<24))+((1540483477*(u>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++y;switch(f){case 3:p^=(255&n.charCodeAt(y+2))<<16;case 2:p^=(255&n.charCodeAt(y+1))<<8;case 1:p=1540483477*(65535&(p^=255&n.charCodeAt(y)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}),cx.exports);return ou.exports=r,ou.exports.murmur3=r,ou.exports.murmur2=e,ou.exports}(),au=$s(Kd);class Qa{constructor(e,...n){Ve(this,n[0]||{}),this.type=e}}class Mo extends Qa{constructor(e,n={}){super("error",Ve({error:e},n))}}function zm(r,e,n){n[r]&&n[r].indexOf(e)!==-1||(n[r]=n[r]||[],n[r].push(e))}function Om(r,e,n){if(n&&n[r]){const l=n[r].indexOf(e);l!==-1&&n[r].splice(l,1)}}class xc{on(e,n){return this._listeners=this._listeners||{},zm(e,n,this._listeners),this}off(e,n){return Om(e,n,this._listeners),Om(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},zm(e,n,this._oneTimeListeners),this):new Promise(l=>{this.once(e,l)})}fire(e,n){const l=typeof e=="string"?new Qa(e,n):e,u=l.type;if(this.listens(u)){l.target=this;const f=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const b of f)b.call(this,l);const p=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const b of p)Om(u,b,this._oneTimeListeners),b.call(this,l);const y=this._eventedParent;y&&(Ve(l,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(l))}else l instanceof Mo&&console.error(l.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}class _o{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new _o(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[n,l]=e.split("");return new _o({name:n,iconsetId:l})}static isEqual(e,n){return e.name===n.name&&e.iconsetId===n.iconsetId}toString(){return _o.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Fm,mf={},jm=function(){if(Fm)return mf;Fm=1;var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(f){return(f=Math.round(f))<0?0:f>255?255:f}function n(f){return e(f[f.length-1]==="%"?parseFloat(f)/100*255:parseInt(f))}function l(f){return(p=f[f.length-1]==="%"?parseFloat(f)/100:parseFloat(f))<0?0:p>1?1:p;var p}function u(f,p,y){return y<0?y+=1:y>1&&(y-=1),6*y<1?f+(p-f)*y*6:2*y<1?p:3*y<2?f+(p-f)*(2/3-y)*6:f}try{mf.parseCSSColor=function(f){var p,y=f.replace(/ /g,"").toLowerCase();if(y in r)return r[y].slice();if(y[0]==="#")return y.length===4?(p=parseInt(y.substr(1),16))>=0&&p<=4095?[(3840&p)>>4|(3840&p)>>8,240&p|(240&p)>>4,15&p|(15&p)<<4,1]:null:y.length===7&&(p=parseInt(y.substr(1),16))>=0&&p<=16777215?[(16711680&p)>>16,(65280&p)>>8,255&p,1]:null;var b=y.indexOf("("),S=y.indexOf(")");if(b!==-1&&S+1===y.length){var A=y.substr(0,b),P=y.substr(b+1,S-(b+1)).split(","),M=1;switch(A){case"rgba":if(P.length!==4)return null;M=l(P.pop());case"rgb":return P.length!==3?null:[n(P[0]),n(P[1]),n(P[2]),M];case"hsla":if(P.length!==4)return null;M=l(P.pop());case"hsl":if(P.length!==3)return null;var N=(parseFloat(P[0])%360+360)%360/360,L=l(P[1]),U=l(P[2]),H=U<=.5?U*(L+1):U+L-U*L,K=2*U-H;return[e(255*u(K,H,N+1/3)),e(255*u(K,H,N)),e(255*u(K,H,N-1/3)),M];default:return null}}return null}}catch{}return mf}();class bn{constructor(e,n,l,u=1){this.r=e,this.g=n,this.b=l,this.a=u}static parse(e){if(!e)return;if(e instanceof bn)return e;if(typeof e!="string")return;const n=jm.parseCSSColor(e);return n?new bn(n[0]/255,n[1]/255,n[2]/255,n[3]):void 0}toString(){const[e,n,l,u]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*n)},${Math.round(255*l)},${u})`}toNonPremultipliedRenderColor(e){const{r:n,g:l,b:u,a:f}=this;return new lu(e,n,l,u,f)}toPremultipliedRenderColor(e){const{r:n,g:l,b:u,a:f}=this;return new ux(e,n*f,l*f,u*f,f)}clone(){return new bn(this.r,this.g,this.b,this.a)}}class Yd{constructor(e,n,l,u,f,p=!1){if(this.premultiplied=!1,this.premultiplied=p,e){const y=e.image.height,b=y*y;this.premultiplied?(n=f===0?0:n/f*(y-1),l=f===0?0:l/f*(y-1),u=f===0?0:u/f*(y-1)):(n*=y-1,l*=y-1,u*=y-1);const S=Math.floor(n),A=Math.floor(l),P=Math.floor(u),M=Math.ceil(n),N=Math.ceil(l),L=Math.ceil(u),U=n-S,H=l-A,K=u-P,se=e.image.data,re=4*(S+A*b+P*y),le=4*(S+A*b+L*y),Ee=4*(S+N*b+P*y),we=4*(S+N*b+L*y),Se=4*(M+A*b+P*y),Me=4*(M+A*b+L*y),De=4*(M+N*b+P*y),Xe=4*(M+N*b+L*y);if(re<0||Xe>=se.length)throw new Error("out of range");this.r=si(si(si(se[re],se[le],K),si(se[Ee],se[we],K),H),si(si(se[Se],se[Me],K),si(se[De],se[Xe],K),H),U)/255*(this.premultiplied?f:1),this.g=si(si(si(se[re+1],se[le+1],K),si(se[Ee+1],se[we+1],K),H),si(si(se[Se+1],se[Me+1],K),si(se[De+1],se[Xe+1],K),H),U)/255*(this.premultiplied?f:1),this.b=si(si(si(se[re+2],se[le+2],K),si(se[Ee+2],se[we+2],K),H),si(si(se[Se+2],se[Me+2],K),si(se[De+2],se[Xe+2],K),H),U)/255*(this.premultiplied?f:1),this.a=f}else this.r=n,this.g=l,this.b=u,this.a=f}toArray(){const{r:e,g:n,b:l,a:u}=this;return[255*e,255*n,255*l,u]}toHslaArray(){let{r:e,g:n,b:l,a:u}=this;if(this.premultiplied){if(u===0)return[0,0,0,0];e/=u,n/=u,l/=u}const f=Math.min(Math.max(e,0),1),p=Math.min(Math.max(n,0),1),y=Math.min(Math.max(l,0),1),b=Math.min(f,p,y),S=Math.max(f,p,y),A=(b+S)/2;if(b===S)return[0,0,100*A,u];const P=S-b,M=A>.5?P/(2-S-b):P/(S+b);let N=0;return S===f?N=(p-y)/P+(p<y?6:0):S===p?N=(y-f)/P+2:S===y&&(N=(f-p)/P+4),N*=60,[Math.min(Math.max(N,0),360),Math.min(Math.max(100*M,0),100),Math.min(Math.max(100*A,0),100),u]}toArray01(){const{r:e,g:n,b:l,a:u}=this;return[e,n,l,u]}toArray01Scaled(e){const{r:n,g:l,b:u}=this;return[n*e,l*e,u*e]}toArray01Linear(){const{r:e,g:n,b:l,a:u}=this;return[Math.pow(e,2.2),Math.pow(n,2.2),Math.pow(l,2.2),u]}}class lu extends Yd{constructor(e,n,l,u,f){super(e,n,l,u,f,!1)}}class ux extends Yd{constructor(e,n,l,u,f){super(e,n,l,u,f,!0)}}function si(r,e,n){return r*(1-n)+e*n}function dx(r,e,n){return r.map((l,u)=>si(l,e[u],n))}bn.black=new bn(0,0,0,1),bn.white=new bn(1,1,1,1),bn.transparent=new bn(0,0,0,0),bn.red=new bn(1,0,0,1),bn.blue=new bn(0,0,1,1);var Jd=Object.freeze({__proto__:null,array:dx,color:function(r,e,n){return new bn(si(r.r,e.r,n),si(r.g,e.g,n),si(r.b,e.b,n),si(r.a,e.a,n))},number:si});function vc(r,...e){for(const n of e)for(const l in n)r[l]=n[l];return r}class Ro extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class Bm{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[l,u]of n)this.bindings[l]=u}concat(e){return new Bm(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const cu={kind:"null"},Jt={kind:"number"},vn={kind:"string"},wn={kind:"boolean"},yo={kind:"color"},el={kind:"object"},Sn={kind:"value"},gf={kind:"collator"},Qd={kind:"formatted"},eh={kind:"resolvedImage"};function Ls(r,e){return{kind:"array",itemType:r,N:e}}function Vr(r){if(r.kind==="array"){const e=Vr(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const Gw=[cu,Jt,vn,wn,yo,Qd,el,Ls(Sn),eh];function uu(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!uu(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const n of Gw)if(!uu(n,e))return null}}return`Expected ${Vr(r)} but found ${Vr(e)} instead.`}function Rl(r,e){return e.some(n=>n.kind===r.kind)}function th(r,e){return e.some(n=>n==="null"?r===null:n==="array"?Array.isArray(r):n==="object"?r&&!Array.isArray(r)&&typeof r=="object":n===typeof r)}function _f(r,e){return r.kind==="array"&&e.kind==="array"?r.N===e.N&&_f(r.itemType,e.itemType):r.kind===e.kind}class ih{constructor(e,n,l){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class yf{constructor(e,n,l,u,f){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=l,this.fontStack=u,this.textColor=f}}class Hs{constructor(e){this.sections=e}static fromString(e){return new Hs([new yf(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof Hs?e:Hs.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){const u=n.image.getPrimary().id.toString();e.push(["image",u]);continue}e.push(n.text);const l={};n.fontStack&&(l["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(l["font-scale"]=n.scale),n.textColor&&(l["text-color"]=["rgba"].concat(n.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(l)}return e}}class tl{constructor(e,n={}){if(this.id=_o.from(e),this.options=Object.assign({},n),n.transform){const{a:l,b:u,c:f,d:p,e:y,f:b}=n.transform;this.options.transform=new DOMMatrix([l,u,f,p,y,b])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:n,c:l,d:u,e:f,f:p}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:n,c:l,d:u,e:f,f:p}})}static parse(e){let n,l,u,f;try{({name:n,iconsetId:l,params:u,transform:f}=JSON.parse(e)||{})}catch{return null}if(!n)return null;const{a:p,b:y,c:b,d:S,e:A,f:P}=f||{};return new tl({name:n,iconsetId:l},{params:u,transform:new DOMMatrix([p,y,b,S,A,P])})}scaleSelf(e,n){return this.options.transform.scaleSelf(e,n),this}}class oo{constructor(e,n,l,u,f=!1){this.primaryId=_o.from(e),this.primaryOptions=n,l&&(this.secondaryId=_o.from(l)),this.secondaryOptions=u,this.available=f}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new tl(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new tl(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?oo.build({name:e}):e}static build(e,n,l,u){return!e||typeof e=="object"&&!("name"in e)?null:new oo(e,l,n,u)}}function wc(r,e,n,l){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[r,e,n,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[r,e,n,l]:[r,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ni(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof bn||r instanceof ih||r instanceof Hs||r instanceof oo)return!0;if(Array.isArray(r)){for(const e of r)if(!Ni(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!Ni(r[e]))return!1;return!0}return!1}function Ft(r){if(r===null)return cu;if(typeof r=="string")return vn;if(typeof r=="boolean")return wn;if(typeof r=="number")return Jt;if(r instanceof bn)return yo;if(r instanceof ih)return gf;if(r instanceof Hs)return Qd;if(r instanceof oo)return eh;if(Array.isArray(r)){const e=r.length;let n;for(const l of r){const u=Ft(l);if(n){if(n===u)continue;n=Sn;break}n=u}return Ls(n||Sn,e)}return el}function Jo(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof Hs||r instanceof oo||r instanceof bn?r.toString():JSON.stringify(r)}class pi{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ni(e[1]))return n.error("invalid value");const l=e[1];let u=Ft(l);const f=n.expectedType;return u.kind!=="array"||u.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(u=f),new pi(u,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof bn?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Hs?this.value.serialize():this.value}}class Or{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const nh={string:vn,number:Jt,boolean:wn,object:el};class ai{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let l,u=1;const f=e[0];if(f==="array"){let y,b;if(e.length>2){const S=e[1];if(typeof S!="string"||!(S in nh)||S==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);y=nh[S],u++}else y=Sn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);b=e[2],u++}l=Ls(y,b)}else l=nh[f];const p=[];for(;u<e.length;u++){const y=n.parse(e[u],u,Sn);if(!y)return null;p.push(y)}return new ai(l,p)}evaluate(e){for(let n=0;n<this.args.length;n++){const l=this.args[n].evaluate(e);if(!uu(this.type,Ft(l)))return l;if(n===this.args.length-1)throw new Or(`The expression ${JSON.stringify(this.args[n].serialize())} evaluated to ${Vr(Ft(l))} but was expected to be of type ${Vr(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if(e.kind==="array"){const l=e.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){n.push(l.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&n.push(u)}}return n.concat(this.args.map(l=>l.serialize()))}}class du{constructor(e){this.type=Qd,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return n.error("First argument must be an image or text section.");const u=[];let f=!1;for(let p=1;p<=e.length-1;++p){const y=e[p];if(f&&typeof y=="object"&&!Array.isArray(y)){f=!1;let b=null;if(y["font-scale"]&&(b=n.parseObjectValue(y["font-scale"],p,"font-scale",Jt),!b))return null;let S=null;if(y["text-font"]&&(S=n.parseObjectValue(y["text-font"],p,"text-font",Ls(vn)),!S))return null;let A=null;if(y["text-color"]&&(A=n.parseObjectValue(y["text-color"],p,"text-color",yo),!A))return null;const P=u[u.length-1];P.scale=b,P.font=S,P.textColor=A}else{const b=n.parse(e[p],p,Sn);if(!b)return null;const S=b.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:b,scale:null,font:null,textColor:null})}}return new du(u)}evaluate(e){return new Hs(this.sections.map(n=>{const l=n.content.evaluate(e);return _f(Ft(l),eh)?new yf("",l,null,null,null):new yf(Jo(l),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const l={};n.scale&&(l["font-scale"]=n.scale.serialize()),n.font&&(l["text-font"]=n.font.serialize()),n.textColor&&(l["text-color"]=n.textColor.serialize()),e.push(l)}return e}}class hu{constructor(e,n,l,u){this._imageWarnHistory={},this.type=eh,this.namePrimary=e,this.nameSecondary=n,l&&(this.paramsPrimary=l.params,this.iconsetIdPrimary=l.iconset?l.iconset.id:void 0),u&&(this.paramsSecondary=u.params,this.iconsetIdSecondary=u.iconset?u.iconset.id:void 0)}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let l=1;const u=[];function f(){if(l<e.length){const y=n.parse(e[l],l++,vn);return y?(u.push({image:y,options:{}}),!0):(n.error(u.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function p(){if(l<e.length){const b=e[l];if((y=b)===null||typeof y!="object"||Array.isArray(y))return!0;const S=b.params,A=b.iconset,P=n.concat(l);if(!S&&!A)return l++,!0;if(S){if(typeof S!="object"||S.constructor!==Object)return P.error('Image options "params" should be an object'),!1;const M={},N=P.concat(void 0,"params");for(const L in S){if(!L)return N.error("Image parameter name should be non-empty"),!1;const U=N.concat(void 0,L).parse(S[L],void 0,yo,void 0,{typeAnnotation:"coerce"});if(!U)return!1;M[L]=U}u[u.length-1].options.params=M}if(A){if(typeof A!="object"||A.constructor!==Object)return P.error('Image options "iconset" should be an object'),!1;if(!A.id)return P.error('Image options "iconset" should have an "id" property'),!1;u[u.length-1].options.iconset=A}return l++,!0}var y;return!0}for(let y=0;y<2;y++)if(!f()||!p())return;return new hu(u[0].image,u[1]?u[1].image:void 0,u[0].options,u[1]?u[1].options:void 0)}evaluateParams(e,n){const l={};if(n){for(const u in n)if(n[u])try{l[u]=n[u].evaluate(e)}catch{continue}if(Object.keys(l).length!==0)return{params:l}}}evaluate(e){const n={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},l=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,u=oo.build(n,l,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(u&&e.availableImages){const f=u.getPrimary().id;if(u.available=e.availableImages.some(p=>_o.isEqual(p,f)),u.available){const p=u.getSecondary()?u.getSecondary().id:null;p&&(u.available=e.availableImages.some(y=>_o.isEqual(y,p)))}}return u}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const n in this.paramsPrimary)this.paramsPrimary[n]&&e(this.paramsPrimary[n]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const n in this.paramsSecondary)this.paramsSecondary[n]&&e(this.paramsSecondary[n])}outputDefined(){return!1}serializeOptions(e,n){const l={};if(n&&(l.iconset={id:n}),e){l.params={};for(const u in e)e[u]&&(l.params[u]=e[u].serialize())}return Object.keys(l).length>0?l:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const n=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);n&&e.push(n)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const n=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);n&&e.push(n)}return e}}function Dl(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}const hx={"to-boolean":wn,"to-color":yo,"to-number":Jt,"to-string":vn};class Qo{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const l=e[0],u=[];let f=cu;if(l==="to-array"){if(!Array.isArray(e[1]))return null;const p=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);f=Ls(n.expectedType.itemType,p)}else{if(!(p>0&&Ni(e[1][0])))return null;f=Ls(Ft(e[1][0]),p)}for(let y=0;y<p;y++){const b=e[1][y];let S;if(Dl(b)==="array")S=n.parse(b,void 0,f.itemType);else{const A=Dl(b);if(A!==f.itemType.kind)return n.error(`Expected ${f.itemType.kind} but found ${A}.`);S=n.registry.literal.parse(["literal",b===void 0?null:b],n)}if(!S)return null;u.push(S)}}else{if((l==="to-boolean"||l==="to-string")&&e.length!==2)return n.error("Expected one argument.");f=hx[l];for(let p=1;p<e.length;p++){const y=n.parse(e[p],p,Sn);if(!y)return null;u.push(y)}}return new Qo(f,u)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,l;for(const u of this.args){if(n=u.evaluate(e),l=null,n instanceof bn)return n;if(typeof n=="string"){const f=e.parseColor(n);if(f)return f}else if(Array.isArray(n)&&(l=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:wc(n[0],n[1],n[2],n[3]),!l))return new bn(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Or(l||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(const l of this.args){if(n=l.evaluate(e),n===null)return 0;const u=Number(n);if(!isNaN(u))return u}throw new Or(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?Hs.fromString(Jo(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?oo.build(Jo(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):Jo(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new du([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new hu(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}const qs=["Unknown","Point","LineString","Polygon"];class rh{constructor(e,n){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=n}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?qs[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:l,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*n-e[0])+this.featureDistanceData.bearing[1]*(u*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=bn.parse(e)),n}getConfig(e){return this.options?this.options.get(e):null}}class cs{constructor(e,n,l,u,f){this.name=e,this.type=n,this._evaluate=l,this.args=u,this._overloadIndex=f}evaluate(e){if(!this._evaluate){const n=cs.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const l=e[0],u=cs.definitions[l];if(!u)return n.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,p=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=[];let b=null,S=-1;for(const[A,P]of p){if(Array.isArray(A)&&A.length!==e.length-1)continue;y.push(A),S++,b=new Rf(n.registry,n.path,null,n.scope,void 0,n._scope,n.options);const M=[];let N=!1;for(let L=1;L<e.length;L++){const U=e[L],H=Array.isArray(A)?A[L-1]:A.type,K=b.parse(U,1+M.length,H);if(!K){N=!0;break}M.push(K)}if(!N)if(Array.isArray(A)&&A.length!==M.length)b.error(`Expected ${A.length} arguments, but found ${M.length} instead.`);else{for(let L=0;L<M.length;L++){const U=Array.isArray(A)?A[L]:A.type,H=M[L];b.concat(L+1).checkSubtype(U,H.type)}if(b.errors.length===0)return new cs(l,f,P,M,S)}}if(y.length===1)n.errors.push(...b.errors);else{const A=(y.length?y:p.map(([M])=>M)).map(Vm).join(" | "),P=[];for(let M=1;M<e.length;M++){const N=n.parse(e[M],1+P.length);if(!N)return null;P.push(Vr(N.type))}n.error(`Expected arguments of type ${A}, but found (${P.join(", ")}) instead.`)}return null}static register(e,n){cs.definitions=n;for(const l in n)e[l]=cs}}function Vm(r){return Array.isArray(r)?`(${r.map(Vr).join(", ")})`:`(${Vr(r.type)}...)`}class ka{constructor(e,n,l){this.type=gf,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return n.error("Collator options argument must be an object.");const u=l["case-sensitive"]===void 0?n.parse(!1,1,wn):n.parseObjectValue(l["case-sensitive"],1,"case-sensitive",wn);if(!u)return null;const f=l["diacritic-sensitive"]===void 0?n.parse(!1,1,wn):n.parseObjectValue(l["diacritic-sensitive"],1,"diacritic-sensitive",wn);if(!f)return null;let p=null;return l.locale&&(p=n.parseObjectValue(l.locale,1,"locale",vn),!p)?null:new ka(u,f,p)}evaluate(e){return new ih(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function zs(r,e,n=0,l=r.length-1,u=$w){for(;l>n;){if(l-n>600){const b=l-n+1,S=e-n+1,A=Math.log(b),P=.5*Math.exp(2*A/3),M=.5*Math.sqrt(A*P*(b-P)/b)*(S-b/2<0?-1:1);zs(r,e,Math.max(n,Math.floor(e-S*P/b+M)),Math.min(l,Math.floor(e+(b-S)*P/b+M)),u)}const f=r[e];let p=n,y=l;for(sh(r,n,e),u(r[l],f)>0&&sh(r,n,l);p<y;){for(sh(r,p,y),p++,y--;u(r[p],f)<0;)p++;for(;u(r[y],f)>0;)y--}u(r[n],f)===0?sh(r,n,y):(y++,sh(r,y,l)),y<=e&&(n=y+1),e<=y&&(l=y-1)}}function sh(r,e,n){const l=r[e];r[e]=r[n],r[n]=l}function $w(r,e){return r<e?-1:r>e?1:0}function Hw(r){let e=0;for(let n,l,u=0,f=r.length,p=f-1;u<f;p=u++)n=r[u],l=r[p],e+=(l.x-n.x)*(n.y+l.y);return e}function kl(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function fu(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function bc(r,e,n){const l=r[0]-e[0],u=r[1]-e[1],f=r[0]-n[0],p=r[1]-n[1];return l*p-f*u==0&&l*f<=0&&u*p<=0}function pu(r,e,n=!1){let l=!1;for(let y=0,b=e.length;y<b;y++){const S=e[y];for(let A=0,P=S.length,M=P-1;A<P;M=A++){const N=S[M],L=S[A];if(bc(r,N,L))return n;(f=N)[1]>(u=r)[1]!=(p=L)[1]>u[1]&&u[0]<(p[0]-f[0])*(u[1]-f[1])/(p[1]-f[1])+f[0]&&(l=!l)}}var u,f,p;return l}function fx(r,e,n,l){const u=l[0]-n[0],f=l[1]-n[1],p=(r[0]-n[0])*f-u*(r[1]-n[1]),y=(e[0]-n[0])*f-u*(e[1]-n[1]);return p>0&&y<0||p<0&&y>0}function xf(r,e,n,l){return(u=[l[0]-n[0],l[1]-n[1]])[0]*(f=[e[0]-r[0],e[1]-r[1]])[1]-u[1]*f[0]!=0&&!(!fx(r,e,n,l)||!fx(n,l,r,e));var u,f}function Um(r){const e=new ht(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),n=new ht(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const l of r[0])e.x>l.x&&(e.x=l.x),e.y>l.y&&(e.y=l.y),n.x<l.x&&(n.x=l.x),n.y<l.y&&(n.y=l.y);return{min:e,max:n}}const Nl=8192;function qw(r,e){const n=(180+r[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(n*u*Nl),Math.round(l*u*Nl)]}function px(r,e){for(let n=0;n<e.length;n++)if(pu(r,e[n]))return!0;return!1}function Ww(r,e,n){for(const l of n)for(let u=0,f=l.length,p=f-1;u<f;p=u++)if(xf(r,e,l[p],l[u]))return!0;return!1}function mx(r,e){for(let n=0;n<r.length;++n)if(!pu(r[n],e))return!1;for(let n=0;n<r.length-1;++n)if(Ww(r[n],r[n+1],e))return!1;return!0}function gx(r,e){for(let n=0;n<e.length;n++)if(mx(r,e[n]))return!0;return!1}function Gm(r,e,n){const l=[];for(let u=0;u<r.length;u++){const f=[];for(let p=0;p<r[u].length;p++){const y=qw(r[u][p],n);kl(e,y),f.push(y)}l.push(f)}return l}function Ll(r,e,n){const l=[];for(let u=0;u<r.length;u++){const f=Gm(r[u],e,n);l.push(f)}return l}function _x(r,e,n,l){if(r[0]<n[0]||r[0]>n[2]){const u=.5*l;let f=r[0]-n[0]>u?-l:n[0]-r[0]>u?l:0;f===0&&(f=r[0]-n[2]>u?-l:n[2]-r[0]>u?l:0),r[0]+=f}kl(e,r)}function yx(r,e,n,l){const u=Math.pow(2,l.z)*Nl,f=[l.x*Nl,l.y*Nl],p=[];if(!r)return p;for(const y of r)for(const b of y){const S=[b.x+f[0],b.y+f[1]];_x(S,e,n,u),p.push(S)}return p}function vf(r,e,n,l){const u=Math.pow(2,l.z)*Nl,f=[l.x*Nl,l.y*Nl],p=[];if(!r)return p;for(const b of r){const S=[];for(const A of b){const P=[A.x+f[0],A.y+f[1]];kl(e,P),S.push(P)}p.push(S)}if(e[2]-e[0]<=u/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const b of p)for(const S of b)_x(S,e,n,u)}var y;return p}class zl{constructor(e,n){this.type=wn,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ni(e[1])){const l=e[1];if(l.type==="FeatureCollection")for(let u=0;u<l.features.length;++u){const f=l.features[u].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new zl(l,l.features[u].geometry)}else if(l.type==="Feature"){const u=l.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new zl(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new zl(l,l)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,l){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if(l.type==="Polygon"){const y=Gm(l.coordinates,f,p),b=yx(n.geometry(),u,f,p);if(!fu(u,f))return!1;for(const S of b)if(!pu(S,y))return!1}if(l.type==="MultiPolygon"){const y=Ll(l.coordinates,f,p),b=yx(n.geometry(),u,f,p);if(!fu(u,f))return!1;for(const S of b)if(!px(S,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,l){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if(l.type==="Polygon"){const y=Gm(l.coordinates,f,p),b=vf(n.geometry(),u,f,p);if(!fu(u,f))return!1;for(const S of b)if(!mx(S,y))return!1}if(l.type==="MultiPolygon"){const y=Ll(l.coordinates,f,p),b=vf(n.geometry(),u,f,p);if(!fu(u,f))return!1;for(const S of b)if(!gx(S,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const oh={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},ea=1/298.257223563,$m=ea*(2-ea),mu=Math.PI/180;class gu{static fromTile(e,n,l){const u=Math.PI*(1-2*(e+.5)/Math.pow(2,n)),f=Math.atan(.5*(Math.exp(u)-Math.exp(-u)))/mu;return new gu(f,l)}static get units(){return oh}constructor(e,n){if(e===void 0)throw new Error("No latitude given.");if(n&&!oh[n])throw new Error(`Unknown unit ${n}. Use one of: ${Object.keys(oh).join(", ")}`);const l=6378.137*mu*(n?oh[n]:1),u=Math.cos(e*mu),f=1/(1-$m*(1-u*u)),p=Math.sqrt(f);this.kx=l*p*u,this.ky=l*p*f*(1-$m)}distance(e,n){const l=Do(e[0]-n[0])*this.kx,u=(e[1]-n[1])*this.ky;return Math.sqrt(l*l+u*u)}bearing(e,n){const l=Do(n[0]-e[0])*this.kx;return Math.atan2(l,(n[1]-e[1])*this.ky)/mu}destination(e,n,l){const u=l*mu;return this.offset(e,Math.sin(u)*n,Math.cos(u)*n)}offset(e,n,l){return[e[0]+n/this.kx,e[1]+l/this.ky]}lineDistance(e){let n=0;for(let l=0;l<e.length-1;l++)n+=this.distance(e[l],e[l+1]);return n}area(e){let n=0;for(let l=0;l<e.length;l++){const u=e[l];for(let f=0,p=u.length,y=p-1;f<p;y=f++)n+=Do(u[f][0]-u[y][0])*(u[f][1]+u[y][1])*(l?-1:1)}return Math.abs(n)/2*this.kx*this.ky}along(e,n){let l=0;if(n<=0)return e[0];for(let u=0;u<e.length-1;u++){const f=e[u],p=e[u+1],y=this.distance(f,p);if(l+=y,l>n)return wf(f,p,(n-(l-y))/y)}return e[e.length-1]}pointToSegmentDistance(e,n,l){let[u,f]=n,p=Do(l[0]-u)*this.kx,y=(l[1]-f)*this.ky;if(p!==0||y!==0){const b=(Do(e[0]-u)*this.kx*p+(e[1]-f)*this.ky*y)/(p*p+y*y);b>1?(u=l[0],f=l[1]):b>0&&(u+=p/this.kx*b,f+=y/this.ky*b)}return p=Do(e[0]-u)*this.kx,y=(e[1]-f)*this.ky,Math.sqrt(p*p+y*y)}pointOnLine(e,n){let l=1/0,u=e[0][0],f=e[0][1],p=0,y=0;for(let b=0;b<e.length-1;b++){let S=e[b][0],A=e[b][1],P=Do(e[b+1][0]-S)*this.kx,M=(e[b+1][1]-A)*this.ky,N=0;P===0&&M===0||(N=(Do(n[0]-S)*this.kx*P+(n[1]-A)*this.ky*M)/(P*P+M*M),N>1?(S=e[b+1][0],A=e[b+1][1]):N>0&&(S+=P/this.kx*N,A+=M/this.ky*N)),P=Do(n[0]-S)*this.kx,M=(n[1]-A)*this.ky;const L=P*P+M*M;L<l&&(l=L,u=S,f=A,p=b,y=N)}return{point:[u,f],index:p,t:Math.max(0,Math.min(1,y))}}lineSlice(e,n,l){let u=this.pointOnLine(l,e),f=this.pointOnLine(l,n);if(u.index>f.index||u.index===f.index&&u.t>f.t){const S=u;u=f,f=S}const p=[u.point],y=u.index+1,b=f.index;!Hm(l[y],p[0])&&y<=b&&p.push(l[y]);for(let S=y+1;S<=b;S++)p.push(l[S]);return Hm(l[b],f.point)||p.push(f.point),p}lineSliceAlong(e,n,l){let u=0;const f=[];for(let p=0;p<l.length-1;p++){const y=l[p],b=l[p+1],S=this.distance(y,b);if(u+=S,u>e&&f.length===0&&f.push(wf(y,b,(e-(u-S))/S)),u>=n)return f.push(wf(y,b,(n-(u-S))/S)),f;u>e&&f.push(b)}return f}bufferPoint(e,n){const l=n/this.ky,u=n/this.kx;return[e[0]-u,e[1]-l,e[0]+u,e[1]+l]}bufferBBox(e,n){const l=n/this.ky,u=n/this.kx;return[e[0]-u,e[1]-l,e[2]+u,e[3]+l]}insideBBox(e,n){return Do(e[0]-n[0])>=0&&Do(e[0]-n[2])<=0&&e[1]>=n[1]&&e[1]<=n[3]}}function Hm(r,e){return r[0]===e[0]&&r[1]===e[1]}function wf(r,e,n){const l=Do(e[0]-r[0]);return[r[0]+l*n,r[1]+(e[1]-r[1])*n]}function Do(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}class bf{constructor(e=[],n=(l,u)=>l<u?-1:l>u?1:0){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:l}=this,u=n[e];for(;e>0;){const f=e-1>>1,p=n[f];if(l(u,p)>=0)break;n[e]=p,e=f}n[e]=u}_down(e){const{data:n,compare:l}=this,u=this.length>>1,f=n[e];for(;e<u;){let p=1+(e<<1);const y=p+1;if(y<this.length&&l(n[y],n[p])<0&&(p=y),l(n[p],f)>=0)break;n[e]=n[p],e=p}n[e]=f}}var Et=8192;function qm(r,e){return e.dist-r.dist}const Sf=100,Tf=50;function ah(r){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==r.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==r[n])return!1;return!0}function Sc(r){return r[1]-r[0]+1}function ta(r,e){const n=r[1]>=r[0]&&r[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function Ef(r,e){if(r[0]>r[1])return[null,null];const n=Sc(r);if(e){if(n===2)return[r,null];const l=Math.floor(n/2);return[[r[0],r[0]+l],[r[0]+l,r[1]]]}{if(n===1)return[r,null];const l=Math.floor(n/2)-1;return[[r[0],r[0]+l],[r[0]+l+1,r[1]]]}}function Ol(r,e){const n=[1/0,1/0,-1/0,-1/0];if(!ta(e,r.length))return n;for(let l=e[0];l<=e[1];++l)kl(n,r[l]);return n}function lh(r){const e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<r.length;++n)for(let l=0;l<r[n].length;++l)kl(e,r[n][l]);return e}function ma(r,e,n){if(ah(r)||ah(e))return NaN;let l=0,u=0;return r[2]<e[0]&&(l=e[0]-r[2]),r[0]>e[2]&&(l=r[0]-e[2]),r[1]>e[3]&&(u=r[1]-e[3]),r[3]<e[1]&&(u=e[1]-r[3]),n.distance([0,0],[l,u])}function Ji(r){return 360*r-180}function Zw(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Wm(r,e){const n=Math.pow(2,e.z),l=(r.y/Et+e.y)/n;return[Ji((r.x/Et+e.x)/n),Zw(l)]}function Xw(r,e){const n=[];for(let l=0;l<r.length;++l)n.push(Wm(r[l],e));return n}function Zm(r,e,n){const l=n.pointOnLine(e,r).point;return n.distance(r,l)}function xx(r,e,n,l,u){const f=n.slice(l[0],l[1]+1);let p=1/0;for(let y=e[0];y<=e[1];++y)if((p=Math.min(p,Zm(r[y],f,u)))===0)return 0;return p}function tr(r,e,n,l,u){const f=Math.min(u.pointToSegmentDistance(r,n,l),u.pointToSegmentDistance(e,n,l)),p=Math.min(u.pointToSegmentDistance(n,r,e),u.pointToSegmentDistance(l,r,e));return Math.min(f,p)}function Kw(r,e,n,l,u){if(!ta(e,r.length)||!ta(l,n.length))return NaN;let f=1/0;for(let p=e[0];p<e[1];++p)for(let y=l[0];y<l[1];++y){if(xf(r[p],r[p+1],n[y],n[y+1]))return 0;f=Math.min(f,tr(r[p],r[p+1],n[y],n[y+1],u))}return f}function Yw(r,e,n,l,u){if(!ta(e,r.length)||!ta(l,n.length))return NaN;let f=1/0;for(let p=e[0];p<=e[1];++p)for(let y=l[0];y<=l[1];++y)if((f=Math.min(f,u.distance(r[p],n[y])))===0)return f;return f}function Jw(r,e,n){if(pu(r,e,!0))return 0;let l=1/0;for(const u of e){const f=u.length;if(f<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(u[0]!==u[f-1]&&(l=Math.min(l,n.pointToSegmentDistance(r,u[f-1],u[0])))===0||(l=Math.min(l,Zm(r,u,n)))===0)return l}return l}function Qw(r,e,n,l){if(!ta(e,r.length))return NaN;for(let f=e[0];f<=e[1];++f)if(pu(r[f],n,!0))return 0;let u=1/0;for(let f=e[0];f<e[1];++f)for(const p of n)for(let y=0,b=p.length,S=b-1;y<b;S=y++){if(xf(r[f],r[f+1],p[S],p[y]))return 0;u=Math.min(u,tr(r[f],r[f+1],p[S],p[y],l))}return u}function vx(r,e){for(const n of r)for(let l=0;l<=n.length-1;++l)if(pu(n[l],e,!0))return!0;return!1}function eb(r,e,n,l=1/0){const u=lh(r),f=lh(e);if(l!==1/0&&ma(u,f,n)>=l)return l;if(fu(u,f)){if(vx(r,e))return 0}else if(vx(e,r))return 0;let p=l;for(const y of r)for(let b=0,S=y.length,A=S-1;b<S;A=b++)for(const P of e)for(let M=0,N=P.length,L=N-1;M<N;L=M++){if(xf(y[A],y[b],P[L],P[M]))return 0;p=Math.min(p,tr(y[A],y[b],P[L],P[M],n))}return p}function Cf(r,e,n,l,u,f,p){if(f===null||p===null)return;const y=ma(Ol(l,f),Ol(u,p),n);y<e&&r.push({dist:y,range1:f,range2:p})}function tb(r,e,n,l,u=1/0){let f=Math.min(l.distance(r[0],n[0][0]),u);if(f===0)return f;const p=new bf([{dist:0,range1:[0,r.length-1],range2:[0,0]}],qm),y=e?Tf:Sf,b=lh(n);for(;p.length;){const S=p.pop();if(S.dist>=f)continue;const A=S.range1;if(Sc(A)<=y){if(!ta(A,r.length))return NaN;if(e){const P=Qw(r,A,n,l);if((f=Math.min(f,P))===0)return f}else for(let P=A[0];P<=A[1];++P){const M=Jw(r[P],n,l);if((f=Math.min(f,M))===0)return f}}else{const P=Ef(A,e);if(P[0]!==null){const M=ma(Ol(r,P[0]),b,l);M<f&&p.push({dist:M,range1:P[0],range2:[0,0]})}if(P[1]!==null){const M=ma(Ol(r,P[1]),b,l);M<f&&p.push({dist:M,range1:P[1],range2:[0,0]})}}}return f}function wx(r,e,n,l,u,f=1/0){let p=Math.min(f,u.distance(r[0],n[0]));if(p===0)return p;const y=new bf([{dist:0,range1:[0,r.length-1],range2:[0,n.length-1]}],qm),b=e?Tf:Sf,S=l?Tf:Sf;for(;y.length;){const A=y.pop();if(A.dist>=p)continue;const P=A.range1,M=A.range2;if(Sc(P)<=b&&Sc(M)<=S){if(!ta(P,r.length)||!ta(M,n.length))return NaN;if(e&&l?p=Math.min(p,Kw(r,P,n,M,u)):e||l?e&&!l?p=Math.min(p,xx(n,M,r,P,u)):!e&&l&&(p=Math.min(p,xx(r,P,n,M,u))):p=Math.min(p,Yw(r,P,n,M,u)),p===0)return p}else{const N=Ef(P,e),L=Ef(M,l);Cf(y,p,u,r,n,N[0],L[0]),Cf(y,p,u,r,n,N[0],L[1]),Cf(y,p,u,r,n,N[1],L[0]),Cf(y,p,u,r,n,N[1],L[1])}}return p}function Xm(r,e,n,l,u=1/0){let f=u;const p=Ol(r,[0,r.length-1]);for(const y of n)if(!(f!==1/0&&ma(p,Ol(y,[0,y.length-1]),l)>=f)&&(f=Math.min(f,wx(r,e,y,!0,l,f)),f===0))return f;return f}function Af(r,e,n,l,u=1/0){let f=u;const p=Ol(r,[0,r.length-1]);for(const y of n){if(f!==1/0&&ma(p,lh(y),l)>=f)continue;const b=tb(r,e,y,l,f);if(isNaN(b))return b;if((f=Math.min(f,b))===0)return f}return f}function Km(r){return r==="Point"||r==="MultiPoint"||r==="LineString"||r==="MultiLineString"||r==="Polygon"||r==="MultiPolygon"}class Tc{constructor(e,n){this.type=Jt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Ni(e[1])){const l=e[1];if(l.type==="FeatureCollection"){for(let u=0;u<l.features.length;++u)if(Km(l.features[u].geometry.type))return new Tc(l,l.features[u].geometry)}else if(l.type==="Feature"){if(Km(l.geometry.type))return new Tc(l,l.geometry)}else if(Km(l.type))return new Tc(l,l)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const n=e.geometry(),l=e.canonicalID();if(n!=null&&l!=null){if(e.geometryType()==="Point")return function(u,f,p){const y=[];for(const S of u)for(const A of S)y.push(Wm(A,f));const b=new gu(y[0][1],"meters");return p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString"?wx(y,!1,p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",b):p.type==="MultiLineString"?Xm(y,!1,p.coordinates,b):p.type==="Polygon"||p.type==="MultiPolygon"?Af(y,!1,p.type==="Polygon"?[p.coordinates]:p.coordinates,b):null}(n,l,this.geometries);if(e.geometryType()==="LineString")return function(u,f,p){const y=[];for(const S of u){const A=[];for(const P of S)A.push(Wm(P,f));y.push(A)}const b=new gu(y[0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Xm(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",y,b);if(p.type==="MultiLineString"){let S=1/0;for(let A=0;A<p.coordinates.length;A++){const P=Xm(p.coordinates[A],!0,y,b,S);if(isNaN(P))return P;if((S=Math.min(S,P))===0)return S}return S}if(p.type==="Polygon"||p.type==="MultiPolygon"){let S=1/0;for(let A=0;A<y.length;A++){const P=Af(y[A],!0,p.type==="Polygon"?[p.coordinates]:p.coordinates,b,S);if(isNaN(P))return P;if((S=Math.min(S,P))===0)return S}return S}return null}(n,l,this.geometries);if(e.geometryType()==="Polygon")return function(u,f,p){const y=[];for(const S of function(A,P){const M=A.length;if(M<=1)return[A];const N=[];let L,U;for(let H=0;H<M;H++){const K=Hw(A[H]);K!==0&&(A[H].area=Math.abs(K),U===void 0&&(U=K<0),U===K<0?(L&&N.push(L),L=[A[H]]):L.push(A[H]))}return L&&N.push(L),N}(u)){const A=[];for(let P=0;P<S.length;++P)A.push(Xw(S[P],f));y.push(A)}const b=new gu(y[0][0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Af(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",y,b);if(p.type==="MultiLineString"){let S=1/0;for(let A=0;A<p.coordinates.length;A++){const P=Af(p.coordinates[A],!0,y,b,S);if(isNaN(P))return P;if((S=Math.min(S,P))===0)return S}return S}return p.type==="Polygon"||p.type==="MultiPolygon"?function(S,A,P){let M=1/0;for(const N of S)for(const L of A){const U=eb(N,L,P,M);if(isNaN(U))return U;if((M=Math.min(M,U))===0)return M}return M}(p.type==="Polygon"?[p.coordinates]:p.coordinates,y,b):null}(n,l,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function _u(r){if(r instanceof cs&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof zl||r instanceof Tc)return!1;if(r instanceof xu)return r.featureConstant;let e=!0;return r.eachChild(n=>{e&&!_u(n)&&(e=!1)}),e}function If(r){if(r instanceof cs&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(n=>{e&&!If(n)&&(e=!1)}),e}function Pf(r){if(r instanceof xu)return new Set([r.key]);let e=new Set;return r.eachChild(n=>{e=new Set([...e,...Pf(n)])}),e}function yu(r,e){if(r instanceof cs&&e.indexOf(r.name)>=0)return!1;let n=!0;return r.eachChild(l=>{n&&!yu(l,e)&&(n=!1)}),n}function bx(r,e,n){return[r,e,n].filter(Boolean).join("")}function Ym(r,e){switch(r){case"string":return Jo(e);case"number":return+e;case"boolean":return!!e;case"color":return bn.parse(e);case"formatted":return Hs.fromString(Jo(e));case"resolvedImage":return oo.build(Jo(e))}return e}function Sx(r,e,n,l){return l!==void 0&&(r=l*Math.round(r/l)),e!==void 0&&r<e&&(r=e),n!==void 0&&r>n&&(r=n),r}class xu{constructor(e,n,l,u=!1){this.type=e,this.key=n,this.scope=l,this.featureConstant=u}static parse(e,n){let l=n.expectedType;if(l==null&&(l=Sn),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");const u=n.parse(e[1],1);if(!(u instanceof pi))return n.error("Key name of 'config' expression must be a string literal.");let f,p=!0;const y=Jo(u.value);if(e.length>=3){const b=n.parse(e[2],2);if(!(b instanceof pi))return n.error("Scope of 'config' expression must be a string literal.");f=Jo(b.value)}if(n.options){const b=bx(y,f,n._scope),S=n.options.get(b);S&&(p=_u(S.value||S.default))}return new xu(l,y,f,p)}evaluate(e){const n=bx(this.key,this.scope,e.scope),l=e.getConfig(n);if(!l)return null;const{type:u,value:f,values:p,minValue:y,maxValue:b,stepValue:S}=l,A=l.default.evaluate(e);let P=A;if(f){const M=e.scope;e.scope=(M||"").split("").slice(1).join(""),P=f.evaluate(e),e.scope=M}return u&&(P=Ym(u,P)),P===void 0||y===void 0&&b===void 0&&S===void 0||(typeof P=="number"?P=Sx(P,y,b,S):Array.isArray(P)&&(P=P.map(M=>typeof M=="number"?Sx(M,y,b,S):M))),f!==void 0&&P!==void 0&&p&&!p.includes(P)&&(P=A,u&&(P=Ym(u,P))),(u&&u!==this.type||P!==void 0&&!_f(Ft(P),this.type))&&(P=Ym(this.type.kind,P)),P}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class Mf{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const l=e[1];return n.scope.has(l)?new Mf(l,n.scope.get(l)):n.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Rf{constructor(e,n=[],l,u=new Bm,f=[],p,y){this.registry=e,this.path=n,this.key=n.map(b=>typeof b=="string"?`['${b}']`:`[${b}]`).join(""),this.scope=u,this.errors=f,this.expectedType=l,this._scope=p,this.options=y}parse(e,n,l,u,f={}){return n||l?this.concat(n,null,l,u)._parse(e,f):this._parse(e,f)}parseObjectValue(e,n,l,u,f,p={}){return this.concat(n,l,u,f)._parse(e,p)}_parse(e,n){function l(u,f,p){return p==="assert"?new ai(f,[u]):p==="coerce"?new Qo(f,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(u){let f=u.parse(e,this);if(!f)return null;if(this.expectedType){const p=this.expectedType,y=f.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||y.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string"){if(this.checkSubtype(p,y))return null}else f=l(f,p,n.typeAnnotation||"coerce");else f=l(f,p,n.typeAnnotation||"assert")}if(!(f instanceof pi)&&f.type.kind!=="resolvedImage"&&Jm(f)){const p=new rh(this._scope,this.options);try{f=new pi(f.type,f.evaluate(p))}catch(y){return this.error(y.message),null}}return f}return Qo.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,l,u){let f=typeof e=="number"?this.path.concat(e):this.path;f=typeof n=="string"?f.concat(n):f;const p=u?this.scope.concat(u):this.scope;return new Rf(this.registry,f,l||null,p,this.errors,this._scope,this.options)}error(e,...n){const l=`${this.key}${n.map(u=>`[${u}]`).join("")}`;this.errors.push(new Ro(l,e))}checkSubtype(e,n){const l=uu(e,n);return l&&this.error(l),l}}function Jm(r){if(r instanceof Mf)return Jm(r.boundExpression);if(r instanceof cs&&r.name==="error"||r instanceof ka||r instanceof zl||r instanceof Tc||r instanceof xu)return!1;const e=r instanceof Qo||r instanceof ai;let n=!0;return r.eachChild(l=>{n=e?n&&Jm(l):n&&l instanceof pi}),!!n&&_u(r)&&yu(r,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Df(r,e){const n=r.length-1;let l,u,f=0,p=n,y=0;for(;f<=p;)if(y=Math.floor((f+p)/2),l=r[y],u=r[y+1],l<=e){if(y===n||e<u)return y;f=y+1}else{if(!(l>e))throw new Or("Input is not a number.");p=y-1}return 0}class ch{constructor(e,n,l){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[u,f]of l)this.labels.push(u),this.outputs.push(f)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const l=n.parse(e[1],1,Jt);if(!l)return null;const u=[];let f=null;n.expectedType&&n.expectedType.kind!=="value"&&(f=n.expectedType);for(let p=1;p<e.length;p+=2){const y=p===1?-1/0:e[p],b=e[p+1],S=p,A=p+1;if(typeof y!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(u.length&&u[u.length-1][0]>=y)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const P=n.parse(b,A,f);if(!P)return null;f=f||P.type,u.push([y,P])}return new ch(f,l,u)}evaluate(e){const n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(e);const u=this.input.evaluate(e);if(u<=n[0])return l[0].evaluate(e);const f=n.length;return u>=n[f-1]?l[f-1].evaluate(e):l[Df(n,u)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}const Tx=.95047,Ex=1.08883,Cx=4/29,vu=6/29,Ax=3*vu*vu,Qm=vu*vu*vu,ib=Math.PI/180,Ix=180/Math.PI;function eg(r){return r>Qm?Math.pow(r,1/3):r/Ax+Cx}function tg(r){return r>vu?r*r*r:Ax*(r-Cx)}function ig(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function kf(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function ng(r){const e=kf(r.r),n=kf(r.g),l=kf(r.b),u=eg((.4124564*e+.3575761*n+.1804375*l)/Tx),f=eg((.2126729*e+.7151522*n+.072175*l)/1);return{l:116*f-16,a:500*(u-f),b:200*(f-eg((.0193339*e+.119192*n+.9503041*l)/Ex)),alpha:r.a}}function Ec(r){let e=(r.l+16)/116,n=isNaN(r.a)?e:e+r.a/500,l=isNaN(r.b)?e:e-r.b/200;return e=1*tg(e),n=Tx*tg(n),l=Ex*tg(l),new bn(ig(3.2404542*n-1.5371385*e-.4985314*l),ig(-.969266*n+1.8760108*e+.041556*l),ig(.0556434*n-.2040259*e+1.0572252*l),r.alpha)}function Px(r,e,n){const l=e-r;return r+n*(l>180||l<-180?l-360*Math.round(l/360):l)}const wu={forward:ng,reverse:Ec,interpolate:function(r,e,n){return{l:si(r.l,e.l,n),a:si(r.a,e.a,n),b:si(r.b,e.b,n),alpha:si(r.alpha,e.alpha,n)}}},uh={forward:function(r){const{l:e,a:n,b:l}=ng(r),u=Math.atan2(l,n)*Ix;return{h:u<0?u+360:u,c:Math.sqrt(n*n+l*l),l:e,alpha:r.a}},reverse:function(r){const e=r.h*ib,n=r.c;return Ec({l:r.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:r.alpha})},interpolate:function(r,e,n){return{h:Px(r.h,e.h,n),c:si(r.c,e.c,n),l:si(r.l,e.l,n),alpha:si(r.alpha,e.alpha,n)}}};var Nf=Object.freeze({__proto__:null,hcl:uh,lab:wu});class ao{constructor(e,n,l,u,f){this.type=e,this.operator=n,this.interpolation=l,this.input=u,this.labels=[],this.outputs=[];for(const[p,y]of f)this.labels.push(p),this.outputs.push(y)}static interpolationFactor(e,n,l,u){let f=0;if(e.name==="exponential")f=rg(n,e.base,l,u);else if(e.name==="linear")f=rg(n,1,l,u);else if(e.name==="cubic-bezier"){const p=e.controlPoints;f=new Il(p[0],p[1],p[2],p[3]).solve(rg(n,1,l,u))}return f}static parse(e,n){let[l,u,f,...p]=e;if(!Array.isArray(u)||u.length===0)return n.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const S=u[1];if(typeof S!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:S}}else{if(u[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const S=u.slice(1);if(S.length!==4||S.some(A=>typeof A!="number"||A<0||A>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:S}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(f=n.parse(f,2,Jt),!f)return null;const y=[];let b=null;l==="interpolate-hcl"||l==="interpolate-lab"?b=yo:n.expectedType&&n.expectedType.kind!=="value"&&(b=n.expectedType);for(let S=0;S<p.length;S+=2){const A=p[S],P=p[S+1],M=S+3,N=S+4;if(typeof A!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(y.length&&y[y.length-1][0]>=A)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const L=n.parse(P,N,b);if(!L)return null;b=b||L.type,y.push([A,L])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new ao(b,l,u,f,y):n.error(`Type ${Vr(b)} is not interpolatable.`)}evaluate(e){const n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(e);const u=this.input.evaluate(e);if(u<=n[0])return l[0].evaluate(e);const f=n.length;if(u>=n[f-1])return l[f-1].evaluate(e);const p=Df(n,u),y=ao.interpolationFactor(this.interpolation,u,n[p],n[p+1]),b=l[p].evaluate(e),S=l[p+1].evaluate(e);return this.operator==="interpolate"?Jd[this.type.kind.toLowerCase()](b,S,y):this.operator==="interpolate-hcl"?uh.reverse(uh.interpolate(uh.forward(b),uh.forward(S),y)):wu.reverse(wu.interpolate(wu.forward(b),wu.forward(S),y))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const n=[this.operator,e,this.input.serialize()];for(let l=0;l<this.labels.length;l++)n.push(this.labels[l],this.outputs[l].serialize());return n}}function rg(r,e,n,l){const u=l-n,f=r-n;return u===0?0:e===1?f/u:(Math.pow(e,f)-1)/(Math.pow(e,u)-1)}class Lf{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let l=null;const u=n.expectedType;u&&u.kind!=="value"&&(l=u);const f=[];for(const y of e.slice(1)){const b=n.parse(y,1+f.length,l,void 0,{typeAnnotation:"omit"});if(!b)return null;l=l||b.type,f.push(b)}const p=u&&f.some(y=>uu(u,y.type));return new Lf(p?Sn:l,f)}evaluate(e){let n,l=null,u=0;for(const f of this.args){if(u++,l=f.evaluate(e),l&&l instanceof oo&&!l.available&&(n||(n=l),l=null,u===this.args.length))return n;if(l!==null)break}return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class dh{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let f=1;f<e.length-1;f+=2){const p=e[f];if(typeof p!="string")return n.error(`Expected string, but found ${typeof p} instead.`,f);if(/[^a-zA-Z0-9_]/.test(p))return n.error("Variable names must contain only alphanumeric characters or '_'.",f);const y=n.parse(e[f+1],f+1);if(!y)return null;l.push([p,y])}const u=n.parse(e[e.length-1],e.length-1,n.expectedType,l);return u?new dh(l,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,l]of this.bindings)e.push(n,l.serialize());return e.push(this.result.serialize()),e}}class zf{constructor(e,n,l){this.type=e,this.index=n,this.input=l}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,Jt),u=n.parse(e[2],2,Ls(n.expectedType||Sn));return l&&u?new zf(u.type.itemType,l,u):null}evaluate(e){const n=this.index.evaluate(e),l=this.input.evaluate(e);if(n<0)throw new Or(`Array index out of bounds: ${n} < 0.`);if(n>=l.length)throw new Or(`Array index out of bounds: ${n} > ${l.length-1}.`);if(n!==Math.floor(n))throw new Or(`Array index must be an integer, but found ${n} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return l[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class sg{constructor(e,n,l){this.type=e,this.index=n,this.input=l}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,Jt),u=n.parse(e[2],2,Ls(n.expectedType||Sn));return l&&u?new sg(u.type.itemType,l,u):null}evaluate(e){const n=this.index.evaluate(e),l=this.input.evaluate(e);if(n<0)throw new Or(`Array index out of bounds: ${n} < 0.`);if(n>l.length-1)throw new Or(`Array index out of bounds: ${n} > ${l.length-1}.`);if(n===Math.floor(n))return l[n];const u=Math.floor(n),f=Math.ceil(n),p=l[u],y=l[f];if(typeof p!="number"||typeof y!="number")throw new Or(`Cannot interpolate between non-number values at index ${n}.`);const b=n-u;return p*(1-b)+y*b}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class og{constructor(e,n){this.type=wn,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,Sn),u=n.parse(e[2],2,Sn);return l&&u?Rl(l.type,[wn,vn,Jt,cu,Sn])?new og(l,u):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vr(l.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(l==null)return!1;if(!th(n,["boolean","string","number","null"]))throw new Or(`Expected first argument to be of type boolean, string, number or null, but found ${Vr(Ft(n))} instead.`);if(!th(l,["string","array"]))throw new Or(`Expected second argument to be of type array or string, but found ${Vr(Ft(l))} instead.`);return l.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Of{constructor(e,n,l){this.type=Jt,this.needle=e,this.haystack=n,this.fromIndex=l}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,Sn),u=n.parse(e[2],2,Sn);if(!l||!u)return null;if(!Rl(l.type,[wn,vn,Jt,cu,Sn]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vr(l.type)} instead`);if(e.length===4){const f=n.parse(e[3],3,Jt);return f?new Of(l,u,f):null}return new Of(l,u)}evaluate(e){const n=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!th(n,["boolean","string","number","null"]))throw new Or(`Expected first argument to be of type boolean, string, number or null, but found ${Vr(Ft(n))} instead.`);if(!th(l,["string","array"]))throw new Or(`Expected second argument to be of type array or string, but found ${Vr(Ft(l))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return l.indexOf(n,u)}return l.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ff{constructor(e,n,l,u,f,p){this.inputType=e,this.type=n,this.input=l,this.cases=u,this.outputs=f,this.otherwise=p}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let l,u;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);const f={},p=[];for(let S=2;S<e.length-1;S+=2){let A=e[S];const P=e[S+1];Array.isArray(A)||(A=[A]);const M=n.concat(S);if(A.length===0)return M.error("Expected at least one branch label.");for(const L of A){if(typeof L!="number"&&typeof L!="string")return M.error("Branch labels must be numbers or strings.");if(typeof L=="number"&&Math.abs(L)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof L=="number"&&Math.floor(L)!==L)return M.error("Numeric branch labels must be integer values.");if(l){if(M.checkSubtype(l,Ft(L)))return null}else l=Ft(L);if(f[String(L)]!==void 0)return M.error("Branch labels must be unique.");f[String(L)]=p.length}const N=n.parse(P,S,u);if(!N)return null;u=u||N.type,p.push(N)}const y=n.parse(e[1],1,Sn);if(!y)return null;const b=n.parse(e[e.length-1],e.length-1,u);return b?y.type.kind!=="value"&&n.concat(1).checkSubtype(l,y.type)?null:new Ff(l,u,y,f,p,b):null}evaluate(e){const n=this.input.evaluate(e);return(_f(Ft(n),this.inputType)&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),l=[],u={};for(const p of n){const y=u[this.cases[p]];y===void 0?(u[this.cases[p]]=l.length,l.push([this.cases[p],[p]])):l[y][1].push(p)}const f=p=>this.inputType.kind==="number"?Number(p):p;for(const[p,y]of l)e.push(y.length===1?f(y[0]):y.map(f)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class jf{constructor(e,n,l){this.type=e,this.branches=n,this.otherwise=l}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let l;n.expectedType&&n.expectedType.kind!=="value"&&(l=n.expectedType);const u=[];for(let p=1;p<e.length-1;p+=2){const y=n.parse(e[p],p,wn);if(!y)return null;const b=n.parse(e[p+1],p+1,l);if(!b)return null;u.push([y,b]),l=l||b.type}const f=n.parse(e[e.length-1],e.length-1,l);return f?new jf(l,u,f):null}evaluate(e){for(const[n,l]of this.branches)if(n.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,l]of this.branches)e(n),e(l);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Cc{constructor(e,n,l,u){this.type=e,this.input=n,this.beginIndex=l,this.endIndex=u}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,Sn),u=n.parse(e[2],2,Jt);if(!l||!u)return null;if(!Rl(l.type,[Ls(Sn),vn,Sn]))return n.error(`Expected first argument to be of type array or string, but found ${Vr(l.type)} instead`);if(e.length===4){const f=n.parse(e[3],3,Jt);return f?new Cc(l.type,l,u,f):null}return new Cc(l.type,l,u)}evaluate(e){const n=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!th(n,["string","array"]))throw new Or(`Expected first argument to be of type array or string, but found ${Vr(Ft(n))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return n.slice(l,u)}return n.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class ag{constructor(e,n){this.type=Ls(vn),this.str=e,this.delimiter=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,vn),u=n.parse(e[2],2,vn);return l&&u?new ag(l,u):void 0}evaluate(e){const n=this.str.evaluate(e),l=this.delimiter.evaluate(e);return n.split(l)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function lg(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Mx(r,e,n,l){return l.compare(e,n)===0}function bu(r,e,n){const l=r!=="=="&&r!=="!=";return class Uj{constructor(f,p,y){this.type=wn,this.lhs=f,this.rhs=p,this.collator=y,this.hasUntypedArgument=f.type.kind==="value"||p.type.kind==="value"}static parse(f,p){if(f.length!==3&&f.length!==4)return p.error("Expected two or three arguments.");const y=f[0];let b=p.parse(f[1],1,Sn);if(!b)return null;if(!lg(y,b.type))return p.concat(1).error(`"${y}" comparisons are not supported for type '${Vr(b.type)}'.`);let S=p.parse(f[2],2,Sn);if(!S)return null;if(!lg(y,S.type))return p.concat(2).error(`"${y}" comparisons are not supported for type '${Vr(S.type)}'.`);if(b.type.kind!==S.type.kind&&b.type.kind!=="value"&&S.type.kind!=="value")return p.error(`Cannot compare types '${Vr(b.type)}' and '${Vr(S.type)}'.`);l&&(b.type.kind==="value"&&S.type.kind!=="value"?b=new ai(S.type,[b]):b.type.kind!=="value"&&S.type.kind==="value"&&(S=new ai(b.type,[S])));let A=null;if(f.length===4){if(b.type.kind!=="string"&&S.type.kind!=="string"&&b.type.kind!=="value"&&S.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(A=p.parse(f[3],3,gf),!A)return null}return new Uj(b,S,A)}evaluate(f){const p=this.lhs.evaluate(f),y=this.rhs.evaluate(f);if(l&&this.hasUntypedArgument){const b=Ft(p),S=Ft(y);if(b.kind!==S.kind||b.kind!=="string"&&b.kind!=="number")throw new Or(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${b.kind}, ${S.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const b=Ft(p),S=Ft(y);if(b.kind!=="string"||S.kind!=="string")return e(f,p,y)}return this.collator?n(f,p,y,this.collator.evaluate(f)):e(f,p,y)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[r];return this.eachChild(p=>{f.push(p.serialize())}),f}}}const Rx=bu("==",function(r,e,n){return e===n},Mx),Dx=bu("!=",function(r,e,n){return e!==n},function(r,e,n,l){return!Mx(0,e,n,l)}),nb=bu("<",function(r,e,n){return e<n},function(r,e,n,l){return l.compare(e,n)<0}),rb=bu(">",function(r,e,n){return e>n},function(r,e,n,l){return l.compare(e,n)>0}),sb=bu("<=",function(r,e,n){return e<=n},function(r,e,n,l){return l.compare(e,n)<=0}),Bf=bu(">=",function(r,e,n){return e>=n},function(r,e,n,l){return l.compare(e,n)>=0});class cg{constructor(e,n,l,u,f,p){this.type=vn,this.number=e,this.locale=n,this.currency=l,this.unit=u,this.minFractionDigits=f,this.maxFractionDigits=p}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const l=n.parse(e[1],1,Jt);if(!l)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return n.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=n.parseObjectValue(u.locale,2,"locale",vn),!f))return null;let p=null;if(u.currency&&(p=n.parseObjectValue(u.currency,2,"currency",vn),!p))return null;let y=null;if(u.unit&&(y=n.parseObjectValue(u.unit,2,"unit",vn),!y))return null;let b=null;if(u["min-fraction-digits"]&&(b=n.parseObjectValue(u["min-fraction-digits"],2,"min-fraction-digits",Jt),!b))return null;let S=null;return u["max-fraction-digits"]&&(S=n.parseObjectValue(u["max-fraction-digits"],2,"max-fraction-digits",Jt),!S)?null:new cg(l,f,p,y,b,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class ug{constructor(e){this.type=Jt,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=n.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Vr(l.type)} instead.`):new ug(l):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new Or(`Expected value to be of type string or array, but found ${Vr(Ft(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function kx(r){return function(){r=1831565813+(r|=0)|0;let e=Math.imul(r^r>>>15,1|r);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Su={"==":Rx,"!=":Dx,">":rb,"<":nb,">=":Bf,"<=":sb,array:ai,at:zf,"at-interpolated":sg,boolean:ai,case:jf,coalesce:Lf,collator:ka,format:du,image:hu,in:og,"index-of":Of,interpolate:ao,"interpolate-hcl":ao,"interpolate-lab":ao,length:ug,let:dh,literal:pi,match:Ff,number:ai,"number-format":cg,object:ai,slice:Cc,step:ch,string:ai,"to-boolean":Qo,"to-color":Qo,"to-number":Qo,"to-string":Qo,var:Mf,within:zl,distance:Tc,config:xu,split:ag};function dg(r,[e,n,l,u]){e=e.evaluate(r),n=n.evaluate(r),l=l.evaluate(r);const f=u?u.evaluate(r):1,p=wc(e,n,l,f);if(p)throw new Or(p);return new bn(e/255,n/255,l/255,f)}function Nx(r,[e,n,l,u]){e=e.evaluate(r),n=n.evaluate(r),l=l.evaluate(r);const f=u?u.evaluate(r):1,p=function(S,A,P,M){return typeof S=="number"&&S>=0&&S<=360?typeof A=="number"&&A>=0&&A<=100&&typeof P=="number"&&P>=0&&P<=100?M===void 0||typeof M=="number"&&M>=0&&M<=1?null:`Invalid hsla value [${[S,A,P,M].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof M=="number"?[S,A,P,M]:[S,A,P]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof M=="number"?[S,A,P,M]:[S,A,P]).join(", ")}]: 'h' must be between 0 and 360.`}(e,n,l,f);if(p)throw new Or(p);const y=`hsla(${e}, ${n}%, ${l}%, ${f})`,b=bn.parse(y);if(!b)throw new Or(`Failed to parse HSLA color: ${y}`);return b}function Lx(r,e){return r in e}function Vf(r,e){const n=e[r];return n===void 0?null:n}function Fl(r){return{type:r}}function hg(r){return{result:"success",value:r}}function jl(r){return{result:"error",value:r}}function Bl(r,e){return!!r&&!!r.parameters&&r.parameters.indexOf(e)>-1}function Uf(r){return r["property-type"]==="data-driven"}function zx(r){return Bl(r.expression,"measure-light")}function Ox(r){return Bl(r.expression,"zoom")}function Gf(r){return!!r.expression&&r.expression.interpolated}function $f(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Fx(r){return r}function fg(r,e){const n=e.type==="color",l=r.stops&&typeof r.stops[0][0]=="object",u=l||!(l||r.property!==void 0),f=r.type||(Gf(e)?"exponential":"interval");if(n&&((r=vc({},r)).stops&&(r.stops=r.stops.map(S=>[S[0],bn.parse(S[1])])),r.default=bn.parse(r.default?r.default:e.default)),r.colorSpace&&r.colorSpace!=="rgb"&&!Nf[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let p,y,b;if(f==="exponential")p=Bx;else if(f==="interval")p=jx;else if(f==="categorical"){p=pg,y=Object.create(null);for(const S of r.stops)y[S[0]]=S[1];b=typeof r.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);p=Vl}if(l){const S={},A=[];for(let N=0;N<r.stops.length;N++){const L=r.stops[N],U=L[0].zoom;S[U]===void 0&&(S[U]={zoom:U,type:r.type,property:r.property,default:r.default,stops:[]},A.push(U)),S[U].stops.push([L[0].value,L[1]])}const P=[];for(const N of A)P.push([S[N].zoom,fg(S[N],e)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:ao.interpolationFactor.bind(void 0,M),zoomStops:P.map(N=>N[0]),evaluate:({zoom:N},L)=>Bx({stops:P,base:r.base},e,N).evaluate(N,L)}}if(u){const S=f==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:ao.interpolationFactor.bind(void 0,S),zoomStops:r.stops.map(A=>A[0]),evaluate:({zoom:A})=>p(r,e,A,y,b)}}return{kind:"source",evaluate(S,A){const P=A&&A.properties?A.properties[r.property]:void 0;return P===void 0?Ac(r.default,e.default):p(r,e,P,y,b)}}}function Ac(r,e,n){return r!==void 0?r:e!==void 0?e:n!==void 0?n:void 0}function pg(r,e,n,l,u){return Ac(typeof n===u?l[n]:void 0,r.default,e.default)}function jx(r,e,n){if(Dl(n)!=="number")return Ac(r.default,e.default);const l=r.stops.length;if(l===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[l-1][0])return r.stops[l-1][1];const u=Df(r.stops.map(f=>f[0]),n);return r.stops[u][1]}function Bx(r,e,n){const l=r.base!==void 0?r.base:1;if(Dl(n)!=="number")return Ac(r.default,e.default);const u=r.stops.length;if(u===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[u-1][0])return r.stops[u-1][1];const f=Df(r.stops.map(A=>A[0]),n),p=function(A,P,M,N){const L=N-M,U=A-M;return L===0?0:P===1?U/L:(Math.pow(P,U)-1)/(Math.pow(P,L)-1)}(n,l,r.stops[f][0],r.stops[f+1][0]),y=r.stops[f][1],b=r.stops[f+1][1];let S=Jd[e.type]||Fx;if(r.colorSpace&&r.colorSpace!=="rgb"){const A=Nf[r.colorSpace];S=(P,M)=>A.reverse(A.interpolate(A.forward(P),A.forward(M),p))}return typeof y.evaluate=="function"?{evaluate(...A){const P=y.evaluate.apply(void 0,A),M=b.evaluate.apply(void 0,A);if(P!==void 0&&M!==void 0)return S(P,M,p)}}:S(y,b,p)}function Vl(r,e,n){return e.type==="color"?n=bn.parse(n):e.type==="formatted"?n=Hs.fromString(n.toString()):e.type==="resolvedImage"?n=oo.build(n.toString()):Dl(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),Ac(n,r.default,e.default)}cs.register(Su,{error:[{kind:"error"},[vn],(r,[e])=>{throw new Or(e.evaluate(r))}],typeof:[vn,[Sn],(r,[e])=>Vr(Ft(e.evaluate(r)))],"to-rgba":[Ls(Jt,4),[yo],(r,[e])=>e.evaluate(r).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Ls(Jt,4),[yo],(r,[e])=>e.evaluate(r).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[yo,[Jt,Jt,Jt],dg],rgba:[yo,[Jt,Jt,Jt,Jt],dg],hsl:[yo,[Jt,Jt,Jt],Nx],hsla:[yo,[Jt,Jt,Jt,Jt],Nx],has:{type:wn,overloads:[[[vn],(r,[e])=>Lx(e.evaluate(r),r.properties())],[[vn,el],(r,[e,n])=>Lx(e.evaluate(r),n.evaluate(r))]]},get:{type:Sn,overloads:[[[vn],(r,[e])=>Vf(e.evaluate(r),r.properties())],[[vn,el],(r,[e,n])=>Vf(e.evaluate(r),n.evaluate(r))]]},"feature-state":[Sn,[vn],(r,[e])=>Vf(e.evaluate(r),r.featureState||{})],properties:[el,[],r=>r.properties()],"geometry-type":[vn,[],r=>r.geometryType()],worldview:[vn,[],r=>r.globals.worldview||""],id:[Sn,[],r=>r.id()],zoom:[Jt,[],r=>r.globals.zoom],pitch:[Jt,[],r=>r.globals.pitch||0],"distance-from-center":[Jt,[],r=>r.distanceFromCenter()],"measure-light":[Jt,[vn],(r,[e])=>r.measureLight(e.evaluate(r))],"heatmap-density":[Jt,[],r=>r.globals.heatmapDensity||0],"line-progress":[Jt,[],r=>r.globals.lineProgress||0],"raster-value":[Jt,[],r=>r.globals.rasterValue||0],"raster-particle-speed":[Jt,[],r=>r.globals.rasterParticleSpeed||0],"sky-radial-progress":[Jt,[],r=>r.globals.skyRadialProgress||0],accumulated:[Sn,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[Jt,Fl(Jt),(r,e)=>{let n=0;for(const l of e)n+=l.evaluate(r);return n}],"*":[Jt,Fl(Jt),(r,e)=>{let n=1;for(const l of e)n*=l.evaluate(r);return n}],"-":{type:Jt,overloads:[[[Jt,Jt],(r,[e,n])=>e.evaluate(r)-n.evaluate(r)],[[Jt],(r,[e])=>-e.evaluate(r)]]},"/":[Jt,[Jt,Jt],(r,[e,n])=>e.evaluate(r)/n.evaluate(r)],"%":[Jt,[Jt,Jt],(r,[e,n])=>e.evaluate(r)%n.evaluate(r)],ln2:[Jt,[],()=>Math.LN2],pi:[Jt,[],()=>Math.PI],e:[Jt,[],()=>Math.E],"^":[Jt,[Jt,Jt],(r,[e,n])=>Math.pow(e.evaluate(r),n.evaluate(r))],sqrt:[Jt,[Jt],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[Jt,[Jt],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[Jt,[Jt],(r,[e])=>Math.log(e.evaluate(r))],log2:[Jt,[Jt],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[Jt,[Jt],(r,[e])=>Math.sin(e.evaluate(r))],cos:[Jt,[Jt],(r,[e])=>Math.cos(e.evaluate(r))],tan:[Jt,[Jt],(r,[e])=>Math.tan(e.evaluate(r))],asin:[Jt,[Jt],(r,[e])=>Math.asin(e.evaluate(r))],acos:[Jt,[Jt],(r,[e])=>Math.acos(e.evaluate(r))],atan:[Jt,[Jt],(r,[e])=>Math.atan(e.evaluate(r))],min:[Jt,Fl(Jt),(r,e)=>Math.min(...e.map(n=>n.evaluate(r)))],max:[Jt,Fl(Jt),(r,e)=>Math.max(...e.map(n=>n.evaluate(r)))],abs:[Jt,[Jt],(r,[e])=>Math.abs(e.evaluate(r))],round:[Jt,[Jt],(r,[e])=>{const n=e.evaluate(r);return n<0?-Math.round(-n):Math.round(n)}],floor:[Jt,[Jt],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[Jt,[Jt],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[wn,[vn,Sn],(r,[e,n])=>r.properties()[e.value]===n.value],"filter-id-==":[wn,[Sn],(r,[e])=>r.id()===e.value],"filter-type-==":[wn,[vn],(r,[e])=>r.geometryType()===e.value],"filter-<":[wn,[vn,Sn],(r,[e,n])=>{const l=r.properties()[e.value],u=n.value;return typeof l==typeof u&&l<u}],"filter-id-<":[wn,[Sn],(r,[e])=>{const n=r.id(),l=e.value;return typeof n==typeof l&&n<l}],"filter->":[wn,[vn,Sn],(r,[e,n])=>{const l=r.properties()[e.value],u=n.value;return typeof l==typeof u&&l>u}],"filter-id->":[wn,[Sn],(r,[e])=>{const n=r.id(),l=e.value;return typeof n==typeof l&&n>l}],"filter-<=":[wn,[vn,Sn],(r,[e,n])=>{const l=r.properties()[e.value],u=n.value;return typeof l==typeof u&&l<=u}],"filter-id-<=":[wn,[Sn],(r,[e])=>{const n=r.id(),l=e.value;return typeof n==typeof l&&n<=l}],"filter->=":[wn,[vn,Sn],(r,[e,n])=>{const l=r.properties()[e.value],u=n.value;return typeof l==typeof u&&l>=u}],"filter-id->=":[wn,[Sn],(r,[e])=>{const n=r.id(),l=e.value;return typeof n==typeof l&&n>=l}],"filter-has":[wn,[Sn],(r,[e])=>e.value in r.properties()],"filter-has-id":[wn,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[wn,[Ls(vn)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[wn,[Ls(Sn)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[wn,[vn,Ls(Sn)],(r,[e,n])=>n.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[wn,[vn,Ls(Sn)],(r,[e,n])=>function(l,u,f,p){for(;f<=p;){const y=f+p>>1;if(u[y]===l)return!0;u[y]>l?p=y-1:f=y+1}return!1}(r.properties()[e.value],n.value,0,n.value.length-1)],all:{type:wn,overloads:[[[wn,wn],(r,[e,n])=>e.evaluate(r)&&n.evaluate(r)],[Fl(wn),(r,e)=>{for(const n of e)if(!n.evaluate(r))return!1;return!0}]]},any:{type:wn,overloads:[[[wn,wn],(r,[e,n])=>e.evaluate(r)||n.evaluate(r)],[Fl(wn),(r,e)=>{for(const n of e)if(n.evaluate(r))return!0;return!1}]]},"!":[wn,[wn],(r,[e])=>!e.evaluate(r)],"is-supported-script":[wn,[vn],(r,[e])=>{const n=r.globals&&r.globals.isSupportedScript;return!n||n(e.evaluate(r))}],upcase:[vn,[vn],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[vn,[vn],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[vn,Fl(Sn),(r,e)=>e.map(n=>Jo(n.evaluate(r))).join("")],"resolved-locale":[vn,[gf],(r,[e])=>e.evaluate(r).resolvedLocale()],random:[Jt,[Jt,Jt,Sn],(r,e)=>{const[n,l,u]=e.map(p=>p.evaluate(r));if(n>l||n===l)return n;let f;if(typeof u=="string")f=function(p){let y=0;if(p.length===0)return y;for(let b=0;b<p.length;b++)y=(y<<5)-y+p.charCodeAt(b),y|=0;return y}(u);else{if(typeof u!="number")throw new Or(`Invalid seed input: ${u}`);f=u}return n+kx(f)()*(l-n)}]});class mg{constructor(e,n,l,u){this.expression=e,this._warningHistory={},this._evaluator=new rh(l,u),this._defaultValue=n?function(f){return f.type==="color"&&($f(f.default)||Array.isArray(f.default))?new bn(0,0,0,0):f.type==="color"?bn.parse(f.default)||null:f.default===void 0?null:f.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null,this.configDependencies=Pf(e)}evaluateWithoutErrorHandling(e,n,l,u,f,p,y,b){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=l,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,l,u,f,p,y,b){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=l||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null;try{const S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Or(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${S.message}`)),this._defaultValue}}}function gg(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Su}function Ic(r,e,n,l){const u=new Rf(Su,[],e?function(p){const y={color:yo,string:vn,number:Jt,enum:vn,boolean:wn,formatted:Qd,resolvedImage:eh};return p.type==="array"?Ls(y[p.value]||Sn,p.length):y[p.type]}(e):void 0,void 0,void 0,n,l),f=u.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?hg(new mg(f,e,n,l)):jl(u.errors)}class Hf{constructor(e,n,l,u){this.kind=e,this._styleExpression=n,this.isLightConstant=l,this.isLineProgressConstant=u,this.isStateDependent=e!=="constant"&&!If(n.expression),this.configDependencies=Pf(n.expression)}evaluateWithoutErrorHandling(e,n,l,u,f,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,l,u,f,p)}evaluate(e,n,l,u,f,p){return this._styleExpression.evaluate(e,n,l,u,f,p)}}class Ul{constructor(e,n,l,u,f,p){this.kind=e,this.zoomStops=l,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!If(n.expression),this.isLightConstant=f,this.isLineProgressConstant=p,this.configDependencies=Pf(n.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,n,l,u,f,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,l,u,f,p)}evaluate(e,n,l,u,f,p){return this._styleExpression.evaluate(e,n,l,u,f,p)}interpolationFactor(e,n,l){return this.interpolationType?ao.interpolationFactor(this.interpolationType,e,n,l):0}}function _g(r,e,n,l){if((r=Ic(r,e,n,l)).result==="error")return r;const u=r.value.expression,f=_u(u);if(!f&&!Uf(e))return jl([new Ro("","data expressions not supported")]);const p=yu(u,["zoom","pitch","distance-from-center"]);if(!p&&!Ox(e))return jl([new Ro("","zoom expressions not supported")]);const y=yu(u,["measure-light"]);if(!y&&!zx(e))return jl([new Ro("","measure-light expression not supported")]);const b=yu(u,["line-progress"]);if(!b&&!function(P){return Bl(P.expression,"line-progress")}(e))return jl([new Ro("","line-progress expression not supported")]);const S=e.expression&&e.expression.relaxZoomRestriction,A=hh(u);return A||p||S?A instanceof Ro?jl([A]):A instanceof ao&&!Gf(e)?jl([new Ro("",'"interpolate" expressions cannot be used with this property')]):hg(A?new Ul(f&&b?"camera":"composite",r.value,A.labels,A instanceof ao?A.interpolation:void 0,y,b):new Hf(f&&b?"constant":"source",r.value,y,b)):jl([new Ro("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Pc{constructor(e,n){this._parameters=e,this._specification=n,vc(this,fg(this._parameters,this._specification))}static deserialize(e){return new Pc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function hh(r){let e=null;if(r instanceof dh)e=hh(r.result);else if(r instanceof Lf){for(const n of r.args)if(e=hh(n),e)break}else(r instanceof ch||r instanceof ao)&&r.input instanceof cs&&r.input.name==="zoom"&&(e=r);return e instanceof Ro||r.eachChild(n=>{const l=hh(n);l instanceof Ro?e=l:e&&l&&e!==l&&(e=new Ro("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var yg,Vx,xg=function(){if(Vx)return yg;Vx=1,yg=e;var r=3;function e(n,l,u){var f=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var p=new Int32Array(this.arrayBuffer);n=p[0],this.d=(l=p[1])+2*(u=p[2]);for(var y=0;y<this.d*this.d;y++){var b=p[r+y],S=p[r+y+1];f.push(b===S?null:p.subarray(b,S))}var A=p[r+f.length+1];this.keys=p.subarray(p[r+f.length],A),this.bboxes=p.subarray(A),this.insert=this._insertReadonly}else{this.d=l+2*u;for(var P=0;P<this.d*this.d;P++)f.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=n,this.padding=u,this.scale=l/n,this.uid=0;var M=u/l*n;this.min=-M,this.max=n+M}return e.prototype.insert=function(n,l,u,f,p){this._forEachCell(l,u,f,p,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(p)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(n,l,u,f,p,y){this.cells[p].push(y)},e.prototype.query=function(n,l,u,f,p){var y=this.min,b=this.max;if(n<=y&&l<=y&&b<=u&&b<=f&&!p)return Array.prototype.slice.call(this.keys);var S=[];return this._forEachCell(n,l,u,f,this._queryCell,S,{},p),S},e.prototype._queryCell=function(n,l,u,f,p,y,b,S){var A=this.cells[p];if(A!==null)for(var P=this.keys,M=this.bboxes,N=0;N<A.length;N++){var L=A[N];if(b[L]===void 0){var U=4*L;(S?S(M[U+0],M[U+1],M[U+2],M[U+3]):n<=M[U+2]&&l<=M[U+3]&&u>=M[U+0]&&f>=M[U+1])?(b[L]=!0,y.push(P[L])):b[L]=!1}}},e.prototype._forEachCell=function(n,l,u,f,p,y,b,S){for(var A=this._convertToCellCoord(n),P=this._convertToCellCoord(l),M=this._convertToCellCoord(u),N=this._convertToCellCoord(f),L=A;L<=M;L++)for(var U=P;U<=N;U++){var H=this.d*U+L;if((!S||S(this._convertFromCellCoord(L),this._convertFromCellCoord(U),this._convertFromCellCoord(L+1),this._convertFromCellCoord(U+1)))&&p.call(this,n,l,u,f,H,y,b,S))return}},e.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},e.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,l=r+this.cells.length+1+1,u=0,f=0;f<this.cells.length;f++)u+=this.cells[f].length;var p=new Int32Array(l+u+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var y=l,b=0;b<n.length;b++){var S=n[b];p[r+b]=y,p.set(S,y),y+=S.length}return p[r+n.length]=y,p.set(this.keys,y),p[r+n.length+1]=y+=this.keys.length,p.set(this.bboxes,y),y+=this.bboxes.length,p.buffer},yg}(),Gl=$s(xg);const fh={};function Bt(r,e,n={}){Object.defineProperty(r,"_classRegistryKey",{value:e,writable:!1}),fh[e]={klass:r,omit:n.omit||[]}}Bt(Object,"Object"),Gl.serialize=function(r,e){const n=r.toArrayBuffer();return e&&e.add(n),{buffer:n}},Gl.deserialize=function(r){return new Gl(r.buffer)},Object.defineProperty(Gl,"name",{value:"Grid"}),Bt(Gl,"Grid"),delete ht.prototype.constructor,typeof DOMMatrix<"u"&&Bt(DOMMatrix,"DOMMatrix"),Bt(bn,"Color"),Bt(Error,"Error"),Bt(Hs,"Formatted"),Bt(yf,"FormattedSection"),Bt(ln,"AJAXError"),Bt(oo,"ResolvedImage"),Bt(Pc,"StylePropertyFunction"),Bt(mg,"StyleExpression",{omit:["_evaluator"]}),Bt(_o,"ImageId"),Bt(tl,"ImageVariant"),Bt(Ul,"ZoomDependentExpression"),Bt(Hf,"ZoomConstantExpression"),Bt(cs,"CompoundExpression",{omit:["_evaluate"]});for(const r in Su)fh[Su[r]._classRegistryKey]||Bt(Su[r],`Expression${r}`);function qf(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function ph(r){return self.ImageBitmap&&r instanceof ImageBitmap}function il(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(qf(r)||ph(r))return e&&e.add(r),r;if(ArrayBuffer.isView(r))return e&&e.add(r.buffer),r;if(r instanceof ImageData)return e&&e.add(r.data.buffer),r;if(Array.isArray(r)){const n=[];for(const l of r)n.push(il(l,e));return n}if(r instanceof Map){const n={$name:"Map",entries:[]};for(const[l,u]of r.entries())n.entries.push(il(l),il(u,e));return n}if(r instanceof Set){const n={$name:"Set"};let l=0;for(const u of r.values())n[++l]=il(u);return n}if(r instanceof DOMMatrix){const n={$name:"DOMMatrix"},l=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const u of l)n[u]=r[u];return n}if(typeof r=="bigint")return{$name:"BigInt",value:r.toString()};if(typeof r=="object"){const n=r.constructor,l=n._classRegistryKey;if(!l)throw new Error(`Can't serialize object of unregistered class "${n.name}".`);const u=n.serialize?n.serialize(r,e):{};if(!n.serialize){for(const f in r)r.hasOwnProperty(f)&&(fh[l].omit.indexOf(f)>=0||(u[f]=il(r[f],e)));r instanceof Error&&(u.message=r.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(u.$name=l),u}throw new Error("can't serialize object of type "+typeof r)}function lo(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||qf(r)||ph(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(lo);if(typeof r=="object"){const e=r.$name||"Object";if(e==="Map"){const u=r.entries||[],f=new Map;for(let p=0;p<u.length;p+=2)f.set(lo(u[p]),lo(u[p+1]));return f}if(e==="Set"){const u=new Set;for(const f of Object.keys(r))f!=="$name"&&u.add(lo(r[f]));return u}if(e==="DOMMatrix"){let u;return u=r.is2D?[r.a,r.b,r.c,r.d,r.e,r.f]:[r.m11,r.m12,r.m13,r.m14,r.m21,r.m22,r.m23,r.m24,r.m31,r.m32,r.m33,r.m34,r.m41,r.m42,r.m43,r.m44],new DOMMatrix(u)}if(e==="BigInt")return BigInt(r.value);const{klass:n}=fh[e];if(!n)throw new Error(`Can't deserialize unregistered class "${e}".`);if(n.deserialize)return n.deserialize(r);const l=Object.create(n.prototype);for(const u of Object.keys(r))u!=="$name"&&(l[u]=lo(r[u]));return l}throw new Error("can't deserialize object of type "+typeof r)}const ci={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519,Osage:r=>r>=66736&&r<=66815,"CJK Unified Ideographs Extension B":r=>r>=131072&&r<=173791};function vg(r){for(const e of r)if(Wf(e.charCodeAt(0)))return!0;return!1}function ob(r){for(const e of r)if(!ab(e.charCodeAt(0)))return!1;return!0}function ab(r){return!(ci.Arabic(r)||ci["Arabic Supplement"](r)||ci["Arabic Extended-A"](r)||ci["Arabic Presentation Forms-A"](r)||ci["Arabic Presentation Forms-B"](r))}function Wf(r){return!(r!==746&&r!==747&&(r<4352||!(ci["Bopomofo Extended"](r)||ci.Bopomofo(r)||ci["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||ci["CJK Compatibility Ideographs"](r)||ci["CJK Compatibility"](r)||ci["CJK Radicals Supplement"](r)||ci["CJK Strokes"](r)||!(!ci["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||ci["CJK Unified Ideographs Extension A"](r)||ci["CJK Unified Ideographs"](r)||ci["Enclosed CJK Letters and Months"](r)||ci["Hangul Compatibility Jamo"](r)||ci["Hangul Jamo Extended-A"](r)||ci["Hangul Jamo Extended-B"](r)||ci["Hangul Jamo"](r)||ci["Hangul Syllables"](r)||ci.Hiragana(r)||ci["Ideographic Description Characters"](r)||ci.Kanbun(r)||ci["Kangxi Radicals"](r)||ci["Katakana Phonetic Extensions"](r)||ci.Katakana(r)&&r!==12540||!(!ci["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!ci["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||ci["Unified Canadian Aboriginal Syllabics"](r)||ci["Unified Canadian Aboriginal Syllabics Extended"](r)||ci["Vertical Forms"](r)||ci["Yijing Hexagram Symbols"](r)||ci["Yi Syllables"](r)||ci["Yi Radicals"](r))))}function Zf(r){return!(Wf(r)||function(e){return!!(ci["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||ci["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||ci["Letterlike Symbols"](e)||ci["Number Forms"](e)||ci["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||ci["Control Pictures"](e)&&e!==9251||ci["Optical Character Recognition"](e)||ci["Enclosed Alphanumerics"](e)||ci["Geometric Shapes"](e)||ci["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ci["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ci["CJK Symbols and Punctuation"](e)||ci.Katakana(e)||ci["Private Use Area"](e)||ci["CJK Compatibility Forms"](e)||ci["Small Form Variants"](e)||ci["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function Ux(r){return ci.Arabic(r)||ci["Arabic Supplement"](r)||ci["Arabic Extended-A"](r)||ci["Arabic Presentation Forms-A"](r)||ci["Arabic Presentation Forms-B"](r)}function Xf(r){return r>=1424&&r<=2303||ci["Arabic Presentation Forms-A"](r)||ci["Arabic Presentation Forms-B"](r)}function lb(r,e){return!(!e&&Xf(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||ci.Khmer(r))}function cb(r){for(const e of r)if(Xf(e.charCodeAt(0)))return!0;return!1}const xo={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let wg=null,Ws=xo.unavailable,$l=null;const Gx=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(Ws=xo.error),wg&&wg(r)};function bg(){Sg.fire(new Qa("pluginStateChange",{pluginStatus:Ws,pluginURL:$l}))}const Sg=new xc,Tg=function(){return Ws},$x=function(){if(Ws!==xo.deferred||!$l)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ws=xo.loading,bg(),$l&&Wd({url:$l},r=>{r?Gx(r):(Ws=xo.loaded,bg())})},Na={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ws===xo.loaded||Na.applyArabicShaping!=null,isLoading:()=>Ws===xo.loading,setState(r){Ws=r.pluginStatus,$l=r.pluginURL},isParsing:()=>Ws===xo.parsing,isParsed:()=>Ws===xo.parsed,getPluginURL:()=>$l};class Pn{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness,this.worldview=n.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,l){for(const u of n)if(!lb(u.charCodeAt(0),l))return!1;return!0}(e,Na.isLoaded())}}class mh{constructor(e,n,l,u){this.property=e,this.value=n,this.expression=function(f,p,y,b){if($f(f))return new Pc(f,p);if(gg(f)||Array.isArray(f)&&f.length>0){const S=_g(f,p,y,b);if(S.result==="error")throw new Error(S.value.map(A=>`${A.key}: ${A.message}`).join(", "));return S.value}{let S=f;return typeof f=="string"&&p.type==="color"&&(S=bn.parse(f)),{kind:"constant",configDependencies:new Set,evaluate:()=>S}}}(n===void 0?e.specification.default:n,e.specification,l,u)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,l){return this.property.possiblyEvaluate(this,e,n,l)}}class Kf{constructor(e,n,l){this.property=e,this.value=new mh(e,void 0,n,l)}transitioned(e,n){return new Hx(this.property,this.value,n,Ve({},e.transition,this.transition),e.now)}untransitioned(){return new Hx(this.property,this.value,null,{},0)}}class gh{constructor(e,n,l){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=l,this.configDependencies=new Set}getValue(e){return Vi(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Kf(this._values[e].property,this._scope,this._options)),this._values[e].value=new mh(this._values[e].property,n===null?void 0:Vi(n),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,n){n&&(this._options=n);const l=this._properties.properties;if(e)for(const u in e){const f=e[u];if(u.endsWith("-transition")){const p=u.slice(0,-11);l[p]&&this.setTransition(p,f)}else l.hasOwnProperty(u)&&this.setValue(u,f)}}getTransition(e){return Vi(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Kf(this._values[e].property)),this._values[e].transition=Vi(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const l=this.getValue(n);l!==void 0&&(e[n]=l);const u=this.getTransition(n);u!==void 0&&(e[`${n}-transition`]=u)}return e}transitioned(e,n){const l=new qx(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].transitioned(e,n._values[u]);return l}untransitioned(){const e=new qx(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class Hx{constructor(e,n,l,u,f){const p=u.delay||0,y=u.duration||0;f=f||0,this.property=e,this.value=n,this.begin=f+p,this.end=this.begin+y,e.specification.transition&&(u.delay||u.duration)&&(this.prior=l)}possiblyEvaluate(e,n,l){const u=e.now||0,f=this.value.possiblyEvaluate(e,n,l),p=this.prior;if(p){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return p.possiblyEvaluate(e,n,l);{const y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,n,l),f,ie(y))}}return f}}class qx{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,l){const u=new ga(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,n,l);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Hl{constructor(e,n,l){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=l,this.configDependencies=new Set}getValue(e){return Vi(this._values[e].value)}setValue(e,n){this._values[e]=new mh(this._values[e].property,n===null?void 0:Vi(n),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const n of Object.keys(this._values)){const l=this.getValue(n);l!==void 0&&(e[n]=l)}return e}possiblyEvaluate(e,n,l){const u=new ga(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,n,l);return u}}class Mc{constructor(e,n,l){this.property=e,this.value=n,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,l,u){return this.property.evaluate(this.value,this.parameters,e,n,l,u)}}class ga{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class xt{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,l){const u=Jd[this.specification.type];return u?u(e,n,l):e}}class kt{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,l,u){return new Mc(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},l,u)}:e.expression,n)}interpolate(e,n,l){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Mc(this,{kind:"constant",value:void 0},e.parameters);const u=Jd[this.specification.type];return u?new Mc(this,{kind:"constant",value:u(e.value.value,n.value.value,l)},e.parameters):e}evaluate(e,n,l,u,f,p){return e.kind==="constant"?e.value:e.evaluate(n,l,u,f,p)}}class Tu{constructor(e){this.specification=e}possiblyEvaluate(e,n,l,u){return!!e.expression.evaluate(n,null,{},l,u)}interpolate(){return!1}}class xr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new Pn(0,{});for(const l in e){const u=e[l];u.specification.overridable&&this.overridableProperties.push(l);const f=this.defaultPropertyValues[l]=new mh(u,void 0),p=this.defaultTransitionablePropertyValues[l]=new Kf(u);this.defaultTransitioningPropertyValues[l]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=f.possiblyEvaluate(n)}}}Bt(kt,"DataDrivenProperty"),Bt(xt,"DataConstantProperty"),Bt(Tu,"ColorRampProperty");var Ne=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"expression"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Wx(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function _h(r){if(Array.isArray(r))return r.map(_h);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const n in r)e[n]=_h(r[n]);return e}return Wx(r)}function yh(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!yh(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Eu(r,e="",n=null,l="fill"){if(r==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};yh(r)||(r=Jf(r));const u=r;let f=!0;try{f=function(A){if(!Cu(A))return A;let P=_h(A);return Yf(P),P=Eg(P),P}(u)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(u,null,2)}
        `)}let p=null,y=null;if(l!=="background"&&l!=="sky"&&l!=="slot"){y=Ne[`filter_${l}`];const A=Ic(f,y,e,n);if(A.result==="error")throw new Error(A.value.map(P=>`${P.key}: ${P.message}`).join(", "));p=(P,M,N)=>A.value.evaluate(P,M,{},N)}let b=null,S=null;if(f!==u){const A=Ic(u,y,e,n);if(A.result==="error")throw new Error(A.value.map(P=>`${P.key}: ${P.message}`).join(", "));b=(P,M,N,L,U)=>A.value.evaluate(P,M,{},N,void 0,void 0,L,U),S=!_u(A.value.expression)}return{filter:p,dynamicFilter:b||void 0,needGeometry:Cg(f),needFeature:!!S}}function Eg(r){if(!Array.isArray(r))return r;const e=function(n){if(La.has(n[0])){for(let l=1;l<n.length;l++)if(Cu(n[l]))return!0}return n}(r);return e===!0?e:e.map(n=>Eg(n))}function Yf(r){let e=!1;const n=[];if(r[0]==="case"){for(let l=1;l<r.length-1;l+=2)e=e||Cu(r[l]),n.push(r[l+1]);n.push(r[r.length-1])}else if(r[0]==="match"){e=e||Cu(r[1]);for(let l=2;l<r.length-1;l+=2)n.push(r[l+1]);n.push(r[r.length-1])}else if(r[0]==="step"){e=e||Cu(r[1]);for(let l=1;l<r.length-1;l+=2)n.push(r[l+1])}e&&(r.length=0,r.push("any",...n));for(let l=1;l<r.length;l++)Yf(r[l])}function Cu(r){if(!Array.isArray(r))return!1;if((e=r[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<r.length;n++)if(Cu(r[n]))return!0;return!1}const La=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ub(r,e){return r<e?-1:r>e?1:0}function Cg(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(Cg(r[e]))return!0;return!1}function Jf(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?Ag(r[1],r[2],"=="):e==="!="?Qf(Ag(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Ag(r[1],r[2],e):e==="any"?(n=r.slice(1),["any"].concat(n.map(Jf))):e==="all"?["all"].concat(r.slice(1).map(Jf)):e==="none"?["all"].concat(r.slice(1).map(Jf).map(Qf)):e==="in"?Zx(r[1],r.slice(2)):e==="!in"?Qf(Zx(r[1],r.slice(2))):e==="has"?Xx(r[1]):e!=="!has"||Qf(Xx(r[1]));var n}function Ag(r,e,n){switch(r){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,r,e]}}function Zx(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",r,["literal",e.sort(ub)]]:["filter-in-small",r,["literal",e]]}}function Xx(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Qf(r){return["!",r]}const xh="";function Au(r,e){return e?`${r}${xh}${e}`:r}const Kx="-transition",db=new Set(["fill","line","background","hillshade","raster"]);class Os extends xc{constructor(e,n,l,u,f){if(super(),this.id=e.id,this.fqid=Au(this.id,l),this.type=e.type,this.scope=l,this.lut=u,this.options=f,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const p=Ic(this.filter,Ne[`filter_${e.type}`]);p.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...p.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new Hl(n.layout,this.scope,f),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),n.paint){this._transitionablePaint=new gh(n.paint,this.scope,f);for(const p in e.paint)this.setPaintProperty(p,e.paint[p]);for(const p in e.layout)this.setLayoutProperty(p,e.layout[p]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ga(n.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&db.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);const l=this._unevaluatedLayout;l._properties.properties[e]&&(l.setValue(e,n),this.configDependencies=new Set([...this.configDependencies,...l.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Kx)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n){const l=this._transitionablePaint,u=l._properties.properties;if(e.endsWith(Kx)){const P=e.slice(0,-11);return u[P]&&l.setTransition(P,n||void 0),!1}if(!u[e])return!1;const f=l._values[e],p=f.value.isDataDriven(),y=f.value;l.setValue(e,n),this.configDependencies=new Set([...this.configDependencies,...l.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const b=l._values[e].value,S=b.isDataDriven(),A=e.endsWith("pattern")||e==="line-dasharray";return S||p||A||this._handleOverridablePaintPropertyUpdate(e,y,b)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n,l){return null}_handleOverridablePaintPropertyUpdate(e,n,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return Zi({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(e===void 0||n==="layout"&&!Object.keys(e).length||n==="paint"&&!Object.keys(e).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof Mc&&Uf(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Eu(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,n,l,u,f,p,y,b,S){}}const hb={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class vh{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Xn{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&n.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Qi(r,e=1){let n=0,l=0;return{members:r.map(u=>{const f=hb[u.type].BYTES_PER_ELEMENT,p=n=Ig(n,Math.max(e,f)),y=u.components||1;return l=Math.max(l,f),n+=f*y,{name:u.name,type:u.type,components:y,offset:p}}),size:Ig(n,Math.max(l,e)),alignment:e}}function Ig(r,e){return Math.ceil(r/e)*e}class co extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const u=2*e;return this.int16[u+0]=n,this.int16[u+1]=l,e}}co.prototype.bytesPerElement=4,Bt(co,"StructArrayLayout2i4");class Iu extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,l)}emplace(e,n,l,u){const f=3*e;return this.int16[f+0]=n,this.int16[f+1]=l,this.int16[f+2]=u,e}}Iu.prototype.bytesPerElement=6,Bt(Iu,"StructArrayLayout3i6");class Pu extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,l,u)}emplace(e,n,l,u,f){const p=4*e;return this.int16[p+0]=n,this.int16[p+1]=l,this.int16[p+2]=u,this.int16[p+3]=f,e}}Pu.prototype.bytesPerElement=8,Bt(Pu,"StructArrayLayout4i8");class Rc extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Rc.prototype.bytesPerElement=4,Bt(Rc,"StructArrayLayout1f4");class Pg extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,l)}emplace(e,n,l,u){const f=4*e,p=2*e;return this.int16[f+0]=n,this.int16[f+1]=l,this.float32[p+1]=u,e}}Pg.prototype.bytesPerElement=8,Bt(Pg,"StructArrayLayout2i1f8");class Mg extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,l)}emplace(e,n,l,u){const f=4*e;return this.int16[f+0]=n,this.int16[f+1]=l,this.int16[f+2]=u,e}}Mg.prototype.bytesPerElement=8,Bt(Mg,"StructArrayLayout3i8");class ep extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,u,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,l,u,f)}emplace(e,n,l,u,f,p){const y=5*e;return this.int16[y+0]=n,this.int16[y+1]=l,this.int16[y+2]=u,this.int16[y+3]=f,this.int16[y+4]=p,e}}ep.prototype.bytesPerElement=10,Bt(ep,"StructArrayLayout5i10");class tp extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,f,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,l,u,f,p,y)}emplace(e,n,l,u,f,p,y,b){const S=6*e,A=12*e,P=3*e;return this.int16[S+0]=n,this.int16[S+1]=l,this.uint8[A+4]=u,this.uint8[A+5]=f,this.uint8[A+6]=p,this.uint8[A+7]=y,this.float32[P+2]=b,e}}tp.prototype.bytesPerElement=12,Bt(tp,"StructArrayLayout2i4ub1f12");class ko extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,l)}emplace(e,n,l,u){const f=3*e;return this.float32[f+0]=n,this.float32[f+1]=l,this.float32[f+2]=u,e}}ko.prototype.bytesPerElement=12,Bt(ko,"StructArrayLayout3f12");class ql extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,l,u,f)}emplace(e,n,l,u,f,p){const y=6*e,b=3*e;return this.uint16[y+0]=n,this.uint16[y+1]=l,this.uint16[y+2]=u,this.uint16[y+3]=f,this.float32[b+2]=p,e}}ql.prototype.bytesPerElement=12,Bt(ql,"StructArrayLayout4ui1f12");class Mu extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,l,u)}emplace(e,n,l,u,f){const p=4*e;return this.uint16[p+0]=n,this.uint16[p+1]=l,this.uint16[p+2]=u,this.uint16[p+3]=f,e}}Mu.prototype.bytesPerElement=8,Bt(Mu,"StructArrayLayout4ui8");class ip extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,u,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,l,u,f,p)}emplace(e,n,l,u,f,p,y){const b=6*e;return this.int16[b+0]=n,this.int16[b+1]=l,this.int16[b+2]=u,this.int16[b+3]=f,this.int16[b+4]=p,this.int16[b+5]=y,e}}ip.prototype.bytesPerElement=12,Bt(ip,"StructArrayLayout6i12");class np extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,u,f,p,y,b,S,A,P,M){const N=this.length;return this.resize(N+1),this.emplace(N,e,n,l,u,f,p,y,b,S,A,P,M)}emplace(e,n,l,u,f,p,y,b,S,A,P,M,N){const L=12*e;return this.int16[L+0]=n,this.int16[L+1]=l,this.int16[L+2]=u,this.int16[L+3]=f,this.uint16[L+4]=p,this.uint16[L+5]=y,this.uint16[L+6]=b,this.uint16[L+7]=S,this.int16[L+8]=A,this.int16[L+9]=P,this.int16[L+10]=M,this.int16[L+11]=N,e}}np.prototype.bytesPerElement=24,Bt(np,"StructArrayLayout4i4ui4i24");class Ru extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,l,u,f,p)}emplace(e,n,l,u,f,p,y){const b=10*e,S=5*e;return this.int16[b+0]=n,this.int16[b+1]=l,this.int16[b+2]=u,this.float32[S+2]=f,this.float32[S+3]=p,this.float32[S+4]=y,e}}Ru.prototype.bytesPerElement=20,Bt(Ru,"StructArrayLayout3i3f20");class Wl extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,l,u)}emplace(e,n,l,u,f){const p=4*e;return this.float32[p+0]=n,this.float32[p+1]=l,this.float32[p+2]=u,this.float32[p+3]=f,e}}Wl.prototype.bytesPerElement=16,Bt(Wl,"StructArrayLayout4f16");class Rg extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Rg.prototype.bytesPerElement=4,Bt(Rg,"StructArrayLayout1ul4");class za extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const u=2*e;return this.uint16[u+0]=n,this.uint16[u+1]=l,e}}za.prototype.bytesPerElement=4,Bt(za,"StructArrayLayout2ui4");class Dg extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,u,f,p,y,b,S,A,P,M,N){const L=this.length;return this.resize(L+1),this.emplace(L,e,n,l,u,f,p,y,b,S,A,P,M,N)}emplace(e,n,l,u,f,p,y,b,S,A,P,M,N,L){const U=20*e,H=10*e;return this.int16[U+0]=n,this.int16[U+1]=l,this.int16[U+2]=u,this.int16[U+3]=f,this.int16[U+4]=p,this.float32[H+3]=y,this.float32[H+4]=b,this.float32[H+5]=S,this.float32[H+6]=A,this.int16[U+14]=P,this.uint32[H+8]=M,this.uint16[U+18]=N,this.uint16[U+19]=L,e}}Dg.prototype.bytesPerElement=40,Bt(Dg,"StructArrayLayout5i4f1i1ul2ui40");class rp extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,u,f,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,l,u,f,p,y)}emplace(e,n,l,u,f,p,y,b){const S=8*e;return this.int16[S+0]=n,this.int16[S+1]=l,this.int16[S+2]=u,this.int16[S+4]=f,this.int16[S+5]=p,this.int16[S+6]=y,this.int16[S+7]=b,e}}rp.prototype.bytesPerElement=16,Bt(rp,"StructArrayLayout3i2i2i16");class Du extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,u,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,l,u,f)}emplace(e,n,l,u,f,p){const y=4*e,b=8*e;return this.float32[y+0]=n,this.float32[y+1]=l,this.float32[y+2]=u,this.int16[b+6]=f,this.int16[b+7]=p,e}}Du.prototype.bytesPerElement=16,Bt(Du,"StructArrayLayout2f1f2i16");class ku extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,l,u,f,p)}emplace(e,n,l,u,f,p,y){const b=20*e,S=5*e;return this.uint8[b+0]=n,this.uint8[b+1]=l,this.float32[S+1]=u,this.float32[S+2]=f,this.float32[S+3]=p,this.float32[S+4]=y,e}}ku.prototype.bytesPerElement=20,Bt(ku,"StructArrayLayout2ub4f20");class Qn extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,l)}emplace(e,n,l,u){const f=3*e;return this.uint16[f+0]=n,this.uint16[f+1]=l,this.uint16[f+2]=u,e}}Qn.prototype.bytesPerElement=6,Bt(Qn,"StructArrayLayout3ui6");class Nu extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,f,p,y,b,S,A,P,M,N,L,U,H,K,se,re,le,Ee){const we=this.length;return this.resize(we+1),this.emplace(we,e,n,l,u,f,p,y,b,S,A,P,M,N,L,U,H,K,se,re,le,Ee)}emplace(e,n,l,u,f,p,y,b,S,A,P,M,N,L,U,H,K,se,re,le,Ee,we){const Se=30*e,Me=15*e,De=60*e;return this.int16[Se+0]=n,this.int16[Se+1]=l,this.int16[Se+2]=u,this.float32[Me+2]=f,this.float32[Me+3]=p,this.uint16[Se+8]=y,this.uint16[Se+9]=b,this.uint32[Me+5]=S,this.uint32[Me+6]=A,this.uint32[Me+7]=P,this.uint16[Se+16]=M,this.uint16[Se+17]=N,this.uint16[Se+18]=L,this.float32[Me+10]=U,this.float32[Me+11]=H,this.uint8[De+48]=K,this.uint8[De+49]=se,this.uint8[De+50]=re,this.uint32[Me+13]=le,this.int16[Se+28]=Ee,this.uint8[De+58]=we,e}}Nu.prototype.bytesPerElement=60,Bt(Nu,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class kg extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,f,p,y,b,S,A,P,M,N,L,U,H,K,se,re,le,Ee,we,Se,Me,De,Xe,Le,Je,yt,tt,ut,gt,We){const dt=this.length;return this.resize(dt+1),this.emplace(dt,e,n,l,u,f,p,y,b,S,A,P,M,N,L,U,H,K,se,re,le,Ee,we,Se,Me,De,Xe,Le,Je,yt,tt,ut,gt,We)}emplace(e,n,l,u,f,p,y,b,S,A,P,M,N,L,U,H,K,se,re,le,Ee,we,Se,Me,De,Xe,Le,Je,yt,tt,ut,gt,We,dt){const ze=20*e,Ze=40*e,wt=80*e;return this.float32[ze+0]=n,this.float32[ze+1]=l,this.int16[Ze+4]=u,this.int16[Ze+5]=f,this.int16[Ze+6]=p,this.int16[Ze+7]=y,this.int16[Ze+8]=b,this.int16[Ze+9]=S,this.int16[Ze+10]=A,this.int16[Ze+11]=P,this.int16[Ze+12]=M,this.uint16[Ze+13]=N,this.uint16[Ze+14]=L,this.uint16[Ze+15]=U,this.uint16[Ze+16]=H,this.uint16[Ze+17]=K,this.uint16[Ze+18]=se,this.uint16[Ze+19]=re,this.uint16[Ze+20]=le,this.uint16[Ze+21]=Ee,this.uint16[Ze+22]=we,this.uint16[Ze+23]=Se,this.uint16[Ze+24]=Me,this.uint16[Ze+25]=De,this.uint16[Ze+26]=Xe,this.uint16[Ze+27]=Le,this.uint32[ze+14]=Je,this.float32[ze+15]=yt,this.float32[ze+16]=tt,this.float32[ze+17]=ut,this.float32[ze+18]=gt,this.uint8[wt+76]=We,this.uint16[Ze+39]=dt,e}}kg.prototype.bytesPerElement=80,Bt(kg,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Ng extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,l,u,f,p)}emplace(e,n,l,u,f,p,y){const b=6*e;return this.float32[b+0]=n,this.float32[b+1]=l,this.float32[b+2]=u,this.float32[b+3]=f,this.float32[b+4]=p,this.float32[b+5]=y,e}}Ng.prototype.bytesPerElement=24,Bt(Ng,"StructArrayLayout6f24");class Dc extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,l,u,f)}emplace(e,n,l,u,f,p){const y=5*e;return this.float32[y+0]=n,this.float32[y+1]=l,this.float32[y+2]=u,this.float32[y+3]=f,this.float32[y+4]=p,e}}Dc.prototype.bytesPerElement=20,Bt(Dc,"StructArrayLayout5f20");class Lg extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,f,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,l,u,f,p,y)}emplace(e,n,l,u,f,p,y,b){const S=7*e;return this.float32[S+0]=n,this.float32[S+1]=l,this.float32[S+2]=u,this.float32[S+3]=f,this.float32[S+4]=p,this.float32[S+5]=y,this.float32[S+6]=b,e}}Lg.prototype.bytesPerElement=28,Bt(Lg,"StructArrayLayout7f28");class wh extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,f,p,y,b,S,A,P){const M=this.length;return this.resize(M+1),this.emplace(M,e,n,l,u,f,p,y,b,S,A,P)}emplace(e,n,l,u,f,p,y,b,S,A,P,M){const N=11*e;return this.float32[N+0]=n,this.float32[N+1]=l,this.float32[N+2]=u,this.float32[N+3]=f,this.float32[N+4]=p,this.float32[N+5]=y,this.float32[N+6]=b,this.float32[N+7]=S,this.float32[N+8]=A,this.float32[N+9]=P,this.float32[N+10]=M,e}}wh.prototype.bytesPerElement=44,Bt(wh,"StructArrayLayout11f44");class zg extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,f,p,y,b,S){const A=this.length;return this.resize(A+1),this.emplace(A,e,n,l,u,f,p,y,b,S)}emplace(e,n,l,u,f,p,y,b,S,A){const P=9*e;return this.float32[P+0]=n,this.float32[P+1]=l,this.float32[P+2]=u,this.float32[P+3]=f,this.float32[P+4]=p,this.float32[P+5]=y,this.float32[P+6]=b,this.float32[P+7]=S,this.float32[P+8]=A,e}}zg.prototype.bytesPerElement=36,Bt(zg,"StructArrayLayout9f36");class Zl extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const u=2*e;return this.float32[u+0]=n,this.float32[u+1]=l,e}}Zl.prototype.bytesPerElement=8,Bt(Zl,"StructArrayLayout2f8");class Og extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,l,u)}emplace(e,n,l,u,f){const p=6*e;return this.uint32[3*e+0]=n,this.uint16[p+2]=l,this.uint16[p+3]=u,this.uint16[p+4]=f,e}}Og.prototype.bytesPerElement=12,Bt(Og,"StructArrayLayout1ul3ui12");class Fg extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Fg.prototype.bytesPerElement=2,Bt(Fg,"StructArrayLayout1ui2");class sp extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,f,p,y,b,S,A,P,M,N,L,U,H){const K=this.length;return this.resize(K+1),this.emplace(K,e,n,l,u,f,p,y,b,S,A,P,M,N,L,U,H)}emplace(e,n,l,u,f,p,y,b,S,A,P,M,N,L,U,H,K){const se=16*e;return this.float32[se+0]=n,this.float32[se+1]=l,this.float32[se+2]=u,this.float32[se+3]=f,this.float32[se+4]=p,this.float32[se+5]=y,this.float32[se+6]=b,this.float32[se+7]=S,this.float32[se+8]=A,this.float32[se+9]=P,this.float32[se+10]=M,this.float32[se+11]=N,this.float32[se+12]=L,this.float32[se+13]=U,this.float32[se+14]=H,this.float32[se+15]=K,e}}sp.prototype.bytesPerElement=64,Bt(sp,"StructArrayLayout16f64");class Lu extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,u,f,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,l,u,f,p,y)}emplace(e,n,l,u,f,p,y,b){const S=10*e,A=5*e;return this.uint16[S+0]=n,this.uint16[S+1]=l,this.uint16[S+2]=u,this.uint16[S+3]=f,this.float32[A+2]=p,this.float32[A+3]=y,this.float32[A+4]=b,e}}Lu.prototype.bytesPerElement=20,Bt(Lu,"StructArrayLayout4ui3f20");class jg extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.int16[1*e+0]=n,e}}jg.prototype.bytesPerElement=2,Bt(jg,"StructArrayLayout1i2");class op extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}op.prototype.bytesPerElement=1,Bt(op,"StructArrayLayout1ub1");class Bg extends vh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Bg.prototype.size=40;class Yx extends Dg{get(e){return new Bg(this,e)}}Bt(Yx,"CollisionBoxArray");class ap extends vh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}ap.prototype.size=60;class bh extends Nu{get(e){return new ap(this,e)}}Bt(bh,"PlacedSymbolArray");class Vg extends vh{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Vg.prototype.size=80;class Jx extends kg{get(e){return new Vg(this,e)}}Bt(Jx,"SymbolInstanceArray");class Ug extends Rc{getoffsetX(e){return this.float32[1*e+0]}}Bt(Ug,"GlyphOffsetArray");class Qx extends co{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Bt(Qx,"SymbolLineVertexArray");class lp extends vh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}lp.prototype.size=12;class ev extends Og{get(e){return new lp(this,e)}}Bt(ev,"FeatureIndexArray");class tv extends za{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Bt(tv,"FillExtrusionCentroidArray");class iv extends vh{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}iv.prototype.size=6;class nv extends Iu{get(e){return new iv(this,e)}}Bt(nv,"FillExtrusionWallArray");const rv=Qi([{name:"a_pos",components:2,type:"Int16"}],4),fb=Qi([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),pb=Qi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class rr{constructor(e=[]){this.segments=e}_prepareSegment(e,n,l,u){let f=this.segments[this.segments.length-1];return e>rr.MAX_VERTEX_ARRAY_LENGTH&&Ki(`Max vertices per segment is ${rr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>rr.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u)&&(f={vertexOffset:n,primitiveOffset:l,vertexLength:0,primitiveLength:0},u!==void 0&&(f.sortKey=u),this.segments.push(f)),f}prepareSegment(e,n,l,u){return this._prepareSegment(e,n.length,l.length,u)}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,l,u){return new rr([{vertexOffset:e,primitiveOffset:n,vertexLength:l,primitiveLength:u,vaos:{},sortKey:0}])}}function sv(r,e){return 256*(r=ge(Math.floor(r),0,255))+ge(Math.floor(e),0,255)}rr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Bt(rr,"SegmentVector");const mb=Qi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Gg=Qi([{name:"a_pattern_b",components:4,type:"Uint16"}]),gb=Qi([{name:"a_dash",components:4,type:"Uint16"}]);class Sh{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,l,u){this.ids.push(Th(e)),this.positions.push(n,l,u)}eachPosition(e,n){const l=Th(e);let u=0,f=this.ids.length-1;for(;u<f;){const p=u+f>>1;this.ids[p]>=l?f=p:u=p+1}for(;this.ids[u]===l;)n(this.positions[3*u],this.positions[3*u+1],this.positions[3*u+2]),u++}static serialize(e,n){const l=new Float64Array(e.ids),u=new Uint32Array(e.positions);return $g(l,u,0,l.length-1),n&&(n.add(l.buffer),n.add(u.buffer)),{ids:l,positions:u}}static deserialize(e){const n=new Sh;let l;n.ids=e.ids,n.positions=e.positions;for(const u of n.ids)u!==l&&n.uniqueIds.push(u),l=u;return n.indexed=!0,n}}function Th(r){const e=+r;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:au(String(r))}function $g(r,e,n,l){for(;n<l;){const u=r[n+l>>1];let f=n-1,p=l+1;for(;;){do f++;while(r[f]<u);do p--;while(r[p]>u);if(f>=p)break;cp(r,f,p),cp(e,3*f,3*p),cp(e,3*f+1,3*p+1),cp(e,3*f+2,3*p+2)}p-n<l-p?($g(r,e,n,p),n=p+1):($g(r,e,p+1,l),l=p)}}function cp(r,e,n){const l=r[e];r[e]=r[n],r[n]=l}Bt(Sh,"FeaturePositionMap");class ia{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}set(e,n,l){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class up extends ia{constructor(e){super(e),this.current=0}set(e,n,l){this.fetchUniformLocation(e,n)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}}class Rr extends ia{constructor(e){super(e),this.current=0}set(e,n,l){this.fetchUniformLocation(e,n)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class Oa extends ia{constructor(e){super(e),this.current=[0,0]}set(e,n,l){this.fetchUniformLocation(e,n)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}}class zu extends ia{constructor(e){super(e),this.current=[0,0,0]}set(e,n,l){this.fetchUniformLocation(e,n)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}}class Eh extends ia{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,l){this.fetchUniformLocation(e,n)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class Hg extends ia{constructor(e){super(e),this.current=bn.transparent.toPremultipliedRenderColor(null)}set(e,n,l){this.fetchUniformLocation(e,n)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}const ov=new Float32Array(16);class Ch extends ia{constructor(e){super(e),this.current=ov}set(e,n,l){if(this.fetchUniformLocation(e,n)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let u=1;u<16;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}}const _b=new Float32Array(9),av=new Float32Array(4);class qg extends ia{constructor(e){super(e),this.current=av}set(e,n,l){if(this.fetchUniformLocation(e,n)){for(let u=0;u<4;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}}}function Wg(r){return[sv(255*r.r,255*r.g),sv(255*r.b,255*r.a)]}class Ah{constructor(e,n,l,u){this.value=e,this.uniformNames=n.map(f=>`u_${f}`),this.type=l,this.context=u}setUniform(e,n,l,u,f){const p=u.constantOr(this.value);n.set(e,f,p instanceof bn?p.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):p)}getBinding(e,n){return this.type==="color"?new Hg(e):new Rr(e)}}class Ou{constructor(e,n){this.uniformNames=n.map(l=>`u_${l}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,n){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=n?n.tl.concat(n.br):this.pattern}setUniform(e,n,l,u,f){let p=null;f!=="u_pattern"&&f!=="u_dash"||(p=this.pattern),f==="u_pattern_b"&&(p=this.patternTransition),f==="u_pixel_ratio"&&(p=this.pixelRatio),p&&n.set(e,f,p)}getBinding(e,n){return n==="u_pattern"||n==="u_pattern_b"||n==="u_dash"?new Eh(e):new Rr(e)}}class nl{constructor(e,n,l,u){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=n.map(f=>({name:`a_${f}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,n,l,u,f,p,y,b){const S=this.paintVertexArray.length,A=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Pn(0,{brightness:p,worldview:b}),n,{},f,u,y):this.expression.kind==="constant"&&this.expression.value,P=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Pn(0,{brightness:p,worldview:b}),n,{},f,u,y):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(S,e,A,P?null:this.context.lut)}updatePaintArray(e,n,l,u,f,p,y,b){const S=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:y,worldview:b},l,u,void 0,f):this.expression.kind==="constant"&&this.expression.value,A=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Pn(0,{brightness:y,worldview:b}),l,u,void 0,f):this.lutExpression.value)==="none";this._setPaintValue(e,n,S,A?null:this.context.lut)}_setPaintValue(e,n,l,u){if(this.type==="color"){const f=Wg(l.toPremultipliedRenderColor(u));for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,f[0],f[1])}else{for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class na{constructor(e,n,l,u,f,p){this.expression=e,this.uniformNames=n.map(y=>`u_${y}_t`),this.type=l,this.useIntegerZoom=u,this.context=f,this.maxValue=0,this.paintVertexAttributes=n.map(y=>({name:`a_${y}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,n,l,u,f,p,y,b){const S=this.expression.evaluate(new Pn(this.context.zoom,{brightness:p,worldview:b}),n,{},f,u,y),A=this.expression.evaluate(new Pn(this.context.zoom+1,{brightness:p,worldview:b}),n,{},f,u,y),P=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Pn(0,{brightness:p,worldview:b}),n,{},f,u,y):this.lutExpression.value)==="none",M=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(M,e,S,A,P?null:this.context.lut)}updatePaintArray(e,n,l,u,f,p,y,b){const S=this.expression.evaluate({zoom:this.context.zoom,brightness:y,worldview:b},l,u,void 0,f),A=this.expression.evaluate({zoom:this.context.zoom+1,brightness:y,worldview:b},l,u,void 0,f),P=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Pn(0,{brightness:y,worldview:b}),l,u,void 0,f):this.lutExpression.value)==="none";this._setPaintValue(e,n,S,A,P?null:this.context.lut)}_setPaintValue(e,n,l,u,f){if(this.type==="color"){const p=Wg(l.toPremultipliedRenderColor(f)),y=Wg(l.toPremultipliedRenderColor(f));for(let b=e;b<n;b++)this.paintVertexArray.emplace(b,p[0],p[1],y[0],y[1])}else{for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,l,u);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,l,u,f){const p=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,y=ge(this.expression.interpolationFactor(p,this.context.zoom,this.context.zoom+1),0,1);n.set(e,f,y)}getBinding(e,n){return new Rr(e)}}class No{constructor(e,n,l,u,f){this.expression=e,this.layerId=f,this.paintVertexAttributes=(l==="array"?gb:mb).members;for(let p=0;p<n.length;++p);this.paintVertexArray=new u,this.paintTransitionVertexArray=new Mu}populatePaintArray(e,n,l,u){const f=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(f,e,n.patterns&&n.patterns[this.layerId],l)}updatePaintArray(e,n,l,u,f,p,y){this._setPaintValues(e,n,l.patterns&&l.patterns[this.layerId],p)}_setPaintValues(e,n,l,u){if(!u||!l)return;const f=u[l[0]],p=u[l[1]];if(f){if(f){const{tl:y,br:b,pixelRatio:S}=f;for(let A=e;A<n;A++)this.paintVertexArray.emplace(A,y[0],y[1],b[0],b[1],S)}if(p){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:y,br:b}=p;for(let S=e;S<n;S++)this.paintTransitionVertexArray.emplace(S,y[0],y[1],b[0],b[1])}}}upload(e){const n=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,n)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,Gg.members,n))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Zs{constructor(e,n,l=()=>!0){this.binders={},this._buffers=[],this.context=n;const u=[];for(const f in e.paint._values){const p=e.paint.get(f);if(f.endsWith("-use-theme")||!l(f)||!(p instanceof Mc&&Uf(p.property.specification)))continue;const y=xb(f,e.type),b=p.value,S=p.property.specification.type,A=!!p.property.useIntegerZoom,P=f==="line-dasharray"||f.endsWith("pattern"),M=e.paint.get(`${f}-use-theme`),N=f==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||M&&M.value.kind!=="constant";if(b.kind!=="constant"||N)if(b.kind==="source"||N||P){const L=lv(f,S,"source");this.binders[f]=P?new No(b,y,S,L,e.id):new nl(b,y,S,L),u.push(`/a_${f}`)}else{const L=lv(f,S,"composite");this.binders[f]=new na(b,y,S,A,n,L),u.push(`/z_${f}`)}else this.binders[f]=P?new Ou(b.value,y):new Ah(b.value,y,S,n),u.push(`/u_${f}`);M&&(this.binders[f].lutExpression=M.value)}this.cacheKey=u.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof nl||n instanceof na?n.maxValue:0}populatePaintArrays(e,n,l,u,f,p,y,b){for(const S in this.binders){const A=this.binders[S];A.context=this.context,(A instanceof nl||A instanceof na||A instanceof No)&&A.populatePaintArray(e,n,l,u,f,p,y,b)}}setConstantPatternPositions(e,n){for(const l in this.binders){const u=this.binders[l];u instanceof Ou&&u.setConstantPatternPositions(e,n)}}getPatternTransitionVertexBuffer(e){const n=this.binders[e];return n instanceof No?n.paintTransitionVertexBuffer:null}updatePaintArrays(e,n,l,u,f,p,y,b,S,A){let P=!1;const M=Object.keys(e),N=M.length!==0&&!b,L=N?M:n.uniqueIds;this.context.lut=f.lut;for(const U in this.binders){const H=this.binders[U];if(H.context=this.context,(H instanceof nl||H instanceof na||H instanceof No)&&H.expression&&H.expression.kind&&H.expression.kind!=="constant"&&(H.expression.isStateDependent===!0||H.expression.isLightConstant===!1)){const K=f.paint.get(U);H.expression=K.value;for(const se of L){const re=e[se.toString()];n.eachPosition(se,(le,Ee,we)=>{const Se=u.feature(le);H.updatePaintArray(Ee,we,Se,re,p,y,S,A)})}if(!N)for(const se of l.uniqueIds){const re=e[se.toString()];l.eachPosition(se,(le,Ee,we)=>{const Se=u.feature(le);H.updatePaintArray(Ee,we,Se,re,p,y,S,A)})}P=!0}}return P}defines(){const e=[];for(const n in this.binders){const l=this.binders[n];(l instanceof Ah||l instanceof Ou)&&e.push(...l.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const l=this.binders[n];if(l instanceof nl||l instanceof na||l instanceof No)for(let u=0;u<l.paintVertexAttributes.length;u++)e.push(l.paintVertexAttributes[u].name);if(l instanceof No)for(let u=0;u<Gg.members.length;u++)e.push(Gg.members[u].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const l=this.binders[n];if(l instanceof Ah||l instanceof Ou||l instanceof na)for(const u of l.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof Ah||u instanceof Ou||u instanceof na)for(const f of u.uniformNames)n.push({name:f,property:l,binding:u.getBinding(e,f)})}return n}setUniforms(e,n,l,u,f){for(const{name:p,property:y,binding:b}of l)this.binders[y].setUniform(e,b,f,u.get(y),p)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof nl||n instanceof na||n instanceof No)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer),n instanceof No&&n.paintTransitionVertexBuffer&&this._buffers.push(n.paintTransitionVertexBuffer)}}upload(e){for(const n in this.binders){const l=this.binders[n];(l instanceof nl||l instanceof na||l instanceof No)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof nl||n instanceof na||n instanceof No)&&n.destroy()}}}class Lo{constructor(e,n,l=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new Zs(u,n,l);this.needsUpload=!1,this._featureMap=new Sh,this._featureMapWithoutIds=new Sh,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,l,u,f,p,y,b,S){for(const A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(e,n,u,f,p,y,b,S);n.id!==void 0?this._featureMap.add(n.id,l,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,l,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,l,u,f,p,y,b){for(const S of l)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,S,u,f,p,y||0,b)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const yb={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function xb(r,e){return yb[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}const vb={"line-pattern":{source:ql,composite:ql},"fill-pattern":{source:ql,composite:ql},"fill-extrusion-pattern":{source:ql,composite:ql},"line-dasharray":{source:Mu,composite:Mu}},wb={color:{source:Zl,composite:Wl},number:{source:Rc,composite:Zl}};function lv(r,e,n){const l=vb[r];return l&&l[n]||wb[e][n]}Bt(Ah,"ConstantBinder"),Bt(Ou,"PatternConstantBinder"),Bt(nl,"SourceExpressionBinder"),Bt(No,"PatternCompositeBinder"),Bt(na,"CompositeExpressionBinder"),Bt(Zs,"ProgramConfiguration",{omit:["_buffers"]}),Bt(Lo,"ProgramConfigurationSet");const Fs=Et/Math.PI/2,cv=5,d=6,t=16383,a=64,h=[a,32,16],g=-Fs,_=Fs;function w(r,e,n,l=Fs){return n=pn(n),[r*Math.sin(n)*l,-e*l,r*Math.cos(n)*l]}function T(r,e,n){return w(Math.cos(pn(r)),Math.sin(pn(r)),e,n)}const C=63710088e-1,R=2*Math.PI*C;class D{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new D($e(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,l=this.lat*n,u=e.lat*n,f=Math.sin(l)*Math.sin(u)+Math.cos(l)*Math.cos(u)*Math.cos((e.lng-this.lng)*n);return C*Math.acos(Math.min(f,1))}toBounds(e=0){const n=360*e/40075017,l=n/Math.cos(Math.PI/180*this.lat);return new z({lng:this.lng-l,lat:this.lat-n},{lng:this.lng+l,lat:this.lat+n})}toEcef(e){return T(this.lat,this.lng,Fs+e*Fs/C)}static convert(e){if(e instanceof D)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new D(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new D(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class z{constructor(e,n){if(e)if(n)this.setSouthWest(e).setNorthEast(n);else if(e.length===4){const l=e;this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]])}else{const l=e;this.setSouthWest(l[0]).setNorthEast(l[1])}}setNorthEast(e){return this._ne=e instanceof D?new D(e.lng,e.lat):D.convert(e),this}setSouthWest(e){return this._sw=e instanceof D?new D(e.lng,e.lat):D.convert(e),this}extend(e){const n=this._sw,l=this._ne;let u,f;if(e instanceof D)u=e,f=e;else{if(!(e instanceof z))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(z.convert(e)):this.extend(D.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(D.convert(e)):this;if(u=e._sw,f=e._ne,!u||!f)return this}return n||l?(n.lng=Math.min(u.lng,n.lng),n.lat=Math.min(u.lat,n.lat),l.lng=Math.max(f.lng,l.lng),l.lat=Math.max(f.lat,l.lat)):(this._sw=new D(u.lng,u.lat),this._ne=new D(f.lng,f.lat)),this}getCenter(){return new D((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new D(this.getWest(),this.getNorth())}getSouthEast(){return new D(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:l}=D.convert(e);let u=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(e){if(e)return e instanceof z?e:new z(e)}}const k=0,F=25.5;function q(r){return R*Math.cos(r*Math.PI/180)}function $(r){return(180+r)/360}function X(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function Z(r,e){return r/q(e)}function ne(r){return 360*r-180}function ae(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function de(r,e){return r*q(ae(e))}const _e=85.051129;function be(r){return Math.cos(pn(ge(r,-_e,_e)))}function Te(r,e){const n=ge(e,k,F),l=Math.pow(2,n);return be(r)*R/(512*l)}function ye(r){return 1/Math.cos(r*Math.PI/180)}function xe(r,e=0){const n=Math.exp(Math.PI*(1-(r.y+e/Et)/(1<<r.z)*2));return 80150034*n/(n*n+1)/Et/(1<<r.z)}class ve{constructor(e,n,l=0){this.x=+e,this.y=+n,this.z=+l}static fromLngLat(e,n=0){const l=D.convert(e);return new ve($(l.lng),X(l.lat),Z(n,l.lat))}toLngLat(){return new D(ne(this.x),ae(this.y))}toAltitude(){return de(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/R*ye(ae(this.y))}}function Oe(r,e,n,l,u,f,p,y,b){const S=(e+l)/2,A=(n+u)/2,P=new ht(S,A);y(P),function(M,N,L,U,H,K){const se=L-H,re=U-K;return Math.abs((U-N)*se-(L-M)*re)/Math.hypot(se,re)}(P.x,P.y,f.x,f.y,p.x,p.y)>=b?(Oe(r,e,n,S,A,f,P,y,b),Oe(r,S,A,l,u,P,p,y,b)):r.push(p)}function Pe(r,e,n){let l=r[0],u=l.x,f=l.y;e(l);const p=[l];for(let y=1;y<r.length;y++){const b=r[y],{x:S,y:A}=b;e(b),Oe(p,u,f,S,A,l,b,e,n),u=S,f=A,l=b}return p}function Ye(r,e,n,l){if(l(e,n)){const u=e.add(n)._mult(.5);Ye(r,e,u,l),Ye(r,u,n,l)}else r.push(n)}function Ue(r,e){let n=r[0];const l=[n];for(let u=1;u<r.length;u++){const f=r[u];Ye(l,n,f,e),n=f}return l}const Qe=Math.pow(2,14)-1,_t=-Qe-1;function Fe(r,e){const n=Math.round(r.x*e),l=Math.round(r.y*e);return r.x=ge(n,_t,Qe),r.y=ge(l,_t,Qe),(n<r.x||n>r.x+1||l<r.y||l>r.y+1)&&Ki("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function Ae(r,e,n){const l=r.loadGeometry(),u=r.extent,f=Et/u;if(e&&n&&n.projection.isReprojectedInTileSpace){const p=1<<e.z,{scale:y,x:b,y:S,projection:A}=n,P=M=>{const N=ne((e.x+M.x/u)/p),L=ae((e.y+M.y/u)/p),U=A.project(N,L);M.x=(U.x*y-b)*u,M.y=(U.y*y-S)*u};for(let M=0;M<l.length;M++)if(r.type!==1)l[M]=Pe(l[M],P,1);else{const N=[];for(const L of l[M])L.x<0||L.x>=u||L.y<0||L.y>=u||(P(L),N.push(L));l[M]=N}}for(const p of l)for(const y of p)Fe(y,f);return l}function qe(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?Ae(r):[]}}class je{constructor(e,n,l,u,f){this.properties={},this.extent=l,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=u,this._values=f,e.readFields(nt,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos,l=[];let u,f=1,p=0,y=0,b=0;for(;e.pos<n;){if(p<=0){const S=e.readVarint();f=7&S,p=S>>3}if(p--,f===1||f===2)y+=e.readSVarint(),b+=e.readSVarint(),f===1&&(u&&l.push(u),u=[]),u&&u.push(new ht(y,b));else{if(f!==7)throw new Error(`unknown command ${f}`);u&&u.push(u[0].clone())}}return u&&l.push(u),l}bbox(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let l=1,u=0,f=0,p=0,y=1/0,b=-1/0,S=1/0,A=-1/0;for(;e.pos<n;){if(u<=0){const P=e.readVarint();l=7&P,u=P>>3}if(u--,l===1||l===2)f+=e.readSVarint(),p+=e.readSVarint(),f<y&&(y=f),f>b&&(b=f),p<S&&(S=p),p>A&&(A=p);else if(l!==7)throw new Error(`unknown command ${l}`)}return[y,S,b,A]}toGeoJSON(e,n,l){const u=this.extent*Math.pow(2,l),f=this.extent*e,p=this.extent*n,y=this.loadGeometry();function b(M){return[360*(M.x+f)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(M.y+p)/u)*Math.PI))-90]}function S(M){return M.map(b)}let A;if(this.type===1){const M=[];for(const L of y)M.push(L[0]);const N=S(M);A=M.length===1?{type:"Point",coordinates:N[0]}:{type:"MultiPoint",coordinates:N}}else if(this.type===2){const M=y.map(S);A=M.length===1?{type:"LineString",coordinates:M[0]}:{type:"MultiLineString",coordinates:M}}else{if(this.type!==3)throw new Error("unknown feature type");{const M=function(L){const U=L.length;if(U<=1)return[L];const H=[];let K,se;for(let re=0;re<U;re++){const le=st(L[re]);le!==0&&(se===void 0&&(se=le<0),se===le<0?(K&&H.push(K),K=[L[re]]):K&&K.push(L[re]))}return K&&H.push(K),H}(y),N=[];for(const L of M)N.push(L.map(S));A=N.length===1?{type:"Polygon",coordinates:N[0]}:{type:"MultiPolygon",coordinates:N}}}const P={type:"Feature",geometry:A,properties:this.properties};return this.id!=null&&(P.id=this.id),P}}function nt(r,e,n){r===1?e.id=n.readVarint():r===2?function(l,u){const f=l.readVarint()+l.pos;for(;l.pos<f;){const p=u._keys[l.readVarint()],y=u._values[l.readVarint()];u.properties[p]=y}}(n,e):r===3?e.type=n.readVarint():r===4&&(e._geometry=n.pos)}function st(r){let e=0;for(let n,l,u=0,f=r.length,p=f-1;u<f;p=u++)n=r[u],l=r[p],e+=(l.x-n.x)*(n.y+l.y);return e}je.types=["Unknown","Point","LineString","Polygon"];class ct{constructor(e,n){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(St,this,n),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const n=this._pbf.readVarint()+this._pbf.pos;return new je(this._pbf,n,this.extent,this._keys,this._values)}}function St(r,e,n){r===15?e.version=n.readVarint():r===1?e.name=n.readString():r===5?e.extent=n.readVarint():r===2?e._features.push(n.pos):r===3?e._keys.push(n.readString()):r===4&&e._values.push(function(l){let u=null;const f=l.readVarint()+l.pos;for(;l.pos<f;){const p=l.readVarint()>>3;u=p===1?l.readString():p===2?l.readFloat():p===3?l.readDouble():p===4?l.readVarint64():p===5?l.readVarint():p===6?l.readSVarint():p===7?l.readBoolean():null}if(u==null)throw new Error("unknown feature value");return u}(n))}class Ht{constructor(e,n){this.layers=e.readFields(Qt,{},n)}}function Qt(r,e,n){if(r===3){const l=new ct(n,n.readVarint()+n.pos);l.length&&(e[l.name]=l)}}const Lt="3d_elevation_id",Yt="level";class Wt{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,n){return this._valid&&e(n(this._geometry)),this}require(e,n,l){return this.get(e,!0,n,l)}optional(e,n,l){return this.get(e,!1,n,l)}success(){return this._valid}get(e,n,l,u){const f=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&f!==void 0&&!Number.isNaN(f)?l(u?u(f):f):n&&(this._valid=!1),this}}class xi{constructor(e,n){this.featureFunc=e,this.vertexFunc=n}parseFeature(e,n,l){return this.featureFunc(e,n,l)}parseVertex(e,n,l){return this.vertexFunc(e,n,l)}}const Mi=new xi((r,e,n)=>r.reset(e).require(Lt,l=>{n.id=l}).optional("fixed_height_relative",l=>{n.constantHeight=l},cn.decodeRelativeHeight).geometry(l=>{n.bounds=l},Um).success(),(r,e,n)=>r.reset(e).require(Lt,l=>{n.id=l}).require("elevation_idx",l=>{n.idx=l}).require("extent",l=>{n.extent=l}).require("height_relative",l=>{n.height=l},cn.decodeRelativeHeight).geometry(l=>{n.position=l},cn.getPoint).success()),Ui=new xi((r,e,n)=>r.reset(e).require(Lt,l=>{n.id=l}).optional("fixed_height",l=>{n.constantHeight=l},cn.decodeMetricHeight).geometry(l=>{n.bounds=l},Um).success(),(r,e,n)=>r.reset(e).require(Lt,l=>{n.id=l}).require("elevation_idx",l=>{n.idx=l}).require("extent",l=>{n.extent=l}).require("height",l=>{n.height=l},cn.decodeMetricHeight).geometry(l=>{n.position=l},cn.getPoint).success());class cn{static getPoint(e){return Ss(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const n=[],l=[],u=e.length,f=new Wt;for(let y=0;y<u;y++){const b=e.feature(y),S=b.properties.version,A=(p=S)?p==="1.0.1"?Ui:void 0:Mi;if(A===void 0){Ki(`Unknown elevation feature version number ${S||"(unknown)"}`);continue}const P=b.properties.hasOwnProperty("type")?b.properties.type:void 0;if(P){if(je.types[b.type]==="Point"&&P==="curve_point"){const M={};A.parseVertex(f,b,M)&&n.push(M)}else if(je.types[b.type]==="Polygon"&&P==="curve_meta"){const M={};A.parseFeature(f,b,M)&&l.push(M)}}}var p;return{vertices:n,features:l}}}class Ei{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,l){const u=yi(n,this.dir);if(Math.abs(u)<1e-6)return!1;const f=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1])/u;return l[0]=this.pos[0]+this.dir[0]*f,l[1]=this.pos[1]+this.dir[1]*f,!0}}class un{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,l){const u=ni(n,this.dir);if(Math.abs(u)<1e-6)return!1;const f=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/u;return l[0]=this.pos[0]+this.dir[0]*f,l[1]=this.pos[1]+this.dir[1]*f,l[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(e,n,l){if(function(N,L){var U=N[0],H=N[1],K=N[2],se=L[0],re=L[1],le=L[2];return Math.abs(U-se)<=O*Math.max(1,Math.abs(U),Math.abs(se))&&Math.abs(H-re)<=O*Math.max(1,Math.abs(H),Math.abs(re))&&Math.abs(K-le)<=O*Math.max(1,Math.abs(K),Math.abs(le))}(this.pos,e)||n===0)return l[0]=l[1]=l[2]=0,!1;const[u,f,p]=this.dir,y=this.pos[0]-e[0],b=this.pos[1]-e[1],S=this.pos[2]-e[2],A=u*u+f*f+p*p,P=2*(y*u+b*f+S*p),M=P*P-4*A*(y*y+b*b+S*S-n*n);if(M<0){const N=Math.max(-P/2,0),L=y+u*N,U=b+f*N,H=S+p*N,K=Math.hypot(L,U,H);return l[0]=L*n/K,l[1]=U*n/K,l[2]=H*n/K,!1}{const N=(-P-Math.sqrt(M))/(2*A);if(N<0){const L=Math.hypot(y,b,S);return l[0]=y*n/L,l[1]=b*n/L,l[2]=S*n/L,!1}return l[0]=y+u*N,l[1]=b+f*N,l[2]=S+p*N,!0}}}class mn{constructor(e,n,l,u,f){this.TL=e,this.TR=n,this.BR=l,this.BL=u,this.horizon=f}static fromInvProjectionMatrix(e,n,l){const u=[-1,1,1],f=[1,1,1],p=[1,-1,1],y=[-1,-1,1],b=Ri(u,u,e),S=Ri(f,f,e),A=Ri(p,p,e),P=Ri(y,y,e);return new mn(b,S,A,P,n/l)}}function Fn(r,e,n){let l=1/0,u=-1/0;const f=[];for(const p of r){On(f,p,e);const y=ni(f,n);l=Math.min(l,y),u=Math.max(u,y)}return[l,u]}function ji(r,e){let n=!0;for(let l=0;l<r.planes.length;l++){const u=r.planes[l];let f=0;for(let p=0;p<e.length;p++)f+=ni(u,e[p])+u[3]>=0;if(f===0)return 0;f!==e.length&&(n=!1)}return n?2:1}function dn(r,e){for(const n of r.projections){const l=Fn(e,r.points[0],n.axis);if(n.projection[1]<l[0]||n.projection[0]>l[1])return 0}return 1}function hn(r,e){let n=0;const l=[0,0,0,0];for(let p=0;p<r.length;p++)l[0]=r[p][0],l[1]=r[p][1],l[2]=r[p][2],l[3]=1,(u=l)[0]*(f=e)[0]+u[1]*f[1]+u[2]*f[2]+u[3]*f[3]>=0&&n++;var u,f;return n}class yn{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=Gi.fromPoints(this.points),this.projections=[],this.frustumEdges=[On([],this.points[2],this.points[3]),On([],this.points[0],this.points[3]),On([],this.points[4],this.points[0]),On([],this.points[5],this.points[1]),On([],this.points[6],this.points[2]),On([],this.points[7],this.points[3])];for(const l of this.frustumEdges){const u=[0,-l[2],l[1]],f=[l[2],0,-l[0]];this.projections.push({axis:u,projection:Fn(this.points,this.points[0],u)}),this.projections.push({axis:f,projection:Fn(this.points,this.points[0],f)})}}static fromInvProjectionMatrix(e,n,l,u){const f=Math.pow(2,l),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const A=rt([],S,e),P=1/A[3]/n*f;return(M=A)[0]=(N=A)[0]*(L=[P,P,u?1/A[3]:P,P])[0],M[1]=N[1]*L[1],M[2]=N[2]*L[2],M[3]=N[3]*L[3],M;var M,N,L}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const A=wi([],Fi([],On([],p[S[0]],p[S[1]]),On([],p[S[2]],p[S[1]]))),P=-ni(A,p[S[1]]);return A.concat(P)}),b=[];for(let S=0;S<p.length;S++)b.push([p[S][0],p[S][1],p[S][2]]);return new yn(b,y)}intersectsPrecise(e,n,l){for(let u=0;u<n.length;u++)if(!hn(e,n[u]))return 0;for(let u=0;u<this.planes.length;u++)if(!hn(e,this.planes[u]))return 0;for(const u of l)for(const f of this.frustumEdges){const p=Fi([],u,f),y=Kt(p);if(y===0)continue;jt(p,p,1/y);const b=Fn(this.points,this.points[0],p),S=Fn(e,this.points[0],p);if(b[0]>S[1]||S[0]>b[1])return 0}return 1}containsPoint(e){for(const n of this.planes){const l=n[3];if(ni([n[0],n[1],n[2]],e)+l<0)return!1}return!0}}class Gi{static fromPoints(e){const n=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(const u of e)Tt(n,n,u),ii(l,l,u);return new Gi(n,l)}static fromTileIdAndHeight(e,n,l){const u=1<<e.canonical.z,f=e.canonical.x,p=e.canonical.y;return new Gi([f/u,p/u,n],[(f+1)/u,(p+1)/u,l])}static applyTransform(e,n){const l=e.getCorners();for(let u=0;u<l.length;++u)Ri(l[u],l[u],n);return Gi.fromPoints(l)}static applyTransformFast(e,n){const l=[n[12],n[13],n[14]],u=[...l];for(let f=0;f<3;f++)for(let p=0;p<3;p++){const y=n[4*p+f],b=y*e.min[p],S=y*e.max[p];l[f]+=Math.min(b,S),u[f]+=Math.max(b,S)}return new Gi(l,u)}static projectAabbCorners(e,n){const l=e.getCorners();for(let u=0;u<l.length;++u)Ri(l[u],l[u],n);return l}constructor(e,n){this.min=e,this.max=n,this.center=jt([],Nt([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],l=Dt(this.min),u=Dt(this.max);for(let f=0;f<n.length;f++)l[f]=n[f]?this.min[f]:this.center[f],u[f]=n[f]?this.center[f]:this.max[f];return u[2]=this.max[2],new Gi(l,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?ji(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?ji(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?dn(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?dn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Bt(Gi,"Aabb");class An{constructor(e,n){this.feature=e,this.metersToTile=n,this.index=0}get(){const e=this.feature.vertices[this.index],n=this.feature.vertexProps[this.index].dir,l=n[1],u=-n[0],f=(e.extent+1)*this.metersToTile;return[new ht(Math.trunc(e.position[0]+l*f),Math.trunc(e.position[1]+u*f)),new ht(Math.trunc(e.position[0]-l*f),Math.trunc(e.position[1]-u*f))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class gn{constructor(e,n,l,u,f,p){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:l,max:l},this.safeArea=n,this.constantHeight=l,this.constantHeight==null&&(this.constantHeight!=null||u.length!==0)){this.vertices=u,this.edges=f,this.edges=this.edges.filter(y=>{return y.a<this.vertices.length&&y.b<this.vertices.length&&!((b=this.vertices[y.a].position)[0]===(S=this.vertices[y.b].position)[0]&&b[1]===S[1]);var b,S}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const y of this.vertices)this.vertexProps.push({dir:Ss(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,y.height),this.heightRange.max=Math.max(this.heightRange.max,y.height);for(const y of this.edges){const b=this.vertices[y.a].position,S=this.vertices[y.b].position,A=no(Ar(),S,b),P=as(A),M=go(Ar(),A,1/P);this.edgeProps.push({vec:A,dir:M,len:P});const N=this.vertexProps[y.a].dir,L=this.vertexProps[y.b].dir;io(N,N,M),io(L,L,M)}for(const y of this.vertexProps)y.dir[0]===0&&y.dir[1]===0||Ra(y.dir,y.dir);this.tessellate(p)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const n=this.getClosestEdge(e);if(n==null)return 0;const[l,u]=n;return si(this.vertices[this.edges[l].a].height,this.vertices[this.edges[l].b].height,u)}computeSlopeNormal(e,n){const l=this.getClosestEdge(e);if(!l)return Pt(0,0,1);const u=l[0],f=this.edges[u],p=this.edgeProps[u].vec,y=Pt(p[0],p[1],(this.vertices[f.b].height-this.vertices[f.a].height)*n),b=Pt(y[1],-y[0],0);Fi(b,b,y);const S=Kt(b);return S>0?jt(b,b,1/S):Pt(0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let n=0,l=Number.POSITIVE_INFINITY,u=0;const f=Ss(e.x,e.y);for(let p=0;p<this.edges.length;p++){const y=this.edges[p],b=this.edgeProps[p].dir,S=new Ei(f,this.edgeProps[p].dir),A=this.vertices[y.a].position,P=this.vertices[y.b].position,M=Ar(),N=Ar(),L=S.intersectsPlane(A,this.vertexProps[y.a].dir,M),U=S.intersectsPlane(P,this.vertexProps[y.b].dir,N);if(!L||!U)continue;const H=no(Ar(),N,M),K=no(Ar(),f,M),se=yi(H,H),re=se>0?yi(K,H)/se:0,le=ge(re,0,1),Ee=Math.abs((re-le)*this.edgeProps[p].len),we=no(Ar(),f,A),Se=Ee+Math.abs(yi(we,Ss(b[1],-b[0])));Se<l&&(n=p,l=Se,u=le)}return[n,u]}tessellate(e){for(let n=this.edges.length-1;n>=0;--n){const l=this.edges[n].a,u=this.edges[n].b,{position:f,height:p,extent:y}=this.vertices[l],{position:b,height:S,extent:A}=this.vertices[u],P=this.vertexProps[l].dir,M=this.vertexProps[u].dir,N=Pt(f[0]/e,f[1]/e,p),L=Pt(b[0]/e,b[1]/e,S),U=Pt(P[1],-P[0],0);jt(U,U,y);const H=Pt(M[1],-M[0],0);if(jt(H,H,A),this.distSqLines(Pt(N[0]+.5*U[0],N[1]+.5*U[1],N[2]+.5*U[2]),Pt(L[0]-.5*H[0],L[1]-.5*H[1],L[2]-.5*H[2]),Pt(N[0]-.5*U[0],N[1]-.5*U[1],N[2]-.5*U[2]),Pt(L[0]+.5*H[0],L[1]+.5*H[1],L[2]+.5*H[2]))<=.0025000000000000005)continue;const K=this.vertices.length,se=io(Ar(),f,b);this.vertices.push({position:go(se,se,.5),height:.5*(p+S),extent:.5*(y+A)});const re=io(Ar(),P,M);this.vertexProps.push({dir:Ra(re,re)}),this.edges.splice(n,1),this.edgeProps.splice(n,1),this.edges.push({a:l,b:K}),this.edges.push({a:K,b:u});const le=no(Ar(),this.vertices[K].position,f),Ee=as(le),we={vec:le,dir:go(Ar(),le,1/Ee),len:Ee};this.edgeProps.push(we),this.edgeProps.push(we)}}distSqLines(e,n,l,u){const f=bi(mt(),n,e),p=bi(mt(),u,l),y=bi(mt(),e,l),b=ni(f,f),S=ni(f,p),A=ni(f,y),P=ni(p,p),M=ni(p,y),N=b*P-S*S;if(N===0){const H=ni(y,p)/ni(p,p);return en(nn(mt(),l,u,H),e)}const L=(S*M-A*P)/N,U=(b*M-S*A)/N;return en(nn(mt(),e,n,L),nn(mt(),l,u,U))}}class sr{static parseFrom(e,n){const l=cn.parse(e);if(!l)return[];let{vertices:u,features:f}=l;const p=1/xe(n);f.sort((A,P)=>A.id-P.id),u.sort((A,P)=>A.id-P.id||A.idx-P.idx),u=u.filter((A,P,M)=>P===M.findIndex(N=>N.id===A.id&&N.idx===A.idx));const y=new Array;let b=0;const S=u.length;for(const A of f){if(A.constantHeight){y.push(new gn(A.id,A.bounds,A.constantHeight));continue}for(;b!==S&&u[b].id<A.id;)b++;if(b===S||u[b].id!==A.id)continue;const P=new Array,M=new Array,N=b;for(;b!==S&&u[b].id===A.id;){const L=u[b];if(P.push({position:L.position,height:L.height,extent:L.extent}),b!==N&&u[b-1].idx===L.idx-1){const U=b-N;M.push({a:U-1,b:U})}b++}y.push(new gn(A.id,A.bounds,void 0,P,M,p))}return y}static getElevationFeature(e,n){if(!n)return;const l=+e.properties[Lt];return Number.isNaN(l)?void 0:n.find(u=>u.id===l)}}class on{constructor(e,n){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(n)||(this.zScale=Math.pow(2,n.z-e.z),this.xOffset=(e.x*this.zScale-n.x)*Et,this.yOffset=(e.y*this.zScale-n.y)*Et)}constantElevation(e,n){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,n)}pointElevation(e,n,l){const u=this.constantElevation(n,l);return u??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(n.pointElevation(e),l))}computeBiasedHeight(e,n){return n<=0?e:e+n*Re(0,n,e>=0?e:Math.abs(.5*e))}}Bt(gn,"ElevationFeature");class xn{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new co,this.indexArray=new Qn,this.segments=new rr,this.programConfigurations=new Lo(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Rc),this.worldview=e.worldview}updateFootprints(e,n){}populate(e,n,l,u){const f=this.layers[0],p=[];let y=null;f.type==="circle"&&(y=f.layout.get("circle-sort-key"));for(const{feature:S,id:A,index:P,sourceLayerIndex:M}of e){const N=this.layers[0]._featureFilter.needGeometry,L=qe(S,N);if(!this.layers[0]._featureFilter.filter(new Pn(this.zoom,{worldview:this.worldview}),L,l))continue;const U=y?y.evaluate(L,{},l):void 0,H={id:A,properties:S.properties,type:S.type,sourceLayerIndex:M,index:P,geometry:N?L.geometry:Ae(S,l,u),patterns:{},sortKey:U};p.push(H)}y&&p.sort((S,A)=>S.sortKey-A.sortKey);let b=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new ip,b=u.projection);for(const S of p){const{geometry:A,index:P,sourceLayerIndex:M}=S,N=e[P].feature;this.addFeature(S,A,P,n.availableImages,l,b,n.brightness,n.elevationFeatures),n.featureIndex.insert(N,A,P,M,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,n,l,u,f,p,y){this.programConfigurations.updatePaintArrays(e,n,f,l,u,p,y,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,rv.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,pb.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,fb.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,n,l,u,f,p,y,b){let S;this.elevationMode!=="none"&&(S=sr.getElevationFeature(e,b));for(const A of n)for(const P of A){const M=P.x,N=P.y;if(M<0||M>=Et||N<0||N>=Et)continue;if(p){const H=p.projectTilePoint(M,N,f),K=p.upVector(f,M,N);this.addGlobeExtVertex(H,K),this.addGlobeExtVertex(H,K),this.addGlobeExtVertex(H,K),this.addGlobeExtVertex(H,K)}const L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),U=L.vertexLength;if(this.addCircleVertex(M,N,-1,-1),this.addCircleVertex(M,N,1,-1),this.addCircleVertex(M,N,1,1),this.addCircleVertex(M,N,-1,1),this.elevationMode!=="none"){const H=S?S.pointElevation(new ht(M,N)):0;this.hasElevation=this.hasElevation||H!==0;for(let K=0;K<4;K++)this.elevatedLayoutVertexArray.emplaceBack(H)}this.indexArray.emplaceBack(U,U+1,U+2),this.indexArray.emplaceBack(U,U+2,U+3),L.vertexLength+=4,L.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},u,f,y,void 0,this.worldview)}addCircleVertex(e,n,l,u){this.layoutVertexArray.emplaceBack(2*e+(l+1)/2,2*n+(u+1)/2)}addGlobeExtVertex(e,n){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}}function Ln(r,e){for(let n=0;n<r.length;n++)if(Es(e,r[n]))return!0;for(let n=0;n<e.length;n++)if(Es(r,e[n]))return!0;return!!us(r,e)}function Dr(r,e,n){return!!Es(r,e)||!!Ts(e,r,n)}function Ir(r,e){if(r.length===1)return ra(e,r[0]);for(let n=0;n<e.length;n++){const l=e[n];for(let u=0;u<l.length;u++)if(Es(r,l[u]))return!0}for(let n=0;n<r.length;n++)if(ra(e,r[n]))return!0;for(let n=0;n<e.length;n++)if(us(r,e[n]))return!0;return!1}function zr(r,e,n){if(r.length>1){if(us(r,e))return!0;for(let l=0;l<e.length;l++)if(Ts(e[l],r,n))return!0}for(let l=0;l<r.length;l++)if(Ts(r[l],e,n))return!0;return!1}function us(r,e){if(r.length===0||e.length===0)return!1;for(let n=0;n<r.length-1;n++){const l=r[n],u=r[n+1];for(let f=0;f<e.length-1;f++)if(_a(l,u,e[f],e[f+1]))return!0}return!1}function _a(r,e,n,l){return Sr(r,n,l)!==Sr(e,n,l)&&Sr(r,e,n)!==Sr(r,e,l)}function Xs(r,e,n){return(r.x-n.x)*(e.y-n.y)-(r.y-n.y)*(e.x-n.x)}function vo(r,e,n,l){const u=Xs(r,e,l),f=Xs(r,e,n);if(Math.sign(u)===Math.sign(f))return;const p=Xs(n,l,r),y=p+f-u;return Math.sign(p)!==Math.sign(y)?[p/(p-y),f/(f-u)]:void 0}function Ts(r,e,n){const l=n*n;if(e.length===1)return r.distSqr(e[0])<l;for(let u=1;u<e.length;u++)if(zo(r,e[u-1],e[u])<l)return!0;return!1}function zo(r,e,n){const l=e.distSqr(n);if(l===0)return r.distSqr(e);const u=((r.x-e.x)*(n.x-e.x)+(r.y-e.y)*(n.y-e.y))/l;return r.distSqr(u<0?e:u>1?n:n.sub(e)._mult(u)._add(e))}function ra(r,e){let n,l,u,f=!1;for(let p=0;p<r.length;p++){n=r[p];for(let y=0,b=n.length-1;y<n.length;b=y++)l=n[y],u=n[b],l.y>e.y!=u.y>e.y&&e.x<(u.x-l.x)*(e.y-l.y)/(u.y-l.y)+l.x&&(f=!f)}return f}function Es(r,e){let n=!1;for(let l=0,u=r.length-1;l<r.length;u=l++){const f=r[l],p=r[u];f.y>e.y!=p.y>e.y&&e.x<(p.x-f.x)*(e.y-f.y)/(p.y-f.y)+f.x&&(n=!n)}return n}function Tr(r,e,n,l,u){for(const p of r)if(e<=p.x&&n<=p.y&&l>=p.x&&u>=p.y)return!0;const f=[new ht(e,n),new ht(e,u),new ht(l,u),new ht(l,n)];if(r.length>2){for(const p of f)if(Es(r,p))return!0}for(let p=0;p<r.length-1;p++)if(fr(r[p],r[p+1],f))return!0;return!1}function fr(r,e,n){const l=n[0],u=n[2];if(r.x<l.x&&e.x<l.x||r.x>u.x&&e.x>u.x||r.y<l.y&&e.y<l.y||r.y>u.y&&e.y>u.y)return!1;const f=Sr(r,e,n[0]);return f!==Sr(r,e,n[1])||f!==Sr(r,e,n[2])||f!==Sr(r,e,n[3])}function Bn(r,e,n,l,u,f){let p=e.y-r.y,y=r.x-e.x;if(f=f||0){const b=p*p+y*y;if(b===0)return!0;const S=Math.sqrt(b);p/=S,y/=S}return!((n.x-r.x)*p+(n.y-r.y)*y-f<0||(l.x-r.x)*p+(l.y-r.y)*y-f<0||(u.x-r.x)*p+(u.y-r.y)*y-f<0)}function Ur(r,e,n,l,u,f,p){return!(Bn(r,e,l,u,f,p)||Bn(e,n,l,u,f,p)||Bn(n,r,l,u,f,p)||Bn(l,u,r,e,n,p)||Bn(u,f,r,e,n,p)||Bn(f,l,r,e,n,p))}function ds(r,e,n){const l=e.paint.get(r).value;return l.kind==="constant"?l.value:n.programConfigurations.get(e.id).getMaxValue(r)}function Er(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Oo(r,e,n,l,u){if(!e[0]&&!e[1])return r;const f=ht.convert(e)._mult(u);n==="viewport"&&f._rotate(-l);const p=[];for(let y=0;y<r.length;y++)p.push(r[y].sub(f));return p}function kc(r,e,n,l){const u=ht.convert(r)._mult(l);return e==="viewport"&&u._rotate(-n),u}let Xl,Fu;function ju(r,e,n){var l=2*Math.PI*6378137/256/Math.pow(2,n);return[r*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}Bt(xn,"CircleBucket",{omit:["layers"]});class Fo{constructor(e,n,l){this.z=e,this.x=n,this.y=l,this.key=jo(0,e,e,n,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const n=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>n&&e.y===this.y>>n}url(e,n){const l=function(f,p,y){var b=ju(256*f,256*(p=Math.pow(2,y)-p-1),y),S=ju(256*(f+1),256*(p+1),y);return b[0]+","+b[1]+","+S[0]+","+S[1]}(this.x,this.y,this.z),u=function(f,p,y){let b,S="";for(let A=f;A>0;A--)b=1<<A-1,S+=(p&b?1:0)+(y&b?2:0);return S}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Fa{constructor(e,n){this.wrap=e,this.canonical=n,this.key=jo(e,n.z,n.z,n.x,n.y)}}class Gr{constructor(e,n,l,u,f){this.overscaledZ=e,this.wrap=n,this.canonical=new Fo(l,+u,+f),this.key=n===0&&e===l?this.canonical.key:jo(n,e,l,u,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new Gr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Gr(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return jo(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-e;return jo(this.wrap*+n,e,e,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Gr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,l=2*this.canonical.x,u=2*this.canonical.y;return[new Gr(n,this.wrap,n,l,u),new Gr(n,this.wrap,n,l+1,u),new Gr(n,this.wrap,n,l,u+1),new Gr(n,this.wrap,n,l+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Gr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Gr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Fa(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function jo(r,e,n,l,u){const f=1<<Math.min(n,22);let p=f*(u%f)+l%f;return r&&n<22&&(p+=f*f*((r<0?-2*r-1:2*r)%(1<<2*(22-n)))),16*(32*p+n)+(e-n)}const Nc=[r=>{let e=r.canonical.x-1,n=r.wrap;return e<0&&(e=(1<<r.canonical.z)-1,n--),new Gr(r.overscaledZ,n,r.canonical.z,e,r.canonical.y)},r=>{let e=r.canonical.x+1,n=r.wrap;return e===1<<r.canonical.z&&(e=0,n++),new Gr(r.overscaledZ,n,r.canonical.z,e,r.canonical.y)},r=>new Gr(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,(r.canonical.y===0?1<<r.canonical.z:r.canonical.y)-1),r=>new Gr(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y===(1<<r.canonical.z)-1?0:r.canonical.y+1)];Bt(Fo,"CanonicalTileID"),Bt(Gr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Gj=Qi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:uv}=Gj,$j=Qi([{name:"a_pos_3",components:3,type:"Int16"}]);var iA=Qi([{name:"a_pos",type:"Int16",components:2}]);function dv(r){return r*Fs/C}const Hj=[new Gi([g,g,g],[_,_,_]),new Gi([g,g,g],[0,0,_]),new Gi([0,g,g],[_,0,_]),new Gi([g,0,g],[0,_,_]),new Gi([0,0,g],[_,_,_])];function nA(r,e,n,l=!0){const u=jt([],r._camera.position,r.worldSize),f=[e,n,1,1];rt(f,f,r.pixelMatrixInverse),_r(f,f,1/f[3]);const p=wi([],On([],f,u)),y=r.globeMatrix,b=[y[12],y[13],y[14]],S=On([],b,u),A=Kt(S),P=wi([],S),M=r.worldSize/(2*Math.PI),N=ni(P,p),L=Math.asin(M/A);if(L<Math.acos(N)){if(!l)return null;const Xe=[],Le=[];jt(Xe,p,A/N),wi(Le,On(Le,Xe,S)),wi(p,Nt(p,S,jt(p,Le,Math.tan(L)*A)))}const U=[];new un(u,p).closestPointOnSphere(b,M,U);const H=wi([],cr(y,0)),K=wi([],cr(y,1)),se=wi([],cr(y,2)),re=ni(H,U),le=ni(K,U),Ee=ni(se,U),we=Be(Math.asin(-le/M));let Se=Be(Math.atan2(re,Ee));Se=r.center.lng+function(Xe,Le){const Je=(Le-Xe+180)%360-180;return Je<-180?Je+360:Je}(r.center.lng,Se);const Me=$(Se),De=ge(X(we),0,1);return new ve(Me,De)}class qj{constructor(e,n,l){this.a=On([],e,l),this.b=On([],n,l),this.center=l;const u=wi([],this.a),f=wi([],this.b);this.angle=Math.acos(ni(u,f))}}function bb(r,e){if(r.angle===0)return null;let n;return n=r.a[e]===0?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[e]/r.a[e]/Math.sin(r.angle)-1/Math.tan(r.angle)),n<0||n>1?null:function(l,u,f,p){const y=Math.sin(f);return l*(Math.sin((1-p)*f)/y)+u*(Math.sin(p*f)/y)}(r.a[e],r.b[e],r.angle,ge(n,0,1))+r.center[e]}function Kl(r){if(r.z<=1)return Hj[r.z+2*r.y+r.x];const e=Sb(hv(r));return Gi.fromPoints(e)}function Lc(r,e,n){return jt(r,r,1-n),gi(r,r,e,n)}function rA(r,e,n){for(const l of r)Ri(l,l,e),jt(l,l,n)}function sA(r,e,n,l){const u=e/r.worldSize,f=r.globeMatrix;if(n.z<=1){const De=Kl(n).getCorners();return rA(De,f,u),Gi.fromPoints(De)}const p=hv(n,l),y=Sb(p,Fs+dv(r._tileCoverLift));rA(y,f,u);const b=Number.MAX_VALUE,S=[-b,-b,-b],A=[b,b,b];if(p.contains(r.center)){for(const Le of y)Tt(A,A,Le),ii(S,S,Le);S[2]=0;const De=r.point,Xe=[De.x*u,De.y*u,0];return Tt(A,A,Xe),ii(S,S,Xe),new Gi(A,S)}if(r._tileCoverLift>0){for(const De of y)Tt(A,A,De),ii(S,S,De);return new Gi(A,S)}const P=[f[12]*u,f[13]*u,f[14]*u],M=p.getCenter(),N=ge(r.center.lat,-_e,_e),L=ge(M.lat,-_e,_e),U=$(r.center.lng),H=X(N);let K=U-$(M.lng);const se=H-X(L);K>.5?K-=1:K<-.5&&(K+=1);let re=0;Math.abs(K)>Math.abs(se)?re=K>=0?1:3:(re=se>=0?0:2,gi(P,P,[f[4]*u,f[5]*u,f[6]*u],-Math.sin(pn(se>=0?p.getSouth():p.getNorth()))*Fs));const le=y[re],Ee=y[(re+1)%4],we=new qj(le,Ee,P),Se=[bb(we,0)||le[0],bb(we,1)||le[1],bb(we,2)||le[2]],Me=Bu(r.zoom);if(Me>0){const De=function({x:Le,y:Je,z:yt},tt,ut,gt,We){const dt=1/(1<<yt);let ze=Le*dt,Ze=ze+dt,wt=Je*dt,ft=wt+dt,Zt=0;const Ut=(ze+Ze)/2-gt;return Ut>.5?Zt=-1:Ut<-.5&&(Zt=1),ze=((ze+Zt)*tt-(gt*=tt))*ut+gt,Ze=((Ze+Zt)*tt-gt)*ut+gt,wt=(wt*tt-(We*=tt))*ut+We,ft=(ft*tt-We)*ut+We,[[ze,ft,0],[Ze,ft,0],[Ze,wt,0],[ze,wt,0]]}(n,e,r._pixelsPerMercatorPixel,U,H);for(let Le=0;Le<y.length;Le++)Lc(y[Le],De[Le],Me);const Xe=Nt([],De[re],De[(re+1)%4]);jt(Xe,Xe,.5),Lc(Se,Xe,Me)}for(const De of y)Tt(A,A,De),ii(S,S,De);return A[2]=Math.min(le[2],Ee[2]),Tt(A,A,Se),ii(S,S,Se),new Gi(A,S)}function hv({x:r,y:e,z:n},l=!1){const u=1/(1<<n),f=new D(ne(r*u),e===(1<<n)-1&&l?-90:ae((e+1)*u)),p=new D(ne((r+1)*u),e===0&&l?90:ae(e*u));return new z(f,p)}function Sb(r,e=Fs){const n=pn(r.getNorth()),l=pn(r.getSouth()),u=Math.cos(n),f=Math.cos(l),p=Math.sin(n),y=Math.sin(l),b=r.getWest(),S=r.getEast();return[w(f,y,b,e),w(f,y,S,e),w(u,p,S,e),w(u,p,b,e)]}function Zg(r,e,n,l){const u=1<<n.z,f=(r/Et+n.x)/u;return T(ae((e/Et+n.y)/u),ne(f),l)}function fv({min:r,max:e}){return t/Math.max(e[0]-r[0],e[1]-r[1],e[2]-r[2])}const oA=new Float64Array(16);function pv(r){const e=fv(r),n=et(oA,[e,e,e]);return ee(n,n,ir([],r.min))}function Tb(r){const e=(l=r.min,(n=oA)[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=l[0],n[13]=l[1],n[14]=l[2],n[15]=1,n);var n,l;const u=1/fv(r);return Q(e,e,[u,u,u])}function Eb(r){const e=Et/(2*Math.PI);return r/(2*Math.PI)/e}function aA(r,e){return Et/(512*Math.pow(2,r))*fv(Kl(e))}function lA(r,e,n,l,u){const f=Eb(n),p=[r,e,-n/(2*Math.PI)],y=J(new Float64Array(16));return ee(y,y,p),Q(y,y,[f,f,f]),Ie(y,y,pn(-u)),pe(y,y,pn(-l)),y}function Bu(r){return Re(cv,d,r)}function cA(r,e){const n=T(e.lat,e.lng),l=function(L){const U=T(L._center.lat,L._center.lng);let H=Fi([],Pt(0,1,0),U);const K=at([],-L.angle,U);H=Ri(H,H,K),at(K,-L._pitch,H);const se=wi([],U);return jt(se,se,dv(L.cameraToCenterDistance/L.pixelsPerMeter)),Ri(se,se,K),Nt([],U,se)}(r);return p=(u=bi([],l,n))[0],y=u[1],b=u[2],S=(f=n)[0],A=f[1],P=f[2],N=(M=Math.sqrt(p*p+y*y+b*b)*Math.sqrt(S*S+A*A+P*P))&&ni(u,f)/M,Math.acos(Math.min(Math.max(N,-1),1));var u,f,p,y,b,S,A,P,M,N}function Cb(r,e){return cA(r,e)>Math.PI/2*1.01}const uA=pn(85),Wj=Math.cos(uA),Zj=Math.sin(uA),Xj=ue(),dA=r=>{const e=[];return r.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),r.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function hA(r,e,n,l,u,f,p,y,b){if(f&&r.queryGeometry.isAboveHorizon)return!1;f&&(b*=r.pixelToTileUnitsFactor);const S=r.tileID.canonical,A=n.projection.upVectorScale(S,n.center.lat,n.worldSize).metersToTile;for(const P of e)for(const M of P){const N=M.add(y),L=u&&n.elevation?n.elevation.exaggeration()*u.getElevationAt(N.x,N.y,!0):0,U=n.projection.projectTilePoint(N.x,N.y,S);if(L>0){const re=n.projection.upVector(S,N.x,N.y);U.x+=re[0]*A*L,U.y+=re[1]*A*L,U.z+=re[2]*A*L}const H=f?N:Kj(U.x,U.y,U.z,l),K=f?r.tilespaceRays.map(re=>Jj(re,L)):r.queryGeometry.screenGeometry,se=rt([],[U.x,U.y,U.z,1],l);if(!p&&f?b*=se[3]/n.cameraToCenterDistance:p&&!f&&(b*=n.cameraToCenterDistance/se[3]),f){const re=ae((M.y/Et+S.y)/(1<<S.z));b/=n.projection.pixelsPerMeter(re,1)/Z(1,re)}if(Dr(K,H,b))return!0}return!1}function Kj(r,e,n,l){const u=rt([],[r,e,n,1],l);return new ht(u[0]/u[3],u[1]/u[3])}const fA=Pt(0,0,0),Yj=Pt(0,0,1);function Jj(r,e){const n=mt();return fA[2]=e,r.intersectsPlane(fA,Yj,n),new ht(n[0],n[1])}class pA extends xn{}let mA,gA,_A,yA;function xA(r,{width:e,height:n},l,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*n*l)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*n*l);return r.width=e,r.height=n,r.data=u,r}function vA(r,e,n){const{width:l,height:u}=e;l===r.width&&u===r.height||(Ab(r,e,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,l),height:Math.min(r.height,u)},n,null),r.width=l,r.height=u,r.data=e.data)}function Ab(r,e,n,l,u,f,p,y){if(u.width===0||u.height===0)return e;if(u.width>r.width||u.height>r.height||n.x>r.width-u.width||n.y>r.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||l.x>e.width-u.width||l.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const b=r.data,S=e.data,A=f===4&&y;for(let P=0;P<u.height;P++){const M=((n.y+P)*r.width+n.x)*f,N=((l.y+P)*e.width+l.x)*f;if(A)for(let L=0;L<u.width;L++){const U=M+L*f+3,H=N+L*f;S[H+0]=255,S[H+1]=255,S[H+2]=255,S[H+3]=b[U]}else if(p)for(let L=0;L<u.width;L++){const U=M+L*f,H=N+L*f,K=new bn(b[U+0]/255,b[U+1]/255,b[U+2]/255,b[U+3]).toNonPremultipliedRenderColor(p).toArray();S[H+0]=K[0],S[H+1]=K[1],S[H+2]=K[2],S[H+3]=K[3]}else for(let L=0;L<u.width*f;L++)S[N+L]=b[M+L]}return e}Bt(pA,"HeatmapBucket",{omit:["layers"]});class Vu{constructor(e,n){xA(this,e,1,n)}resize(e){vA(this,new Vu(e),1)}clone(){return new Vu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,l,u,f){Ab(e,n,l,u,f,1,null)}}class Cs{constructor(e,n){xA(this,e,4,n)}resize(e){vA(this,new Cs(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Cs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,l,u,f,p,y){Ab(e,n,l,u,f,4,p,y)}}class wA{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}function Xg(r){const e={},n=r.resolution||256,l=r.clips?r.clips.length:1,u=r.image||new Cs({width:n,height:l}),f=(p,y,b)=>{e[r.evaluationKey]=b;const S=r.expression.evaluate(e),A=S?S.toNonPremultipliedRenderColor(null):null;A&&(u.data[p+y+0]=Math.floor(255*A.r),u.data[p+y+1]=Math.floor(255*A.g),u.data[p+y+2]=Math.floor(255*A.b),u.data[p+y+3]=Math.floor(255*A.a))};if(r.clips)for(let p=0,y=0;p<l;++p,y+=4*n)for(let b=0,S=0;b<n;b++,S+=4){const A=b/(n-1),{start:P,end:M}=r.clips[p];f(y,S,P*(1-A)+M*A)}else for(let p=0,y=0;p<n;p++,y+=4)f(0,y,p/(n-1));return u}Bt(Vu,"AlphaImage"),Bt(Cs,"RGBAImage");const Qj=Qi([{name:"a_pos",components:2,type:"Int16"}],4),e4=Qi([{name:"a_road_z_offset",components:1,type:"Float32"}],4),t4=Qi([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),i4=Qi([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function dp(r,e,n=2){const l=e&&e.length,u=l?e[0]*n:r.length;let f=bA(r,0,u,n,!0);const p=[];if(!f||f.next===f.prev)return p;let y,b,S;if(l&&(f=function(A,P,M,N){const L=[];for(let U=0,H=P.length;U<H;U++){const K=bA(A,P[U]*N,U<H-1?P[U+1]*N:A.length,N,!1);K===K.next&&(K.steiner=!0),L.push(u4(K))}L.sort(a4);for(let U=0;U<L.length;U++)M=l4(L[U],M);return M}(r,e,f,n)),r.length>80*n){y=r[0],b=r[1];let A=y,P=b;for(let M=n;M<u;M+=n){const N=r[M],L=r[M+1];N<y&&(y=N),L<b&&(b=L),N>A&&(A=N),L>P&&(P=L)}S=Math.max(A-y,P-b),S=S!==0?32767/S:0}return Kg(f,p,n,y,b,S,0),p}function bA(r,e,n,l,u){let f;if(u===function(p,y,b,S){let A=0;for(let P=y,M=b-S;P<b;P+=S)A+=(p[M]-p[P])*(p[P+1]+p[M+1]),M=P;return A}(r,e,n,l)>0)for(let p=e;p<n;p+=l)f=CA(p/l|0,r[p],r[p+1],f);else for(let p=n-l;p>=e;p-=l)f=CA(p/l|0,r[p],r[p+1],f);return f&&hp(f,f.next)&&(Qg(f),f=f.next),f}function Ih(r,e){if(!r)return r;e||(e=r);let n,l=r;do if(n=!1,l.steiner||!hp(l,l.next)&&ns(l.prev,l,l.next)!==0)l=l.next;else{if(Qg(l),l=e=l.prev,l===l.next)break;n=!0}while(n||l!==e);return e}function Kg(r,e,n,l,u,f,p){if(!r)return;!p&&f&&function(b,S,A,P){let M=b;do M.z===0&&(M.z=Ib(M.x,M.y,S,A,P)),M.prevZ=M.prev,M.nextZ=M.next,M=M.next;while(M!==b);M.prevZ.nextZ=null,M.prevZ=null,function(N){let L,U=1;do{let H,K=N;N=null;let se=null;for(L=0;K;){L++;let re=K,le=0;for(let we=0;we<U&&(le++,re=re.nextZ,re);we++);let Ee=U;for(;le>0||Ee>0&&re;)le!==0&&(Ee===0||!re||K.z<=re.z)?(H=K,K=K.nextZ,le--):(H=re,re=re.nextZ,Ee--),se?se.nextZ=H:N=H,H.prevZ=se,se=H;K=re}se.nextZ=null,U*=2}while(L>1)}(M)}(r,l,u,f);let y=r;for(;r.prev!==r.next;){const b=r.prev,S=r.next;if(f?r4(r,l,u,f):n4(r))e.push(b.i,r.i,S.i),Qg(r),r=S.next,y=S.next;else if((r=S)===y){p?p===1?Kg(r=s4(Ih(r),e),e,n,l,u,f,2):p===2&&o4(r,e,n,l,u,f):Kg(Ih(r),e,n,l,u,f,1);break}}}function n4(r){const e=r.prev,n=r,l=r.next;if(ns(e,n,l)>=0)return!1;const u=e.x,f=n.x,p=l.x,y=e.y,b=n.y,S=l.y,A=Math.min(u,f,p),P=Math.min(y,b,S),M=Math.max(u,f,p),N=Math.max(y,b,S);let L=l.next;for(;L!==e;){if(L.x>=A&&L.x<=M&&L.y>=P&&L.y<=N&&Yg(u,y,f,b,p,S,L.x,L.y)&&ns(L.prev,L,L.next)>=0)return!1;L=L.next}return!0}function r4(r,e,n,l){const u=r.prev,f=r,p=r.next;if(ns(u,f,p)>=0)return!1;const y=u.x,b=f.x,S=p.x,A=u.y,P=f.y,M=p.y,N=Math.min(y,b,S),L=Math.min(A,P,M),U=Math.max(y,b,S),H=Math.max(A,P,M),K=Ib(N,L,e,n,l),se=Ib(U,H,e,n,l);let re=r.prevZ,le=r.nextZ;for(;re&&re.z>=K&&le&&le.z<=se;){if(re.x>=N&&re.x<=U&&re.y>=L&&re.y<=H&&re!==u&&re!==p&&Yg(y,A,b,P,S,M,re.x,re.y)&&ns(re.prev,re,re.next)>=0||(re=re.prevZ,le.x>=N&&le.x<=U&&le.y>=L&&le.y<=H&&le!==u&&le!==p&&Yg(y,A,b,P,S,M,le.x,le.y)&&ns(le.prev,le,le.next)>=0))return!1;le=le.nextZ}for(;re&&re.z>=K;){if(re.x>=N&&re.x<=U&&re.y>=L&&re.y<=H&&re!==u&&re!==p&&Yg(y,A,b,P,S,M,re.x,re.y)&&ns(re.prev,re,re.next)>=0)return!1;re=re.prevZ}for(;le&&le.z<=se;){if(le.x>=N&&le.x<=U&&le.y>=L&&le.y<=H&&le!==u&&le!==p&&Yg(y,A,b,P,S,M,le.x,le.y)&&ns(le.prev,le,le.next)>=0)return!1;le=le.nextZ}return!0}function s4(r,e){let n=r;do{const l=n.prev,u=n.next.next;!hp(l,u)&&TA(l,n,n.next,u)&&Jg(l,u)&&Jg(u,l)&&(e.push(l.i,n.i,u.i),Qg(n),Qg(n.next),n=r=u),n=n.next}while(n!==r);return Ih(n)}function o4(r,e,n,l,u,f){let p=r;do{let y=p.next.next;for(;y!==p.prev;){if(p.i!==y.i&&d4(p,y)){let b=EA(p,y);return p=Ih(p,p.next),b=Ih(b,b.next),Kg(p,e,n,l,u,f,0),void Kg(b,e,n,l,u,f,0)}y=y.next}p=p.next}while(p!==r)}function a4(r,e){let n=r.x-e.x;return n===0&&(n=r.y-e.y,n===0)&&(n=(r.next.y-r.y)/(r.next.x-r.x)-(e.next.y-e.y)/(e.next.x-e.x)),n}function l4(r,e){const n=function(u,f){let p=f;const y=u.x,b=u.y;let S,A=-1/0;if(hp(u,p))return p;do{if(hp(u,p.next))return p.next;if(b<=p.y&&b>=p.next.y&&p.next.y!==p.y){const U=p.x+(b-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(U<=y&&U>A&&(A=U,S=p.x<p.next.x?p:p.next,U===y))return S}p=p.next}while(p!==f);if(!S)return null;const P=S,M=S.x,N=S.y;let L=1/0;p=S;do{if(y>=p.x&&p.x>=M&&y!==p.x&&SA(b<N?y:A,b,M,N,b<N?A:y,b,p.x,p.y)){const U=Math.abs(b-p.y)/(y-p.x);Jg(p,u)&&(U<L||U===L&&(p.x>S.x||p.x===S.x&&c4(S,p)))&&(S=p,L=U)}p=p.next}while(p!==P);return S}(r,e);if(!n)return e;const l=EA(n,r);return Ih(l,l.next),Ih(n,n.next)}function c4(r,e){return ns(r.prev,r,e.prev)<0&&ns(e.next,r,r.next)<0}function Ib(r,e,n,l,u){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-n)*u|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function u4(r){let e=r,n=r;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==r);return n}function SA(r,e,n,l,u,f,p,y){return(u-p)*(e-y)>=(r-p)*(f-y)&&(r-p)*(l-y)>=(n-p)*(e-y)&&(n-p)*(f-y)>=(u-p)*(l-y)}function Yg(r,e,n,l,u,f,p,y){return!(r===p&&e===y)&&SA(r,e,n,l,u,f,p,y)}function d4(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(n,l){let u=n;do{if(u.i!==n.i&&u.next.i!==n.i&&u.i!==l.i&&u.next.i!==l.i&&TA(u,u.next,n,l))return!0;u=u.next}while(u!==n);return!1}(r,e)&&(Jg(r,e)&&Jg(e,r)&&function(n,l){let u=n,f=!1;const p=(n.x+l.x)/2,y=(n.y+l.y)/2;do u.y>y!=u.next.y>y&&u.next.y!==u.y&&p<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next;while(u!==n);return f}(r,e)&&(ns(r.prev,r,e.prev)||ns(r,e.prev,e))||hp(r,e)&&ns(r.prev,r,r.next)>0&&ns(e.prev,e,e.next)>0)}function ns(r,e,n){return(e.y-r.y)*(n.x-e.x)-(e.x-r.x)*(n.y-e.y)}function hp(r,e){return r.x===e.x&&r.y===e.y}function TA(r,e,n,l){const u=gv(ns(r,e,n)),f=gv(ns(r,e,l)),p=gv(ns(n,l,r)),y=gv(ns(n,l,e));return u!==f&&p!==y||!(u!==0||!mv(r,n,e))||!(f!==0||!mv(r,l,e))||!(p!==0||!mv(n,r,l))||!(y!==0||!mv(n,e,l))}function mv(r,e,n){return e.x<=Math.max(r.x,n.x)&&e.x>=Math.min(r.x,n.x)&&e.y<=Math.max(r.y,n.y)&&e.y>=Math.min(r.y,n.y)}function gv(r){return r>0?1:r<0?-1:0}function Jg(r,e){return ns(r.prev,r,r.next)<0?ns(r,e,r.next)>=0&&ns(r,r.prev,e)>=0:ns(r,e,r.prev)<0||ns(r,r.next,e)<0}function EA(r,e){const n=Pb(r.i,r.x,r.y),l=Pb(e.i,e.x,e.y),u=r.next,f=e.prev;return r.next=e,e.prev=r,n.next=u,u.prev=n,l.next=n,n.prev=l,f.next=l,l.prev=f,l}function CA(r,e,n,l){const u=Pb(r,e,n);return l?(u.next=l.next,u.prev=l,l.next.prev=u,l.next=u):(u.prev=u,u.next=u),u}function Qg(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Pb(r,e,n){return{i:r,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function e_(r,e){const n=r.length;if(n<=1)return[r];const l=[];let u,f;for(let p=0;p<n;p++){const y=Xr(r[p]);y!==0&&(r[p].area=Math.abs(y),f===void 0&&(f=y<0),f===y<0?(u&&l.push(u),u=[r[p]]):u.push(r[p]))}if(u&&l.push(u),e>1)for(let p=0;p<l.length;p++)l[p].length<=e||(zs(l[p],e,1,l[p].length-1,h4),l[p]=l[p].slice(0,e));return l}function h4(r,e){return e.area-r.area}function AA(r,e,n=1){if(!r)return null;const l=typeof r=="string"?oo.from(r).getPrimary():r.getPrimary(),u=typeof r=="string"?null:r.getSecondary();for(const f of[l,u]){if(!f)continue;const p=f.id.toString();e.has(p)||e.set(p,[]),f.scaleSelf(n),e.get(p).push(f)}return{primary:l.toString(),secondary:u?u.toString():null}}function Mb(r,e,n,l){const u=l.patternDependencies;let f=!1;for(const p of e){const y=p.paint.get(`${r}-pattern`);y.isConstant()||(f=!0),AA(y.constantOr(null),u,n)&&(f=!0)}return f}function Rb(r,e,n,l,u,f){const p=f.patternDependencies;for(const y of e){const b=y.paint.get(`${r}-pattern`).value;if(b.kind!=="constant"){let S=b.evaluate({zoom:l},n,{},f.availableImages);S=S&&S.name?S.name:S;const A=AA(S,p,u);if(!A)continue;const{primary:P,secondary:M}=A;P&&(n.patterns[y.id]=[P,M].filter(Boolean))}}return n}class IA{constructor(){this.polygons=new Map}add(e,...n){this.polygons.has(e)?this.polygons.get(e).push(...n):this.polygons.set(e,n)}merge(e){for(const[n,l]of e.polygons)this.add(n,...l)}}class Ph{constructor(){this.portals=[]}static evaluate(e){if(e.length===0)return new Ph;let n=[];for(const S of e)n.push(...S.portals);if(n.length===0)return new Ph;const l=(S,A)=>S<=0&&A<=0||S>=Et&&A>=Et;for(const S of n){const A=S.va,P=S.vb;(l(A.x,P.x)||l(A.y,P.y))&&(S.type="border")}const u=n.filter(S=>S.type!=="unevaluated"),f=n.filter(S=>S.type==="unevaluated");if(f.length===0)return new Ph;f.sort((S,A)=>S.hash===A.hash?S.isTunnel===A.isTunnel?0:S.isTunnel?-1:1:S.hash<A.hash?1:-1),n=u.concat(f);let p=u.length,y=p,b=p;do if(y++,y===n.length||n[p].hash!==n[y].hash){if(y-p==2){b<p&&(n[b]=n[p],n[p]=null);const S=n[b],A=n[y-1];S.type=S.isTunnel!==A.isTunnel?"tunnel":"polygon",S.connection={a:S.connection.a,b:A.connection.a},b++}p=y}while(p!==n.length);return n.splice(b),n.sort((S,A)=>S.hash<A.hash?1:-1),{portals:n}}}Bt(Ph,"ElevationPortalGraph"),Bt(IA,"ElevationPolygons");class f4{constructor(e,n,l){this.outPositions=e,this.outNormals=n,this.outIndices=l,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,n,l){let u=e[2];l!=null&&(u*=l);const f=this.getVec3Bits(e)<<96n|this.getVec3Bits(n),p=this.vertexLookup.get(f);if(p!=null)return p;const y=this.outPositions.length;this.vertexLookup.set(f,y);const b=Math.trunc(16384*n[0]),S=Math.trunc(16384*n[1]),A=Math.trunc(16384*n[2]);return this.outPositions.emplaceBack(e[0],e[1],u),this.outNormals.emplaceBack(b,S,A),y}addTriangle(e,n,l){this.outIndices.emplaceBack(e,n,l)}addTriangles(e,n,l){if(e.length===0)return;const u=l.length===1,f=mt(),p=mt();for(let y=0;y<e.length;y+=3){const b=n[e[y+0]],S=n[e[y+1]],A=n[e[y+2]],P=u?l[0]:l[e[y+1]],M=u?l[0]:l[e[y+2]];ti(f,b.x,b.y,u?l[0]:l[e[y+0]]);const N=this.addVertex(f,p);ti(f,S.x,S.y,P);const L=this.addVertex(f,p);ti(f,A.x,A.y,M);const U=this.addVertex(f,p);this.outIndices.emplaceBack(N,L,U)}}addQuad(e,n,l,u,f,p){const y=this.addVertex(e,f,p),b=this.addVertex(n,f,p),S=this.addVertex(l,f,p),A=this.addVertex(u,f,p);this.addTriangle(y,b,S),this.addTriangle(S,A,y)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class Bo{constructor(e,n,l,u){this.unevaluatedPortals=new Ph,this.portalPolygons=new IA,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Pg,this.vertexNormals=new Mg,this.indexArray=new Qn,this.tileToMeters=xe(e),this.bridgeProgramConfigurations=new Lo(n,{zoom:l,lut:u},f=>f!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new Lo(n,{zoom:l,lut:u},f=>f!=="fill-bridge-guard-rail-color")}addVertices(e,n){const l=this.unevalVertices.length;for(let u=0;u<e.length;u++)this.unevalVertices.push(e[u]),this.unevalHeights.push(n[u]);return l}addTriangles(e,n,l){const u=l?this.unevalTunnelTriangles:this.unevalTriangles;for(const f of e)u.push(f+n)}addRenderableRing(e,n,l,u,f,p){const y=[new ht(f.min.x,f.min.y),new ht(f.max.x,f.min.y),new ht(f.max.x,f.max.y),new ht(f.min.x,f.max.y)];for(let b=0;b<l-1;b++){const S=n+b,A=S+1,P=this.unevalVertices[S],M=this.unevalVertices[A];if(!(P.x>=f.min.x&&P.x<=f.max.x&&P.y>=f.min.y&&P.y<=f.max.y||M.x>=f.min.x&&M.x<=f.max.x&&M.y>=f.min.y&&M.y<=f.max.y||fr(P,M,y))||this.isOnBorder(P.x,M.x)||this.isOnBorder(P.y,M.y))continue;const N=Bo.computeEdgeHash(this.unevalVertices[S],this.unevalVertices[A]);let L,U=this.vertexHashLookup.get(Bo.computePosHash(P));U!=null?L=U.next:(U=this.vertexHashLookup.get(Bo.computePosHash(M)),L=U!=null?U.prev:N),this.unevalEdges.push({polygonIdx:e,a:S,b:A,hash:N,portalHash:L,isTunnel:u,type:"unevaluated",featureInfo:p})}}addPortalCandidates(e,n,l,u,f){if(n.length===0)return;this.portalPolygons.add(e,{geometry:n,zLevel:f});const p=n[0];this.vertexHashLookup.clear();let y=Bo.computeEdgeHash(p[p.length-2],p[p.length-1]);for(let b=0;b<p.length-1;b++){const S=p[b+0],A=p[b+1],P=Ss(A.x-S.x,A.y-S.y),M=as(P);if(M===0)continue;let N="unevaluated";const L=u.pointElevation(S),U=u.pointElevation(A);Math.abs(L)<.01&&Math.abs(U)<.01?N="entrance":(this.isOnBorder(S.x,A.x)||this.isOnBorder(S.y,A.y))&&(N="border");const H=Bo.computeEdgeHash(S,A);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:S,vb:A,vab:P,length:M,hash:H,isTunnel:l,type:N});const K=Bo.computePosHash(S);this.vertexHashLookup.set(K,{prev:y,next:H}),y=H}}construct(e){if(this.unevalVertices.length===0)return;const n=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),l=M=>{M.primitiveLength=this.indexArray.length-M.primitiveOffset},u=new f4(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const f=n(),p=n(),y=n(),b=(M,N)=>{M.sort((U,H)=>U.type===N&&H.type!==N?-1:U.type!==N&&H.type===N?1:0);const L=M.findIndex(U=>U.type!==N);return L>=0?L:M.length};let S=0;this.unevalEdges.length>0&&(S=b(this.unevalEdges,"none"),this.constructBridgeStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:S},this.tileToMeters)),l(y);const A=n(),P=n();if(this.unevalEdges.length>0){const M=this.unevalEdges.splice(S),N=b(M,"tunnel")+S;this.unevalEdges.push(...M),this.constructTunnelStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:S},{min:S,max:N})}l(A),u.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),l(P),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),l(p),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),l(f),this.maskSegments=rr.simpleSegment(0,P.primitiveOffset,0,P.primitiveLength),this.depthSegments=rr.simpleSegment(0,p.primitiveOffset,0,p.primitiveLength),this.renderableBridgeSegments=rr.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength),this.renderableTunnelSegments=rr.simpleSegment(0,A.primitiveOffset,0,A.primitiveLength),this.shadowCasterSegments=rr.simpleSegment(0,f.primitiveOffset,0,f.primitiveLength)}update(e,n,l,u,f,p,y,b){this.bridgeProgramConfigurations.updatePaintArrays(e,n,f,l,u,p,y,b),this.tunnelProgramConfigurations.updatePaintArrays(e,n,f,l,u,p,y,b)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,t4.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,i4.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,n,l,u,f){const p=(y,b)=>{for(let S=0;S<b.length-1;S++){const A=b[S].featureIndex,P=b[S+1].vertexStart,M=e.feature(A);y.populatePaintArrays(P,M,A,{},l,n,u,void 0,f)}};p(this.bridgeProgramConfigurations,this.bridgeFeatureSections),p(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,n,l,u,f){const p=new Map;for(let y=u;y<f;y++){const b=l[y],S=b.a,A=b.b,P=Bo.computePosHash(e[S]),M=Bo.computePosHash(e[A]);let N=p.get(P);N||(N={},p.set(P,N));let L=p.get(M);L||(L={},p.set(M,L)),n[S]<=0&&n[A]<=0||(N.to=A,L.from=S)}return p}isTerminalVertex(e,n){const l=Bo.computePosHash(this.unevalVertices[e]),u=n.get(l);return!u||!u.from||!u.to}constructBridgeStructures(e,n,l,u,f,p){e.clearVertexLookup();const y=this.computeVertexConnections(n,l,u,f.min,f.max),b=1/p,S=.5*b,A=(ut,gt)=>ti(ut,n[gt].x,n[gt].y,l[gt]*b),P=mt(),M=mt(),N=mt(),L=mt(),U=mt(),H=(ut,gt)=>{const We=y.get(Bo.computePosHash(n[gt])),dt=We.from,ze=We.to;if(!dt||!ze)return;A(P,dt),A(M,gt),A(N,ze),Zr(L),wr(P,M)||(On(U,M,P),wi(L,U)),wr(N,M)||(On(U,N,M),Nt(L,L,wi(U,U)));const Ze=bs(L);return Ze>0?jt(ut,L,1/Ze):void 0};let K=Number.POSITIVE_INFINITY;this.sortSubarray(u,f.min,f.max,(ut,gt)=>ut.featureInfo.featureIndex-gt.featureInfo.featureIndex);const se=mt(),re=mt(),le=mt(),Ee=mt(),we=mt(),Se=mt(),Me=mt(),De=mt(),Xe=mt(),Le=[mt(),mt(),mt(),mt()],Je=[mt(),mt(),mt(),mt()],yt=[{coord:new ht(0,0),height:0},{coord:new ht(0,0),height:0}],tt=(ut,gt)=>ut>gt;for(let ut=f.min;ut<f.max;ut++){const gt=u[ut];if(!gt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(yt,n,l,gt,tt))continue;const[We,dt]=yt;if(ti(se,We.coord.x,We.coord.y,b*We.height),ti(re,dt.coord.x,dt.coord.y,b*dt.height),wr(se,re))continue;On(le,re,se),wi(le,le);const ze=H(De,gt.a)||le,Ze=H(Xe,gt.b)||le;ti(Ee,ze[1],-ze[0],0),wi(Ee,Ee),ti(we,Ze[1],-Ze[0],0),wi(we,we),Fi(De,Ee,ze),wi(Se,De),Fi(De,we,Ze),wi(Me,De),Nt(Le[0],se,jt(De,On(De,Ee,Se),S)),Nt(Le[1],se,jt(De,Nt(De,Ee,Se),S)),Nt(Le[2],se,jt(De,Se,S)),Le[3]=se,Nt(Je[0],re,jt(De,On(De,we,Me),S)),Nt(Je[1],re,jt(De,Nt(De,we,Me),S)),Nt(Je[2],re,jt(De,Me,S)),Je[3]=re,K=this.addFeatureSection(gt.featureInfo.featureIndex,K,this.bridgeFeatureSections,e);const wt=e.addVertex(Le[0],Ee,p),ft=e.addVertex(Le[1],Ee,p),Zt=e.addVertex(Je[0],we,p),Ut=e.addVertex(Je[1],we,p);e.addTriangle(wt,ft,Zt),e.addTriangle(ft,Ut,Zt);const lt=e.addVertex(Le[1],Se,p),pt=e.addVertex(Le[2],Se,p),$t=e.addVertex(Je[1],Me,p),zt=e.addVertex(Je[2],Me,p);e.addTriangle(lt,pt,$t),e.addTriangle(pt,zt,$t),ir(Ee,Ee),ir(we,we);const At=e.addVertex(Le[2],Ee,p),Ot=e.addVertex(Le[3],Ee,p),li=e.addVertex(Je[2],we,p),vi=e.addVertex(Je[3],we,p);e.addTriangle(At,Ot,li),e.addTriangle(Ot,vi,li);const Di=this.isTerminalVertex(gt.a,y),Ii=this.isTerminalVertex(gt.b,y);We.height<.01&&Di&&e.addQuad(Le[3],Le[2],Le[1],Le[0],ir(ze,ze),p),dt.height<.01&&Ii&&e.addQuad(Je[0],Je[1],Je[2],Je[3],Ze,p)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,n,l,u,f,p){e.clearVertexLookup();let y=Number.POSITIVE_INFINITY;const b=(K,se)=>K.featureInfo.featureIndex-se.featureInfo.featureIndex;this.sortSubarray(u,f.min,f.max,b),this.sortSubarray(u,p.min,p.max,b);const S=K=>wi(K,K),A=[{coord:new ht(0,0),height:0},{coord:new ht(0,0),height:0}],P=(K,se)=>K<se,M=mt(),N=mt(),L=mt(),U=mt(),H=mt();for(let K=f.min;K<f.max;K++){if(!this.prepareEdgePoints(A,n,l,u[K],P))continue;const[se,re]=A,le=S(ti(H,-(re.coord.y-se.coord.y),re.coord.x-se.coord.x,0));y=this.addFeatureSection(u[K].featureInfo.featureIndex,y,this.tunnelFeatureSections,e),e.addQuad(ti(M,se.coord.x,se.coord.y,se.height),ti(N,re.coord.x,re.coord.y,re.height),ti(L,re.coord.x,re.coord.y,u[K].isTunnel?-.1:0),ti(U,se.coord.x,se.coord.y,u[K].isTunnel?-.1:0),le)}for(let K=p.min;K<p.max;K++){const se=u[K];se.isTunnel&&([se.a,se.b]=[se.b,se.a]);const re=n[se.a],le=n[se.b],Ee=S(ti(H,-(le.y-re.y),le.x-re.x,0));y=this.addFeatureSection(se.featureInfo.featureIndex,y,this.tunnelFeatureSections,e),e.addQuad(ti(M,le.x,le.y,0),ti(N,re.x,re.y,0),ti(L,re.x,re.y,l[se.a]+4),ti(U,le.x,le.y,l[se.b]+4),Ee),e.addQuad(ti(M,re.x,re.y,0),ti(N,le.x,le.y,0),ti(L,le.x,le.y,l[se.b]+4),ti(U,re.x,re.y,l[se.a]+4),Ee)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,n,l,u){e.coord.x=n,e.coord.y=l,e.height=u}prepareEdgePoints(e,n,l,u,f){let p=n[u.a].x,y=n[u.a].y,b=n[u.b].x,S=n[u.b].y,A=l[u.a],P=l[u.b];const M=f(A,0),N=f(P,0);if(M&&N)return this.setElevatedPoint(e[0],p,y,A),this.setElevatedPoint(e[1],b,S,P),!0;if(!M&&!N)return!1;if(M){if(!N){const L=P/(P-A);b=si(b,p,L),S=si(S,y,L),P=si(P,A,L)}}else{const L=A/(A-P);p=si(p,b,L),y=si(y,S,L),A=si(A,P,L)}return this.setElevatedPoint(e[0],p,y,A),this.setElevatedPoint(e[1],b,S,P),!0}prepareEdges(e,n){if(n.length===0)return;n.sort((y,b)=>y.hash===b.hash?b.polygonIdx-y.polygonIdx:b.hash>y.hash?1:-1);let l=0,u=0,f=0,p=n[l].polygonIdx;do u++,(u===n.length||n[l].hash!==n[u].hash)&&((u-l==1||n[u-1].polygonIdx!==p)&&(f<l&&(n[f]=n[l],n[l]=null),n[f].type="none",f++),l=u,l!==n.length&&(p=n[l].polygonIdx));while(l!==n.length);if(n.splice(f),n.length!==0&&e.length!==0){n.sort((S,A)=>S.portalHash<A.portalHash?1:-1);let y=0,b=0;for(;y!==n.length&&b!==e.length;){const S=n[y],A=e[b];S.portalHash>A.hash?y++:A.hash>S.portalHash?b++:(S.type=A.type,y++)}}}isOnBorder(e,n){return e<=0&&n<=0||e>=Et&&n>=Et}addFeatureSection(e,n,l,u){return e!==n&&(n=e,l.push({featureIndex:e,vertexStart:u.getVertexCount()}),u.clearVertexLookup()),n}sortSubarray(e,n,l,u){const f=e.slice(n,l);f.sort(u),e.splice(n,f.length,...f)}static computeEdgeHash(e,n){return(e.y===n.y&&e.x>n.x||e.y>n.y)&&([e,n]=[n,e]),BigInt(Bo.computePosHash(e))<<32n|BigInt(Bo.computePosHash(n))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var PA,MA={exports:{}},RA=(PA||(PA=1,function(r,e){(function(n){function l(he,fe){return he>fe?1:he<fe?-1:0}var u=function(he,fe){he===void 0&&(he=l),fe===void 0&&(fe=!1),this._compare=he,this._root=null,this._size=0,this._noDuplicates=!!fe},f={size:{configurable:!0}};function p(he,fe,He,bt,Mt){var It=Mt-bt;if(It>0){var Gt=bt+Math.floor(It/2),mi={key:fe[Gt],data:He[Gt],parent:he};return mi.left=p(mi,fe,He,bt,Gt),mi.right=p(mi,fe,He,Gt+1,Mt),mi}return null}function y(he,fe,He,bt,Mt){if(!(He>=bt)){for(var It=he[He+bt>>1],Gt=He-1,mi=bt+1;;){do Gt++;while(Mt(he[Gt],It)<0);do mi--;while(Mt(he[mi],It)>0);if(Gt>=mi)break;var qi=he[Gt];he[Gt]=he[mi],he[mi]=qi,qi=fe[Gt],fe[Gt]=fe[mi],fe[mi]=qi}y(he,fe,He,mi,Mt),y(he,fe,mi+1,bt,Mt)}}u.prototype.rotateLeft=function(he){var fe=he.right;fe&&(he.right=fe.left,fe.left&&(fe.left.parent=he),fe.parent=he.parent),he.parent?he===he.parent.left?he.parent.left=fe:he.parent.right=fe:this._root=fe,fe&&(fe.left=he),he.parent=fe},u.prototype.rotateRight=function(he){var fe=he.left;fe&&(he.left=fe.right,fe.right&&(fe.right.parent=he),fe.parent=he.parent),he.parent?he===he.parent.left?he.parent.left=fe:he.parent.right=fe:this._root=fe,fe&&(fe.right=he),he.parent=fe},u.prototype._splay=function(he){for(;he.parent;){var fe=he.parent;fe.parent?fe.left===he&&fe.parent.left===fe?(this.rotateRight(fe.parent),this.rotateRight(fe)):fe.right===he&&fe.parent.right===fe?(this.rotateLeft(fe.parent),this.rotateLeft(fe)):fe.left===he&&fe.parent.right===fe?(this.rotateRight(fe),this.rotateLeft(fe)):(this.rotateLeft(fe),this.rotateRight(fe)):fe.left===he?this.rotateRight(fe):this.rotateLeft(fe)}},u.prototype.splay=function(he){for(var fe,He,bt,Mt,It;he.parent;)(He=(fe=he.parent).parent)&&He.parent?((bt=He.parent).left===He?bt.left=he:bt.right=he,he.parent=bt):(he.parent=null,this._root=he),Mt=he.left,It=he.right,he===fe.left?(He&&(He.left===fe?(fe.right?(He.left=fe.right,He.left.parent=He):He.left=null,fe.right=He,He.parent=fe):(Mt?(He.right=Mt,Mt.parent=He):He.right=null,he.left=He,He.parent=he)),It?(fe.left=It,It.parent=fe):fe.left=null,he.right=fe,fe.parent=he):(He&&(He.right===fe?(fe.left?(He.right=fe.left,He.right.parent=He):He.right=null,fe.left=He,He.parent=fe):(It?(He.left=It,It.parent=He):He.left=null,he.right=He,He.parent=he)),Mt?(fe.right=Mt,Mt.parent=fe):fe.right=null,he.left=fe,fe.parent=he)},u.prototype.replace=function(he,fe){he.parent?he===he.parent.left?he.parent.left=fe:he.parent.right=fe:this._root=fe,fe&&(fe.parent=he.parent)},u.prototype.minNode=function(he){if(he===void 0&&(he=this._root),he)for(;he.left;)he=he.left;return he},u.prototype.maxNode=function(he){if(he===void 0&&(he=this._root),he)for(;he.right;)he=he.right;return he},u.prototype.insert=function(he,fe){var He=this._root,bt=null,Mt=this._compare;if(this._noDuplicates)for(;He;){if(bt=He,Mt(He.key,he)===0)return;He=Mt(He.key,he)<0?He.right:He.left}else for(;He;)bt=He,He=Mt(He.key,he)<0?He.right:He.left;return He={key:he,data:fe,left:null,right:null,parent:bt},bt?Mt(bt.key,He.key)<0?bt.right=He:bt.left=He:this._root=He,this.splay(He),this._size++,He},u.prototype.find=function(he){for(var fe=this._root,He=this._compare;fe;){var bt=He(fe.key,he);if(bt<0)fe=fe.right;else{if(!(bt>0))return fe;fe=fe.left}}return null},u.prototype.contains=function(he){for(var fe=this._root,He=this._compare;fe;){var bt=He(he,fe.key);if(bt===0)return!0;fe=bt<0?fe.left:fe.right}return!1},u.prototype.remove=function(he){var fe=this.find(he);if(!fe)return!1;if(this.splay(fe),fe.left)if(fe.right){var He=this.minNode(fe.right);He.parent!==fe&&(this.replace(He,He.right),He.right=fe.right,He.right.parent=He),this.replace(fe,He),He.left=fe.left,He.left.parent=He}else this.replace(fe,fe.left);else this.replace(fe,fe.right);return this._size--,!0},u.prototype.removeNode=function(he){if(!he)return!1;if(this.splay(he),he.left)if(he.right){var fe=this.minNode(he.right);fe.parent!==he&&(this.replace(fe,fe.right),fe.right=he.right,fe.right.parent=fe),this.replace(he,fe),fe.left=he.left,fe.left.parent=fe}else this.replace(he,he.left);else this.replace(he,he.right);return this._size--,!0},u.prototype.erase=function(he){var fe=this.find(he);if(fe){this.splay(fe);var He=fe.left,bt=fe.right,Mt=null;He&&(He.parent=null,Mt=this.maxNode(He),this.splay(Mt),this._root=Mt),bt&&(He?Mt.right=bt:this._root=bt,bt.parent=Mt),this._size--}},u.prototype.pop=function(){var he=this._root,fe=null;if(he){for(;he.left;)he=he.left;fe={key:he.key,data:he.data},this.remove(he.key)}return fe},u.prototype.next=function(he){var fe=he;if(fe)if(fe.right)for(fe=fe.right;fe&&fe.left;)fe=fe.left;else for(fe=he.parent;fe&&fe.right===he;)he=fe,fe=fe.parent;return fe},u.prototype.prev=function(he){var fe=he;if(fe)if(fe.left)for(fe=fe.left;fe&&fe.right;)fe=fe.right;else for(fe=he.parent;fe&&fe.left===he;)he=fe,fe=fe.parent;return fe},u.prototype.forEach=function(he){for(var fe=this._root,He=[],bt=!1,Mt=0;!bt;)fe?(He.push(fe),fe=fe.left):He.length>0?(he(fe=He.pop(),Mt++),fe=fe.right):bt=!0;return this},u.prototype.range=function(he,fe,He,bt){for(var Mt=[],It=this._compare,Gt=this._root;Mt.length!==0||Gt;)if(Gt)Mt.push(Gt),Gt=Gt.left;else{if(It((Gt=Mt.pop()).key,fe)>0)break;if(It(Gt.key,he)>=0&&He.call(bt,Gt))return this;Gt=Gt.right}return this},u.prototype.keys=function(){for(var he=this._root,fe=[],He=[],bt=!1;!bt;)he?(fe.push(he),he=he.left):fe.length>0?(he=fe.pop(),He.push(he.key),he=he.right):bt=!0;return He},u.prototype.values=function(){for(var he=this._root,fe=[],He=[],bt=!1;!bt;)he?(fe.push(he),he=he.left):fe.length>0?(he=fe.pop(),He.push(he.data),he=he.right):bt=!0;return He},u.prototype.at=function(he){for(var fe=this._root,He=[],bt=!1,Mt=0;!bt;)if(fe)He.push(fe),fe=fe.left;else if(He.length>0){if(fe=He.pop(),Mt===he)return fe;Mt++,fe=fe.right}else bt=!0;return null},u.prototype.load=function(he,fe,He){if(he===void 0&&(he=[]),fe===void 0&&(fe=[]),He===void 0&&(He=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var bt=he.length;return He&&y(he,fe,0,bt-1,this._compare),this._root=p(null,he,fe,0,bt),this._size=bt,this},u.prototype.min=function(){var he=this.minNode(this._root);return he?he.key:null},u.prototype.max=function(){var he=this.maxNode(this._root);return he?he.key:null},u.prototype.isEmpty=function(){return this._root===null},f.size.get=function(){return this._size},u.createTree=function(he,fe,He,bt,Mt){return new u(He,Mt).load(he,fe,bt)},Object.defineProperties(u.prototype,f);var b=0,S=1,A=2,P=3,M=0,N=1,L=2,U=3;function H(he,fe,He){fe===null?(he.inOut=!1,he.otherInOut=!0):(he.isSubject===fe.isSubject?(he.inOut=!fe.inOut,he.otherInOut=fe.otherInOut):(he.inOut=!fe.otherInOut,he.otherInOut=fe.isVertical()?!fe.inOut:fe.inOut),fe&&(he.prevInResult=!K(fe,He)||fe.isVertical()?fe.prevInResult:fe));var bt=K(he,He);he.resultTransition=bt?function(Mt,It){var Gt,mi=!Mt.inOut,qi=!Mt.otherInOut;switch(It){case M:Gt=mi&&qi;break;case N:Gt=mi||qi;break;case U:Gt=mi^qi;break;case L:Gt=Mt.isSubject?mi&&!qi:qi&&!mi}return Gt?1:-1}(he,He):0}function K(he,fe){switch(he.type){case b:switch(fe){case M:return!he.otherInOut;case N:return he.otherInOut;case L:return he.isSubject&&he.otherInOut||!he.isSubject&&!he.otherInOut;case U:return!0}break;case A:return fe===M||fe===N;case P:return fe===L;case S:return!1}return!1}var se=function(he,fe,He,bt,Mt){this.left=fe,this.point=he,this.otherEvent=He,this.isSubject=bt,this.type=Mt||b,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},re={inResult:{configurable:!0}};function le(he,fe){return he[0]===fe[0]&&he[1]===fe[1]}se.prototype.isBelow=function(he){var fe=this.point,He=this.otherEvent.point;return this.left?(fe[0]-he[0])*(He[1]-he[1])-(He[0]-he[0])*(fe[1]-he[1])>0:(He[0]-he[0])*(fe[1]-he[1])-(fe[0]-he[0])*(He[1]-he[1])>0},se.prototype.isAbove=function(he){return!this.isBelow(he)},se.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},re.inResult.get=function(){return this.resultTransition!==0},se.prototype.clone=function(){var he=new se(this.point,this.left,this.otherEvent,this.isSubject,this.type);return he.contourId=this.contourId,he.resultTransition=this.resultTransition,he.prevInResult=this.prevInResult,he.isExteriorRing=this.isExteriorRing,he.inOut=this.inOut,he.otherInOut=this.otherInOut,he},Object.defineProperties(se.prototype,re);var Ee=11102230246251565e-32,we=134217729,Se=(3+8*Ee)*Ee;function Me(he,fe,He,bt,Mt){var It,Gt,mi,qi,Wi=fe[0],Li=bt[0],Mn=0,ur=0;Li>Wi==Li>-Wi?(It=Wi,Wi=fe[++Mn]):(It=Li,Li=bt[++ur]);var ki=0;if(Mn<he&&ur<He)for(Li>Wi==Li>-Wi?(mi=It-((Gt=Wi+It)-Wi),Wi=fe[++Mn]):(mi=It-((Gt=Li+It)-Li),Li=bt[++ur]),It=Gt,mi!==0&&(Mt[ki++]=mi);Mn<he&&ur<He;)Li>Wi==Li>-Wi?(mi=It-((Gt=It+Wi)-(qi=Gt-It))+(Wi-qi),Wi=fe[++Mn]):(mi=It-((Gt=It+Li)-(qi=Gt-It))+(Li-qi),Li=bt[++ur]),It=Gt,mi!==0&&(Mt[ki++]=mi);for(;Mn<he;)mi=It-((Gt=It+Wi)-(qi=Gt-It))+(Wi-qi),Wi=fe[++Mn],It=Gt,mi!==0&&(Mt[ki++]=mi);for(;ur<He;)mi=It-((Gt=It+Li)-(qi=Gt-It))+(Li-qi),Li=bt[++ur],It=Gt,mi!==0&&(Mt[ki++]=mi);return It===0&&ki!==0||(Mt[ki++]=It),ki}function De(he){return new Float64Array(he)}var Xe=33306690738754716e-32,Le=22204460492503146e-32,Je=11093356479670487e-47,yt=De(4),tt=De(8),ut=De(12),gt=De(16),We=De(4);function dt(he,fe,He){var bt=function(Mt,It,Gt,mi,qi,Wi){var Li=(It-Wi)*(Gt-qi),Mn=(Mt-qi)*(mi-Wi),ur=Li-Mn;if(Li===0||Mn===0||Li>0!=Mn>0)return ur;var ki=Math.abs(Li+Mn);return Math.abs(ur)>=Xe*ki?ur:-function(Kn,Vn,Tn,or,Wn,Un,$n){var In,zi,Rn,ar,hi,rn,Zn,pr,Yn,$r,zn,Fr,wo,As,_s,bo,Ql,Hr,ts=Kn-Wn,Is=Tn-Wn,Ks=Vn-Un,js=or-Un;yt[0]=(_s=(pr=ts-(Zn=(rn=we*ts)-(rn-ts)))*($r=js-(Yn=(rn=we*js)-(rn-js)))-((As=ts*js)-Zn*Yn-pr*Yn-Zn*$r))-((zn=_s-(Ql=(pr=Ks-(Zn=(rn=we*Ks)-(rn-Ks)))*($r=Is-(Yn=(rn=we*Is)-(rn-Is)))-((bo=Ks*Is)-Zn*Yn-pr*Yn-Zn*$r)))+(hi=_s-zn))+(hi-Ql),yt[1]=(wo=As-((Fr=As+zn)-(hi=Fr-As))+(zn-hi))-((zn=wo-bo)+(hi=wo-zn))+(hi-bo),yt[2]=Fr-((Hr=Fr+zn)-(hi=Hr-Fr))+(zn-hi),yt[3]=Hr;var Zu=function(hK,GM){for(var $M=GM[0],z2=1;z2<4;z2++)$M+=GM[z2];return $M}(0,yt),R_=Le*$n;if(Zu>=R_||-Zu>=R_||(In=Kn-(ts+(hi=Kn-ts))+(hi-Wn),Rn=Tn-(Is+(hi=Tn-Is))+(hi-Wn),zi=Vn-(Ks+(hi=Vn-Ks))+(hi-Un),ar=or-(js+(hi=or-js))+(hi-Un),In===0&&zi===0&&Rn===0&&ar===0)||(R_=Je*$n+Se*Math.abs(Zu),(Zu+=ts*ar+js*In-(Ks*Rn+Is*zi))>=R_||-Zu>=R_))return Zu;We[0]=(_s=(pr=In-(Zn=(rn=we*In)-(rn-In)))*($r=js-(Yn=(rn=we*js)-(rn-js)))-((As=In*js)-Zn*Yn-pr*Yn-Zn*$r))-((zn=_s-(Ql=(pr=zi-(Zn=(rn=we*zi)-(rn-zi)))*($r=Is-(Yn=(rn=we*Is)-(rn-Is)))-((bo=zi*Is)-Zn*Yn-pr*Yn-Zn*$r)))+(hi=_s-zn))+(hi-Ql),We[1]=(wo=As-((Fr=As+zn)-(hi=Fr-As))+(zn-hi))-((zn=wo-bo)+(hi=wo-zn))+(hi-bo),We[2]=Fr-((Hr=Fr+zn)-(hi=Hr-Fr))+(zn-hi),We[3]=Hr;var fV=Me(4,yt,4,We,tt);We[0]=(_s=(pr=ts-(Zn=(rn=we*ts)-(rn-ts)))*($r=ar-(Yn=(rn=we*ar)-(rn-ar)))-((As=ts*ar)-Zn*Yn-pr*Yn-Zn*$r))-((zn=_s-(Ql=(pr=Ks-(Zn=(rn=we*Ks)-(rn-Ks)))*($r=Rn-(Yn=(rn=we*Rn)-(rn-Rn)))-((bo=Ks*Rn)-Zn*Yn-pr*Yn-Zn*$r)))+(hi=_s-zn))+(hi-Ql),We[1]=(wo=As-((Fr=As+zn)-(hi=Fr-As))+(zn-hi))-((zn=wo-bo)+(hi=wo-zn))+(hi-bo),We[2]=Fr-((Hr=Fr+zn)-(hi=Hr-Fr))+(zn-hi),We[3]=Hr;var pV=Me(fV,tt,4,We,ut);We[0]=(_s=(pr=In-(Zn=(rn=we*In)-(rn-In)))*($r=ar-(Yn=(rn=we*ar)-(rn-ar)))-((As=In*ar)-Zn*Yn-pr*Yn-Zn*$r))-((zn=_s-(Ql=(pr=zi-(Zn=(rn=we*zi)-(rn-zi)))*($r=Rn-(Yn=(rn=we*Rn)-(rn-Rn)))-((bo=zi*Rn)-Zn*Yn-pr*Yn-Zn*$r)))+(hi=_s-zn))+(hi-Ql),We[1]=(wo=As-((Fr=As+zn)-(hi=Fr-As))+(zn-hi))-((zn=wo-bo)+(hi=wo-zn))+(hi-bo),We[2]=Fr-((Hr=Fr+zn)-(hi=Hr-Fr))+(zn-hi),We[3]=Hr;var mV=Me(pV,ut,4,We,gt);return gt[mV-1]}(Mt,It,Gt,mi,qi,Wi,ki)}(he[0],he[1],fe[0],fe[1],He[0],He[1]);return bt>0?-1:bt<0?1:0}function ze(he,fe){var He=he.point,bt=fe.point;return He[0]>bt[0]?1:He[0]<bt[0]?-1:He[1]!==bt[1]?He[1]>bt[1]?1:-1:function(Mt,It,Gt,mi){return Mt.left!==It.left?Mt.left?1:-1:dt(Gt,Mt.otherEvent.point,It.otherEvent.point)!==0?Mt.isBelow(It.otherEvent.point)?-1:1:!Mt.isSubject&&It.isSubject?1:-1}(he,fe,He)}function Ze(he,fe,He){var bt=new se(fe,!1,he,he.isSubject),Mt=new se(fe,!0,he.otherEvent,he.isSubject);return le(he.point,he.otherEvent.point)&&console.warn("what is that, a collapsed segment?",he),bt.contourId=Mt.contourId=he.contourId,ze(Mt,he.otherEvent)>0&&(he.otherEvent.left=!0,Mt.left=!1),he.otherEvent.otherEvent=Mt,he.otherEvent=bt,He.push(Mt),He.push(bt),He}function wt(he,fe){return he[0]*fe[1]-he[1]*fe[0]}function ft(he,fe){return he[0]*fe[0]+he[1]*fe[1]}function Zt(he,fe,He){var bt=function(qi,Wi,Li,Mn,ur){var ki=[Wi[0]-qi[0],Wi[1]-qi[1]],Kn=[Mn[0]-Li[0],Mn[1]-Li[1]];function Vn(rn,Zn,pr){return[rn[0]+Zn*pr[0],rn[1]+Zn*pr[1]]}var Tn=[Li[0]-qi[0],Li[1]-qi[1]],or=wt(ki,Kn),Wn=or*or,Un=ft(ki,ki);if(Wn>0){var $n=wt(Tn,Kn)/or;if($n<0||$n>1)return null;var In=wt(Tn,ki)/or;return In<0||In>1?null:$n===0||$n===1?[Vn(qi,$n,ki)]:In===0||In===1?[Vn(Li,In,Kn)]:[Vn(qi,$n,ki)]}if((Wn=(or=wt(Tn,ki))*or)>0)return null;var zi=ft(ki,Tn)/Un,Rn=zi+ft(ki,Kn)/Un,ar=Math.min(zi,Rn),hi=Math.max(zi,Rn);return ar<=1&&hi>=0?ar===1?[Vn(qi,ar>0?ar:0,ki)]:hi===0?[Vn(qi,hi<1?hi:1,ki)]:[Vn(qi,ar>0?ar:0,ki),Vn(qi,hi<1?hi:1,ki)]:null}(he.point,he.otherEvent.point,fe.point,fe.otherEvent.point),Mt=bt?bt.length:0;if(Mt===0||Mt===1&&(le(he.point,fe.point)||le(he.otherEvent.point,fe.otherEvent.point))||Mt===2&&he.isSubject===fe.isSubject)return 0;if(Mt===1)return le(he.point,bt[0])||le(he.otherEvent.point,bt[0])||Ze(he,bt[0],He),le(fe.point,bt[0])||le(fe.otherEvent.point,bt[0])||Ze(fe,bt[0],He),1;var It=[],Gt=!1,mi=!1;return le(he.point,fe.point)?Gt=!0:ze(he,fe)===1?It.push(fe,he):It.push(he,fe),le(he.otherEvent.point,fe.otherEvent.point)?mi=!0:ze(he.otherEvent,fe.otherEvent)===1?It.push(fe.otherEvent,he.otherEvent):It.push(he.otherEvent,fe.otherEvent),Gt&&mi||Gt?(fe.type=S,he.type=fe.inOut===he.inOut?A:P,Gt&&!mi&&Ze(It[1].otherEvent,It[0].point,He),2):mi?(Ze(It[0],It[1].point,He),3):It[0]!==It[3].otherEvent?(Ze(It[0],It[1].point,He),Ze(It[1],It[2].point,He),3):(Ze(It[0],It[1].point,He),Ze(It[3].otherEvent,It[2].point,He),3)}function Ut(he,fe){if(he===fe)return 0;if(dt(he.point,he.otherEvent.point,fe.point)!==0||dt(he.point,he.otherEvent.point,fe.otherEvent.point)!==0)return le(he.point,fe.point)?he.isBelow(fe.otherEvent.point)?-1:1:he.point[0]===fe.point[0]?he.point[1]<fe.point[1]?-1:1:ze(he,fe)===1?fe.isAbove(he.point)?-1:1:he.isBelow(fe.point)?-1:1;if(he.isSubject!==fe.isSubject)return he.isSubject?-1:1;var He=he.point,bt=fe.point;return He[0]===bt[0]&&He[1]===bt[1]?(He=he.otherEvent.point)[0]===(bt=fe.otherEvent.point)[0]&&He[1]===bt[1]?0:he.contourId>fe.contourId?1:-1:ze(he,fe)===1?1:-1}var lt=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function pt(he,fe,He,bt){var Mt,It=he+1,Gt=fe[he].point,mi=fe.length;for(It<mi&&(Mt=fe[It].point);It<mi&&Mt[0]===Gt[0]&&Mt[1]===Gt[1];){if(!He[It])return It;++It<mi&&(Mt=fe[It].point)}for(It=he-1;He[It]&&It>bt;)It--;return It}lt.prototype.isExterior=function(){return this.holeOf==null};var $t=At,zt=At;function At(he,fe){if(!(this instanceof At))return new At(he,fe);if(this.data=he||[],this.length=this.data.length,this.compare=fe||Ot,this.length>0)for(var He=(this.length>>1)-1;He>=0;He--)this._down(He)}function Ot(he,fe){return he<fe?-1:he>fe?1:0}At.prototype={push:function(he){this.data.push(he),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var he=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),he}},peek:function(){return this.data[0]},_up:function(he){for(var fe=this.data,He=this.compare,bt=fe[he];he>0;){var Mt=he-1>>1,It=fe[Mt];if(He(bt,It)>=0)break;fe[he]=It,he=Mt}fe[he]=bt},_down:function(he){for(var fe=this.data,He=this.compare,bt=this.length>>1,Mt=fe[he];he<bt;){var It=1+(he<<1),Gt=It+1,mi=fe[It];if(Gt<this.length&&He(fe[Gt],mi)<0&&(It=Gt,mi=fe[Gt]),He(mi,Mt)>=0)break;fe[he]=mi,he=It}fe[he]=Mt}},$t.default=zt;var li=Math.max,vi=Math.min,Di=0;function Ii(he,fe,He,bt,Mt,It){var Gt,mi,qi,Wi,Li,Mn;for(Gt=0,mi=he.length-1;Gt<mi;Gt++)if(Wi=he[Gt+1],Li=new se(qi=he[Gt],!1,void 0,fe),Mn=new se(Wi,!1,Li,fe),Li.otherEvent=Mn,qi[0]!==Wi[0]||qi[1]!==Wi[1]){Li.contourId=Mn.contourId=He,It||(Li.isExteriorRing=!1,Mn.isExteriorRing=!1),ze(Li,Mn)>0?Mn.left=!0:Li.left=!0;var ur=qi[0],ki=qi[1];Mt[0]=vi(Mt[0],ur),Mt[1]=vi(Mt[1],ki),Mt[2]=li(Mt[2],ur),Mt[3]=li(Mt[3],ki),bt.push(Li),bt.push(Mn)}}var Yi=[];function Bi(he,fe,He){typeof he[0][0][0]=="number"&&(he=[he]),typeof fe[0][0][0]=="number"&&(fe=[fe]);var bt=function(ki,Kn,Vn){var Tn=null;return ki.length*Kn.length==0&&(Vn===M?Tn=Yi:Vn===L?Tn=ki:Vn!==N&&Vn!==U||(Tn=ki.length===0?Kn:ki)),Tn}(he,fe,He);if(bt)return bt===Yi?null:bt;var Mt=[1/0,1/0,-1/0,-1/0],It=[1/0,1/0,-1/0,-1/0],Gt=function(ki,Kn,Vn,Tn,or){var Wn,Un,$n,In,zi,Rn,ar=new $t(null,ze);for($n=0,In=ki.length;$n<In;$n++)for(zi=0,Rn=(Wn=ki[$n]).length;zi<Rn;zi++)(Un=zi===0)&&Di++,Ii(Wn[zi],!0,Di,ar,Vn,Un);for($n=0,In=Kn.length;$n<In;$n++)for(zi=0,Rn=(Wn=Kn[$n]).length;zi<Rn;zi++)Un=zi===0,or===L&&(Un=!1),Un&&Di++,Ii(Wn[zi],!1,Di,ar,Tn,Un);return ar}(he,fe,Mt,It,He);if(bt=function(ki,Kn,Vn,Tn,or){var Wn=null;return(Vn[0]>Tn[2]||Tn[0]>Vn[2]||Vn[1]>Tn[3]||Tn[1]>Vn[3])&&(or===M?Wn=Yi:or===L?Wn=ki:or!==N&&or!==U||(Wn=ki.concat(Kn))),Wn}(he,fe,Mt,It,He))return bt===Yi?null:bt;for(var mi=function(ki){var Kn,Vn,Tn=function($n){var In,zi,Rn,ar,hi=[];for(zi=0,Rn=$n.length;zi<Rn;zi++)((In=$n[zi]).left&&In.inResult||!In.left&&In.otherEvent.inResult)&&hi.push(In);for(var rn=!1;!rn;)for(rn=!0,zi=0,Rn=hi.length;zi<Rn;zi++)zi+1<Rn&&ze(hi[zi],hi[zi+1])===1&&(ar=hi[zi],hi[zi]=hi[zi+1],hi[zi+1]=ar,rn=!1);for(zi=0,Rn=hi.length;zi<Rn;zi++)(In=hi[zi]).otherPos=zi;for(zi=0,Rn=hi.length;zi<Rn;zi++)(In=hi[zi]).left||(ar=In.otherPos,In.otherPos=In.otherEvent.otherPos,In.otherEvent.otherPos=ar);return hi}(ki),or={},Wn=[],Un=function(){if(!or[Kn]){var $n=Wn.length,In=function(hi,rn,Zn){var pr=new lt;if(hi.prevInResult!=null){var Yn=hi.prevInResult,$r=Yn.outputContourId;if(Yn.resultTransition>0){var zn=rn[$r];if(zn.holeOf!=null){var Fr=zn.holeOf;rn[Fr].holeIds.push(Zn),pr.holeOf=Fr,pr.depth=rn[$r].depth}else rn[$r].holeIds.push(Zn),pr.holeOf=$r,pr.depth=rn[$r].depth+1}else pr.holeOf=null,pr.depth=rn[$r].depth}else pr.holeOf=null,pr.depth=0;return pr}(Tn[Kn],Wn,$n),zi=function(hi){or[hi]=!0,hi<Tn.length&&Tn[hi]&&(Tn[hi].outputContourId=$n)},Rn=Kn,ar=Kn;for(In.points.push(Tn[Kn].point);zi(Rn),zi(Rn=Tn[Rn].otherPos),In.points.push(Tn[Rn].point),!((Rn=pt(Rn,Tn,or,ar))==ar||Rn>=Tn.length)&&Tn[Rn];);Wn.push(In)}};for(Kn=0,Vn=Tn.length;Kn<Vn;Kn++)Un();return Wn}(function(ki,Kn,Vn,Tn,or,Wn){for(var Un,$n,In,zi=new u(Ut),Rn=[],ar=Math.min(Tn[2],or[2]);ki.length!==0;){var hi=ki.pop();if(Rn.push(hi),Wn===M&&hi.point[0]>ar||Wn===L&&hi.point[0]>Tn[2])break;if(hi.left){$n=Un=zi.insert(hi),Un=Un!==(In=zi.minNode())?zi.prev(Un):null,$n=zi.next($n);var rn=Un?Un.key:null;if(H(hi,rn,Wn),$n&&Zt(hi,$n.key,ki)===2&&(H(hi,rn,Wn),H($n.key,hi,Wn)),Un&&Zt(Un.key,hi,ki)===2){var Zn=Un;H(rn,(Zn=Zn!==In?zi.prev(Zn):null)?Zn.key:null,Wn),H(hi,rn,Wn)}}else $n=Un=zi.find(hi=hi.otherEvent),Un&&$n&&(Un=Un!==In?zi.prev(Un):null,$n=zi.next($n),zi.remove(hi),$n&&Un&&Zt(Un.key,$n.key,ki))}return Rn}(Gt,0,0,Mt,It,He)),qi=[],Wi=0;Wi<mi.length;Wi++){var Li=mi[Wi];if(Li.isExterior()){for(var Mn=[Li.points],ur=0;ur<Li.holeIds.length;ur++)Mn.push(mi[Li.holeIds[ur]].points);qi.push(Mn)}}return qi}var qn={UNION:N,DIFFERENCE:L,INTERSECTION:M,XOR:U};n.diff=function(he,fe){return Bi(he,fe,L)},n.intersection=function(he,fe){return Bi(he,fe,M)},n.operations=qn,n.union=function(he,fe){return Bi(he,fe,N)},n.xor=function(he,fe){return Bi(he,fe,U)},Object.defineProperty(n,"__esModule",{value:!0})})(e)}(0,MA.exports)),MA.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function _v(r,e,n,l){const u=[],f=l===0?(p,y,b,S,A,P)=>{p.push(new ht(P,b+(P-y)/(S-y)*(A-b)))}:(p,y,b,S,A,P)=>{p.push(new ht(y+(P-b)/(A-b)*(S-y),P))};for(const p of r){const y=[];for(const b of p){if(b.length<=2)continue;const S=[];for(let M=0;M<b.length-1;M++){const N=b[M].x,L=b[M].y,U=b[M+1].x,H=b[M+1].y,K=l===0?N:L,se=l===0?U:H;K<e?se>e&&f(S,N,L,U,H,e):K>n?se<n&&f(S,N,L,U,H,n):S.push(b[M]),se<e&&K>=e&&f(S,N,L,U,H,e),se>n&&K<=n&&f(S,N,L,U,H,n)}let A=b[b.length-1];const P=l===0?A.x:A.y;P>=e&&P<=n&&S.push(A),S.length&&(A=S[S.length-1],S[0].x===A.x&&S[0].y===A.y||S.push(S[0]),y.push(S))}y.length&&u.push(y)}return u}function p4(r,e){const n=Db(r),l=Db([e]),u=RA.intersection(n,l);return u==null?[]:DA(u)}function m4(r,e){let l=Db(r,65536);for(;e.valid();e.next()){const[u,f]=e.get(),p=u.x*65536,y=u.y*65536,b=f.x*65536,S=f.y*65536,A=b-p,P=S-y,M=Math.hypot(A,P),N=Math.trunc(P/M*3),L=-Math.trunc(A/M*3);l=RA.diff(l,[[[p,y],[b,S],[b+N,S+L],[p+N,y+L],[p,y]]])}return DA(l,1/65536)}function Db(r,e=1){return[r.map(n=>n.map(l=>[l.x*e,l.y*e]))]}function DA(r,e=1){return r.map(n=>n.map((l,u)=>{const f=l.map(p=>new ht(p[0]*e,p[1]*e).round());return u>0&&f.reverse(),f}))}class kb{constructor(e,n){this.layoutVertexArray=new co,this.indexArray=new Qn,this.lineIndexArray=new za,this.triangleSegments=new rr,this.lineSegments=new rr,this.programConfigurations=new Lo(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,n&&(this.elevatedLayoutVertexArray=new Rc)}update(e,n,l,u,f,p,y,b){this.programConfigurations.updatePaintArrays(e,n,f,l,u,p,y,b)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Qj.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,e4.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,n,l,u,f,p,y){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,l,u,f,p,void 0,y)}}class Nb{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new kb(e,!1),this.elevationBufferData=new kb(e,!0),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview}updateFootprints(e,n){}populate(e,n,l,u){this.hasPattern=Mb("fill",this.layers,this.pixelRatio,n);const f=this.layers[0].layout.get("fill-sort-key"),p=[];for(const{feature:y,id:b,index:S,sourceLayerIndex:A}of e){const P=this.layers[0]._featureFilter.needGeometry,M=qe(y,P);if(!this.layers[0]._featureFilter.filter(new Pn(this.zoom,{worldview:this.worldview}),M,l))continue;const N=f?f.evaluate(M,{},l,n.availableImages):void 0,L={id:b,properties:y.properties,type:y.type,sourceLayerIndex:A,index:S,geometry:P?M.geometry:Ae(y,l,u),patterns:{},sortKey:N};p.push(L)}f&&p.sort((y,b)=>y.sortKey-b.sortKey);for(const y of p){const{geometry:b,index:S,sourceLayerIndex:A}=y;if(this.hasPattern){const P=Rb("fill",this.layers,y,this.zoom,this.pixelRatio,n);this.patternFeatures.push(P)}else this.addFeature(y,b,S,l,{},n.availableImages,n.brightness,n.elevationFeatures);n.featureIndex.insert(e[S].feature,b,S,A,this.index)}}update(e,n,l,u,f,p,y){this.bufferData.update(e,n,l,u,f,p,y,this.worldview),this.elevationBufferData.update(e,n,l,u,f,p,y,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,n,l,u,f,p,y,this.worldview)}addFeatures(e,n,l,u,f,p){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,n,l,u,p,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,n,l,u,f,p=[],y,b){const S=e_(n,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,S,u,l,b):this.addGeometry(S,this.bufferData),this.bufferData.populatePaintArrays(e,l,f,p,u,y,this.worldview),this.elevationBufferData.populatePaintArrays(e,l,f,p,u,y,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,n,l,u,f){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(n,l,u,f,this.worldview))}addElevatedRoadFeature(e,n,l,u,f){const p=new Array,y=sr.getElevationFeature(e,f);if(!y)return void this.addGeometry(n,this.bufferData);{const S=this.clipPolygonsToTile(n,1);S.length>0&&p.push({polygons:S,elevationFeature:y,elevationTileID:l})}const b={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},l),featureIndex:u};for(const S of p)if(S.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Bo(S.elevationTileID,this.layers,this.zoom,this.lut));const P=S.elevationFeature.isTunnel();let M=0;e.properties.hasOwnProperty(Yt)&&(M=+e.properties[Yt]);for(const N of S.polygons)this.elevatedStructures.addPortalCandidates(S.elevationFeature.id,N,P,S.elevationFeature,M)}S.elevationFeature.constantHeight==null&&(S.polygons=this.prepareElevatedPolygons(S.polygons,S.elevationFeature,S.elevationTileID));const A=new on(l,S.elevationTileID);this.addElevatedGeometry(S.polygons,A,S.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,u,b)}}addElevatedGeometry(e,n,l,u,f,p){const y={elevation:l,elevationSampler:n,bias:u,index:f,featureInfo:p},[b,S]=this.addGeometry(e,this.elevationBufferData,y);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:b,max:S}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,b),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,S))}addGeometry(e,n,l){let u=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,p=null;l&&(p=l.elevationSampler.constantElevation(l.elevation,l.bias),p!=null&&(u=p,f=p));const y=(b,S,A)=>{if(l!=null)if(S.push(b),p!=null)n.elevatedLayoutVertexArray.emplaceBack(p),A.push(p);else{const P=l.elevationSampler.pointElevation(b,l.elevation,l.bias);n.elevatedLayoutVertexArray.emplaceBack(P),A.push(P),u=Math.min(u,P),f=Math.max(f,P)}};for(const b of e){let S=0;for(const re of b)S+=re.length;const A=n.triangleSegments.prepareSegment(S,n.layoutVertexArray,n.indexArray),P=A.vertexLength,M=[],N=[],L=[],U=[],H=[],K=n.layoutVertexArray.length;for(const re of b){if(re.length===0)continue;re!==b[0]&&N.push(M.length/2);const le=n.lineSegments.prepareSegment(re.length,n.layoutVertexArray,n.lineIndexArray),Ee=le.vertexLength;l&&H.push(n.layoutVertexArray.length-K),y(re[0],L,U),n.layoutVertexArray.emplaceBack(re[0].x,re[0].y),n.lineIndexArray.emplaceBack(Ee+re.length-1,Ee),M.push(re[0].x),M.push(re[0].y);for(let we=1;we<re.length;we++)y(re[we],L,U),n.layoutVertexArray.emplaceBack(re[we].x,re[we].y),n.lineIndexArray.emplaceBack(Ee+we-1,Ee+we),M.push(re[we].x),M.push(re[we].y);le.vertexLength+=re.length,le.primitiveLength+=re.length}const se=dp(M,N);for(let re=0;re<se.length;re+=3)n.indexArray.emplaceBack(P+se[re],P+se[re+1],P+se[re+2]);if(se.length>0&&l&&this.elevationMode==="hd-road-base"){const re=l.elevation.isTunnel(),le=l.elevation.safeArea,Ee=this.elevatedStructures.addVertices(L,U);this.elevatedStructures.addTriangles(se,Ee,re);const we=H.length;if(we>0){for(let Se=0;Se<we-1;Se++)this.elevatedStructures.addRenderableRing(l.index,H[Se]+Ee,H[Se+1]-H[Se],re,le,l.featureInfo);this.elevatedStructures.addRenderableRing(l.index,H[we-1]+Ee,L.length-H[we-1],re,le,l.featureInfo)}}A.vertexLength+=S,A.primitiveLength+=se.length/3}return[u,f]}prepareElevatedPolygons(e,n,l){const u=1/xe(l),f=[];for(const p of e){const y=m4(p,new An(n,u));f.push(...y)}return f}clipPolygonsToTile(e,n){const l=-n,u=-n,f=Et+n,p=Et+n;let y=0;const b=[],S=[];for(;y<e.length;y++){const M=e[y],N=Um(M);(N.min.x>=l&&N.max.x<=f&&N.min.y>=u&&N.max.y<=p?b:S).push(M)}if(b.length===e.length)return e;const A=[new ht(l,u),new ht(f,u),new ht(f,p),new ht(l,p),new ht(l,u)],P=b;for(const M of S)P.push(...p4(M,A));return P}}let kA,NA,LA,zA;Bt(Nb,"FillBucket",{omit:["layers","patternFeatures"]}),Bt(kb,"FillBufferData"),Bt(Bo,"ElevatedStructures");class yv{constructor(e,n,l,u){if(this.triangleCount=n.length/3,this.min=new ht(0,0),this.max=new ht(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[f,p]=[e[0].clone(),e[0].clone()];for(let P=1;P<e.length;++P){const M=e[P];f.x=Math.min(f.x,M.x),f.y=Math.min(f.y,M.y),p.x=Math.max(p.x,M.x),p.y=Math.max(p.y,M.y)}if(u){const P=Math.ceil(Math.max(p.x-f.x,p.y-f.y)/u);l=Math.max(l,P)}if(l===0)return;this.min=f,this.max=p;const y=this.max.sub(this.min);y.x=Math.max(y.x,1),y.y=Math.max(y.y,1);const b=Math.max(y.x,y.y)/l;this.cellsX=Math.max(1,Math.ceil(y.x/b)),this.cellsY=Math.max(1,Math.ceil(y.y/b)),this.xScale=1/b,this.yScale=1/b;const S=[];for(let P=0;P<this.triangleCount;P++){const M=e[n[3*P+0]].sub(this.min),N=e[n[3*P+1]].sub(this.min),L=e[n[3*P+2]].sub(this.min),U=Yl(Math.floor(Math.min(M.x,N.x,L.x)),this.xScale,this.cellsX),H=Yl(Math.floor(Math.max(M.x,N.x,L.x)),this.xScale,this.cellsX),K=Yl(Math.floor(Math.min(M.y,N.y,L.y)),this.yScale,this.cellsY),se=Yl(Math.floor(Math.max(M.y,N.y,L.y)),this.yScale,this.cellsY),re=new ht(0,0),le=new ht(0,0),Ee=new ht(0,0),we=new ht(0,0);for(let Se=K;Se<=se;++Se){re.y=le.y=Se*b,Ee.y=we.y=(Se+1)*b;for(let Me=U;Me<=H;++Me)re.x=Ee.x=Me*b,le.x=we.x=(Me+1)*b,(Ur(M,N,L,re,le,we)||Ur(M,N,L,re,we,Ee))&&S.push({cellIdx:Se*this.cellsX+Me,triIdx:P})}}if(S.length===0)return;S.sort((P,M)=>P.cellIdx-M.cellIdx||P.triIdx-M.triIdx);let A=0;for(;A<S.length;){const P=S[A].cellIdx,M={start:this.payload.length,len:0};for(;A<S.length&&S[A].cellIdx===P;)++M.len,this.payload.push(S[A++].triIdx);this.cells[P]=M}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,n){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const l=Yl(e.x-this.min.x,this.xScale,this.cellsX),u=Yl(e.y-this.min.y,this.yScale,this.cellsY),f=this.cells[u*this.cellsX+l];if(f){this._lazyInitLookup();for(let p=0;p<f.len;p++){const y=this.payload[f.start+p],b=Math.floor(y/8),S=1<<y%8;if(!(this.lookup[b]&S)&&(this.lookup[b]|=S,n.push(y),n.length===this.triangleCount))return}}}query(e,n,l){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this._lazyInitLookup();const u=Yl(e.x-this.min.x,this.xScale,this.cellsX),f=Yl(n.x-this.min.x,this.xScale,this.cellsX),p=Yl(e.y-this.min.y,this.yScale,this.cellsY),y=Yl(n.y-this.min.y,this.yScale,this.cellsY);for(let b=p;b<=y;b++)for(let S=u;S<=f;S++){const A=this.cells[b*this.cellsX+S];if(A)for(let P=0;P<A.len;P++){const M=this.payload[A.start+P],N=Math.floor(M/8),L=1<<M%8;if(!(this.lookup[N]&L)&&(this.lookup[N]|=L,l.push(M),l.length===this.triangleCount))return}}}}function Yl(r,e,n){return Math.max(0,Math.min(n-1,Math.floor(r*e)))}Bt(yv,"TriangleGridIndex");class OA{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.footprints=[],this.worldview=e.worldview}updateFootprints(e,n){for(const l of this.footprints)n.push({footprint:l,id:e})}populate(e,n,l,u){const f=[];for(const{feature:p,id:y,index:b,sourceLayerIndex:S}of e){const A=this.layers[0]._featureFilter.needGeometry,P=qe(p,A);if(!this.layers[0]._featureFilter.filter(new Pn(this.zoom,{worldview:this.worldview}),P,l))continue;const M={id:y,properties:p.properties,type:p.type,sourceLayerIndex:S,index:b,geometry:A?P.geometry:Ae(p,l,u),patterns:{}};f.push(M)}for(const p of f){const{geometry:y,index:b,sourceLayerIndex:S}=p;this.addFeature(p,y,b,l,{},n.availableImages,n.brightness),n.featureIndex.insert(e[b].feature,y,b,S,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,n,l,u,f,p,y){}destroy(){}addFeature(e,n,l,u,f,p=[],y){for(const b of e_(n,2)){const S=[],A=[],P=[],M=new ht(1/0,1/0),N=new ht(-1/0,-1/0);for(const H of b)if(H.length!==0){H!==b[0]&&P.push(A.length/2);for(let K=0;K<H.length;K++)A.push(H[K].x),A.push(H[K].y),S.push(H[K]),M.x=Math.min(M.x,H[K].x),M.y=Math.min(M.y,H[K].y),N.x=Math.max(N.x,H[K].x),N.y=Math.max(N.y,H[K].y)}const L=dp(A,P),U=new yv(S,L,8,256);this.footprints.push({vertices:S,indices:L,grid:U,min:M,max:N})}}}Bt(OA,"ClipBucket",{omit:["layers"]});const g4=Qi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),_4=Qi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),y4=Qi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),x4=Qi([{name:"a_join_normal_inside",components:3,type:"Int16"}]),v4=Qi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),w4=Qi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:b4}=g4,t_=Number.MAX_SAFE_INTEGER,FA=t_-1;function jA(r,e,n,l){return r.order<e||r.order===t_||!(r.clipMask&n)||function(u,f){return f.length!==0&&f.find(p=>p===u)===void 0}(l,r.clipScope)}function xv(r,e){return r.x-e.x||r.y-e.y}function BA(r,e){return xv(r.min,e.min)===0&&xv(r.max,e.max)===0}function Lb(r,e){return!(r.min.x>e.max.x||r.max.x<e.min.x||r.min.y>e.max.y||r.max.y<e.min.y)}function vv(r,e){if(r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(r[n].sourceId!==e[n].sourceId||!BA(r[n],e[n])||r[n].order!==e[n].order||r[n].clipMask!==e[n].clipMask||!Ka(r[n].clipScope,e[n].clipScope))return!1;return!0}function VA(r,e,n){const l=1/Et,u=1/(1<<n.canonical.z),f=(e.x*l+n.canonical.x)*u+n.wrap,p=(e.y*l+n.canonical.y)*u;return{min:new ht((r.x*l+n.canonical.x)*u+n.wrap,(r.y*l+n.canonical.y)*u),max:new ht(f,p)}}function S4(r,e,n){const l=1<<n.canonical.z,u=((e.x-n.wrap)*l-n.canonical.x)*Et,f=(e.y*l-n.canonical.y)*Et;return{min:new ht(((r.x-n.wrap)*l-n.canonical.x)*Et,(r.y*l-n.canonical.y)*Et),max:new ht(u,f)}}function zb(r,e,n,l,u,f,p){const y=r.indices,b=r.vertices,S=[];for(let A=l;A<l+u;A+=3){const P=e[n[A+0]+f],M=e[n[A+1]+f],N=e[n[A+2]+f],L=Math.min(P.x,M.x,N.x),U=Math.max(P.x,M.x,N.x),H=Math.min(P.y,M.y,N.y),K=Math.max(P.y,M.y,N.y);S.length=0,r.grid.query(new ht(L,H),new ht(U,K),S);for(let se=0;se<S.length;se++){const re=S[se];if(Ur(b[y[3*re+0]],b[y[3*re+1]],b[y[3*re+2]],P,M,N,p))return!0}}return!1}function UA(r,e,n,l){if(!r||!n)return!1;let u=r.vertices;if(!e.canonical.equals(l.canonical)||e.wrap!==l.wrap){if(n.vertices.length<r.vertices.length)return UA(n,l,r,e);const f=e.canonical,p=l.canonical,y=Math.pow(2,p.z-f.z);u=r.vertices.map(b=>new ht((b.x+f.x*Et)*y-p.x*Et,(b.y+f.y*Et)*y-p.y*Et))}return zb(n,u,r.indices,0,r.indices.length,0,0)}function GA(r,e,n,l){const u=Math.pow(2,l.z-n.z);return new ht((r+n.x*Et)*u-l.x*Et,(e+n.y*Et)*u-l.y*Et)}function Ob(r,e){const n=[];e.grid.queryPoint(r,n);const l=e.indices,u=e.vertices;for(let f=0;f<n.length;f++){const p=n[f];if(Es([u[l[3*p+0]],u[l[3*p+1]],u[l[3*p+2]]],r))return!0}return!1}const Fb=[new ht(0,0),new ht(Et,0),new ht(Et,Et),new ht(0,Et)];function $A(r,e){const n=[];let l=[];if(!e||r.length<2)return[r];if(r.length===2)return fr(r[0],r[1],Fb)?[r]:[];for(let u=0;u<r.length+2;u++){const f=r[u%r.length],p=r[(u+1)%r.length],y=fr(u===0?r[r.length-1]:r[(u-1)%r.length],f,Fb),b=fr(f,p,Fb),S=y||b;S&&l.push(f),S&&b||l.length>0&&(l.length>1&&n.push(l),l=[])}return l.length>1&&n.push(l),n}const jb=je.types,T4=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],E4=["fill-extrusion-flood-light-ground-radius"],C4=Math.pow(2,13),A4=Math.pow(2,15)-1,HA=new ht(0,1),Uu=2147483648;function i_(r,e,n,l,u,f,p,y){r.emplaceBack((e<<1)+p,(n<<1)+f,(Math.floor(l*C4)<<1)+u,Math.round(y))}function n_(r,e,n){r.emplaceBack(e.x*Et,e.y*Et,n?1:0)}function wv(r,e,n,l,u,f){r.emplaceBack(e.x,e.y,(n.x<<1)+l,(n.y<<1)+u,f)}function r_(r,e,n){r.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class qA{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class WA{constructor(){this.centroidXY=new ht(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new ht(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new ht(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new ht(this.max.x-this.min.x,this.max.y-this.min.y)}}class ZA{constructor(){this.acc=new ht(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,l){this.accCount++,this.acc._add(n);let u=!!this.borders;n.x<e.min.x?(e.min.x=n.x,u=!0):n.x>e.max.x&&(e.max.x=n.x,u=!0),n.y<e.min.y?(e.min.y=n.y,u=!0):n.y>e.max.y&&(e.max.y=n.y,u=!0),((n.x===0||n.x===Et)&&n.x===l.x)!=((n.y===0||n.y===Et)&&n.y===l.y)&&this.processBorderOverlap(n,l),u&&this.checkBorderIntersection(n,l)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,si(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>Et!=e.x>Et&&this.addBorderIntersection(1,si(n.y,e.y,(Et-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,si(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>Et!=e.y>Et&&this.addBorderIntersection(3,si(n.x,e.x,(Et-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[e];n<l[0]&&(l[0]=n),n>l[1]&&(l[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const l=e.x===0?0:1;this.addBorderIntersection(l,n.y),this.addBorderIntersection(l,e.y)}else{const l=e.y===0?2:3;this.addBorderIntersection(l,n.x),this.addBorderIntersection(l,e.x)}}centroid(){return this.accCount===0?new ht(0,0):new ht(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function XA(r,e){const n=r.add(e)._unit(),l=ge(r.x*n.x+r.y*n.y,-1,1);var u,f,p;return u=Math.acos(l),Math.min(4,Math.max(-4,Math.tan(u)))/4*A4*((f=r).x*(p=e).y-f.y*p.x<0?-1:1)}const I4=[r=>r.x<0,r=>r.x>Et,r=>r.y<0,r=>r.y>Et];function P4(r,e,n,l){const u=[4];if(l===0)return u;n._mult(l);const f=r.sub(n),p=e.sub(n),y=[r,e,f,p];for(let b=0;b<4;b++)for(const S of y)if(I4[b](S)){u.push(b);break}return u}class Bb{constructor(e){this.vertexArray=new ep,this.indexArray=new Qn,this.programConfigurations=new Lo(e.layers,{zoom:e.zoom,lut:e.lut},n=>E4.includes(n)),this._segments=new rr,this.hiddenByLandmarkVertexArray=new op,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new rr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,l,u=!1){const f=e.length;if(f>2){let p=Math.max(0,this._segments.get().length-1);const y=this._segments._prepareSegment(4*f,this.vertexArray.length,2*this._segmentToGroundQuads[p].length);let b;p!==this._segments.get().length-1&&(p++,this._segmentToGroundQuads[p]=[],this._segmentToRegionTriCounts[p]=[0,0,0,0,0]);{const S=e[0],A=e[1];b=XA(S.sub(e[f-1])._perp()._unit(),A.sub(S)._perp()._unit())}for(let S=0;S<f;S++){const A=S===f-1?0:S+1,P=e[S],M=e[A],N=e[A===f-1?0:A+1],L=M.sub(P)._perp()._unit(),U=XA(L,N.sub(M)._perp()._unit()),H=b,K=U;if(Vb(P,M,n)||u&&JA(P,n)&&JA(M,n)){b=U;continue}const se=y.vertexLength;wv(this.vertexArray,P,M,1,1,H),wv(this.vertexArray,P,M,1,0,H),wv(this.vertexArray,P,M,0,1,K),wv(this.vertexArray,P,M,0,0,K),y.vertexLength+=4;const re=P4(P,M,L,l);for(const le of re)this._segmentToGroundQuads[p].push({id:se,region:le}),this._segmentToRegionTriCounts[p][le]+=2,y.primitiveLength+=2;b=U}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),n=e.length;for(let l=0;l<n;l++)this._segmentToGroundQuads[l].sort((u,f)=>u.region-f.region);for(let l=0;l<n;l++){const u=this._segmentToGroundQuads[l],f=e[l],p=this._segmentToRegionTriCounts[l];p.reduce((b,S)=>b+S,0);let y=0;for(let b=0;b<=4;b++){const S=p[b];if(S!==0){let A=this.regionSegments[b];A||(A=this.regionSegments[b]=new rr);const P={vertexOffset:f.vertexOffset,primitiveOffset:f.primitiveOffset+y,vertexLength:f.vertexLength,primitiveLength:S};A.get().push(P)}y+=S}for(let b=0;b<u.length;b++){const S=u[b].id;this.indexArray.emplaceBack(S,S+1,S+3),this.indexArray.emplaceBack(S,S+3,S+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,l,u,f,p,y){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,l,u,f,p,void 0,y)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,_4.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,l,u,f,p,y,b){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,l,u,f,p,y,b)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&Uu))}updateHiddenByLandmarkRange(e,n,l){if(!this.hasData())return;const u=n+e;if(n!==0){for(let f=e;f<u;++f)this.hiddenByLandmarkVertexArray.emplace(f,l?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,v4.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const n=this.regionSegments[e];n&&n.destroy()}}}}class bv{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Qn,this.footprintVertices=new co,this.footprintSegments=[],this.layoutVertexArray=new Pu,this.centroidVertexArray=new tv,this.wallVertexArray=new nv,this.indexArray=new Qn,this.programConfigurations=new Lo(e.layers,{zoom:e.zoom,lut:e.lut},n=>T4.includes(n)),this.segments=new rr,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new Bb(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview}updateFootprints(e,n){}populate(e,n,l,u){this.features=[],this.hasPattern=Mb("fill-extrusion",this.layers,this.pixelRatio,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=xe(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:f,id:p,index:y,sourceLayerIndex:b}of e){const S=this.layers[0]._featureFilter.needGeometry,A=qe(f,S);if(!this.layers[0]._featureFilter.filter(new Pn(this.zoom,{worldview:this.worldview}),A,l))continue;const P={id:p,sourceLayerIndex:b,index:y,geometry:S?A.geometry:Ae(f,l,u),properties:f.properties,type:f.type,patterns:{}},M=this.layoutVertexArray.length,N=jb[P.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:f.id,feature:Rb("fill-extrusion",this.layers,P,this.zoom,this.pixelRatio,n)});else if(this.wallMode)for(const L of P.geometry)for(const U of $A(L,N))this.addFeature(f.id,P,[U],y,l,{},n.availableImages,u,n.brightness);else this.addFeature(f.id,P,P.geometry,y,l,{},n.availableImages,u,n.brightness);n.featureIndex.insert(f,P.geometry,y,b,this.index,M)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,l,u,f,p){for(const{featureId:y,feature:b}of this.features){const S=jb[b.type]==="Polygon",{geometry:A}=b;if(this.wallMode)for(const P of A)for(const M of $A(P,S))this.addFeature(y,b,[M],b.index,n,l,u,f,p);else this.addFeature(y,b,A,b.index,n,l,u,f,p)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,l,u,f,p,y){this.programConfigurations.updatePaintArrays(e,n,f,l,u,p,y,this.worldview),this.groundEffect.update(e,n,f,l,u,p,y,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,b4),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,x4.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,w4.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,y4.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,l,u,f,p,y,b,S){const A=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(n,{})/this.tileToMeter,P=[new ht(0,0),new ht(Et,Et)],M=b.projection,N=M.name==="globe",L=this.wallMode||jb[n.type]==="Polygon",U=new ZA;U.centroidDataIndex=this.centroidData.length;const H=new WA;H.buildingId=e,n.properties&&n.properties.hasOwnProperty("building_id")&&(H.buildingId=n.properties.building_id);const K=this.layers[0].paint.get("fill-extrusion-base").evaluate(n,{},f)<=0,se=this.layers[0].paint.get("fill-extrusion-height").evaluate(n,{},f);let re;if(H.height=se,H.vertexArrayOffset=this.layoutVertexArray.length,H.groundVertexArrayOffset=this.groundEffect.vertexArray.length,N&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ip),this.wallMode){if(N)return void Ki("Non zero fill-extrusion-line-width is not yet supported on globe.");if(l.length!==1)return;re=function(Le){const Je=Le[0].x===Le[Le.length-1].x&&Le[0].y===Le[Le.length-1].y;(function(pt){let $t=0;const zt=pt.length;for(let At=0;At<zt;At++)$t+=(pt[(At+1)%zt].x-pt[At].x)*(pt[(At+1)%zt].y+pt[At].y);return $t>=0})(Le)||(Le=Le.reverse());const tt={geometry:[],joinNormals:[],indices:[]},ut=[],gt=[],We=[];let dt=Le.length;for(;dt>=2&&Le[dt-1].equals(Le[dt-2]);)dt--;if(dt<(Je?3:2))return tt;let ze,Ze,wt,ft,Zt,Ut=0;for(;Ut<dt-1&&Le[Ut].equals(Le[Ut+1]);)Ut++;Je&&(ze=Le[dt-2],Zt=Le[Ut].sub(ze)._unit()._perp());for(let pt=Ut;pt<dt;pt++){if(wt=pt===dt-1?Je?Le[Ut+1]:void 0:Le[pt+1],wt&&Le[pt].equals(wt))continue;Zt&&(ft=Zt),ze&&(Ze=ze),ze=Le[pt],Zt=wt?wt.sub(ze)._unit()._perp():ft,ft=ft||Zt;let $t=ft.add(Zt);$t.x===0&&$t.y===0||$t._unit();const zt=$t.x*Zt.x+$t.y*Zt.y,At=zt!==0?1/zt:1/0,Ot=ft.x*Zt.y-ft.y*Zt.x>0;let li="miter";const vi=2;li==="miter"&&At>vi&&(li="bevel"),li==="bevel"&&(At>100&&(li="flipbevel"),At<vi&&(li="miter"));const Di=(Ii,Yi,Bi,qn)=>{const he=new ht(Ii.x,Ii.y),fe=new ht(Ii.x,Ii.y);he.x+=Yi.x*qn,he.y+=Yi.y*qn,fe.x-=Yi.x*Math.max(Bi,1),fe.y-=Yi.y*Math.max(Bi,1),We.push(Yi),ut.push(he),gt.push(fe)};if(li==="miter")$t._mult(At),Di(ze,$t,0,0);else if(li==="flipbevel")$t=Zt.mult(-1),Di(ze,$t,0,0),Di(ze,$t.mult(-1),0,0);else{const Ii=-Math.sqrt(At*At-1),Yi=Ot?Ii:0,Bi=Ot?0:Ii;Ze&&Di(ze,ft,Yi,Bi),wt&&Di(ze,Zt,Yi,Bi)}}tt.geometry=[...ut,...gt.reverse(),ut[0]],tt.joinNormals=[...We,...We.reverse(),We[We.length-1]];const lt=tt.geometry.length-1;for(let pt=0;pt<lt/2;pt++)if(pt+1<lt/2){let $t=pt,zt=pt+1,At=lt-1-pt,Ot=lt-2-pt;$t=$t===0?lt-1:$t-1,zt=zt===0?lt-1:zt-1,At=At===0?lt-1:At-1,Ot=Ot===0?lt-1:Ot-1,tt.indices.push(At),tt.indices.push(zt),tt.indices.push($t),tt.indices.push(At),tt.indices.push(Ot),tt.indices.push(zt)}return tt}(l[0]),l=[re.geometry]}const le=(Le,Je)=>Le<(Je.length-1)/2||Le===Je.length-1,Ee=this.wallMode?[l]:e_(l,500);for(let Le=Ee.length-1;Le>=0;Le--){const Je=Ee[Le];(Je.length===0||(we=Je[0]).every(yt=>yt.x<=0)||we.every(yt=>yt.x>=Et)||we.every(yt=>yt.y<=0)||we.every(yt=>yt.y>=Et))&&Ee.splice(Le,1)}var we;let Se;if(N)Se=iI(Ee,P,f);else{Se=[];for(const Le of Ee)Se.push({polygon:Le,bounds:P})}const Me=L?this.edgeRadius:0,De=Me>0&&this.zoom<17,Xe=(Le,Je)=>{if(Le.length===0)return!1;const yt=Le[Le.length-1];return Je.x===yt.x&&Je.y===yt.y};for(const{polygon:Le,bounds:Je}of Se){let yt=0,tt=0;for(const dt of Le)L&&!dt[0].equals(dt[dt.length-1])&&dt.push(dt[0]),tt+=L?dt.length-1:dt.length;const ut=this.segments.prepareSegment((L?5:4)*tt,this.layoutVertexArray,this.indexArray);H.footprintSegIdx<0&&(H.footprintSegIdx=this.footprintSegments.length),H.polygonSegIdx<0&&(H.polygonSegIdx=this.polygonSegments.length);const gt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},We=new qA;if(We.vertexOffset=this.footprintVertices.length,We.indexOffset=3*this.footprintIndices.length,We.ringIndices=[],L){const dt=[],ze=[];yt=ut.vertexLength;for(let wt=0;wt<Le.length;wt++){const ft=Le[wt];ft.length&&wt!==0&&ze.push(dt.length/2);const Zt=[];let Ut,lt;Ut=ft[1].sub(ft[0])._perp()._unit(),We.ringIndices.push(ft.length-1);for(let pt=1;pt<ft.length;pt++){const $t=ft[pt],zt=ft[pt===ft.length-1?1:pt+1],At=$t.clone();if(Me){lt=zt.sub($t)._perp()._unit();const Ot=Ut.add(lt)._unit(),li=Me*Math.min(4,1/(Ut.x*Ot.x+Ut.y*Ot.y));At.x+=li*Ot.x,At.y+=li*Ot.y,At.x=Math.round(At.x),At.y=Math.round(At.y),Ut=lt}if(!K||Me!==0&&!De||Xe(Zt,At)||Zt.push(At),i_(this.layoutVertexArray,At.x,At.y,0,0,1,1,0),this.wallMode){const Ot=le(pt,ft);n_(this.wallVertexArray,re.joinNormals[pt],!Ot)}ut.vertexLength++,this.footprintVertices.emplaceBack($t.x,$t.y),dt.push($t.x,$t.y),N&&r_(this.layoutVertexExtArray,M.projectTilePoint(At.x,At.y,f),M.upVector(f,At.x,At.y))}K&&(Me===0||De)&&(Zt.length!==0&&Xe(Zt,Zt[0])&&Zt.pop(),this.groundEffect.addData(Zt,Je,A))}const Ze=this.wallMode?re.indices:dp(dt,ze);for(let wt=0;wt<Ze.length;wt+=3)this.footprintIndices.emplaceBack(We.vertexOffset+Ze[wt+0],We.vertexOffset+Ze[wt+1],We.vertexOffset+Ze[wt+2]),this.indexArray.emplaceBack(yt+Ze[wt],yt+Ze[wt+2],yt+Ze[wt+1]),ut.primitiveLength++;We.indexCount+=Ze.length,We.vertexCount+=this.footprintVertices.length-We.vertexOffset}for(let dt=0;dt<Le.length;dt++){const ze=Le[dt];U.startRing(H,ze[0]);let Ze=ze.length>4&&QA(ze[ze.length-2],ze[0],ze[1]),wt=Me?M4(ze[ze.length-2],ze[0],ze[1],Me):0;const ft=[];let Zt,Ut,lt;Ut=ze[1].sub(ze[0])._perp()._unit();let pt=!0;for(let $t=1,zt=0;$t<ze.length;$t++){let At=ze[$t-1],Ot=ze[$t];const li=ze[$t===ze.length-1?1:$t+1];if(U.appendEdge(H,Ot,At),Vb(Ot,At,Je)){Me&&(Ut=li.sub(Ot)._perp()._unit(),pt=!pt);continue}const vi=Ot.sub(At)._perp(),Di=vi.x/(Math.abs(vi.x)+Math.abs(vi.y)),Ii=vi.y>0?1:0,Yi=At.dist(Ot);if(zt+Yi>32768&&(zt=0),Me){lt=li.sub(Ot)._perp()._unit();let fe=YA(At,Ot,li,KA(Ut,lt),Me);isNaN(fe)&&(fe=0);const He=Ot.sub(At)._unit();At=At.add(He.mult(wt))._round(),Ot=Ot.add(He.mult(-fe))._round(),wt=fe,Ut=lt,K&&this.zoom>=17&&(Xe(ft,At)||ft.push(At),Xe(ft,Ot)||ft.push(Ot))}const Bi=ut.vertexLength,qn=ze.length>4&&QA(At,Ot,li);let he=eI(zt,Ze,pt);if(i_(this.layoutVertexArray,At.x,At.y,Di,Ii,0,0,he),i_(this.layoutVertexArray,At.x,At.y,Di,Ii,0,1,he),this.wallMode){const fe=le($t-1,ze),He=re.joinNormals[$t-1];n_(this.wallVertexArray,He,fe),n_(this.wallVertexArray,He,fe)}if(zt+=Yi,he=eI(zt,qn,!pt),Ze=qn,i_(this.layoutVertexArray,Ot.x,Ot.y,Di,Ii,0,0,he),i_(this.layoutVertexArray,Ot.x,Ot.y,Di,Ii,0,1,he),this.wallMode){const fe=le($t,ze),He=re.joinNormals[$t];n_(this.wallVertexArray,He,fe),n_(this.wallVertexArray,He,fe)}if(ut.vertexLength+=4,this.indexArray.emplaceBack(Bi+0,Bi+1,Bi+2),this.indexArray.emplaceBack(Bi+1,Bi+3,Bi+2),ut.primitiveLength+=2,Me){const fe=yt+($t===1?ze.length-2:$t-2),He=$t===1?yt:fe+1;if(this.indexArray.emplaceBack(Bi+1,fe,Bi+3),this.indexArray.emplaceBack(fe,He,Bi+3),ut.primitiveLength+=2,Zt===void 0&&(Zt=Bi),!Vb(li,ze[$t],Je)){const bt=$t===ze.length-1?Zt:ut.vertexLength;this.indexArray.emplaceBack(Bi+2,Bi+3,bt),this.indexArray.emplaceBack(Bi+3,bt+1,bt),this.indexArray.emplaceBack(Bi+3,He,bt+1),ut.primitiveLength+=3}pt=!pt}if(N){const fe=this.layoutVertexExtArray,He=M.projectTilePoint(At.x,At.y,f),bt=M.projectTilePoint(Ot.x,Ot.y,f),Mt=M.upVector(f,At.x,At.y),It=M.upVector(f,Ot.x,Ot.y);r_(fe,He,Mt),r_(fe,He,Mt),r_(fe,bt,It),r_(fe,bt,It)}}L&&(yt+=ze.length-1),K&&Me&&this.zoom>=17&&(ft.length!==0&&Xe(ft,ft[0])&&ft.pop(),this.groundEffect.addData(ft,Je,A,Me>0))}this.footprintSegments.push(We),gt.triangleCount=this.indexArray.length-gt.triangleArrayOffset,this.polygonSegments.push(gt),++H.footprintSegLen,++H.polygonSegLen}if(H.vertexCount=this.layoutVertexArray.length-H.vertexArrayOffset,H.groundVertexCount=this.groundEffect.vertexArray.length-H.groundVertexArrayOffset,H.vertexCount!==0){if(H.centroidXY=U.borders?HA:this.encodeCentroid(U,H),this.centroidData.push(H),U.borders){this.featuresOnBorder.push(U);const Le=this.featuresOnBorder.length-1;for(let Je=0;Je<U.borders.length;Je++)U.borders[Je][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Je].push(Le)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,p,y,f,S,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(n,u,p,y,f,S,this.worldview),this.maxHeight=Math.max(this.maxHeight,se)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,l)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[l].borders[e][0])}splitToSubtiles(){const e=[];for(let y=0;y<this.centroidData.length;y++){const b=this.centroidData[y],S=+(b.min.y+b.max.y>Et),A=2*S+(+(b.min.x+b.max.x>Et)^S);for(let P=0;P<b.polygonSegLen;P++){const M=b.polygonSegIdx+P;e.push({centroidIdx:y,subtile:A,polygonSegmentIdx:M,triangleSegmentIdx:this.polygonSegments[M].triangleSegIdx})}}const n=new Qn;e.sort((y,b)=>y.triangleSegmentIdx===b.triangleSegmentIdx?y.subtile-b.subtile:y.triangleSegmentIdx-b.triangleSegmentIdx);let l=0,u=0,f=0;for(const y of e){if(y.triangleSegmentIdx!==l)break;f++}const p=e.length;for(;u!==e.length;){l=e[u].triangleSegmentIdx;let y=0,b=u,S=u;for(let A=b;A<f&&e[A].subtile===y;A++)S++;for(;b!==f;){const A=e[b];y=A.subtile;const P=this.centroidData[A.centroidIdx].min.clone(),M=this.centroidData[A.centroidIdx].max.clone(),N={vertexOffset:this.segments.segments[l].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[l].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let L=b;L<S;L++){const U=e[L],H=this.polygonSegments[U.polygonSegmentIdx],K=this.centroidData[U.centroidIdx].min,se=this.centroidData[U.centroidIdx].max,re=this.indexArray.uint16;for(let le=H.triangleArrayOffset;le<H.triangleArrayOffset+H.triangleCount;le++)n.emplaceBack(re[3*le],re[3*le+1],re[3*le+2]);N.primitiveLength+=H.triangleCount,P.x=Math.min(P.x,K.x),P.y=Math.min(P.y,K.y),M.x=Math.max(M.x,se.x),M.y=Math.max(M.y,se.y)}N.primitiveLength>0&&this.triangleSubSegments.push({segment:N,min:P,max:M}),b=S;for(let L=b;L<f&&e[L].subtile===e[b].subtile;L++)S++}u=f;for(let A=u;A<p&&e[A].triangleSegmentIdx===e[u].triangleSegmentIdx;A++)f++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,l){const u=new rr;if(this.wallMode){for(const U of this.triangleSubSegments)u.segments.push(U.segment);return u}let f=0,p=0;const y=1<<e.canonical.z;if(n){const U=n.getMinMaxForTile(e);U&&(f=U.min,p=U.max)}p+=this.maxHeight;const b=e.toUnwrapped();let S;const A=[b.canonical.x/y+b.wrap,b.canonical.y/y],P=[(b.canonical.x+1)/y+b.wrap,(b.canonical.y+1)/y],M=(U,H,K)=>[U[0]*(1-K[0])+H[0]*K[0],U[1]*(1-K[1])+H[1]*K[1]],N=[],L=[];for(const U of this.triangleSubSegments){N[0]=U.min.x/Et,N[1]=U.min.y/Et,L[0]=U.max.x/Et,L[1]=U.max.y/Et;const H=M(A,P,N),K=M(A,P,L);if(new Gi([H[0],H[1],f],[K[0],K[1],p]).intersectsPrecise(l)===0){S&&(u.segments.push(S),S=void 0);continue}const se=U.segment;S&&S.vertexOffset!==se.vertexOffset&&(u.segments.push(S),S=void 0),S?(S.vertexLength+=se.vertexLength,S.primitiveLength+=se.primitiveLength):S={vertexOffset:se.vertexOffset,primitiveLength:se.primitiveLength,vertexLength:se.vertexLength,primitiveOffset:se.primitiveOffset,sortKey:void 0,vaos:{}}}return S&&u.segments.push(S),u}encodeCentroid(e,n){const l=e.centroid(),u=n.span(),f=Math.min(7,Math.round(u.x*this.tileToMeter/10)),p=Math.min(7,Math.round(u.y*this.tileToMeter/10));return new ht(ge(l.x,1,Et-1)<<3|f,ge(l.y,1,Et-1)<<3|p)}encodeBorderCentroid(e){if(!e.borders)return new ht(0,0);const n=e.borders,l=Number.MAX_VALUE;if(n[0][0]!==l||n[1][0]!==l){const u=n[0][0]!==l?0:1;return new ht(6|(n[0][0]!==l?0:65528),(n[u][0]+n[u][1])/2<<3|6)}{const u=n[2][0]!==l?2:3;return new ht((n[u][0]+n[u][1])/2<<3|6,6|(n[2][0]!==l?0:65528))}}showCentroid(e){const n=this.centroidData[e.centroidDataIndex];n.flags&=2147483647,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const n=e.vertexArrayOffset,l=e.vertexCount+e.vertexArrayOffset,u=e.flags&Uu?HA:e.centroidXY,f=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==u.y||f!==u.x){for(let p=n;p<l;++p)this.centroidVertexArray.emplace(p,u.x,u.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n,l){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const u=n.getReplacementRegionsForTile(e.toUnwrapped());if(vv(this.activeReplacements,u))return;if(this.activeReplacements=u,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const p of this.centroidData)p.flags&=2147483647;const f=[];for(const p of this.activeReplacements){if(p.order<l)continue;const y=Math.max(1,Math.pow(2,p.footprintTileId.canonical.z-e.canonical.z));if(p.footprint.buildingId){const b=p.footprint.buildingId;for(const S of this.centroidData)S.buildingId===b&&(S.flags|=Uu)}else for(const b of this.centroidData)if(!(b.flags&Uu||p.min.x>b.max.x||b.min.x>p.max.x||p.min.y>b.max.y||b.min.y>p.max.y))for(let S=0;S<b.footprintSegLen;S++){const A=this.footprintSegments[b.footprintSegIdx+S];if(f.length=0,R4(this.footprintVertices,A.vertexOffset,A.vertexCount,p.footprintTileId.canonical,e.canonical,f),zb(p.footprint,f,this.footprintIndices.uint16,A.indexOffset,A.indexCount,-A.vertexOffset,-y)){b.flags|=Uu;break}}}for(const p of this.centroidData)this.writeCentroidToBuffer(p);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,l){let u=!1;for(let f=0;f<l.footprintSegLen;f++){const p=this.footprintSegments[l.footprintSegIdx+f];let y=0;for(const b of p.ringIndices){for(let S=y,A=b+y-1;S<b+y;A=S++){const P=this.footprintVertices.int16[2*(S+p.vertexOffset)+0],M=this.footprintVertices.int16[2*(S+p.vertexOffset)+1],N=this.footprintVertices.int16[2*(A+p.vertexOffset)+1];M>n!=N>n&&e<(this.footprintVertices.int16[2*(A+p.vertexOffset)+0]-P)*(n-M)/(N-M)+P&&(u=!u)}y=b}}return u}getHeightAtTileCoord(e,n){let l=Number.NEGATIVE_INFINITY,u=!0;const f=4*(e+Et)*Et+(n+Et);if(this.partLookup.hasOwnProperty(f)){const p=this.partLookup[f];return p?{height:p.height,hidden:!!(p.flags&Uu)}:void 0}for(const p of this.centroidData)e>p.max.x||p.min.x>e||n>p.max.y||p.min.y>n||p.height<=l||this.footprintContainsPoint(e,n,p)&&(l=p.height,this.partLookup[f]=p,u=!!(p.flags&Uu));if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:u};this.partLookup[f]=void 0}}function KA(r,e){const n=r.add(e)._unit();return r.x*n.x+r.y*n.y}function M4(r,e,n,l){const u=e.sub(r)._perp()._unit(),f=n.sub(e)._perp()._unit();return YA(r,e,n,KA(u,f),l)}function YA(r,e,n,l,u){const f=Math.sqrt(1-l*l);return Math.min(r.dist(e)/3,e.dist(n)/3,u*f/l)}function Vb(r,e,n){return r.x<n[0].x&&e.x<n[0].x||r.x>n[1].x&&e.x>n[1].x||r.y<n[0].y&&e.y<n[0].y||r.y>n[1].y&&e.y>n[1].y}function JA(r,e){return r.x<e[0].x||r.x>e[1].x||r.y<e[0].y||r.y>e[1].y}function QA(r,e,n){if(r.x<0||r.x>=Et||e.x<0||e.x>=Et||n.x<0||n.x>=Et)return!1;const l=n.sub(e),u=l.perp(),f=r.sub(e);return(l.x*f.x+l.y*f.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(f.x*f.x+f.y*f.y))>-.866&&u.x*f.x+u.y*f.y<0}function eI(r,e,n){const l=e?2|r:-3&r;return n?1|l:-2&l}function tI(){const r=Math.PI/32,e=Math.tan(r),n=C;return n*Math.sqrt(1+2*e*e)-n}function iI(r,e,n){const l=1<<n.z,u=ne(n.x/l),f=ne((n.x+1)/l),p=ae(n.y/l),y=ae((n.y+1)/l);return function(b,S,A,P,M=0,N){const L=[];if(!b.length||!A||!P)return L;const U=(we,Se)=>{for(const Me of we)L.push({polygon:Me,bounds:Se})},H=Math.ceil(Math.log2(A)),K=Math.ceil(Math.log2(P)),se=H-K,re=[];for(let we=0;we<Math.abs(se);we++)re.push(se>0?0:1);for(let we=0;we<Math.min(H,K);we++)re.push(0),re.push(1);let le=b;if(le=_v(le,S[0].y-M,S[1].y+M,1),le=_v(le,S[0].x-M,S[1].x+M,0),!le.length)return L;const Ee=[];for(re.length?Ee.push({polygons:le,bounds:S,depth:0}):U(le,S);Ee.length;){const we=Ee.pop(),Se=we.depth,Me=re[Se],De=we.bounds[0],Xe=we.bounds[1],Le=Me===0?De.x:De.y,Je=Me===0?Xe.x:Xe.y,yt=N?N(Me,Le,Je):.5*(Le+Je),tt=_v(we.polygons,Le-M,yt+M,Me),ut=_v(we.polygons,yt-M,Je+M,Me);if(tt.length){const gt=[De,new ht(Me===0?yt:Xe.x,Me===1?yt:Xe.y)];re.length>Se+1?Ee.push({polygons:tt,bounds:gt,depth:Se+1}):U(tt,gt)}if(ut.length){const gt=[new ht(Me===0?yt:De.x,Me===1?yt:De.y),Xe];re.length>Se+1?Ee.push({polygons:ut,bounds:gt,depth:Se+1}):U(ut,gt)}}return L}(r,e,Math.ceil((f-u)/11.25),Math.ceil((p-y)/11.25),1,(b,S,A)=>{if(b===0)return .5*(S+A);{const P=ae((n.y+S/Et)/l);return(X(.5*(ae((n.y+A/Et)/l)+P))*l-n.y)*Et}})}function R4(r,e,n,l,u,f){const p=Math.pow(2,l.z-u.z);for(let y=0;y<n;y++){let b=r.int16[2*(y+e)+0],S=r.int16[2*(y+e)+1];b=(b+u.x*Et)*p-l.x*Et,S=(S+u.y*Et)*p-l.y*Et,f.push(new ht(b,S))}}let nI,rI;Bt(bv,"FillExtrusionBucket",{omit:["layers","features"]}),Bt(WA,"PartData"),Bt(qA,"FootprintSegment"),Bt(ZA,"BorderCentroidData"),Bt(Bb,"GroundEffect");class Mh extends ht{constructor(e,n,l){super(e,n),this.z=l}}class sI extends Mh{constructor(e,n,l,u){super(e,n,l),this.w=u}}function oI(r,e,n,l){const u=n==="x"?"y":"x",f=(l-r[n])/(e[n]-r[n]);r[u]=Math.round(r[u]+(e[u]-r[u])*f),r[n]=l,r.hasOwnProperty("z")&&(r.z=si(r.z,e.z,f)),r.hasOwnProperty("w")&&(r.w=si(r.w,e.w,f))}function aI(r,e,n,l){const u=n,f=l;for(const p of["x","y"]){let y=r,b=e;y[p]>=b[p]&&(y=e,b=r),y[p]<u&&b[p]>u&&oI(y,b,p,u),y[p]<f&&b[p]>f&&oI(b,y,p,f)}}function Sv(r,e,n,l,u,f){const p=[];for(let y=0;y<r.length;y++){const b=r[y];let S;const A=p.length;let P=0;for(let M=0;M<b.length-1;M++){let N=b[M],L=b[M+1],U=0;const H=P;let K,se;f&&(U=Math.hypot(L.x-N.x,L.y-N.y),P+=U,K=N,se=L),N.x<e&&L.x<e||(N.x<e?N=new ht(e,N.y+(e-N.x)/(L.x-N.x)*(L.y-N.y))._round():L.x<e&&(L=new ht(e,N.y+(e-N.x)/(L.x-N.x)*(L.y-N.y))._round()),N.y<n&&L.y<n||(N.y<n?N=new ht(N.x+(n-N.y)/(L.y-N.y)*(L.x-N.x),n)._round():L.y<n&&(L=new ht(N.x+(n-N.y)/(L.y-N.y)*(L.x-N.x),n)._round()),N.x>=l&&L.x>=l||(N.x>=l?N=new ht(l,N.y+(l-N.x)/(L.x-N.x)*(L.y-N.y))._round():L.x>=l&&(L=new ht(l,N.y+(l-N.x)/(L.x-N.x)*(L.y-N.y))._round()),N.y>=u&&L.y>=u||(N.y>=u?N=new ht(N.x+(u-N.y)/(L.y-N.y)*(L.x-N.x),u)._round():L.y>=u&&(L=new ht(N.x+(u-N.y)/(L.y-N.y)*(L.x-N.x),u)._round()),S&&N.equals(S[S.length-1])||(S=[N],p.push(S),f&&f.push({progress:{min:H+lI(K,se,N)*U,max:1},parentIndex:y,prevPoint:K,nextPoint:se})),S.push(L),f&&(f[f.length-1].progress.max=H+lI(K,se,L)*U,f[f.length-1].nextPoint=se)))))}if(f&&P>0)for(let M=A;M<p.length;M++)f[M].progress.min/=P,f[M].progress.max/=P}return p}function D4(r,e,n,l,u){if(r.length<2)return void l.push(r);const f=[];for(;e.valid();){const[S,A]=e.get();for(let P=0;P<r.length-1;P++){const M=r[P],N=r[P+1],L=vo(M,N,S,A);if(L){const[U]=L,H=new ht(si(M.x,N.x,U),si(M.y,N.y,U));f.push({t:P+U,distance:0,point:H})}}e.next()}if(f.length===0)return void l.push(r);f.sort((S,A)=>S.t-A.t);let p=0,y=0,b=[];for(l.push(b);p!==r.length;){if(y===f.length){for(;p!==r.length;)b.length!==0&&b[b.length-1].equals(r[p])||b.push(r[p]),p++;break}f[y].t<=p?(b.length!==0&&b[b.length-1].equals(f[y].point)||b.push(f[y].point),Math.trunc(f[y].t),y++):(b.length!==0&&b[b.length-1].equals(r[p])||b.push(r[p]),p++)}}function lI(r,e,n){return r.x!==e.x?(n.x-r.x)/(e.x-r.x):r.y!==e.y?(n.y-r.y)/(e.y-r.y):0}function s_(r,e){return r.x*e.x+r.y*e.y}function cI(r,e){if(r.length===1){let n=0;const l=e[n++];let u;for(;!u||l.equals(u);)if(u=e[n++],!u)return 1/0;for(;n<e.length;n++){const f=e[n],p=r[0],y=u.sub(l),b=f.sub(l),S=p.sub(l),A=s_(y,y),P=s_(y,b),M=s_(b,b),N=s_(S,y),L=s_(S,b),U=A*M-P*P,H=(M*N-P*L)/U,K=(A*L-P*N)/U,se=l.z*(1-H-K)+u.z*H+f.z*K;if(isFinite(se))return se}return 1/0}{let n=1/0;for(const l of e)n=Math.min(n,l.z);return n}}function uI(r,e,n,l,u,f,p,y){const b=p*u.getElevationAt(r,e,!0,!0),S=f[0]!==0,A=S?f[1]===0?p*(f[0]/7-450):p*function(P,M,N){const L=Math.floor(M[0]/8),U=Math.floor(M[1]/8),H=10*(M[0]-8*L),K=10*(M[1]-8*U),se=P.getElevationAt(L,U,!0,!0),re=P.getMeterToDEM(N),le=Math.floor(.5*(H*re-1)),Ee=Math.floor(.5*(K*re-1)),we=P.tileCoordToPixel(L,U),Se=2*le+1,Me=2*Ee+1,De=function(ut,gt,We,dt,ze){return[ut.getElevationAtPixel(gt,We,!0),ut.getElevationAtPixel(gt+ze,We,!0),ut.getElevationAtPixel(gt,We+ze,!0),ut.getElevationAtPixel(gt+dt,We+ze,!0)]}(P,we.x-le,we.y-Ee,Se,Me),Xe=Math.abs(De[0]-De[1]),Le=Math.abs(De[2]-De[3]),Je=Math.abs(De[0]-De[2])+Math.abs(De[1]-De[3]),yt=Math.min(.25,.5*re*(Xe+Le)/Se),tt=Math.min(.25,.5*re*Je/Me);return se+Math.max(yt*H,tt*K)}(u,f,y):b;return{base:b+(n===0?-1:n),top:S?Math.max(A+l,b+n+2):b+l}}class k4{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class N4{constructor(){this.tasks={},this.taskQueue=[],_i(["process"],this),this.invoker=new k4(this.process),this.nextId=0}add(e,n){const l=this.nextId++,u=function({type:f,isSymbolTile:p,zoom:y}){return y=y||0,f==="message"?0:f!=="maybePrepare"||p?f!=="parseTile"||p?f==="parseTile"&&p?300-y:f==="maybePrepare"&&p?400-y:500:200-y:100-y}(n);if(u===0){try{e()}finally{}return null}return this.tasks[l]={fn:e,metadata:n,priority:u,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let u=0;u<this.taskQueue.length;u++){const f=this.tasks[this.taskQueue[u]];f.priority<n&&(n=f.priority,e=u)}if(e===null)return null;const l=this.taskQueue[e];return this.taskQueue.splice(e,1),l}remove(){this.invoker.remove()}}class dI{constructor(e,n,l){this.target=e,this.parent=n,this.mapId=l,this.callbacks={},this.cancelCallbacks={},_i(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new N4}send(e,n,l,u,f=!1,p){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=p,this.callbacks[y]=l);const b=new Set;return this.target.postMessage({id:y,type:e,hasCallback:!!l,targetMapId:u,mustQueue:f,sourceMapId:this.mapId,data:il(n,b)},b),{cancel:()=>{l&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(e){const n=e.data;if(!n)return;const l=n.id;if(l&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){const u=this.cancelCallbacks[l];delete this.cancelCallbacks[l],u&&u.cancel()}else if(n.mustQueue||Nn(self)){const u=this.callbacks[l],f=this.scheduler.add(()=>this.processTask(l,n),u&&u.metadata||{type:"message"});f&&(this.cancelCallbacks[l]=f)}else this.processTask(l,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){const l=this.callbacks[e];delete this.callbacks[e],l&&(n.error?l(lo(n.error)):l(null,lo(n.data)))}else{const l=new Set,u=n.hasCallback?(p,y)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?il(p):null,data:il(y,l)},l)}:()=>{},f=lo(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,f,u);else if(this.parent.getWorkerSource){const p=n.type.split("."),{source:y,scope:b}=f;this.parent.getWorkerSource(n.sourceMapId,p[0],y,b)[p[1]](f,u)}else u(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var o_={workerUrl:"",workerClass:null,workerParams:void 0};const Ub="mapboxgl_preloaded_worker_pool";class Rh{constructor(){this.active={}}acquire(e,n=Rh.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<n;)this.workers.push(o_.workerClass!=null?new o_.workerClass:new self.Worker(o_.workerUrl,o_.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ub]}numActive(){return Object.keys(this.active).length}}Rh.workerCount=2;class fp{constructor(e,n,l="Worker",u=Rh.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=it();const f=this.workerPool.acquire(this.id,u);for(let p=0;p<f.length;p++){const y=new fp.Actor(f[p],n,this.id);y.name=`${l} ${p}`,this.actors.push(y)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,n,l){ke(this.actors,(u,f)=>{u.send(e,n,f)},l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let a_,Gb;function Tv(){return a_||(a_=new Rh),a_}fp.Actor=dI;class L4{constructor(e){this.module=e}createIntArray(e){const n=new Int32Array(e),l=this.module.malloc(n.length*n.BYTES_PER_ELEMENT);return this.module.heap32.set(n,l/n.BYTES_PER_ELEMENT),l}createFloatArray(e){const n=new Float32Array(e),l=this.module.malloc(n.length*n.BYTES_PER_ELEMENT);return this.module.heapF32.set(n,l/n.BYTES_PER_ELEMENT),l}createStringBuffer(e){const n=this.module.malloc(e.length+1);for(let l=0;l<e.length;++l)this.module.heapU8[n+l]=e.charCodeAt(l);return this.module.heapU8[n+e.length]=0,n}readStringBuffer(e){let n="";for(;this.module.heapU8[e]!==0;)n+=String.fromCharCode(this.module.heapU8[e]),++e;return n}setStyle(e){const n=e.entranceColorRgb,l=e.facadeGlazingColorRgb,u=e.roofColorRgb,f=e.wallColorRgb,p=e.normalScale;this.module.setStyle(n[0],n[1],n[2],l[0],l[1],l[2],u[0],u[1],u[2],f[0],f[1],f[2],p[0],p[1],p[2],e.tileToMeters)}setAOOptions(e,n){this.module.setAOOptions(e?1:0,n)}setMetricOptions(e,n){this.module.setMetricOptions(e?1:0,n)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,n){this.module.setFacadeOptions(e,n?1:0)}setFauxFacadeOptions(e,n,l){this.module.setFauxFacadeOptions(e?1:0,n?1:0,l)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,n){for(const y of e){const b=this.createStringBuffer(y.roofType),S=[0],A=[];for(const N of y.coordinates)if(Array.isArray(N)){for(const L of N)A.push(L.x),A.push(L.y);S.push(A.length)}const P=this.createIntArray(S),M=this.createFloatArray(A);this.module.addFeature(y.id,y.sourceId,y.minHeight,y.height,b,y.roofType.length,M,P,S.length-1),this.module.free(b),this.module.free(P),this.module.free(M)}for(const y of n){let b;b=y.entrances?JSON.parse(y.entrances):[];const S=this.createFloatArray(b),A=[];for(const M of y.coordinates)A.push(M.x),A.push(M.y);const P=this.createFloatArray(A);this.module.addFacade(y.sourceId,y.crossPerc,y.distanceToRoad,S,b.length,P,A.length),this.module.free(S),this.module.free(P)}if(!this.module.generateMesh()){const y=this.module.getLastError();return this.readStringBuffer(y)}const l=this.module.getMeshCount(),u=new Array(l);for(let y=0;y<l;y++){const b=this.module.getPositionsPtr(y),S=this.module.getPositionsLength(y),A=new Float32Array(this.module.heapF32.buffer,b,S),P=this.module.getNormalsPtr(y),M=this.module.getNormalsLength(y),N=new Float32Array(this.module.heapF32.buffer,P,M),L=this.module.getColorsPtr(y),U=this.module.getColorsLength(y),H=new Uint8Array(this.module.heapU8.buffer,L,U),K=this.module.getAOPtr(y),se=this.module.getAOLength(y),re=new Float32Array(this.module.heapF32.buffer,K,se),le=this.module.getUVPtr(y),Ee=this.module.getUVLength(y),we=new Float32Array(this.module.heapF32.buffer,le,Ee),Se=this.module.getFauxFacadePtr(y),Me=this.module.getFauxFacadeLength(y),De=new Uint8Array(this.module.heapU8.buffer,Se,Me),Xe=this.module.getIndicesPtr(y),Le=this.module.getIndicesLength(y),Je=new Int32Array(this.module.heap32.buffer,Xe,Le),yt=this.module.getBuildingPart(y),tt=this.readStringBuffer(yt);u[y]={positions:A,normals:N,colors:H,ao:re,uv:we,isFauxFacade:De,indices:Je,buildingPart:tt}}const f=this.module.getRingCount(),p=[];for(let y=0;y<f;y++){const b=this.module.getRingPtr(y),S=this.module.getRingLength(y),A=new Float32Array(this.module.heapF32.buffer,b,S);p.push(A)}return{meshes:u,modifiedPolygonRings:p}}}let l_,$b,rl,pp,Hb,mp=null,gp=null,hI=null,Ev=null;function fI(){return Nn(self)&&self.worker.dracoUrl?self.worker.dracoUrl:$b||gs.DRACO_URL}function pI(){if(Nn(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(pp)return pp;const r=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return pp=WebAssembly.validate(r)?gs.MESHOPT_SIMD_URL:gs.MESHOPT_URL,pp}function z4(){return Ev}const Cv={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},O4={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},c_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function mI(r,e,n){const l=n.json.bufferViews.length,u=n.buffers.length;e.bufferView=l,n.json.bufferViews[l]={buffer:u,byteLength:r.byteLength},n.buffers[u]=r}const qb="KHR_draco_mesh_compression";function F4(r,e){const n=r.extensions&&r.extensions[qb];if(!n)return;const l=new rl.Decoder,u=xI(e,n.bufferView),f=new rl.Mesh;if(!l.DecodeArrayToMesh(u,u.byteLength,f))throw new Error("Failed to decode Draco mesh");const p=e.json.accessors[r.indices],y=Cv[p.componentType],b=p.count*y.BYTES_PER_ELEMENT,S=rl._malloc(b);y===Uint16Array?l.GetTrianglesUInt16Array(f,b,S):l.GetTrianglesUInt32Array(f,b,S),mI(rl.memory.buffer.slice(S,S+b),p,e),rl._free(S);for(const A of Object.keys(n.attributes)){const P=l.GetAttributeByUniqueId(f,n.attributes[A]),M=e.json.accessors[r.attributes[A]],N=O4[M.componentType],L=M.count*c_[M.type]*Cv[M.componentType].BYTES_PER_ELEMENT,U=rl._malloc(L);l.GetAttributeDataArrayForAllPoints(f,P,rl[N],L,U),mI(rl.memory.buffer.slice(U,U+L),M,e),rl._free(U)}l.destroy(),f.destroy(),delete r.extensions[qb]}const Av="EXT_meshopt_compression";function j4(r,e){if(!r.extensions||!r.extensions[Av])return;const n=r.extensions[Av],l=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),u=new Uint8Array(n.count*n.byteStride);Hb.decodeGltfBuffer(u,n.count,n.byteStride,l,n.mode,n.filter),r.buffer=e.buffers.length,r.byteOffset=0,e.buffers[r.buffer]=u.buffer,delete r.extensions[Av]}const gI=1179937895,_I=new TextDecoder("utf8");function yI(r,e){return new URL(r,e).href}function B4(r,e,n,l){return fetch(yI(r.uri,l)).then(u=>u.arrayBuffer()).then(u=>{e.buffers[n]=u})}function xI(r,e){const n=r.json.bufferViews[e];return new Uint8Array(r.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function V4(r,e,n,l){if(r.uri){const u=yI(r.uri,l);return fetch(u).then(f=>f.blob()).then(f=>createImageBitmap(f)).then(f=>{e.images[n]=f})}if(r.bufferView!==void 0){const u=xI(e,r.bufferView),f=new Blob([u],{type:r.mimeType});return createImageBitmap(f).then(p=>{e.images[n]=p})}}function vI(r,e=0,n){const l={json:null,images:[],buffers:[]};if(new Uint32Array(r,e,1)[0]===gI){const A=new Uint32Array(r,e);let P=2;const M=(A[P++]>>2)-3,N=A[P++]>>2;if(P++,l.json=JSON.parse(_I.decode(A.subarray(P,P+N))),P+=N,P<M){const L=A[P++];P++;const U=e+(P<<2);l.buffers[0]=r.slice(U,U+L)}}else l.json=JSON.parse(_I.decode(new Uint8Array(r,e)));const{buffers:u,images:f,meshes:p,extensionsUsed:y,bufferViews:b}=l.json;let S=Promise.resolve();if(u){const A=[];for(let P=0;P<u.length;P++){const M=u[P];M.uri?A.push(B4(M,l,P,n)):l.buffers[P]||(l.buffers[P]=null)}S=Promise.all(A)}return S.then(()=>{const A=[],P=y&&y.includes(qb),M=y&&y.includes(Av);if(P&&A.push(function(){if(!rl)return l_??(l_=function(N){let L,U=null;function H(){L=new Uint8Array(U.buffer)}function K(){throw new Error("Unexpected Draco error.")}const se={a:{a:K,d:function(re,le,Ee){return L.copyWithin(re,le,le+Ee)},c:function(re){const le=L.length,Ee=Math.max(re>>>0,Math.ceil(1.2*le)),we=Math.ceil((Ee-le)/65536);try{return U.grow(we),H(),!0}catch{return!1}},b:K}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(N,se):N.then(re=>re.arrayBuffer()).then(re=>WebAssembly.instantiate(re,se))).then(re=>{const{Rb:le,Qb:Ee,P:we,T:Se,X:Me,Ja:De,La:Xe,Qa:Le,Va:Je,Wa:yt,eb:tt,jb:ut,f:gt,e:We,yb:dt,zb:ze,Ab:Ze,Bb:wt,Db:ft,Gb:Zt}=re.instance.exports;U=We;const Ut=(()=>{let lt=0,pt=0,$t=0,zt=0;return At=>{$t&&(le(zt),le(lt),pt+=$t,$t=lt=0),lt||(pt+=128,lt=Ee(pt));const Ot=At.length+7&-8;let li=lt;Ot>=pt&&($t=Ot,li=zt=Ee(Ot));for(let vi=0;vi<At.length;vi++)L[li+vi]=At[vi];return li}})();return H(),gt(),{memory:We,_free:le,_malloc:Ee,Mesh:class{constructor(){this.ptr=we()}destroy(){Se(this.ptr)}},Decoder:class{constructor(){this.ptr=De()}destroy(){ut(this.ptr)}DecodeArrayToMesh(lt,pt,$t){const zt=Ut(lt),At=Xe(this.ptr,zt,pt,$t.ptr);return!!Me(At)}GetAttributeByUniqueId(lt,pt){return{ptr:Le(this.ptr,lt.ptr,pt)}}GetTrianglesUInt16Array(lt,pt,$t){Je(this.ptr,lt.ptr,pt,$t)}GetTrianglesUInt32Array(lt,pt,$t){yt(this.ptr,lt.ptr,pt,$t)}GetAttributeDataArrayForAllPoints(lt,pt,$t,zt,At){tt(this.ptr,lt.ptr,pt.ptr,$t,zt,At)}},DT_INT8:dt(),DT_UINT8:ze(),DT_INT16:Ze(),DT_UINT16:wt(),DT_UINT32:ft(),DT_FLOAT32:Zt()}})}(fetch(fI())),l_.then(N=>{rl=N,l_=void 0}))}()),M&&A.push(function(){if(Hb)return;const N=function(L){let U;const H=WebAssembly.instantiateStreaming(L,{}).then(re=>{U=re.instance,U.exports.__wasm_call_ctors()}),K={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},se={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:H,supported:!0,decodeGltfBuffer(re,le,Ee,we,Se,Me){(function(De,Xe,Le,Je,yt,tt,ut){const gt=De.exports.sbrk,We=Je+3&-4,dt=gt(We*yt),ze=gt(tt.length),Ze=new Uint8Array(De.exports.memory.buffer);Ze.set(tt,ze);const wt=Xe(dt,Je,yt,ze,tt.length);if(wt===0&&ut&&ut(dt,We,yt),Le.set(Ze.subarray(dt,dt+Je*yt)),gt(dt-gt(0)),wt!==0)throw new Error(`Malformed buffer data: ${wt}`)})(U,U.exports[se[Se]],re,le,Ee,we,U.exports[K[Me]])}}}(fetch(pI()));return N.ready.then(()=>{Hb=N})}()),f)for(let N=0;N<f.length;N++)A.push(V4(f[N],l,N,n));return(A.length?Promise.all(A):Promise.resolve()).then(()=>{if(P&&p)for(const{primitives:N}of p)for(const L of N)F4(L,l);if(M&&p&&b)for(const N of b)j4(N,l);return l})})}function Wb(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Zb(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Xb{constructor(e,n,l,u){this.context=e,this.format=l,this.useMipmap=u&&u.useMipmap,this.texture=e.gl.createTexture(),this.update(n,{premultiply:u&&u.premultiply})}update(e,n){const l=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,u=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:f}=this,{gl:p}=f,{x:y,y:b}=n&&n.position?n.position:{x:0,y:0},S=y+l,A=b+u;!this.size||this.size[0]===S&&this.size[1]===A||(p.bindTexture(p.TEXTURE_2D,null),p.deleteTexture(this.texture),this.texture=p.createTexture(),this.size=null),p.bindTexture(p.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===p.RGBA8&&(!n||n.premultiply!==!1));const P=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&S>0&&A>0){const M=this.useMipmap?Math.floor(Math.log2(Math.max(S,A)))+1:1;p.texStorage2D(p.TEXTURE_2D,M,this.format,S,A),this.size=[S,A]}if(this.size)if(P)p.texSubImage2D(p.TEXTURE_2D,0,y,b,Wb(this.format),Zb(this.format),e);else{const M=e.data;M&&p.texSubImage2D(p.TEXTURE_2D,0,y,b,l,u,Wb(this.format),Zb(this.format),M)}this.useMipmap&&p.generateMipmap(p.TEXTURE_2D)}bind(e,n,l=!1){const{context:u}=this,{gl:f}=u;f.bindTexture(f.TEXTURE_2D,this.texture),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap&&!l?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,n),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,l,u,f){const{context:p}=this,{gl:y}=p;y.bindTexture(y.TEXTURE_2D,this.texture),n!==this.magFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,this.useMipmap?e===y.NEAREST?y.NEAREST_MIPMAP_NEAREST:y.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),l!==this.wrapS&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,l),this.wrapS=l),u!==this.wrapT&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,u),this.wrapT=u),f!==this.compareMode&&(f?(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_COMPARE_MODE,y.COMPARE_REF_TO_TEXTURE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_COMPARE_FUNC,f)):y.texParameteri(y.TEXTURE_2D,y.TEXTURE_COMPARE_MODE,y.NONE),this.compareMode=f)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class u_{constructor(e,n){this.context=e,this.texture=n}bind(e,n){const{context:l}=this,{gl:u}=l;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,n),this.wrapS=n)}}const U4=Qi([{name:"a_pos_3f",components:3,type:"Float32"}]),G4=Qi([{name:"a_color_3f",components:3,type:"Float32"}]),$4=Qi([{name:"a_color_4f",components:4,type:"Float32"}]),H4=Qi([{name:"a_uv_2f",components:2,type:"Float32"}]),q4=Qi([{name:"a_normal_3f",components:3,type:"Float32"}]),W4=Qi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Z4=Qi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function wI(r,e){const n=Iv(r.projection,r.zoom,r.width,r.height),l=function(f,p,y,b,S){const A=new D(y.lng-180*Gu,y.lat),P=new D(y.lng+180*Gu,y.lat),M=f.project(A.lng,A.lat),N=f.project(P.lng,P.lat),L=-Math.atan2(N.y-M.y,N.x-M.x),U=ve.fromLngLat(y);U.y=ge(U.y,-1+Gu,1-Gu);const H=U.toLngLat(),K=f.project(H.lng,H.lat),se=ve.fromLngLat(H);se.x+=Gu;const re=se.toLngLat(),le=f.project(re.lng,re.lat),Ee=SI(le.x-K.x,le.y-K.y,L),we=ve.fromLngLat(H);we.y+=Gu;const Se=we.toLngLat(),Me=f.project(Se.lng,Se.lat),De=SI(Me.x-K.x,Me.y-K.y,L),Xe=Math.abs(Ee.x)/Math.abs(De.y),Le=J([]);Ke(Le,Le,-L*(1-(S?0:b)));const Je=J([]);return Q(Je,Je,[1,1-(1-Xe)*b,1]),Je[4]=-De.x/De.y*b,Ke(Je,Je,L),oe(Je,Le,Je),Je}(r.projection,0,r.center,n,e),u=bI(r);return Q(l,l,[u,u,1]),l}function bI(r){const e=r.projection,n=Iv(r.projection,r.zoom,r.width,r.height),l=Kb(e,r.center),u=Kb(e,D.convert(e.center));return Math.pow(2,l*n+(1-n)*u)}function Iv(r,e,n,l,u=1/0){const f=r.range;if(!f)return 0;const p=Math.min(u,Math.max(n,l)),y=Math.log(p/1024)/Math.LN2;return Re(f[0]+y,f[1]+y,e)}const Gu=1/4e4;function Kb(r,e){const n=ge(e.lat,-_e,_e),l=new D(e.lng-180*Gu,n),u=new D(e.lng+180*Gu,n),f=r.project(l.lng,n),p=r.project(u.lng,n),y=ve.fromLngLat(l),b=ve.fromLngLat(u),S=p.x-f.x,A=p.y-f.y,P=b.x-y.x,M=b.y-y.y,N=Math.sqrt((P*P+M*M)/(S*S+A*A));return Math.log(N)/Math.LN2}function SI(r,e,n){const l=Math.cos(n),u=Math.sin(n);return{x:r*l-e*u,y:r*u+e*l}}function TI(r,e,n){J(r),Ke(r,r,pn(e[2])),Ie(r,r,pn(e[0])),pe(r,r,pn(e[1])),Q(r,r,n),oe(r,r,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Pv(r,e,n,l,u,f,p,y){const b=[n[0]-e[0],n[1]-e[1],0],S=[l[0]-e[0],l[1]-e[1],0];if(Kt(b)<1e-12||Kt(S)<1e-12)return fi(r);const A=Fi([],b,S);wi(A,A),bi(S,l,e),b[2]=(f-u)*y,S[2]=(p-u)*y;const P=b;return Fi(P,b,S),wi(P,P),mo(r,A,P)}function Yb(r,e,n=!1){const l=Bu(e.zoom),u=function(f,p,y){const b=p.worldSize,S=[f[12],f[13],f[14]],A=ae(S[1]/b),P=ne(S[0]/b),M=J([]),N=Z(1,A)*b,L=Z(1,0)*b*Te(A,p.zoom),U=1/Eb(b);let H=L*U;if(y){const le=Iv(p.projection,p.zoom,p.width,p.height,1024);H=U*p.projection.pixelSpaceConversion(p.center.lat,b,le)}const K=T(A,P);Nt(K,K,jt([],wi([],K),N*H*S[2]));const se=function(le){const Ee=[le[0],le[1],le[2]];let we=[0,1,0];const Se=Fi([],we,Ee);return Fi(we,Ee,Se),Dn(we)===0&&(we=[0,1,0],Fi(Se,Ee,we)),wi(Se,Se),wi(we,we),wi(Ee,Ee),[Se[0],Se[1],Se[2],0,we[0],we[1],we[2],0,Ee[0],Ee[1],Ee[2],0,le[0],le[1],le[2],1]}(K);Q(M,M,[H,H,H*N]),ee(M,M,[-S[0],-S[1],-S[2]]);const re=oe([],p.globeMatrix,se);return oe(re,re,M),oe(re,re,f),re}(r,e,n);if(l>0){const f=function(p,y){const b=y.worldSize,S=Z(1,0)*b*Te(y.center.lat,y.zoom)/Eb(b),A=Z(1,y.center.lat)*b,P=J([]);return pe(P,P,pn(y.center.lng)),Ie(P,P,pn(y.center.lat)),ee(P,P,[0,0,Fs]),Q(P,P,[S,S,S*A]),ee(P,P,[y.point.x-.5*b,y.point.y-.5*b,0]),oe(P,P,p),oe(P,y.globeMatrix,P)}(r,e);return function(p,y,b){const S=(L,U,H)=>{const K=Kt(L),se=Kt(U),re=Lc(L,U,H);return jt(re,re,1/Kt(re)*si(K,se,H))},A=S([p[0],p[1],p[2]],[y[0],y[1],y[2]],b),P=S([p[4],p[5],p[6]],[y[4],y[5],y[6]],b),M=S([p[8],p[9],p[10]],[y[8],y[9],y[10]],b),N=Lc([p[12],p[13],p[14]],[y[12],y[13],y[14]],b);return[A[0],A[1],A[2],0,P[0],P[1],P[2],0,M[0],M[1],M[2],0,N[0],N[1],N[2],1]}(u,f,l)}return u}function EI(r,e,n,l){const u=Gi.projectAabbCorners(l,n);let f=Number.MAX_VALUE,p=-1;for(let S=0;S<u.length;++S){const A=u[S];A[0]=(.5*A[0]+.5)*e.width,A[1]=(.5-.5*A[1])*e.height,A[2]<f&&(p=S,f=A[2])}const y=S=>new ht(u[S][0],u[S][1]);let b;switch(p){case 0:case 6:b=[y(1),y(5),y(4),y(7),y(3),y(2),y(1)];break;case 1:case 7:b=[y(0),y(4),y(5),y(6),y(2),y(3),y(0)];break;case 3:case 5:b=[y(1),y(0),y(4),y(7),y(6),y(2),y(1)];break;default:b=[y(1),y(5),y(6),y(7),y(3),y(0),y(1)]}if(Ln(r,b))return f}const Dh=64,_p={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function CI(r,e,n,l,u,f,p,y,b,S=!1){const A=n.zoom,P=n.project(l),M=Te(l.lat,A),N=1/M;J(r),ee(r,r,[P.x+p[0]*N,P.y+p[1]*N,p[2]]);let L=1,U=1;const H=n.worldSize;if(S){if(n.projection.name==="mercator"){let le=0;n.elevation&&(le=n.elevation.getAtPointOrZero(new ve(P.x/H,P.y/H),0));const Ee=rt([],[P.x,P.y,le,1],n.projMatrix)[3]/n.cameraToCenterDistance;L=Ee,U=Ee*Te(n.center.lat,A)}else if(n.projection.name==="globe"){const le=Yb(r,n),Ee=[0,0,0,1];rt(Ee,Ee,oe([],n.projMatrix,le));const we=Ee[3]/n.cameraToCenterDistance,Se=Bu(A),Me=n.projection.pixelsPerMeter(l.lat,H)*Te(l.lat,A),De=n.projection.pixelsPerMeter(n.center.lat,H)*Te(n.center.lat,A);L=we/si(Me,be(n.center.lat),Se),U=we*M/Me,L*=De,U*=De}}else L=N;Q(r,r,[L,L,U]);const K=[...r],se=e.orientation,re=[];if(TI(re,[se[0]+u[0],se[1]+u[1],se[2]+u[2]],f),oe(r,K,re),y&&n.elevation){let le=0;const Ee=[];if(b&&n.elevation){le=function(Se,Me,De,Xe,Le){const Je=Me.elevation;if(!Je)return 0;const yt=Gi.projectAabbCorners(De,Xe),tt=Z(1,Le.lat)*Me.worldSize,ut=function(pt,$t){const zt=[0,0,1],At=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Ot of At){const li=pt[Ot.corners[0]],vi=pt[Ot.corners[1]],Di=pt[Ot.corners[2]],Ii=[vi[0]-li[0],vi[1]-li[1],$t*(vi[2]-li[2])],Yi=Fi(Ii,Ii,[Di[0]-li[0],Di[1]-li[1],$t*(Di[2]-li[2])]);wi(Yi,Yi),Ot.dotProductWithUp=ni(Yi,zt)}return At.sort((Ot,li)=>Ot.dotProductWithUp-li.dotProductWithUp),At[0].corners}(yt,tt),gt=yt[ut[0]],We=yt[ut[1]],dt=yt[ut[2]],ze=yt[ut[3]],Ze=Je.getAtPointOrZero(new ve(gt[0]/Me.worldSize,gt[1]/Me.worldSize),0),wt=Je.getAtPointOrZero(new ve(We[0]/Me.worldSize,We[1]/Me.worldSize),0),ft=Je.getAtPointOrZero(new ve(dt[0]/Me.worldSize,dt[1]/Me.worldSize),0),Zt=Je.getAtPointOrZero(new ve(ze[0]/Me.worldSize,ze[1]/Me.worldSize),0),Ut=(Ze+Zt)/2,lt=(wt+ft)/2;return Ut>lt?wt<ft?Pv(Se,We,ze,gt,wt,Zt,Ze,tt):Pv(Se,dt,gt,ze,ft,Ze,Zt,tt):Ze<Zt?Pv(Se,gt,We,dt,Ze,wt,ft,tt):Pv(Se,ze,dt,We,Zt,ft,wt,tt),Math.max(Ut,lt)}(Ee,n,e.aabb,r,l);const we=oe([],Xt([],Ee),re);oe(r,K,we)}else le=n.elevation.getAtPointOrZero(new ve(P.x/H,P.y/H),0);le!==0&&(r[14]+=le)}}function d_(r,e,n=!1){r.uploaded||(r.gfxTexture=new Xb(e,r.image,n?e.gl.R8:e.gl.RGBA8,{useMipmap:r.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),r.uploaded=!0,r.image=null)}function X4(r,e,n){r.indexBuffer=e.createIndexBuffer(r.indexArray,!1,!0),r.vertexBuffer=e.createVertexBuffer(r.vertexArray,U4.members,!1,!0),r.normalArray&&(r.normalBuffer=e.createVertexBuffer(r.normalArray,q4.members,!1,!0)),r.texcoordArray&&(r.texcoordBuffer=e.createVertexBuffer(r.texcoordArray,H4.members,!1,!0)),r.colorArray&&(r.colorBuffer=e.createVertexBuffer(r.colorArray,(r.colorArray.bytesPerElement===12?G4:$4).members,!1,!0)),r.featureArray&&(r.pbrBuffer=e.createVertexBuffer(r.featureArray,Z4.members,!0)),r.segments=rr.simpleSegment(0,0,r.vertexArray.length,r.indexArray.length);const l=r.material;l.pbrMetallicRoughness.baseColorTexture&&d_(l.pbrMetallicRoughness.baseColorTexture,e),l.pbrMetallicRoughness.metallicRoughnessTexture&&d_(l.pbrMetallicRoughness.metallicRoughnessTexture,e),l.normalTexture&&d_(l.normalTexture,e),l.occlusionTexture&&d_(l.occlusionTexture,e,n),l.emissionTexture&&d_(l.emissionTexture,e)}function Jb(r,e,n){if(r.meshes)for(const l of r.meshes)X4(l,e,n);if(r.children)for(const l of r.children)Jb(l,e,n)}function Mv(r){if(r.meshes)for(const e of r.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(r.children)for(const e of r.children)Mv(e)}function Qb(r){if(r.meshes)for(const n of r.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(r.children)for(const n of r.children)Qb(n)}function kh(r,e){const n=r.json.bufferViews[e.bufferView],l=Cv[e.componentType];return new l(r.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==c_[e.type]*l.BYTES_PER_ELEMENT?n.byteStride/l.BYTES_PER_ELEMENT:c_[e.type]))}function e2(r,e,n,l){const u=Cv[e.componentType],f=function(A){switch(A){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(u),p=r.json.bufferViews[e.bufferView],y=p.byteStride?p.byteStride/u.BYTES_PER_ELEMENT:c_[e.type],b=n.float32,S=b.length/n.capacity;for(let A=0,P=0;A<e.count*y;A+=y,P+=S)for(let M=0;M<S;M++)b[P+M]=l[A+M]*f;n._trim()}function K4(r,e,n){const l=r.indices,u=r.attributes,f={};f.indexArray=new Qn;const p=e.json.accessors[l],y=p.count/3;f.indexArray.reserve(y);const b=kh(e,p);for(let M=0;M<y;M++)f.indexArray.emplaceBack(b[3*M],b[3*M+1],b[3*M+2]);f.indexArray._trim(),f.vertexArray=new ko;const S=e.json.accessors[u.POSITION];f.vertexArray.reserve(S.count);const A=kh(e,S);for(let M=0;M<S.count;M++)f.vertexArray.emplaceBack(A[3*M],A[3*M+1],A[3*M+2]);if(f.vertexArray._trim(),f.aabb=new Gi(S.min,S.max),f.centroid=function(M,N){const L=[0,0,0],U=M.length;if(U>0){for(let H=0;H<U;H++){const K=3*M[H];L[0]+=N[K],L[1]+=N[K+1],L[2]+=N[K+2]}L[0]/=U,L[1]/=U,L[2]/=U}return L}(b,A),u.COLOR_0!==void 0){const M=e.json.accessors[u.COLOR_0],N=c_[M.type],L=kh(e,M);f.colorArray=N===3?new ko:new Wl,f.colorArray.resize(M.count),e2(e,M,f.colorArray,L)}if(u.NORMAL!==void 0){f.normalArray=new ko;const M=e.json.accessors[u.NORMAL];f.normalArray.resize(M.count);const N=kh(e,M);e2(e,M,f.normalArray,N)}if(u.TEXCOORD_0!==void 0&&n.length>0){f.texcoordArray=new Zl;const M=e.json.accessors[u.TEXCOORD_0];f.texcoordArray.resize(M.count);const N=kh(e,M);e2(e,M,f.texcoordArray,N)}if(u._FEATURE_ID_RGBA4444!==void 0){const M=e.json.accessors[u._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(f.featureData=kh(e,M))}u._FEATURE_RGBA4444!==void 0&&(f.featureData=new Uint32Array(kh(e,e.json.accessors[u._FEATURE_RGBA4444]).buffer));const P=r.material;return f.material=function(M,N){const{emissiveFactor:L=[0,0,0],alphaMode:U="OPAQUE",alphaCutoff:H=.5,normalTexture:K,occlusionTexture:se,emissiveTexture:re,doubleSided:le}=M,{baseColorFactor:Ee=[1,1,1,1],metallicFactor:we=1,roughnessFactor:Se=1,baseColorTexture:Me,metallicRoughnessTexture:De}=M.pbrMetallicRoughness||{},Xe=se?N[se.index]:void 0;if(se&&se.extensions&&se.extensions.KHR_texture_transform&&Xe){const Le=se.extensions.KHR_texture_transform;Xe.offsetScale=[Le.offset[0],Le.offset[1],Le.scale[0],Le.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new bn(...Ee),metallicFactor:we,roughnessFactor:Se,baseColorTexture:Me?N[Me.index]:void 0,metallicRoughnessTexture:De?N[De.index]:void 0},doubleSided:le,emissiveFactor:new bn(...L),alphaMode:U,alphaCutoff:H,normalTexture:K?N[K.index]:void 0,occlusionTexture:Xe,emissionTexture:re?N[re.index]:void 0,defined:M.defined===void 0}}(P!==void 0?e.json.materials[P]:{defined:!1},n),f}function AI(r,e,n){const{matrix:l,rotation:u,translation:f,scale:p,mesh:y,extras:b,children:S}=r,A={};if(A.matrix=l||function(P,M,N,L){var U=M[0],H=M[1],K=M[2],se=M[3],re=U+U,le=H+H,Ee=K+K,we=U*re,Se=U*le,Me=U*Ee,De=H*le,Xe=H*Ee,Le=K*Ee,Je=se*re,yt=se*le,tt=se*Ee,ut=L[0],gt=L[1],We=L[2];return P[0]=(1-(De+Le))*ut,P[1]=(Se+tt)*ut,P[2]=(Me-yt)*ut,P[3]=0,P[4]=(Se-tt)*gt,P[5]=(1-(we+Le))*gt,P[6]=(Xe+Je)*gt,P[7]=0,P[8]=(Me+yt)*We,P[9]=(Xe-Je)*We,P[10]=(1-(we+De))*We,P[11]=0,P[12]=N[0],P[13]=N[1],P[14]=N[2],P[15]=1,P}([],u||[0,0,0,1],f||[0,0,0],p||[1,1,1]),y!==void 0){A.meshes=n[y];const P=A.anchor=[0,0];for(const M of A.meshes){const{min:N,max:L}=M.aabb;P[0]+=N[0]+L[0],P[1]+=N[1]+L[1]}P[0]=Math.floor(P[0]/A.meshes.length/2),P[1]=Math.floor(P[1]/A.meshes.length/2)}if(b&&(b.id&&(A.id=b.id),b.lights&&(A.lights=function(P){if(!P.length)return[];const M=function(K){const se=atob(K),re=new Uint8Array(se.length);for(let le=0;le<se.length;le++)re[le]=se.codePointAt(le);return re}(P),N=[],L=M.length/24,U=new Uint16Array(M.buffer),H=new Float32Array(M.buffer);for(let K=0;K<L;K++){const se=U[2*K*6]/30,re=U[2*K*6+1]/30,le=U[2*K*6+10]/100,Ee=H[6*K+1],we=H[6*K+2],Se=H[6*K+3],Me=H[6*K+4],De=Se-Ee,Xe=Me-we,Le=Math.hypot(De,Xe);N.push({pos:[Ee+.5*De,we+.5*Xe,re],normal:[Xe/Le,-De/Le,0],width:Le,height:se,depth:le,points:[Ee,we,Se,Me]})}return N}(b.lights))),S){const P=[];for(const M of S)P.push(AI(e.json.nodes[M],e,n));A.children=P}return A}function Y4(r){if(r.vertices.length===0||r.indices.length===0)return null;const e=new yv(r.vertices,r.indices,8,256),[n,l]=[e.min.clone(),e.max.clone()];return{vertices:r.vertices,indices:r.indices,grid:e,min:n,max:l}}function J4(r){if(!r.extras||!r.extras.ground)return null;const e=r.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;const l=[];for(const p of n){if(!Array.isArray(p)||p.length!==2)continue;const y=p[0],b=p[1];typeof y=="number"&&typeof b=="number"&&l.push(new ht(y,b))}if(l.length<3)return null;l.length>1&&l[l.length-1].equals(l[0])&&l.pop();let u=0;for(let p=0;p<l.length;p++){const y=l[p],b=l[(p+1)%l.length],S=l[(p+2)%l.length];u+=(y.x-b.x)*(S.y-b.y)-(S.x-b.x)*(y.y-b.y)}u>0&&l.reverse();const f=dp(l.flatMap(p=>[p.x,p.y]),[]);return f.length===0?null:{vertices:l,indices:f}}function Q4(r,e){const n=[],l=[];let u=0;const f=[];for(const p of r){u=n.length;const y=p.vertexArray.float32,b=p.indexArray.uint16;for(let S=0;S<p.vertexArray.length;S++)f[0]=y[3*S+0],f[1]=y[3*S+1],f[2]=y[3*S+2],Ri(f,f,e),n.push(new ht(f[0],f[1]));for(let S=0;S<3*p.indexArray.length;S++)l.push(b[S]+u)}if(l.length%3!=0)return null;for(let p=0;p<l.length;p+=3){const y=n[l[p+0]],b=n[l[p+1]],S=n[l[p+2]];(y.x-b.x)*(S.y-b.y)-(S.x-b.x)*(y.y-b.y)>0&&([l[p+1],l[p+2]]=[l[p+2],l[p+1]])}return{vertices:n,indices:l}}function II(r){const e=function(b,S){const A=[],P=WebGL2RenderingContext;if(b.json.textures)for(const M of b.json.textures){const N={magFilter:P.LINEAR,minFilter:P.NEAREST,wrapS:P.REPEAT,wrapT:P.REPEAT};M.sampler!==void 0&&Object.assign(N,b.json.samplers[M.sampler]),A.push({image:S[M.source],sampler:N,uploaded:!1})}return A}(r,r.images),n=function(b,S){const A=[];for(const P of b.json.meshes){const M=[];for(const N of P.primitives)M.push(K4(N,b,S));A.push(M)}return A}(r,e),{scenes:l,scene:u,nodes:f}=r.json,p=l?l[u||0].nodes:f,y=[];for(const b of p)y.push(AI(f[b],r,n));return function(b,S,A){const P={},M=new Set;for(let N=0;N<b.length;N++){const L=A[S[N]];if(!L.extras)continue;const U=L.extras["mapbox:footprint:version"],H=L.extras["mapbox:footprint:id"];(U||H)&&M.add(N),U==="1.0.0"&&H&&(P[H]=N)}for(let N=0;N<b.length;N++){if(M.has(N))continue;const L=b[N],U=A[S[N]];if(!U.extras)continue;let H=null;L.id in P&&(H=Q4(b[P[L.id]].meshes,L.matrix)),H||(H=J4(U)),H&&(L.footprint=Y4(H))}if(M.size>0){const N=Array.from(M.values()).sort((L,U)=>L-U);for(let L=N.length-1;L>=0;L--)b.splice(N[L],1)}}(y,p,r.json.nodes),y}function eB(r){r.heightmap=new Float32Array(4096),r.heightmap.fill(-1);const e=r.vertexArray.float32,n=r.aabb.min[0]-1,l=r.aabb.min[1]-1,u=Dh/(r.aabb.max[0]-n+2),f=Dh/(r.aabb.max[1]-l+2);for(let p=0;p<e.length;p+=3){const y=e[p+2],b=(e[p+0]-n)*u|0,S=(e[p+1]-l)*f|0;y>r.heightmap[S*Dh+b]&&(r.heightmap[S*Dh+b]=y)}}function PI(r,e,n,l,u){n.reserve(n.length+4*r.length),l.reserve(l.length+10*r.length),u.reserve(u.length+10*r.length);let f=l.length;for(const p of r){const y=Math.min(10,Math.max(4,1.3*p.height))*e,b=[-p.normal[1],p.normal[0],0],S=Math.min(.29,.1*p.width/p.depth),A=p.width-2*p.depth*e*(S+.01),P=gi([],p.pos,b,A/2),M=gi([],p.pos,b,-A/2),N=[P[0],P[1],P[2]+p.height],L=[M[0],M[1],M[2]+p.height],U=gi([],p.normal,b,S);jt(U,U,y);const H=gi([],p.normal,b,-S);jt(H,H,y),Nt(U,P,U),Nt(H,M,H),P[2]+=.1,M[2]+=.1,l.emplaceBack(U[0],U[1],U[2]),l.emplaceBack(H[0],H[1],H[2]),l.emplaceBack(P[0],P[1],P[2]),l.emplaceBack(M[0],M[1],M[2]),l.emplaceBack(N[0],N[1],N[2]),l.emplaceBack(L[0],L[1],L[2]),l.emplaceBack(P[0],P[1],P[2]),l.emplaceBack(M[0],M[1],M[2]),l.emplaceBack(U[0],U[1],U[2]),l.emplaceBack(H[0],H[1],H[2]);const K=A/y/2;u.emplaceBack(-K-S,-1,K,.8),u.emplaceBack(K+S,-1,K,.8),u.emplaceBack(-K,0,K,1.3),u.emplaceBack(K,0,K,1.3),u.emplaceBack(K+S,-.8,K,.7),u.emplaceBack(K+S,-.8,K,.7),u.emplaceBack(0,0,K,1.3),u.emplaceBack(0,0,K,1.3),u.emplaceBack(K+S,-1.2,K,.8),u.emplaceBack(K+S,-1.2,K,.8),n.emplaceBack(6+f,4+f,8+f),n.emplaceBack(7+f,9+f,5+f),n.emplaceBack(0+f,1+f,2+f),n.emplaceBack(1+f,3+f,2+f),f+=10}}function tB(r,e){const n={};n.indexArray=new Qn,n.vertexArray=new ko,n.colorArray=new Wl,PI(r,e,n.indexArray,n.vertexArray,n.colorArray);const l={defined:!0};l.emissiveFactor=bn.black;const u={};return u.baseColorFactor=bn.white,l.pbrMetallicRoughness=u,n.material=l,n.aabb=new Gi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}const MI=Qi([{name:"a_pos_3f",components:3,type:"Float32"}]),iB=Qi([{name:"a_normal_3",components:3,type:"Int16"}]),RI=Qi([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),nB=Qi([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),DI=je.types,t2=32767;function rB(r,e){const n=Et+e;for(const l of r)for(const u of l)if(u.x<-e||u.x>n||u.y<-e||u.y>n)return!1;return!0}class kI{constructor(e){this.layoutAOArray=[],this.indexArrayForConflationUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.layoutVertexArray=new ko,this.layoutNormalArray=new Iu,this.layoutColorArray=new za,this.indexArray=new Qn,this.indexArrayForConflation=new Qn,this.entranceBloom={layoutVertexArray:new ko,layoutVertexBuffer:null,layoutAttenuationArray:new Wl,layoutAttenuationBuffer:null,layoutColorArray:new za,layoutColorBuffer:null,indexArray:new Qn,indexArrayForConflation:new Qn,indexBuffer:null,segmentsBucket:new rr},this.programConfigurations=new Lo(e.layers,{zoom:e.zoom,lut:e.lut}),this.segmentsBucket=new rr,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection,this.groundEffect=new Bb(e)}get segments(){return this.segmentsBucket}get bloomGeometry(){return this.entranceBloom}updateFootprints(e,n){for(const l of this.footprints)n.push({footprint:l,id:e})}prepare(){return function(){if(Ev!=null||hI!=null)return null;if(gp!=null)return gp;const e=fetch(gs.BUILDING_GEN_URL);return gp=function(n){let l,u,f,p;function y(){l=new Uint8Array(p.buffer),u=new Int32Array(p.buffer),f=new Float32Array(p.buffer)}function b(){throw new Error("Unexpected BuildingGen error.")}const S=()=>{},A={a:{a:b,f:function(P){const M=l.length,N=Math.max(P>>>0,Math.ceil(1.2*M)),L=Math.ceil((N-M)/65536);try{return p.grow(L),y(),!0}catch{return!1}},g:b,b:S,c:S,d:S,e:S}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(n,A):n.then(P=>P.arrayBuffer()).then(P=>WebAssembly.instantiate(P,A))).then(P=>{const M=P.instance.exports;return(0,M.g)(),p=M.f,y(),new L4({setStyle:M.h,setAOOptions:M.i,setMetricOptions:M.j,setStructuralOptions:M.k,setFacadeOptions:M.l,setFauxFacadeOptions:M.m,setFacadeClassifierOptions:M.n,addFeature:M.o,addFacade:M.p,generateMesh:M.q,getLastError:M.r,getMeshCount:M.s,getPositionsPtr:M.t,getPositionsLength:M.u,getNormalsPtr:M.v,getNormalsLength:M.w,getColorsPtr:M.x,getColorsLength:M.y,getAOPtr:M.z,getAOLength:M.A,getUVPtr:M.B,getUVLength:M.C,getFauxFacadePtr:M.D,getFauxFacadeLength:M.E,getIndicesPtr:M.F,getIndicesLength:M.G,getBuildingPart:M.H,getRingCount:M.I,getRingPtr:M.J,getRingLength:M.K,free:M.L,malloc:M.M,heapU8:l,heap32:u,heapF32:f})})}(e).then(n=>(gp=null,Ev=n,Ev)).catch(n=>{Ki("Could not load building-gen"),gp=null,hI=n}),gp}()}populate(e,n,l,u){const f=z4();if(!f)return;const p=xe(l);this.tileToMeter=p,this.brightness=n.brightness,f.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,p],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:p,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),f.setAOOptions(!1,.3),f.setMetricOptions(!1,16),f.setStructuralOptions(!0),f.setFacadeOptions(4,!0),f.setFauxFacadeOptions(!1,!1,1),f.setFacadeClassifierOptions(3);const y=new Map;for(const{feature:b}of e){if(DI[b.type]!=="LineString")continue;const S=this.layers[0]._featureFilter.needGeometry,A=qe(b,S);if(!this.layers[0]._featureFilter.filter(new Pn(this.zoom),A,l))continue;const P=S?A.geometry:Ae(b,l,u),M=[];for(const H of P)for(const K of H)M.push({x:K.x,y:K.y});const N={coordinates:M,crossPerc:b.properties.cross_perc,distanceToRoad:b.properties.distance_to_road,entrances:b.properties.entrances,sourceId:0},L=b.properties.source_id;let U=y.get(L);U||(U=[],y.set(L,U)),U.push(N)}this.maxHeight=0;for(const{feature:b,index:S}of e){if(DI[b.type]==="LineString")continue;const A=this.layers[0]._featureFilter.needGeometry,P=qe(b,A);if(!this.layers[0]._featureFilter.filter(new Pn(this.zoom),P,l))continue;const M=A?P.geometry:Ae(b,l,u),N=e_(M,500);if(!rB(M,163))continue;const L=this.layers[0],U=L.layout.get("building-base").evaluate(b,{},l),H=L.layout.get("building-height").evaluate(b,{},l),K=L.layout.get("building-roof-shape").evaluate(b,{},l),se=L.paint.get("building-ambient-occlusion-intensity"),re=L.paint.get("building-ambient-occlusion-ground-radius")/this.tileToMeter;if(K==="flat")continue;const le=b.properties.source_id;let Ee;Ee=y.has(le)?y.get(le):[];const we=[],Se=new ht(1/0,1/0),Me=new ht(-1/0,-1/0);for(const lt of N)if(lt.length>0){const pt=[];for(const $t of lt){const zt=[];for(let At=$t.length-1;At>=0;At--){const Ot=$t[At];zt.push({x:Ot.x,y:Ot.y}),Se.x=Math.min(Se.x,Ot.x),Se.y=Math.min(Se.y,Ot.y),Me.x=Math.max(Me.x,Ot.x),Me.y=Math.max(Me.y,Ot.y)}pt.push(zt)}we.push({id:b.id,height:H,minHeight:U,sourceId:0,roofType:K,coordinates:pt})}const De=f.generateMesh(we,Ee);if(typeof De=="string"||De.meshes.length===0||De.modifiedPolygonRings.length===0)continue;let Xe=0;for(const lt of De.meshes)Xe+=lt.positions.length/3;const Le=this.segmentsBucket.prepareSegment(Xe,this.layoutVertexArray,this.indexArray),Je=[];let yt=null,tt=0,ut=-1;const gt=this.indexArray.length;let We=0;for(const lt of De.meshes){const pt=this.layoutVertexArray.length;if(lt.buildingPart==="entrance"){const zt=new Array;for(let vi=0;vi<lt.indices.length;vi+=12){const Di=lt.positions[vi+0],Ii=lt.positions[vi+1],Yi=lt.positions[vi+3],Bi=lt.positions[vi+4],qn=lt.positions[vi+2],he=lt.positions[vi+8]-qn,fe=1,He=Yi-Di,bt=Bi-Ii,Mt=Math.hypot(He,bt);zt.push({pos:[Di+.5*He,Ii+.5*bt,qn],normal:[bt/Mt,-He/Mt,0],width:Mt,height:he,depth:fe,points:[Di,Ii,Yi,Bi]})}const At=this.entranceBloom.segmentsBucket.prepareSegment(10*zt.length,this.entranceBloom.layoutVertexArray,this.entranceBloom.indexArray),Ot=this.entranceBloom.layoutVertexArray.length;tt=this.entranceBloom.indexArray.length,PI(zt,.5/this.tileToMeter,this.entranceBloom.indexArray,this.entranceBloom.layoutVertexArray,this.entranceBloom.layoutAttenuationArray);const li=this.entranceBloom.layoutVertexArray.length-Ot;ut=this.entranceBloom.indexArray.length-tt;for(let vi=0;vi<li;vi++)this.entranceBloom.layoutColorArray.emplaceBack(65535,65535);At.vertexLength+=li,At.primitiveLength+=ut,yt={part:lt.buildingPart,vertexOffset:Ot,vertexLength:li}}for(let zt=0;zt<lt.positions.length;zt+=3)We=Math.max(We,lt.positions[zt+2]),this.layoutVertexArray.emplaceBack(lt.positions[zt],lt.positions[zt+1],lt.positions[zt+2]);for(let zt=0;zt<lt.normals.length;zt+=3)this.layoutNormalArray.emplaceBack(lt.normals[zt+0]*t2,lt.normals[zt+1]*t2,lt.normals[zt+2]*t2);for(let zt=0;zt<lt.ao.length;zt++)this.layoutAOArray.push(lt.ao[zt]);for(let zt=0;zt<lt.colors.length;zt+=3){const At=1+(lt.ao[zt/3]-1)*se;this.layoutColorArray.emplaceBack(lt.colors[zt]*At<<8|lt.colors[zt+1]*At,lt.colors[zt+2]*At<<8)}const $t=Le.vertexLength;for(let zt=0;zt<lt.indices.length;zt+=3)this.indexArray.emplaceBack($t+lt.indices[zt],$t+lt.indices[zt+1],$t+lt.indices[zt+2]);Le.vertexLength+=lt.positions.length/3,Le.primitiveLength+=lt.indices.length/3,(lt.buildingPart==="roof"||lt.buildingPart==="wall"||lt.buildingPart==="facade_glazing"||lt.buildingPart==="entrance")&&Je.push({part:lt.buildingPart,vertexOffset:pt,vertexLength:lt.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,We),this.buildingFeatures.push({feature:P,segment:Le,parts:Je,buildingBloom:yt});const dt=this.indexArray.length-gt,ze=[],Ze=[],wt=new ht(1/0,1/0),ft=new ht(-1/0,-1/0),Zt=this.groundEffect.vertexArray.length;for(const lt of De.modifiedPolygonRings){const pt=[],$t=new ht(1/0,1/0),zt=new ht(-1/0,-1/0);for(let At=0;At<lt.length;At+=2){const Ot=lt.length-At-2;$t.x=Math.min($t.x,lt[Ot]),$t.y=Math.min($t.y,lt[Ot+1]),zt.x=Math.max(zt.x,lt[Ot]),zt.y=Math.max(zt.y,lt[Ot+1]);const li=new ht(lt[Ot],lt[Ot+1]);pt.push(li),ze.push(li.x,li.y),Ze.push(li.clone())}wt.x=Math.min(wt.x,$t.x),wt.y=Math.min(wt.y,$t.y),ft.x=Math.max(ft.x,zt.x),ft.y=Math.max(ft.y,zt.y),this.groundEffect.addData(pt,[$t,zt],re)}const Ut=this.groundEffect.vertexArray.length-Zt;(Se.x<0||Me.x>Et||Se.y<0||Me.y>Et)&&this.featuresOnBorder.push({featureId:b.id,footprintIndex:this.footprints.length});{const lt=dp(ze,null,2),pt=new yv(Ze,lt,8,256);let $t=b.id;b.properties&&b.properties.hasOwnProperty("building_id")&&($t=b.properties.building_id),this.footprints.push({vertices:Ze,indices:lt,grid:pt,min:wt,max:ft,buildingId:$t,hiddenFlags:0,indicesOffset:gt,indicesLength:dt,bloomIndicesOffset:tt,bloomIndicesLength:ut,groundEffectVertexOffset:Zt,groundEffectVertexLength:Ut,segment:Le,height:We})}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,b,S,{},n.availableImages,l,n.brightness),this.groundEffect.addPaintPropertiesData(b,S,{},n.availableImages,l,n.brightness)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0])}update(e,n,l,u,f,p,y){this.programConfigurations.updatePaintArrays(e,n,f,l,u,p,y),this.groundEffect.update(e,n,f,l,u,p,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,MI.members),this.layoutNormalBuffer=e.createVertexBuffer(this.layoutNormalArray,iB.members),this.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(this.entranceBloom.layoutVertexArray,MI.members),this.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(this.entranceBloom.layoutAttenuationArray,nB.members),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.layoutNormalBuffer.destroy(),this.layoutColorBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segmentsBucket.destroy(),this.entranceBloom.layoutVertexBuffer.destroy(),this.entranceBloom.layoutColorBuffer.destroy(),this.entranceBloom.layoutAttenuationBuffer.destroy(),this.entranceBloom.indexBuffer.destroy(),this.entranceBloom.segmentsBucket.destroy())}updateFootprintHiddenFlags(e,n,l=!0){let u=!1;const f=l?n:0,p=0|(l?-1:~n);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const y of e){const b=this.footprints[y],S=b.hiddenFlags&p|f;b.hiddenFlags!==S&&(b.hiddenFlags=S,u=!0,this.groundEffect.updateHiddenByLandmarkRange(b.groundEffectVertexOffset,b.groundEffectVertexLength,b.hiddenFlags!==0))}return u&&(this.indexArrayForConflationUploaded=!1),u}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),!this.indexArrayForConflationUploaded&&this.indexArray.length!==0){this.indexArrayForConflation.resize(this.indexArray.length),this.indexArrayForConflation.uint16.set(this.indexArray.uint16),this.entranceBloom.indexArrayForConflation.resize(this.entranceBloom.indexArray.length),this.entranceBloom.indexArrayForConflation.uint16.set(this.entranceBloom.indexArray.uint16);for(const n of this.footprints){const l=n.indicesOffset+n.indicesLength;if(n.hiddenFlags!==0){for(let f=n.indicesOffset;f<l;f++)this.indexArrayForConflation.uint16[3*f+0]=0,this.indexArrayForConflation.uint16[3*f+1]=0,this.indexArrayForConflation.uint16[3*f+2]=0;const u=n.bloomIndicesOffset+n.bloomIndicesLength;for(let f=n.bloomIndicesOffset;f<u;f++)this.entranceBloom.indexArrayForConflation.uint16[3*f+0]=0,this.entranceBloom.indexArrayForConflation.uint16[3*f+1]=0,this.entranceBloom.indexArrayForConflation.uint16[3*f+2]=0}}this.indexBuffer?this.indexBuffer.updateData(this.indexArrayForConflation):this.indexBuffer=e.createIndexBuffer(this.indexArrayForConflation,!0),this.entranceBloom.indexBuffer?this.entranceBloom.indexBuffer.updateData(this.entranceBloom.indexArrayForConflation):this.entranceBloom.indexBuffer=e.createIndexBuffer(this.entranceBloom.indexArrayForConflation,!0),this.indexArrayForConflationUploaded=!0}}uploadUpdatedColorBuffer(e){this.layoutColorBuffer?this.layoutColorBuffer.updateData(this.layoutColorArray):this.layoutColorBuffer=e.createVertexBuffer(this.layoutColorArray,RI.members,!0),this.entranceBloom.layoutColorBuffer?this.entranceBloom.layoutColorBuffer.updateData(this.entranceBloom.layoutColorArray):this.entranceBloom.layoutColorBuffer=e.createVertexBuffer(this.entranceBloom.layoutColorArray,RI.members,!0)}evaluate(e){const n=e.paint.get("building-ambient-occlusion-intensity");for(const l of this.buildingFeatures){const u=l.feature;u.properties["building-part"]="roof";const f=e.paint.get("building-color").evaluate(u,{},this.canonical),p=e.paint.get("building-emissive-strength").evaluate(u,{},this.canonical);u.properties["building-part"]="wall";const y=e.paint.get("building-color").evaluate(u,{},this.canonical),b=e.paint.get("building-emissive-strength").evaluate(u,{},this.canonical);u.properties["building-part"]="window";const S=e.paint.get("building-color").evaluate(u,{},this.canonical),A=e.paint.get("building-emissive-strength").evaluate(u,{},this.canonical);u.properties["building-part"]="door";const P=e.paint.get("building-color").evaluate(u,{},this.canonical),M=e.paint.get("building-emissive-strength").evaluate(u,{},this.canonical);for(const L of l.parts){let U,H=f;L.part==="roof"?(H=f,U=p):L.part==="wall"?(H=y,U=b):L.part==="facade_glazing"?(H=S,U=A):L.part==="entrance"&&(H=P,U=M),U=ge(U,0,1);for(let K=0;K<L.vertexLength;K++){const se=L.vertexOffset+K,re=1+(this.layoutAOArray[se]-1)*n;this.layoutColorArray.emplace(se,H.r*re*255<<8|H.g*re*255,H.b*re*255<<8|255*U)}}const N=l.buildingBloom;if(N)for(let L=0;L<N.vertexLength;L++)this.bloomGeometry.layoutColorArray.emplace(N.vertexOffset+L,255*P.r<<8|255*P.g,255*P.b<<8|51*M)}}needsEvaluation(e,n){const l=e.transform.projectionOptions,u=e.style.getBrightness();return!(this.uploaded&&l.name===this.projection.name&&this.brightness===u||(this.projection=l,this.brightness=u,0))}updateReplacement(e,n,l){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const u=n.getReplacementRegionsForTile(e.toUnwrapped());if(vv(this.activeReplacements,u))return;this.activeReplacements=u;for(const p of this.footprints)p.hiddenFlags&=-2;const f=[];for(const p of this.activeReplacements){if(p.order<=FA)continue;const y=Math.max(1,Math.pow(2,p.footprintTileId.canonical.z-e.canonical.z));for(const b of this.footprints)b.min.x>p.max.x||b.max.x<p.min.x||b.min.y>p.max.y||b.max.y<p.min.y||(f.length=0,sB(b.vertices,0,b.vertices.length,p.footprintTileId.canonical,e.canonical,f),zb(p.footprint,f,b.indices,0,b.indices.length,0,-y)&&(b.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const p of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(p.groundEffectVertexOffset,p.groundEffectVertexLength,p.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getHeightAtTileCoord(e,n){let l=Number.NEGATIVE_INFINITY,u=!0;const f=4*(e+Et)*Et+(n+Et);if(this.footprintLookup.hasOwnProperty(f)){const y=this.footprintLookup[f];return y?{height:y.height,hidden:y.hiddenFlags!==0}:void 0}const p=new ht(e,n);for(const y of this.footprints)e>y.max.x||y.min.x>e||n>y.max.y||y.min.y>n||y.height<=l||Ob(p,y)&&(l=y.height,this.footprintLookup[f]=y,u=y.hiddenFlags!==0);if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:u};this.footprintLookup[f]=void 0}}function sB(r,e,n,l,u,f){const p=Math.pow(2,l.z-u.z);for(let y=0;y<n;y++){let b=r[y+e].x,S=r[y+e].y;b=(b+u.x*Et)*p-l.x*Et,S=(S+u.y*Et)*p-l.y*Et,f.push(new ht(b,S))}}let NI,LI;Bt(kI,"BuildingBucket",{omit:["layers"]});const oB=Qi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),aB=Qi([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:lB}=oB,cB=Qi([{name:"a_packed",components:3,type:"Float32"}]),{members:uB}=cB,dB=Qi([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:hB}=dB;class zI{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Vu({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const l=this.getKey(e,n);return this.positions[l]}trim(){const e=this.width,n=this.height=ei(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,l){const u=[];let f=e.length%2==1?-e[e.length-1]*l:0,p=e[0]*l,y=!0;u.push({left:f,right:p,isDash:y,zeroLength:e[0]===0});let b=e[0];for(let S=1;S<e.length;S++){y=!y;const A=e[S];f=b*l,b+=A,p=b*l,u.push({left:f,right:p,isDash:y,zeroLength:A===0})}return u}addRoundDash(e,n,l){const u=n/2;for(let f=-l;f<=l;f++){const p=this.width*(this.nextRow+l+f);let y=0,b=e[y];for(let S=0;S<this.width;S++){S/b.right>1&&(b=e[++y]);const A=Math.abs(S-b.left),P=Math.abs(S-b.right),M=Math.min(A,P);let N;const L=f/l*(u+1);if(b.isDash){const U=u-Math.abs(L);N=Math.sqrt(M*M+U*U)}else N=u-Math.sqrt(M*M+L*L);this.image.data[p+S]=Math.max(0,Math.min(255,N+128))}}}addRegularDash(e,n){for(let b=e.length-1;b>=0;--b){const S=e[b],A=e[b+1];S.zeroLength?e.splice(b,1):A&&A.isDash===S.isDash&&(A.left=S.left,e.splice(b,1))}const l=e[0],u=e[e.length-1];l.isDash===u.isDash&&(l.left=u.left-this.width,u.right=l.right+this.width);const f=this.width*this.nextRow;let p=0,y=e[p];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++p]);const S=Math.abs(b-y.left),A=Math.abs(b-y.right),P=Math.min(S,A);this.image.data[f+b]=Math.max(0,Math.min(255,(y.isDash?P:-P)+n+128))}}addDash(e,n){const l=this.getKey(e,n);if(this.positions[l])return this.positions[l];const u=n==="round",f=u?7:0,p=2*f+1;if(this.nextRow+p>this.height)return Ki("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let A=0;A<e.length;A++)e[A]<0&&(Ki("Negative value is found in line dasharray, replacing values with 0"),e[A]=0),y+=e[A];if(y!==0){const A=this.width/y,P=this.getDashRanges(e,this.width,A);u?this.addRoundDash(P,A,f):this.addRegularDash(P,n==="square"?.5*A:0)}const b=this.nextRow+f;this.nextRow+=p;const S={tl:[b,f],br:[y,0]};return this.positions[l]=S,S}}Bt(zI,"LineAtlas");const fB=je.types,pB=Math.cos(Math.PI/180*37.5),mB=Math.cos(Math.PI/180*5);class i2{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new tp,this.layoutVertexArray2=new ko,this.patternVertexArray=new ko,this.indexArray=new Qn,this.programConfigurations=new Lo(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new rr,this.maxLineLength=0,this.zOffsetVertexArray=new ko,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Et/64,this.worldview=e.worldview}updateFootprints(e,n){}populate(e,n,l,u){this.hasPattern=Mb("line",this.layers,this.pixelRatio,n);const f=this.layers[0].layout.get("line-sort-key");this.tileToMeter=xe(l);const p=this.layers[0].layout.get("line-elevation-reference");if(p==="hd-road-markup")this.elevationType="road";else{const M=this.layers[0].layout.get("line-z-offset"),N=M.isConstant()&&!M.constantOr(0);this.elevationType=p!=="sea"&&p!=="ground"&&N?"none":"offset",this.elevationType==="offset"&&p==="none"&&Ki(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const y=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&y!==void 0;const b=[];for(const{feature:M,id:N,index:L,sourceLayerIndex:U}of e){const H=this.layers[0]._featureFilter.needGeometry,K=qe(M,H);if(!this.layers[0]._featureFilter.filter(new Pn(this.zoom,{worldview:this.worldview}),K,l))continue;const se=f?f.evaluate(K,{},l):void 0,re={id:N,properties:M.properties,type:M.type,sourceLayerIndex:U,index:L,geometry:H?K.geometry:Ae(M,l,u),patterns:{},sortKey:se};b.push(re)}f&&b.sort((M,N)=>M.sortKey-N.sortKey);const{lineAtlas:S,featureIndex:A}=n,P=this.addConstantDashes(S);for(const M of b){const{geometry:N,index:L,sourceLayerIndex:U}=M;if(P&&this.addFeatureDashes(M,S),this.hasPattern){const H=Rb("line",this.layers,M,this.zoom,this.pixelRatio,n);this.patternFeatures.push(H)}else this.addFeature(M,N,L,l,S.positions,n.availableImages,n.brightness,n.elevationFeatures);A.insert(e[L].feature,N,L,U,this.index)}}addConstantDashes(e){let n=!1;for(const l of this.layers){const u=l.paint.get("line-dasharray").value,f=l.layout.get("line-cap").value;if(u.kind!=="constant"||f.kind!=="constant")n=!0;else{const p=f.value,y=u.value;if(!y)continue;e.addDash(y,p)}}return n}addFeatureDashes(e,n){const l=this.zoom;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,p=u.layout.get("line-cap").value;if(f.kind==="constant"&&p.kind==="constant")continue;let y,b;if(f.kind==="constant"){if(y=f.value,!y)continue}else y=f.evaluate({zoom:l},e);b=p.kind==="constant"?p.value:p.evaluate({zoom:l},e),n.addDash(y,b),e.patterns[u.id]=[n.getKey(y,b)]}}update(e,n,l,u,f,p,y,b){this.programConfigurations.updatePaintArrays(e,n,f,l,u,p,y,b)}addFeatures(e,n,l,u,f,p){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,n,l,u,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,uB)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,hB)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,aB.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,lB),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,l,u,f,p,y,b){const S=this.layers[0].layout,A=S.get("line-join").evaluate(e,{}),P=S.get("line-cap").evaluate(e,{}),M=S.get("line-miter-limit"),N=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=S.get("line-z-offset").value;const L=this.layers[0].paint.get("line-width").value;if(L.kind!=="constant"&&L.isLineProgressConstant===!1&&(this.variableWidthValue=L),this.elevationType==="road"){const U=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,n,u,b,A,P,M,N)){const[H,K]=this.clipRuntimeLinesToTile(n,1);for(let se=0;se<H.length;se++){const re=H[se],le=K[se],Ee={progress:{min:le.progress.min,max:le.progress.max},nextDir:this.computeSegNextDir(le,re),prevDir:this.computeSegPrevDir(le,re)};this.addLine(re,e,u,A,P,M,N,Ee)}this.fillNonElevatedRoadSegment(U)}}else for(const U of n)this.addLine(U,e,u,A,P,M,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,f,p,u,y,void 0,this.worldview)}computeSegNextDir(e,n){return e.nextPoint.sub(n.at(-2)).unit()}computeSegPrevDir(e,n){return n[1].sub(e.prevPoint).unit()}clipLinesToTile(e,n){return Sv(e,-n,-n,Et+n,Et+n)}clipRuntimeLinesToTile(e,n){const l=[];return[Sv(e,-n,-n,Et+n,Et+n,l),l]}addElevatedRoadFeature(e,n,l,u,f,p,y,b){const S=[],A=sr.getElevationFeature(e,u);if(A){const P=this.clipLinesToTile(n,1),M=this.prepareElevatedLines(P,A,l);for(const N of M)S.push({geometry:N,elevation:A,elevationTileID:l,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(S.length===0)return!1;for(const P of S){const M=this.layoutVertexArray.length;this.addLine(P.geometry,e,l,f,p,y,b);const N=new on(l,P.elevationTileID);if(P.elevation)for(let L=M;L<this.layoutVertexArray.length;L++){const U=new ht(this.layoutVertexArray.int16[6*L]>>1,this.layoutVertexArray.int16[6*L+1]>>1),H=N.pointElevation(U,P.elevation,.05);this.updateHeightRange(H),this.zOffsetVertexArray.emplaceBack(H,0,0)}else this.fillNonElevatedRoadSegment(M)}return!0}prepareElevatedLines(e,n,l){if(n.constantHeight!=null)return e;const u=[],f=1/xe(l);for(const p of e)D4(p,new An(n,f),0,u);return u}fillNonElevatedRoadSegment(e){for(let n=e;n<this.layoutVertexArray.length;n++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,n,l,u,f,p,y,b){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const S=u==="none";this.patternJoinNone=this.hasPattern&&S,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const A=b&&b.progress.min>0,P=b&&b.progress.max<1;if(this.lineClips){let Me={min:this.lineClips.start,max:this.lineClips.end},De=1;if(b){const Je=this.lineClips.end-this.lineClips.start;Me=function(yt,tt,ut){return{min:jd(yt.min,tt,ut),max:jd(yt.max,tt,ut)}}(b.progress,{min:0,max:1},Me),Je>0&&(De=(Me.max-Me.min)/Je)}const Xe=+n.properties.mapbox_clip_feature_len,Le=+n.properties.mapbox_clip_seg_len;if(Number.isNaN(Xe)||Number.isNaN(Le)){for(let yt=0;yt<e.length-1;yt++)this.totalDistance+=e[yt].dist(e[yt+1]);const Je=this.totalDistance/(Me.max-Me.min);this.totalFeatureLength=Number.isFinite(Je)?Je:0,this.lineClips.start=Me.min,this.lineClips.end=Me.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Xe,this.distance=Le*De,this.lineClips.start=Me.min,this.lineClips.end=Me.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const M=fB[n.type]==="Polygon";let N=e.length;for(;N>=2&&e[N-1].equals(e[N-2]);)N--;let L=0;for(;L<N-1&&e[L].equals(e[L+1]);)L++;if(N<(M?3:2))return;u==="bevel"&&(p=1.05);const U=this.segments.prepareSegment(10*N,this.layoutVertexArray,this.indexArray);let H,K,se,re,le,Ee,we,Se;b&&b.prevDir&&(Ee=b.prevDir.perp()),b&&b.nextDir&&(we=b.nextDir.perp()),this.e1=this.e2=-1,M&&(H=e[N-2],le=e[L].sub(H)._unit()._perp());for(let Me=L;Me<N;Me++){if(se=Me===N-1?M?e[L+1]:void 0:e[Me+1],se&&e[Me].equals(se))continue;le&&(re=le),H&&(K=H),H=e[Me],Se=this.evaluateLineProgressFeatures(K?K.dist(H):0),le=se?se.sub(H)._unit()._perp():re,re=re||le;const De=K&&se;let Xe=De?u:M||S?"butt":f;const Le=re.x*le.x+re.y*le.y;if(S){const ze=function(Ze){if(Ze.patternJoinNone){const wt=Ze.segmentPoints.length/2,ft=Ze.lineSoFar-Ze.segmentStart;for(let Zt=0;Zt<wt;++Zt){const Ut=Ze.segmentPoints[2*Zt+1],lt=Math.round(Ze.segmentPoints[2*Zt])+.5+.25*Ut;Ze.patternVertexArray.emplaceBack(lt,ft,Ze.segmentStart),Ze.patternVertexArray.emplaceBack(lt,ft,Ze.segmentStart)}Ze.segmentPoints.length=0}Ze.e1=Ze.e2=-1};if(De&&Le<mB){this.updateDistance(K,H),this.addCurrentVertex(H,re,1,1,U,Se),ze(this),this.addCurrentVertex(H,le,-1,-1,U,Se);continue}if(K){if(!se){this.updateDistance(K,H),this.addCurrentVertex(H,re,1,1,U,Se),ze(this);continue}Xe="miter"}}let Je=re.add(le);Je.x===0&&Je.y===0||Je._unit();const yt=Je.x*le.x+Je.y*le.y,tt=yt!==0?1/yt:1/0,ut=2*Math.sqrt(2-2*yt),gt=yt<pB&&K&&se,We=re.x*le.y-re.y*le.x>0,dt=this.overscaling<=16?15*Et/(512*this.overscaling):0;if(De&&Xe==="round"){if(tt<y)Xe="miter";else if(tt<=2){const ze=n2(H,-10,Et+10);Xe=this.elevationType==="offset"&&(ze||this.hasCrossSlope)?"miter":"fakeround"}}if(Xe==="miter"&&tt>p&&(Xe="bevel"),Xe==="bevel"&&(tt>2&&(Xe="flipbevel"),tt<p&&(Xe="miter")),K&&!(Xe==="miter"&&gt)&&this.updateDistance(K,H),Xe==="miter")if(gt){const ze=H.dist(K);if(ze>2*dt){const wt=H.sub(H.sub(K)._mult(dt/ze)._round());this.updateDistance(K,wt),this.addCurrentVertex(wt,re,0,0,U,Se),K=wt}this.updateDistance(K,H),Je._mult(tt),this.addCurrentVertex(H,Je,0,0,U,Se);const Ze=H.dist(se);if(Ze>2*dt){const wt=H.add(se.sub(H)._mult(dt/Ze)._round());this.updateDistance(H,wt),this.addCurrentVertex(wt,le,0,0,U,Se),H=wt}}else Je._mult(tt),this.addCurrentVertex(H,Je,0,0,U,Se);else if(Xe==="flipbevel"){if(tt>100)Je=le.mult(-1);else{const ze=tt*re.add(le).mag()/re.sub(le).mag();Je._perp()._mult(ze*(We?-1:1))}this.addCurrentVertex(H,Je,0,0,U,Se),this.addCurrentVertex(H,Je.mult(-1),0,0,U,Se)}else if(Xe==="bevel"||Xe==="fakeround"){Se!=null&&K&&this.addCurrentVertex(H,we||re,-1,-1,U,Se);const ze=H.dist(K)<=2*dt&&Xe!=="bevel",Ze=Je.mult(We?1:-1);Ze._mult(tt);const wt=le.mult(We?-1:1),ft=re.mult(We?-1:1),Zt=this.evaluateLineProgressFeatures(this.distance);if(Se==null&&(this.addHalfVertex(H,Ze.x,Ze.y,!1,!We,0,U,Zt),ze||this.addHalfVertex(H,Ze.x+2*ft.x,Ze.y+2*ft.y,!1,We,0,U,Zt)),Xe==="fakeround"){const Ut=Math.round(180*ut/Math.PI/20);this.addHalfVertex(H,ft.x,ft.y,!1,We,0,U,Zt);for(let lt=0;lt<Ut;lt++){let pt=lt/Ut;if(pt!==.5){const zt=pt-.5;pt+=pt*zt*(pt-1)*((1.0904+Le*(Le*(3.55645-1.43519*Le)-3.2452))*zt*zt+(.848013+Le*(.215638*Le-1.06021)))}const $t=wt.sub(ft)._mult(pt)._add(ft)._unit();this.addHalfVertex(H,$t.x,$t.y,!1,We,0,U,Zt)}this.addHalfVertex(H,wt.x,wt.y,!1,We,0,U,Zt)}ze||Se!=null||this.addHalfVertex(H,Ze.x+2*wt.x,Ze.y+2*wt.y,!1,We,0,U,Zt),Se!=null&&se&&this.addCurrentVertex(H,Ee||le,1,1,U,Se)}else if(Xe==="butt")this.addCurrentVertex(H,Je,0,0,U,Se);else if(Xe==="square"){if(!K){const ze=A?0:-1;this.addCurrentVertex(H,Je,ze,ze,U,Se)}if(this.addCurrentVertex(H,Je,0,0,U,Se),K){const ze=P?0:1;this.addCurrentVertex(H,Je,ze,ze,U,Se)}}else if(Xe==="round"){if(K){const ze=!De&&we?we:re;this.addCurrentVertex(H,ze,0,0,U,Se),!De&&P||this.addCurrentVertex(H,ze,1,1,U,Se,!0)}if(se){const ze=!De&&Ee?Ee:le;!De&&A||this.addCurrentVertex(H,ze,-1,-1,U,Se,!0),this.addCurrentVertex(H,ze,0,0,U,Se)}}}}addVerticesTo(e,n,l,u,f,p,y,b,S,A){const P=(n.w-e.w)/this.tessellationStep|0;let M=0;const N=this.scaledDistance;if(P>1){this.lineSoFar=e.w;const U=(n.x-e.x)/P,H=(n.y-e.y)/P,K=(n.z-e.z)/P,se=(n.w-e.w)/P;for(let re=1;re<P;++re){e.x+=U,e.y+=H,e.z+=K,this.lineSoFar+=se,M+=se;const le=this.evaluateLineProgressFeatures(this.prevDistance+M);this.scaledDistance=(this.prevDistance+M)/this.totalDistance,this.addHalfVertex(e,l,u,A,!1,y,S,le),this.addHalfVertex(e,f,p,A,!0,-b,S,le)}}this.lineSoFar=n.w,this.scaledDistance=N;const L=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(n,l,u,A,!1,y,S,L),this.addHalfVertex(n,f,p,A,!0,-b,S,L)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Ki(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let n=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(n=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:n}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:n}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:n}}addCurrentVertex(e,n,l,u,f,p,y=!1){const b=n.x+n.y*l,S=n.y-n.x*l,A=n.y*u-n.x,P=-n.y-n.x*u;if(p!=null){const M=this.elevationType==="offset",N=-10,L=Et+10,U=p.zOffset,H=new sI(e.x,e.y,U,this.lineSoFar),K=!!M&&n2(e,N,L),se=this.lineSoFar,re=this.distance;if(this.currentVertex)if(K){const le=this.currentVertexIsOutside,Ee=this.currentVertex,we=new sI(e.x,e.y,U,this.lineSoFar);if(aI(Ee,we,N,L),!n2(we,N,L)){if(le){this.e1=this.e2=-1,this.distance-=Ee.dist(H),this.lineSoFar=Ee.w;const Se=this.evaluateLineProgressFeatures(Ee.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Ee,b,S,y,!1,l,f,Se),this.addHalfVertex(Ee,A,P,y,!0,-u,f,Se),this.prevDistance=this.distance}this.distance=this.prevDistance+Ee.dist(we),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Ee,we,b,S,A,P,l,u,f,y),this.distance=re,this.scaledDistance=this.distance/this.totalDistance}}else{const le=this.currentVertex;if(this.currentVertexIsOutside){aI(le,H,N,L),this.e1=this.e2=-1,this.distance-=le.dist(H),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=le.w;const Ee=this.evaluateLineProgressFeatures(le.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(le,b,S,y,!1,l,f,Ee),this.addHalfVertex(le,A,P,y,!0,-u,f,Ee),this.prevDistance=this.distance,this.distance=re,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(le,H,b,S,A,P,l,u,f,y)}else K||(this.addHalfVertex(e,b,S,y,!1,l,f,p),this.addHalfVertex(e,A,P,y,!0,-u,f,p));this.currentVertex=H,this.currentVertexIsOutside=K,this.lineSoFar=se}else this.addHalfVertex(e,b,S,y,!1,l,f,p),this.addHalfVertex(e,A,P,y,!0,-u,f,p)}addHalfVertex({x:e,y:n},l,u,f,p,y,b,S){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),p||this.segmentPoints.push(this.lineSoFar-this.segmentStart,y)),this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(n<<1)+(p?1:0),Math.round(63*l)+128,Math.round(63*u)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const P=si(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,P)}const A=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),b.primitiveLength++),p?this.e2=A:this.e1=A,S!=null&&this.zOffsetVertexArray.emplaceBack(S.zOffset,S.variableWidth,S.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,n){this.prevDistance=this.distance,this.distance+=e.dist(n),this.updateScaledDistance()}}function n2(r,e,n){return r.x<e||r.x>n||r.y<e||r.y>n}let OI,FI;function jI(r,e,n){return e*(Et/(r.tileSize*Math.pow(2,n-r.tileID.overscaledZ)))}Bt(i2,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const BI=(r,e,n)=>(1-n)*r+n*e;function VI(r,e){return 1/jI(r,1,e.tileZoom)}function UI(r,e,n,l){return r.translatePosMatrix(l||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const GI=r=>{const e=[];$I(r)&&e.push("RENDER_LINE_DASH"),r.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const n=r.paint.get("line-trim-offset");n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),r.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const l=r.layout.get("line-join").constantOr("miter")==="none",u=!!r.paint.get("line-pattern").constantOr(1);return l&&u&&e.push("LINE_JOIN_NONE"),e};function $I(r){const e=r.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let r2;const HI=()=>r2||(r2={layout:OI||(OI=new xr({"line-cap":new kt(Ne.layout_line["line-cap"]),"line-join":new kt(Ne.layout_line["line-join"]),"line-miter-limit":new xt(Ne.layout_line["line-miter-limit"]),"line-round-limit":new xt(Ne.layout_line["line-round-limit"]),"line-sort-key":new kt(Ne.layout_line["line-sort-key"]),"line-z-offset":new kt(Ne.layout_line["line-z-offset"]),"line-elevation-reference":new xt(Ne.layout_line["line-elevation-reference"]),"line-cross-slope":new xt(Ne.layout_line["line-cross-slope"]),visibility:new xt(Ne.layout_line.visibility),"line-width-unit":new xt(Ne.layout_line["line-width-unit"])})),paint:FI||(FI=new xr({"line-opacity":new kt(Ne.paint_line["line-opacity"]),"line-color":new kt(Ne.paint_line["line-color"]),"line-translate":new xt(Ne.paint_line["line-translate"]),"line-translate-anchor":new xt(Ne.paint_line["line-translate-anchor"]),"line-width":new kt(Ne.paint_line["line-width"]),"line-gap-width":new kt(Ne.paint_line["line-gap-width"]),"line-offset":new kt(Ne.paint_line["line-offset"]),"line-blur":new kt(Ne.paint_line["line-blur"]),"line-dasharray":new kt(Ne.paint_line["line-dasharray"]),"line-pattern":new kt(Ne.paint_line["line-pattern"]),"line-pattern-cross-fade":new xt(Ne.paint_line["line-pattern-cross-fade"]),"line-gradient":new Tu(Ne.paint_line["line-gradient"]),"line-trim-offset":new xt(Ne.paint_line["line-trim-offset"]),"line-trim-fade-range":new xt(Ne.paint_line["line-trim-fade-range"]),"line-trim-color":new xt(Ne.paint_line["line-trim-color"]),"line-emissive-strength":new xt(Ne.paint_line["line-emissive-strength"]),"line-border-width":new kt(Ne.paint_line["line-border-width"]),"line-border-color":new kt(Ne.paint_line["line-border-color"]),"line-occlusion-opacity":new xt(Ne.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},r2);class gB extends kt{possiblyEvaluate(e,n){return n=new Pn(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,transition:n.transition,worldview:n.worldview}),super.possiblyEvaluate(e,n)}evaluate(e,n,l,u){return n=Ve({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,l,u)}}let h_;function qI(r,e){return e>0?e+2*r:r}const _B=Qi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),yB=Qi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),xB=Qi([{name:"a_projected_pos",components:4,type:"Float32"}],4);Qi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const vB=Qi([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),wB=Qi([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),bB=Qi([{name:"a_texb",components:2,type:"Uint16"}]),SB=Qi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),TB=Qi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Qi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const WI=Qi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),EB=Qi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Qi([{name:"triangle",components:3,type:"Uint16"}]),Qi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Qi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Qi([{type:"Float32",name:"offsetX"}]),Qi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var hs=24;function CB(r,e,n){return r.sections.forEach(l=>{l.text=function(u,f,p){const y=f.layout.get("text-transform").evaluate(p,{});return y==="uppercase"?u=u.toLocaleUpperCase():y==="lowercase"&&(u=u.toLocaleLowerCase()),Na.applyArabicShaping&&(u=Na.applyArabicShaping(u)),u}(l.text,e,n)}),r}const f_={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function AB(r){return r==="︶"||r==="﹈"||r==="︸"||r==="﹄"||r==="﹂"||r==="︾"||r==="︼"||r==="︺"||r==="︘"||r==="﹀"||r==="︐"||r==="︓"||r==="︔"||r==="｀"||r==="￣"||r==="︑"||r==="︒"}function IB(r){return r==="︵"||r==="﹇"||r==="︷"||r==="﹃"||r==="﹁"||r==="︽"||r==="︻"||r==="︹"||r==="︗"||r==="︿"}const s2=4294967296,ZI=1/s2,XI=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let Rv=class{constructor(r=new Uint8Array(16)){this.buf=ArrayBuffer.isView(r)?r:new Uint8Array(r),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(r,e,n=this.length){for(;this.pos<n;){const l=this.readVarint(),u=l>>3,f=this.pos;this.type=7&l,r(u,e,this),this.pos===f&&this.skip(l)}return e}readMessage(r,e){return this.readFields(r,e,this.readVarint()+this.pos)}readFixed32(){const r=this.dataView.getUint32(this.pos,!0);return this.pos+=4,r}readSFixed32(){const r=this.dataView.getInt32(this.pos,!0);return this.pos+=4,r}readFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*s2;return this.pos+=8,r}readSFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*s2;return this.pos+=8,r}readFloat(){const r=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,r}readDouble(){const r=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,r}readVarint(r){const e=this.buf;let n,l;return l=e[this.pos++],n=127&l,l<128?n:(l=e[this.pos++],n|=(127&l)<<7,l<128?n:(l=e[this.pos++],n|=(127&l)<<14,l<128?n:(l=e[this.pos++],n|=(127&l)<<21,l<128?n:(l=e[this.pos],n|=(15&l)<<28,function(u,f,p){const y=p.buf;let b,S;if(S=y[p.pos++],b=(112&S)>>4,S<128||(S=y[p.pos++],b|=(127&S)<<3,S<128)||(S=y[p.pos++],b|=(127&S)<<10,S<128)||(S=y[p.pos++],b|=(127&S)<<17,S<128)||(S=y[p.pos++],b|=(127&S)<<24,S<128)||(S=y[p.pos++],b|=(1&S)<<31,S<128))return yp(u,b,f);throw new Error("Expected varint not more than 10 bytes")}(n,r,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const r=this.readVarint();return r%2==1?(r+1)/-2:r/2}readBoolean(){return!!this.readVarint()}readString(){const r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&XI?XI.decode(this.buf.subarray(e,r)):function(n,l,u){let f="",p=l;for(;p<u;){const y=n[p];let b,S,A,P=null,M=y>239?4:y>223?3:y>191?2:1;if(p+M>u)break;M===1?y<128&&(P=y):M===2?(b=n[p+1],(192&b)==128&&(P=(31&y)<<6|63&b,P<=127&&(P=null))):M===3?(b=n[p+1],S=n[p+2],(192&b)==128&&(192&S)==128&&(P=(15&y)<<12|(63&b)<<6|63&S,(P<=2047||P>=55296&&P<=57343)&&(P=null))):M===4&&(b=n[p+1],S=n[p+2],A=n[p+3],(192&b)==128&&(192&S)==128&&(192&A)==128&&(P=(15&y)<<18|(63&b)<<12|(63&S)<<6|63&A,(P<=65535||P>=1114112)&&(P=null))),P===null?(P=65533,M=1):P>65535&&(P-=65536,f+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),f+=String.fromCharCode(P),p+=M}return f}(this.buf,e,r)}readBytes(){const r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e}readPackedVarint(r=[],e){const n=this.readPackedEnd();for(;this.pos<n;)r.push(this.readVarint(e));return r}readPackedSVarint(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSVarint());return r}readPackedBoolean(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readBoolean());return r}readPackedFloat(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFloat());return r}readPackedDouble(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readDouble());return r}readPackedFixed32(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFixed32());return r}readPackedSFixed32(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSFixed32());return r}readPackedFixed64(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFixed64());return r}readPackedSFixed64(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSFixed64());return r}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(r){const e=7&r;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(r,e){this.writeVarint(r<<3|e)}realloc(r){let e=this.length||16;for(;e<this.pos+r;)e*=2;if(e!==this.length){const n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.dataView=new DataView(n.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeSFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*ZI),!0),this.pos+=8}writeSFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*ZI),!0),this.pos+=8}writeVarint(r){(r=+r||0)>268435455||r<0?function(e,n){let l,u;if(e>=0?(l=e%4294967296|0,u=e/4294967296|0):(l=~(-e%4294967296),u=~(-e/4294967296),4294967295^l?l=l+1|0:(l=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(f,p,y){y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,y.buf[y.pos]=127&(f>>>=7)}(l,0,n),function(f,p){const y=(7&f)<<4;p.buf[p.pos++]|=y|((f>>>=3)?128:0),f&&(p.buf[p.pos++]=127&f|((f>>>=7)?128:0),f&&(p.buf[p.pos++]=127&f|((f>>>=7)?128:0),f&&(p.buf[p.pos++]=127&f|((f>>>=7)?128:0),f&&(p.buf[p.pos++]=127&f|((f>>>=7)?128:0),f&&(p.buf[p.pos++]=127&f)))))}(u,n)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))}writeSVarint(r){this.writeVarint(r<0?2*-r-1:2*r)}writeBoolean(r){this.writeVarint(+r)}writeString(r){r=String(r),this.realloc(4*r.length),this.pos++;const e=this.pos;this.pos=function(l,u,f){for(let p,y,b=0;b<u.length;b++){if(p=u.charCodeAt(b),p>55295&&p<57344){if(!y){p>56319||b+1===u.length?(l[f++]=239,l[f++]=191,l[f++]=189):y=p;continue}if(p<56320){l[f++]=239,l[f++]=191,l[f++]=189,y=p;continue}p=y-55296<<10|p-56320|65536,y=null}else y&&(l[f++]=239,l[f++]=191,l[f++]=189,y=null);p<128?l[f++]=p:(p<2048?l[f++]=p>>6|192:(p<65536?l[f++]=p>>12|224:(l[f++]=p>>18|240,l[f++]=p>>12&63|128),l[f++]=p>>6&63|128),l[f++]=63&p|128)}return f}(this.buf,r,this.pos);const n=this.pos-e;n>=128&&KI(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n}writeFloat(r){this.realloc(4),this.dataView.setFloat32(this.pos,r,!0),this.pos+=4}writeDouble(r){this.realloc(8),this.dataView.setFloat64(this.pos,r,!0),this.pos+=8}writeBytes(r){const e=r.length;this.writeVarint(e),this.realloc(e);for(let n=0;n<e;n++)this.buf[this.pos++]=r[n]}writeRawMessage(r,e){this.pos++;const n=this.pos;r(e,this);const l=this.pos-n;l>=128&&KI(n,l,this),this.pos=n-1,this.writeVarint(l),this.pos+=l}writeMessage(r,e,n){this.writeTag(r,2),this.writeRawMessage(e,n)}writePackedVarint(r,e){e.length&&this.writeMessage(r,PB,e)}writePackedSVarint(r,e){e.length&&this.writeMessage(r,MB,e)}writePackedBoolean(r,e){e.length&&this.writeMessage(r,kB,e)}writePackedFloat(r,e){e.length&&this.writeMessage(r,RB,e)}writePackedDouble(r,e){e.length&&this.writeMessage(r,DB,e)}writePackedFixed32(r,e){e.length&&this.writeMessage(r,NB,e)}writePackedSFixed32(r,e){e.length&&this.writeMessage(r,LB,e)}writePackedFixed64(r,e){e.length&&this.writeMessage(r,zB,e)}writePackedSFixed64(r,e){e.length&&this.writeMessage(r,OB,e)}writeBytesField(r,e){this.writeTag(r,2),this.writeBytes(e)}writeFixed32Field(r,e){this.writeTag(r,5),this.writeFixed32(e)}writeSFixed32Field(r,e){this.writeTag(r,5),this.writeSFixed32(e)}writeFixed64Field(r,e){this.writeTag(r,1),this.writeFixed64(e)}writeSFixed64Field(r,e){this.writeTag(r,1),this.writeSFixed64(e)}writeVarintField(r,e){this.writeTag(r,0),this.writeVarint(e)}writeSVarintField(r,e){this.writeTag(r,0),this.writeSVarint(e)}writeStringField(r,e){this.writeTag(r,2),this.writeString(e)}writeFloatField(r,e){this.writeTag(r,5),this.writeFloat(e)}writeDoubleField(r,e){this.writeTag(r,1),this.writeDouble(e)}writeBooleanField(r,e){this.writeVarintField(r,+e)}};function yp(r,e,n){return n?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function KI(r,e,n){const l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(l);for(let u=n.pos-1;u>=r;u--)n.buf[u+l]=n.buf[u]}function PB(r,e){for(let n=0;n<r.length;n++)e.writeVarint(r[n])}function MB(r,e){for(let n=0;n<r.length;n++)e.writeSVarint(r[n])}function RB(r,e){for(let n=0;n<r.length;n++)e.writeFloat(r[n])}function DB(r,e){for(let n=0;n<r.length;n++)e.writeDouble(r[n])}function kB(r,e){for(let n=0;n<r.length;n++)e.writeBoolean(r[n])}function NB(r,e){for(let n=0;n<r.length;n++)e.writeFixed32(r[n])}function LB(r,e){for(let n=0;n<r.length;n++)e.writeSFixed32(r[n])}function zB(r,e){for(let n=0;n<r.length;n++)e.writeFixed64(r[n])}function OB(r,e){for(let n=0;n<r.length;n++)e.writeSFixed64(r[n])}const o2=3;function FB(r,e,n){e.glyphs=[],r===1&&n.readMessage(jB,e)}function jB(r,e,n){if(r===3){const{id:l,bitmap:u,width:f,height:p,left:y,top:b,advance:S}=n.readMessage(BB,{});e.glyphs.push({id:l,bitmap:new Vu({width:f+2*o2,height:p+2*o2},u),metrics:{width:f,height:p,left:y,top:b,advance:S}})}else r===4?e.ascender=n.readSVarint():r===5&&(e.descender=n.readSVarint())}function BB(r,e,n){r===1?e.id=n.readVarint():r===2?e.bitmap=n.readBytes():r===3?e.width=n.readVarint():r===4?e.height=n.readVarint():r===5?e.left=n.readSVarint():r===6?e.top=n.readSVarint():r===7&&(e.advance=n.readVarint())}const YI=o2,Vo={horizontal:1,vertical:2,horizontalOnly:3};class p_{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,n){const l=new p_;return l.scale=e||1,l.fontStack=n,l}static forImage(e){const n=new p_;return n.image=e,n}}class xp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n,l){const u=new xp;for(let f=0;f<e.sections.length;f++){const p=e.sections[f];p.image?u.addImageSection(p,l):u.addTextSection(p,n)}return u}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,l){let u="";for(let f=0;f<n.length;f++){const p=n.charCodeAt(f+1)||null,y=n.charCodeAt(f-1)||null;u+=!l&&(p&&Zf(p)&&!f_[n[f+1]]||y&&Zf(y)&&!f_[n[f-1]])||!f_[n[f]]?n[f]:f_[n[f]]}return u}(this.text,e)}trim(){let e=0;for(let l=0;l<this.text.length&&Dv[this.text.charCodeAt(l)];l++)e++;let n=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&Dv[this.text.charCodeAt(l)];l--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const l=new xp;return l.text=this.text.substring(e,n),l.sectionIndex=this.sectionIndex.slice(e,n),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(p_.forText(e.scale,e.fontStack||n));const l=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(l)}addImageSection(e,n){const l=e.image?e.image.getPrimary():null;if(!l)return void Ki("Can't add FormattedSection with an empty image.");l.scaleSelf(n);const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCodePoint(u),this.sections.push(p_.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Ki("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function a2(r,e,n,l,u,f,p,y,b,S,A,P,M,N,L,U=1){const H=xp.fromFeature(r,u,U);P===Vo.vertical&&H.verticalizePunctuation(M);let K=[];const se=function(Se,Me,De,Xe,Le,Je){if(!Se)return[];const yt=[],tt=function(dt,ze,Ze,wt,ft,Zt){let Ut=0;for(let lt=0;lt<dt.length();lt++){const pt=dt.getSection(lt);Ut+=JI(dt.getCodePoint(lt),pt,wt,ft,ze,Zt)}return Ut/Math.max(1,Math.ceil(Ut/Ze))}(Se,Me,De,Xe,Le,Je),ut=Se.text.indexOf("​")>=0;let gt=0;for(let dt=0;dt<Se.length();dt++){const ze=Se.getSection(dt),Ze=Se.getCodePoint(dt);if(Dv[Ze]||(gt+=JI(Ze,ze,Xe,Le,Me,Je)),dt<Se.length()-1){const wt=!((We=Ze)<11904||!(ci["Bopomofo Extended"](We)||ci.Bopomofo(We)||ci["CJK Compatibility Forms"](We)||ci["CJK Compatibility Ideographs"](We)||ci["CJK Compatibility"](We)||ci["CJK Radicals Supplement"](We)||ci["CJK Strokes"](We)||ci["CJK Symbols and Punctuation"](We)||ci["CJK Unified Ideographs Extension A"](We)||ci["CJK Unified Ideographs"](We)||ci["Enclosed CJK Letters and Months"](We)||ci["Halfwidth and Fullwidth Forms"](We)||ci.Hiragana(We)||ci["Ideographic Description Characters"](We)||ci["Kangxi Radicals"](We)||ci["Katakana Phonetic Extensions"](We)||ci.Katakana(We)||ci["Vertical Forms"](We)||ci["Yi Radicals"](We)||ci["Yi Syllables"](We)));(VB[Ze]||wt||ze.image)&&yt.push(eP(dt+1,gt,tt,yt,UB(Ze,Se.getCodePoint(dt+1),wt&&ut),!1))}}var We;return tP(eP(Se.length(),gt,tt,yt,0,!0))}(H,S,f,e,l,N),{processBidirectionalText:re,processStyledBidirectionalText:le}=Na;if(re&&H.sections.length===1){const Se=re(H.toString(),se);for(const Me of Se){const De=new xp;De.text=Me,De.sections=H.sections;for(let Xe=0;Xe<Me.length;Xe++)De.sectionIndex.push(0);K.push(De)}}else if(le){const Se=le(H.text,H.sectionIndex,se);for(const Me of Se){const De=new xp;De.text=Me[0],De.sectionIndex=Me[1],De.sections=H.sections,K.push(De)}}else K=function(Se,Me){const De=[],Xe=Se.text;let Le=0;for(const Je of Me)De.push(Se.substring(Le,Je)),Le=Je;return Le<Xe.length&&De.push(Se.substring(Le,Xe.length)),De}(H,se);const Ee=[],we={positionedLines:Ee,text:H.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Se,Me,De,Xe,Le,Je,yt,tt,ut,gt,We,dt){let ze=0,Ze=0,wt=0;const ft=tt==="right"?1:tt==="left"?0:.5;let Zt=!1;for(const At of Le){const Ot=At.getSections();for(const li of Ot){if(li.image)continue;const vi=Me[li.fontStack];if(vi&&(Zt=vi.ascender!==void 0&&vi.descender!==void 0,!Zt))break}if(!Zt)break}let Ut=0;for(const At of Le){At.trim();const Ot=At.getMaxScale(),li=(Ot-1)*hs,vi={positionedGlyphs:[],lineOffset:0};Se.positionedLines[Ut]=vi;const Di=vi.positionedGlyphs;let Ii=0;if(!At.length()){Ze+=Je,++Ut;continue}let Yi=0,Bi=0;for(let he=0;he<At.length();he++){const fe=At.getSection(he),He=At.getSectionIndex(he),bt=At.getCodePoint(he);let Mt=fe.scale,It=null,Gt=null,mi=null,qi=hs,Wi=0,Li=ut;Li===Vo.vertical&&((lt=bt)===12312||lt===12313||lt===12316||lt===12540||lt===12448)&&(Li=Vo.horizontal);const Mn=!(Li===Vo.horizontal||!We&&!Wf(bt)||We&&(Dv[bt]||Ux(bt)));if(fe.image){const ur=Xe.get(fe.image.toString());if(!ur)continue;mi=fe.image,Se.iconsInText=Se.iconsInText||!0,Gt=ur.paddedRect;const ki=ur.displaySize;Mt=Mt*hs/dt,It={width:ki[0],height:ki[1],left:0,top:-YI,advance:Mn?ki[1]:ki[0],localGlyph:!1},Wi=Zt?-It.height*Mt:Ot*hs-17-ki[1]*Mt,qi=It.advance;const Kn=(Mn?ki[0]:ki[1])*Mt-hs*Ot;Kn>0&&Kn>Ii&&(Ii=Kn)}else{const ur=De[fe.fontStack];if(!ur)continue;ur[bt]&&(Gt=ur[bt]);const ki=Me[fe.fontStack];if(!ki)continue;const Kn=ki.glyphs[bt];if(!Kn)continue;if(It=Kn.metrics,qi=bt!==8203?hs:0,Zt){const Vn=ki.ascender!==void 0?Math.abs(ki.ascender):0,Tn=ki.descender!==void 0?Math.abs(ki.descender):0,or=(Vn+Tn)*Mt;Yi<or&&(Yi=or,Bi=(Vn-Tn)/2*Mt),Wi=-Vn*Mt}else Wi=(Ot-Mt)*hs-17}Mn?(Se.verticalizable=!0,Di.push({glyph:bt,image:mi,x:ze,y:Ze+Wi,vertical:Mn,scale:Mt,localGlyph:It.localGlyph,fontStack:fe.fontStack,sectionIndex:He,metrics:It,rect:Gt}),ze+=qi*Mt+gt):(Di.push({glyph:bt,image:mi,x:ze,y:Ze+Wi,vertical:Mn,scale:Mt,localGlyph:It.localGlyph,fontStack:fe.fontStack,sectionIndex:He,metrics:It,rect:Gt}),ze+=It.advance*Mt+gt)}Di.length!==0&&(wt=Math.max(ze-gt,wt),Zt?iP(Di,ft,Ii,Bi,Je*Ot/2):iP(Di,ft,Ii,0,Je/2)),ze=0;const qn=Je*Ot+Ii;vi.lineOffset=Math.max(Ii,li),Ze+=qn,++Ut}var lt;const pt=Ze,{horizontalAlign:$t,verticalAlign:zt}=l2(yt);(function(At,Ot,li,vi,Di,Ii){const Yi=(Ot-li)*Di,Bi=-Ii*vi;for(const qn of At)for(const he of qn.positionedGlyphs)he.x+=Yi,he.y+=Bi})(Se.positionedLines,ft,$t,zt,wt,pt),Se.top+=-zt*pt,Se.bottom=Se.top+pt,Se.left+=-$t*wt,Se.right=Se.left+wt,Se.hasBaseline=Zt}(we,e,n,l,K,p,y,b,P,S,M,L),!function(Se){for(const Me of Se)if(Me.positionedGlyphs.length!==0)return!1;return!0}(Ee))return we}const Dv={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},VB={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function JI(r,e,n,l,u,f){if(e.image){const p=l.get(e.image.toString());return p?p.displaySize[0]*e.scale*hs/f+u:0}{const p=n[e.fontStack],y=p&&p.glyphs[r];return y?y.metrics.advance*e.scale+u:0}}function QI(r,e,n,l){const u=Math.pow(r-e,2);return l?r<e?u/2:2*u:u+Math.abs(n)*n}function UB(r,e,n){let l=0;return r===10&&(l-=1e4),n&&(l+=150),r!==40&&r!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function eP(r,e,n,l,u,f){let p=null,y=QI(e,n,u,f);for(const b of l){const S=QI(e-b.x,n,u,f)+b.badness;S<=y&&(p=b,y=S)}return{index:r,x:e,priorBreak:p,badness:y}}function tP(r){return r?tP(r.priorBreak).concat(r.index):[]}function l2(r){let e=.5,n=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function iP(r,e,n,l,u){if(!(e||n||l||u))return;const f=r.length-1,p=r[f],y=(p.x+p.metrics.advance*p.scale)*e;for(let b=0;b<=f;b++)r[b].x-=y,r[b].y+=n+l+u}function nP(r){return r.imagePrimary!==void 0&&r.top!==void 0&&r.bottom!==void 0&&r.left!==void 0&&r.right!==void 0}function GB(r,e,n,l){const{horizontalAlign:u,verticalAlign:f}=l2(l),p=n[0]-r.displaySize[0]*u,y=n[1]-r.displaySize[1]*f;return{imagePrimary:r,imageSecondary:e,top:y,bottom:y+r.displaySize[1],left:p,right:p+r.displaySize[0]}}function rP(r,e,n,l,u,f){const p=r.imagePrimary;let y;if(p.content){const H=p.content,K=p.pixelRatio||1;y=[H[0]/K,H[1]/K,p.displaySize[0]-H[2]/K,p.displaySize[1]-H[3]/K]}const b=e.left*f,S=e.right*f;let A,P,M,N;n==="width"||n==="both"?(N=u[0]+b-l[3],P=u[0]+S+l[1]):(N=u[0]+(b+S-p.displaySize[0])/2,P=N+p.displaySize[0]);const L=e.top*f,U=e.bottom*f;return n==="height"||n==="both"?(A=u[1]+L-l[0],M=u[1]+U+l[2]):(A=u[1]+(L+U-p.displaySize[1])/2,M=A+p.displaySize[1]),{imagePrimary:p,imageSecondary:void 0,top:A,right:P,bottom:M,left:N,collisionPadding:y}}function sP(r){return!r.imagePrimary.stretchX}function oP(r){return!r.imagePrimary.stretchY}function aP(r){return{width:r.right-r.left,height:r.bottom-r.top}}const Jl=128;function lP(r,e,n){const{expression:l}=e;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new Pn(r+1,{worldview:n}))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:f}=l;let p=0;for(;p<u.length&&u[p]<=r;)p++;p=Math.max(0,p-1);let y=p;for(;y<u.length&&u[y]<r+1;)y++;y=Math.min(u.length-1,y);const b=u[p],S=u[y];return l.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:S,interpolationType:f}:{kind:"camera",minZoom:b,maxZoom:S,minSize:l.evaluate(new Pn(b,{worldview:n})),maxSize:l.evaluate(new Pn(S,{worldview:n})),interpolationType:f}}}function c2(r,{uSize:e,uSizeT:n},{lowerSize:l,upperSize:u}){return r.kind==="source"?l/Jl:r.kind==="composite"?si(l/Jl,u/Jl,n):e}function m_(r,e,n=1){let l=0,u=0;if(r.kind==="constant")u=r.layoutSize*n;else if(r.kind!=="source"){const{interpolationType:f,minZoom:p,maxZoom:y}=r,b=f?ge(ao.interpolationFactor(f,e,p,y),0,1):0;r.kind==="camera"?u=si(r.minSize,r.maxSize,b)*n:l=b*n}return{uSizeT:l,uSize:u}}class zc extends ht{constructor(e,n,l,u,f){super(e,n),this.angle=u,this.z=l,f!==void 0&&(this.segment=f)}clone(){return new zc(this.x,this.y,this.z,this.angle,this.segment)}}function cP(r,e,n,l,u){if(e.segment===void 0)return!0;let f=e,p=e.segment+1,y=0;for(;y>-n/2;){if(p--,p<0)return!1;y-=r[p].dist(f),f=r[p]}y+=r[p].dist(r[p+1]),p++;const b=[];let S=0;for(;y<n/2;){const A=r[p],P=r[p+1];if(!P)return!1;let M=r[p-1].angleTo(A)-A.angleTo(P);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:y,angleDelta:M}),S+=M;y-b[0].distance>l;)S-=b.shift().angleDelta;if(S>u)return!1;p++,y+=A.dist(P)}return!0}function uP(r){let e=0;for(let n=0;n<r.length-1;n++)e+=r[n].dist(r[n+1]);return e}function dP(r,e,n){return r?.6*e*n:0}function hP(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function $B(r,e,n,l,u,f){const p=dP(n,u,f),y=hP(n,l)*f;let b=0;const S=uP(r)/2;for(let A=0;A<r.length-1;A++){const P=r[A],M=r[A+1],N=P.dist(M);if(b+N>S){const L=(S-b)/N,U=si(P.x,M.x,L),H=si(P.y,M.y,L),K=new zc(U,H,0,M.angleTo(P),A);return!p||cP(r,K,y,p,e)?K:void 0}b+=N}}function HB(r,e,n,l,u,f,p,y,b){const S=dP(l,f,p),A=hP(l,u),P=A*p,M=r[0].x===0||r[0].x===b||r[0].y===0||r[0].y===b;return e-P<e/4&&(e=P+e/4),fP(r,M?e/2*y%e:(A/2+2*f)*p*y%e,e,S,n,P,M,!1,b)}function fP(r,e,n,l,u,f,p,y,b){const S=f/2,A=uP(r);let P=0,M=e-n,N=[];for(let L=0;L<r.length-1;L++){const U=r[L],H=r[L+1],K=U.dist(H),se=H.angleTo(U);for(;M+n<P+K;){M+=n;const re=(M-P)/K,le=si(U.x,H.x,re),Ee=si(U.y,H.y,re);if(le>=0&&le<b&&Ee>=0&&Ee<b&&M-S>=0&&M+S<=A){const we=new zc(le,Ee,0,se,L);l&&!cP(r,we,f,l,u)||N.push(we)}}P+=K}return y||N.length||p||(N=fP(r,P/2,n,l,u,f,p,!0,b)),N}function pP(r){let e=0,n=0;for(const p of r)e+=p.w*p.h,n=Math.max(n,p.w);r.sort((p,y)=>y.h-p.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let u=0,f=0;for(const p of r)for(let y=l.length-1;y>=0;y--){const b=l[y];if(!(p.w>b.w||p.h>b.h)){if(p.x=b.x,p.y=b.y,f=Math.max(f,p.y+p.h),u=Math.max(u,p.x+p.w),p.w===b.w&&p.h===b.h){const S=l.pop();S&&y<l.length&&(l[y]=S)}else p.h===b.h?(b.x+=p.w,b.w-=p.w):p.w===b.w?(b.y+=p.h,b.h-=p.h):(l.push({x:b.x+p.w,y:b.y,w:b.w-p.w,h:p.h}),b.y+=p.h,b.h-=p.h);break}}return{w:u,h:f,fill:e/(u*f)||0}}Bt(zc,"Anchor");const Nh=1;class g_{static getImagePositionScale(e,n,l){if(n&&e&&e.options&&e.options.transform){const u=e.options.transform;return{x:u.a,y:u.d}}return{x:l,y:l}}constructor(e,n,l,u){this.paddedRect=e;const{pixelRatio:f,version:p,stretchX:y,stretchY:b,content:S,sdf:A,usvg:P}=n;this.pixelRatio=f,this.stretchX=y,this.stretchY=b,this.content=S,this.version=p,this.padding=l,this.sdf=A,this.usvg=P,this.scale=g_.getImagePositionScale(u,P,f)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function u2(r,e,n){const l=tl.parse(r),u=function(f,p,y=[1,1]){return{x:0,y:0,w:(f.data?f.data.width:f.width*y[0])+2*p,h:(f.data?f.data.height:f.height*y[1])+2*p}}(e,n,[l.options.transform.a,l.options.transform.d]);return{bin:u,imagePosition:new g_(u,e,n,l),imageVariant:l}}class mP{constructor(e,n,l){const u=new Map,f=new Map;this.haveRenderCallbacks=[];const p=[];this.addImages(e,u,Nh,p),this.addImages(n,f,2,p);const{w:y,h:b}=pP(p),S=new Cs({width:y||1,height:b||1});for(const[A,P]of e.entries()){const M=u.get(A).paddedRect;Cs.copy(P.data,S,{x:0,y:0},{x:M.x+Nh,y:M.y+Nh},P.data,l,P.sdf)}for(const[A,P]of n.entries()){const M=f.get(A),N=M.paddedRect;let L=M.padding;const U=N.x+L,H=N.y+L,K=P.data.width,se=P.data.height;L=L>1?L-1:L,Cs.copy(P.data,S,{x:0,y:0},{x:U,y:H},P.data,l),Cs.copy(P.data,S,{x:0,y:se-L},{x:U,y:H-L},{width:K,height:L},l),Cs.copy(P.data,S,{x:0,y:0},{x:U,y:H+se},{width:K,height:L},l),Cs.copy(P.data,S,{x:K-L,y:0},{x:U-L,y:H},{width:L,height:se},l),Cs.copy(P.data,S,{x:0,y:0},{x:U+K,y:H},{width:L,height:se},l),Cs.copy(P.data,S,{x:K-L,y:se-L},{x:U-L,y:H-L},{width:L,height:L},l),Cs.copy(P.data,S,{x:0,y:se-L},{x:U+K,y:H-L},{width:L,height:L},l),Cs.copy(P.data,S,{x:0,y:0},{x:U+K,y:H+se},{width:L,height:L},l),Cs.copy(P.data,S,{x:K-L,y:0},{x:U-L,y:H+se},{width:L,height:L},l)}this.lut=l,this.image=S,this.iconPositions=u,this.patternPositions=f}addImages(e,n,l,u){for(const[f,p]of e.entries()){const{bin:y,imagePosition:b,imageVariant:S}=u2(f,p,l);n.set(f,b),u.push(y),p.hasRenderCallback&&this.haveRenderCallbacks.push(S.id)}}patchUpdatedImages(e,n,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>e.hasImage(u,l)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,l);for(const u of e.getUpdatedImages(l)){for(const f of this.iconPositions.keys()){const p=tl.parse(f);if(_o.isEqual(p.id,u)){const y=e.getImage(u,l);this.patchUpdatedImage(this.iconPositions.get(f),y,n)}}for(const f of this.patternPositions.keys()){const p=tl.parse(f);if(_o.isEqual(p.id,u)){const y=e.getImage(u,l);this.patchUpdatedImage(this.patternPositions.get(f),y,n)}}}}patchUpdatedImage(e,n,l){if(!e||!n||e.version===n.version)return;e.version=n.version;const[u,f]=e.tl,p=e.sdf;if(this.lut||p){const y={width:n.data.width,height:n.data.height},b=new Cs(y);Cs.copy(n.data,b,{x:0,y:0},{x:0,y:0},y,this.lut,p),l.update(b,{position:{x:u,y:f}})}else l.update(n.data,{position:{x:u,y:f}})}}Bt(g_,"ImagePosition"),Bt(mP,"ImageAtlas");const __=1e20;function gP(r,e,n,l,u,f,p,y,b){for(let S=e;S<e+l;S++)_P(r,n*f+S,f,u,p,y,b);for(let S=n;S<n+u;S++)_P(r,S*f+e,1,l,p,y,b)}function _P(r,e,n,l,u,f,p){f[0]=0,p[0]=-__,p[1]=__,u[0]=r[e];for(let y=1,b=0,S=0;y<l;y++){u[y]=r[e+y*n];const A=y*y;do{const P=f[b];S=(u[y]-u[P]+A-P*P)/(y-P)/2}while(S<=p[b]&&--b>-1);b++,f[b]=y,p[b]=S,p[b+1]=__}for(let y=0,b=0;y<l;y++){for(;p[b+1]<y;)b++;const S=f[b],A=y-S;r[e+y*n]=u[S]+A*A}}const sl=2,d2={none:0,ideographs:1,all:2};class vp{constructor(e,n,l){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=l,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,n){const l=[],u=this.url||gs.GLYPHS_URL;for(const f in e)for(const p of e[f])l.push({stack:f,id:p});ke(l,({stack:f,id:p},y)=>{let b=this.entries[f];b||(b=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let S=b.glyphs[p];if(S!==void 0)return void y(null,{stack:f,id:p,glyph:S});if(S=this._tinySDF(b,f,p),S)return b.glyphs[p]=S,void y(null,{stack:f,id:p,glyph:S});const A=Math.floor(p/256);if(256*A>65535)return Ki("glyphs > 65535 not supported"),void y(null,{stack:f,id:p,glyph:S});if(b.ranges[A])return void y(null,{stack:f,id:p,glyph:S});let P=b.requests[A];P||(P=b.requests[A]=[],vp.loadGlyphRange(f,A,u,this.requestManager,(M,N)=>{if(N){b.ascender=N.ascender,b.descender=N.descender;for(const L in N.glyphs)this._doesCharSupportLocalGlyph(+L)||(b.glyphs[+L]=N.glyphs[+L]);b.ranges[A]=!0}for(const L of P)L(M,N);delete b.requests[A]})),P.push((M,N)=>{M?y(M):N&&y(null,{stack:f,id:p,glyph:N.glyphs[p]||null})})},(f,p)=>{if(f)n(f);else if(p){const y={};for(const{stack:b,id:S,glyph:A}of p)y[b]===void 0&&(y[b]={}),y[b].glyphs===void 0&&(y[b].glyphs={}),y[b].glyphs[S]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics},y[b].ascender=this.entries[b].ascender,y[b].descender=this.entries[b].descender;n(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==d2.none&&(this.localGlyphMode===d2.all?!!this.localFontFamily:!!this.localFontFamily&&(ci["CJK Unified Ideographs"](e)||ci["Hangul Syllables"](e)||ci.Hiragana(e)||ci.Katakana(e)||ci["CJK Symbols and Punctuation"](e)||ci["CJK Unified Ideographs Extension A"](e)||ci["CJK Unified Ideographs Extension B"](e)||ci.Osage(e)))}_tinySDF(e,n,l){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let f=e.tinySDF;if(!f){let U="400";/bold/i.test(n)?U="900":/medium/i.test(n)?U="500":/light/i.test(n)&&(U="200"),f=e.tinySDF=new vp.TinySDF({fontFamily:u,fontWeight:U,fontSize:24*sl,buffer:3*sl,radius:8*sl}),f.fontWeight=U}if(this.localGlyphs[f.fontWeight][l])return this.localGlyphs[f.fontWeight][l];const p=String.fromCodePoint(l),{data:y,width:b,height:S,glyphWidth:A,glyphHeight:P,glyphLeft:M,glyphTop:N,glyphAdvance:L}=f.draw(p);return this.localGlyphs[f.fontWeight][l]={id:l,bitmap:new Vu({width:b,height:S},y),metrics:{width:A/sl,height:P/sl,left:M/sl,top:N/sl-27,advance:L/sl,localGlyph:!0}}}}vp.loadGlyphRange=function(r,e,n,l,u){const f=256*e,p=f+255,y=l.transformRequest(l.normalizeGlyphsURL(n).replace("{fontstack}",r).replace("{range}",`${f}-${p}`),qd.Glyphs);Wd(y,(b,S)=>{if(b)u(b);else if(S){const A={},P=function(M){return new Rv(M).readFields(FB,{})}(S);for(const M of P.glyphs)A[M.id]=M;u(null,{glyphs:A,ascender:P.ascender,descender:P.descender})}})},vp.TinySDF=class{constructor({fontSize:r=24,buffer:e=3,radius:n=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:f="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=n;const y=this.size=r+4*e,b=this._createCanvas(y),S=this.ctx=b.getContext("2d",{willReadFrequently:!0});S.font=`${p} ${f} ${r}px ${u}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(r){const e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:f}=this.ctx.measureText(r),p=Math.ceil(n),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-u))),b=Math.min(this.size-this.buffer,p+Math.ceil(l)),S=y+2*this.buffer,A=b+2*this.buffer,P=Math.max(S*A,0),M=new Uint8ClampedArray(P),N={data:M,width:S,height:A,glyphWidth:y,glyphHeight:b,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(y===0||b===0)return N;const{ctx:L,buffer:U,gridInner:H,gridOuter:K}=this;L.clearRect(U,U,y,b),L.fillText(r,U,U+p);const se=L.getImageData(U,U,y,b);K.fill(__,0,P),H.fill(0,0,P);for(let re=0;re<b;re++)for(let le=0;le<y;le++){const Ee=se.data[4*(re*y+le)+3]/255;if(Ee===0)continue;const we=(re+U)*S+le+U;if(Ee===1)K[we]=0,H[we]=__;else{const Se=.5-Ee;K[we]=Se>0?Se*Se:0,H[we]=Se<0?Se*Se:0}}gP(K,0,0,S,A,S,this.f,this.v,this.z),gP(H,U,U,y,b,S,this.f,this.v,this.z);for(let re=0;re<P;re++){const le=Math.sqrt(K[re])-Math.sqrt(H[re]);M[re]=Math.round(255-255*(le/this.radius+this.cutoff))}return N}};const $u=Nh;function yP(r,e){return r+e[1]-e[0]}function xP(r,e,n,l,u=1){const f=[],p=r.imagePrimary,y=p.pixelRatio,b=p.paddedRect.w-2*$u,S=p.paddedRect.h-2*$u,A=(r.right-r.left)*u,P=(r.bottom-r.top)*u,M=p.stretchX||[[0,b]],N=p.stretchY||[[0,S]],L=M.reduce(yP,0),U=N.reduce(yP,0),H=b-L,K=S-U;let se=0,re=L,le=0,Ee=U,we=0,Se=H,Me=0,De=K;if(p.content&&l){const Le=p.content;se=kv(M,0,Le[0]),le=kv(N,0,Le[1]),re=kv(M,Le[0],Le[2]),Ee=kv(N,Le[1],Le[3]),we=Le[0]-se,Me=Le[1]-le,Se=Le[2]-Le[0]-re,De=Le[3]-Le[1]-Ee}const Xe=(Le,Je,yt,tt)=>{const ut=Nv(Le.stretch-se,re,A,r.left*u),gt=Lv(Le.fixed-we,Se,Le.stretch,L),We=Nv(Je.stretch-le,Ee,P,r.top*u),dt=Lv(Je.fixed-Me,De,Je.stretch,U),ze=Nv(yt.stretch-se,re,A,r.left*u),Ze=Lv(yt.fixed-we,Se,yt.stretch,L),wt=Nv(tt.stretch-le,Ee,P,r.top*u),ft=Lv(tt.fixed-Me,De,tt.stretch,U),Zt=new ht(ut,We),Ut=new ht(ze,We),lt=new ht(ze,wt),pt=new ht(ut,wt),$t=new ht(gt/y,dt/y),zt=new ht(Ze/y,ft/y),At=e*Math.PI/180;if(At){const Yi=Math.sin(At),Bi=Math.cos(At),qn=[Bi,-Yi,Yi,Bi];Zt._matMult(qn),Ut._matMult(qn),pt._matMult(qn),lt._matMult(qn)}const Ot=Le.stretch+Le.fixed,li=yt.stretch+yt.fixed,vi=Je.stretch+Je.fixed,Di=tt.stretch+tt.fixed,Ii=r.imageSecondary;return{tl:Zt,tr:Ut,bl:pt,br:lt,texPrimary:{x:p.paddedRect.x+$u+Ot,y:p.paddedRect.y+$u+vi,w:li-Ot,h:Di-vi},texSecondary:Ii?{x:Ii.paddedRect.x+$u+Ot,y:Ii.paddedRect.y+$u+vi,w:li-Ot,h:Di-vi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:$t,pixelOffsetBR:zt,minFontScaleX:Se/y/A,minFontScaleY:De/y/P,isSDF:n}};if(l&&(p.stretchX||p.stretchY)){const Le=vP(M,H,L),Je=vP(N,K,U);for(let yt=0;yt<Le.length-1;yt++){const tt=Le[yt],ut=Le[yt+1];for(let gt=0;gt<Je.length-1;gt++)f.push(Xe(tt,Je[gt],ut,Je[gt+1]))}}else f.push(Xe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:S+1}));return f}function kv(r,e,n){let l=0;for(const u of r)l+=Math.max(e,Math.min(n,u[1]))-Math.max(e,Math.min(n,u[0]));return l}function vP(r,e,n){const l=[{fixed:-$u,stretch:0}];for(const[u,f]of r){const p=l[l.length-1];l.push({fixed:u-p.stretch,stretch:p.stretch}),l.push({fixed:u-p.stretch,stretch:p.stretch+(f-u)})}return l.push({fixed:e+$u,stretch:n}),l}function Nv(r,e,n,l){return r/e*n+l}function Lv(r,e,n,l){return r-e*n/l}function qB(r,e,n,l){const u=e+r.positionedLines[l].lineOffset;return l===0?n+u/2:n+(u+(e+r.positionedLines[l-1].lineOffset))/2}function WB(r,e=1,n=!1){let l=1/0,u=1/0,f=-1/0,p=-1/0;const y=r[0];for(let N=0;N<y.length;N++){const L=y[N];(!N||L.x<l)&&(l=L.x),(!N||L.y<u)&&(u=L.y),(!N||L.x>f)&&(f=L.x),(!N||L.y>p)&&(p=L.y)}const b=Math.min(f-l,p-u);let S=b/2;const A=new bf([],ZB);if(b===0)return new ht(l,u);for(let N=l;N<f;N+=b)for(let L=u;L<p;L+=b)A.push(new wp(N+S,L+S,S,r));let P=function(N){let L=0,U=0,H=0;const K=N[0];for(let se=0,re=K.length,le=re-1;se<re;le=se++){const Ee=K[se],we=K[le],Se=Ee.x*we.y-we.x*Ee.y;U+=(Ee.x+we.x)*Se,H+=(Ee.y+we.y)*Se,L+=3*Se}return new wp(U/L,H/L,0,N)}(r),M=A.length;for(;A.length;){const N=A.pop();(N.d>P.d||!P.d)&&(P=N,n&&console.log("found best %d after %d probes",Math.round(1e4*N.d)/1e4,M)),N.max-P.d<=e||(S=N.h/2,A.push(new wp(N.p.x-S,N.p.y-S,S,r)),A.push(new wp(N.p.x+S,N.p.y-S,S,r)),A.push(new wp(N.p.x-S,N.p.y+S,S,r)),A.push(new wp(N.p.x+S,N.p.y+S,S,r)),M+=4)}return n&&(console.log(`num probes: ${M}`),console.log(`best distance: ${P.d}`)),P.p}function ZB(r,e){return e.max-r.max}class wp{constructor(e,n,l,u){this.p=new ht(e,n),this.h=l,this.d=function(f,p){let y=!1,b=1/0;for(let S=0;S<p.length;S++){const A=p[S];for(let P=0,M=A.length,N=M-1;P<M;N=P++){const L=A[P],U=A[N];L.y>f.y!=U.y>f.y&&f.x<(U.x-L.x)*(f.y-L.y)/(U.y-L.y)+L.x&&(y=!y),b=Math.min(b,zo(f,L,U))}}return(y?1:-1)*Math.sqrt(b)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const XB=Object.keys,h2=Number.POSITIVE_INFINITY,KB=Math.sqrt(2);function wP(r,[e,n]){let l=0,u=0;if(n===h2){e<0&&(e=0);const f=e/KB;switch(r){case"top-right":case"top-left":u=f-7;break;case"bottom-right":case"bottom-left":u=7-f;break;case"bottom":u=7-e;break;case"top":u=e-7}switch(r){case"top-right":case"bottom-right":l=-f;break;case"top-left":case"bottom-left":l=f;break;case"left":l=e;break;case"right":l=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),r){case"top-right":case"top-left":case"top":u=n-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-n}switch(r){case"top-right":case"bottom-right":case"right":l=-e;break;case"top-left":case"bottom-left":case"left":l=e}}return[l,u]}function zv(r,e,n,l,u,f,p,y,b){if(!e||!e.usvg)return;const S=aP(l),A=aP(u),P=f!=="both"&&f!=="width"||!sP(l)?1:A.width/S.width,M=f!=="both"&&f!=="height"||!oP(l)?1:A.height/S.height;n.scaleSelf(P,M);const N=n.toString();p.set(N,n),y.set(N,e);const{imagePosition:L}=u2(N,e,Nh);b.set(N,L)}function bP(r,e,n,l,u,f,p,y,b){if(!r)return;const S=function(A,P,M,N,L,U){if(A.kind==="camera")return A.maxSize;if(A.kind==="composite"){const H=P.possiblyEvaluate(new Pn(A.maxZoom,{worldview:U}),M).evaluate(L,{},M),K=P.possiblyEvaluate(new Pn(A.minZoom,{worldview:U}),M).evaluate(L,{},M);return Math.max(H,K)}return P.possiblyEvaluate(new Pn(N,{worldview:U})).evaluate(L,{},M)}(e,n,l,u,f,b);return r.scaleSelf(S*y*p)}function SP(r,e,n,l,u,f,p,y,b){return{iconPrimary:bP(r.getPrimary(),e,n,l,u,f,p,y,b),iconSecondary:bP(r.getSecondary(),e,n,l,u,f,p,y,b)}}function YB(r,e,n){if(!e)return;const l=n.get(r.toString()),u=n.get(e.toString());u&&(l.paddedRect.w===u.paddedRect.w&&l.paddedRect.h===u.paddedRect.h||Ki(`Mismatch in icon variant sizes: ${r.toString()} and ${e.toString()}`),l.usvg!==u.usvg&&Ki(`Mismatch in icon variant image types: ${r.id} and ${e.id}`))}function TP(r,e,n,l){if(!r)return;const u=e.get(n.toString());if(r.imagePrimary=u,l){const f=e.get(l.toString());r.imageSecondary=f}}function JB(r,e){for(const n in r.horizontal)EP(r.horizontal[n],e);EP(r.vertical,e)}function EP(r,e){if(r){for(const n of r.positionedLines)for(const l of n.positionedGlyphs)if(l.image!==null){const u=l.image.toString();l.rect=e.get(u).paddedRect}}}function f2(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function QB(r,e,n,l,u,f,p,y,b){const S=p2(f.horizontal)||f.vertical,A=n.get("icon-text-fit-padding").evaluate(l,{},u);let P,M=e;return e&&b!=="none"&&(r.allowVerticalPlacement&&f.vertical&&(P=rP(e,f.vertical,b,A,y,p)),S&&(M=rP(e,S,b,A,y,p))),{defaultShapedIcon:M,verticallyShapedIcon:P}}function e5(r,e,n,l,u,f,p,y,b,S,A,P,M,N,L,U,H,K,se,re){let le=p.textMaxSize.evaluate(e,{},M);le===void 0?le=y*p.textScaleFactor:le*=p.textScaleFactor;const Ee=r.layers[0].layout,we=p2(n.horizontal)||n.vertical,Se=N.name==="globe",Me=hs,De=r.tilePixelRatio*le/Me,Xe=(gt=r.overscaling,r.zoom>18&&gt>2&&(gt>>=1),Math.max(Et/(512*gt),1)*Ee.get("symbol-spacing")),Le=Ee.get("text-padding")*r.tilePixelRatio,Je=Ee.get("icon-padding")*r.tilePixelRatio,yt=pn(Ee.get("text-max-angle")),tt=Ee.get("icon-rotation-alignment")==="map"&&re!=="point",ut=Xe/2;var gt;r.hasAnyIconTextFit===!1&&H!=="none"&&(r.hasAnyIconTextFit=!0);const We=e.properties?+e.properties[Lt]:null,dt=We&&r.elevationFeatureIdToIndex?r.elevationFeatureIdToIndex.get(We):65535,ze=(Ze,wt,ft)=>{if(wt.x<0||wt.x>=Et||wt.y<0||wt.y>=Et)return;let Zt=null;if(Se){const{x:Ut,y:lt,z:pt}=N.projectTilePoint(wt.x,wt.y,ft);Zt={anchor:new zc(Ut,lt,pt,0,void 0),up:N.upVector(ft,wt.x,wt.y)}}(function(Ut,lt,pt,$t,zt,At,Ot,li,vi,Di,Ii,Yi,Bi,qn,he,fe,He,bt,Mt,It,Gt,mi,qi,Wi,Li,Mn,ur,ki,Kn){const Vn=Ut.addToLineVertexArray(lt,$t);let Tn,or,Wn,Un,$n,In,zi,Rn=0,ar=0,hi=0,rn=0,Zn=-1,pr=-1;const Yn={};let $r=au("");const zn=pt?pt.anchor:lt,Fr=ki!=="none";let wo=0,As=0;if(vi._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Hr=vi.layout.get("text-offset").evaluate(Gt,{},Li);wo=Hr[0]*hs,As=Hr[1]*hs}else wo=vi.layout.get("text-radial-offset").evaluate(Gt,{},Li)*hs,As=h2;if(Ut.allowVerticalPlacement&&zt.vertical){const Hr=zt.vertical;if(he)In=m2(Hr),li&&(zi=m2(li));else{const ts=vi.layout.get("text-rotate").evaluate(Gt,{},Li)+90;Wn=Ov(Di,zn,lt,Ii,Yi,Bi,Hr,qn,ts,fe),li&&(Un=Ov(Di,zn,lt,Ii,Yi,Bi,li,bt,ts))}}if(At){const Hr=Ut.iconSizeData,ts=vi.layout.get("icon-rotate").evaluate(Gt,{},Li),Is=xP(At,ts,qi,Fr,mi.iconScaleFactor),Ks=li?xP(li,ts,qi,Fr,mi.iconScaleFactor):void 0;or=Ov(Di,zn,lt,Ii,Yi,Bi,At,bt,ts,null),Rn=4*Is.length;let js=null;Hr.kind==="source"?(js=[Jl*vi.layout.get("icon-size").evaluate(Gt,{},Li)*mi.iconScaleFactor],js[0]>Hu&&Ki(`${Ut.layerIds[0]}: Value for "icon-size" is >= ${y_}. Reduce your "icon-size".`)):Hr.kind==="composite"&&(js=[Jl*mi.compositeIconSizes[0].evaluate(Gt,{},Li)*mi.iconScaleFactor,Jl*mi.compositeIconSizes[1].evaluate(Gt,{},Li)*mi.iconScaleFactor],(js[0]>Hu||js[1]>Hu)&&Ki(`${Ut.layerIds[0]}: Value for "icon-size" is >= ${y_}. Reduce your "icon-size".`)),Ut.addSymbols(Ut.icon,Is,js,It,Mt,Gt,void 0,pt,lt,Vn.lineStartIndex,Vn.lineLength,-1,Wi,Li,Mn,ur),Zn=Ut.icon.placedSymbolArray.length-1,Ks&&(ar=4*Ks.length,Ut.addSymbols(Ut.icon,Ks,js,It,Mt,Gt,Vo.vertical,pt,lt,Vn.lineStartIndex,Vn.lineLength,-1,Wi,Li,Mn,ur),pr=Ut.icon.placedSymbolArray.length-1)}for(const Hr in zt.horizontal){const ts=Hr,Is=zt.horizontal[ts];Tn||($r=au(Is.text),he?$n=m2(Is):Tn=Ov(Di,zn,lt,Ii,Yi,Bi,Is,qn,vi.layout.get("text-rotate").evaluate(Gt,{},Li),fe));const Ks=Is.positionedLines.length===1;if(hi+=CP(Ut,pt,lt,Is,Ot,vi,he,Gt,fe,Vn,zt.vertical?Vo.horizontal:Vo.horizontalOnly,Ks?XB(zt.horizontal):[ts],Yn,Zn,mi,Wi,Li,Mn),Ks)break}zt.vertical&&(rn+=CP(Ut,pt,lt,zt.vertical,Ot,vi,he,Gt,fe,Vn,Vo.vertical,["vertical"],Yn,pr,mi,Wi,Li,Mn));let _s=-1;const bo=(Hr,ts)=>Hr?Math.max(Hr,ts):ts;_s=bo($n,_s),_s=bo(In,_s),_s=bo(zi,_s);const Ql=_s>-1?1:0;Ut.glyphOffsetArray.length>=65535&&Ki("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Gt.sortKey!==void 0&&Ut.addToSortKeyRanges(Ut.symbolInstances.length,Gt.sortKey),Ut.symbolInstances.emplaceBack(lt.x,lt.y,zn.x,zn.y,zn.z,Yn.right>=0?Yn.right:-1,Yn.center>=0?Yn.center:-1,Yn.left>=0?Yn.left:-1,Yn.vertical>=0?Yn.vertical:-1,Zn,pr,$r,Tn!==void 0?Tn:Ut.collisionBoxArray.length,Tn!==void 0?Tn+1:Ut.collisionBoxArray.length,Wn!==void 0?Wn:Ut.collisionBoxArray.length,Wn!==void 0?Wn+1:Ut.collisionBoxArray.length,or!==void 0?or:Ut.collisionBoxArray.length,or!==void 0?or+1:Ut.collisionBoxArray.length,Un||Ut.collisionBoxArray.length,Un?Un+1:Ut.collisionBoxArray.length,Ii,hi,rn,Rn,ar,Ql,0,wo,As,_s,0,Fr?1:0,Kn)})(r,wt,Zt,Ze,n,l,f,u,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,Le,se,S,0,Je,tt,K,e,p,A,P,M,L,U,H,dt)};if(re==="line")for(const Ze of Sv(e.geometry,0,0,Et,Et)){const wt=HB(Ze,Xe,yt,n.vertical||we,l,Me,De,r.overscaling,Et);for(const ft of wt)we&&t5(r,we.text,ut,ft)||ze(Ze,ft,M)}else if(re==="line-center"){for(const Ze of e.geometry)if(Ze.length>1){const wt=$B(Ze,yt,n.vertical||we,l,Me,De);wt&&ze(Ze,wt,M)}}else if(e.type==="Polygon")for(const Ze of e_(e.geometry,0)){const wt=WB(Ze,16);ze(Ze[0],new zc(wt.x,wt.y,0,0,void 0),M)}else if(e.type==="LineString")for(const Ze of e.geometry)ze(Ze,new zc(Ze[0].x,Ze[0].y,0,0,void 0),M);else if(e.type==="Point")for(const Ze of e.geometry)for(const wt of Ze)ze([wt],new zc(wt.x,wt.y,0,0,void 0),M)}const y_=255,Hu=y_*Jl;function CP(r,e,n,l,u,f,p,y,b,S,A,P,M,N,L,U,H,K){const se=function(Ee,we,Se,Me,De,Xe,Le,Je){const yt=[];if(we.positionedLines.length===0)return yt;const tt=Me.layout.get("text-rotate").evaluate(Xe,{})*Math.PI/180,ut=function(Ze){const wt=Ze[0],ft=Ze[1],Zt=wt*ft;return Zt>0?[wt,-ft]:Zt<0?[-wt,ft]:wt===0?[ft,wt]:[ft,-wt]}(Se);let gt=Math.abs(we.top-we.bottom);for(const Ze of we.positionedLines)gt-=Ze.lineOffset;const We=we.positionedLines.length,dt=gt/We;let ze=we.top-Se[1];for(let Ze=0;Ze<We;++Ze){const wt=we.positionedLines[Ze];ze=qB(we,dt,ze,Ze);for(const ft of wt.positionedGlyphs){if(!ft.rect)continue;const Zt=ft.rect||{};let Ut=YI+1,lt=!0,pt=1,$t=0;if(ft.image){const Gt=Le.get(ft.image.toString());if(!Gt)continue;if(Gt.sdf){Ki("SDF images are not supported in formatted text and will be ignored.");continue}lt=!1,pt=Gt.pixelRatio,Ut=Nh/pt}const zt=(De||Je)&&ft.vertical,At=ft.metrics.advance*ft.scale/2,Ot=ft.metrics,li=ft.rect;if(li===null)continue;Je&&we.verticalizable&&($t=ft.image?At-ft.metrics.width*ft.scale/2:0);const vi=De?[ft.x+At,ft.y]:[0,0];let Di=[0,0],Ii=[0,0],Yi=!1;De||(zt?(Ii=[ft.x+At+ut[0],ft.y+ut[1]-$t],Yi=!0):Di=[ft.x+At+Se[0],ft.y+Se[1]-$t]);const Bi=li.w*ft.scale/(pt*(ft.localGlyph?sl:1)),qn=li.h*ft.scale/(pt*(ft.localGlyph?sl:1));let he,fe,He,bt;if(zt){const Gt=ft.y-ze,mi=new ht(-At,At-Gt),qi=-Math.PI/2,Wi=new ht(...Ii);he=new ht(-At+Di[0],Di[1]),he._rotateAround(qi,mi)._add(Wi),he.x+=-Gt+At,he.y-=(Ot.left-Ut)*ft.scale;const Li=ft.image?Ot.advance*ft.scale:hs*ft.scale,Mn=String.fromCodePoint(ft.glyph);AB(Mn)?he.x+=(1-Ut)*ft.scale:IB(Mn)?he.x+=Li-Ot.height*ft.scale+(-Ut-1)*ft.scale:he.x+=ft.image||Ot.width+2*Ut===li.w&&Ot.height+2*Ut===li.h?(Li-qn)/2:(Li-(Ot.height+2*Ut)*ft.scale)/2,fe=new ht(he.x,he.y-Bi),He=new ht(he.x+qn,he.y),bt=new ht(he.x+qn,he.y-Bi)}else{const Gt=(Ot.left-Ut)*ft.scale-At+Di[0],mi=(-Ot.top-Ut)*ft.scale+Di[1],qi=Gt+Bi,Wi=mi+qn;he=new ht(Gt,mi),fe=new ht(qi,mi),He=new ht(Gt,Wi),bt=new ht(qi,Wi)}if(tt){let Gt;Gt=De?new ht(0,0):Yi?new ht(ut[0],ut[1]):new ht(Se[0],Se[1]),he._rotateAround(tt,Gt),fe._rotateAround(tt,Gt),He._rotateAround(tt,Gt),bt._rotateAround(tt,Gt)}const Mt=new ht(0,0),It=new ht(0,0);yt.push({tl:he,tr:fe,bl:He,br:bt,texPrimary:Zt,texSecondary:void 0,writingMode:we.writingMode,glyphOffset:vi,sectionIndex:ft.sectionIndex,isSDF:lt,pixelOffsetTL:Mt,pixelOffsetBR:It,minFontScaleX:0,minFontScaleY:0})}}return yt}(0,l,b,f,p,y,u,r.allowVerticalPlacement),re=r.textSizeData;let le=null;re.kind==="source"?(le=[Jl*f.layout.get("text-size").evaluate(y,{},H)*L.textScaleFactor],le[0]>Hu&&Ki(`${r.layerIds[0]}: Value for "text-size" is >= ${y_}. Reduce your "text-size".`)):re.kind==="composite"&&(le=[Jl*L.compositeTextSizes[0].evaluate(y,{},H)*L.textScaleFactor,Jl*L.compositeTextSizes[1].evaluate(y,{},H)*L.textScaleFactor],(le[0]>Hu||le[1]>Hu)&&Ki(`${r.layerIds[0]}: Value for "text-size" is >= ${y_}. Reduce your "text-size".`)),r.addSymbols(r.text,se,le,b,p,y,A,e,n,S.lineStartIndex,S.lineLength,N,U,H,K,!1);for(const Ee of P)M[Ee]=r.text.placedSymbolArray.length-1;return 4*se.length}function p2(r){for(const e in r)return r[e];return null}function Ov(r,e,n,l,u,f,p,y,b,S){let A=p.top,P=p.bottom,M=p.left,N=p.right;if(nP(p)&&p.collisionPadding){const L=p.collisionPadding;M-=L[0],A-=L[1],N+=L[2],P+=L[3]}if(b){const L=new ht(M,A),U=new ht(N,A),H=new ht(M,P),K=new ht(N,P),se=pn(b);let re=new ht(0,0);S&&(re=new ht(S[0],S[1])),L._rotateAround(se,re),U._rotateAround(se,re),H._rotateAround(se,re),K._rotateAround(se,re),M=Math.min(L.x,U.x,H.x,K.x),N=Math.max(L.x,U.x,H.x,K.x),A=Math.min(L.y,U.y,H.y,K.y),P=Math.max(L.y,U.y,H.y,K.y)}return r.emplaceBack(e.x,e.y,e.z,n.x,n.y,M,A,N,P,y,l,u,f),r.length-1}function m2(r){nP(r)&&r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const e=r.bottom-r.top;return e>0?Math.max(10,e):null}function t5(r,e,n,l){const u=r.compareText;if(e in u){const f=u[e];for(let p=f.length-1;p>=0;p--)if(l.dist(f[p])<n)return!0}else u[e]=[];return u[e].push(l),!1}function AP(r,e){const n=r.fovAboveCenter,l=r.elevation?r.elevation.getMinElevationBelowMSL()*e:0,u=(r._camera.position[2]*r.worldSize-l)/Math.cos(r._pitch),f=Math.sin(n)*u/Math.sin(Math.max(Math.PI/2-r._pitch-n,.01));let p=Math.sin(r._pitch)*f+u;const y=u*(1/r._horizonShift);if(!r.elevation||r.elevation.exaggeration()===0){let b=Math.max(r.zoom-17,0);r.isOrthographic&&(b/=10),p*=1+b}return Math.min(1.01*p,y)}function x_(r,e){if(!e.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:e};const n=Math.pow(2,-r.z),l=r.x*n,u=(r.x+1)*n,f=r.y*n,p=(r.y+1)*n,y=ne(l),b=ne(u),S=ae(f),A=ae(p),P=e.project(y,S),M=e.project(b,S),N=e.project(b,A),L=e.project(y,A);let U=Math.min(P.x,M.x,N.x,L.x),H=Math.min(P.y,M.y,N.y,L.y),K=Math.max(P.x,M.x,N.x,L.x),se=Math.max(P.y,M.y,N.y,L.y);const re=n/16;function le(we,Se,Me,De,Xe,Le){const Je=(Me+Xe)/2,yt=(De+Le)/2,tt=e.project(ne(Je),ae(yt)),ut=Math.max(0,U-tt.x,H-tt.y,tt.x-K,tt.y-se);U=Math.min(U,tt.x),K=Math.max(K,tt.x),H=Math.min(H,tt.y),se=Math.max(se,tt.y),ut>re&&(le(we,tt,Me,De,Je,yt),le(tt,Se,Je,yt,Xe,Le))}le(P,M,l,f,u,f),le(M,N,u,f,u,p),le(N,L,u,p,l,p),le(L,P,l,p,l,f),U-=re,H-=re,K+=re,se+=re;const Ee=1/Math.max(K-U,se-H);return{scale:Ee,x:U*Ee,y:H*Ee,x2:K*Ee,y2:se*Ee,projection:e}}function IP(r,{x:e,y:n},l=0){return new ht(((e-l)*r.scale-r.x)*Et,(n*r.scale-r.y)*Et)}const i5=J(new Float32Array(16));class qu{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new D(0,0)}projectTilePoint(e,n,l){return{x:e,y:n,z:0}}locationPoint(e,n,l,u=!0){return e._coordinatePoint(e.locationCoordinate(n,l),u)}pixelsPerMeter(e,n){return Z(1,e)*n}pixelSpaceConversion(e,n,l){return 1}farthestPixelDistance(e){return AP(e,e.pixelsPerMeter)}pointCoordinate(e,n,l,u){const f=e.horizonLineFromTop(!1),p=new ht(n,Math.max(f,l));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,u))}pointCoordinate3D(e,n,l){const u=new ht(n,l);if(e.elevation)return e.elevation.pointCoordinate(u);{const f=this.pointCoordinate(e,u.x,u.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(e,n){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,n.x,n.y);const l=e.horizonLineFromTop();return n.y<l}createInversionMatrix(e,n){return i5}createTileMatrix(e,n,l){let u,f,p;const y=l.canonical,b=J(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=x_(y,this);u=1,f=S.x+l.wrap*S.scale,p=S.y,Q(b,b,[u/S.scale,u/S.scale,e.pixelsPerMeter/n])}else u=n/e.zoomScale(y.z),f=(y.x+Math.pow(2,y.z)*l.wrap)*u,p=y.y*u;return ee(b,b,[f,p,0]),Q(b,b,[u/Et,u/Et,1]),b}upVector(e,n,l){return[0,0,1]}upVectorScale(e,n,l){return{metersToTile:1}}}class n5 extends qu{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,l]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(pn(n));this.n=(u+Math.sin(pn(l)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:l,c:u,r0:f}=this,p=pn(e-this.center[0]),y=pn(n),b=Math.sqrt(u-2*l*Math.sin(y))/l;return{x:b*Math.sin(p*l),y:b*Math.cos(p*l)-f,z:0}}unproject(e,n){const{n:l,c:u,r0:f}=this,p=f+n;let y=Math.atan2(e,Math.abs(p))*Math.sign(p);p*l<0&&(y-=Math.PI*Math.sign(e)*Math.sign(p));const b=pn(this.center[0])*l;y=$e(y,-Math.PI-b,Math.PI-b);const S=ge(Be(y/l)+this.center[0],-180,180),A=Math.asin(ge((u-(e*e+p*p)*l*l)/(2*l),-1,1)),P=ge(Be(A),-_e,_e);return new D(S,P)}}const v_=1.340264,w_=-.081106,b_=893e-6,S_=.003796,Fv=Math.sqrt(3)/2;class r5 extends qu{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const l=Math.asin(Fv*Math.sin(n)),u=l*l,f=u*u*u;return{x:.5*(e*Math.cos(l)/(Fv*(v_+3*w_*u+f*(7*b_+9*S_*u)))/Math.PI+.5),y:1-.5*(l*(v_+w_*u+f*(b_+S_*u))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let l=n=(2*(1-n)-1)*Math.PI,u=l*l,f=u*u*u;for(let A,P,M,N=0;N<12&&(P=l*(v_+w_*u+f*(b_+S_*u))-n,M=v_+3*w_*u+f*(7*b_+9*S_*u),A=P/M,l=ge(l-A,-Math.PI/3,Math.PI/3),u=l*l,f=u*u*u,!(Math.abs(A)<1e-12));++N);const p=Fv*e*(v_+3*w_*u+f*(7*b_+9*S_*u))/Math.cos(l),y=Math.asin(Math.sin(l)/Fv),b=ge(180*p/Math.PI,-180,180),S=ge(180*y/Math.PI,-_e,_e);return new D(b,S)}}class s5 extends qu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const l=360*(e-.5),u=ge(360*(.5-n),-_e,_e);return new D(l,u)}}const bp=Math.PI/2;function jv(r){return Math.tan((bp+r)/2)}class o5 extends qu{constructor(e){super(e),this.center=e.center||[0,30];const[n,l]=this.parallels=e.parallels||[30,30];let u=pn(n),f=pn(l);this.southernCenter=u+f<0,this.southernCenter&&(u=-u,f=-f);const p=Math.cos(u),y=jv(u);this.n=u===f?Math.sin(u):Math.log(p/Math.cos(f))/Math.log(jv(f)/y),this.f=p*Math.pow(jv(u),this.n)/this.n}project(e,n){n=pn(n),this.southernCenter&&(n=-n),e=pn(e-this.center[0]);const l=1e-6,{n:u,f}=this;f>0?n<-bp+l&&(n=-bp+l):n>bp-l&&(n=bp-l);const p=f/Math.pow(jv(n),u);let y=p*Math.sin(u*e),b=f-p*Math.cos(u*e);return y=.5*(y/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:y,y:this.southernCenter?b:1-b,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:l,f:u}=this,f=u-n,p=Math.sign(f),y=Math.sign(l)*Math.sqrt(e*e+f*f);let b=Math.atan2(e,Math.abs(f))*p;f*l<0&&(b-=Math.PI*Math.sign(e)*p);const S=ge(Be(b/l)+this.center[0],-180,180),A=ge(Be(2*Math.atan(Math.pow(u/y,1/l))-bp),-_e,_e);return new D(S,this.southernCenter?-A:A)}}class PP extends qu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:$(e),y:X(n),z:0}}unproject(e,n){const l=ne(e),u=ae(n);return new D(l,u)}}const MP=pn(_e);class a5 extends qu{project(e,n){const l=(n=pn(n))*n,u=l*l;return{x:.5*((e=pn(e))*(.8707-.131979*l+u*(u*(.003971*l-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+l*(.015085+u*(.028874*l-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let l=n=(2*(1-n)-1)*Math.PI,u=25,f=0,p=l*l;do{p=l*l;const S=p*p;f=(l*(1.007226+p*(.015085+S*(.028874*p-.044475-.005916*S)))-n)/(1.007226+p*(.045255+S*(.259866*p-.311325-.005916*11*S))),l=ge(l-f,-MP,MP)}while(Math.abs(f)>1e-6&&--u>0);p=l*l;const y=ge(Be(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),b=Be(l);return new D(y,b)}}const RP=pn(_e);class l5 extends qu{project(e,n){n=pn(n),e=pn(e);const l=Math.cos(n),u=2/Math.PI,f=Math.acos(l*Math.cos(e/2)),p=Math.sin(f)/f,y=.5*(e*u+2*l*Math.sin(e/2)/p)||0,b=.5*(n+Math.sin(n)/p)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,n){let l=e=(2*e-.5)*Math.PI,u=n=(2*(1-n)-1)*Math.PI,f=25;const p=1e-6;let y=0,b=0;do{const S=Math.cos(u),A=Math.sin(u),P=2*A*S,M=A*A,N=S*S,L=Math.cos(l/2),U=Math.sin(l/2),H=2*L*U,K=U*U,se=1-N*L*L,re=se?1/se:0,le=se?Math.acos(S*L)*Math.sqrt(1/se):0,Ee=.5*(2*le*S*U+2*l/Math.PI)-e,we=.5*(le*A+u)-n,Se=.5*re*(N*K+le*S*L*M)+1/Math.PI,Me=re*(H*P/4-le*A*U),De=.125*re*(P*U-le*A*N*H),Xe=.5*re*(M*L+le*K*S)+.5,Le=Me*De-Xe*Se;y=(we*Me-Ee*Xe)/Le,b=(Ee*De-we*Se)/Le,l=ge(l-y,-Math.PI,Math.PI),u=ge(u-b,-RP,RP)}while((Math.abs(y)>p||Math.abs(b)>p)&&--f>0);return new D(Be(l),Be(u))}}class DP extends qu{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(pn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:l,cosPhi:u}=this;return{x:pn(e)*u*l+.5,y:-Math.sin(pn(n))/u*l+.5,z:0}}unproject(e,n){const{scale:l,cosPhi:u}=this,f=-(n-.5)/l,p=ge(Be((e-.5)/l)/u,-180,180),y=Math.asin(ge(f*u,-1,1)),b=ge(Be(y),-_e,_e);return new D(p,b)}}class c5 extends PP{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,l){const u=Zg(e,n,l);return Ri(u,u,pv(Kl(l))),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,n,l){const u=T(n.lat,n.lng),f=wi([],u),p=l?e._centerAltitude+l:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude;gi(u,u,f,Z(1,0)*Et*p);const y=J(new Float64Array(16));return oe(y,e.pixelMatrix,e.globeMatrix),Ri(u,u,y),new ht(u[0],u[1])}pixelsPerMeter(e,n){return Z(1,0)*n}pixelSpaceConversion(e,n,l){const u=Z(1,e)*n,f=si(Z(1,45)*n,u,l);return this.pixelsPerMeter(e,n)/f}createTileMatrix(e,n,l){const u=Tb(Kl(l.canonical));return oe(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,n){const{center:l}=e,u=pv(Kl(n));return pe(u,u,pn(l.lng)),Ie(u,u,pn(l.lat)),Q(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,n,l,u){return nA(e,n,l,!0)||new ve(0,0)}pointCoordinate3D(e,n,l){const u=this.pointCoordinate(e,n,l,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,n){return!nA(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=function(u,f){const p=u.cameraToCenterDistance,y=u._centerAltitude*f,b=u._camera,S=u._camera.forward(),A=Nt([],jt([],S,-p),[0,0,y]),P=u.worldSize/(2*Math.PI),M=[0,0,-P],N=u.width/u.height,L=Math.tan(u.fovAboveCenter),U=jt([],b.up(),L),H=jt([],b.right(),L*N),K=wi([],Nt([],Nt([],S,U),H)),se=[];let re;if(new un(A,K).closestPointOnSphere(M,P,se)){const le=Nt([],se,M),Ee=On([],le,A);re=Math.cos(u.fovAboveCenter)*Kt(Ee)}else{const le=On([],A,M),Ee=On([],M,A);wi(Ee,Ee);const we=Kt(le)-P;re=Math.sqrt(we*(we+2*P));const Se=Math.acos(re/(P+we))-Math.acos(ni(S,Ee));re*=Math.cos(Se)}return 1.01*re}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),l=Bu(e.zoom);if(l>0){const u=AP(e,Z(1,e.center.lat)*e.worldSize),f=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return si(n,u+f*(1-Math.cos(p)),Math.pow(l,10))}return n}upVector(e,n,l){return Zg(n,l,e,1)}upVectorScale(e){return{metersToTile:dv(fv(Kl(e)))}}}function kP(r){const e=r.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(r.name){case"mercator":return new PP(r);case"equirectangular":return new s5(r);case"naturalEarth":return new a5(r);case"equalEarth":return new r5(r);case"winkelTripel":return new l5(r);case"albers":return n?new DP(r):new n5(r);case"lambertConformalConic":return n?new DP(r):new o5(r);case"globe":return new c5(r)}throw new Error(`Invalid projection name: ${r.name}`)}const u5=je.types,d5=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Bv(r,e,n,l,u,f,p,y,b,S,A,P,M){const N=y?Math.min(Hu,Math.round(y[0])):0,L=y?Math.min(Hu,Math.round(y[1])):0;r.emplaceBack(e,n,Math.round(32*l),Math.round(32*u),f,p,(N<<1)+(b?1:0),L,16*S,16*A,256*P,256*M)}function Vv(r,e,n){r.emplaceBack(e,n)}function Uv(r,e,n,l,u,f,p){r.emplaceBack(e,n,l,u,f,p)}const Gv=(r,e,n,l)=>{for(let u=0;u<e;u++)r.emplaceBack(n[0],n[1],n[2],l[0],l[1],l[2])};function $v(r,e,n,l,u){r.emplaceBack(e,n,l,u),r.emplaceBack(e,n,l,u),r.emplaceBack(e,n,l,u),r.emplaceBack(e,n,l,u)}function h5(r){for(const e of r.sections)if(cb(e.text))return!0;return!1}class g2{constructor(e){this.layoutVertexArray=new np,this.indexArray=new Qn,this.programConfigurations=e,this.segments=new rr,this.dynamicLayoutVertexArray=new Wl,this.opacityVertexArray=new Rg,this.placedSymbolArray=new bh,this.iconTransitioningVertexArray=new za,this.globeExtVertexArray=new Ru,this.zOffsetVertexArray=new Rc,this.orientationVertexArray=new Ng}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,n,l,u,f){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,_B.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,xB.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,d5,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,bB.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,yB.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||f)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,vB.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,wB.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Bt(g2,"SymbolBuffers");class _2{constructor(e,n,l){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new l,this.segments=new rr,this.collisionVertexArray=new ku,this.collisionVertexArrayExt=new Wl}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,SB.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,TB.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Bt(_2,"CollisionBuffers");class Hv{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=J([]),this.placementViewportMatrix=J([]);const n=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=lP(this.zoom,n["text-size"],this.worldview),this.iconSizeData=lP(this.zoom,n["icon-size"],this.worldview);const l=this.layers[0].layout,u=l.get("symbol-sort-key"),f=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(p=>Vo[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1}createArrays(){this.text=new g2(new Lo(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new g2(new Lo(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Ug,this.lineVertexArray=new Qx,this.symbolInstances=new Jx}calculateGlyphDependencies(e,n,l,u,f){for(const p of e){const y=p.codePointAt(0);if(y===void 0)break;if(n[y]=!0,u&&f&&y<=65535){const b=f_[p];b&&(n[b.charCodeAt(0)]=!0)}}}updateFootprints(e,n){}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;const l=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!vv(this.activeReplacements,l)&&(this.activeReplacements=l,!0)}populate(e,n,l,u){const f=this.layers[0],p=f.layout,y=this.projection.name==="globe",b=p.get("text-font"),S=p.get("text-field"),A=p.get("icon-image"),[P,M]=p.get("icon-size-scale-range"),N=ge(n.scaleFactor||1,P,M),L=(S.value.kind!=="constant"||S.value.value instanceof Hs&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),U=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,H=p.get("symbol-sort-key");if(this.features=[],!L&&!U)return;const K=n.iconDependencies,se=n.glyphDependencies,re=n.availableImages,le=new Pn(this.zoom,{worldview:this.worldview});for(const{feature:Ee,id:we,index:Se,sourceLayerIndex:Me}of e){const De=f._featureFilter.needGeometry,Xe=qe(Ee,De);if(!f._featureFilter.filter(le,Xe,l))continue;if(De||(Xe.geometry=Ae(Ee,l,u)),y&&Ee.type!==1&&l.z<=5){const ut=Xe.geometry,gt=.98078528056,We=(dt,ze)=>ni(Zg(dt.x,dt.y,l,1),Zg(ze.x,ze.y,l,1))<gt;for(let dt=0;dt<ut.length;dt++)ut[dt]=Ue(ut[dt],We)}let Le,Je;if(L){const ut=f.getValueAndResolveTokens("text-field",Xe,l,re),gt=Hs.factory(ut);h5(gt)&&(this.hasRTLText=!0),(!this.hasRTLText||Tg()==="unavailable"||this.hasRTLText&&Na.isParsed())&&(Le=CB(gt,f,Xe))}if(U){const ut=f.getValueAndResolveTokens("icon-image",Xe,l,re);Je=typeof ut=="string"?oo.build(ut):ut}if(!Le&&!Je)continue;const yt=this.sortFeaturesByKey?H.evaluate(Xe,{},l):void 0,tt={id:we,text:Le,icon:Je,index:Se,sourceLayerIndex:Me,geometry:Xe.geometry,properties:Ee.properties,type:u5[Ee.type],sortKey:yt};if(this.features.push(tt),Je){const ut=this.layers[0]._unevaluatedLayout._values,{iconPrimary:gt,iconSecondary:We}=SP(Je,this.iconSizeData,ut["icon-size"],l,this.zoom,tt,this.pixelRatio,N,this.worldview),dt=gt.id.toString();if(K.has(dt)?K.get(dt).push(gt):K.set(dt,[gt]),We){this.hasAnySecondaryIcon=!0;const ze=We.id.toString();K.has(ze)?K.get(ze).push(We):K.set(ze,[We])}}if(Le){const ut=b.evaluate(Xe,{},l).join(","),gt=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Vo.vertical)>=0;for(const We of Le.sections)if(We.image){const dt=We.image.getPrimary().scaleSelf(this.pixelRatio),ze=dt.id.toString(),Ze=K.get(ze)||[];Ze.push(dt),K.set(ze,Ze)}else{const dt=vg(Le.toString()),ze=We.fontStack||ut,Ze=se[ze]=se[ze]||{};this.calculateGlyphDependencies(We.text,Ze,gt,this.allowVerticalPlacement,dt)}}}if(p.get("symbol-placement")==="line"&&(this.features=function(Ee){const we={},Se={},Me=[];let De=0;function Xe(tt){Me.push(Ee[tt]),De++}function Le(tt,ut,gt){const We=Se[tt];return delete Se[tt],Se[ut]=We,Me[We].geometry[0].pop(),Me[We].geometry[0]=Me[We].geometry[0].concat(gt[0]),We}function Je(tt,ut,gt){const We=we[ut];return delete we[ut],we[tt]=We,Me[We].geometry[0].shift(),Me[We].geometry[0]=gt[0].concat(Me[We].geometry[0]),We}function yt(tt,ut,gt){const We=gt?ut[0][ut[0].length-1]:ut[0][0];return`${tt}:${We.x}:${We.y}`}for(let tt=0;tt<Ee.length;tt++){const ut=Ee[tt],gt=ut.geometry,We=ut.text?ut.text.toString():null;if(!We){Xe(tt);continue}const dt=yt(We,gt),ze=yt(We,gt,!0);if(dt in Se&&ze in we&&Se[dt]!==we[ze]){const Ze=Je(dt,ze,gt),wt=Le(dt,ze,Me[Ze].geometry);delete we[dt],delete Se[ze],Se[yt(We,Me[wt].geometry,!0)]=wt,Me[Ze].geometry=null}else dt in Se?Le(dt,ze,gt):ze in we?Je(dt,ze,gt):(Xe(tt),we[dt]=De-1,Se[ze]=De-1)}return Me.filter(tt=>tt.geometry)}(this.features)),p.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",n.elevationFeatures){!this.elevationFeatures&&n.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ee of n.elevationFeatures)this.elevationFeatureIdToIndex.set(Ee.id,this.elevationFeatures.length),this.elevationFeatures.push(Ee)}}else p.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Ee,we)=>Ee.sortKey-we.sortKey)}update(e,n,l,u,f,p,y){this.text.programConfigurations.updatePaintArrays(e,n,f,l,u,p,y,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,n,f,l,u,p,y,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let n=!1;const l=xe(e),u=1/l;let f=!1,p=!1;for(let y=0;y<this.symbolInstances.length;y++){const b=this.symbolInstances.get(y),S=Pt(1,0,0),A=Pt(0,1,0),{numHorizontalGlyphVertices:P,numVerticalGlyphVertices:M,numIconVertices:N,numVerticalIconVertices:L}=b,U=P>0||M>0,H=N>0,K=this.elevationFeatures[b.elevationFeatureIndex];if(K){const se=new ht(b.tileAnchorX,b.tileAnchorY),re=.075+K.pointElevation(se);b.zOffset!==re&&(n=!0,b.zOffset=re);const le=K.computeSlopeNormal(se,u),Ee=mo(Rt(),Pt(0,0,1),le);Cn(S,S,Ee),Cn(A,A,Ee),S[2]*=l,A[2]*=l,S[0]===1&&S[1]===0&&S[2]===0&&A[0]===0&&A[1]===1&&A[2]===0||(f=f||U,p=p||H)}if(U&&(Gv(this.text.orientationVertexArray,P,S,A),Gv(this.text.orientationVertexArray,M,S,A)),H){const{placedIconSymbolIndex:se,verticalPlacedIconSymbolIndex:re}=b;se>=0&&Gv(this.icon.orientationVertexArray,N,S,A),re>=0&&Gv(this.icon.orientationVertexArray,L,S,A)}}f||(this.text.orientationVertexArray=void 0),p||(this.icon.orientationVertexArray=void 0),n&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(f,p,y)=>{l+=p,l>f.length&&f.resize(l);for(let b=-p;b<0;b++)f.emplace(b+l,y)},n=(f,p,y)=>{u+=p,u>f.length&&f.resize(u);for(let b=-p;b<0;b++)f.emplace(b+u,y)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let l=0,u=0;for(let f=0;f<this.symbolInstances.length;f++){const p=this.symbolInstances.get(f),{numHorizontalGlyphVertices:y,numVerticalGlyphVertices:b,numIconVertices:S}=p,A=p.zOffset,P=S>0;if((y>0||b>0)&&(e(this.text.zOffsetVertexArray,y,A),e(this.text.zOffsetVertexArray,b,A)),P){const{placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:N}=p;M>=0&&n(this.icon.zOffsetVertexArray,S,A),N>=0&&n(this.icon.zOffsetVertexArray,p.numVerticalIconVertices,A)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=kP(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const l=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:u,y:f}of n)this.lineVertexArray.emplaceBack(u,f);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,n,l,u,f,p,y,b,S,A,P,M,N,L,U,H){const K=e.indexArray,se=e.layoutVertexArray,re=e.globeExtVertexArray,le=e.segments.prepareSegment(4*n.length,se,K,this.canOverlap?p.sortKey:void 0),Ee=this.glyphOffsetArray.length,we=le.vertexLength,Se=this.allowVerticalPlacement&&y===Vo.vertical?Math.PI/2:0,Me=p.text&&p.text.sections;for(let Xe=0;Xe<n.length;Xe++){const{tl:Le,tr:Je,bl:yt,br:tt,texPrimary:ut,texSecondary:gt,pixelOffsetTL:We,pixelOffsetBR:dt,minFontScaleX:ze,minFontScaleY:Ze,glyphOffset:wt,isSDF:ft,sectionIndex:Zt}=n[Xe],Ut=le.vertexLength,lt=wt[1];if(Bv(se,S.x,S.y,Le.x,lt+Le.y,ut.x,ut.y,l,ft,We.x,We.y,ze,Ze),Bv(se,S.x,S.y,Je.x,lt+Je.y,ut.x+ut.w,ut.y,l,ft,dt.x,We.y,ze,Ze),Bv(se,S.x,S.y,yt.x,lt+yt.y,ut.x,ut.y+ut.h,l,ft,We.x,dt.y,ze,Ze),Bv(se,S.x,S.y,tt.x,lt+tt.y,ut.x+ut.w,ut.y+ut.h,l,ft,dt.x,dt.y,ze,Ze),b){const{x:pt,y:$t,z:zt}=b.anchor,[At,Ot,li]=b.up;Uv(re,pt,$t,zt,At,Ot,li),Uv(re,pt,$t,zt,At,Ot,li),Uv(re,pt,$t,zt,At,Ot,li),Uv(re,pt,$t,zt,At,Ot,li),$v(e.dynamicLayoutVertexArray,pt,$t,zt,Se)}else $v(e.dynamicLayoutVertexArray,S.x,S.y,S.z,Se);if(H){const pt=gt||ut;Vv(e.iconTransitioningVertexArray,pt.x,pt.y),Vv(e.iconTransitioningVertexArray,pt.x+pt.w,pt.y),Vv(e.iconTransitioningVertexArray,pt.x,pt.y+pt.h),Vv(e.iconTransitioningVertexArray,pt.x+pt.w,pt.y+pt.h)}K.emplaceBack(Ut,Ut+1,Ut+2),K.emplaceBack(Ut+1,Ut+2,Ut+3),le.vertexLength+=4,le.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(wt[0]),Xe!==n.length-1&&Zt===n[Xe+1].sectionIndex||e.programConfigurations.populatePaintArrays(se.length,p,p.index,{},N,L,U,Me&&Me[Zt],this.worldview)}const De=b?b.anchor:S;e.placedSymbolArray.emplaceBack(De.x,De.y,De.z,S.x,S.y,Ee,this.glyphOffsetArray.length-Ee,we,A,P,S.segment,l?l[0]:0,l?l[1]:0,u[0],u[1],y,0,0,0,M,0)}_commitLayoutVertex(e,n,l,u,f,p,y){e.emplaceBack(n,l,u,f,p,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,n,l,u,f,p,y){const b=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),S=b.vertexLength,A=y.tileAnchorX,P=y.tileAnchorY;for(let N=0;N<4;N++)l.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(l.collisionVertexArrayExt,n,e.padding,y.zOffset),this._commitLayoutVertex(l.layoutVertexArray,u,f,p,A,P,new ht(e.x1,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,u,f,p,A,P,new ht(e.x2,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,u,f,p,A,P,new ht(e.x2,e.y2)),this._commitLayoutVertex(l.layoutVertexArray,u,f,p,A,P,new ht(e.x1,e.y2)),b.vertexLength+=4;const M=l.indexArray;M.emplaceBack(S,S+1),M.emplaceBack(S+1,S+2),M.emplaceBack(S+2,S+3),M.emplaceBack(S+3,S),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,l,u,f,p){for(let y=u;y<f;y++){const b=l.get(y),S=this.getSymbolInstanceTextSize(e,p,n,y);this._addCollisionDebugVertices(b,S,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,n,l,u,f,p){for(let y=u;y<f;y++){const b=l.get(y),S=this.getSymbolInstanceIconSize(e,n,p.placedIconSymbolIndex);this._addCollisionDebugVertices(b,S,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,n,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new _2(rp,WI.members,za),this.iconCollisionBox=new _2(rp,WI.members,za);const u=m_(this.iconSizeData,e),f=m_(this.textSizeData,e,l);for(let p=0;p<this.symbolInstances.length;p++){const y=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(f,e,n,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(f,e,n,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(u,e,n,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(u,e,n,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(e,n,l,u){const f=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:u),p=c2(this.textSizeData,e,f)/hs;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,n,l){const u=this.icon.placedSymbolArray.get(l),f=c2(this.iconSizeData,e,u);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,n,l,u){e.emplaceBack(n,-l,-l,u),e.emplaceBack(n,l,-l,u),e.emplaceBack(n,l,l,u),e.emplaceBack(n,-l,l,u)}_updateTextDebugCollisionBoxes(e,n,l,u,f,p,y){for(let b=u;b<f;b++){const S=l.get(b),A=this.getSymbolInstanceTextSize(e,p,n,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,A,S.padding,p.zOffset)}}_updateIconDebugCollisionBoxes(e,n,l,u,f,p,y){for(let b=u;b<f;b++){const S=l.get(b),A=this.getSymbolInstanceIconSize(e,n,p.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,A,S.padding,p.zOffset)}}updateCollisionDebugBuffers(e,n,l,u){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const f=m_(this.iconSizeData,e,u),p=m_(this.textSizeData,e,l);for(let y=0;y<this.symbolInstances.length;y++){const b=this.symbolInstances.get(y);this._updateTextDebugCollisionBoxes(p,e,n,b.textBoxStartIndex,b.textBoxEndIndex,b,l),this._updateTextDebugCollisionBoxes(p,e,n,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b,l),this._updateIconDebugCollisionBoxes(f,e,n,b.iconBoxStartIndex,b.iconBoxEndIndex,b,u),this._updateIconDebugCollisionBoxes(f,e,n,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b,u)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,l,u,f,p,y,b,S){const A={};if(n<l){const{x1:P,y1:M,x2:N,y2:L,padding:U,projectedAnchorX:H,projectedAnchorY:K,projectedAnchorZ:se,tileAnchorX:re,tileAnchorY:le,featureIndex:Ee}=e.get(n);A.textBox={x1:P,y1:M,x2:N,y2:L,padding:U,projectedAnchorX:H,projectedAnchorY:K,projectedAnchorZ:se,tileAnchorX:re,tileAnchorY:le},A.textFeatureIndex=Ee}if(u<f){const{x1:P,y1:M,x2:N,y2:L,padding:U,projectedAnchorX:H,projectedAnchorY:K,projectedAnchorZ:se,tileAnchorX:re,tileAnchorY:le,featureIndex:Ee}=e.get(u);A.verticalTextBox={x1:P,y1:M,x2:N,y2:L,padding:U,projectedAnchorX:H,projectedAnchorY:K,projectedAnchorZ:se,tileAnchorX:re,tileAnchorY:le},A.verticalTextFeatureIndex=Ee}if(p<y){const{x1:P,y1:M,x2:N,y2:L,padding:U,projectedAnchorX:H,projectedAnchorY:K,projectedAnchorZ:se,tileAnchorX:re,tileAnchorY:le,featureIndex:Ee}=e.get(p);A.iconBox={x1:P,y1:M,x2:N,y2:L,padding:U,projectedAnchorX:H,projectedAnchorY:K,projectedAnchorZ:se,tileAnchorX:re,tileAnchorY:le},A.iconFeatureIndex=Ee}if(b<S){const{x1:P,y1:M,x2:N,y2:L,padding:U,projectedAnchorX:H,projectedAnchorY:K,projectedAnchorZ:se,tileAnchorX:re,tileAnchorY:le,featureIndex:Ee}=e.get(b);A.verticalIconBox={x1:P,y1:M,x2:N,y2:L,padding:U,projectedAnchorX:H,projectedAnchorY:K,projectedAnchorZ:se,tileAnchorX:re,tileAnchorY:le},A.verticalIconFeatureIndex=Ee}return A}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const l=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){const l=e.placedSymbolArray.get(n),u=l.vertexStartIndex+4*l.numGlyphs;for(let f=l.vertexStartIndex;f<u;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),l=Math.cos(e),u=[],f=[],p=[];for(let y=0;y<this.symbolInstances.length;++y){p.push(y);const b=this.symbolInstances.get(y);u.push(0|Math.round(n*b.tileAnchorX+l*b.tileAnchorY)),f.push(b.featureIndex)}return p.sort((y,b)=>u[y]-u[b]||f[b]-f[y]),p}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===n?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const l=this.symbolInstances.get(n);this.featureSortOrder.push(l.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:S}=l;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),f>=0&&f!==u&&this.addIndicesForPlacedSymbol(this.text,f),p>=0&&p!==f&&p!==u&&this.addIndicesForPlacedSymbol(this.text,p),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let NP,LP,y2;Bt(Hv,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Hv.addDynamicAttributes=$v;class zP{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:cu,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Bt(zP,"FormatSectionOverride",{omit:["defaultValue"]});const x2=()=>y2||(y2={layout:NP||(NP=new xr({"symbol-placement":new xt(Ne.layout_symbol["symbol-placement"]),"symbol-spacing":new xt(Ne.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new xt(Ne.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new kt(Ne.layout_symbol["symbol-sort-key"]),"symbol-z-order":new xt(Ne.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new xt(Ne.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new xt(Ne.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new xt(Ne.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new xt(Ne.layout_symbol["icon-ignore-placement"]),"icon-optional":new xt(Ne.layout_symbol["icon-optional"]),"icon-rotation-alignment":new xt(Ne.layout_symbol["icon-rotation-alignment"]),"icon-size":new kt(Ne.layout_symbol["icon-size"]),"icon-size-scale-range":new xt(Ne.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new kt(Ne.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new kt(Ne.layout_symbol["icon-text-fit-padding"]),"icon-image":new kt(Ne.layout_symbol["icon-image"]),"icon-rotate":new kt(Ne.layout_symbol["icon-rotate"]),"icon-padding":new xt(Ne.layout_symbol["icon-padding"]),"icon-keep-upright":new xt(Ne.layout_symbol["icon-keep-upright"]),"icon-offset":new kt(Ne.layout_symbol["icon-offset"]),"icon-anchor":new kt(Ne.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new xt(Ne.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new xt(Ne.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new xt(Ne.layout_symbol["text-rotation-alignment"]),"text-field":new kt(Ne.layout_symbol["text-field"]),"text-font":new kt(Ne.layout_symbol["text-font"]),"text-size":new kt(Ne.layout_symbol["text-size"]),"text-size-scale-range":new xt(Ne.layout_symbol["text-size-scale-range"]),"text-max-width":new kt(Ne.layout_symbol["text-max-width"]),"text-line-height":new kt(Ne.layout_symbol["text-line-height"]),"text-letter-spacing":new kt(Ne.layout_symbol["text-letter-spacing"]),"text-justify":new kt(Ne.layout_symbol["text-justify"]),"text-radial-offset":new kt(Ne.layout_symbol["text-radial-offset"]),"text-variable-anchor":new xt(Ne.layout_symbol["text-variable-anchor"]),"text-anchor":new kt(Ne.layout_symbol["text-anchor"]),"text-max-angle":new xt(Ne.layout_symbol["text-max-angle"]),"text-writing-mode":new xt(Ne.layout_symbol["text-writing-mode"]),"text-rotate":new kt(Ne.layout_symbol["text-rotate"]),"text-padding":new xt(Ne.layout_symbol["text-padding"]),"text-keep-upright":new xt(Ne.layout_symbol["text-keep-upright"]),"text-transform":new kt(Ne.layout_symbol["text-transform"]),"text-offset":new kt(Ne.layout_symbol["text-offset"]),"text-allow-overlap":new xt(Ne.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new xt(Ne.layout_symbol["text-ignore-placement"]),"text-optional":new xt(Ne.layout_symbol["text-optional"]),visibility:new xt(Ne.layout_symbol.visibility)})),paint:LP||(LP=new xr({"icon-opacity":new kt(Ne.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new kt(Ne.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new kt(Ne.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new kt(Ne.paint_symbol["text-emissive-strength"]),"icon-color":new kt(Ne.paint_symbol["icon-color"]),"icon-halo-color":new kt(Ne.paint_symbol["icon-halo-color"]),"icon-halo-width":new kt(Ne.paint_symbol["icon-halo-width"]),"icon-halo-blur":new kt(Ne.paint_symbol["icon-halo-blur"]),"icon-translate":new xt(Ne.paint_symbol["icon-translate"]),"icon-translate-anchor":new xt(Ne.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new xt(Ne.paint_symbol["icon-image-cross-fade"]),"text-opacity":new kt(Ne.paint_symbol["text-opacity"]),"text-occlusion-opacity":new kt(Ne.paint_symbol["text-occlusion-opacity"]),"text-color":new kt(Ne.paint_symbol["text-color"],{runtimeType:yo,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new kt(Ne.paint_symbol["text-halo-color"]),"text-halo-width":new kt(Ne.paint_symbol["text-halo-width"]),"text-halo-blur":new kt(Ne.paint_symbol["text-halo-blur"]),"text-translate":new xt(Ne.paint_symbol["text-translate"]),"text-translate-anchor":new xt(Ne.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new xt(Ne.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new xt(Ne.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new xt(Ne.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new xt(Ne.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new kt(Ne.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},y2);class qv extends Os{constructor(e,n,l,u){super(e,x2(),n,l,u),this._colorAdjustmentMatrix=J([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const u=[];for(const f of l)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,n,l,u){return this._saturation===e&&this._contrast===n&&this._brightnessMin===l&&this._brightnessMax===u||(this._colorAdjustmentMatrix=function(f,p,y,b){f=Ns(f),p=ro(p);const S=ue(),A=f/3,P=1-2*A,M=[P,A,A,0,A,P,A,0,A,A,P,0,0,0,0,1],N=.5-.5*p,L=b-y;return oe(S,[L,0,0,0,0,L,0,0,0,0,L,0,y,y,y,1],[p,0,0,0,0,p,0,0,0,0,p,0,N,N,N,1]),oe(S,S,M),S}(e,n,l,u),this._saturation=e,this._contrast=n,this._brightnessMin=l,this._brightnessMax=u),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,n,l,u){const f=this.layout.get(e).evaluate(n,{},l,u),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||gg(p.value)||!f?f:function(y,b){return b.replace(/{([^{}]+)}/g,(S,A)=>A in y?String(y[A]):"")}(n.properties,f)}createBucket(e){return new Hv(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of x2().paint.overridableProperties){if(!qv.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),l=new zP(n),u=new mg(l,n.property.specification,this.scope,this.options);let f=null;f=n.value.kind==="constant"||n.value.kind==="source"?new Hf("source",u):new Ul("composite",u,n.value.zoomStops,n.value.interpolationType),this.paint._values[e]=new Mc(n.property,f,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,l){return!(!this.layout||n.isDataDriven()||l.isDataDriven())&&qv.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const l=e.get("text-field"),u=x2().paint.properties[n];let f=!1;const p=y=>{for(const b of y)if(u.overrides&&u.overrides.hasOverride(b))return void(f=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Hs)p(l.value.value.sections);else if(l.value.kind==="source"){const y=S=>{f||(S instanceof pi&&Ft(S.value)===Qd?p(S.value.sections):S instanceof du?p(S.sections):S.eachChild(y))},b=l.value;b._styleExpression&&y(b._styleExpression.expression)}return f}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,n,l){return{config:new Zs(this,{zoom:n,lut:l}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let OP,FP,jP,BP;var v2=Qi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Wv(r,e,n,l,u,f,p,y){const b=[r,e,1,n,l,1,u,f,1],S=[p,y,1],A=B([],b),[P,M,N]=kn(S,S,A);return te(b,b,[P,0,0,0,M,0,0,0,N])}function VP(r,e,n,l,u,f,p,y){const b=function(S,A,P,M,N,L,U,H){const K=Wv(0,0,1,0,1,1,0,1),se=Wv(S,A,P,M,N,L,U,H);return te(se,se,B([],K))}(r,e,n,l,u,f,p,y);return[b[2]/b[8]/Et,b[5]/b[8]/Et]}function Zv(r){return[r[0],Math.min(Math.max(r[1],-_e),_e)]}class UP extends xc{constructor(e,n,l,u){super(),this.id=e,this.dispatcher=l,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(u),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new Qa("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Xd(this.map._requestManager.transformRequest(this.url,qd.Image),(l,u)=>{this._imageRequest=null,this._loaded=!0,l?this.fire(new Mo(l)):u&&(this.image=u instanceof HTMLImageElement?fa.getImageData(u):u,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new u_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Qa("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof u_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],l=e[0][1];for(const f of e)f[1]>l&&(l=f[1]),f[1]<n&&(n=f[1]);const u=(l+n)/2;if(u>_e?this.onNorthPole=!0:u<-_e&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const f=e.map(ve.fromLngLat);this.tileID=function(p){let y=1/0,b=1/0,S=-1/0,A=-1/0;for(const U of p)y=Math.min(y,U.x),b=Math.min(b,U.y),S=Math.max(S,U.x),A=Math.max(A,U.y);const P=Math.max(S-y,A-b),M=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),N=Math.pow(2,M);let L=Math.floor((y+S)/2*N);return L>1&&(L-=1),new Fo(M,L,Math.floor((b+A)/2*N))}(f),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Qa("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof u_||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const K in this.tiles){const se=this.tiles[K];se.state!=="loaded"&&(se.state="loaded",se.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const n=x_(new Fo(0,0,0),this.map.transform.projection),l=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(K){const se=K[1].x-K[0].x,re=K[1].y-K[0].y,le=K[2].x-K[1].x,Ee=K[2].y-K[1].y,we=K[3].x-K[2].x,Se=K[3].y-K[2].y,Me=K[0].x-K[3].x,De=K[0].y-K[3].y,Xe=se*Ee-le*re,Le=le*Se-we*Ee,Je=we*De-Me*Se,yt=Me*re-se*De;return Xe>0&&Le>0&&Je>0&&yt>0||Xe<0&&Le<0&&Je<0&&yt<0}(l))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const u=x_(this.tileID,this.map.transform.projection),[f,p,y,b]=this.coordinates.map(K=>{const se=u.projection.project(K[0],K[1]);return IP(u,se)._round()});this.perspectiveTransform=VP(f.x,f.y,p.x,p.y,y.x,y.y,b.x,b.y);const S=this._boundsArray=new Pu;S.emplaceBack(f.x,f.y,0,0),S.emplaceBack(p.x,p.y,Et,0),S.emplaceBack(b.x,b.y,0,Et),S.emplaceBack(y.x,y.y,Et,Et),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(S,v2.members),this.boundsSegments=rr.simpleSegment(0,0,4,2);const A=[],P=[Zv((M=this.coordinates)[0]),Zv(M[1]),Zv(M[2]),Zv(M[3])];var M;const[N,L,U,H]=function(K){let se=K[0][0],re=se,le=K[0][1],Ee=le;for(let we=1;we<K.length;we++)K[we][0]<se?se=K[we][0]:K[we][0]>re&&(re=K[we][0]),K[we][1]<le?le=K[we][1]:K[we][1]>Ee&&(Ee=K[we][1]);return[se,le,re-se,Ee-le]}(P);{const K=new Pu,[se,re,le,Ee]=function(We){let dt=We[0].x,ze=dt,Ze=We[0].y,wt=Ze;for(let ft=1;ft<We.length;ft++)We[ft].x<dt?dt=We[ft].x:We[ft].x>ze&&(ze=We[ft].x),We[ft].y<Ze?Ze=We[ft].y:We[ft].y>wt&&(wt=We[ft].y);return[dt,Ze,ze-dt,wt-Ze]}(l),we=We=>[(We.x-se)/le,(We.y-re)/Ee],[Se,Me,De,Xe]=l.map(we),Le=function(We,dt,ze,Ze,wt,ft,Zt,Ut){const lt=Wv(0,0,1,0,1,1,0,1);return te(lt,lt,B([],Wv(We,dt,ze,Ze,wt,ft,Zt,Ut)))}(Se[0],Se[1],Me[0],Me[1],De[0],De[1],Xe[0],Xe[1]);this.elevatedGlobePerspectiveTransform=VP(Se[0],Se[1],Me[0],Me[1],De[0],De[1],Xe[0],Xe[1]);const Je=(We,dt)=>{A.push(We.lng);const ze=Math.round((We.lng-N)/U*Et),Ze=Math.round((We.lat-L)/H*Et),wt=we(dt),ft=kn([],[wt[0],wt[1],1],Le),Zt=Math.round(ft[0]/ft[2]*Et),Ut=Math.round(ft[1]/ft[2]*Et);K.emplaceBack(ze,Ze,Zt,Ut)},yt=l[3].x-l[0].x,tt=l[3].y-l[0].y,ut=l[2].x-l[1].x,gt=l[2].y-l[1].y;for(let We=0;We<65;We++){const dt=We/64,ze=[l[0].x+dt*yt,l[0].y+dt*tt],Ze=[l[1].x+dt*ut,l[1].y+dt*gt],wt=Ze[0]-ze[0],ft=Ze[1]-ze[1];for(let Zt=0;Zt<65;Zt++){const Ut=Zt/64,lt={x:ze[0]+wt*Ut,y:ze[1]+ft*Ut};Je(n.projection.unproject(lt.x,lt.y),lt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(K,v2.members)}{this.maxLongitudeTriangleSize=0;let K=[],se=new Qn;const re=(le,Ee,we)=>{se.emplaceBack(le,Ee,we);const Se=A[le],Me=A[Ee],De=A[we],Xe=Math.min(Math.min(Se,Me),De),Le=Math.max(Math.max(Se,Me),De)-Xe;Le>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Le),K.push(Xe+Le/2)};for(let le=0;le<64;le++)for(let Ee=0;Ee<64;Ee++){const we=65*le+Ee,Se=we+1,Me=we+65,De=Me+1;re(we,Me,Se),re(Se,Me,De)}[K,se]=function(le,Ee){const we=Array.from({length:le.length},(De,Xe)=>Xe);we.sort((De,Xe)=>le[De]-le[Xe]);const Se=[],Me=new Qn;for(let De=0;De<we.length;De++){const Xe=we[De];Se.push(le[Xe]);const Le=3*Xe,Je=Le+1;Me.emplaceBack(Ee.uint16[Le],Ee.uint16[Je],Ee.uint16[Je+1])}return[Se,Me]}(K,se),this.elevatedGlobeTrianglesCenterLongitudes=K,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(se)}this.elevatedGlobeSegments=rr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,U/Et,0,H/Et,0,0,L,N,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const n=this.map.painter.context,l=n.gl;!this._dirty||this.texture instanceof u_||(this.texture?this.texture.update(this.image):(this.texture=new Xb(n,this.image,l.RGBA8),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;const l=this.elevatedGlobeTrianglesCenterLongitudes;let u=(f=e+180)+360*Math.round((l[0]-f)/360);var f;const p=new rr,y=(P,M)=>{p.segments.push({vertexOffset:0,primitiveOffset:P,vertexLength:n.segments[0].vertexLength,primitiveLength:M,sortKey:void 0,vaos:{}})},b=.51*this.maxLongitudeTriangleSize;if(Math.abs(l[0]-u)<=b){const P=ls(l,0,l.length,u+b);return P===l.length||y(P,nr(l,P+1,l.length,u+360-b)-P),p}u<l[0]&&(u+=360);const S=nr(l,0,l.length,u-b);if(S===l.length)return y(0,l.length),p;y(0,S-0);const A=ls(l,S+1,l.length,u+b);return A!==l.length&&y(A,l.length-A),p}}const f5=(Math.pow(256,2)-1)/16907520;class GP extends Os{constructor(e,n,l,u){super(e,{layout:jP||(jP=new xr({visibility:new xt(Ne.layout_raster.visibility)})),paint:BP||(BP=new xr({"raster-opacity":new xt(Ne.paint_raster["raster-opacity"]),"raster-color":new Tu(Ne.paint_raster["raster-color"]),"raster-color-mix":new xt(Ne.paint_raster["raster-color-mix"]),"raster-color-range":new xt(Ne.paint_raster["raster-color-range"]),"raster-hue-rotate":new xt(Ne.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new xt(Ne.paint_raster["raster-brightness-min"]),"raster-brightness-max":new xt(Ne.paint_raster["raster-brightness-max"]),"raster-saturation":new xt(Ne.paint_raster["raster-saturation"]),"raster-contrast":new xt(Ne.paint_raster["raster-contrast"]),"raster-resampling":new xt(Ne.paint_raster["raster-resampling"]),"raster-fade-duration":new xt(Ne.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new xt(Ne.paint_raster["raster-emissive-strength"]),"raster-array-band":new xt(Ne.paint_raster["raster-array-band"]),"raster-elevation":new xt(Ne.paint_raster["raster-elevation"]),"raster-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},n,l,u),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof UP&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const n=this._transitionablePaint._values["raster-color"].value.expression,[l,u]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(l)&&isNaN(u)||l===this._curRampRange[0]&&u===this._curRampRange[1]||(this.colorRamp=Xg({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:l,end:u}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[l,u])}}let $P,HP,qP,WP,ZP;class XP extends Os{constructor(e,n,l,u){super(e,{layout:$P||($P=new xr({visibility:new xt(Ne["layout_raster-particle"].visibility)})),paint:HP||(HP=new xr({"raster-particle-array-band":new xt(Ne["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new xt(Ne["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Tu(Ne["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new xt(Ne["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new xt(Ne["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new xt(Ne["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new xt(Ne["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new xt(Ne["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},n,l,u),this._updateColorRamp(),this.lastInvalidatedAt=fa.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Xg({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=fa.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class p5 extends Os{constructor(e,n){super(e,{},n,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function w2(r,e,n){const l=[0,0,1],u=fi([]);return ri(u,u,n?-pn(r)+Math.PI:pn(r)),di(u,u,-pn(e)),Cn(l,l,u),wi(l,l)}const KP={None:0,Model:1,Symbol:2,FillExtrusion:4};class Xv{constructor(e,n,l,u){this.message=(e?`${e}: `:"")+l,u&&(this.identifier=u),n!=null&&n.__line__&&(this.line=n.__line__)}}function b2(r,e){const n=r.indexOf("://")===-1;try{return new URL(r,n&&e?"http://example.com":void 0),!0}catch{return!1}}class YP{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class JP{constructor(){this.instancedDataArray=new sp,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class S2{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,n){}populate(e,n,l,u){this.tileToMeter=xe(l);const f=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:p,id:y,index:b,sourceLayerIndex:S}of e){const A=y??(p.properties&&p.properties.hasOwnProperty("id")?p.properties.id:void 0),P=qe(p,f);if(!this.layers[0]._featureFilter.filter(new Pn(this.zoom,{worldview:this.worldview}),P,l))continue;const M={id:A,sourceLayerIndex:S,index:b,geometry:f?P.geometry:Ae(p,l,u),properties:p.properties,type:p.type,patterns:{}},N=this.addFeature(M,M.geometry,P);N&&n.featureIndex.insert(p,M.geometry,b,S,this.index,this.instancesPerModel[N].instancedDataArray.length,Et/32)}this.lookup=null}update(e,n,l,u){for(const f in this.instancesPerModel){const p=this.instancesPerModel[f];for(const y in e)p.idToFeaturesIndex.hasOwnProperty(y)&&(this.evaluate(p.features[p.idToFeaturesIndex[y]],e[y],p,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const n in this.instancesPerModel){const l=this.instancesPerModel[n];for(const u of l.features){const f=this.layers[0],p=u.feature,y=this.canonical,b=f.paint.get("model-rotation").evaluate(p,{},y),S=f.paint.get("model-scale").evaluate(p,{},y),A=f.paint.get("model-translation").evaluate(p,{},y);wr(u.rotation,b)&&wr(u.scale,S)&&wr(u.translation,A)||(this.evaluate(u,u.featureStates,l,!0),e=!0)}}return e}updateReplacement(e,n,l,u){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;const f=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(vv(this.activeReplacements,f))return!1;this.activeReplacements=f;let p=!1;for(const y in this.instancesPerModel){const b=this.instancesPerModel[y],S=b.instancedDataArray;for(const A of b.features){const P=A.instancedDataOffset,M=A.instancedDataCount;for(let N=0;N<M;N++){const L=16*(N+P);let U=S.float32[L+0];const H=U>Et;U=H?U-Et:U;const K=Math.floor(U),se=S.float32[L+1];let re=!1;for(const le of this.activeReplacements)if(!jA(le,l,KP.Model,u)&&!(le.min.x>K||K>le.max.x||le.min.y>se||se>le.max.y)&&(re=Ob(GA(K,se,e.canonical,le.footprintTileId.canonical),le.footprint),re))break;S.float32[L]=re?U+Et:U,p=p||re!==H}}}return p}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const n in this.instancesPerModel){const l=this.instancesPerModel[n];l.instancedDataArray.length<0||l.instancedDataArray.length===0||(l.instancedDataBuffer?l.instancedDataBuffer.updateData(l.instancedDataArray):l.instancedDataBuffer=e.createVertexBuffer(l.instancedDataArray,W4.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const n in this.instancesPerModel){const l=this.instancesPerModel[n];l.instancedDataArray.length!==0&&l.instancedDataBuffer&&l.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const n of this.modelUris)e.removeModel(n,"",!0)}addFeature(e,n,l){const u=this.layers[0],f=u.layout.get("model-id").evaluate(l,{},this.canonical);if(!f)return Ki(`modelId is not evaluated for layer ${u.id} and it is not going to get rendered.`),f;(b2(f,!1)||this.styleDefinedModelURLs[f]!==void 0)&&(this.modelUris.includes(f)||this.modelUris.push(f)),this.instancesPerModel[f]||(this.instancesPerModel[f]=new JP);const p=this.instancesPerModel[f],y=p.instancedDataArray,b=new YP(l,y.length);for(const S of n)for(const A of S){if(A.x<0||A.x>=Et||A.y<0||A.y>=Et)continue;const P=(this.lookupDim-1)/Et,M=this.lookupDim*(A.y*P|0)+A.x*P|0;if(this.lookup){if(this.lookup[M]!==0)continue;this.lookup[M]=1}this.instanceCount++;const N=y.length;y.resize(N+1),p.instancesEvaluatedElevation.push(0),y.float32[16*N]=A.x,y.float32[16*N+1]=A.y}return b.instancedDataCount=p.instancedDataArray.length-b.instancedDataOffset,b.instancedDataCount>0&&(e.id&&(p.idToFeaturesIndex[e.id]=p.features.length),p.features.push(b),this.evaluate(b,{},p,!1)),f}getModelUris(){return this.modelUris}evaluate(e,n,l,u){const f=this.layers[0],p=e.feature,y=this.canonical,b=e.rotation=f.paint.get("model-rotation").evaluate(p,n,y),S=e.scale=f.paint.get("model-scale").evaluate(p,n,y),A=e.translation=f.paint.get("model-translation").evaluate(p,n,y),P=f.paint.get("model-color").evaluate(p,n,y);P.a=f.paint.get("model-color-mix-intensity").evaluate(p,n,y);const M=[];this.maxVerticalOffset<A[2]&&(this.maxVerticalOffset=A[2]),this.maxScale=Math.max(Math.max(this.maxScale,S[0]),Math.max(S[1],S[2])),TI(M,b,S);const N=Math.round(100*P.a)+P.b/1.05;for(let L=0;L<e.instancedDataCount;++L){const U=e.instancedDataOffset+L,H=16*U,K=l.instancedDataArray.float32;let se=0;u&&(se=K[H+6]-l.instancesEvaluatedElevation[U]);const re=0|K[H+1];K[H]=(0|K[H])+P.r/1.05,K[H+1]=re+P.g/1.05,K[H+2]=N,K[H+3]=1/(y.z>10?this.tileToMeter:xe(y,re)),K[H+4]=A[0],K[H+5]=A[1],K[H+6]=A[2]+se,K[H+7]=M[0],K[H+8]=M[1],K[H+9]=M[2],K[H+10]=M[4],K[H+11]=M[5],K[H+12]=M[6],K[H+13]=M[8],K[H+14]=M[9],K[H+15]=M[10],l.instancesEvaluatedElevation[U]=A[2]}}}let QP,eM;Bt(S2,"ModelBucket",{omit:["layers"]}),Bt(JP,"PerModelAttributes"),Bt(YP,"ModelFeature");class Sp{constructor(e,n,l){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=l}static create(e,n,l){const u=l||e.findDEMTileFor(n);if(!u||!u.dem)return;const f=u.dem,p=u.tileID,y=1<<n.canonical.z-p.canonical.z;return new Sp(u,f.dim/Et/y,[(n.canonical.x/y-p.canonical.x)*f.dim,(n.canonical.y/y-p.canonical.y)*f.dim])}tileCoordToPixel(e,n){const l=n*this._scale+this._offset[1];return new ht(Math.floor(e*this._scale+this._offset[0]),Math.floor(l))}getElevationAt(e,n,l,u){const f=e*this._scale+this._offset[0],p=n*this._scale+this._offset[1],y=Math.floor(f),b=Math.floor(p),S=this._dem;return u=!!u,l?si(si(S.get(y,b,u),S.get(y,b+1,u),p-b),si(S.get(y+1,b,u),S.get(y+1,b+1,u),p-b),f-y):S.get(y,b,u)}getElevationAtPixel(e,n,l){return this._dem.get(e,n,!!l)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Z(1,e)*this._dem.stride}}const T2=new Float32Array(262144),Lh=new Uint8Array(262144);function tM(r){let e=0;if(r.meshes)for(const n of r.meshes)e=Math.max(e,n.aabb.max[2]);if(r.children)for(const n of r.children)e=Math.max(e,tM(n));return e}function iM(r,e,n){if(r.meshes)for(const l of r.meshes){if(l.aabb.min[0]===1/0)continue;const u=Gi.applyTransform(l.aabb,r.matrix);n.insert(e,u.min[0],u.min[1],u.max[0],u.max[1])}if(r.children)for(const l of r.children)iM(l,e,n)}const nM=["","wall","door","roof","window","lamp","logo"];class rM{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:tM(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Gi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const n=new Gi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const l of this.node.meshes)this.node.lightMeshIndex!==e&&(l.transformedAabb=Gi.applyTransformFast(l.aabb,this.node.matrix),n.encapsulate(l.transformedAabb)),e++;this.aabb=n}return this.aabb}}class Kv{constructor(e,n,l,u,f,p,y,b){this.id=l,this.layers=e,this.layerIds=this.layers.map(S=>S.fqid),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id),this.modelTraits|=_p.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,u&&(this.modelTraits|=_p.HasMapboxMeshFeatures),f&&(this.modelTraits|=_p.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=p,this.worldview=b,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const S of n)this.nodesInfo.push(new rM(S)),iM(S,y.featureIndexArray.length,y.grid),y.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,y.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,n){for(const l of this.getNodesInfo()){const u=l.node;u.footprint&&n.push({footprint:u.footprint,id:e})}}update(e){const n=Object.keys(e).length!==0;if(n&&!this.stateDependentLayers.length)return;const l=n?this.stateDependentLayers:this.layers;if(!Ka(e,this.states))for(const u of l)this.evaluate(u,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const n=this.getNodesInfo();for(const l of n){const u=l.node;this.uploaded?this.updatePbrBuffer(u):Jb(u,e,!0)}for(const l of n)Mv(l.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(const l of e.meshes)l.pbrBuffer&&(l.pbrBuffer.updateData(l.featureArray),n=!0);return n}needsReEvaluation(e,n,l){const u=e.transform.projectionOptions,f=e.style.getBrightness(),p=this.brightness!==f;if(!this.uploaded||this.dirty||u.name!==this.projection.name||T_(l.paint.get("model-color").value,p)||T_(l.paint.get("model-color-mix-intensity").value,p)||T_(l.paint.get("model-roughness").value,p)||T_(l.paint.get("model-emissive-strength").value,p)||T_(l.paint.get("model-height-based-emissive-strength-multiplier").value,p)){this.projection=u,this.brightness=f;const y=this.getNodesInfo();for(const b of y)b.state=null;return!0}return!1}evaluateTransform(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const l=this.getNodesInfo(),u=this.id.canonical;for(const f of l){const p=f.feature;f.evaluatedTranslation=n.paint.get("model-translation").evaluate(p,{},u),f.evaluatedScale=n.paint.get("model-scale").evaluate(p,{},u)}}evaluate(e,n){const l=this.getNodesInfo();for(const u of l){if(!u.node.meshes)continue;const f=u.feature,p=n&&n[f.id];if(Ka(p,u.state))continue;u.state=structuredClone(p);const y=u.node.meshes&&u.node.meshes[0].featureData,b=u.evaluatedColor[2],S=u.evaluatedRMEA[2],A=this.id.canonical;if(u.hasTranslucentParts=!1,y){for(let P=0;P<nM.length;P++){const M=nM[P];M.length&&(f.properties.part=M);const N=e.paint.get("model-color").evaluate(f,p,A).toPremultipliedRenderColor(null),L=e.paint.get("model-color-mix-intensity").evaluate(f,p,A);u.evaluatedColor[P]=[N.r,N.g,N.b,L],u.evaluatedRMEA[P][0]=e.paint.get("model-roughness").evaluate(f,p,A),u.evaluatedRMEA[P][2]=e.paint.get("model-emissive-strength").evaluate(f,p,A),u.evaluatedRMEA[P][3]=N.a,u.emissionHeightBasedParams[P]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(f,p,A),!u.hasTranslucentParts&&N.a<1&&(u.hasTranslucentParts=!0)}delete f.properties.part,g5(u,b!==u.evaluatedColor[2]||S!==u.evaluatedRMEA[2],this.modelTraits)}else u.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(f,p,A);u.evaluatedTranslation=e.paint.get("model-translation").evaluate(f,p,A),u.evaluatedScale=e.paint.get("model-scale").evaluate(f,p,A),this.updatePbrBuffer(u.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,l,u){const f=e.findDEMTileFor(l);if(f&&(f.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(f.dem&&f.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=f.tileID.overscaledZ;const p=Sp.create(e,l,f);if(!p)return;this.modelTraits&_p.HasMapboxMeshFeatures&&this.updateDEM(e,p,l,u);for(const y of this.getNodesInfo()){const b=y.node;if(!b.footprint||!b.footprint.vertices||!b.footprint.vertices.length)continue;const S=b.footprint.vertices;let A=p.getElevationAt(S[0].x,S[0].y,!0,!0);for(let P=1;P<S.length;P++)A=Math.min(A,p.getElevationAt(S[P].x,S[P].y,!0,!0));b.elevation=A}}this.terrainTile=f.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,l,u){let f=n._dem._modifiedForSources[u];if(f===void 0&&(n._dem._modifiedForSources[u]=[],f=n._dem._modifiedForSources[u]),f.includes(l.canonical))return;const p=n._dem.dim;f.push(l.canonical);let y=!1;for(const b of this.getNodesInfo()){const S=b.node;if(!S.footprint||!S.footprint.grid)continue;const A=S.footprint.grid,P=n.tileCoordToPixel(A.min.x,A.min.y),M=n.tileCoordToPixel(A.max.x,A.max.y),N=Math.min(Math.min(p-M.y,P.x),Math.min(P.y,p-M.x));if(N<0)continue;const L=ge(N,2,5);let U=Math.max(0,P.x-L),H=Math.max(0,P.y-L),K=Math.min(M.x+L,p-1),se=Math.min(M.y+L,p-1);for(let we=H;we<=se;++we)for(let Se=U;Se<=K;++Se)Lh[we*p+Se]=255;let re=0,le=0;for(let we=0;we<A.cellsY;++we)for(let Se=0;Se<A.cellsX;++Se){if(!A.cells[we*A.cellsX+Se])continue;const Me=n.tileCoordToPixel(A.min.x+Se/A.xScale,A.min.y+we/A.yScale),De=n.tileCoordToPixel(A.min.x+(Se+1)/A.xScale,A.min.y+(we+1)/A.yScale);for(let Xe=Me.y;Xe<=Math.min(De.y+1,p-1);++Xe)for(let Le=Me.x;Le<=Math.min(De.x+1,p-1);++Le)Lh[Xe*p+Le]===255&&(Lh[Xe*p+Le]=0,re+=n.getElevationAtPixel(Le,Xe),le++)}const Ee=re/le;U=Math.max(1,P.x-L),H=Math.max(1,P.y-L),K=Math.min(M.x+L,p-2),se=Math.min(M.y+L,p-2),y=!0;for(let we=H;we<=se;++we)for(let Se=U;Se<=K;++Se)Lh[we*p+Se]===0&&(T2[we*p+Se]=n._dem.set(Se,we,Ee));for(let we=1;we<L;++we){U=Math.max(1,P.x-we),H=Math.max(1,P.y-we),K=Math.min(M.x+we,p-2),se=Math.min(M.y+we,p-2);for(let Se=H;Se<=se;++Se)for(let Me=U;Me<=K;++Me){const De=Se*p+Me;if(Lh[De]===255){let Xe=0,Le=0,Je=-1,yt=-1;for(let tt=-1;tt<=1;++tt)for(let ut=-1;ut<=1;++ut){const gt=(Se+tt)*p+Me+ut;if(Lh[gt]>=we)continue;const We=T2[gt],dt=Math.abs(We);dt>Le&&(Xe=We,Le=dt,Je=ut,yt=tt)}if(Le>.1){const tt=1-(we+.5*Math.abs(Je*yt))/L;let ut=n._dem.get(Me,Se)+Xe*tt;const gt=n._dem.get(Me+Je,Se+yt),We=n._dem.get(Me-Je,Se-yt,!0);(ut-gt)*(ut-We)>0&&(ut=(gt+We)/2),T2[De]=n._dem.set(Me,Se,ut),Lh[De]=we}}}}}y&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=fa.now())}setFilter(e){this.filter=e?Eu(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new Pn(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const n of e)Mv(n.node),Qb(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const l=n.getReplacementRegionsForTile(e.toUnwrapped());for(const u of this.getNodesInfo()){const f=u.node.footprint;u.hiddenByReplacement=!!f&&!l.find(p=>p.footprint===f)}}getHeightAtTileCoord(e,n){const l=[],u=[0,0,0],f=J([]);for(const p of this.getNodesInfo()){const y=p.node.meshes[0],b=y.transformedAabb;if(e<b.min[0]||n<b.min[1]||e>b.max[0]||n>b.max[1])continue;if(p.node.hidden===!0)return{height:1/0,maxHeight:p.feature.properties.height,hidden:!1,verticalScale:p.evaluatedScale[2]};ce(f,p.node.matrix),u[0]=e,u[1]=n,Ri(u,u,f);const S=(u[0]-y.aabb.min[0])/(y.aabb.max[0]-y.aabb.min[0])*Dh|0,A=Math.min(63,(u[1]-y.aabb.min[1])/(y.aabb.max[1]-y.aabb.min[1])*Dh|0)*Dh+Math.min(63,S),P=y.heightmap[A];if(!(P<0&&p.node.footprint))return p.hiddenByReplacement?void 0:{height:P,maxHeight:p.feature.properties.height,hidden:!1,verticalScale:p.evaluatedScale[2]};if(p.node.footprint.grid.query(new ht(e,n),new ht(e,n),l),l.length>0)return{height:void 0,maxHeight:p.feature.properties.height,hidden:p.hiddenByReplacement,verticalScale:p.evaluatedScale[2]}}}}function T_(r,e){return r instanceof Hf&&!r.isLightConstant&&e}function m5(r,e,n,l,u,f,p,y){let b=(61440&e|(61440&e)>>4)>>8,S=(3840&e|(3840&e)>>4)>>4,A=240&e|(240&e)>>4;n[3]>0&&(b=si(b,255*n[0],n[3]),S=si(S,255*n[1],n[3]),A=si(A,255*n[2],n[3]));const P=b<<8|S,M=A<<8|Math.floor(255*l[3]),N=function(we){const Se=ge(we,0,2);return Math.min(Math.round(.5*Se*255),255)}(l[2])<<8|15*l[0]<<4|15*l[1],L=ge(u[0],0,1),U=ge(u[1],0,1),H=ge(u[2],0,1),K=ge(u[3],0,1);let se,re,le,Ee;if(L!==U&&p!==f&&U!==L){const we=p-f;re=1/(we*(U-L)),le=-(f+we*L)/(we*(U-L));const Se=ge(u[4],-1,1);Ee=Math.pow(10,Se),se=255*H<<8|255*K}else se=65535,re=0,le=1,Ee=1;if(r.emplaceBack(P,M,N,se,re,le,Ee),y){const we=y.length;y.clear();for(let Se=0;Se<we;Se++)y.emplaceBack(P,M,N,se,re,le,Ee)}}function g5(r,e,n){const l=r.node;let u=0;const f=n&_p.HasMeshoptCompression;for(const p of l.meshes){if(l.lights&&l.lightMeshIndex===u||!p.featureData)continue;p.featureArray=new Lu,p.featureArray.reserve(p.featureData.length);let y=e;for(const b of p.featureData){const S=f?65535&b:b>>16&65535,A=f?b>>16&65535:65535&b,P=(15&A)<8?15&A:0,M=r.evaluatedRMEA[P],N=r.evaluatedColor[P],L=r.emissionHeightBasedParams[P];let U;if(y&&P===2&&l.lights&&(U=new Lu,U.resize(10*l.lights.length)),m5(p.featureArray,S,N,M,L,p.aabb.min[2],p.aabb.max[2],U),U&&y){y=!1;const H=l.meshes[l.lightMeshIndex];H.featureArray=U,H.featureArray._trim()}}p.featureArray._trim(),u++}}function sM(r,e,n,l){const u=1<<r.z;e.lat=ae((l/Et+r.y)/u),e.lng=ne((n/Et+r.x)/u)}function _5(r,e,n,l){const u=r.getNodesInfo()[e];if(!u||u.hiddenByReplacement||!u.node.meshes)return;let f=Number.MAX_VALUE;const p=u.node,y=n.tile,b=l.calculatePosMatrix(y.tileID.toUnwrapped(),l.worldSize),S=u.evaluatedScale;let A=0;l.elevation&&p.elevation&&(A=p.elevation*l.elevation.exaggeration()),ee(b,b,[(p.anchor?p.anchor[0]:0)*(S[0]-1),(p.anchor?p.anchor[1]:0)*(S[1]-1),A]),Q(b,b,S);const P=n.queryGeometry,M=P.isPointQuery()?P.screenBounds:P.screenGeometry,N=function(U){const H=oe([],b,U.matrix);oe(H,l.expandedFarZProjMatrix,H);for(let K=0;K<U.meshes.length;++K){const se=U.meshes[K];if(K===U.lightMeshIndex)continue;const re=EI(M,l,H,se.aabb);re!=null&&(f=Math.min(re,f))}if(U.children)for(const K of U.children)N(K)};if(N(p),f===Number.MAX_VALUE)return;const L=new D(0,0);return sM(y.tileID.canonical,L,u.node.anchor[0],u.node.anchor[1]),{intersectionZ:f,position:L,feature:u.feature}}Bt(Kv,"Tiled3dModelBucket",{omit:["layers"]}),Bt(rM,"Tiled3dModelFeature");const y5={circle:class extends Os{constructor(r,e,n,l){super(r,{layout:Xl||(Xl=new xr({"circle-sort-key":new kt(Ne.layout_circle["circle-sort-key"]),"circle-elevation-reference":new xt(Ne.layout_circle["circle-elevation-reference"]),visibility:new xt(Ne.layout_circle.visibility)})),paint:Fu||(Fu=new xr({"circle-radius":new kt(Ne.paint_circle["circle-radius"]),"circle-color":new kt(Ne.paint_circle["circle-color"]),"circle-blur":new kt(Ne.paint_circle["circle-blur"]),"circle-opacity":new kt(Ne.paint_circle["circle-opacity"]),"circle-translate":new xt(Ne.paint_circle["circle-translate"]),"circle-translate-anchor":new xt(Ne.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new xt(Ne.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new xt(Ne.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new kt(Ne.paint_circle["circle-stroke-width"]),"circle-stroke-color":new kt(Ne.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new kt(Ne.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new xt(Ne.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l)}createBucket(r){return new xn(r)}queryRadius(r){const e=r;return ds("circle-radius",this,e)+ds("circle-stroke-width",this,e)+Er(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,n,l,u,f,p,y){const b=kc(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,r.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return hA(r,l,f,p,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,S)}getProgramIds(){return["circle"]}getDefaultProgramParams(r,e,n){const l=dA(this);return{config:new Zs(this,{zoom:e,lut:n}),defines:l,overrideFog:!1}}is3D(r){return!r&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Os{createBucket(r){return new pA(r)}constructor(r,e,n,l){super(r,{layout:mA||(mA=new xr({visibility:new xt(Ne.layout_heatmap.visibility)})),paint:gA||(gA=new xr({"heatmap-radius":new kt(Ne.paint_heatmap["heatmap-radius"]),"heatmap-weight":new kt(Ne.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new xt(Ne.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Tu(Ne.paint_heatmap["heatmap-color"]),"heatmap-opacity":new xt(Ne.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Xg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(r){return ds("heatmap-radius",this,r)}queryIntersectsFeature(r,e,n,l,u,f,p,y){const b=this.paint.get("heatmap-radius").evaluate(e,n);return hA(r,l,f,p,y,!0,!0,new ht(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(r,e,n){return r==="heatmap"?{config:new Zs(this,{zoom:e,lut:n}),overrideFog:!1}:{}}},hillshade:class extends Os{constructor(r,e,n,l){super(r,{layout:_A||(_A=new xr({visibility:new xt(Ne.layout_hillshade.visibility)})),paint:yA||(yA=new xr({"hillshade-illumination-direction":new xt(Ne.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new xt(Ne.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new xt(Ne.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new xt(Ne.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new xt(Ne.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new xt(Ne.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new xt(Ne.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(r,e,n){return{overrideFog:!1}}},fill:class extends Os{constructor(r,e,n,l){super(r,{layout:kA||(kA=new xr({"fill-sort-key":new kt(Ne.layout_fill["fill-sort-key"]),visibility:new xt(Ne.layout_fill.visibility),"fill-elevation-reference":new xt(Ne.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new kt(Ne.layout_fill["fill-construct-bridge-guard-rail"])})),paint:NA||(NA=new xr({"fill-antialias":new xt(Ne.paint_fill["fill-antialias"]),"fill-opacity":new kt(Ne.paint_fill["fill-opacity"]),"fill-color":new kt(Ne.paint_fill["fill-color"]),"fill-outline-color":new kt(Ne.paint_fill["fill-outline-color"]),"fill-translate":new xt(Ne.paint_fill["fill-translate"]),"fill-translate-anchor":new xt(Ne.paint_fill["fill-translate-anchor"]),"fill-pattern":new kt(Ne.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new xt(Ne.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new xt(Ne.paint_fill["fill-emissive-strength"]),"fill-z-offset":new kt(Ne.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new kt(Ne.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new kt(Ne.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l)}getProgramIds(){const r=this.paint.get("fill-pattern"),e=r&&r.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(r,e,n){return{config:new Zs(this,{zoom:e,lut:n}),overrideFog:!1}}recalculate(r,e){super.recalculate(r,e);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new Nb(r)}queryRadius(){return Er(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,n,l,u,f){return!r.queryGeometry.isAboveHorizon&&Ir(Oo(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,r.pixelToTileUnitsFactor),l)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(r){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return r!=null?e&&!r:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Os{constructor(r,e,n,l){super(r,{layout:nI||(nI=new xr({visibility:new xt(Ne["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new xt(Ne["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:rI||(rI=new xr({"fill-extrusion-opacity":new xt(Ne["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new kt(Ne["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new xt(Ne["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new xt(Ne["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new kt(Ne["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new xt(Ne["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new kt(Ne["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new kt(Ne["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new xt(Ne["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new xt(Ne["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new xt(Ne["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new xt(Ne["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new xt(Ne["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new xt(Ne["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new xt(Ne["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new xt(Ne["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new xt(Ne["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new xt(Ne["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new kt(Ne["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new kt(Ne["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new xt(Ne["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new xt(Ne["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new xt(Ne["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new xt(Ne["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new kt(Ne["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new kt(Ne["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new xt(Ne["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new bv(r)}queryRadius(){return Er(this.paint.get("fill-extrusion-translate"))}is3D(r){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(r,e,n,l,u,f,p,y,b){const S=kc(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,r.pixelToTileUnitsFactor),A=this.paint.get("fill-extrusion-height").evaluate(e,n),P=this.paint.get("fill-extrusion-base").evaluate(e,n),M=[0,0],N=y&&f.elevation,L=f.elevation?f.elevation.exaggeration():1,U=r.tile.getBucket(this);if(N&&U instanceof bv){const le=U.centroidVertexArray,Ee=b+1;Ee<le.length&&(M[0]=le.geta_centroid_pos0(Ee),M[1]=le.geta_centroid_pos1(Ee))}if(M[0]===0&&M[1]===1)return!1;f.projection.name==="globe"&&(l=iI([l],[new ht(0,0),new ht(Et,Et)],r.tileID.canonical).map(le=>le.polygon).flat());const H=N?y:null,[K,se]=function(le,Ee,we,Se,Me,De,Xe,Le,Je,yt,tt){return le.projection.name==="globe"?function(ut,gt,We,dt,ze,Ze,wt,ft,Zt,Ut,lt){const pt=[],$t=[],zt=ut.projection.upVectorScale(lt,ut.center.lat,ut.worldSize).metersToTile,At=[0,0,0,1],Ot=[0,0,0,1],li=(Di,Ii,Yi,Bi)=>{Di[0]=Ii,Di[1]=Yi,Di[2]=Bi,Di[3]=1},vi=tI();We>0&&(We+=vi),dt+=vi;for(const Di of gt){const Ii=[],Yi=[];for(const Bi of Di){const qn=Bi.x+ze.x,he=Bi.y+ze.y,fe=ut.projection.projectTilePoint(qn,he,lt),He=ut.projection.upVector(lt,Bi.x,Bi.y);let bt=We,Mt=dt;if(wt){const It=uI(qn,he,We,dt,wt,ft,Zt,Ut);bt+=It.base,Mt+=It.top}We!==0?li(At,fe.x+He[0]*zt*bt,fe.y+He[1]*zt*bt,fe.z+He[2]*zt*bt):li(At,fe.x,fe.y,fe.z),li(Ot,fe.x+He[0]*zt*Mt,fe.y+He[1]*zt*Mt,fe.z+He[2]*zt*Mt),Ri(At,At,Ze),Ri(Ot,Ot,Ze),Ii.push(new Mh(At[0],At[1],At[2])),Yi.push(new Mh(Ot[0],Ot[1],Ot[2]))}pt.push(Ii),$t.push(Yi)}return[pt,$t]}(le,Ee,we,Se,Me,De,Xe,Le,Je,yt,tt):Xe?function(ut,gt,We,dt,ze,Ze,wt,ft,Zt){const Ut=[],lt=[],pt=[0,0,0,1];for(const $t of ut){const zt=[],At=[];for(const Ot of $t){const li=Ot.x+dt.x,vi=Ot.y+dt.y,Di=uI(li,vi,gt,We,Ze,wt,ft,Zt);pt[0]=li,pt[1]=vi,pt[2]=Di.base,pt[3]=1,rt(pt,pt,ze),pt[3]=Math.max(pt[3],1e-5);const Ii=new Mh(pt[0]/pt[3],pt[1]/pt[3],pt[2]/pt[3]);pt[0]=li,pt[1]=vi,pt[2]=Di.top,pt[3]=1,rt(pt,pt,ze),pt[3]=Math.max(pt[3],1e-5);const Yi=new Mh(pt[0]/pt[3],pt[1]/pt[3],pt[2]/pt[3]);zt.push(Ii),At.push(Yi)}Ut.push(zt),lt.push(At)}return[Ut,lt]}(Ee,we,Se,Me,De,Xe,Le,Je,yt):function(ut,gt,We,dt,ze){const Ze=[],wt=[],ft=ze[8]*gt,Zt=ze[9]*gt,Ut=ze[10]*gt,lt=ze[11]*gt,pt=ze[8]*We,$t=ze[9]*We,zt=ze[10]*We,At=ze[11]*We;for(const Ot of ut){const li=[],vi=[];for(const Di of Ot){const Ii=Di.x+dt.x,Yi=Di.y+dt.y,Bi=ze[0]*Ii+ze[4]*Yi+ze[12],qn=ze[1]*Ii+ze[5]*Yi+ze[13],he=ze[2]*Ii+ze[6]*Yi+ze[14],fe=ze[3]*Ii+ze[7]*Yi+ze[15],He=Bi+ft,bt=qn+Zt,Mt=he+Ut,It=Math.max(fe+lt,1e-5),Gt=Bi+pt,mi=qn+$t,qi=he+zt,Wi=Math.max(fe+At,1e-5);li.push(new Mh(He/It,bt/It,Mt/It)),vi.push(new Mh(Gt/Wi,mi/Wi,qi/Wi))}Ze.push(li),wt.push(vi)}return[Ze,wt]}(Ee,we,Se,Me,De)}(f,l,P,A,S,p,H,M,L,f.center.lat,r.tileID.canonical),re=r.queryGeometry;return function(le,Ee,we){let Se=1/0;Ir(we,Ee)&&(Se=cI(we,Ee[0]));for(let Me=0;Me<Ee.length;Me++){const De=Ee[Me],Xe=le[Me];for(let Le=0;Le<De.length-1;Le++){const Je=De[Le],yt=[Je,De[Le+1],Xe[Le+1],Xe[Le],Je];Ln(we,yt)&&(Se=Math.min(Se,cI(we,yt)))}}return Se!==1/0&&Se}(K,se,re.isPointQuery()?re.screenBounds:re.screenGeometry)}},building:class extends Os{constructor(r,e,n,l){super(r,{layout:NI||(NI=new xr({visibility:new xt(Ne.layout_building.visibility),"building-facade":new kt(Ne.layout_building["building-facade"]),"building-facade-floors":new kt(Ne.layout_building["building-facade-floors"]),"building-facade-window":new kt(Ne.layout_building["building-facade-window"]),"building-roof-shape":new kt(Ne.layout_building["building-roof-shape"]),"building-height":new kt(Ne.layout_building["building-height"]),"building-base":new kt(Ne.layout_building["building-base"])})),paint:LI||(LI=new xr({"building-opacity":new xt(Ne.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new xt(Ne.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new xt(Ne.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new xt(Ne.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new xt(Ne.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new xt(Ne.paint_building["building-vertical-scale"]),"building-cast-shadows":new xt(Ne.paint_building["building-cast-shadows"]),"building-color":new kt(Ne.paint_building["building-color"]),"building-emissive-strength":new kt(Ne.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new xt(Ne.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new xt(Ne.paint_building["building-cutoff-fade-range"]),"building-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new kI(r)}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(r){return!0}},line:class extends Os{constructor(r,e,n,l){const u=HI();super(r,u,e,n,l),u.layout&&(this.layout=new ga(u.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof ch,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=(()=>{if(h_)return h_;const n=HI();return h_=new gB(n.paint.properties["line-width"].specification),h_.useIntegerZoom=!0,h_})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new i2(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(r,e,n){const l=GI(this);return{config:new Zs(this,{zoom:e,lut:n}),defines:l,overrideFog:!1}}queryRadius(r){const e=r,n=qI(ds("line-width",this,e),ds("line-gap-width",this,e)),l=ds("line-offset",this,e);return n/2+Math.abs(l)+Er(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,n,l,u,f){if(r.queryGeometry.isAboveHorizon)return!1;const p=Oo(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,r.pixelToTileUnitsFactor),y=r.pixelToTileUnitsFactor/2*qI(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),b=this.paint.get("line-offset").evaluate(e,n);return b&&(l=function(S,A){const P=[],M=new ht(0,0);for(let N=0;N<S.length;N++){const L=S[N],U=[];for(let H=0;H<L.length;H++){const K=L[H],se=L[H+1],re=H===0?M:K.sub(L[H-1])._unit()._perp(),le=H===L.length-1?M:se.sub(K)._unit()._perp(),Ee=re._add(le)._unit();Ee._mult(1/(Ee.x*le.x+Ee.y*le.y)),U.push(Ee._mult(A)._add(K))}P.push(U)}return P}(l,b*r.pixelToTileUnitsFactor)),function(S,A,P){for(let M=0;M<A.length;M++){const N=A[M];if(S.length>=3){for(let L=0;L<N.length;L++)if(Es(S,N[L]))return!0}if(zr(S,N,P))return!0}return!1}(p,l,y)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(r){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:qv,background:class extends Os{constructor(r,e,n,l){super(r,{layout:OP||(OP=new xr({visibility:new xt(Ne.layout_background.visibility)})),paint:FP||(FP=new xr({"background-pitch-alignment":new xt(Ne.paint_background["background-pitch-alignment"]),"background-color":new xt(Ne.paint_background["background-color"]),"background-pattern":new xt(Ne.paint_background["background-pattern"]),"background-opacity":new xt(Ne.paint_background["background-opacity"]),"background-emissive-strength":new xt(Ne.paint_background["background-emissive-strength"]),"background-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(r,e,n){return{overrideFog:!1}}is3D(r){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:GP,"raster-particle":XP,sky:class extends Os{constructor(r,e,n,l){super(r,{layout:qP||(qP=new xr({visibility:new xt(Ne.layout_sky.visibility)})),paint:WP||(WP=new xr({"sky-type":new xt(Ne.paint_sky["sky-type"]),"sky-atmosphere-sun":new xt(Ne.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new xt(Ne.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new xt(Ne.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new xt(Ne.paint_sky["sky-gradient-radius"]),"sky-gradient":new Tu(Ne.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new xt(Ne.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new xt(Ne.paint_sky["sky-atmosphere-color"]),"sky-opacity":new xt(Ne.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(r){r==="sky-gradient"?this._updateColorRamp():r!=="sky-atmosphere-sun"&&r!=="sky-atmosphere-halo-color"&&r!=="sky-atmosphere-color"&&r!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Xg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(r,e){if(this.paint.get("sky-type")==="atmosphere"){const l=this.paint.get("sky-atmosphere-sun"),u=!l,f=r.style.light,p=f.properties.get("position");return u&&f.properties.get("anchor")==="viewport"&&Ki("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?w2(p.azimuthal,90-p.polar,e):w2(l[0],90-l[1],e)}const n=this.paint.get("sky-gradient-center");return w2(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return r==="atmosphere"?["skyboxCapture","skybox"]:r==="gradient"?["skyboxGradient"]:null}},slot:class extends Os{constructor(r,e,n,l){super(r,{paint:ZP||(ZP=new xr({}))},e,null)}},model:class extends Os{constructor(r,e,n,l){super(r,{layout:QP||(QP=new xr({visibility:new xt(Ne.layout_model.visibility),"model-id":new kt(Ne.layout_model["model-id"])})),paint:eM||(eM=new xr({"model-opacity":new kt(Ne.paint_model["model-opacity"]),"model-rotation":new kt(Ne.paint_model["model-rotation"]),"model-scale":new kt(Ne.paint_model["model-scale"]),"model-translation":new kt(Ne.paint_model["model-translation"]),"model-color":new kt(Ne.paint_model["model-color"]),"model-color-mix-intensity":new kt(Ne.paint_model["model-color-mix-intensity"]),"model-type":new xt(Ne.paint_model["model-type"]),"model-cast-shadows":new xt(Ne.paint_model["model-cast-shadows"]),"model-receive-shadows":new xt(Ne.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new xt(Ne.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new kt(Ne.paint_model["model-emissive-strength"]),"model-roughness":new kt(Ne.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new kt(Ne.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new xt(Ne.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new xt(Ne.paint_model["model-front-cutoff"]),"model-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new S2(r)}getProgramIds(){return["model"]}is3D(r){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(r){return r instanceof Kv?Et-1:0}queryIntersectsFeature(r,e,n,l,u,f){if(!this.modelManager)return!1;const p=this.modelManager,y=r.tile.getBucket(this);if(!(y&&y instanceof S2))return!1;for(const b in y.instancesPerModel){const S=y.instancesPerModel[b],A=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(S.idToFeaturesIndex.hasOwnProperty(A)){const P=S.features[S.idToFeaturesIndex[A]],M=p.getModel(b,this.scope);if(!M)return!1;let N=ue();const L=new D(0,0),U=y.canonical;let H=Number.MAX_VALUE;for(let K=0;K<P.instancedDataCount;++K){const se=16*(P.instancedDataOffset+K),re=S.instancedDataArray.float32,le=[re[se+4],re[se+5],re[se+6]];sM(U,L,re[se],0|re[se+1]),CI(N,M,f,L,P.rotation,P.scale,le,!1,!1,!1),f.projection.name==="globe"&&(N=Yb(N,f));const Ee=oe([],f.projMatrix,N),we=r.queryGeometry,Se=EI(we.isPointQuery()?we.screenBounds:we.screenGeometry,f,Ee,M.aabb);Se!=null&&(H=Math.min(Se,H))}return H!==Number.MAX_VALUE&&H}}return!1}_handleOverridablePaintPropertyUpdate(r,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||r!=="model-color"&&r!=="model-color-mix-intensity"&&r!=="model-rotation"&&r!=="model-scale"&&r!=="model-translation"&&r!=="model-emissive-strength")}_isPropertyZoomDependent(r){const e=this._transitionablePaint._values[r];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Ul}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Os{constructor(r,e,n,l){super(r,{layout:LA||(LA=new xr({"clip-layer-types":new xt(Ne.layout_clip["clip-layer-types"]),"clip-layer-scope":new xt(Ne.layout_clip["clip-layer-scope"])})),paint:zA||(zA=new xr({}))},e,n,l)}recalculate(r,e){super.recalculate(r,e)}createBucket(r){return new OA(r)}is3D(r){return!0}}},E2=new bn(0,0,0),C2={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},A2={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},Yv={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},x5={PAINT_ORDER_FILL_AND_STROKE:1},E_={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},oM={MASK_TYPE_LUMINANCE:1};function v5(r,e,n){r===1&&e.icons.push(function(l,u){return function(f){if(f.usvg_tree.height||(f.usvg_tree.height=f.usvg_tree.width),!f.metadata)return f;const{metadata:p}=f;if(p.content_area){const{content_area:y}=p;y.top==null&&(y.top=y.left),y.width==null&&(y.width=f.usvg_tree.width),y.height==null&&(y.height=y.width)}return p.stretch_x&&p.stretch_x.length&&aM(p,"x"),p.stretch_y&&p.stretch_y.length&&aM(p,"y"),f}(l.readFields(w5,{name:void 0},u))}(n,n.readVarint()+n.pos))}function aM(r,e){const n=[],l=r[`stretch_${e}`];let u=null;for(let f=0;f<l.length;f++)u===null?u=n.length===0?l[0]:n[n.length-1][1]+l[f]:(n.push([u,u+l[f]]),u=null);r[`stretch_${e}_areas`]=n}function w5(r,e,n){r===1?e.name=n.readString():r===2?e.metadata=function(l,u){return l.readFields(b5,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},u)}(n,n.readVarint()+n.pos):r===3&&(e.usvg_tree=function(l,u){return l.readFields(E5,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},u)}(n,n.readVarint()+n.pos),e.data="usvg_tree")}function b5(r,e,n){r===1?e.stretch_x=n.readPackedVarint():r===2?e.stretch_y=n.readPackedVarint():r===3?e.content_area=function(l,u){return l.readFields(S5,{left:0},u)}(n,n.readVarint()+n.pos):r===4&&e.variables.push(function(l,u){return l.readFields(T5,{name:void 0},u)}(n,n.readVarint()+n.pos))}function S5(r,e,n){r===1?e.left=n.readVarint():r===2?e.width=n.readVarint():r===3?e.top=n.readVarint():r===4&&(e.height=n.readVarint())}function T5(r,e,n){r===1?e.name=n.readString():r===2&&(e.rgb_color=e0(n.readVarint()),e.value="rgb_color")}function E5(r,e,n){r===1?e.width=e.height=n.readVarint():r===2?e.height=n.readVarint():r===3?e.children.push(Jv(n,n.readVarint()+n.pos)):r===4?e.linear_gradients.push(function(l,u){return l.readFields(D5,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},u)}(n,n.readVarint()+n.pos)):r===5?e.radial_gradients.push(function(l,u){return l.readFields(N5,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},u)}(n,n.readVarint()+n.pos)):r===7?e.clip_paths.push(function(l,u){return l.readFields(L5,{children:[]},u)}(n,n.readVarint()+n.pos)):r===8&&e.masks.push(function(l,u){const f=l.readFields(z5,{left:0,width:20,mask_type:oM.MASK_TYPE_LUMINANCE,children:[]},u);return f.height==null&&(f.height=f.width),f.top==null&&(f.top=f.left),f}(n,n.readVarint()+n.pos))}function Jv(r,e){return r.readFields(C5,{},e)}function C5(r,e,n){r===1?(e.group=function(l,u){return l.readFields(A5,{opacity:255,children:[]},u)}(n,n.readVarint()+n.pos),e.node="group"):r===2&&(e.path=function(l,u){return l.readFields(P5,{paint_order:1,commands:[],step:1,diffs:[],rule:C2.PATH_RULE_NON_ZERO},u)}(n,n.readVarint()+n.pos),e.node="path")}function A5(r,e,n){r===1?e.transform=Qv(n,n.readVarint()+n.pos):r===2?e.opacity=n.readVarint():r===5?e.clip_path_idx=n.readVarint():r===6?e.mask_idx=n.readVarint():r===7&&e.children.push(Jv(n,n.readVarint()+n.pos))}function Qv(r,e){return r.readFields(I5,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function I5(r,e,n){r===1?e.sx=n.readFloat():r===2?e.ky=n.readFloat():r===3?e.kx=n.readFloat():r===4?e.sy=n.readFloat():r===5?e.tx=n.readFloat():r===6&&(e.ty=n.readFloat())}function P5(r,e,n){r===1?e.fill=function(l,u){return l.readFields(M5,{rgb_color:E2,paint:"rgb_color",opacity:255},u)}(n,n.readVarint()+n.pos):r===2?e.stroke=function(l,u){return l.readFields(R5,{rgb_color:E2,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},u)}(n,n.readVarint()+n.pos):r===3?e.paint_order=n.readVarint():r===5?n.readPackedVarint(e.commands):r===6?e.step=n.readFloat():r===7?n.readPackedSVarint(e.diffs):r===8&&(e.rule=n.readVarint())}function M5(r,e,n){r===1?(e.rgb_color=e0(n.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=n.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=n.readVarint(),e.paint="radial_gradient_idx"):r===5&&(e.opacity=n.readVarint())}function e0(r){return new bn((r>>16&255)/255,(r>>8&255)/255,(255&r)/255,1)}function R5(r,e,n){r===1?(e.rgb_color=e0(n.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=n.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=n.readVarint(),e.paint="radial_gradient_idx"):r===5?n.readPackedFloat(e.dasharray):r===6?e.dashoffset=n.readFloat():r===7?e.miterlimit=n.readFloat():r===8?e.opacity=n.readVarint():r===9?e.width=n.readFloat():r===10?e.linecap=n.readVarint():r===11&&(e.linejoin=n.readVarint())}function D5(r,e,n){r===1?e.transform=Qv(n,n.readVarint()+n.pos):r===2?e.spread_method=n.readVarint():r===3?e.stops.push(lM(n,n.readVarint()+n.pos)):r===4?e.x1=n.readFloat():r===5?e.y1=n.readFloat():r===6?e.x2=n.readFloat():r===7&&(e.y2=n.readFloat())}function lM(r,e){return r.readFields(k5,{offset:0,opacity:255,rgb_color:E2},e)}function k5(r,e,n){r===1?e.offset=n.readFloat():r===2?e.opacity=n.readVarint():r===3&&(e.rgb_color=e0(n.readVarint()))}function N5(r,e,n){r===1?e.transform=Qv(n,n.readVarint()+n.pos):r===2?e.spread_method=n.readVarint():r===3?e.stops.push(lM(n,n.readVarint()+n.pos)):r===4?e.cx=n.readFloat():r===5?e.cy=n.readFloat():r===6?e.r=n.readFloat():r===7?e.fx=n.readFloat():r===8?e.fy=n.readFloat():r===9&&(e.fr=n.readFloat())}function L5(r,e,n){r===1?e.transform=Qv(n,n.readVarint()+n.pos):r===2?e.clip_path_idx=n.readVarint():r===3&&e.children.push(Jv(n,n.readVarint()+n.pos))}function z5(r,e,n){r===1?e.left=e.top=n.readFloat():r===2?e.width=e.height=n.readFloat():r===3?e.top=n.readFloat():r===4?e.height=n.readFloat():r===5?e.mask_type=n.readVarint():r===6?e.mask_idx=n.readVarint():r===7&&e.children.push(Jv(n,n.readVarint()+n.pos))}class O5{static calculate(e={},n=[]){const l=new Map,u=new Map;if(Object.keys(e).length===0)return l;n.forEach(f=>{u.set(f.name,f.rgb_color||new bn(0,0,0))});for(const[f,p]of Object.entries(e))u.has(f)?l.set(u.get(f).toString(),p):console.warn(`Ignoring unknown image variable "${f}"`);return l}}function Tp(r,e=255,n){const l=e/255,u=r.toString(),f=n.has(u)?n.get(u).clone():r.clone();return f.a*=l,f.toString()}function C_(r,e){if(!hf()){const n=document.createElement("canvas");return n.width=r,n.height=e,n}return new OffscreenCanvas(r,e)}function F5(r,e){const n=O5.calculate(e.params,r.metadata?r.metadata.variables:[]),l=r.usvg_tree,u=l.width,f=l.height,p=e.transform?e.transform:new DOMMatrix,y=Math.max(1,Math.round(u*p.a)),b=Math.max(1,Math.round(f*p.d)),S=new DOMMatrix([y/u,0,0,b/f,0,0]),A=C_(y,b).getContext("2d");return I2(A,S,l,l,n),A.getImageData(0,0,y,b)}function I2(r,e,n,l,u){for(const f of l.children)cM(r,e,n,f,u)}function cM(r,e,n,l,u){l.group?(r.save(),function(f,p,y,b,S){const A=b.mask_idx!=null?y.masks[b.mask_idx]:null,P=b.clip_path_idx!=null?y.clip_paths[b.clip_path_idx]:null;if(b.transform&&(p=Ep(b.transform).preMultiplySelf(p)),!function(L,U,H){return L.opacity!==255||U||H}(b,P!=null,A!=null))return void I2(f,p,y,b,S);const M=C_(f.canvas.width,f.canvas.height),N=M.getContext("2d");I2(N,p,y,b,S),P&&gM(N,p,y,P),A&&_M(N,p,y,A,S),f.globalAlpha=b.opacity/255,f.drawImage(M,0,0)}(r,e,n,l.group,u),r.restore()):l.path&&(r.save(),function(f,p,y,b,S){f.setTransform(p),b.paint_order===x5.PAINT_ORDER_FILL_AND_STROKE?(uM(f,y,b,S),hM(f,y,b,S)):(hM(f,y,b,S),uM(f,y,b,S))}(r,e,n,l.path,u),r.restore())}function uM(r,e,n,l){const u=n.fill;if(!u)return;const f=u.opacity/255;switch(r.save(),r.beginPath(),yM(n,r),u.paint){case"rgb_color":r.fillStyle=Tp(u.rgb_color,u.opacity,l);break;case"linear_gradient_idx":{const p=e.linear_gradients[u.linear_gradient_idx];p.transform&&r.setTransform(Ep(p.transform).preMultiplySelf(r.getTransform())),r.fillStyle=fM(r,p,f,l);break}case"radial_gradient_idx":{const p=e.radial_gradients[u.radial_gradient_idx];p.transform&&r.setTransform(Ep(p.transform).preMultiplySelf(r.getTransform())),r.fillStyle=pM(r,p,f,l)}}r.fill(dM(n)),r.restore()}function dM(r){return r.rule===C2.PATH_RULE_NON_ZERO?"nonzero":r.rule===C2.PATH_RULE_EVEN_ODD?"evenodd":void 0}function hM(r,e,n,l){const u=n.stroke;if(!u)return;const f=xM(n);r.lineWidth=u.width,r.miterLimit=u.miterlimit,r.setLineDash(u.dasharray),r.lineDashOffset=u.dashoffset;const p=u.opacity/255;switch(u.paint){case"rgb_color":r.strokeStyle=Tp(u.rgb_color,u.opacity,l);break;case"linear_gradient_idx":r.strokeStyle=fM(r,e.linear_gradients[u.linear_gradient_idx],p,l,!0);break;case"radial_gradient_idx":r.strokeStyle=pM(r,e.radial_gradients[u.radial_gradient_idx],p,l,!0)}switch(u.linejoin){case Yv.LINE_JOIN_MITER_CLIP:case Yv.LINE_JOIN_MITER:r.lineJoin="miter";break;case Yv.LINE_JOIN_ROUND:r.lineJoin="round";break;case Yv.LINE_JOIN_BEVEL:r.lineJoin="bevel"}switch(u.linecap){case A2.LINE_CAP_BUTT:r.lineCap="butt";break;case A2.LINE_CAP_ROUND:r.lineCap="round";break;case A2.LINE_CAP_SQUARE:r.lineCap="square"}r.stroke(f)}function fM(r,e,n,l,u=!1){if(e.stops.length===1){const M=e.stops[0];return Tp(M.rgb_color,M.opacity*n,l)}const{x1:f,y1:p,x2:y,y2:b}=e;let S=new DOMPoint(f,p),A=new DOMPoint(y,b);if(u){const M=Ep(e.transform);S=M.transformPoint(S),A=M.transformPoint(A)}const P=r.createLinearGradient(S.x,S.y,A.x,A.y);for(const M of e.stops)P.addColorStop(M.offset,Tp(M.rgb_color,M.opacity*n,l));return P}function pM(r,e,n,l,u=!1){if(e.stops.length===1){const K=e.stops[0];return Tp(K.rgb_color,K.opacity*n,l)}const f=Ep(e.transform),{fx:p,fy:y,fr:b,cx:S,cy:A,r:P}=e;let M=new DOMPoint(p,y),N=new DOMPoint(S,A),L=b,U=P;if(u){M=f.transformPoint(M),N=f.transformPoint(N);const K=(f.a+f.d)/2;L=b*K,U=e.r*K}const H=r.createRadialGradient(M.x,M.y,L,N.x,N.y,U);for(const K of e.stops)H.addColorStop(K.offset,Tp(K.rgb_color,K.opacity*n,l));return H}function mM(r,e,n,l){const u=l.transform?Ep(l.transform).preMultiplySelf(e):e,f=C_(r.canvas.width,r.canvas.height),p=f.getContext("2d");for(const b of l.children)if(b.group)mM(p,u,n,b.group);else if(b.path){const S=b.path,A=new Path2D;A.addPath(xM(S),u),p.fill(A,dM(S))}const y=l.clip_path_idx!=null?n.clip_paths[l.clip_path_idx]:null;y&&gM(p,u,n,y),r.globalCompositeOperation="source-over",r.drawImage(f,0,0)}function gM(r,e,n,l){const u=C_(r.canvas.width,r.canvas.height);mM(u.getContext("2d"),e,n,l),r.globalCompositeOperation="destination-in",r.drawImage(u,0,0)}function _M(r,e,n,l,u){if(l.children.length===0)return;const f=l.mask_idx!=null?n.masks[l.mask_idx]:null;f&&_M(r,e,n,f,u);const p=r.canvas.width,y=r.canvas.height,b=C_(p,y),S=b.getContext("2d"),A=l.width,P=l.height,M=l.left,N=l.top,L=new Path2D,U=new Path2D;U.rect(M,N,A,P),L.addPath(U,e),S.clip(L);for(const se of l.children)cM(S,e,n,se,u);const H=S.getImageData(0,0,p,y),K=H.data;if(l.mask_type===oM.MASK_TYPE_LUMINANCE)for(let se=0;se<K.length;se+=4)K[se+3]=K[se+3]/255*(.2126*K[se]+.7152*K[se+1]+.0722*K[se+2]);S.putImageData(H,0,0),r.globalCompositeOperation="destination-in",r.drawImage(b,0,0)}function Ep(r){return r?new DOMMatrix([r.sx,r.ky,r.kx,r.sy,r.tx,r.ty]):new DOMMatrix}function yM(r,e){const n=r.step;let l=r.diffs[0]*n,u=r.diffs[1]*n;e.moveTo(l,u);for(let f=0,p=2;f<r.commands.length;f++)switch(r.commands[f]){case E_.PATH_COMMAND_MOVE:l+=r.diffs[p++]*n,u+=r.diffs[p++]*n,e.moveTo(l,u);break;case E_.PATH_COMMAND_LINE:l+=r.diffs[p++]*n,u+=r.diffs[p++]*n,e.lineTo(l,u);break;case E_.PATH_COMMAND_QUAD:{const y=l+r.diffs[p++]*n,b=u+r.diffs[p++]*n;l=y+r.diffs[p++]*n,u=b+r.diffs[p++]*n,e.quadraticCurveTo(y,b,l,u);break}case E_.PATH_COMMAND_CUBIC:{const y=l+r.diffs[p++]*n,b=u+r.diffs[p++]*n,S=y+r.diffs[p++]*n,A=b+r.diffs[p++]*n;l=S+r.diffs[p++]*n,u=A+r.diffs[p++]*n,e.bezierCurveTo(y,b,S,A,l,u);break}case E_.PATH_COMMAND_CLOSE:e.closePath()}return e}function xM(r){return yM(r,new Path2D)}class t0{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const n=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,n),n}put(e,n){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,n)}delete(e){this.cache.delete(e)}}Bt(t0,"LRUCache");class P2{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Cs(e,e.data)}getFromCache(e,n,l){return this.cacheMap.has(l)||this.cacheMap.set(l,new t0(150)),this.cacheMap.get(l).get(Au(e.toString(),n))}setInCache(e,n,l,u){this.cacheDependenciesMap.has(u)||this.cacheDependenciesMap.set(u,new Map),this.cacheMap.has(u)||this.cacheMap.set(u,new t0(150));const f=this.cacheDependenciesMap.get(u),p=Au(e.id.toString(),l);f.get(p)||f.set(p,new Set);const y=this.cacheMap.get(u),b=e.toString();f.get(p).add(b),y.put(Au(e.toString(),l),n)}removeImagesFromCacheByIds(e,n,l=0){if(!this.cacheMap.has(l)||!this.cacheDependenciesMap.has(l))return;const u=this.cacheMap.get(l),f=this.cacheDependenciesMap.get(l);for(const p of e){const y=Au(p.toString(),n);if(f.has(y)){for(const b of f.get(y))u.delete(b);f.delete(y)}}}rasterize(e,n,l,u,f=F5){const p=this.getFromCache(e,l,u);if(p)return p.clone();const y=f(n.icon,e.options),b=P2._getImage(y);return this.setInCache(e,b,l,u),b.clone()}}class vM{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const l=this.toIdx(e,n);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function wM(r,e,n,l){let u=0,f=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(l[p])<1e-15){if(n[p]<r[p]||n[p]>e[p])return null}else{const y=1/l[p];let b=(r[p]-n[p])*y,S=(e[p]-n[p])*y;if(b>S){const A=b;b=S,S=A}if(b>u&&(u=b),S<f&&(f=S),u>f)return null}return u}function bM(r,e,n,l,u,f,p,y,b,S,A){const P=l-r,M=u-e,N=f-n,L=p-r,U=y-e,H=b-n,K=A[1]*H-A[2]*U,se=A[2]*L-A[0]*H,re=A[0]*U-A[1]*L,le=P*K+M*se+N*re;if(Math.abs(le)<1e-15)return null;const Ee=1/le,we=S[0]-r,Se=S[1]-e,Me=S[2]-n,De=(we*K+Se*se+Me*re)*Ee;if(De<0||De>1)return null;const Xe=Se*N-Me*M,Le=Me*P-we*N,Je=we*M-Se*P,yt=(A[0]*Xe+A[1]*Le+A[2]*Je)*Ee;return yt<0||De+yt>1?null:(L*Xe+U*Le+H*Je)*Ee}function SM(r,e,n){return(r-e)/(n-e)}function TM(r,e,n,l,u,f,p,y,b){const S=1<<n,A=f-l,P=p-u,M=(r+1)/S*A+l,N=(e+0)/S*P+u,L=(e+1)/S*P+u;y[0]=(r+0)/S*A+l,y[1]=N,b[0]=M,b[1]=L}class EM{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(f){const p=Math.ceil(Math.log2(f.dim/8)),y=[];let b=Math.ceil(Math.pow(2,p));const S=1/b,A=(N,L,U,H,K)=>{const se=H?1:0,re=(N+1)*U-se,le=L*U,Ee=(L+1)*U-se;K[0]=N*U,K[1]=le,K[2]=re,K[3]=Ee};let P=new vM(b);const M=[];for(let N=0;N<b*b;N++){A(N%b,Math.floor(N/b),S,!1,M);const L=Wu(M[0],M[1],f),U=Wu(M[2],M[1],f),H=Wu(M[2],M[3],f),K=Wu(M[0],M[3],f);P.minimums.push(Math.min(L,U,H,K)),P.maximums.push(Math.max(L,U,H,K)),P.leaves.push(1)}for(y.push(P),b/=2;b>=1;b/=2){const N=y[y.length-1];P=new vM(b);for(let L=0;L<b*b;L++){A(L%b,Math.floor(L/b),2,!0,M);const U=N.getElevation(M[0],M[1]),H=N.getElevation(M[2],M[1]),K=N.getElevation(M[2],M[3]),se=N.getElevation(M[0],M[3]),re=N.isLeaf(M[0],M[1]),le=N.isLeaf(M[2],M[1]),Ee=N.isLeaf(M[2],M[3]),we=N.isLeaf(M[0],M[3]),Se=Math.min(U.min,H.min,K.min,se.min),Me=Math.max(U.max,H.max,K.max,se.max),De=re&&le&&Ee&&we;P.maximums.push(Me),P.minimums.push(Se),P.leaves.push(Me-Se<=5&&De?1:0)}y.push(P)}return y}(this.dem),l=n.length-1,u=n[l];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(n,0,0,l,0)}raycastRoot(e,n,l,u,f,p,y=1){return wM([e,n,-100],[l,u,this.maximums[0]*y],f,p)}raycast(e,n,l,u,f,p,y=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,n,l,u,f,p,y);if(b==null)return null;const S=[],A=[],P=[],M=[],N=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;N.length>0;){const{idx:L,t:U,nodex:H,nodey:K,depth:se}=N.pop();if(this.leaves[L]){TM(H,K,se,e,n,l,u,P,M);const le=1<<se,Ee=(H+0)/le,we=(H+1)/le,Se=(K+0)/le,Me=(K+1)/le,De=Wu(Ee,Se,this.dem)*y,Xe=Wu(we,Se,this.dem)*y,Le=Wu(we,Me,this.dem)*y,Je=Wu(Ee,Me,this.dem)*y,yt=bM(P[0],P[1],De,M[0],P[1],Xe,M[0],M[1],Le,f,p),tt=bM(M[0],M[1],Le,P[0],M[1],Je,P[0],P[1],De,f,p),ut=Math.min(yt!==null?yt:Number.MAX_VALUE,tt!==null?tt:Number.MAX_VALUE);if(ut!==Number.MAX_VALUE)return ut;{const gt=gi([],f,p,U);if(CM(De,Xe,Je,Le,SM(gt[0],P[0],M[0]),SM(gt[1],P[1],M[1]))>=gt[2])return U}continue}let re=0;for(let le=0;le<this._siblingOffset.length;le++){TM((H<<1)+this._siblingOffset[le][0],(K<<1)+this._siblingOffset[le][1],se+1,e,n,l,u,P,M),P[2]=-100,M[2]=this.maximums[this.childOffsets[L]+le]*y;const Ee=wM(P,M,f,p);if(Ee!=null){const we=Ee;S[le]=we;let Se=!1;for(let Me=0;Me<re&&!Se;Me++)we>=S[A[Me]]&&(A.splice(Me,0,le),Se=!0);Se||(A[re]=le),re++}}for(let le=0;le<re;le++){const Ee=A[le];N.push({idx:this.childOffsets[L]+Ee,t:S[Ee],nodex:(H<<1)+this._siblingOffset[Ee][0],nodey:(K<<1)+this._siblingOffset[Ee][1],depth:se+1})}}return null}_addNode(e,n,l){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,l,u,f){if(e[u].isLeaf(n,l)===1)return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const p=u-1,y=e[p];let b=0,S=0;for(let A=0;A<this._siblingOffset.length;A++){const P=2*n+this._siblingOffset[A][0],M=2*l+this._siblingOffset[A][1],N=y.getElevation(P,M),L=y.isLeaf(P,M),U=this._addNode(N.min,N.max,L);L&&(b|=1<<A),S||(S=U)}for(let A=0;A<this._siblingOffset.length;A++)b&1<<A||this._construct(e,2*n+this._siblingOffset[A][0],2*l+this._siblingOffset[A][1],p,S+A)}}function CM(r,e,n,l,u,f){return si(si(r,n,f),si(e,l,f),u)}function Wu(r,e,n){const l=n.dim,u=ge(r*l-.5,0,l-1),f=ge(e*l-.5,0,l-1),p=Math.floor(u),y=Math.floor(f),b=Math.min(p+1,l-1),S=Math.min(y+1,l-1);return CM(n.get(p,y),n.get(b,y),n.get(p,S),n.get(b,S),u-p,f-y)}const j5={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function B5(r,e,n){return(256*r*256+256*e+n)/10-1e4}function V5(r,e,n){return 256*r+e+n/256-32768}class i0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,l,u=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return void Ki(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const f=this.dim=n.height-2,p=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=u,this._modifiedForSources={},!u){for(let b=0;b<f;b++)p[this._idx(-1,b)]=p[this._idx(0,b)],p[this._idx(f,b)]=p[this._idx(f-1,b)],p[this._idx(b,-1)]=p[this._idx(b,0)],p[this._idx(b,f)]=p[this._idx(b,f-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(f,-1)]=p[this._idx(f-1,0)],p[this._idx(-1,f)]=p[this._idx(0,f-1)],p[this._idx(f,f)]=p[this._idx(f-1,f-1)]}const y=l==="terrarium"?V5:B5;for(let b=0;b<p.length;++b){const S=4*b;this.floatView[b]=y(this.pixels[S],this.pixels[S+1],this.pixels[S+2])}this._timestamp=fa.now()}_buildQuadTree(){this._tree=new EM(this)}get(e,n,l=!1){l&&(e=ge(e,-1,this.dim),n=ge(n,-1,this.dim));const u=this._idx(e,n);return this.floatView[u]}set(e,n,l){const u=this._idx(e,n),f=this.floatView[u];return this.floatView[u]=l,l-f}static getUnpackVector(e){return j5[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){const l=[0,0,0,0],u=i0.getUnpackVector(n);let f=Math.floor((e+u[3])/u[2]);return l[2]=f%256,f=Math.floor(f/256),l[1]=f%256,f=Math.floor(f/256),l[0]=f,l}getPixels(){return new wA({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=n*this.dim,f=n*this.dim+this.dim,p=l*this.dim,y=l*this.dim+this.dim;switch(n){case-1:u=f-1;break;case 1:f=u+1}switch(l){case-1:p=y-1;break;case 1:y=p+1}const b=-n*this.dim,S=-l*this.dim;for(let A=p;A<y;A++)for(let P=u;P<f;P++){const M=4*this._idx(P,A),N=4*this._idx(P+b,A+S);this.pixels[M+0]=e.pixels[N+0],this.pixels[M+1]=e.pixels[N+1],this.pixels[M+2]=e.pixels[N+2],this.pixels[M+3]=e.pixels[N+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function U5(r,e,n){r===1?e.headerLength=n.readFixed32():r===2?e.x=n.readVarint():r===3?e.y=n.readVarint():r===4?e.z=n.readVarint():r===5&&e.layers.push(function(l,u){return l.readFields(W5,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},u)}(n,n.readVarint()+n.pos))}function G5(r,e,n){r===1?(e.delta_filter=function(l,u){return l.readFields($5,{blockSize:0},u)}(n,n.readVarint()+n.pos),e.filter="delta_filter"):r===2?(n.readVarint(),e.filter="zigzag_filter"):r===3?(n.readVarint(),e.filter="bitshuffle_filter"):r===4&&(n.readVarint(),e.filter="byteshuffle_filter")}function $5(r,e,n){r===1&&(e.blockSize=n.readVarint())}function H5(r,e,n){r===1?(n.readVarint(),e.codec="gzip_data"):r===2?(n.readVarint(),e.codec="jpeg_image"):r===3?(n.readVarint(),e.codec="webp_image"):r===4&&(n.readVarint(),e.codec="png_image")}function q5(r,e,n){let l=0,u=0;r===1?e.firstByte=n.readFixed64():r===2?e.lastByte=n.readFixed64():r===3?e.filters.push(function(f,p){return f.readFields(G5,{},p)}(n,n.readVarint()+n.pos)):r===4?e.codec=function(f,p){return f.readFields(H5,{},p)}(n,n.readVarint()+n.pos):r===5?u=n.readFloat():r===6?l=n.readFloat():r===7?e.bands.push(n.readString()):r===8?e.offset=n.readDouble():r===9&&(e.scale=n.readDouble()),e.offset===0&&(e.offset=u),e.scale===0&&(e.scale=l)}function W5(r,e,n){r===1?e.version=n.readVarint():r===2?e.name=n.readString():r===3?e.units=n.readString():r===4?e.tileSize=n.readVarint():r===5?e.buffer=n.readVarint():r===6?e.pixelFormat=n.readVarint():r===7&&e.dataIndex.push(function(l,u){return l.readFields(q5,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},u)}(n,n.readVarint()+n.pos))}function Z5(r,e,n){if(r===2)(function(l,u,f){l.readFields(X5,f,u)})(n,n.readVarint()+n.pos,e);else if(r===3)throw new Error("Not implemented")}function X5(r,e,n){if(r===1){let l=0;const u=n.readVarint()+n.pos;for(;n.pos<u;)e[l++]=n.readVarint()}}function K5(r,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let l=2;l>=1;l--){const u=l===1?1:0,f=l===2?1:0;for(let p=0;p<e[0];p++){const y=e[1]*p;for(let b=u;b<e[1];b++){const S=e[2]*(b+y);for(let A=f;A<e[2];A++){const P=e[3]*(A+S);for(let M=0;M<e[3];M++){const N=P+M;r[N]+=r[N-n]}}}}n*=e[l]}return r}function Y5(r){for(let e=0,n=r.length;e<n;e++)r[e]=r[e]>>>1^-(1&r[e]);return r}function J5(r,e){switch(e){case"uint32":return r;case"uint16":for(let n=0;n<r.length;n+=2){const l=r[n],u=r[n+1];r[n]=(240&l)>>4|(61440&l)>>8|(240&u)<<4|61440&u,r[n+1]=15&l|(3840&l)>>4|(15&u)<<8|(3840&u)<<4}return r;case"uint8":for(let n=0;n<r.length;n+=4){const l=r[n],u=r[n+1],f=r[n+2],p=r[n+3];r[n+0]=(192&l)>>6|(192&u)>>4|(192&f)>>2|192&p,r[n+1]=(48&l)>>4|(48&u)>>2|48&f|(48&p)<<2,r[n+2]=(12&l)>>2|12&u|(12&f)<<2|(12&p)<<4,r[n+3]=3&l|(3&u)<<2|(3&f)<<4|(3&p)<<6}return r;default:throw new Error(`Invalid pixel format, "${e}"`)}}Bt(i0,"DEMData"),Bt(EM,"DemMinMaxQuadTree",{omit:["dem"]});var ya=Uint8Array,A_=Uint16Array,Q5=Int32Array,AM=new ya([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),IM=new ya([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),eV=new ya([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),PM=function(r,e){for(var n=new A_(31),l=0;l<31;++l)n[l]=e+=1<<r[l-1];var u=new Q5(n[30]);for(l=1;l<30;++l)for(var f=n[l];f<n[l+1];++f)u[f]=f-n[l]<<5|l;return{b:n,r:u}},MM=PM(AM,2),RM=MM.b,tV=MM.r;RM[28]=258,tV[258]=28;for(var iV=PM(IM,0).b,DM=new A_(32768),Kr=0;Kr<32768;++Kr){var Cp=(43690&Kr)>>1|(21845&Kr)<<1;DM[Kr]=((65280&(Cp=(61680&(Cp=(52428&Cp)>>2|(13107&Cp)<<2))>>4|(3855&Cp)<<4))>>8|(255&Cp)<<8)>>1}var I_=function(r,e,n){for(var l=r.length,u=0,f=new A_(e);u<l;++u)r[u]&&++f[r[u]-1];var p,y=new A_(e);for(u=1;u<e;++u)y[u]=y[u-1]+f[u-1]<<1;p=new A_(1<<e);var b=15-e;for(u=0;u<l;++u)if(r[u])for(var S=u<<4|r[u],A=e-r[u],P=y[r[u]-1]++<<A,M=P|(1<<A)-1;P<=M;++P)p[DM[P]>>b]=S;return p},P_=new ya(288);for(Kr=0;Kr<144;++Kr)P_[Kr]=8;for(Kr=144;Kr<256;++Kr)P_[Kr]=9;for(Kr=256;Kr<280;++Kr)P_[Kr]=7;for(Kr=280;Kr<288;++Kr)P_[Kr]=8;var kM=new ya(32);for(Kr=0;Kr<32;++Kr)kM[Kr]=5;var nV=I_(P_,9),rV=I_(kM,5),M2=function(r){for(var e=r[0],n=1;n<r.length;++n)r[n]>e&&(e=r[n]);return e},ol=function(r,e,n){var l=e/8|0;return(r[l]|r[l+1]<<8)>>(7&e)&n},R2=function(r,e){var n=e/8|0;return(r[n]|r[n+1]<<8|r[n+2]<<16)>>(7&e)},sV=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],al=function(r,e,n){var l=new Error(e||sV[r]);if(l.code=r,Error.captureStackTrace&&Error.captureStackTrace(l,al),!n)throw l;return l},oV=new ya(0),aV=typeof TextDecoder<"u"&&new TextDecoder;try{aV.decode(oV,{stream:!0})}catch{}const lV={gzip_data:"gzip"};class ja extends Error{constructor(e){super(e),this.name="MRTError"}}const cV={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},NM={uint32:1,uint16:2,uint8:4},uV={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let D2;class n0{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const n=this.layers[e];if(!n)throw new ja(`Layer '${e}' not found`);return n}getHeaderLength(e){const n=new Uint8Array(e),l=new DataView(e);if(n[0]!==13)throw new ja("File is not a valid MRT.");return l.getUint32(1,!0)}parseHeader(e){const n=new Uint8Array(e),l=this.getHeaderLength(e);if(n.length<l)throw new ja(`Expected header with length >= ${l} but got buffer of length ${n.length}`);const u=new D2(n.subarray(0,l)).readFields(U5,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==u.x||this.y!==u.y||this.z!==u.z))throw new ja(`Invalid attempt to parse header ${u.z}/${u.x}/${u.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=u.x,this.y=u.y,this.z=u.z;for(const f of u.layers)this.layers[f.name]=new LM(f,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const n=[],l=this.getLayer(e.layerName);for(let u of e.blockIndices){const f=l.dataIndex[u],p=f.firstByte-e.firstByte,y=f.lastByte-e.firstByte;if(l._blocksInProgress.has(u))continue;const b={layerName:l.name,firstByte:p,lastByte:y,pixelFormat:l.pixelFormat,blockIndex:u,blockShape:[f.bands.length].concat(l.bandShape),buffer:l.buffer,codec:f.codec.codec,filters:f.filters.map(S=>S.filter)};l._blocksInProgress.add(u),n.push(b)}return new zM(n,()=>{n.forEach(u=>l._blocksInProgress.delete(u.blockIndex))},(u,f)=>{if(n.forEach(p=>l._blocksInProgress.delete(p.blockIndex)),u)throw u;f.forEach(p=>{this.getLayer(p.layerName).processDecodedData(p)})})}}class LM{constructor({version:e,name:n,units:l,tileSize:u,pixelFormat:f,buffer:p,dataIndex:y},b){if(this.version=e,this.version!==1)throw new ja(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=l,this.tileSize=u,this.buffer=p,this.pixelFormat=cV[f],this.dataIndex=y,this.bandShape=[u+2*p,u+2*p,NM[this.pixelFormat]],this._decodedBlocks=new t0(b?b.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return NM[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.put(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(const[l,u]of this.dataIndex.entries()){for(const[f,p]of u.bands.entries())if(p===e)return{bandIndex:n+f,blockIndex:l,blockBandIndex:f};n+=u.bands.length}break;case"number":for(const[l,u]of this.dataIndex.entries()){if(e>=n&&e<n+u.bands.length)return{bandIndex:e,blockIndex:l,blockBandIndex:e-n};n+=u.bands.length}break;default:throw new ja(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let n=1/0,l=-1/0;const u=[],f=new Set;for(const p of e){const{blockIndex:y}=this.getBlockForBand(p);if(y<0)throw new ja(`Invalid band: ${JSON.stringify(p)}`);const b=this.dataIndex[y];u.includes(y)||u.push(y),f.add(y),n=Math.min(n,b.firstByte),l=Math.max(l,b.lastByte)}if(f.size>this.cacheSize)throw new ja(`Number of blocks to decode (${f.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:n,lastByte:l,blockIndices:u}}hasBand(e){const{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){const{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){const{blockIndex:n,blockBandIndex:l}=this.getBlockForBand(e);if(n<0)throw new ja(`Band not found: ${JSON.stringify(e)}`);const u=this._decodedBlocks.get(n.toString());if(!u)throw new ja(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const f=this.dataIndex[n],p=this.bandShape.reduce((S,A)=>S*A,1),y=l*p,b=u.subarray(y,y+p);return{data:b,bytes:new Uint8Array(b.buffer).subarray(b.byteOffset,b.byteOffset+b.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:f.offset,scale:f.scale}}}n0.setPbf=function(r){D2=r};class zM{constructor(e,n,l){this.tasks=e,this._onCancel=n,this._onComplete=l,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}n0.performDecoding=function(r,e){const n=new Uint8Array(r);return Promise.all(e.tasks.map(l=>{const{layerName:u,firstByte:f,lastByte:p,pixelFormat:y,blockShape:b,blockIndex:S,filters:A,codec:P}=l,M=n.subarray(f,p+1),N=new Uint32Array(b[0]*b[1]*b[2]);let L;if(P!=="gzip_data")throw new ja(`Unhandled codec: ${P}`);return L=function(U,H){if(!globalThis.DecompressionStream&&H==="gzip_data")return Promise.resolve(((le=function(Se){Se[0]==31&&Se[1]==139&&Se[2]==8||al(6,"invalid gzip data");var Me=Se[3],De=10;4&Me&&(De+=2+(Se[10]|Se[11]<<8));for(var Xe=(Me>>3&1)+(Me>>4&1);Xe>0;Xe-=!Se[De++]);return De+(2&Me)}(re=U))+8>re.length&&al(6,"invalid gzip data"),function(Se,Me,De,Xe){var Le=Se.length;if(!Le||Me.f&&!Me.l)return De||new ya(0);var Je=!De,yt=Je||Me.i!=2,tt=Me.i;Je&&(De=new ya(3*Le));var ut,gt,We=function(or){var Wn=De.length;if(or>Wn){var Un=new ya(Math.max(2*Wn,or));Un.set(De),De=Un}},dt=Me.f||0,ze=Me.p||0,Ze=Me.b||0,wt=Me.l,ft=Me.d,Zt=Me.m,Ut=Me.n,lt=8*Le;do{if(!wt){dt=ol(Se,ze,1);var pt=ol(Se,ze+1,3);if(ze+=3,!pt){var $t=Se[(he=4+((ze+7)/8|0))-4]|Se[he-3]<<8,zt=he+$t;if(zt>Le){tt&&al(0);break}yt&&We(Ze+$t),De.set(Se.subarray(he,zt),Ze),Me.b=Ze+=$t,Me.p=ze=8*zt,Me.f=dt;continue}if(pt==1)wt=nV,ft=rV,Zt=9,Ut=5;else if(pt==2){var At=ol(Se,ze,31)+257,Ot=ol(Se,ze+10,15)+4,li=At+ol(Se,ze+5,31)+1;ze+=14;for(var vi=new ya(li),Di=new ya(19),Ii=0;Ii<Ot;++Ii)Di[eV[Ii]]=ol(Se,ze+3*Ii,7);ze+=3*Ot;var Yi=M2(Di),Bi=(1<<Yi)-1,qn=I_(Di,Yi);for(Ii=0;Ii<li;){var he,fe=qn[ol(Se,ze,Bi)];if(ze+=15&fe,(he=fe>>4)<16)vi[Ii++]=he;else{var He=0,bt=0;for(he==16?(bt=3+ol(Se,ze,3),ze+=2,He=vi[Ii-1]):he==17?(bt=3+ol(Se,ze,7),ze+=3):he==18&&(bt=11+ol(Se,ze,127),ze+=7);bt--;)vi[Ii++]=He}}var Mt=vi.subarray(0,At),It=vi.subarray(At);Zt=M2(Mt),Ut=M2(It),wt=I_(Mt,Zt),ft=I_(It,Ut)}else al(1);if(ze>lt){tt&&al(0);break}}yt&&We(Ze+131072);for(var Gt=(1<<Zt)-1,mi=(1<<Ut)-1,qi=ze;;qi=ze){var Wi=(He=wt[R2(Se,ze)&Gt])>>4;if((ze+=15&He)>lt){tt&&al(0);break}if(He||al(2),Wi<256)De[Ze++]=Wi;else{if(Wi==256){qi=ze,wt=null;break}var Li=Wi-254;Wi>264&&(Li=ol(Se,ze,(1<<(ki=AM[Ii=Wi-257]))-1)+RM[Ii],ze+=ki);var Mn=ft[R2(Se,ze)&mi],ur=Mn>>4;if(Mn||al(3),ze+=15&Mn,It=iV[ur],ur>3){var ki=IM[ur];It+=R2(Se,ze)&(1<<ki)-1,ze+=ki}if(ze>lt){tt&&al(0);break}yt&&We(Ze+131072);var Kn=Ze+Li;if(Ze<It){var Vn=0-It,Tn=Math.min(It,Kn);for(Vn+Ze<0&&al(3);Ze<Tn;++Ze)De[Ze]=(void 0)[Vn+Ze]}for(;Ze<Kn;++Ze)De[Ze]=De[Ze-It]}}Me.l=wt,Me.p=qi,Me.b=Ze,Me.f=dt,wt&&(dt=1,Me.m=Zt,Me.d=ft,Me.n=Ut)}while(!dt);return Ze!=De.length&&Je?(ut=De,((gt=Ze)==null||gt>ut.length)&&(gt=ut.length),new ya(ut.subarray(0,gt))):De.subarray(0,Ze)}(re.subarray(le,-8),{i:2},new ya(((K=re)[(se=K.length)-4]|K[se-3]<<8|K[se-2]<<16|K[se-1]<<24)>>>0))));var K,se,re,le;const Ee=lV[H];if(!Ee)throw new Error(`Unhandled codec: ${H}`);const we=new globalThis.DecompressionStream(Ee);return new Response(new Blob([U]).stream().pipeThrough(we)).arrayBuffer().then(Se=>new Uint8Array(Se))}(M,P).then(U=>(function(H,K){H.readFields(Z5,K)}(new D2(U),N),new uV[y](N.buffer))),L.then(U=>{for(let H=A.length-1;H>=0;H--)switch(A[H]){case"delta_filter":K5(U,b);break;case"zigzag_filter":Y5(U);break;case"bitshuffle_filter":J5(U,y);break;default:throw new ja(`Unhandled filter "${A[H]}"`)}return{layerName:u,blockIndex:S,data:U}}).catch(U=>{throw U})}))},Bt(zM,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Bt(n0,"MapboxRasterTile"),Bt(LM,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class OM{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const l=e[n];this._stringToNumber[l]=n,this._numberToString[n]=l}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const dV=["id","tile","layer","source","sourceLayer","state"];class Ap{constructor(e,n,l,u,f){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=l,this._y=u,this.properties=e.properties,this.id=f}clone(){const e=new Ap(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const n of dV)this[n]!==void 0&&(e[n]=this[n]);return e}}class FM{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Gl(Et,16,0),this.featureIndexArray=new ev,this.promoteId=n,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,n,l,u,f,p=0,y=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,u,f,p);const S=this.grid;for(let A=0;A<n.length;A++){const P=n[A],M=[1/0,1/0,-1/0,-1/0];for(let N=0;N<P.length;N++){const L=P[N];M[0]=Math.min(M[0],L.x),M[1]=Math.min(M[1],L.y),M[2]=Math.max(M[2],L.x),M[3]=Math.max(M[3],L.y)}y!==0&&(M[0]-=y,M[1]-=y,M[2]+=y,M[3]+=y),M[0]<Et&&M[1]<Et&&M[2]>=0&&M[3]>=0&&S.insert(b,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ht(new Rv(this.rawTileData)).layers,this.sourceLayerCoder=new OM(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n){const{tilespaceGeometry:l,transform:u,tileTransform:f,pixelPosMatrix:p,availableImages:y,worldview:b}=n;this.loadVTLayers(),this.serializedLayersCache.clear();const S=l.bufferedTilespaceBounds,A=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(L,U,H,K)=>Tr(l.bufferedTilespaceGeometry,L,U,H,K));A.sort(hV);let P=null;u.elevation&&A.length>0&&(P=Sp.create(u.elevation,this.tileID));const M={};let N;for(let L=0;L<A.length;L++){const U=A[L];if(U===N)continue;N=U;const H=this.featureIndexArray.get(U);let K=null;this.is3DTile?this.loadMatchingModelFeature(M,H,e,l,u,b):this.loadMatchingFeature(M,H,e,y,b,(se,re,le,Ee=0)=>(K||(K=Ae(se,this.tileID.canonical,f)),re.queryIntersectsFeature(l,se,le,K,this.z,u,p,P,Ee)))}return M}loadMatchingFeature(e,n,l,u,f,p){const{featureIndex:y,bucketIndex:b,sourceLayerIndex:S,layoutVertexArrayOffset:A}=n,P=this.bucketLayerIDs[b],M=l.layers,N=Object.keys(M);if(N.length&&!Xi(N,P))return;const L=l.sourceCache,U=this.sourceLayerCoder.decode(S),H=this.vtLayers[U].feature(y),K=this.getId(H,U);for(let se=0;se<P.length;se++){const re=P[se];if(!M[re])continue;const{styleLayer:le,targets:Ee}=M[re];let we={};K!==void 0&&(we=L.getFeatureState(le.sourceLayer,K));const Se=!p||p(H,le,we,A);if(!Se)continue;const Me=new Ap(H,this.z,this.x,this.y,K);Me.tile=this.tileID.canonical,Me.state=we;let De=this.serializedLayersCache.get(re);De||(De=le.serialize(),De.id=re,this.serializedLayersCache.set(re,De)),Me.source=De.source,Me.sourceLayer=De["source-layer"],Me.layer=Ve({},De),Me.layer.paint=jM(De.paint,le.paint,H,we,u),Me.layer.layout=jM(De.layout,le.layout,H,we,u);let Xe=!1;for(const Le of Ee){this.updateFeatureProperties(Me,Le);const{filter:Je}=Le;if(Je){if(H.properties=Me.properties,Je.needGeometry){const yt=qe(H,!0);if(!Je.filter(new Pn(this.tileID.overscaledZ,{worldview:f}),yt,this.tileID.canonical))continue}else if(!Je.filter(new Pn(this.tileID.overscaledZ,{worldview:f}),H))continue}Xe=!0,Le.targetId&&this.addFeatureVariant(Me,Le)}Xe&&this.appendToResult(e,re,y,Me,Se)}}loadMatchingModelFeature(e,n,l,u,f,p){const{featureIndex:y,bucketIndex:b}=n,S=this.bucketLayerIDs[b],A=l.layers,P=Object.keys(A);if(!P.length||Xi(P,S))for(let M=0;M<S.length;M++){const N=S[M],{styleLayer:L,targets:U}=A[N];if(L.type!=="model")continue;const H=u.tile,K=H.getBucket(L);if(!(K&&K instanceof Kv))continue;const se=_5(K,y,u,f);if(!se)continue;const{z:re,x:le,y:Ee}=H.tileID.canonical,{feature:we,intersectionZ:Se,position:Me}=se;let De={};we.id!==void 0&&(De=l.sourceCache.getFeatureState(L.sourceLayer,we.id));const Xe=new Ap({},re,le,Ee,we.id);Xe.tile=this.tileID.canonical,Xe.state=De,Xe.properties=we.properties,Xe.geometry={type:"Point",coordinates:[Me.lng,Me.lat]};let Le=this.serializedLayersCache.get(N);Le||(Le=L.serialize(),Le.id=N,this.serializedLayersCache.set(N,Le)),Xe.source=Le.source,Xe.sourceLayer=Le["source-layer"],Xe.layer=Ve({},Le);let Je=!1;for(const yt of U){this.updateFeatureProperties(Xe,yt);const{filter:tt}=yt;if(tt){if(we.properties=Xe.properties,tt.needGeometry){if(!tt.filter(new Pn(this.tileID.overscaledZ,{worldview:p}),we,this.tileID.canonical))continue}else if(!tt.filter(new Pn(this.tileID.overscaledZ,{worldview:p}),we))continue}Je=!0,yt.targetId&&this.addFeatureVariant(Xe,yt)}Je&&this.appendToResult(e,N,y,Xe,Se)}}updateFeatureProperties(e,n,l){if(n.properties){const u={};for(const f in n.properties){const p=n.properties[f].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,l);p!=null&&(u[f]=p)}e.properties=u}}addFeatureVariant(e,n,l){const u={target:n.target,namespace:n.namespace,uniqueFeatureID:n.uniqueFeatureID};n.properties&&(u.properties=e.properties),e.variants=e.variants||{},e.variants[n.targetId]=e.variants[n.targetId]||[],e.variants[n.targetId].push(u)}appendToResult(e,n,l,u,f){let p=e[n];p===void 0&&(p=e[n]=[]),p.push({featureIndex:l,feature:u,intersectionZ:f})}lookupSymbolFeatures(e,n,l,u,f,p){const y={};this.loadVTLayers();for(const b of e)this.loadMatchingFeature(y,{bucketIndex:n,sourceLayerIndex:l,featureIndex:b,layoutVertexArrayOffset:0},u,f,p);return y}loadFeature(e){const{featureIndex:n,sourceLayerIndex:l}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(l),f=this.vtFeatures[u];if(f[n])return f[n];const p=this.vtLayers[u].feature(n);return f[n]=p,p}hasLayer(e){for(const n of this.bucketLayerIDs)for(const l of n)if(e===l)return!0;return!1}getId(e,n){let l=e.id;if(this.promoteId){const u=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[n];if(u!=null)if(Array.isArray(u)){if(!this.promoteIdExpression){const f=Ic(u);if(f.result!=="success"){const p=f.value.map(y=>`${y.key}: ${y.message}`).join(", ");return void Ki(`Failed to create expression for promoteId: ${p}`)}this.promoteIdExpression=f.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new rh),l=this.promoteIdExpression.evaluate({zoom:0},e)}else l=e.properties[u];typeof l=="boolean"&&(l=Number(l))}return l}}function jM(r,e,n,l,u){return Ti(r,(f,p)=>{const y=e instanceof ga?e.get(p):null;return y&&y.evaluate?y.evaluate(n,l,void 0,u):y})}function hV(r,e){return e-r}Bt(FM,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const BM=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class k2{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,l]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=l>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const f=BM[15&l];if(!f)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new k2(y,p,f,e)}constructor(e,n=64,l=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const f=BM.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-y%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${l}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+y+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=n,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return N2(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,l,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:p,nodeSize:y}=this,b=[0,f.length-1,0],S=[];for(;b.length;){const A=b.pop()||0,P=b.pop()||0,M=b.pop()||0;if(P-M<=y){for(let H=M;H<=P;H++){const K=p[2*H],se=p[2*H+1];K>=e&&K<=l&&se>=n&&se<=u&&S.push(f[H])}continue}const N=M+P>>1,L=p[2*N],U=p[2*N+1];L>=e&&L<=l&&U>=n&&U<=u&&S.push(f[N]),(A===0?e<=L:n<=U)&&(b.push(M),b.push(N-1),b.push(1-A)),(A===0?l>=L:u>=U)&&(b.push(N+1),b.push(P),b.push(1-A))}return S}within(e,n,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:f,nodeSize:p}=this,y=[0,u.length-1,0],b=[],S=l*l;for(;y.length;){const A=y.pop()||0,P=y.pop()||0,M=y.pop()||0;if(P-M<=p){for(let H=M;H<=P;H++)UM(f[2*H],f[2*H+1],e,n)<=S&&b.push(u[H]);continue}const N=M+P>>1,L=f[2*N],U=f[2*N+1];UM(L,U,e,n)<=S&&b.push(u[N]),(A===0?e-l<=L:n-l<=U)&&(y.push(M),y.push(N-1),y.push(1-A)),(A===0?e+l>=L:n+l>=U)&&(y.push(N+1),y.push(P),y.push(1-A))}return b}}function N2(r,e,n,l,u,f){if(u-l<=n)return;const p=l+u>>1;VM(r,e,p,l,u,f),N2(r,e,n,l,p-1,1-f),N2(r,e,n,p+1,u,1-f)}function VM(r,e,n,l,u,f){for(;u>l;){if(u-l>600){const S=u-l+1,A=n-l+1,P=Math.log(S),M=.5*Math.exp(2*P/3),N=.5*Math.sqrt(P*M*(S-M)/S)*(A-S/2<0?-1:1);VM(r,e,n,Math.max(l,Math.floor(n-A*M/S+N)),Math.min(u,Math.floor(n+(S-A)*M/S+N)),f)}const p=e[2*n+f];let y=l,b=u;for(M_(r,e,l,n),e[2*u+f]>p&&M_(r,e,l,u);y<b;){for(M_(r,e,y,b),y++,b--;e[2*y+f]<p;)y++;for(;e[2*b+f]>p;)b--}e[2*l+f]===p?M_(r,e,l,b):(b++,M_(r,e,b,u)),b<=n&&(l=b+1),n<=b&&(u=b-1)}}function M_(r,e,n,l){L2(r,n,l),L2(e,2*n,2*l),L2(e,2*n+1,2*l+1)}function L2(r,e,n){const l=r[e];r[e]=r[n],r[n]=l}function UM(r,e,n,l){const u=r-n,f=e-l;return u*u+f*f}s.$=cs,s.A=Qa,s.B=tl,s.C=Au,s.D=fp,s.E=xc,s.F=2,s.G=g_,s.H=pP,s.I=_o,s.J=Dl,s.K=class extends Xv{},s.L=vc,s.M=Wx,s.N=Gf,s.O=Uf,s.P=ht,s.Q=Ox,s.R=qd,s.S=gg,s.T=Xb,s.U=_h,s.V=Xv,s.W=_g,s.X=Ic,s.Y=If,s.Z=yu,s._=_u,s.a=function(r){return gs.API_CDN_URL_REGEX.test(r)},s.a$=it,s.a0=jm,s.a1=yh,s.a2=$f,s.a3=zx,s.a4=function(r){const e=r.value;let n=[];if(!e)return n;const l=Dl(e);return l!=="string"?(n=n.concat([new Xv(r.key,e,`string expected, "${l}" found`)]),n):(b2(e,!0)||(n=n.concat([new Xv(r.key,e,`invalid url "${e}"`)])),n)},s.a5=Ne,s.a6=gh,s.a7=xr,s.a8=xt,s.a9=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return Br(r.expression.evaluate(e))}interpolate(r,e,n){return{x:si(r.x,e.x,n),y:si(r.y,e.y,n),z:si(r.z,e.z,n),azimuthal:si(r.azimuthal,e.azimuthal,n),polar:si(r.polar,e.polar,n)}}},s.aA=rt,s.aB=Fs,s.aC=Es,s.aD=$,s.aE=Pe,s.aF=function(r,e){const n={};for(let l=0;l<e.length;l++){const u=e[l];u in r&&(n[u]=r[u])}return n},s.aG=z,s.aH=X,s.aI=class{constructor(r){this.entries={},this.scheduler=r}request(r,e,n,l){const u=this.entries[r]=this.entries[r]||{callbacks:[]};if(u.result){const[f,p]=u.result;return this.scheduler?this.scheduler.add(()=>{l(f,p)},e):l(f,p),()=>{}}return u.callbacks.push(l),u.cancel||(u.cancel=n((f,p)=>{u.result=[f,p];for(const y of u.callbacks)this.scheduler?this.scheduler.add(()=>{y(f,p)},e):y(f,p);setTimeout(()=>delete this.entries[r],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(f=>f!==l),u.callbacks.length||(u.cancel(),delete this.entries[r]))}}},s.aJ=function(r,e,n){const l=JSON.stringify(r.request);return r.data&&(this.deduped.entries[l]={result:[null,r.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},u=>{const f=Wd(r.request,(p,y,b,S)=>{p?u(p):y&&u(null,{vectorTile:n?void 0:new Ht(new Rv(y)),rawData:y,cacheControl:b,expires:S})});return()=>{f.cancel(),u()}},e)},s.aK=function(r){Nm++,Nm>Ja&&(r.getActor().send("enforceCacheSizeLimit",pa),Nm=0)},s.aL=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log(r)/Math.LN2))},s.aM=Gr,s.aN=GP,s.aO=XP,s.aP=UP,s.aQ=function(r,e){const n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let l=0;l<r.length;l++){const u=document.createElement("source");Uw(r[l])||(n.crossOrigin="Anonymous"),u.src=r[l],n.appendChild(u)}return{cancel:()=>{}}},s.aR=u_,s.aS=function(r){return fetch(r).then(e=>e.arrayBuffer()).then(e=>vI(e,0,r))},s.aT=II,s.aU=class{constructor(r,e,n,l){this.id=r,this.position=e!=null?new D(e[0],e[1]):new D(0,0),this.orientation=n??[0,0,0],this.nodes=l,this.uploaded=!1,this.aabb=new Gi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(r,e){if(oe(r.matrix,e,r.matrix),r.meshes)for(const n of r.meshes){const l=Gi.applyTransformFast(n.aabb,r.matrix);this.aabb.encapsulate(l)}if(r.children)for(const n of r.children)this._applyTransformations(n,r.matrix)}computeBoundsAndApplyParent(){const r=J([]);for(const e of this.nodes)this._applyTransformations(e,r)}computeModelMatrix(r,e,n,l,u,f,p=!1){CI(this.matrix,this,r.transform,this.position,e,n,l,u,f,p)}upload(r){if(!this.uploaded){for(const e of this.nodes)Jb(e,r);for(const e of this.nodes)Mv(e);this.uploaded=!0}}destroy(){for(const r of this.nodes)Qb(r)}},s.aV=_i,s.aW=x_,s.aX=ne,s.aY=ae,s.aZ=Pu,s.a_=Qn,s.aa=Pn,s.ab=Ul,s.ac=ve,s.ad=Ri,s.ae=Kt,s.af=Re,s.ag=ga,s.ah=Bu,s.ai=si,s.aj=Et,s.ak=dx,s.al=pn,s.am=bn,s.an=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return function([n,l]){const u=Br([1,n,l]);return{x:u.x,y:u.y,z:u.z}}(r.expression.evaluate(e))}interpolate(r,e,n){return{x:si(r.x,e.x,n),y:si(r.y,e.y,n),z:si(r.z,e.z,n)}}},s.ao=function(r,e,n=0,l=!0){const u=new ht(n,n),f=r.sub(u),p=e.add(u),y=[f,new ht(p.x,f.y),p,new ht(f.x,p.y)];return l&&y.push(f.clone()),y},s.ap=function(r,e){const n=[];for(let l=0;l<r.length;l++){const u=$e(l-1,-1,r.length-1),f=$e(l+1,-1,r.length-1),p=r[l],y=r[f],b=r[u].sub(p).unit(),S=y.sub(p).unit(),A=S.angleWithSep(b.x,b.y),P=b.add(S).unit().mult(-1*e/Math.sin(A/2));n.push(p.add(P))}return n},s.aq=IP,s.ar=Tr,s.as=function(r,e,n=0){return Pt(((e.x-n)*r.scale-r.x)*Et,(e.y*r.scale-r.y)*Et,de(e.z,e.y))},s.at=On,s.au=wi,s.av=un,s.aw=jI,s.ax=function(r){let e=1/0,n=1/0,l=-1/0,u=-1/0;for(const f of r)e=Math.min(e,f.x),n=Math.min(n,f.y),l=Math.max(l,f.x),u=Math.max(u,f.y);return{min:new ht(e,n),max:new ht(l,u)}},s.ay=ge,s.az=oe,s.b=function(r){return gs.API_FONTS_REGEX.test(r)},s.b$=f2,s.b0=Yx,s.b1=Hv,s.b2=function(){Na.isLoading()||Na.isLoaded()||Tg()!=="deferred"||$x()},s.b3=Eu,s.b4=qe,s.b5=Ap,s.b6=_n,s.b7=i2,s.b8=Nb,s.b9=Ae,s.bA=function(r,e){const{x:n,y:l}=r.point,u=lA(n,l,r.worldSize/r._pixelsPerMercatorPixel,0,0);return oe(u,u,Tb(Kl(e)))},s.bB=G,s.bC=Zr,s.bD=function(r,e){return Math.hypot(e[0]-r[0],e[1]-r[1],e[2]-r[2])},s.bE=gi,s.bF=Fi,s.bG=ni,s.bH=m_,s.bI=Vo,s.bJ=c2,s.bK=function(r,e,n,l,u){const f=5*e+2;r.float32[f+0]=n,r.float32[f+1]=l,r.float32[f+2]=u},s.bL=$v,s.bM=Ss,s.bN=go,s.bO=io,s.bP=jr,s.bQ=$e,s.bR=function(r,e,n,l){var u=new j(4);return u[0]=r,u[1]=e,u[2]=n,u[3]=l,u},s.bS=Sv,s.bT=Ln,s.bU=hs,s.bV=jA,s.bW=KP,s.bX=GA,s.bY=Ob,s.bZ=l2,s.b_=wP,s.ba=co,s.bb=Fg,s.bc=iA,s.bd=rr,s.be=dp,s.bf=v2,s.bg=function(r,e){const n=Bu(e.zoom);if(n===0)return Kl(r);const l=hv(r),u=Sb(l),f=$(l.getWest())*e.worldSize,p=$(l.getEast())*e.worldSize,y=X(l.getNorth())*e.worldSize,b=X(l.getSouth())*e.worldSize,S=[f,y,0],A=[p,y,0],P=[f,b,0],M=[p,b,0],N=ce([],e.globeMatrix);return Ri(S,S,N),Ri(A,A,N),Ri(P,P,N),Ri(M,M,N),u[0]=Lc(u[0],P,n),u[1]=Lc(u[1],M,n),u[2]=Lc(u[2],A,n),u[3]=Lc(u[3],S,n),Gi.fromPoints(u)},s.bh=pv,s.bi=ce,s.bj=Zg,s.bk=Lc,s.bl=Iu,s.bm=$j,s.bn=et,s.bo=ee,s.bp=n0,s.bq=Rv,s.br=Wd,s.bs=function(r,e){const n=[];for(const l in r)l in e||n.push(l);return n},s.bt=ke,s.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.bv=Ka,s.bw=function(r){var e=new j(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},s.bx=J,s.by=Ke,s.bz=ue,s.c=cf,s.c$=45,s.c0=k2,s.c1=jt,s.c2=bs,s.c3=fi,s.c4=function(r,e,n){n*=.5;var l=e[0],u=e[1],f=e[2],p=e[3],y=Math.sin(n),b=Math.cos(n);return r[0]=l*b+u*y,r[1]=u*b-l*y,r[2]=f*b+p*y,r[3]=p*b-f*y,r},s.c5=di,s.c6=cr,s.c7=function(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r},s.c8=Xt,s.c9=function(r,e,n,l,u){var f,p=1/Math.tan(e/2);return r[0]=p/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=p,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,u!=null&&u!==1/0?(r[10]=(u+l)*(f=1/(l-u)),r[14]=2*u*l*f):(r[10]=-1,r[14]=-2*l),r},s.cA=Fo,s.cB=sA,s.cC=function(r,e,n,l,u,f,p,y,b){if(b.name==="globe")return sA(r,e,new Fo(n,l,u),!1);const S=x_({z:n,x:l,y:u},b);return new Gi([(f+S.x/S.scale)*e,e*(S.y/S.scale),p],[(f+S.x2/S.scale)*e,e*(S.y2/S.scale),y])},s.cD=function(r,e,n){return r[0]=Math.min(e[0],n[0]),r[1]=Math.min(e[1],n[1]),r[2]=Math.min(e[2],n[2]),r[3]=Math.min(e[3],n[3]),r},s.cE=function(r,e,n){return r[0]=Math.max(e[0],n[0]),r[1]=Math.max(e[1],n[1]),r[2]=Math.max(e[2],n[2]),r[3]=Math.max(e[3],n[3]),r},s.cF=function(r){const e=Math.round((r+45+360)%360/90)%4;return Y[e]},s.cG=_e,s.cH=_r,s.cI=d,s.cJ=function(r){const e=J(new Float64Array(16));oe(e,r.pixelMatrix,r.globeMatrix);const n=[0,g,0],l=[0,_,0];return Ri(n,n,e),Ri(l,l,e),[n[0]>0&&n[0]<=r.width&&n[1]>0&&n[1]<=r.height&&!Cb(r,new D(r.center.lat,90)),l[0]>0&&l[0]<=r.width&&l[1]>0&&l[1]<=r.height&&!Cb(r,new D(r.center.lat,-90))]},s.cK=function(r,e){const{scale:n}=r.tileTransform,l=n*Et/(r.tileSize*Math.pow(2,e.zoom-r.tileID.overscaledZ+r.tileID.canonical.z));return function(u,f,p){var y=f[1],b=f[2],S=f[3],A=p[0],P=p[1];return u[0]=f[0]*A,u[1]=y*A,u[2]=b*P,u[3]=S*P,u}(new Float32Array(4),e.inverseAdjustmentMatrix,[l,l])},s.cL=Iv,s.cM=Ct,s.cN=wI,s.cO=function(r){const e=wI(r,!0);return G([],[e[0],e[1],e[4],e[5]])},s.cP=Q,s.cQ=mn,s.cR=Ie,s.cS=function(r){const{x:e,y:n}=r.point,{lng:l,lat:u}=r._center;return lA(e,n,r.worldSize,l,u)},s.cT=ot,s.cU=Be,s.cV=jo,s.cW=fr,s.cX=cv,s.cY=function(r,e,n){let l=0;for(let u=0;u<2;++u)r[u]>0&&(l+=(r[u]-0)*(r[u]-0)),e[u]<0&&(l+=(0-e[u])*(0-e[u]));return l},s.cZ=function(r){return r*r*r*r*r},s.c_=q,s.ca=function(r,e,n,l,u,f,p){var y=1/(e-n),b=1/(l-u),S=1/(f-p);return r[0]=-2*y,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*b,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*S,r[11]=0,r[12]=(e+n)*y,r[13]=(u+l)*b,r[14]=(p+f)*S,r[15]=1,r},s.cb=Z,s.cc=function(r,e,n){r[4*e+0]=n[0],r[4*e+1]=n[1],r[4*e+2]=n[2],r[4*e+3]=n[3]},s.cd=up,s.ce=zu,s.cf=Rr,s.cg=Oa,s.ch=Ch,s.ci=D,s.cj=kP,s.ck=function(){var r=new j(4);return j!=Float32Array&&(r[1]=0,r[2]=0),r[0]=1,r[3]=1,r},s.cl=function(r,e,n){var l=e[0],u=e[1],f=e[2],p=e[3],y=Math.sin(n),b=Math.cos(n);return r[0]=l*b+f*y,r[1]=u*b+p*y,r[2]=l*-y+f*b,r[3]=u*-y+p*b,r},s.cm=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]},s.cn=wr,s.co=function(r){return Math.hypot(r[0],r[1],r[2],r[3])},s.cp=br,s.cq=Cn,s.cr=Fa,s.cs=3,s.ct=2,s.cu=7,s.cv=6,s.cw=nn,s.cx=mt,s.cy=yn,s.cz=bI,s.d=function(r){return gs.API_TILEJSON_REGEX.test(r)},s.d$=(r,e,n,l,u,f,p,y,b,S)=>{const A=r.transform,P=A.calculatePixelsToTileUnitsMatrix(e),M=n.paint.get("line-trim-color-use-theme").constantOr("default")==="none",N=A.pitch<15?BI(.07,.7,ge((14-A.zoom)/5,0,1)):.07;return{u_matrix:UI(r,e,n,l),u_pixels_to_tile_units:P,u_device_pixel_ratio:f,u_width_scale:p,u_floor_width_scale:y,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:u,u_texsize:$I(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:VI(e,r.transform),u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toPremultipliedRenderColor(M?null:n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength"),u_zbias_factor:N,u_tile_to_meter:xe(e.tileID.canonical,0),u_ground_shadow_factor:S}},s.d0=Eh,s.d1=function(r,e,n){const l=Math.sqrt(r*r+e*e+n*n),u=l>0?Math.acos(n/l)*Fd:0;let f=r!==0||e!==0?Math.atan2(-e,-r)*Fd+90:0;return f<0&&(f+=360),[l,f,u]},s.d2=Pt,s.d3=Br,s.d4=xe,s.d5=Nt,s.d6=Gi,s.d7=bi,s.d8=function(r){return[Math.pow(r[0],1/2.2),Math.pow(r[1],1/2.2),Math.pow(r[2],1/2.2)]},s.d9=b2,s.dA=hv,s.dB=function(r){const e=_e-5;r=ge(r,-e,e)/e*90;const n=Math.pow(Math.abs(Math.sin(pn(r))),3);return Math.round(n*(h.length-1))},s.dC=function(r,e,n,l){const u=e.getNorth(),f=e.getSouth(),p=e.getWest(),y=e.getEast(),b=1<<r.z,S=y-p,A=u-f,P=S/a,M=-A/h[n],N=[0,P,0,M,0,0,u,p,0];if(r.z>0){const L=180/l;te(N,N,[L/S+1,0,0,0,L/A+1,0,-.5*L/P,.5*L/M,1])}return N[2]=b,N[5]=r.x,N[8]=r.y,N},s.dD=Kl,s.dE=function(r,e,n){const l=J(new Float64Array(16)),u=(e/(1<<r)-.5)*Math.PI*2;return pe(l,n.globeMatrix,u),Float32Array.from(l)},s.dF=class{isDataAvailableAtPoint(r){const e=this._source();if(this.isUsingMockSource()||!e||r.y<0||r.y>1)return!1;const n=e.getSource().maxzoom,l=1<<n,u=Math.floor(r.x),f=Math.floor((r.x-u)*l),p=Math.floor(r.y*l),y=this.findDEMTileFor(new Gr(n,u,n,f,p));return!(!y||!y.dem)}getAtPointOrZero(r,e=0){return this.getAtPoint(r,e)||0}getAtPoint(r,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const l=this._source();if(!l||r.y<0||r.y>1)return e;const u=l.getSource().maxzoom,f=1<<u,p=Math.floor(r.x),y=r.x-p,b=new Gr(u,p,u,Math.floor(y*f),Math.floor(r.y*f)),S=this.findDEMTileFor(b);if(!S||!S.dem)return e;const A=S.dem,P=1<<S.tileID.canonical.z,M=(y*P-S.tileID.canonical.x)*A.dim,N=(r.y*P-S.tileID.canonical.y)*A.dim,L=Math.floor(M),U=Math.floor(N);return(n?this.exaggeration():1)*si(si(A.get(L,U),A.get(L,U+1),N-U),si(A.get(L+1,U),A.get(L+1,U+1),N-U),M-L)}getAtTileOffset(r,e,n){const l=1<<r.canonical.z;return this.getAtPointOrZero(new ve(r.wrap+(r.canonical.x+e/Et)/l,(r.canonical.y+n/Et)/l))}getAtTileOffsetFunc(r,e,n,l){return u=>{const f=this.getAtTileOffset(r,u.x,u.y),p=l.upVector(r.canonical,u.x,u.y);return jt(p,p,f*l.upVectorScale(r.canonical,e,n).metersToTile),p}}getForTilePoints(r,e,n,l){if(this.isUsingMockSource())return!1;const u=Sp.create(this,r,l);return!!u&&(e.forEach(f=>{f[2]=this.exaggeration()*u.getElevationAt(f[0],f[1],n)}),!0)}getMinMaxForTile(r){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(r);if(!e||!e.dem)return null;const n=e.dem.tree,l=e.tileID,u=1<<r.canonical.z-l.canonical.z;let f=r.canonical.x/u-l.canonical.x,p=r.canonical.y/u-l.canonical.y,y=0;for(let b=0;b<r.canonical.z-l.canonical.z&&!n.leaves[y];b++){f*=2,p*=2;const S=2*Math.floor(p)+Math.floor(f);y=n.childOffsets[y]+S,f%=1,p%=1}return{min:this.exaggeration()*n.minimums[y],max:this.exaggeration()*n.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const r=this.visibleDemTiles;if(r.length===0)return null;let e=!1,n=Number.MAX_VALUE,l=Number.MIN_VALUE;for(const u of r){const f=this.getMinMaxForTile(u.tileID);f&&(n=Math.min(n,f.min),l=Math.max(l,f.max),e=!0)}return e?{min:n,max:l}:null}},s.dG=wA,s.dH=dv,s.dI=function(r,e){return[Math.pow(r[0],2.2)*e,Math.pow(r[1],2.2)*e,Math.pow(r[2],2.2)*e]},s.dJ=W,s.dK=function(r,e){var n=Math.sin(e),l=Math.cos(e);return r[0]=l,r[1]=n,r[2]=0,r[3]=-n,r[4]=l,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},s.dL=kn,s.dM=aA,s.dN=ro,s.dO=Ns,s.dP=256,s.dQ=function(r,e){const n=[0,0,0];return Ri(n,n,pv(Kl(e.canonical))),Ri(n,n,r),n},s.dR=r=>({u_matrix:new Ch(r),u_texsize:new Oa(r),u_pixels_to_tile_units:new qg(r),u_device_pixel_ratio:new Rr(r),u_width_scale:new Rr(r),u_floor_width_scale:new Rr(r),u_image:new up(r),u_units_to_pixels:new Oa(r),u_tile_units_to_pixels:new Rr(r),u_alpha_discard_threshold:new Rr(r),u_trim_offset:new Oa(r),u_trim_fade_range:new Oa(r),u_trim_color:new Eh(r),u_emissive_strength:new Rr(r),u_zbias_factor:new Rr(r),u_tile_to_meter:new Rr(r),u_ground_shadow_factor:new zu(r),u_pattern_transition:new Rr(r)}),s.dS=r=>({u_matrix:new Ch(r),u_pixels_to_tile_units:new qg(r),u_device_pixel_ratio:new Rr(r),u_width_scale:new Rr(r),u_floor_width_scale:new Rr(r),u_units_to_pixels:new Oa(r),u_dash_image:new up(r),u_gradient_image:new up(r),u_image_height:new Rr(r),u_texsize:new Oa(r),u_tile_units_to_pixels:new Rr(r),u_alpha_discard_threshold:new Rr(r),u_trim_offset:new Oa(r),u_trim_fade_range:new Oa(r),u_trim_color:new Eh(r),u_emissive_strength:new Rr(r),u_zbias_factor:new Rr(r),u_tile_to_meter:new Rr(r),u_ground_shadow_factor:new zu(r)}),s.dT=r=>({u_camera_to_center_distance:new Rr(r),u_extrude_scale:new qg(r),u_device_pixel_ratio:new Rr(r),u_matrix:new Ch(r),u_inv_rot_matrix:new Ch(r),u_merc_center:new Oa(r),u_tile_id:new zu(r),u_zoom_transition:new Rr(r),u_up_dir:new zu(r),u_emissive_strength:new Rr(r)}),s.dU=Du,s.dV=EB,s.dW=dA,s.dX=(r,e,n,l,u,f)=>{const p=r.transform,y=p.projection.name==="globe";let b;if(f.paint.get("circle-pitch-alignment")==="map")if(y){const A=aA(p.zoom,e.canonical)*p._pixelsPerMercatorPixel;b=Float32Array.from([A,0,0,A])}else b=p.calculatePixelsToTileUnitsMatrix(n);else b=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);const S={u_camera_to_center_distance:r.transform.getCameraToCenterDistance(p.projection),u_matrix:r.translatePosMatrix(e.projMatrix,n,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_device_pixel_ratio:fa.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:Xj,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:f.paint.get("circle-emissive-strength")};if(y){S.u_inv_rot_matrix=l,S.u_merc_center=u,S.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],S.u_zoom_transition=Bu(p.zoom);const A=u[0]*Et,P=u[1]*Et;S.u_up_dir=p.projection.upVector(new Fo(0,0,0),A,P)}return S},s.dY=GI,s.dZ=oo,s.d_=(r,e,n,l,u,f,p,y,b,S)=>{const A=r.transform,P=A.pitch<15?BI(.07,.7,ge((14-A.zoom)/5,0,1)):.07,M=n.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:UI(r,e,n,l),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:A.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:u,u_width_scale:f,u_floor_width_scale:p,u_image:0,u_tile_units_to_pixels:VI(e,A),u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:y,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toPremultipliedRenderColor(M?null:n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength"),u_zbias_factor:P,u_tile_to_meter:xe(e.tileID.canonical,0),u_ground_shadow_factor:b,u_pattern_transition:S}},s.da=function(r,e){return r.readFields(v5,{icons:[]},e)},s.db=Tv,s.dc=vp,s.dd=d2,s.de=ff,s.df=Gx,s.dg=Yo,s.dh=au,s.di=Vi,s.dj=function(r){const e=r.indexOf(xh);return e>=0?r.slice(0,e):r},s.dk=function(r){return r.indexOf(xh)>=0},s.dl=function(r){const e=r.lastIndexOf(xh);return e>=0?r.slice(e+1):""},s.dm=function(r){const e=[],n=r.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},s.dn=function(r,e,n,l){return r.type==="custom"?new p5(r,e):new y5[r.type](r,e,n,l)},s.dp=Zi,s.dq=function(r){const e=r.indexOf(xh);return e>=0?r.slice(e+1):""},s.dr=class extends Ap{constructor(r,e){super(r._vectorTileFeature,r._z,r._x,r._y,r.id),r.state&&(this.state=Object.assign({},r.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=r.source,this.sourceLayer=r.sourceLayer,this.layer=r.layer)}toJSON(){const r=super.toJSON();return r.target=this.target,r.namespace=this.namespace,r}},s.ds=Sg,s.dt=su,s.du=function(r){return r({pluginStatus:Ws,pluginURL:$l}),Sg.on("pluginStateChange",r),r},s.dv=Hg,s.dw=class extends ia{constructor(r){super(r),this.current=_b}set(r,e,n){if(this.fetchUniformLocation(r,e)){for(let l=0;l<9;l++)if(n[l]!==this.current[l]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},s.dx=ie,s.dy=function(r,e,n){const l=Bu(n.zoom),u=r.style.map._antialias,f=r.terrain&&r.terrain.exaggeration()>0;return l===0&&!u&&!f},s.dz=function(r){const e=r.pixelsPerMeter,n=e/Z(1,r.center.lat),l=J(new Float64Array(16));return ee(l,l,[r.point.x,r.point.y,0]),Q(l,l,[n,n,e]),Float32Array.from(l)},s.e=gs,s.e$=Tg,s.e0=ei,s.e1=Xg,s.e2=de,s.e3=Nc,s.e4=bv,s.e5=tI,s.e6=Uu,s.e7=450,s.e8=7,s.e9=Te,s.eA=function(r,e,n,l,u,f,p,y,b,S,A,P,M,N,L,U){var H=new j(16);return H[0]=r,H[1]=e,H[2]=n,H[3]=l,H[4]=u,H[5]=f,H[6]=p,H[7]=y,H[8]=b,H[9]=S,H[10]=A,H[11]=P,H[12]=M,H[13]=N,H[14]=L,H[15]=U,H},s.eB=C,s.eC=zg,s.eD=wh,s.eE=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new ht(1/0,1/0),max:new ht(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(r,e=!1){const n=VA(new ht(0,0),new ht(Et,Et),r),l=[];if(e&&!Lb(n,this._globalClipBounds))return l;for(const u of this._activeRegions){if(u.hiddenByOverlap||!Lb(n,u))continue;const f=S4(u.min,u.max,r);l.push({min:f.min,max:f.max,sourceId:this._sourceIds[u.priority],footprint:u.footprint,footprintTileId:u.tileId,order:u.order,clipMask:u.clipMask,clipScope:u.clipScope})}return l}setSources(r){this._setSources(r.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const n=[];for(const l of e.cache.getVisibleCoordinates()){const u=e.cache.getTile(l).buckets[e.layer];u&&u.updateFootprints(l.toUnwrapped(),n)}return n},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(r){const e=r.getFootprints();if(e.length===0)return;const n=r.getOrder(),l=r.getClipMask(),u=r.getClipScope();for(const f of e){if(!f.footprint)continue;const p=VA(f.footprint.min,f.footprint.max,f.id);this._activeRegions.push({min:p.min,max:p.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:f.id,footprint:f.footprint,order:n,clipMask:l,clipScope:u})}this._sourceIds.push(r.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||xv(e.min,n.min)||xv(e.max,n.max)||e.order-n.order||e.clipMask-n.clipMask||function(l,u){const f=(p,y)=>p+y;return l.length-u.length||l.reduce(f,"").localeCompare(u.reduce(f,""))}(e.clipScope,n.clipScope));let r=this._activeRegions.length!==this._prevRegions.length;if(!r){let e=0;for(;!r&&e!==this._activeRegions.length;){const n=this._activeRegions[e],l=this._prevRegions[e];r=n.priority!==l.priority||!BA(n,l)||n.order!==l.order||n.clipMask!==l.clipMask||!Ka(n.clipScope,l.clipScope),++e}}if(r){++this._updateTime;for(const n of this._activeRegions)n.order!==t_&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,n.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,n.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,n.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,n.max.y));const e=n=>{const l=this._activeRegions;if(n>=l.length)return n;const u=l[n].priority;for(;n<l.length&&l[n].priority===u;)++n;return n};if(this._sourceIds.length>1){let n=0,l=e(n);for(;n!==l;){let u=n;const f=n;for(;u!==l;){const p=this._activeRegions[u];p.hiddenByOverlap=!1;for(let y=0;y<f;y++){const b=this._activeRegions[y];if(!b.hiddenByOverlap&&p.order===t_&&Lb(p,b)&&(p.hiddenByOverlap=UA(p.footprint,p.tileId,b.footprint,b.tileId),p.hiddenByOverlap))break}++u}n=l,l=e(n)}}}}_setSources(r){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=r.length-1;e>=0;e--)this._addSource(r[e]);this._computeReplacement()}},s.eF=t_,s.eG=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const r of this._poleSegments)r.destroy();for(const r of this._gridSegments)r.withSkirts.destroy(),r.withoutSkirts.destroy()}_fillGridMeshWithLods(r,e){const n=new co,l=new Qn,u=[],f=r+1+2,p=e[0]+1,y=e[0]+1+(1+e.length),b=(S,A,P)=>{let M=S===f-1?S-2:S===0?S:S-1;return M+=P?24575:0,[M,A]};for(let S=0;S<f;++S)n.emplaceBack(...b(S,0,!0));for(let S=0;S<p;++S)for(let A=0;A<f;++A)n.emplaceBack(...b(A,S,(A===0||A===f-1)&&!0));for(let S=0;S<e.length;++S){const A=e[S];for(let P=0;P<f;++P)n.emplaceBack(...b(P,A,!0))}for(let S=0;S<e.length;++S){const A=l.length,P=e[S]+1+2,M=new Qn;for(let U=0;U<P-1;U++){const H=U===P-2,K=H?f*(y-e.length+S-U):f;for(let se=0;se<f-1;se++){const re=U*f+se;U===0||H||se===0||se===f-2?(M.emplaceBack(re+1,re,re+K),M.emplaceBack(re+K,re+K+1,re+1)):(l.emplaceBack(re+1,re,re+K),l.emplaceBack(re+K,re+K+1,re+1))}}const N=rr.simpleSegment(0,A,n.length,l.length-A);for(let U=0;U<M.uint16.length;U+=3)l.emplaceBack(M.uint16[U],M.uint16[U+1],M.uint16[U+2]);const L=rr.simpleSegment(0,A,n.length,l.length-A);u.push({withoutSkirts:N,withSkirts:L})}return{vertices:n,indices:l,segments:u}}_createGrid(r){const e=this._fillGridMeshWithLods(a,h);this._gridSegments=e.segments,this._gridBuffer=r.createVertexBuffer(e.vertices,iA.members),this._gridIndexBuffer=r.createIndexBuffer(e.indices,!0)}_createPoles(r){const e=new Qn;for(let p=0;p<=a;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=r.createIndexBuffer(e,!0);const n=new Dc,l=new Dc,u=new Dc,f=new Dc;this._poleSegments=[];for(let p=0,y=0;p<cv;p++){const b=360/(1<<p);n.emplaceBack(0,-Fs,0,.5,0),l.emplaceBack(0,-Fs,0,.5,1),u.emplaceBack(0,-Fs,0,.5,.5),f.emplaceBack(0,-Fs,0,.5,.5);for(let S=0;S<=a;S++){let A=S/a,P=0;const M=si(0,b,A),[N,L,U]=w(Wj,Zj,M,Fs);n.emplaceBack(N,L,U,A,P),l.emplaceBack(N,L,U,A,1-P);const H=pn(M);A=.5+.5*Math.sin(H),P=.5+.5*Math.cos(H),u.emplaceBack(N,L,U,A,P),f.emplaceBack(N,L,U,A,1-P)}this._poleSegments.push(rr.simpleSegment(y,0,66,64)),y+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(n,uv,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(l,uv,!1),this._texturedPoleNorthVertexBuffer=r.createVertexBuffer(u,uv,!1),this._texturedPoleSouthVertexBuffer=r.createVertexBuffer(f,uv,!1)}getGridBuffers(r,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[r].withSkirts:this._gridSegments[r].withoutSkirts]}getPoleBuffers(r,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}},s.eH=FA,s.eI=me,s.eJ=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.eK=Ce,s.eL=ye,s.eM=function(r,e,n){return r[0]=e[0]/n[0],r[1]=e[1]/n[1],r[2]=e[2]/n[2],r},s.eN=gr,s.eO=T,s.eP=Dn,s.eQ=ti,s.eR=function([r,e,n]){const l=Math.hypot(r,e,n),u=Math.atan2(r,n),f=.5*Math.PI-Math.acos(-e/l);return new D(Be(u),Be(f))},s.eS=Ge,s.eT=Kb,s.eU=function(r){const e=r.navigator?r.navigator.userAgent:null;return!!function(n){if(yr==null){const l=n.navigator?n.navigator.userAgent:null;yr=!!n.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return yr}(r)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},s.eV=function(r,e){pa=r,Ja=e},s.eW=Cb,s.eX=cA,s.eY=function(r){const e=[0,0,0],n=J(new Float64Array(16));return oe(n,r.pixelMatrix,r.globeMatrix),Ri(e,e,n),new ht(e[0],e[1])},s.eZ=function(){const r=a_;r&&(r.isPreloaded()&&r.numActive()===1?(r.release(Ub),a_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.e_=function(){Tv().acquire(Ub)},s.ea=function(r,e){if(r===e){var n=e[1],l=e[2],u=e[3],f=e[6],p=e[7],y=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=n,r[6]=e[9],r[7]=e[13],r[8]=l,r[9]=f,r[11]=e[14],r[12]=u,r[13]=p,r[14]=y}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r},s.eb=f5,s.ec=Qi,s.ed=jg,s.ee=256,s.ef=Tb,s.eg=ko,s.eh=pe,s.ei=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r},s.ej=Dc,s.ek=Lg,s.el=kx,s.em=function(r,e,n,l,u){return ge((r-e)/(n-e)*(u-l)+l,l,u)},s.en=ri,s.eo=function(r,e){var n=e[0],l=e[1],u=e[2],f=e[3],p=e[4],y=e[5],b=e[6],S=e[7],A=e[8],P=A*p-y*S,M=-A*f+y*b,N=S*f-p*b,L=n*P+l*M+u*N;return L?(r[0]=P*(L=1/L),r[1]=(-A*l+u*S)*L,r[2]=(y*l-u*p)*L,r[3]=M*L,r[4]=(A*n-u*b)*L,r[5]=(-y*n+u*f)*L,r[6]=N*L,r[7]=(-S*n+l*b)*L,r[8]=(p*n-l*f)*L,r):null},s.ep=2,s.eq=ir,s.er=Yb,s.es=[1,1,1],s.et=class{constructor(r,e,n,l){this.context=r,this.format=l,this.size=n,this.texture=r.gl.createTexture();const[u,f,p]=this.size,{gl:y}=r;y.bindTexture(y.TEXTURE_3D,this.texture),r.pixelStoreUnpackFlipY.set(!1),r.pixelStoreUnpack.set(1),r.pixelStoreUnpackPremultiplyAlpha.set(!1),y.texImage3D(y.TEXTURE_3D,0,this.format,u,f,p,0,Wb(this.format),Zb(this.format),e.data)}bind(r,e){const{context:n}=this,{gl:l}=n;l.bindTexture(l.TEXTURE_3D,this.texture),r!==this.minFilter&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MAG_FILTER,r),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MIN_FILTER,r),this.minFilter=r),e!==this.wrapS&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_S,e),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}},s.eu=Sp,s.ev=Ma,s.ew=function(r,e,n,l){var u=e[0],f=e[1],p=e[2],y=e[3];return r[0]=u+l*(n[0]-u),r[1]=f+l*(n[1]-f),r[2]=p+l*(n[2]-p),r[3]=y+l*(n[3]-y),r},s.ex=_p,s.ey=za,s.ez=Zl,s.f=function(r){return btoa(encodeURIComponent(r).replace(/%([0-9A-F]{2})/g,(e,n)=>String.fromCharCode(+("0x"+n))))},s.f0=function(r,e,n=!1){if(Ws===xo.deferred||Ws===xo.loading||Ws===xo.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");$l=fa.resolveURL(r),Ws=xo.deferred,wg=e,bg(),n||$x()},s.f1=function(r){pp=fa.resolveURL(r),mp||(mp=new fp(Tv(),new xc)),mp.broadcast("setMeshoptUrl",pp)},s.f2=pI,s.f3=function(r){$b=fa.resolveURL(r),mp||(mp=new fp(Tv(),new xc)),mp.broadcast("setDracoUrl",$b)},s.f4=fI,s.f5=o_,s.f6=function(r){const e=mc();if(!e)return;const n=e.delete(Ya);r&&n.then(()=>r()).catch(r)},s.f7=Rh,s.f8=Bt,s.f9=Vu,s.fa=sl,s.fb=OM,s.fc=FM,s.fd=zI,s.fe=Lt,s.ff="hd_road_elevation",s.fg=sr,s.fh=Ti,s.fi=Ph,s.fj=u2,s.fk=Nh,s.fl=function(r,e,n,l,u,f,p,y=1,b,S,A){r.createArrays(),r.tilePixelRatio=Et/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const P=r.layers[0].layout,M=r.layers[0]._unevaluatedLayout._values,N={};N.scaleFactor=y,N.textSizeScaleRange=P.get("text-size-scale-range"),N.iconSizeScaleRange=P.get("icon-size-scale-range");const[L,U]=N.textSizeScaleRange,[H,K]=N.iconSizeScaleRange;N.textScaleFactor=ge(N.scaleFactor,L,U),N.iconScaleFactor=ge(N.scaleFactor,H,K);const se=M["text-size"],re=M["icon-size"];if(r.textSizeData.kind==="composite"){const{minZoom:De,maxZoom:Xe}=r.textSizeData;N.compositeTextSizes=[se.possiblyEvaluate(new Pn(De,{worldview:A}),f),se.possiblyEvaluate(new Pn(Xe,{worldview:A}),f)]}if(r.iconSizeData.kind==="composite"){const{minZoom:De,maxZoom:Xe}=r.iconSizeData;N.compositeIconSizes=[re.possiblyEvaluate(new Pn(De,{worldview:A}),f),re.possiblyEvaluate(new Pn(Xe,{worldview:A}),f)]}N.layoutTextSize=se.possiblyEvaluate(new Pn(p+1,{worldview:A}),f),N.layoutIconSize=re.possiblyEvaluate(new Pn(p+1,{worldview:A}),f),N.textMaxSize=se.possiblyEvaluate(new Pn(18,{worldview:A}),f);const le=P.get("symbol-placement"),Ee=P.get("text-rotation-alignment")==="map"&&le!=="point",we=P.get("text-size");let Se=!1;const Me=[];for(const De of r.features){const Xe=P.get("text-font").evaluate(De,{},f).join(","),Le=we.evaluate(De,{},f)*N.textScaleFactor,Je=N.layoutTextSize.evaluate(De,{},f)*N.textScaleFactor,yt=N.layoutIconSize.evaluate(De,{},f)*N.iconScaleFactor,tt={horizontal:{},vertical:void 0},ut=De.text;let gt,We=[0,0];if(ut){const Ot=ut.toString(),li=P.get("text-letter-spacing").evaluate(De,{},f)*hs,vi=P.get("text-line-height").evaluate(De,{},f)*hs,Di=ob(Ot)?li:0,Ii=P.get("text-anchor").evaluate(De,{},f),Yi=P.get("text-variable-anchor");if(!Yi){const He=P.get("text-radial-offset").evaluate(De,{},f);if(He)We=wP(Ii,[He*hs,h2]);else{const bt=P.get("text-offset").evaluate(De,{},f);We=[bt[0]*hs,bt[1]*hs]}}let Bi=Ee?"center":P.get("text-justify").evaluate(De,{},f);const qn=le==="point",he=qn?P.get("text-max-width").evaluate(De,{},f)*hs:1/0,fe=He=>{r.allowVerticalPlacement&&vg(Ot)&&(tt.vertical=a2(ut,e,n,u,Xe,he,vi,Ii,He,Di,We,Vo.vertical,!0,Je,Le,b))};if(!Ee&&Yi){const He=Bi==="auto"?Yi.map(Mt=>f2(Mt)):[Bi];let bt=!1;for(let Mt=0;Mt<He.length;Mt++){const It=He[Mt];if(!tt.horizontal[It])if(bt)tt.horizontal[It]=tt.horizontal[0];else{const Gt=a2(ut,e,n,u,Xe,he,vi,"center",It,Di,We,Vo.horizontal,!1,Je,Le,b);Gt&&(tt.horizontal[It]=Gt,bt=Gt.positionedLines.length===1)}}fe("left")}else{if(Bi==="auto"&&(Bi=f2(Ii)),qn||P.get("text-writing-mode").indexOf("horizontal")>=0||!vg(Ot)){const He=a2(ut,e,n,u,Xe,he,vi,Ii,Bi,Di,We,Vo.horizontal,!1,Je,Le,b);He&&(tt.horizontal[Bi]=He)}fe(qn?"left":Bi)}}let dt,ze,Ze,wt,ft,Zt,Ut=!1;const lt=P.get("icon-text-fit").evaluate(De,{},f);if(De.icon&&De.icon.hasPrimary()){const Ot=SP(De.icon,r.iconSizeData,M["icon-size"],f,r.zoom,De,b,N.iconScaleFactor,A);dt=Ot.iconPrimary,Ze=Ot.iconSecondary;const li=dt.toString();if(ze=l.get(li),ze&&(ft=P.get("icon-offset").evaluate(De,{},f),Zt=P.get("icon-anchor").evaluate(De,{},f),gt=GB(u.get(li),Ze?u.get(Ze.toString()):void 0,ft,Zt),Ut=ze.sdf,r.sdfIcons===void 0?r.sdfIcons=ze.sdf:r.sdfIcons!==ze.sdf&&Ki("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ze.pixelRatio!==r.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0)),Ze){const vi=Ze.toString();wt=l.get(vi)}}Se=Se||!(!De.icon||!De.icon.hasSecondary());const pt=p2(tt.horizontal)||tt.vertical;r.iconsInText||(r.iconsInText=!!pt&&pt.iconsInText);const $t=Je*N.textScaleFactor/hs,{defaultShapedIcon:zt,verticallyShapedIcon:At}=QB(r,gt,P,De,f,tt,$t,ft,lt);lt!=="none"&&gt&&(sP(gt)||oP(gt))&&(zv(0,ze,dt,gt,zt,lt,S,l,u),zv(0,wt,Ze,gt,zt,lt,S,l,u),At&&(zv(0,ze,dt,gt,At,lt,S,l,u),zv(0,wt,Ze,gt,At,lt,S,l,u))),gt=zt,Me.push({feature:De,shapedTextOrientations:tt,shapedText:pt,shapedIcon:gt,iconPrimary:dt,iconSecondary:Ze,iconOffset:ft,iconAnchor:Zt,verticallyShapedIcon:At,layoutTextSize:Je,layoutIconSize:yt,textOffset:We,isSDFIcon:Ut,iconTextFit:lt})}return{featureData:Me,sizes:N,hasAnySecondaryIcon:Se,textAlongLine:Ee,symbolPlacement:le}},s.fm=mP,s.fn=function(r,e,n,l,u,f,p,y,b,S){const{featureData:A,hasAnySecondaryIcon:P,sizes:M,textAlongLine:N,symbolPlacement:L}=e;for(const U of A){const{shapedIcon:H,verticallyShapedIcon:K,feature:se,shapedTextOrientations:re,shapedText:le,layoutTextSize:Ee,textOffset:we,isSDFIcon:Se,iconPrimary:Me,iconSecondary:De,iconTextFit:Xe,iconOffset:Le}=U;TP(H,S.iconPositions,Me,De),TP(K,S.iconPositions,Me,De),JB(re,S.iconPositions),YB(Me,De,S.iconPositions),(le||H)&&e5(r,se,re,H,K,b,M,Ee,0,we,Se,l,u,p,y,P,Xe,Le,N,L)}n&&r.generateCollisionDebugBuffers(f,r.collisionBoxArray,M.textScaleFactor)},s.fo=Ht,s.fp=i0,s.fq=je,s.fr=function(r){let e=0;if(new Uint32Array(r,0,1)[0]!==gI){const n=new Uint32Array(r,0,7),[,,l,u,f,p]=n;e=n.byteLength+u+f+p+f,(l!==r.byteLength||e>=r.byteLength)&&Ki("Invalid b3dm header information.")}return vI(r,e)},s.fs=function(r,e){const n=II(r);for(const l of n){for(const u of l.meshes)eB(u);l.lights&&(l.lightMeshIndex=l.meshes.length,l.meshes.push(tB(l.lights,e)))}return n},s.ft=Kv,s.fu=Nn,s.fv=dI,s.fw=Na,s.fx=xo,s.fy=function(r){nu(),Da!=null&&Da.then(e=>{e.keys().then(n=>{for(let l=0;l<n.length-r;l++)e.delete(n[l]).catch(u=>Ki(u.message))}).catch(n=>Ki(n.message))}).catch(e=>Ki(e.message))},s.g=function(r,e){return su(Ve(r,{method:"GET"}),e)},s.h=Ve,s.i=function(r){return gs.API_STYLE_REGEX.test(r)&&!cf(r)},s.j=function(r){return r.indexOf("mapbox:")===0},s.k=Pl,s.l=Lm,s.m=function(r){return decodeURIComponent(atob(r).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},s.n=function(r,e){return su(Ve(r,{type:"json"}),e)},s.o=Xd,s.p=function(r,e){return su(Ve(r,{method:"POST"}),e)},s.q=fa,s.r=Cs,s.s=function(r){try{const e=self[r];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=hf,s.u=function(){return function r(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)}()},s.v=function(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)},s.w=Ki,s.x=function(){return Gb||(Gb=new Rh),Gb},s.y=P2,s.z=Mo}),E(["./shared"],function(s){function O(Be){const Y=Be?Be.url.toString():void 0;return Y?performance.getEntriesByName(Y):[]}function j(Be){if(typeof Be=="number"||typeof Be=="boolean"||typeof Be=="string"||Be==null)return JSON.stringify(Be);if(Array.isArray(Be)){let ie="[";for(const me of Be)ie+=`${j(me)},`;return`${ie}]`}let Y="{";for(const ie of Object.keys(Be).sort())Y+=`${ie}:${j(Be[ie])},`;return`${Y}}`}function G(Be){let Y="";for(const ie of s.bu)Y+=`/${j(Be[ie])}`;return Y}class W{constructor(Y){this.keyCache={},this._layers={},this._layerConfigs={},Y&&this.replace(Y)}replace(Y,ie){this._layerConfigs={},this._layers={},this.update(Y,[],ie)}update(Y,ie,me){this._options=me;for(const ge of Y)this._layerConfigs[ge.id]=ge,(this._layers[ge.id]=s.dn(ge,this.scope,null,this._options)).compileFilter(me),this.keyCache[ge.id]&&delete this.keyCache[ge.id];for(const ge of ie)delete this.keyCache[ge],delete this._layerConfigs[ge],delete this._layers[ge];this.familiesBySource={};const Ce=function(ge,Re){const $e={};for(let Ve=0;Ve<ge.length;Ve++){const vt=ge[Ve];let it=Re&&Re[vt.id];it||(vt.type==="symbol"?it=vt.id:(it=G(vt),vt.type==="line"&&vt.paint&&function _i(Ti){return typeof Ti=="string"&&Ti==="line-progress"||(Array.isArray(Ti)?Ti.some(_i):!(!Ti||typeof Ti!="object")&&Object.values(Ti).some(_i))}(vt.paint["line-width"])&&(it+=`/${j(vt.paint["line-width"])}`))),Re&&(Re[vt.id]=it);let ei=$e[it];ei||(ei=$e[it]=[]),ei.push(vt)}const ke=[];for(const Ve in $e)ke.push($e[Ve]);return ke}(Object.values(this._layerConfigs),this.keyCache);for(const ge of Ce){const Re=ge.map(ei=>this._layers[ei.id]),$e=Re[0];if($e.visibility==="none")continue;const ke=$e.source||"";let Ve=this.familiesBySource[ke];Ve||(Ve=this.familiesBySource[ke]={});const vt=$e.sourceLayer||"_geojsonTileLayer";let it=Ve[vt];it||(it=Ve[vt]=[]),it.push(Re)}}}const B=1*s.fa;class te{constructor(Y){const ie={},me=[];for(const $e in Y){const ke=Y[$e],Ve=ie[$e]={};for(const vt in ke.glyphs){const it=ke.glyphs[+vt];if(!it||it.bitmap.width===0||it.bitmap.height===0)continue;const ei=it.metrics.localGlyph?B:1,_i={x:0,y:0,w:it.bitmap.width+2*ei,h:it.bitmap.height+2*ei};me.push(_i),Ve[vt]=_i}}const{w:Ce,h:ge}=s.H(me),Re=new s.f9({width:Ce||1,height:ge||1});for(const $e in Y){const ke=Y[$e];for(const Ve in ke.glyphs){const vt=ke.glyphs[+Ve];if(!vt||vt.bitmap.width===0||vt.bitmap.height===0)continue;const it=ie[$e][Ve],ei=vt.metrics.localGlyph?B:1;s.f9.copy(vt.bitmap,Re,{x:0,y:0},{x:it.x+ei,y:it.y+ei},vt.bitmap)}}this.image=Re,this.positions=ie}}s.f8(te,"GlyphAtlas");class ue{constructor(Y){this.tileID=new s.aM(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.lut=Y.lut,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.scope=Y.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.request&&Y.request.collectResourceTiming,this.promoteId=Y.promoteId,this.isSymbolTile=Y.isSymbolTile,this.tileTransform=s.aW(Y.tileID.canonical,Y.projection),this.projection=Y.projection,this.worldview=Y.worldview,this.localizableLayerIds=Y.localizableLayerIds,this.brightness=Y.brightness,this.extraShadowCaster=!!Y.extraShadowCaster,this.tessellationStep=Y.tessellationStep,this.scaleFactor=Y.scaleFactor,this.worldview=Y.worldview}parse(Y,ie,me,Ce,ge,Re){this.status="parsing",this.data=Y,this.collisionBoxArray=new s.b0;const $e=new s.fb(Object.keys(Y.layers).sort()),ke=new s.fc(this.tileID,this.promoteId);ke.bucketLayerIDs=[];const Ve={},vt=new s.fd(256,256),it={featureIndex:ke,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:vt,availableImages:me,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},ei=[],_i=ie.familiesBySource[this.source];for(const Zi in _i){const Vi=Y.layers[Zi];if(!Vi)continue;let Xi=!1,jn=!1,Ki=!1;for(const Nn of _i[Zi])Nn[0].type==="symbol"?Xi=!0:jn=!0,Nn[0].is3D()&&Nn[0].type!=="model"&&(Ki=!0);if(this.extraShadowCaster&&!Ki||this.isSymbolTile===!0&&!Xi||this.isSymbolTile===!1&&!jn)continue;Vi.version===1&&s.w(`Vector tile source "${this.source}" layer "${Zi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Sr=$e.encode(Zi),Xr=[];let Br=!1;for(let Nn=0,_n=0;Nn<Vi.length;Nn++){const yr=Vi.feature(Nn),cr=ke.getId(yr,Zi);if(this.localizableLayerIds&&this.localizableLayerIds.has(Zi)){const nr=yr.properties?yr.properties.worldview:null;if(this.worldview&&typeof nr=="string")if(nr==="all")yr.properties.$localized=!0;else{if(!nr.split(",").includes(this.worldview))continue;yr.properties.$localized=!0,yr.properties.worldview=this.worldview}}!Br&&yr.properties&&yr.properties.hasOwnProperty(s.fe)&&(Br=!0),Xr.push({feature:yr,id:cr,index:_n,sourceLayerIndex:Sr}),_n++}Br&&!it.elevationFeatures&&Y.layers.hasOwnProperty(s.ff)&&(it.elevationFeatures=s.fg.parseFrom(Y.layers[s.ff],this.canonical));for(const Nn of _i[Zi]){const _n=Nn[0];if(this.extraShadowCaster&&(!_n.is3D()||_n.type==="model")||this.isSymbolTile!==void 0&&_n.type==="symbol"!==this.isSymbolTile||_n.minzoom&&this.zoom<Math.floor(_n.minzoom)||_n.maxzoom&&this.zoom>=_n.maxzoom||_n.visibility==="none")continue;J(Nn,this.zoom,it.brightness,me,this.worldview);const yr=Ve[_n.id]=_n.createBucket({index:ke.bucketLayerIDs.length,layers:Nn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Sr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Ce,worldview:this.worldview});ke.bucketLayerIDs.push(Nn.map(nr=>s.C(nr.id,nr.scope)));let cr=yr.prepare?yr.prepare():null;cr!=null?(cr=cr.then(()=>yr.populate(Xr,it,this.tileID.canonical,this.tileTransform)),ei.push(cr)):yr.populate(Xr,it,this.tileID.canonical,this.tileTransform)}}const Ti=()=>{let Zi,Vi,Xi,jn,Ki,Sr;vt.trim();const Xr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Br=()=>{if(Zi)return this.status="done",Re(Zi);if(this.extraShadowCaster)this.status="done",Re(null,{buckets:Object.values(Ve).filter(_n=>!_n.isEmpty()),featureIndex:ke,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:it.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Vi&&Xi&&jn){const _n=new te(Vi),yr=new Map;for(const[ls,ro]of Xi.entries()){const{imagePosition:Ns}=s.fj(ls,ro,s.fk);yr.set(ls,Ns)}const cr={};for(const ls in Ve){const ro=Ve[ls];ro instanceof s.b1&&(J(ro.layers,this.zoom,it.brightness,me,this.worldview),cr[ls]=s.fl(ro,Vi,_n.positions,Xi,yr,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Ki,this.worldview))}const nr={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(ge,Xi,Ki,()=>{nr.iconsPending=!1,Nn(cr,_n,nr)}),this.rasterizeIfNeeded(ge,jn,Sr,()=>{nr.patternsPending=!1,Nn(cr,_n,nr)})}},Nn=(_n,yr,cr,nr)=>{if(cr.iconsPending||cr.patternsPending)return;const ls=new s.fm(Xi,jn,this.lut);for(const ro in Ve){const Ns=Ve[ro];if(ro in _n)s.fn(Ns,_n[ro],this.showCollisionBoxes,me,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Xi,ls);else if(Ns.hasPattern&&(Ns instanceof s.b7||Ns instanceof s.b8||Ns instanceof s.e4)){J(Ns.layers,this.zoom,it.brightness,me,this.worldview);const jd=Object.fromEntries(ls.patternPositions);Ns.addFeatures(it,this.tileID.canonical,jd,me,this.tileTransform,this.brightness)}}this.status="done",Re(null,{buckets:Object.values(Ve).filter(ro=>!ro.isEmpty()),featureIndex:ke,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:yr.image,lineAtlas:vt,imageAtlas:ls,brightness:it.brightness})};if(!this.extraShadowCaster){const _n=s.fh(it.glyphDependencies,nr=>Object.keys(nr).map(Number));Object.keys(_n).length?ge.send("getGlyphs",{uid:this.uid,stacks:_n},(nr,ls)=>{Zi||(Zi=nr,Vi=ls,Br())},void 0,!1,Xr):Vi={};const yr=Array.from(it.iconDependencies.keys()).map(nr=>s.I.parse(nr));yr.length?ge.send("getImages",{images:yr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(nr,ls)=>{Zi||(Zi=nr,Xi=new Map,Ki=this.updateImageMapAndGetImageTaskQueue(Xi,ls,it.iconDependencies),Br())},void 0,!1,Xr):(Xi=new Map,Ki=new Map);const cr=Array.from(it.patternDependencies.keys()).map(nr=>s.I.parse(nr));cr.length?ge.send("getImages",{images:cr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(nr,ls)=>{Zi||(Zi=nr,jn=new Map,Sr=this.updateImageMapAndGetImageTaskQueue(jn,ls,it.patternDependencies),Br())},void 0,!1,Xr):(jn=new Map,Sr=new Map)}if(it.elevationFeatures&&it.elevationFeatures.length>0){const _n=[];for(const cr of Object.values(Ve))if(cr instanceof s.b8){const nr=cr.getUnevaluatedPortalGraph();nr&&_n.push(nr)}const yr=s.fi.evaluate(_n);for(const cr of Object.values(Ve))if(cr instanceof s.b8){const nr=Y.layers[$e.decode(cr.sourceLayerIndex)];cr.setEvaluatedPortalGraph(yr,nr,this.tileID.canonical,it.availableImages,it.brightness)}}Br()};ei.length>0?Promise.allSettled(ei).then(Ti).catch(Re):Ti()}rasterizeIfNeeded(Y,ie,me,Ce){Array.from(ie.values()).some(ge=>ge.usvg)?this.rasterize(Y,ie,me,Ce):Ce()}updateImageMapAndGetImageTaskQueue(Y,ie,me){const Ce=new Map;for(const ge of ie.keys()){const Re=me.get(ge)||[];for(const $e of Re){const ke=$e.toString(),Ve=ie.get($e.id.toString());Ve.usvg?Ce.has(ke)||(Ce.set(ke,$e),Y.set(ke,Object.assign({},Ve))):Y.set(ke,Ve)}}return Ce}rasterize(Y,ie,me,Ce){this.rasterizeTask=Y.send("rasterizeImages",{scope:this.scope,tasks:me},(ge,Re)=>{if(!ge)for(const[$e,ke]of Re.entries()){const Ve=Object.assign(ie.get($e),{data:ke});ie.set($e,Ve)}Ce()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function J(Be,Y,ie,me,Ce){const ge=new s.aa(Y,{brightness:ie,worldview:Ce});for(const Re of Be)Re.recalculate(ge,me)}class ce extends s.E{constructor(Y,ie,me,Ce,ge,Re,$e){super(),this.actor=Y,this.layerIndex=ie,this.availableImages=me,this.availableModels=Ce,this.loadVectorData=Re||s.aJ,this.loading={},this.loaded={},this.deduped=new s.aI(Y.scheduler),this.isSpriteLoaded=ge,this.scheduler=Y.scheduler,this.brightness=$e}loadTile(Y,ie){const me=Y.uid,Ce=Y&&Y.request,ge=Ce&&Ce.collectResourceTiming,Re=this.loading[me]=new ue(Y);Re.abort=this.loadVectorData(Y,($e,ke)=>{const Ve=!this.loading[me];if(delete this.loading[me],Re.cancelRasterize(),Ve||$e||!ke)return Re.status="done",Ve||(this.loaded[me]=Re),ie($e);const vt=ke.rawData,it={};ke.expires&&(it.expires=ke.expires),ke.cacheControl&&(it.cacheControl=ke.cacheControl),Re.vectorTile=ke.vectorTile||new s.fo(new s.bq(vt));const ei=()=>{Re.parse(Re.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(_i,Ti)=>{if(_i||!Ti)return ie(_i);const Zi={};if(ge){const Vi=O(Ce);Vi.length>0&&(Zi.resourceTiming=JSON.parse(JSON.stringify(Vi)))}ie(null,s.h({rawTileData:vt.slice(0)},Ti,it,Zi))})};this.isSpriteLoaded?ei():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(ei,{type:"parseTile",isSymbolTile:Y.isSymbolTile,zoom:Y.tileZoom}):ei()}),this.loaded=this.loaded||{},this.loaded[me]=Re})}reloadTile(Y,ie){const me=this.loaded,Ce=Y.uid;if(me&&me[Ce]){const ge=me[Ce];ge.scaleFactor=Y.scaleFactor,ge.showCollisionBoxes=Y.showCollisionBoxes,ge.projection=Y.projection,ge.brightness=Y.brightness,ge.tileTransform=s.aW(Y.tileID.canonical,Y.projection),ge.extraShadowCaster=Y.extraShadowCaster,ge.lut=Y.lut,ge.worldview=Y.worldview;const Re=($e,ke)=>{const Ve=ge.reloadCallback;Ve&&(delete ge.reloadCallback,ge.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ve)),ie($e,ke)};ge.status==="parsing"?ge.reloadCallback=Re:ge.status==="done"&&(ge.vectorTile?ge.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Re):Re())}else ie(null,void 0)}abortTile(Y,ie){const me=Y.uid,Ce=this.loading[me];Ce&&(Ce.abort&&Ce.abort(),delete this.loading[me]),ie()}removeTile(Y,ie){const me=this.loaded,Ce=Y.uid;me&&me[Ce]&&delete me[Ce],ie()}}class oe{loadTile(Y,ie){const{uid:me,encoding:Ce,rawImageData:ge,padding:Re}=Y,$e=ImageBitmap&&ge instanceof ImageBitmap?this.getImageData(ge,Re):ge;ie(null,new s.fp(me,$e,Ce,Re<1))}reloadTile(Y,ie){ie(null,null)}abortTile(Y,ie){ie()}removeTile(Y,ie){ie()}getImageData(Y,ie){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Y.width,Y.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Y.width,this.offscreenCanvas.height=Y.height,this.offscreenCanvasContext.drawImage(Y,0,0,Y.width,Y.height);const me=this.offscreenCanvasContext.getImageData(-ie,-ie,Y.width+2*ie,Y.height+2*ie);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),me}}s.bp.setPbf(s.bq);class ee{constructor(Y){this._mrt=new s.bp(Y.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=Y.uid,this.tileID=Y.tileID,this.source=Y.source}parse(Y,ie){const me=this._mrt;this.status="parsing",this._entireBuffer=Y;try{me.parseHeader(Y),this._isHeaderLoaded=!0;const Ce=[];for(const ge in me.layers){const Re=me.getLayer(ge),$e=Re.getDataRange(Re.getBandList()),ke=me.createDecodingTask($e),Ve=Y.slice($e.firstByte,$e.lastByte+1),vt=s.bp.performDecoding(Ve,ke).then(it=>ke.complete(null,it)).catch(it=>ke.complete(it,null));Ce.push(vt)}Promise.allSettled(Ce).then(()=>ie(null,me)).catch(ge=>ie(ge))}catch(Ce){ie(Ce)}}}class Q{constructor(Y){this.actor=Y,this.loading={},this.loaded={}}loadTile(Y,ie){const me=Y.uid,Ce=Y.request,ge=this.loading[me]=new ee(Y),{cancel:Re}=s.br(Ce,($e,ke,Ve,vt)=>{const it=!this.loading[me];if(delete this.loading[me],it||$e||!ke)return ge.status="done",it||(this.loaded[me]=ge),ie($e);ge.parse(ke,(ei,_i)=>{if(ei||!_i)return ie(ei);ie(null,_i,Ve,vt)}),this.loaded[me]=ge});ge.abort=Re}reloadTile(Y,ie){ie(null,void 0)}abortTile(Y,ie){const me=Y.uid,Ce=this.loading[me];Ce&&(Ce.abort&&Ce.abort(),delete this.loading[me]),ie()}removeTile(Y,ie){const me=Y.uid;this.loaded[me]&&delete this.loaded[me],ie()}decodeRasterArray(Y,ie){s.bp.performDecoding(Y.buffer,Y.task).then(me=>ie(null,me)).catch(me=>ie(me))}}const Ie=s.fq.prototype.toGeoJSON;class pe{constructor(Y){this._feature=Y,this.extent=s.aj,this.type=Y.type,this.properties=Y.tags,"id"in Y&&!isNaN(Y.id)&&(this.id=parseInt(Y.id,10))}loadGeometry(){if(this._feature.type===1){const Y=[];for(const ie of this._feature.geometry)Y.push([new s.P(ie[0],ie[1])]);return Y}{const Y=[];for(const ie of this._feature.geometry){const me=[];for(const Ce of ie)me.push(new s.P(Ce[0],Ce[1]));Y.push(me)}return Y}}toGeoJSON(Y,ie,me){return Ie.call(this,Y,ie,me)}}class Ke{constructor(Y,ie){this.name=Y,this.extent=s.aj,this.length=ie.length,this._jsonFeatures=ie}feature(Y){return new pe(this._jsonFeatures[Y])}}class et{constructor(Y){this.layers={},this.extent=s.aj;for(const ie of Object.keys(Y))this.layers[ie]=new Ke(ie,Y[ie])}}const at=64/4096,Xt=128;class Ct{constructor(){this.features=new Map}clear(){this.features.clear()}load(Y=[],ie){for(const me of Y){const Ce=me.id;if(Ce==null)continue;let ge=this.features.get(Ce);ge&&this.updateCache(ge,ie),me.geometry?(ge=Dt(me),this.updateCache(ge,ie),this.features.set(Ce,ge)):this.features.delete(Ce),this.updateCache(ge,ie)}}updateCache(Y,ie){for(const{canonical:me,uid:Ce}of Object.values(ie)){const{z:ge,x:Re,y:$e}=me;mt(Y,Math.pow(2,ge),Re,$e)&&delete ie[Ce]}}getTile(Y,ie,me){const Ce=Math.pow(2,Y),ge=[];for(const Re of this.features.values())mt(Re,Ce,ie,me)&&ge.push(Nt(Re,Ce,ie,me));return{features:ge}}getFeatures(){return[...this.features.values()]}}function mt({minX:Be,minY:Y,maxX:ie,maxY:me},Ce,ge,Re){return Be<(ge+1+at)/Ce&&Y<(Re+1+at)/Ce&&ie>(ge-at)/Ce&&me>(Re-at)/Ce}function Dt(Be){const{id:Y,geometry:ie,properties:me}=Be;if(!ie)return;if(ie.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ce,coordinates:ge}=ie,Re={id:Y,type:1,geometry:[],tags:me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},$e=Re.geometry;if(Ce==="Point")Kt(ge,$e,Re);else if(Ce==="MultiPoint")for(const ke of ge)Kt(ke,$e,Re);else if(Ce==="LineString")Re.type=2,Pt(ge,$e,Re);else if(Ce==="MultiLineString")Re.type=2,ti(ge,$e,Re);else if(Ce==="Polygon")Re.type=3,ti(ge,$e,Re,!0);else{if(Ce!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Re.type=3;for(const ke of ge)ti(ke,$e,Re,!0)}return Re}function Kt([Be,Y],ie,me){const Ce=s.aD(Be);let ge=s.aH(Y);ge=ge<0?0:ge>1?1:ge,ie.push(Ce,ge),me.minX=Math.min(me.minX,Ce),me.minY=Math.min(me.minY,ge),me.maxX=Math.max(me.maxX,Ce),me.maxY=Math.max(me.maxY,ge)}function Pt(Be,Y,ie,me=!1,Ce=!1){const ge=[];for(const Re of Be)Kt(Re,ge,ie);Y.push(ge),me&&function(Re,$e){let ke=0;for(let Ve=0,vt=Re.length,it=vt-2;Ve<vt;it=Ve,Ve+=2)ke+=(Re[Ve]-Re[it])*(Re[Ve+1]+Re[it+1]);if(ke>0===$e)for(let Ve=0,vt=Re.length;Ve<vt/2;Ve+=2){const it=Re[Ve],ei=Re[Ve+1];Re[Ve]=Re[vt-2-Ve],Re[Ve+1]=Re[vt-1-Ve],Re[vt-2-Ve]=it,Re[vt-1-Ve]=ei}}(ge,Ce)}function ti(Be,Y,ie,me=!1){for(let Ce=0;Ce<Be.length;Ce++)Pt(Be[Ce],Y,ie,me,Ce===0)}function Nt(Be,Y,ie,me){const{id:Ce,type:ge,geometry:Re,tags:$e}=Be,ke=[];if(ge===1)(function(Ve,vt,it,ei,_i){for(let Ti=0;Ti<Ve.length;Ti+=2){const Zi=Math.round(s.aj*(Ve[Ti+0]*vt-it)),Vi=Math.round(s.aj*(Ve[Ti+1]*vt-ei));_i.push([Zi,Vi])}})(Re,Y,ie,me,ke);else for(const Ve of Re)bi(Ve,Y,ie,me,ke);return{id:Ce,type:ge,geometry:ke,tags:$e}}function bi(Be,Y,ie,me,Ce){const ge=-Xt,Re=s.aj+Xt;let $e;for(let ke=0;ke<Be.length-2;ke+=2){let Ve=Math.round(s.aj*(Be[ke+0]*Y-ie)),vt=Math.round(s.aj*(Be[ke+1]*Y-me)),it=Math.round(s.aj*(Be[ke+2]*Y-ie)),ei=Math.round(s.aj*(Be[ke+3]*Y-me));const _i=it-Ve,Ti=ei-vt;Ve<ge&&it<ge||(Ve<ge?(vt+=Math.round(Ti*((ge-Ve)/_i)),Ve=ge):it<ge&&(ei=vt+Math.round(Ti*((ge-Ve)/_i)),it=ge),vt<ge&&ei<ge||(vt<ge?(Ve+=Math.round(_i*((ge-vt)/Ti)),vt=ge):ei<ge&&(it=Ve+Math.round(_i*((ge-vt)/Ti)),ei=ge),Ve>=Re&&it>=Re||(Ve>=Re?(vt+=Math.round(Ti*((Re-Ve)/_i)),Ve=Re):it>=Re&&(ei=vt+Math.round(Ti*((Re-Ve)/_i)),it=Re),vt>=Re&&ei>=Re||(vt>=Re?(Ve+=Math.round(_i*((Re-vt)/Ti)),vt=Re):ei>=Re&&(it=Ve+Math.round(_i*((Re-vt)/Ti)),ei=Re),$e&&Ve===$e[$e.length-1][0]&&vt===$e[$e.length-1][1]||($e=[[Ve,vt]],Ce.push($e)),$e.push([it,ei])))))}}function ot({name:Be,features:Y},ie){ie.writeStringField(1,Be),ie.writeVarintField(5,s.aj);const me=new Map,Ce=new Map,ge={keys:me,values:Ce,feature:null};for(const Re of Y)ge.feature=Re,ie.writeMessage(2,Tt,ge);for(const Re of me.keys())ie.writeStringField(3,Re);for(const Re of Ce.keys())ie.writeMessage(4,Dn,Re)}function Tt(Be,Y){const ie=Be.feature;ie.id===void 0||isNaN(+ie.id)||Y.writeVarintField(1,+ie.id),ie.tags&&Y.writeMessage(2,ii,Be),Y.writeVarintField(3,ie.type),Y.writeMessage(4,en,ie)}function ii({keys:Be,values:Y,feature:ie},me){for(const Ce of Object.keys(ie.tags)){let ge=ie.tags[Ce];if(ge===null)continue;let Re=Be.get(Ce);Re===void 0&&(Re=Be.size,Be.set(Ce,Re)),me.writeVarint(Re);const $e=typeof ge;$e!=="string"&&$e!=="boolean"&&$e!=="number"&&(ge=JSON.stringify(ge));let ke=Y.get(ge);ke===void 0&&(ke=Y.size,Y.set(ge,ke)),me.writeVarint(ke)}}function jt(Be,Y){return(Y<<3)+(7&Be)}function gi(Be){return Be<<1^Be>>31}function en(Be,Y){const{geometry:ie,type:me}=Be;let Ce=0,ge=0;if(me===1){Y.writeVarint(jt(1,ie.length));for(const Re of ie){const $e=Re[0]-Ce,ke=Re[1]-ge;Y.writeVarint(gi($e)),Y.writeVarint(gi(ke)),Ce+=$e,ge+=ke}}else for(const Re of ie){Y.writeVarint(jt(1,1));const $e=Re.length-(me===3?1:0);for(let ke=0;ke<$e;ke++){ke===1&&Y.writeVarint(jt(2,$e-1));const Ve=Re[ke][0]-Ce,vt=Re[ke][1]-ge;Y.writeVarint(gi(Ve)),Y.writeVarint(gi(vt)),Ce+=Ve,ge+=vt}me===3&&Y.writeVarint(jt(7,1))}}function Dn(Be,Y){const ie=typeof Be;ie==="string"?Y.writeStringField(1,Be):ie==="boolean"?Y.writeBooleanField(7,Be):ie==="number"&&(Be%1!=0?Y.writeDoubleField(3,Be):Be<0?Y.writeSVarintField(6,Be):Y.writeVarintField(5,Be))}const ir={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Be=>Be},wi=Math.fround||(ni=new Float32Array(1),Be=>(ni[0]=+Be,ni[0]));var ni;const Fi=3,nn=5,Ri=6;class kn{constructor(Y){this.options=Object.assign(Object.create(ir),Y),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Y){const{log:ie,minZoom:me,maxZoom:Ce}=this.options;ie&&console.time("total time");const ge=`prepare ${Y.length} points`;ie&&console.time(ge),this.points=Y;const Re=[];for(let ke=0;ke<Y.length;ke++){const Ve=Y[ke];if(!Ve.geometry)continue;const[vt,it]=Ve.geometry.coordinates,ei=wi(wr(vt)),_i=wi(On(it));Re.push(ei,_i,1/0,ke,-1,1),this.options.reduce&&Re.push(0)}let $e=this.trees[Ce+1]=this._createTree(Re);ie&&console.timeEnd(ge);for(let ke=Ce;ke>=me;ke--){const Ve=+Date.now();$e=this.trees[ke]=this._createTree(this._cluster($e,ke)),ie&&console.log("z%d: %d clusters in %dms",ke,$e.numItems,+Date.now()-Ve)}return ie&&console.timeEnd("total time"),this}getClusters(Y,ie){let me=((Y[0]+180)%360+360)%360-180;const Ce=Math.max(-90,Math.min(90,Y[1]));let ge=Y[2]===180?180:((Y[2]+180)%360+360)%360-180;const Re=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)me=-180,ge=180;else if(me>ge){const it=this.getClusters([me,Ce,180,Re],ie),ei=this.getClusters([-180,Ce,ge,Re],ie);return it.concat(ei)}const $e=this.trees[this._limitZoom(ie)],ke=$e.range(wr(me),On(Re),wr(ge),On(Ce)),Ve=$e.data,vt=[];for(const it of ke){const ei=this.stride*it;vt.push(Ve[ei+nn]>1?Cn(Ve,ei,this.clusterProps):this.points[Ve[ei+Fi]])}return vt}getChildren(Y){const ie=this._getOriginId(Y),me=this._getOriginZoom(Y),Ce="No cluster with the specified id.",ge=this.trees[me];if(!ge)throw new Error(Ce);const Re=ge.data;if(ie*this.stride>=Re.length)throw new Error(Ce);const $e=this.options.radius/(this.options.extent*Math.pow(2,me-1)),ke=ge.within(Re[ie*this.stride],Re[ie*this.stride+1],$e),Ve=[];for(const vt of ke){const it=vt*this.stride;Re[it+4]===Y&&Ve.push(Re[it+nn]>1?Cn(Re,it,this.clusterProps):this.points[Re[it+Fi]])}if(Ve.length===0)throw new Error(Ce);return Ve}getLeaves(Y,ie,me){const Ce=[];return this._appendLeaves(Ce,Y,ie=ie||10,me=me||0,0),Ce}getTile(Y,ie,me){const Ce=this.trees[this._limitZoom(Y)],ge=Math.pow(2,Y),{extent:Re,radius:$e}=this.options,ke=$e/Re,Ve=(me-ke)/ge,vt=(me+1+ke)/ge,it={features:[]};return this._addTileFeatures(Ce.range((ie-ke)/ge,Ve,(ie+1+ke)/ge,vt),Ce.data,ie,me,ge,it),ie===0&&this._addTileFeatures(Ce.range(1-ke/ge,Ve,1,vt),Ce.data,ge,me,ge,it),ie===ge-1&&this._addTileFeatures(Ce.range(0,Ve,ke/ge,vt),Ce.data,-1,me,ge,it),it.features.length?it:null}getClusterExpansionZoom(Y){let ie=this._getOriginZoom(Y)-1;for(;ie<=this.options.maxZoom;){const me=this.getChildren(Y);if(ie++,me.length!==1)break;Y=me[0].properties.cluster_id}return ie}_appendLeaves(Y,ie,me,Ce,ge){const Re=this.getChildren(ie);for(const $e of Re){const ke=$e.properties;if(ke&&ke.cluster?ge+ke.point_count<=Ce?ge+=ke.point_count:ge=this._appendLeaves(Y,ke.cluster_id,me,Ce,ge):ge<Ce?ge++:Y.push($e),Y.length===me)break}return ge}_createTree(Y){const ie=new s.c0(Y.length/this.stride|0,this.options.nodeSize,Float32Array);for(let me=0;me<Y.length;me+=this.stride)ie.add(Y[me],Y[me+1]);return ie.finish(),ie.data=Y,ie}_addTileFeatures(Y,ie,me,Ce,ge,Re){for(const $e of Y){const ke=$e*this.stride,Ve=ie[ke+nn]>1;let vt,it,ei;if(Ve)vt=Zr(ie,ke,this.clusterProps),it=ie[ke],ei=ie[ke+1];else{const Zi=this.points[ie[ke+Fi]];vt=Zi.properties;const[Vi,Xi]=Zi.geometry.coordinates;it=wr(Vi),ei=On(Xi)}const _i={type:1,geometry:[[Math.round(this.options.extent*(it*ge-me)),Math.round(this.options.extent*(ei*ge-Ce))]],tags:vt};let Ti;Ti=Ve||this.options.generateId?ie[ke+Fi]:this.points[ie[ke+Fi]].id,Ti!==void 0&&(_i.id=Ti),Re.features.push(_i)}}_limitZoom(Y){return Math.max(this.options.minZoom,Math.min(Math.floor(+Y),this.options.maxZoom+1))}_cluster(Y,ie){const{radius:me,extent:Ce,reduce:ge,minPoints:Re}=this.options,$e=me/(Ce*Math.pow(2,ie)),ke=Y.data,Ve=[],vt=this.stride;for(let it=0;it<ke.length;it+=vt){if(ke[it+2]<=ie)continue;ke[it+2]=ie;const ei=ke[it],_i=ke[it+1],Ti=Y.within(ke[it],ke[it+1],$e),Zi=ke[it+nn];let Vi=Zi;for(const Xi of Ti){const jn=Xi*vt;ke[jn+2]>ie&&(Vi+=ke[jn+nn])}if(Vi>Zi&&Vi>=Re){let Xi,jn=ei*Zi,Ki=_i*Zi,Sr=-1;const Xr=(it/vt<<5)+(ie+1)+this.points.length;for(const Br of Ti){const Nn=Br*vt;if(ke[Nn+2]<=ie)continue;ke[Nn+2]=ie;const _n=ke[Nn+nn];jn+=ke[Nn]*_n,Ki+=ke[Nn+1]*_n,ke[Nn+4]=Xr,ge&&(Xi||(Xi=this._map(ke,it,!0),Sr=this.clusterProps.length,this.clusterProps.push(Xi)),ge(Xi,this._map(ke,Nn)))}ke[it+4]=Xr,Ve.push(jn/Vi,Ki/Vi,1/0,Xr,-1,Vi),ge&&Ve.push(Sr)}else{for(let Xi=0;Xi<vt;Xi++)Ve.push(ke[it+Xi]);if(Vi>1)for(const Xi of Ti){const jn=Xi*vt;if(!(ke[jn+2]<=ie)){ke[jn+2]=ie;for(let Ki=0;Ki<vt;Ki++)Ve.push(ke[jn+Ki])}}}}return Ve}_getOriginId(Y){return Y-this.points.length>>5}_getOriginZoom(Y){return(Y-this.points.length)%32}_map(Y,ie,me){if(Y[ie+nn]>1){const Re=this.clusterProps[Y[ie+Ri]];return me?Object.assign({},Re):Re}const Ce=this.points[Y[ie+Fi]].properties,ge=this.options.map(Ce);return me&&ge===Ce?Object.assign({},ge):ge}}function Cn(Be,Y,ie){return{type:"Feature",id:Be[Y+Fi],properties:Zr(Be,Y,ie),geometry:{type:"Point",coordinates:[(me=Be[Y],360*(me-.5)),gr(Be[Y+1])]}};var me}function Zr(Be,Y,ie){const me=Be[Y+nn],Ce=me>=1e4?`${Math.round(me/1e3)}k`:me>=1e3?Math.round(me/100)/10+"k":me,ge=Be[Y+Ri],Re=ge===-1?{}:Object.assign({},ie[ge]);return Object.assign(Re,{cluster:!0,cluster_id:Be[Y+Fi],point_count:me,point_count_abbreviated:Ce})}function wr(Be){return Be/360+.5}function On(Be){const Y=Math.sin(Be*Math.PI/180),ie=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return ie<0?0:ie>1?1:ie}function gr(Be){const Y=(180-360*Be)*Math.PI/180;return 360*Math.atan(Math.exp(Y))/Math.PI-90}function bs(Be,Y,ie,me){let Ce=me;const ge=Y+(ie-Y>>1);let Re,$e=ie-Y;const ke=Be[Y],Ve=Be[Y+1],vt=Be[ie],it=Be[ie+1];for(let ei=Y+3;ei<ie;ei+=3){const _i=Ma(Be[ei],Be[ei+1],ke,Ve,vt,it);if(_i>Ce)Re=ei,Ce=_i;else if(_i===Ce){const Ti=Math.abs(ei-ge);Ti<$e&&(Re=ei,$e=Ti)}}Ce>me&&(Re-Y>3&&bs(Be,Y,Re,me),Be[Re+2]=Ce,ie-Re>3&&bs(Be,Re,ie,me))}function Ma(Be,Y,ie,me,Ce,ge){let Re=Ce-ie,$e=ge-me;if(Re!==0||$e!==0){const ke=((Be-ie)*Re+(Y-me)*$e)/(Re*Re+$e*$e);ke>1?(ie=Ce,me=ge):ke>0&&(ie+=Re*ke,me+=$e*ke)}return Re=Be-ie,$e=Y-me,Re*Re+$e*$e}function _r(Be,Y,ie,me){const Ce={id:Be??null,type:Y,geometry:ie,tags:me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Y==="Point"||Y==="MultiPoint"||Y==="LineString")Ge(Ce,ie);else if(Y==="Polygon")Ge(Ce,ie[0]);else if(Y==="MultiLineString")for(const ge of ie)Ge(Ce,ge);else if(Y==="MultiPolygon")for(const ge of ie)Ge(Ce,ge[0]);return Ce}function Ge(Be,Y){for(let ie=0;ie<Y.length;ie+=3)Be.minX=Math.min(Be.minX,Y[ie]),Be.minY=Math.min(Be.minY,Y[ie+1]),Be.maxX=Math.max(Be.maxX,Y[ie]),Be.maxY=Math.max(Be.maxY,Y[ie+1])}function rt(Be,Y,ie,me){if(!Y.geometry)return;const Ce=Y.geometry.coordinates;if(Ce&&Ce.length===0)return;const ge=Y.geometry.type,Re=Math.pow(ie.tolerance/((1<<ie.maxZoom)*ie.extent),2);let $e=[],ke=Y.id;if(ie.promoteId?ke=Y.properties[ie.promoteId]:ie.generateId&&(ke=me||0),ge==="Point")Rt(Ce,$e);else if(ge==="MultiPoint")for(const Ve of Ce)Rt(Ve,$e);else if(ge==="LineString")fi(Ce,$e,Re,!1);else if(ge==="MultiLineString"){if(ie.lineMetrics){for(const Ve of Ce)$e=[],fi(Ve,$e,Re,!1),Be.push(_r(ke,"LineString",$e,Y.properties));return}di(Ce,$e,Re,!1)}else if(ge==="Polygon")di(Ce,$e,Re,!0);else{if(ge!=="MultiPolygon"){if(ge==="GeometryCollection"){for(const Ve of Y.geometry.geometries)rt(Be,{id:ke,geometry:Ve,properties:Y.properties},ie,me);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ve of Ce){const vt=[];di(Ve,vt,Re,!0),$e.push(vt)}}Be.push(_r(ke,ge,$e,Y.properties))}function Rt(Be,Y){Y.push(ri(Be[0]),Ci(Be[1]),0)}function fi(Be,Y,ie,me){let Ce,ge,Re=0;for(let ke=0;ke<Be.length;ke++){const Ve=ri(Be[ke][0]),vt=Ci(Be[ke][1]);Y.push(Ve,vt,0),ke>0&&(Re+=me?(Ce*vt-Ve*ge)/2:Math.sqrt(Math.pow(Ve-Ce,2)+Math.pow(vt-ge,2))),Ce=Ve,ge=vt}const $e=Y.length-3;Y[2]=1,bs(Y,0,$e,ie),Y[$e+2]=1,Y.size=Math.abs(Re),Y.start=0,Y.end=Y.size}function di(Be,Y,ie,me){for(let Ce=0;Ce<Be.length;Ce++){const ge=[];fi(Be[Ce],ge,ie,me),Y.push(ge)}}function ri(Be){return Be/360+.5}function Ci(Be){const Y=Math.sin(Be*Math.PI/180),ie=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return ie<0?0:ie>1?1:ie}function an(Be,Y,ie,me,Ce,ge,Re,$e){if(me/=Y,ge>=(ie/=Y)&&Re<me)return Be;if(Re<ie||ge>=me)return null;const ke=[];for(const Ve of Be){const vt=Ve.geometry;let it=Ve.type;const ei=Ce===0?Ve.minX:Ve.minY,_i=Ce===0?Ve.maxX:Ve.maxY;if(ei>=ie&&_i<me){ke.push(Ve);continue}if(_i<ie||ei>=me)continue;let Ti=[];if(it==="Point"||it==="MultiPoint")Jn(vt,Ti,ie,me,Ce);else if(it==="LineString")br(vt,Ti,ie,me,Ce,!1,$e.lineMetrics);else if(it==="MultiLineString")Ar(vt,Ti,ie,me,Ce,!1);else if(it==="Polygon")Ar(vt,Ti,ie,me,Ce,!0);else if(it==="MultiPolygon")for(const Zi of vt){const Vi=[];Ar(Zi,Vi,ie,me,Ce,!0),Vi.length&&Ti.push(Vi)}if(Ti.length){if($e.lineMetrics&&it==="LineString"){for(const Zi of Ti)ke.push(_r(Ve.id,it,Zi,Ve.tags));continue}it!=="LineString"&&it!=="MultiLineString"||(Ti.length===1?(it="LineString",Ti=Ti[0]):it="MultiLineString"),it!=="Point"&&it!=="MultiPoint"||(it=Ti.length===3?"Point":"MultiPoint"),ke.push(_r(Ve.id,it,Ti,Ve.tags))}}return ke.length?ke:null}function Jn(Be,Y,ie,me,Ce){for(let ge=0;ge<Be.length;ge+=3){const Re=Be[ge+Ce];Re>=ie&&Re<=me&&Ss(Y,Be[ge],Be[ge+1],Be[ge+2])}}function br(Be,Y,ie,me,Ce,ge,Re){let $e=mo(Be);const ke=Ce===0?io:no;let Ve,vt,it=Be.start;for(let Vi=0;Vi<Be.length-3;Vi+=3){const Xi=Be[Vi],jn=Be[Vi+1],Ki=Be[Vi+2],Sr=Be[Vi+3],Xr=Be[Vi+4],Br=Ce===0?Xi:jn,Nn=Ce===0?Sr:Xr;let _n=!1;Re&&(Ve=Math.sqrt(Math.pow(Xi-Sr,2)+Math.pow(jn-Xr,2))),Br<ie?Nn>ie&&(vt=ke($e,Xi,jn,Sr,Xr,ie),Re&&($e.start=it+Ve*vt)):Br>me?Nn<me&&(vt=ke($e,Xi,jn,Sr,Xr,me),Re&&($e.start=it+Ve*vt)):Ss($e,Xi,jn,Ki),Nn<ie&&Br>=ie&&(vt=ke($e,Xi,jn,Sr,Xr,ie),_n=!0),Nn>me&&Br<=me&&(vt=ke($e,Xi,jn,Sr,Xr,me),_n=!0),!ge&&_n&&(Re&&($e.end=it+Ve*vt),Y.push($e),$e=mo(Be)),Re&&(it+=Ve)}let ei=Be.length-3;const _i=Be[ei],Ti=Be[ei+1],Zi=Ce===0?_i:Ti;Zi>=ie&&Zi<=me&&Ss($e,_i,Ti,Be[ei+2]),ei=$e.length-3,ge&&ei>=3&&($e[ei]!==$e[0]||$e[ei+1]!==$e[1])&&Ss($e,$e[0],$e[1],$e[2]),$e.length&&Y.push($e)}function mo(Be){const Y=[];return Y.size=Be.size,Y.start=Be.start,Y.end=Be.end,Y}function Ar(Be,Y,ie,me,Ce,ge){for(const Re of Be)br(Re,Y,ie,me,Ce,ge,!1)}function Ss(Be,Y,ie,me){Be.push(Y,ie,me)}function io(Be,Y,ie,me,Ce,ge){const Re=(ge-Y)/(me-Y);return Ss(Be,ge,ie+(Ce-ie)*Re,1),Re}function no(Be,Y,ie,me,Ce,ge){const Re=(ge-ie)/(Ce-ie);return Ss(Be,Y+(me-Y)*Re,ge,1),Re}function go(Be,Y){const ie=[];for(let me=0;me<Be.length;me++){const Ce=Be[me],ge=Ce.type;let Re;if(ge==="Point"||ge==="MultiPoint"||ge==="LineString")Re=as(Ce.geometry,Y);else if(ge==="MultiLineString"||ge==="Polygon"){Re=[];for(const $e of Ce.geometry)Re.push(as($e,Y))}else if(ge==="MultiPolygon"){Re=[];for(const $e of Ce.geometry){const ke=[];for(const Ve of $e)ke.push(as(Ve,Y));Re.push(ke)}}ie.push(_r(Ce.id,ge,Re,Ce.tags))}return ie}function as(Be,Y){const ie=[];ie.size=Be.size,Be.start!==void 0&&(ie.start=Be.start,ie.end=Be.end);for(let me=0;me<Be.length;me+=3)ie.push(Be[me]+Y,Be[me+1],Be[me+2]);return ie}function Ra(Be,Y){if(Be.transformed)return Be;const ie=1<<Be.z,me=Be.x,Ce=Be.y;for(const ge of Be.features){const Re=ge.geometry,$e=ge.type;if(ge.geometry=[],$e===1)for(let ke=0;ke<Re.length;ke+=2)ge.geometry.push(yi(Re[ke],Re[ke+1],Y,ie,me,Ce));else for(let ke=0;ke<Re.length;ke++){const Ve=[];for(let vt=0;vt<Re[ke].length;vt+=2)Ve.push(yi(Re[ke][vt],Re[ke][vt+1],Y,ie,me,Ce));ge.geometry.push(Ve)}}return Be.transformed=!0,Be}function yi(Be,Y,ie,me,Ce,ge){return[Math.round(ie*(Be*me-Ce)),Math.round(ie*(Y*me-ge))]}function hr(Be,Y,ie,me,Ce){const ge=Y===Ce.maxZoom?0:Ce.tolerance/((1<<Y)*Ce.extent),Re={features:[],numPoints:0,numSimplified:0,numFeatures:Be.length,source:null,x:ie,y:me,z:Y,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const $e of Be)lr(Re,$e,ge,Ce);return Re}function lr(Be,Y,ie,me){const Ce=Y.geometry,ge=Y.type,Re=[];if(Be.minX=Math.min(Be.minX,Y.minX),Be.minY=Math.min(Be.minY,Y.minY),Be.maxX=Math.max(Be.maxX,Y.maxX),Be.maxY=Math.max(Be.maxY,Y.maxY),ge==="Point"||ge==="MultiPoint")for(let $e=0;$e<Ce.length;$e+=3)Re.push(Ce[$e],Ce[$e+1]),Be.numPoints++,Be.numSimplified++;else if(ge==="LineString")jr(Re,Ce,Be,ie,!1,!1);else if(ge==="MultiLineString"||ge==="Polygon")for(let $e=0;$e<Ce.length;$e++)jr(Re,Ce[$e],Be,ie,ge==="Polygon",$e===0);else if(ge==="MultiPolygon")for(let $e=0;$e<Ce.length;$e++){const ke=Ce[$e];for(let Ve=0;Ve<ke.length;Ve++)jr(Re,ke[Ve],Be,ie,!0,Ve===0)}if(Re.length){let $e=Y.tags||null;if(ge==="LineString"&&me.lineMetrics){$e={};for(const Ve in Y.tags)$e[Ve]=Y.tags[Ve];$e.mapbox_clip_start=Ce.start/Ce.size,$e.mapbox_clip_end=Ce.end/Ce.size}const ke={geometry:Re,type:ge==="Polygon"||ge==="MultiPolygon"?3:ge==="LineString"||ge==="MultiLineString"?2:1,tags:$e};Y.id!==null&&(ke.id=Y.id),Be.features.push(ke)}}function jr(Be,Y,ie,me,Ce,ge){const Re=me*me;if(me>0&&Y.size<(Ce?Re:me))return void(ie.numPoints+=Y.length/3);const $e=[];for(let ke=0;ke<Y.length;ke+=3)(me===0||Y[ke+2]>Re)&&(ie.numSimplified++,$e.push(Y[ke],Y[ke+1])),ie.numPoints++;Ce&&function(ke,Ve){let vt=0;for(let it=0,ei=ke.length,_i=ei-2;it<ei;_i=it,it+=2)vt+=(ke[it]-ke[_i])*(ke[it+1]+ke[_i+1]);if(vt>0===Ve)for(let it=0,ei=ke.length;it<ei/2;it+=2){const _i=ke[it],Ti=ke[it+1];ke[it]=ke[ei-2-it],ke[it+1]=ke[ei-1-it],ke[ei-2-it]=_i,ke[ei-1-it]=Ti}}($e,ge),Be.push($e)}const $s={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Al{constructor(Y,ie){const me=(ie=this.options=function(ge,Re){for(const $e in Re)ge[$e]=Re[$e];return ge}(Object.create($s),ie)).debug;if(me&&console.time("preprocess data"),ie.maxZoom<0||ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ie.promoteId&&ie.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ce=function(ge,Re){const $e=[];if(ge.type==="FeatureCollection")for(let ke=0;ke<ge.features.length;ke++)rt($e,ge.features[ke],Re,ke);else rt($e,ge.type==="Feature"?ge:{geometry:ge},Re);return $e}(Y,ie);this.tiles={},this.tileCoords=[],me&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ie.indexMaxZoom,ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ce=function(ge,Re){const $e=Re.buffer/Re.extent;let ke=ge;const Ve=an(ge,1,-1-$e,$e,0,-1,2,Re),vt=an(ge,1,1-$e,2+$e,0,-1,2,Re);return(Ve||vt)&&(ke=an(ge,1,-$e,1+$e,0,-1,2,Re)||[],Ve&&(ke=go(Ve,1).concat(ke)),vt&&(ke=ke.concat(go(vt,-1)))),ke}(Ce,ie),Ce.length&&this.splitTile(Ce,0,0,0),me&&(Ce.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Y,ie,me,Ce,ge,Re,$e){const ke=[Y,ie,me,Ce],Ve=this.options,vt=Ve.debug;for(;ke.length;){Ce=ke.pop(),me=ke.pop(),ie=ke.pop(),Y=ke.pop();const it=1<<ie,ei=Il(ie,me,Ce);let _i=this.tiles[ei];if(!_i&&(vt>1&&console.time("creation"),_i=this.tiles[ei]=hr(Y,ie,me,Ce,Ve),this.tileCoords.push({z:ie,x:me,y:Ce}),vt)){vt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ie,me,Ce,_i.numFeatures,_i.numPoints,_i.numSimplified),console.timeEnd("creation"));const _n=`z${ie}`;this.stats[_n]=(this.stats[_n]||0)+1,this.total++}if(_i.source=Y,ge==null){if(ie===Ve.indexMaxZoom||_i.numPoints<=Ve.indexMaxPoints)continue}else{if(ie===Ve.maxZoom||ie===ge)continue;if(ge!=null){const _n=ge-ie;if(me!==Re>>_n||Ce!==$e>>_n)continue}}if(_i.source=null,Y.length===0)continue;vt>1&&console.time("clipping");const Ti=.5*Ve.buffer/Ve.extent,Zi=.5-Ti,Vi=.5+Ti,Xi=1+Ti;let jn=null,Ki=null,Sr=null,Xr=null,Br=an(Y,it,me-Ti,me+Vi,0,_i.minX,_i.maxX,Ve),Nn=an(Y,it,me+Zi,me+Xi,0,_i.minX,_i.maxX,Ve);Y=null,Br&&(jn=an(Br,it,Ce-Ti,Ce+Vi,1,_i.minY,_i.maxY,Ve),Ki=an(Br,it,Ce+Zi,Ce+Xi,1,_i.minY,_i.maxY,Ve),Br=null),Nn&&(Sr=an(Nn,it,Ce-Ti,Ce+Vi,1,_i.minY,_i.maxY,Ve),Xr=an(Nn,it,Ce+Zi,Ce+Xi,1,_i.minY,_i.maxY,Ve),Nn=null),vt>1&&console.timeEnd("clipping"),ke.push(jn||[],ie+1,2*me,2*Ce),ke.push(Ki||[],ie+1,2*me,2*Ce+1),ke.push(Sr||[],ie+1,2*me+1,2*Ce),ke.push(Xr||[],ie+1,2*me+1,2*Ce+1)}}getTile(Y,ie,me){Y=+Y,ie=+ie,me=+me;const Ce=this.options,{extent:ge,debug:Re}=Ce;if(Y<0||Y>24)return null;const $e=1<<Y,ke=Il(Y,ie=ie+$e&$e-1,me);if(this.tiles[ke])return Ra(this.tiles[ke],ge);Re>1&&console.log("drilling down to z%d-%d-%d",Y,ie,me);let Ve,vt=Y,it=ie,ei=me;for(;!Ve&&vt>0;)vt--,it>>=1,ei>>=1,Ve=this.tiles[Il(vt,it,ei)];return Ve&&Ve.source?(Re>1&&(console.log("found parent tile z%d-%d-%d",vt,it,ei),console.time("drilling down")),this.splitTile(Ve.source,vt,it,ei,Y,ie,me),Re>1&&console.timeEnd("drilling down"),this.tiles[ke]?Ra(this.tiles[ke],ge):null):null}}function Il(Be,Y,ie){return 32*((1<<Be)*ie+Y)+Be}function ht(Be,Y){const ie=Be.tileID.canonical;if(!this._geoJSONIndex)return void Y(null,null);const me=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!me)return void Y(null,null);const Ce=Ve=>Ve.tags&&"3d_elevation_id"in Ve.tags&&"source"in Ve.tags&&Ve.tags.source==="elevation",ge=me.features.filter(Ve=>Ce(Ve));let Re={_geojsonTileLayer:me.features};ge.length>0&&(Re={_geojsonTileLayer:me.features.filter(Ve=>!Ce(Ve)),hd_road_elevation:ge});const $e=new et(Re),ke=function(Ve){const vt=new s.bq;for(const it of Object.keys(Ve))vt.writeMessage(3,ot,{name:it,features:Ve[it]});return vt.finish()}(Re).buffer;Y(null,{vectorTile:$e,rawData:ke})}class Ka extends ce{constructor(Y,ie,me,Ce,ge,Re,$e){super(Y,ie,me,Ce,ge,ht,$e),Re&&(this.loadGeoJSON=Re),this._dynamicIndex=new Ct}loadData(Y,ie){const me=Y&&Y.request,Ce=me&&me.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(Y,(ge,Re)=>{if(ge||!Re)return ie(ge);if(typeof Re!="object")return ie(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));{try{if(Y.filter){const ke=s.X(Y.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ke.result==="error")throw new Error(ke.value.map(Ve=>`${Ve.key}: ${Ve.message}`).join(", "));Re.features=Re.features.filter(Ve=>ke.value.evaluate({zoom:0},Ve))}Y.dynamic?(Re.type==="Feature"&&(Re={type:"FeatureCollection",features:[Re]}),Y.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Re.features,this.loaded),Y.cluster&&(Re.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Y.cluster?new kn(function({superclusterOptions:ke,clusterProperties:Ve}){if(!Ve||!ke)return ke;const vt={},it={},ei={accumulated:null,zoom:0},_i={properties:null},Ti=Object.keys(Ve);for(const Zi of Ti){const[Vi,Xi]=Ve[Zi],jn=s.X(Xi),Ki=s.X(typeof Vi=="string"?[Vi,["accumulated"],["get",Zi]]:Vi);vt[Zi]=jn.value,it[Zi]=Ki.value}return ke.map=Zi=>{_i.properties=Zi;const Vi={};for(const Xi of Ti)Vi[Xi]=vt[Xi].evaluate(ei,_i);return Vi},ke.reduce=(Zi,Vi)=>{_i.properties=Vi;for(const Xi of Ti)ei.accumulated=Zi[Xi],Zi[Xi]=it[Xi].evaluate(ei,_i)},ke}(Y)).load(Re.features):Y.dynamic?this._dynamicIndex:function(ke,Ve){return new Al(ke,Ve)}(Re,Y.geojsonVtOptions)}catch(ke){return ie(ke)}const $e={};if(Ce){const ke=O(me);ke&&($e.resourceTiming={},$e.resourceTiming[Y.source]=JSON.parse(JSON.stringify(ke)))}ie(null,$e)}})}reloadTile(Y,ie){const me=this.loaded;return me&&me[Y.uid]?Y.partial?ie(null,void 0):super.reloadTile(Y,ie):this.loadTile(Y,ie)}loadGeoJSON(Y,ie){if(Y.request)s.n(Y.request,ie);else{if(typeof Y.data!="string")return ie(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return ie(null,JSON.parse(Y.data))}catch{return ie(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(Y,ie){try{ie(null,this._geoJSONIndex.getClusterExpansionZoom(Y.clusterId))}catch(me){ie(me)}}getClusterChildren(Y,ie){try{ie(null,this._geoJSONIndex.getChildren(Y.clusterId))}catch(me){ie(me)}}getClusterLeaves(Y,ie){try{ie(null,this._geoJSONIndex.getLeaves(Y.clusterId,Y.limit,Y.offset))}catch(me){ie(me)}}}class km{constructor(Y,ie,me){this.tileID=new s.aM(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Y.projection,this.brightness=ie,this.worldview=me}parse(Y,ie,me,Ce){this.status="parsing";const ge=new s.aM(me.tileID.overscaledZ,me.tileID.wrap,me.tileID.canonical.z,me.tileID.canonical.x,me.tileID.canonical.y),Re=[],$e=ie.familiesBySource[me.source],ke=new s.fc(ge,me.promoteId);ke.bucketLayerIDs=[],ke.is3DTile=!0,s.fr(Y).then(Ve=>{if(!Ve)return Ce(new Error("Could not parse tile"));const vt=Ve.json.extensionsUsed&&Ve.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ve.json.asset.extras&&Ve.json.asset.extras.MAPBOX_mesh_features,it=Ve.json.extensionsUsed&&Ve.json.extensionsUsed.includes("EXT_meshopt_compression"),ei=new s.aa(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const _i in $e)for(const Ti of $e[_i]){const Zi=Ti[0];ke.bucketLayerIDs.push(Ti.map(jn=>s.C(jn.id,jn.scope))),Zi.recalculate(ei,[]);const Vi=s.fs(Ve,1/s.d4(me.tileID.canonical)),Xi=new s.ft(Ti,Vi,ge,vt,it,this.brightness,ke,this.worldview);vt||(Xi.needsUpload=!0),Re.push(Xi),Xi.evaluate(Zi)}this.status="done",Ce(null,{buckets:Re,featureIndex:ke,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Ve=>Ce(new Error(Ve.message)))}}class Fd{constructor(Y,ie,me,Ce,ge,Re,$e,ke){this.actor=Y,this.layerIndex=ie,this.availableImages=me,this.availableModels=Ce,this.brightness=$e,this.loading={},this.loaded={},this.worldview=ke}loadTile(Y,ie){const me=Y.uid,Ce=this.loading[me]=new km(Y,this.brightness,this.worldview);s.br(Y.request,(ge,Re)=>{const $e=!this.loading[me];return delete this.loading[me],$e||ge?(Ce.status="done",$e||(this.loaded[me]=Ce),ie(ge)):Re&&Re.byteLength!==0?void Ce.parse(Re,this.layerIndex,Y,(ke,Ve)=>{Ce.status="done",this.loaded=this.loaded||{},this.loaded[me]=Ce,ke||!Ve?ie(ke):ie(null,Ve)}):(Ce.status="done",this.loaded[me]=Ce,ie())})}reloadTile(Y,ie){const me=this.loaded,Ce=Y.uid;if(me&&me[Ce]){const ge=me[Ce];ge.projection=Y.projection,ge.brightness=Y.brightness;const Re=($e,ke)=>{ge.reloadCallback&&(delete ge.reloadCallback,this.loadTile(Y,ie)),ie($e,ke)};ge.status==="parsing"?ge.reloadCallback=Re:ge.status==="done"&&this.loadTile(Y,ie)}}abortTile(Y,ie){const me=Y.uid;this.loading[me]&&delete this.loading[me],ie()}removeTile(Y,ie){const me=this.loaded,Ce=Y.uid;me&&me[Ce]&&delete me[Ce],ie()}}class pn{constructor(Y){this.self=Y,this.actor=new s.fv(Y,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new s.y,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=s.cj({name:"mercator"}),this.workerSourceTypes={vector:ce,geojson:Ka,"raster-dem":oe,"raster-array":Q,"batched-model":Fd},this.workerSources={},this.self.registerWorkerSource=(ie,me)=>{if(this.workerSourceTypes[ie])throw new Error(`Worker source with name "${ie}" already registered.`);this.workerSourceTypes[ie]=me},this.self.registerRTLTextPlugin=ie=>{if(s.fw.isParsed())throw new Error("RTL text plugin already registered.");s.fw.setState({pluginStatus:s.fx.parsed,pluginURL:s.fw.getPluginURL()}),s.fw.applyArabicShaping=ie.applyArabicShaping,s.fw.processBidirectionalText=ie.processBidirectionalText,s.fw.processStyledBidirectionalText=ie.processStyledBidirectionalText;for(const me of this.rtlPluginParsingListeners)me(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(Y,ie,me){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.availableModels[Y],delete this.workerSources[Y],me()}checkIfReady(Y,ie,me){me()}setReferrer(Y,ie){this.referrer=ie}spriteLoaded(Y,ie){this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={});const{scope:me,isLoaded:Ce}=ie;if(this.isSpriteLoaded[Y][me]=Ce,this.workerSources[Y]&&this.workerSources[Y][me])for(const ge in this.workerSources[Y][me]){const Re=this.workerSources[Y][me][ge];for(const $e in Re){const ke=Re[$e];ke instanceof ce&&(ke.isSpriteLoaded=Ce,ke.fire(new s.A("isSpriteLoaded")))}}}setImages(Y,ie,me){this.availableImages[Y]||(this.availableImages[Y]={});const{scope:Ce,images:ge}=ie;if(this.availableImages[Y][Ce]=ge,this.workerSources[Y]&&this.workerSources[Y][Ce]){for(const Re in this.workerSources[Y][Ce]){const $e=this.workerSources[Y][Ce][Re];for(const ke in $e)$e[ke].availableImages=ge}me()}else me()}setModels(Y,{scope:ie,models:me},Ce){if(this.availableModels[Y]||(this.availableModels[Y]={}),this.availableModels[Y][ie]=me,this.workerSources[Y]&&this.workerSources[Y][ie]){for(const ge in this.workerSources[Y][ie]){const Re=this.workerSources[Y][ie][ge];for(const $e in Re)Re[$e].availableModels=me}Ce()}else Ce()}setProjection(Y,ie){this.projections[Y]=s.cj(ie)}setBrightness(Y,ie,me){this.brightness=ie,me()}setWorldview(Y,ie,me){this.worldview=ie,me()}setLayers(Y,ie,me){this.getLayerIndex(Y,ie.scope).replace(ie.layers,ie.options),me()}updateLayers(Y,ie,me){this.getLayerIndex(Y,ie.scope).update(ie.layers,ie.removedIds,ie.options),me()}loadTile(Y,ie,me){ie.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,ie.type,ie.source,ie.scope).loadTile(ie,me)}decodeRasterArray(Y,ie,me){this.getWorkerSource(Y,ie.type,ie.source,ie.scope).decodeRasterArray(ie,me)}reloadTile(Y,ie,me){ie.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,ie.type,ie.source,ie.scope).reloadTile(ie,me)}abortTile(Y,ie,me){this.getWorkerSource(Y,ie.type,ie.source,ie.scope).abortTile(ie,me)}removeTile(Y,ie,me){this.getWorkerSource(Y,ie.type,ie.source,ie.scope).removeTile(ie,me)}removeSource(Y,ie,me){if(!(this.workerSources[Y]&&this.workerSources[Y][ie.scope]&&this.workerSources[Y][ie.scope][ie.type]&&this.workerSources[Y][ie.scope][ie.type][ie.source]))return;const Ce=this.workerSources[Y][ie.scope][ie.type][ie.source];delete this.workerSources[Y][ie.scope][ie.type][ie.source],Ce.removeSource!==void 0?Ce.removeSource(ie,me):me()}loadWorkerSource(Y,ie,me){try{this.self.importScripts(ie.url),me()}catch(Ce){me(Ce.toString())}}syncRTLPluginState(Y,ie,me){if(s.fw.isParsed())me(null,!0);else if(s.fw.isParsing())this.rtlPluginParsingListeners.push(me);else try{s.fw.setState(ie);const Ce=s.fw.getPluginURL();!s.fw.isLoaded()||s.fw.isParsed()||s.fw.isParsing()||Ce==null||(s.fw.setState({pluginStatus:s.fx.parsing,pluginURL:s.fw.getPluginURL()}),this.self.importScripts(Ce),s.fw.isParsed()?me(null,!0):this.rtlPluginParsingListeners.push(me))}catch(Ce){me(Ce.toString())}}setDracoUrl(Y,ie){this.dracoUrl=ie}getAvailableImages(Y,ie){this.availableImages[Y]||(this.availableImages[Y]={});let me=this.availableImages[Y][ie];return me||(me=[]),me}getAvailableModels(Y,ie){this.availableModels[Y]||(this.availableModels[Y]={});let me=this.availableModels[Y][ie];return me||(me={}),me}getLayerIndex(Y,ie){this.layerIndexes[Y]||(this.layerIndexes[Y]={});let me=this.layerIndexes[Y][ie];return me||(me=this.layerIndexes[Y][ie]=new W,me.scope=ie),me}getWorkerSource(Y,ie,me,Ce){const ge=this.workerSources;return ge[Y]||(ge[Y]={}),ge[Y][Ce]||(ge[Y][Ce]={}),ge[Y][Ce][ie]||(ge[Y][Ce][ie]={}),this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={}),ge[Y][Ce][ie][me]||(ge[Y][Ce][ie][me]=new this.workerSourceTypes[ie]({send:(Re,$e,ke,Ve,vt,it)=>this.actor.send(Re,$e,ke,Y,vt,it),scheduler:this.actor.scheduler},this.getLayerIndex(Y,Ce),this.getAvailableImages(Y,Ce),this.getAvailableModels(Y,Ce),this.isSpriteLoaded[Y][Ce],void 0,this.brightness,this.worldview)),ge[Y][Ce][ie][me]}rasterizeImagesWorker(Y,ie,me){const Ce=new Map;for(const[ge,{image:Re,imageVariant:$e}]of ie.tasks.entries()){const ke=this.imageRasterizer.rasterize($e,Re,ie.scope,Y);Ce.set(ge,ke)}me(void 0,Ce)}removeRasterizedImages(Y,ie,me){this.imageRasterizer.removeImagesFromCacheByIds(ie.imageIds,ie.scope,Y),me()}enforceCacheSizeLimit(Y,ie){s.fy(ie)}getWorkerPerformanceMetrics(Y,ie,me){me(void 0,void 0)}}return s.fu(self)&&(self.worker=new pn(self)),pn}),E(["./shared"],function(s){var O="3.14.0";const j={create:"create",load:"load",fullLoad:"fullLoad"},G={mark(d){performance.mark(d)},measure(d,t,a){performance.measure(d,t,a)}};function W(d){const t=d.name.split("?")[0];return s.a(t)&&t.includes("mapbox-gl.js")?"javascript":s.a(t)&&t.includes("mapbox-gl.css")?"css":s.b(t)?"fontRange":s.c(t)?"sprite":s.i(t)?"style":s.d(t)?"tilejson":"other"}var B,te={},ue=function(){if(B)return te;function d(h){return!t(h)}function t(h){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,w,T=new Blob([""],{type:"text/javascript"}),C=URL.createObjectURL(T);try{w=new Worker(C),_=!0}catch{_=!1}return w&&w.terminate(),URL.revokeObjectURL(C),_}()?function(){var _=document.createElement("canvas");_.width=_.height=1;var w=_.getContext("2d");if(!w)return!1;var T=w.getImageData(0,0,1,1);return T&&T.width===_.width}()?(a[g=h&&h.failIfMajorPerformanceCaveat]===void 0&&(a[g]=function(_){var w,T=function(C){var R=document.createElement("canvas"),D=Object.create(d.webGLContextAttributes);return D.failIfMajorPerformanceCaveat=C,R.getContext("webgl2",D)}(_);if(!T)return!1;try{w=T.createShader(T.VERTEX_SHADER)}catch{return!1}return!(!w||T.isContextLost())&&(T.shaderSource(w,"void main() {}"),T.compileShader(w),T.getShaderParameter(w,T.COMPILE_STATUS)===!0)}(g)),a[g]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var g}B=1,te.supported=d,te.notSupportedReason=t;var a={};return d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},te}();function J(d,t,a){const h=document.createElement(d);return t!=null&&(h.className=t),a&&a.appendChild(h),h}function ce(d,t,a){const h=document.createElementNS("http://www.w3.org/2000/svg",d);for(const g of Object.keys(t))h.setAttributeNS(null,g,String(t[g]));return a&&a.appendChild(h),h}const oe=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ee=oe&&oe.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Q;function Ie(){oe&&ee&&(Q=oe[ee],oe[ee]="none")}function pe(){oe&&ee&&(oe[ee]=Q)}function Ke(d){d.preventDefault(),d.stopPropagation(),window.removeEventListener("click",Ke,!0)}function et(){window.addEventListener("click",Ke,!0),window.setTimeout(()=>{window.removeEventListener("click",Ke,!0)},0)}function at(d,t){const a=d.getBoundingClientRect();return mt(d,a,t)}function Xt(d,t){const a=d.getBoundingClientRect(),h=[];for(let g=0;g<t.length;g++)h.push(mt(d,a,t[g]));return h}function Ct(d){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&d.button===2&&d.ctrlKey?0:d.button}function mt(d,t,a){const h=d.offsetWidth===t.width?1:d.offsetWidth/t.width;return new s.P((a.clientX-t.left)*h,(a.clientY-t.top)*h)}const Dt="01",Kt="NO_ACCESS_TOKEN";class Pt{constructor(t,a,h){this._transformRequestFn=t,this._customAccessToken=a,this._silenceAuthErrors=!!h,this._createSkuToken()}_createSkuToken(){const t=function(){let a="";for(let h=0;h<10;h++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Dt,a].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}normalizeStyleURL(t,a){if(!s.j(t))return t;const h=Nt(t);return h.params.push(`sdk=js-${O}`),h.path=`/styles/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||a)}normalizeGlyphsURL(t,a){if(!s.j(t))return t;const h=Nt(t);return h.path=`/fonts/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||a)}normalizeModelURL(t,a){if(!s.j(t))return t;const h=Nt(t);return h.path=`/models/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||a)}normalizeSourceURL(t,a,h,g){if(!s.j(t))return t;const _=Nt(t);return _.path=`/v4/${_.authority}.json`,_.params.push("secure"),h&&_.params.push(`language=${h}`),g&&_.params.push(`worldview=${g}`),this._makeAPIURL(_,this._customAccessToken||a)}normalizeIconsetURL(t,a){const h=Nt(t);return s.j(t)?(h.path=`/styles/v1${h.path}/iconset.pbf`,this._makeAPIURL(h,this._customAccessToken||a)):bi(h)}normalizeSpriteURL(t,a,h,g){const _=Nt(t);return s.j(t)?(_.path=`/styles/v1${_.path}/sprite${a}${h}`,this._makeAPIURL(_,this._customAccessToken||g)):(_.path+=`${a}${h}`,bi(_))}normalizeTileURL(t,a,h){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!s.j(t))return t;const g=Nt(t);g.path=g.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${a||h&&g.authority!=="raster"&&h===512?"@2x":""}${s.l.supported?".webp":"$1"}`),g.authority==="raster"?g.path=`/${s.e.RASTER_URL_PREFIX}${g.path}`:g.authority==="rasterarrays"?g.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${g.path}`:g.authority==="3dtiles"?g.path=`/${s.e.TILES3D_URL_PREFIX}${g.path}`:(g.path=g.path.replace(/^.+\/v4\//,"/"),g.path=`/${s.e.TILE_URL_VERSION}${g.path}`);const _=this._customAccessToken||function(w){for(const T of w){const C=T.match(/^access_token=(.*)$/);if(C)return C[1]}return null}(g.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&_&&this._skuToken&&g.params.push(`sku=${this._skuToken}`),this._makeAPIURL(g,_)}canonicalizeTileURL(t,a){const h=Nt(t);if(!h.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!h.path.match(/\.[\w]+$/))return t;let g="mapbox://";h.path.match(/^\/raster\/v1\//)?g+=`raster/${h.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:h.path.match(/^\/rasterarrays\/v1\//)?g+=`rasterarrays/${h.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:g+=`tiles/${h.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let _=h.params;return a&&(_=_.filter(w=>!w.match(/^access_token=/))),_.length&&(g+=`?${_.join("&")}`),g}canonicalizeTileset(t,a){const h=!!a&&s.j(a),g=[];for(const _ of t.tiles||[])s.k(_)?g.push(this.canonicalizeTileURL(_,h)):g.push(_);return g}_makeAPIURL(t,a){const h="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",g=Nt(s.e.API_URL);if(t.protocol=g.protocol,t.authority=g.authority,t.protocol==="http"){const _=t.params.indexOf("secure");_>=0&&t.params.splice(_,1)}if(g.path!=="/"&&(t.path=`${g.path}${t.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return bi(t);if(a=a||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!a)throw new Error(`An API access token is required to use Mapbox GL. ${h}`);if(a[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${h}`)}return t.params=t.params.filter(_=>_.indexOf("access_token")===-1),t.params.push(`access_token=${a||""}`),bi(t)}}const ti=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Nt(d){const t=d.match(ti);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function bi(d){const t=d.params.length?`?${d.params.join("&")}`:"";return`${d.protocol}://${d.authority}${d.path}${t}`}const ot="mapbox.eventData";function Tt(d){if(!d)return null;const t=d.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(s.m(t[1]))}catch{return null}}class ii{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const a=Tt(s.e.ACCESS_TOKEN);let h="";return h=a&&a.u?s.f(a.u):s.e.ACCESS_TOKEN||"",t?`${ot}.${t}:${h}`:`${ot}:${h}`}fetchEventData(){const t=s.s("localStorage"),a=this.getStorageKey(),h=this.getStorageKey("uuid");if(t)try{const g=localStorage.getItem(a);g&&(this.eventData=JSON.parse(g));const _=localStorage.getItem(h);_&&(this.anonId=_)}catch{s.w("Unable to read from LocalStorage")}}saveEventData(){const t=s.s("localStorage"),a=this.getStorageKey(),h=this.getStorageKey("uuid"),g=this.anonId;if(t&&g)try{localStorage.setItem(h,g),Object.keys(this.eventData).length>=1&&localStorage.setItem(a,JSON.stringify(this.eventData))}catch{s.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,a,h,g){if(!s.e.EVENTS_URL)return;const _=Nt(s.e.EVENTS_URL);_.params.push(`access_token=${g||s.e.ACCESS_TOKEN||""}`);const w={event:this.type,created:new Date(t).toISOString()},T=a?s.h(w,a):w,C={url:bi(_),headers:{"Content-Type":"text/plain"},body:JSON.stringify([T])};this.pendingRequest=s.p(C,R=>{this.pendingRequest=null,h(R),this.saveEventData(),this.processRequests(g)})}queueRequest(t,a){this.queue.push(t),this.processRequests(a)}}const jt=new class extends ii{constructor(d){super("appUserTurnstile"),this._customAccessToken=d}postTurnstileEvent(d,t){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(d)&&d.some(a=>s.j(a)||s.k(a))&&this.queueRequest(Date.now(),t)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Tt(s.e.ACCESS_TOKEN),a=t?t.u:s.e.ACCESS_TOKEN;let h=a!==this.eventData.tokenU;s.v(this.anonId)||(this.anonId=s.u(),h=!0);const g=this.queue.shift();if(this.eventData.lastSuccess){const _=new Date(this.eventData.lastSuccess),w=new Date(g),T=(g-this.eventData.lastSuccess)/864e5;h=h||T>=1||T<-1||_.getDate()!==w.getDate()}else h=!0;h?this.postEvent(g,{sdkIdentifier:"mapbox-gl-js",sdkVersion:O,skuId:Dt,"enabled.telemetry":!1,userId:this.anonId},_=>{_||(this.eventData.lastSuccess=g,this.eventData.tokenU=a)},d):this.processRequests()}},gi=jt.postTurnstileEvent.bind(jt),en=new class extends ii{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(d,t,a,h){this.skuToken=t,this.errorCb=h,s.e.EVENTS_URL&&(a||s.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},a):this.errorCb(new Error(Kt)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:a}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),s.v(this.anonId)||(this.anonId=s.u()),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:O,skuId:Dt,skuToken:this.skuToken,userId:this.anonId},h=>{h?this.errorCb(h):t&&(this.success[t]=!0)},d))}remove(){this.errorCb=null}},Dn=en.postMapLoadEvent.bind(en),ir=new class extends ii{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(d){let t=this.mapInstanceIdMap.get(d);return t||(t=s.u(),this.mapInstanceIdMap.set(d,t)),t}getEventId(d){const t=this.eventIdPerMapInstanceMap.get(d)||0;return this.eventIdPerMapInstanceMap.set(d,t+1),t}postStyleLoadEvent(d,t){const{map:a,style:h,importedStyles:g}=t;if(!s.e.EVENTS_URL||!d&&!s.e.ACCESS_TOKEN)return;const _=this.getMapInstanceId(a),w={mapInstanceId:_,eventId:this.getEventId(_),style:h};g.length&&(w.importedStyles=g),this.queueRequest({timestamp:Date.now(),payload:w},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:a}=this.queue.shift();this.postEvent(t,a,()=>{},d)}},wi=ir.postStyleLoadEvent.bind(ir),ni=new class extends ii{constructor(){super("gljs.performance")}postPerformanceEvent(d,t){s.e.EVENTS_URL&&(d||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:a}=this.queue.shift(),h=function(g){const _=performance.getEntriesByType("resource"),w=performance.getEntriesByType("mark"),T=function(F){const q={};if(F){for(const $ in F)if($!=="other")for(const X of F[$]){const Z=`${$}ResolveRangeMin`,ne=`${$}ResolveRangeMax`,ae=`${$}RequestCount`,de=`${$}RequestCachedCount`;q[Z]=Math.min(q[Z]||1/0,X.startTime),q[ne]=Math.max(q[ne]||-1/0,X.responseEnd);const _e=be=>{q[be]===void 0&&(q[be]=0),++q[be]};X.transferSize!==void 0&&X.transferSize===0&&_e(de),_e(ae)}}return q}(function(F,q){const $={};if(F)for(const X of F){const Z=q(X);$[Z]===void 0&&($[Z]=[]),$[Z].push(X)}return $}(_,W)),C=window.devicePixelRatio,R=navigator.connection||navigator.mozConnection||navigator.webkitConnection,D=R?R.effectiveType:void 0,z={counters:[],metadata:[],attributes:[]},k=(F,q,$)=>{$!=null&&F.push({name:q,value:$.toString()})};for(const F in T)k(z.counters,F,T[F]);if(g.interactionRange[0]!==1/0&&g.interactionRange[1]!==-1/0&&(k(z.counters,"interactionRangeMin",g.interactionRange[0]),k(z.counters,"interactionRangeMax",g.interactionRange[1])),w)for(const F of Object.keys(j)){const q=j[F],$=w.find(X=>X.name===q);$&&k(z.counters,q,$.startTime)}return k(z.counters,"visibilityHidden",g.visibilityHidden),k(z.attributes,"style",function(F){if(F)for(const q of F){const $=q.name.split("?")[0];if(s.i($)){const X=$.split("/").slice(-2);if(X.length===2)return`mapbox://styles/${X[0]}/${X[1]}`}}}(_)),k(z.attributes,"terrainEnabled",g.terrainEnabled?"true":"false"),k(z.attributes,"fogEnabled",g.fogEnabled?"true":"false"),k(z.attributes,"projection",g.projection),k(z.attributes,"zoom",g.zoom),k(z.metadata,"devicePixelRatio",C),k(z.metadata,"connectionEffectiveType",D),k(z.metadata,"navigatorUserAgent",navigator.userAgent),k(z.metadata,"screenWidth",window.screen.width),k(z.metadata,"screenHeight",window.screen.height),k(z.metadata,"windowWidth",window.innerWidth),k(z.metadata,"windowHeight",window.innerHeight),k(z.metadata,"mapWidth",g.width/C),k(z.metadata,"mapHeight",g.height/C),k(z.metadata,"webglRenderer",g.renderer),k(z.metadata,"webglVendor",g.vendor),k(z.metadata,"sdkVersion",O),k(z.metadata,"sdkIdentifier","mapbox-gl-js"),z}(a);for(const g of h.metadata);for(const g of h.counters);for(const g of h.attributes);this.postEvent(t,h,()=>{},d)}},Fi=ni.postPerformanceEvent.bind(ni),nn=new class extends ii{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(d,t,a,h){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const g=Nt(s.e.API_URL+s.e.SESSION_PATH);g.params.push(`sku=${t||""}`),g.params.push(`access_token=${h||s.e.ACCESS_TOKEN||""}`);const _={url:bi(g),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(_,w=>{this.pendingRequest=null,a(w),this.saveEventData(),this.processRequests(h)})}getSessionAPI(d,t,a,h){this.skuToken=t,this.errorCb=h,s.e.SESSION_PATH&&s.e.API_URL&&(a||s.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},a):this.errorCb(new Error(Kt)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:a}=this.queue.shift();t&&this.success[t]||this.getSession(a,this.skuToken,h=>{h?this.errorCb(h):t&&(this.success[t]=!0)},d)}remove(){this.errorCb=null}},Ri=nn.getSessionAPI.bind(nn),kn=new Set;function Cn(d,t){t?kn.add(d):kn.delete(d)}class Zr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,a){this._updatedSourceCaches[t]=a,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const a=t.scope;this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._updatedLayers[a].add(t.id),this.setDirty()}removeLayer(t){const a=t.scope;this._removedLayers[a]=this._removedLayers[a]||{},this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._removedLayers[a][t.id]=t,this._updatedLayers[a].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const a in this._updatedLayers)t[a]=t[a]||{},t[a].updatedIds=Array.from(this._updatedLayers[a].values());for(const a in this._removedLayers)t[a]=t[a]||{},t[a].removedIds=Object.keys(this._removedLayers[a]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,a){this._updatedImages[a]=this._updatedImages[a]||new Set,this._updatedImages[a].add(s.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function wr(d){const{userImage:t}=d;return!!(t&&t.render&&t.render())&&(d.data.replace(new Uint8Array(t.data.buffer)),!0)}class On extends s.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&s.t()&&(this.imageRasterizerDispatcher=new s.D(s.x(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new s.r({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const a=this.atlasTexture.get(t);a&&(a.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,a){this.imageProviders.has(a)||this.imageProviders.set(a,new Map),this.imageProviders.get(a).set(t.id,t)}removeImageProvider(t,a){this.imageProviders.has(a)&&this.imageProviders.get(a).delete(t)}getPendingImageProviders(){const t=[];for(const a of this.imageProviders.values())for(const h of a.values())h.hasPendingRequests()&&t.push(h);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new s.y),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,a){if(this.loaded.get(a)!==t&&(this.loaded.set(a,t),t)){for(const{ids:h,callback:g}of this.requestors)this._notify(h,a,g);this.requestors=[]}}hasImage(t,a){return!!this.getImage(t,a)}getImage(t,a){return this.images.get(a).get(t.toString())}addImage(t,a,h){this._validate(t,h)&&this.images.get(a).set(t.toString(),h)}_validate(t,a){let h=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new s.z(new Error(`Image "${t.name}" has invalid "stretchX" value`))),h=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new s.z(new Error(`Image "${t.name}" has invalid "stretchY" value`))),h=!1),this._validateContent(a.content,a)||(this.fire(new s.z(new Error(`Image "${t.name}" has invalid "content" value`))),h=!1),h}_validateStretch(t,a){if(!t)return!0;let h=0;for(const g of t){if(g[0]<h||g[1]<g[0]||a<g[1])return!1;h=g[1]}return!0}_validateContent(t,a){return t?t.length!==4||!a.usvg&&(t[0]<0||a.data.width<t[0]||t[1]<0||a.data.height<t[1]||t[2]<0||a.data.width<t[2]||t[3]<0||a.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,a,h){const g=this.images.get(a).get(t.toString());h.version=g.version+1,this.images.get(a).set(t.toString(),h),this.updatedImages.get(a).add(t),this.removeFromImageRasterizerCache(t,a)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,a){this.spriteFormat!=="raster"&&(s.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:a}):this.imageRasterizer.removeImagesFromCacheByIds([t],a))}removeImage(t,a){const h=this.images.get(a),g=h.get(t.toString());h.delete(t.toString()),this.patterns.get(a).delete(t.toString()),this.removeFromImageRasterizerCache(t,a),g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(a=>s.I.from(a))}getImages(t,a,h){const g=[],_=[],w=this.imageProviders.get(a);for(const D of t){if(!D.iconsetId){g.push(D);continue}const z=w.get(D.iconsetId);z&&(this.getImage(D,a)?_.push(D):z.addPendingRequest(D))}if(g.length===0)return void this._notify(_,a,h);let T=!0;const C=!!this.loaded.get(a),R=this.images.get(a);if(!C)for(const D of g)R.has(D.toString())||(T=!1);C||T?this._notify(g,a,h):this.requestors.push({ids:g,scope:a,callback:h})}rasterizeImages(t,a){const h=new Map,{tasks:g,scope:_}=t;for(const[w,T]of g.entries()){const C=this.getImage(T.id,_);C&&h.set(w,{image:C,imageVariant:T})}this._rasterizeImages(_,h,a)}_rasterizeImages(t,a,h){if(s.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:a,scope:t},h);else{const g=new Map;for(const[_,{image:w,imageVariant:T}]of a.entries())g.set(_,this.imageRasterizer.rasterize(T,w,t,0));h(void 0,g)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,a,h){const g=this.images.get(a),_=new Map;for(const w of t){if(!g.get(w.toString())){if(w.iconsetId)continue;this.fire(new s.A("styleimagemissing",{id:w.name}))}const T=g.get(w.toString());if(!T){s.w(`Image "${w.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const C={data:T.usvg?null:T.data.clone(),pixelRatio:T.pixelRatio,sdf:T.sdf,usvg:T.usvg,version:T.version,stretchX:T.stretchX,stretchY:T.stretchY,content:T.content,hasRenderCallback:!!(T.userImage&&T.userImage.render)};T.usvg&&Object.assign(C,{width:T.icon.usvg_tree.width,height:T.icon.usvg_tree.height}),_.set(s.I.toString(w),C)}h(null,_)}getPixelSize(t){const{width:a,height:h}=this.atlasImage.get(t);return{width:a,height:h}}getPattern(t,a,h){const g=t.toString(),_=this.patterns.get(a),w=_.get(g),T=this.getImage(t,a);if(!T)return null;if(w){if(w.position.version===T.version)return w.position;w.position.version=T.version}else{if(T.usvg&&!T.data){const C=this.getPatternInFlightId(g,a);if(this.patternsInFlight.has(C))return null;this.patternsInFlight.add(C);const R=new s.B(t).scaleSelf(s.q.devicePixelRatio),D=new Map([[R.toString(),{image:T,imageVariant:R}]]);return this._rasterizeImages(a,D,(z,k)=>this.storePatternImage(R,a,T,h,k)),null}this.storePattern(t,a,T)}return this._updatePatternAtlas(a,h),_.get(g).position}getPatternInFlightId(t,a){return s.C(t,a)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,a,h,g,_){const w=t.toString(),T=_?_.get(w):void 0;T&&(h.data=T,this.storePattern(t.id,a,h),this._updatePatternAtlas(a,g),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),a)))}storePattern(t,a,h){const g={w:h.data.width+2*s.F,h:h.data.height+2*s.F,x:0,y:0},_=new s.G(g,h,s.F);this.patterns.get(a).set(t.toString(),{bin:g,position:_})}destroyAtlasTextures(){for(const t of this.atlasTexture.values())t&&t.destroy();this.atlasTexture.clear()}bind(t,a){const h=t.gl;let g=this.atlasTexture.get(a);g?this.dirty&&(g.update(this.atlasImage.get(a)),this.dirty=!1):(g=new s.T(t,this.atlasImage.get(a),h.RGBA8),this.atlasTexture.set(a,g)),g.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(t,a){const h=this.patterns.get(t),g=Array.from(h.values()).map(({bin:R})=>R),{w:_,h:w}=s.H(g),T=this.atlasImage.get(t);T.resize({width:_||1,height:w||1});const C=this.images.get(t);for(const[R,{bin:D,position:z}]of h.entries()){let k=z.padding;const F=D.x+k,q=D.y+k,$=C.get(R).data,X=$.width,Z=$.height;k=k>1?k-1:k,s.r.copy($,T,{x:0,y:0},{x:F,y:q},{width:X,height:Z},a),s.r.copy($,T,{x:0,y:Z-k},{x:F,y:q-k},{width:X,height:k},a),s.r.copy($,T,{x:0,y:0},{x:F,y:q+Z},{width:X,height:k},a),s.r.copy($,T,{x:X-k,y:0},{x:F-k,y:q},{width:k,height:Z},a),s.r.copy($,T,{x:0,y:0},{x:F+X,y:q},{width:k,height:Z},a),s.r.copy($,T,{x:X-k,y:Z-k},{x:F-k,y:q-k},{width:k,height:k},a),s.r.copy($,T,{x:0,y:Z-k},{x:F+X,y:q-k},{width:k,height:k},a),s.r.copy($,T,{x:0,y:0},{x:F+X,y:q+Z},{width:k,height:k},a),s.r.copy($,T,{x:X-k,y:0},{x:F-k,y:q+Z},{width:k,height:k},a)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,a){const h=this.images.get(a);for(const g of t){if(this.callbackDispatchedThisFrame.get(a).has(g.toString()))continue;this.callbackDispatchedThisFrame.get(a).add(g.toString());const _=h.get(g.toString());wr(_)&&this.updateImage(g,a,_)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function gr(d){const t=d.key,a=d.value,h=d.valueSpec||{},g=d.objectElementValidators||{},_=d.style,w=d.styleSpec;let T=[];const C=s.J(a);if(C!=="object")return[new s.V(t,a,`object expected, ${C} found`)];for(const R in a){const D=R.split(".")[0];let z;g[D]?z=g[D]:h[D]?z=yi:g["*"]?z=g["*"]:h["*"]&&(z=yi),z?T=T.concat(z({key:(t&&`${t}.`)+R,value:a[R],valueSpec:h[D]||h["*"],style:_,styleSpec:w,object:a,objectKey:R},a)):T.push(new s.K(t,a[R],`unknown property "${R}"`))}for(const R in h)g[R]||h[R].required&&h[R].default===void 0&&a[R]===void 0&&T.push(new s.V(t,a,`missing required property "${R}"`));return T}function bs(d){const t=d.value,a=d.valueSpec,h=d.style,g=d.styleSpec,_=d.key,w=d.arrayElementValidator||yi;if(s.J(t)!=="array")return[new s.V(_,t,`array expected, ${s.J(t)} found`)];if(a.length&&t.length!==a.length)return[new s.V(_,t,`array length ${a.length} expected, length ${t.length} found`)];if(a["min-length"]&&t.length<a["min-length"])return[new s.V(_,t,`array length at least ${a["min-length"]} expected, length ${t.length} found`)];let T={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};g.$version<7&&(T.function=a.function),s.J(a.value)==="object"&&(T=a.value);let C=[];for(let R=0;R<t.length;R++)C=C.concat(w({array:t,arrayIndex:R,value:t[R],valueSpec:T,style:h,styleSpec:g,key:`${_}[${R}]`},!0));return C}function Ma(d){const t=d.key,a=d.value,h=d.valueSpec;let g=s.J(a);if(g==="number"&&a!=a&&(g="NaN"),g!=="number")return[new s.V(t,a,`number expected, ${g} found`)];if("minimum"in h){let _=h.minimum;if(s.J(h.minimum)==="array"&&(_=h.minimum[d.arrayIndex]),a<_)return[new s.V(t,a,`${a} is less than the minimum value ${_}`)]}if("maximum"in h){let _=h.maximum;if(s.J(h.maximum)==="array"&&(_=h.maximum[d.arrayIndex]),a>_)return[new s.V(t,a,`${a} is greater than the maximum value ${_}`)]}return[]}function _r(d){const t=d.valueSpec,a=s.M(d.value.type);let h,g,_,w={};const T=a!=="categorical"&&d.value.property===void 0,C=!T,R=s.J(d.value.stops)==="array"&&s.J(d.value.stops[0])==="array"&&s.J(d.value.stops[0][0])==="object",D=gr({key:d.key,value:d.value,valueSpec:d.styleSpec.function,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{stops:function(F){if(a==="identity")return[new s.V(F.key,F.value,'identity function may not have a "stops" property')];let q=[];const $=F.value;return q=q.concat(bs({key:F.key,value:$,valueSpec:F.valueSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:z})),s.J($)==="array"&&$.length===0&&q.push(new s.V(F.key,$,"array must have at least one stop")),q},default:function(F){return yi({key:F.key,value:F.value,valueSpec:t,style:F.style,styleSpec:F.styleSpec})}}});return a==="identity"&&T&&D.push(new s.V(d.key,d.value,'missing required property "property"')),a==="identity"||d.value.stops||D.push(new s.V(d.key,d.value,'missing required property "stops"')),a==="exponential"&&d.valueSpec.expression&&!s.N(d.valueSpec)&&D.push(new s.V(d.key,d.value,"exponential functions not supported")),d.styleSpec.$version>=8&&(C&&!s.O(d.valueSpec)?D.push(new s.V(d.key,d.value,"property functions not supported")):T&&!s.Q(d.valueSpec)&&D.push(new s.V(d.key,d.value,"zoom functions not supported"))),a!=="categorical"&&!R||d.value.property!==void 0||D.push(new s.V(d.key,d.value,'"property" property is required')),D;function z(F){let q=[];const $=F.value,X=F.key;if(s.J($)!=="array")return[new s.V(X,$,`array expected, ${s.J($)} found`)];if($.length!==2)return[new s.V(X,$,`array length 2 expected, length ${$.length} found`)];if(R){if(s.J($[0])!=="object")return[new s.V(X,$,`object expected, ${s.J($[0])} found`)];if($[0].zoom===void 0)return[new s.V(X,$,"object stop key must have zoom")];if($[0].value===void 0)return[new s.V(X,$,"object stop key must have value")];const Z=s.M($[0].zoom);if(typeof Z!="number")return[new s.V(X,$[0].zoom,"stop zoom values must be numbers")];if(_&&_>Z)return[new s.V(X,$[0].zoom,"stop zoom values must appear in ascending order")];Z!==_&&(_=Z,g=void 0,w={}),q=q.concat(gr({key:`${X}[0]`,value:$[0],valueSpec:{zoom:{}},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:Ma,value:k}}))}else q=q.concat(k({key:`${X}[0]`,value:$[0],style:F.style,styleSpec:F.styleSpec},$));return s.S(s.U($[1]))?q.concat([new s.V(`${X}[1]`,$[1],"expressions are not allowed in function stops.")]):q.concat(yi({key:`${X}[1]`,value:$[1],valueSpec:t,style:F.style,styleSpec:F.styleSpec}))}function k(F,q){const $=s.J(F.value),X=s.M(F.value),Z=F.value!==null?F.value:q;if(h){if($!==h)return[new s.V(F.key,Z,`${$} stop domain type must match previous stop domain type ${h}`)]}else h=$;if($!=="number"&&$!=="string"&&$!=="boolean"&&typeof X!="number"&&typeof X!="string"&&typeof X!="boolean")return[new s.V(F.key,Z,"stop domain value must be a number, string, or boolean")];if($!=="number"&&a!=="categorical"){let ne=`number expected, ${$} found`;return s.O(t)&&a===void 0&&(ne+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(F.key,Z,ne)]}return a!=="categorical"||$!=="number"||typeof X=="number"&&isFinite(X)&&Math.floor(X)===X?a!=="categorical"&&$==="number"&&typeof X=="number"&&typeof g=="number"&&g!==void 0&&X<g?[new s.V(F.key,Z,"stop domain values must appear in ascending order")]:(g=X,a==="categorical"&&X in w?[new s.V(F.key,Z,"stop domain values must be unique")]:(w[X]=!0,[])):[new s.V(F.key,Z,`integer expected, found ${String(X)}`)]}}function Ge(d){const t=(d.expressionContext==="property"?s.W:s.X)(s.U(d.value),d.valueSpec);if(t.result==="error")return t.value.map(h=>new s.V(`${d.key}${h.key}`,d.value,h.message));const a=t.value.expression||t.value._styleExpression.expression;if(d.expressionContext==="property"&&d.propertyKey==="text-font"&&!a.outputDefined())return[new s.V(d.key,d.value,`Invalid data expression for "${d.propertyKey}". Output values must be contained as literals within the expression.`)];if(d.expressionContext==="property"&&d.propertyType==="layout"&&!s.Y(a))return[new s.V(d.key,d.value,'"feature-state" data expressions are not supported with layout properties.')];if(d.expressionContext==="filter")return rt(a,d);if(d.expressionContext&&d.expressionContext.indexOf("cluster")===0){if(!s.Z(a,["zoom","feature-state"]))return[new s.V(d.key,d.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(d.expressionContext==="cluster-initial"&&!s._(a))return[new s.V(d.key,d.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function rt(d,t){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const g of t.valueSpec.expression.parameters)a.delete(g);if(a.size===0)return[];const h=[];return d instanceof s.$&&a.has(d.name)?[new s.V(t.key,t.value,`["${d.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(d.eachChild(g=>{h.push(...rt(g,t))}),h)}function Rt(d){const t=d.key,a=d.value,h=d.valueSpec,g=[];return Array.isArray(h.values)?h.values.indexOf(s.M(a))===-1&&g.push(new s.V(t,a,`expected one of [${h.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(h.values).indexOf(s.M(a))===-1&&g.push(new s.V(t,a,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(a)} found`)),g}function fi(d){return s.a1(s.U(d.value))?Ge(s.L({},d,{expressionContext:"filter",valueSpec:d.styleSpec[`filter_${d.layerType||"fill"}`]})):di(d)}function di(d){const t=d.value,a=d.key;if(s.J(t)!=="array")return[new s.V(a,t,`array expected, ${s.J(t)} found`)];const h=d.styleSpec;let g,_=[];if(t.length<1)return[new s.V(a,t,"filter array must have at least 1 element")];switch(_=_.concat(Rt({key:`${a}[0]`,value:t[0],valueSpec:h.filter_operator,style:d.style,styleSpec:d.styleSpec})),s.M(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&s.M(t[1])==="$type"&&_.push(new s.V(a,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&_.push(new s.V(a,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(g=s.J(t[1]),g!=="string"&&_.push(new s.V(`${a}[1]`,t[1],`string expected, ${g} found`)));for(let w=2;w<t.length;w++)g=s.J(t[w]),s.M(t[1])==="$type"?_=_.concat(Rt({key:`${a}[${w}]`,value:t[w],valueSpec:h.geometry_type,style:d.style,styleSpec:d.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&_.push(new s.V(`${a}[${w}]`,t[w],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let w=1;w<t.length;w++)_=_.concat(di({key:`${a}[${w}]`,value:t[w],style:d.style,styleSpec:d.styleSpec}));break;case"has":case"!has":g=s.J(t[1]),t.length!==2?_.push(new s.V(a,t,`filter array for "${t[0]}" operator must have 2 elements`)):g!=="string"&&_.push(new s.V(`${a}[1]`,t[1],`string expected, ${g} found`))}return _}function ri(d,t){const a=d.key,h=d.style,g=d.layer,_=d.styleSpec,w=d.value,T=d.objectKey,C=_[`${t}_${d.layerType}`];if(!C)return[];const R=T.match(/^(.*)-use-theme$/);if(t==="paint"&&R&&C[R[1]])return s.S(w)?[].concat(yi({key:d.key,value:w,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:h,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:T})):yi({key:a,value:w,valueSpec:{type:"string"},style:h,styleSpec:_});const D=T.match(/^(.*)-transition$/);if(t==="paint"&&D&&C[D[1]]&&C[D[1]].transition)return yi({key:a,value:w,valueSpec:_.transition,style:h,styleSpec:_});const z=d.valueSpec||C[T];if(!z)return[new s.K(a,w,`unknown property "${T}"`)];let k;if(s.J(w)==="string"&&s.O(z)&&!z.tokens&&(k=/^{([^}]+)}$/.exec(w))){const q=`\`{ "type": "identity", "property": ${k?JSON.stringify(k[1]):'"_"'} }\``;return[new s.V(a,w,`"${T}" does not support interpolation syntax
Use an identity property function instead: ${q}.`)]}const F=[];if(d.layerType==="symbol")T!=="text-field"||!h||h.glyphs||h.imports||F.push(new s.V(a,w,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&s.a2(s.U(w))&&s.M(w.type)==="identity"&&F.push(new s.V(a,w,'"text-font" does not support identity functions'));else if(d.layerType==="model"&&t==="paint"&&g&&g.layout&&g.layout.hasOwnProperty("model-id")&&s.O(z)&&(s.a3(z)||s.Q(z))){const q=s.W(s.U(w),z),$=q.value.expression||q.value._styleExpression.expression;$&&!s.Z($,["measure-light"])&&(T==="model-emissive-strength"&&s._($)&&s.Y($)||F.push(new s.V(a,w,`${T} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return F.concat(yi({key:d.key,value:w,valueSpec:z,style:h,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:T}))}function Ci(d){return ri(d,"paint")}function an(d){return ri(d,"layout")}function Jn(d){let t=[];const a=d.value,h=d.key,g=d.style,_=d.styleSpec;a.type||a.ref||t.push(new s.V(h,a,'either "type" or "ref" is required'));let w=s.M(a.type);const T=s.M(a.ref);if(a.id){const C=s.M(a.id);for(let R=0;R<d.arrayIndex;R++){const D=g.layers[R];s.M(D.id)===C&&t.push(new s.V(h,a.id,`duplicate layer id "${a.id}", previously used at line ${D.id.__line__}`))}}if("ref"in a){let C;["type","source","source-layer","filter","layout"].forEach(R=>{R in a&&t.push(new s.V(h,a[R],`"${R}" is prohibited for ref layers`))}),g.layers.forEach(R=>{s.M(R.id)===T&&(C=R)}),C?C.ref?t.push(new s.V(h,a.ref,"ref cannot reference another ref layer")):w=s.M(C.type):typeof T=="string"&&t.push(new s.V(h,a.ref,`ref layer "${T}" not found`))}else if(w!=="background"&&w!=="sky"&&w!=="slot")if(a.source){const C=g.sources&&g.sources[a.source],R=C&&s.M(C.type);C?R==="vector"&&w==="raster"?t.push(new s.V(h,a.source,`layer "${a.id}" requires a raster source`)):R==="raster"&&w!=="raster"?t.push(new s.V(h,a.source,`layer "${a.id}" requires a vector source`)):R!=="vector"||a["source-layer"]?R==="raster-dem"&&w!=="hillshade"?t.push(new s.V(h,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):R!=="raster-array"||["raster","raster-particle"].includes(w)?w==="line"&&a.paint&&(a.paint["line-gradient"]||a.paint["line-trim-offset"])&&R==="geojson"&&!C.lineMetrics?t.push(new s.V(h,a,`layer "${a.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):w==="raster-particle"&&R!=="raster-array"&&t.push(new s.V(h,a.source,`layer "${a.id}" requires a 'raster-array' source.`)):t.push(new s.V(h,a.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new s.V(h,a,`layer "${a.id}" must specify a "source-layer"`)):t.push(new s.V(h,a.source,`source "${a.source}" not found`))}else t.push(new s.V(h,a,'missing required property "source"'));return t=t.concat(gr({key:h,value:a,valueSpec:_.layer,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{"*":()=>[],type:()=>yi({key:`${h}.type`,value:a.type,valueSpec:_.layer.type,style:d.style,styleSpec:d.styleSpec,object:a,objectKey:"type"}),filter:C=>fi(s.L({layerType:w},C)),layout:C=>gr({layer:a,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":R=>an(s.L({layerType:w},R))}}),paint:C=>gr({layer:a,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":R=>Ci(s.L({layerType:w,layer:a},R))}})}})),t}function br(d){const t=d.value,a=d.key,h=s.J(t);return h!=="string"?[new s.V(a,t,`string expected, ${h} found`)]:[]}const mo={promoteId:function d({key:t,value:a}){if(s.J(a)==="string")return br({key:t,value:a});if(Array.isArray(a)){const h=[],g=s.U(a),_=s.X(g);return _.result==="error"&&_.value.forEach(w=>{h.push(new s.V(`${t}${w.key}`,null,`${w.message}`))}),s.Z(_.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||h.push(new s.V(`${t}`,null,"promoteId expression should be only feature dependent")),h}{const h=[];for(const g in a)h.push(...d({key:`${t}.${g}`,value:a[g]}));return h}}};function Ar(d){const t=d.value,a=d.key,h=d.styleSpec,g=d.style;if(!t.type)return[new s.V(a,t,'"type" is required')];const _=s.M(t.type);let w=[];switch(["vector","raster","raster-dem","raster-array"].includes(_)&&(t.url||t.tiles||w.push(new s.K(a,t,'Either "url" or "tiles" is required.'))),_){case"vector":case"raster":case"raster-dem":case"raster-array":return w=w.concat(gr({key:a,value:t,valueSpec:h[`source_${_.replace("-","_")}`],style:d.style,styleSpec:h,objectElementValidators:mo})),w;case"geojson":if(w=gr({key:a,value:t,valueSpec:h.source_geojson,style:g,styleSpec:h,objectElementValidators:mo}),t.cluster)for(const T in t.clusterProperties){const[C,R]=t.clusterProperties[T],D=typeof C=="string"?[C,["accumulated"],["get",T]]:C;w.push(...Ge({key:`${a}.${T}.map`,value:R,expressionContext:"cluster-map"})),w.push(...Ge({key:`${a}.${T}.reduce`,value:D,expressionContext:"cluster-reduce"}))}return w;case"video":return gr({key:a,value:t,valueSpec:h.source_video,style:g,styleSpec:h});case"image":return gr({key:a,value:t,valueSpec:h.source_image,style:g,styleSpec:h});case"canvas":return[new s.V(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Rt({key:`${a}.type`,value:t.type,valueSpec:{values:Ss(h)}})}}function Ss(d){return d.source.reduce((t,a)=>{const h=d[a];return h.type.type==="enum"&&(t=t.concat(Object.keys(h.type.values))),t},[])}function io(d){const t=d.value,a=d.styleSpec,h=a.light,g=d.style;let _=[];const w=s.J(t);if(t===void 0)return _;if(w!=="object")return _=_.concat([new s.V("light",t,`object expected, ${w} found`)]),_;for(const T in t){const C=T.match(/^(.*)-transition$/),R=T.match(/^(.*)-use-theme$/);_=_.concat(R&&h[R[1]]?yi({key:T,value:t[T],valueSpec:{type:"string"},style:g,styleSpec:a}):C&&h[C[1]]&&h[C[1]].transition?yi({key:T,value:t[T],valueSpec:a.transition,style:g,styleSpec:a}):h[T]?yi({key:T,value:t[T],valueSpec:h[T],style:g,styleSpec:a}):[new s.V(T,t[T],`unknown property "${T}"`)])}return _}function no(d){const t=d.value;let a=[];if(!t)return a;const h=s.J(t);if(h!=="object")return a=a.concat([new s.V("light-3d",t,`object expected, ${h} found`)]),a;const g=d.styleSpec,_=g["light-3d"],w=d.key,T=d.style,C=d.style.lights;for(const z of["type","id"])if(!(z in t))return a=a.concat([new s.V("light-3d",t,`missing property ${z} on light`)]),a;if(t.type&&C)for(let z=0;z<d.arrayIndex;z++){const k=s.M(t.type),F=C[z];s.M(F.type)===k&&a.push(new s.V(w,t.id,`duplicate light type "${t.type}", previously defined at line ${F.id.__line__}`))}const R=`properties_light_${t.type}`;if(!(R in g))return a=a.concat([new s.V("light-3d",t,`Invalid light type ${t.type}`)]),a;const D=g[R];for(const z in t)if(z==="properties"){const k=t[z],F=s.J(k);if(F!=="object")return a=a.concat([new s.V("properties",k,`object expected, ${F} found`)]),a;for(const q in k){const $=q.match(/^(.*)-transition$/),X=q.match(/^(.*)-use-theme$/);a=a.concat(X&&D[X[1]]?yi({key:z,value:k[q],valueSpec:{type:"string"},style:T,styleSpec:g}):$&&D[$[1]]&&D[$[1]].transition?yi({key:z,value:t[z],valueSpec:g.transition,style:T,styleSpec:g}):D[q]?yi({key:q,value:k[q],valueSpec:D[q],style:T,styleSpec:g}):[new s.K(d.key,k[q],`unknown property "${q}"`)])}}else a=a.concat(_[z]?yi({key:z,value:t[z],valueSpec:_[z],style:T,styleSpec:g}):[new s.K(z,t[z],`unknown property "${z}"`)]);return a}function go(d){const t=d.value,a=d.key,h=d.style,g=d.styleSpec,_=g.terrain;let w=[];const T=s.J(t);if(t===void 0||T==="null")return w;if(T!=="object")return w=w.concat([new s.V("terrain",t,`object expected, ${T} found`)]),w;for(const C in t){const R=C.match(/^(.*)-transition$/),D=C.match(/^(.*)-use-theme$/);w=w.concat(D&&_[D[1]]?yi({key:C,value:t[C],valueSpec:{type:"string"},style:h,styleSpec:g}):R&&_[R[1]]&&_[R[1]].transition?yi({key:C,value:t[C],valueSpec:g.transition,style:h,styleSpec:g}):_[C]?yi({key:C,value:t[C],valueSpec:_[C],style:h,styleSpec:g}):[new s.K(C,t[C],`unknown property "${C}"`)])}if(t.source){const C=h.sources&&h.sources[t.source],R=C&&s.M(C.type);C?R!=="raster-dem"&&w.push(new s.V(a,t.source,`terrain cannot be used with a source of type ${String(R)}, it only be used with a "raster-dem" source type`)):w.push(new s.V(a,t.source,`source "${t.source}" not found`))}else w.push(new s.V(a,t,'terrain is missing required property "source"'));return w}function as(d){const t=d.value,a=d.style,h=d.styleSpec,g=h.fog;let _=[];const w=s.J(t);if(t===void 0)return _;if(w!=="object")return _=_.concat([new s.V("fog",t,`object expected, ${w} found`)]),_;for(const T in t){const C=T.match(/^(.*)-transition$/),R=T.match(/^(.*)-use-theme$/);_=_.concat(R&&g[R[1]]?yi({key:T,value:t[T],valueSpec:{type:"string"},style:a,styleSpec:h}):C&&g[C[1]]&&g[C[1]].transition?yi({key:T,value:t[T],valueSpec:h.transition,style:a,styleSpec:h}):g[T]?yi({key:T,value:t[T],valueSpec:g[T],style:a,styleSpec:h}):[new s.K(T,t[T],`unknown property "${T}"`)])}return _}const Ra={"*":()=>[],array:bs,boolean:function(d){const t=d.value,a=d.key,h=s.J(t);return h!=="boolean"?[new s.V(a,t,`boolean expected, ${h} found`)]:[]},number:Ma,color:function(d){const t=d.key,a=d.value,h=s.J(a);return h!=="string"?[new s.V(t,a,`color expected, ${h} found`)]:s.a0.parseCSSColor(a)===null?[new s.V(t,a,`color expected, "${a}" found`)]:[]},enum:Rt,filter:fi,function:_r,layer:Jn,object:gr,source:Ar,model:s.a4,light:io,"light-3d":no,terrain:go,fog:as,string:br,formatted:function(d){return br(d).length===0?[]:Ge(d)},resolvedImage:function(d){return br(d).length===0?[]:Ge(d)},projection:function(d){const t=d.value,a=d.styleSpec,h=a.projection,g=d.style;let _=[];const w=s.J(t);if(w==="object")for(const T in t)_=_.concat(yi({key:T,value:t[T],valueSpec:h[T],style:g,styleSpec:a}));else w!=="string"&&(_=_.concat([new s.V("projection",t,`object or string expected, ${w} found`)]));return _},import:function(d){const{value:t,styleSpec:a}=d,{data:h,...g}=t;Object.defineProperty(g,"__line__",{value:t.__line__,enumerable:!1});let _=gr(s.L({},d,{value:g,valueSpec:a.import}));return s.M(g.id)===""&&_.push(new s.V(`${d.key}.id`,g,"import id can't be an empty string")),h&&(_=_.concat(lr(h,a,{key:`${d.key}.data`}))),_},iconset:function(d){const t=d.value,a=d.key,h=d.styleSpec,g=d.style;if(!t.type)return[new s.V(a,t,'"type" is required')];const _=s.M(t.type);let w=[];if(w=w.concat(gr({key:a,value:t,valueSpec:h[`iconset_${_}`],style:g,styleSpec:h})),_==="source"&&t.source){const T=g.sources&&g.sources[t.source],C=T&&s.M(T.type);T?C!=="raster-array"&&w.push(new s.V(a,t.source,`iconset cannot be used with a source of type ${String(C)}, it only be used with a "raster-array" source type`)):w.push(new s.V(a,t.source,`source "${t.source}" not found`))}return w}};function yi(d,t=!1){const a=d.value,h=d.valueSpec,g=d.styleSpec;if(h.expression&&s.a2(s.M(a)))return _r(d);if(h.expression&&s.S(s.U(a)))return Ge(d);if(h.type&&Ra[h.type]){const _=Ra[h.type](d);return t===!0&&_.length>0&&s.J(d.value)==="array"?Ge(d):_}return gr(s.L({},d,{valueSpec:h.type?g[h.type]:h}))}function hr(d){const t=d.value,a=d.key,h=br(d);return h.length||(t.indexOf("{fontstack}")===-1&&h.push(new s.V(a,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&h.push(new s.V(a,t,'"glyphs" url must include a "{range}" token'))),h}function lr(d,t=s.a5,a={}){return yi({key:a.key||"",value:d,valueSpec:t.$root,styleSpec:t,style:d,objectElementValidators:{glyphs:hr,"*":()=>[]}})}function jr(d,t=s.a5){return Ce(lr(d,t))}const $s=d=>Ce(Ar(d)),Al=d=>Ce(io(d)),Il=d=>Ce(no(d)),ht=d=>Ce(go(d)),Ka=d=>Ce(as(d)),km=d=>Ce(function(t){const a=t.value,h=t.style,g=t.styleSpec,_=g.snow;let w=[];const T=s.J(a);if(a===void 0)return w;if(T!=="object")return w=w.concat([new s.V("snow",a,`object expected, ${T} found`)]),w;for(const C in a){const R=C.match(/^(.*)-transition$/);w=w.concat(R&&_[R[1]]&&_[R[1]].transition?yi({key:C,value:a[C],valueSpec:g.transition,style:h,styleSpec:g}):_[C]?yi({key:C,value:a[C],valueSpec:_[C],style:h,styleSpec:g}):[new s.K(C,a[C],`unknown property "${C}"`)])}return w}(d)),Fd=d=>Ce(function(t){const a=t.value,h=t.style,g=t.styleSpec,_=g.rain;let w=[];const T=s.J(a);if(a===void 0)return w;if(T!=="object")return w=w.concat([new s.V("rain",a,`object expected, ${T} found`)]),w;for(const C in a){const R=C.match(/^(.*)-transition$/);w=w.concat(R&&_[R[1]]&&_[R[1]].transition?yi({key:C,value:a[C],valueSpec:g.transition,style:h,styleSpec:g}):_[C]?yi({key:C,value:a[C],valueSpec:_[C],style:h,styleSpec:g}):[new s.K(C,a[C],`unknown property "${C}"`)])}return w}(d)),pn=d=>Ce(Jn(d)),Be=d=>Ce(fi(d)),Y=d=>Ce(Ci(d)),ie=d=>Ce(an(d)),me=d=>Ce(s.a4(d));function Ce(d){return d.slice().sort((t,a)=>t.line&&a.line?t.line-a.line:0)}function ge(d,t){let a=!1;if(t&&t.length)for(const h of t)h instanceof s.K?s.w(h.message):(d.fire(new s.z(new Error(h.message))),a=!0);return a}let Re;class $e extends s.E{constructor(t,a="flat"){super(),this._transitionable=new s.a6(Re||(Re=new s.a7({anchor:new s.a8(s.a5.light.anchor),position:new s.a9(s.a5.light.position),color:new s.a8(s.a5.light.color),intensity:new s.a8(s.a5.light.intensity)}))),this.setLight(t,a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a,h={}){this._validate(Al,t,h)||(this._transitionable.setTransitionOrValue(t),this.id=a)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,h){return(!h||h.validate!==!1)&&ge(this,t.call(jr,s.h({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}}let ke=class extends s.E{constructor(d,t,a,h,g){super(),this.scope=a,this._transitionable=new s.a6(new s.a7({source:new s.a8(s.a5.terrain.source),exaggeration:new s.a8(s.a5.terrain.exaggeration)}),a,h),this._transitionable.setTransitionOrValue(d,h),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=g}get(){return this._transitionable.serialize()}set(d,t){this._transitionable.setTransitionOrValue(d,t)}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}getExaggeration(d){return this._transitioning.possiblyEvaluate(new s.aa(d,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const d=this._transitionable._values.exaggeration;if(!d)return null;const t=d.value.expression;if(!t)return null;let a=-1,h=-1,g=1;for(const _ of t.zoomStops)g=t.evaluate(new s.aa(_,{worldview:this.worldview})),g>.01?(a=_,h=-1):h=_;return g<.01&&a>0&&h>a?[a,h]:null}isZoomDependent(){const d=this._transitionable._values.exaggeration;return d!=null&&d.value!=null&&d.value.expression!=null&&d.value.expression instanceof s.ab}};const Ve=45,vt=65,it=.05;function ei(d,t,a,h){const g=s.af(Ve,vt,a),[_,w]=_i(d,h);let T=1-Math.min(1,Math.exp((t-_)/(w-_)*-6));return T*=T*T,T=Math.min(1,1.00747*T),T*g*d.alpha}function _i(d,t){const a=.5/Math.tan(.5*t);return[d.range[0]+a,d.range[1]+a]}function Ti(d,t,a,h,g){const _=s.ad([],[t,a,h],g.mercatorFogMatrix);return ei(d,s.ae(_),g.pitch,g._fov)}function Zi(d,t,a,h,g,_,w){const T=[[a,h,0],[g,h,0],[g,_,0],[a,_,0]];let C=Number.MAX_VALUE,R=-Number.MAX_VALUE;for(const D of T){const z=s.ad([],D,t),k=s.ae(z);C=Math.min(C,k),R=Math.max(R,k)}return[ei(d,C,w.pitch,w._fov),ei(d,R,w.pitch,w._fov)]}class Vi extends s.E{constructor(t,a,h,g){super();const _=new s.a7({range:new s.a8(s.a5.fog.range),color:new s.a8(s.a5.fog.color),"color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new s.a8(s.a5.fog["high-color"]),"high-color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new s.a8(s.a5.fog["space-color"]),"space-color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new s.a8(s.a5.fog["horizon-blend"]),"star-intensity":new s.a8(s.a5.fog["star-intensity"]),"vertical-range":new s.a8(s.a5.fog["vertical-range"])});this._transitionable=new s.a6(_,h,new Map(g)),this.set(t,g),this._transitioning=this._transitionable.untransitioned(),this._transform=a,this.properties=new s.ag(_),this.scope=h}get state(){const t=this._transform,a=t.projection.name==="globe",h=s.ah(t.zoom),g=this.properties.get("range"),_=[.5,3];return{range:a?[s.ai(_[0],g[0],h),s.ai(_[1],g[1],h)]:g,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,a,h={}){if(this._validate(Ka,t,h))return;const g=s.h({},t);for(const _ of Object.keys(s.a5.fog))g[_]===void 0&&(g[_]=s.a5.fog[_].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,a)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.af(Ve,vt,t))*a.a}getOpacityAtLatLng(t,a){return this._transform.projection.supportsFog?function(h,g,_){const w=s.ac.fromLngLat(g),T=_.elevation?_.elevation.getAtPointOrZero(w):0;return Ti(h,w.x,w.y,T,_)}(this.state,t,a):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const a=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Zi(this.state,a,0,0,s.aj,s.aj,this._transform)}getOpacityForBounds(t,a,h,g,_){return this._transform.projection.supportsFog?Zi(this.state,t,a,h,g,_,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?_i(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const a=[4,5,6,7];for(const h of a){const g=t.points[h];let _;if(g[2]>=0)_=g;else{const w=t.points[h-4];_=s.ak(w,g,w[2]/(w[2]-g[2]))}if(Ti(this.state,_[0],_[1],0,this._transform)>=it)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,h){return(!h||h.validate!==!1)&&ge(this,t.call(jr,s.h({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}}let Xi,jn,Ki,Sr,Xr=class extends s.E{constructor(d,t,a,h){super();const g=Xi||(Xi=new s.a7({density:new s.a8(s.a5.snow.density),intensity:new s.a8(s.a5.snow.intensity),color:new s.a8(s.a5.snow.color),opacity:new s.a8(s.a5.snow.opacity),vignette:new s.a8(s.a5.snow.vignette),"vignette-color":new s.a8(s.a5.snow["vignette-color"]),"center-thinning":new s.a8(s.a5.snow["center-thinning"]),direction:new s.a8(s.a5.snow.direction),"flake-size":new s.a8(s.a5.snow["flake-size"])}));this._transitionable=new s.a6(g,a,new Map(h)),this.set(d,h),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ag(g),this.scope=a}get state(){const d=this.properties.get("opacity"),t=this.properties.get("color"),a=this.properties.get("direction"),h=s.al(a[0]),g=-Math.max(s.al(a[1]),.01),_=[Math.cos(h)*Math.cos(g),Math.sin(h)*Math.cos(g),Math.sin(g)],w=this.properties.get("vignette"),T=this.properties.get("vignette-color");return T.a=w,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.am(t.r,t.g,t.b,t.a*d),direction:_,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:T}}get(){return this._transitionable.serialize()}set(d,t,a={}){if(this._validate(km,d,a))return;const h=s.h({},d);for(const g of Object.keys(s.a5.snow))h[g]===void 0&&(h[g]=s.a5.snow[g].default);this._options=h,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(d){this._transitionable.setTransitionOrValue(this._options,new Map(d))}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,t,a){return(!a||a.validate!==!1)&&ge(this,d.call(jr,s.h({value:t,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}},Br=class extends s.E{constructor(d,t,a,h){super();const g=jn||(jn=new s.a7({density:new s.a8(s.a5.rain.density),intensity:new s.a8(s.a5.rain.intensity),color:new s.a8(s.a5.rain.color),opacity:new s.a8(s.a5.rain.opacity),vignette:new s.a8(s.a5.rain.vignette),"vignette-color":new s.a8(s.a5.rain["vignette-color"]),"center-thinning":new s.a8(s.a5.rain["center-thinning"]),direction:new s.a8(s.a5.rain.direction),"droplet-size":new s.a8(s.a5.rain["droplet-size"]),"distortion-strength":new s.a8(s.a5.rain["distortion-strength"])}));this._transitionable=new s.a6(g,a,new Map(h)),this.set(d,h),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ag(g),this.scope=a}get state(){const d=this.properties.get("opacity"),t=this.properties.get("color"),a=this.properties.get("direction"),h=s.al(a[0]),g=-Math.max(s.al(a[1]),.01),_=[Math.cos(h)*Math.cos(g),Math.sin(h)*Math.cos(g),Math.sin(g)],w=this.properties.get("vignette-color");return w.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.am(t.r,t.g,t.b,t.a*d),direction:_,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:w}}get(){return this._transitionable.serialize()}set(d,t,a={}){if(this._validate(Fd,d,a))return;const h=s.h({},d);for(const g of Object.keys(s.a5.rain))h[g]===void 0&&(h[g]=s.a5.rain[g].default);this._options=h,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(d){this._transitionable.setTransitionOrValue(this._options,new Map(d))}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,t,a){return(!a||a.validate!==!1)&&ge(this,d.call(jr,s.h({value:t,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}};class Nn extends s.E{constructor(t,a,h,g){super(),this.scope=h,this._options=t,this.properties=new s.ag(a),this._transitionable=new s.a6(a,h,new Map(g)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,a){this._options=t,this._transitionable.setTransitionOrValue(t.properties,a)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class _n{constructor(t,a,h){this.screenBounds=t,this.cameraPoint=h.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=a,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,h)}static createFromScreenPoints(t,a){let h,g;if(t instanceof s.P||typeof t[0]=="number"){const _=s.P.convert(t);h=[_],g=a.isPointAboveHorizon(_)}else{const _=s.P.convert(t[0]),w=s.P.convert(t[1]),T=_.add(w)._div(2);h=[_,w],g=s.ao(_,w).every(C=>a.isPointAboveHorizon(C))&&a.isPointAboveHorizon(T)}return new _n(h,g,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return s.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const a=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],g=s.ao(a,h,0,!1);return this.cameraPoint.y>h.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<h.x?g.splice(3,0,this.cameraPoint):this.cameraPoint.x>=h.x?g[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(g[3]=this.cameraPoint)),s.ap(g,t)}bufferedCameraGeometryGlobe(t){const a=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],g=s.ao(a,h,t),_=this.cameraPoint.clone();switch(3*((_.y>a.y)+(_.y>h.y))+((_.x>a.x)+(_.x>h.x))){case 0:g[0]=_,g[4]=_.clone();break;case 1:g.splice(1,0,_);break;case 2:g[1]=_;break;case 3:g.splice(4,0,_);break;case 5:g.splice(2,0,_);break;case 6:g[3]=_;break;case 7:g.splice(3,0,_);break;case 8:g[2]=_}return g}containsTile(t,a,h,g=0){const _=t.queryPadding/a._pixelsPerMercatorPixel+1,w=h?this._bufferedCameraMercator(_,a):this._bufferedScreenMercator(_,a);let T=t.tileID.wrap+(w.unwrapped?g:0);const C=w.polygon.map(X=>s.aq(t.tileTransform,X,T));if(!s.ar(C,0,0,s.aj,s.aj))return;T=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?g:0);const R=this.screenGeometryMercator.polygon.map(X=>s.as(t.tileTransform,X,T)),D=R.map(X=>new s.P(X[0],X[1])),z=a.getFreeCameraOptions().position||new s.ac(0,0,0),k=s.as(t.tileTransform,z,T),F=R.map(X=>{const Z=s.at(X,X,k);return s.au(Z,Z),new s.av(k,Z)}),q=s.aw(t,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:D,tilespaceRays:F,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:($=s.ax(C),$.min.x=s.ay($.min.x,0,s.aj),$.min.y=s.ay($.min.y,0,s.aj),$.max.x=s.ay($.max.x,0,s.aj),$.max.y=s.ay($.max.y,0,s.aj),$),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:q};var $}_bufferedScreenMercator(t,a){const h=nr(t);if(this._screenRaycastCache[h])return this._screenRaycastCache[h];{let g;return g=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),a):{polygon:this.bufferedScreenGeometry(t).map(_=>a.pointCoordinate3D(_)),unwrapped:!0},this._screenRaycastCache[h]=g,g}}_bufferedCameraMercator(t,a){const h=nr(t);if(this._cameraRaycastCache[h])return this._cameraRaycastCache[h];{let g;return g=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),a):{polygon:this.bufferedCameraGeometry(t).map(_=>a.pointCoordinate3D(_)),unwrapped:!0},this._cameraRaycastCache[h]=g,g}}_projectAndResample(t,a){const h=function(_,w){const T=s.az([],w.pixelMatrix,w.globeMatrix),C=[0,-s.aB,0,1],R=[0,s.aB,0,1],D=[0,0,0,1];s.aA(C,C,T),s.aA(R,R,T),s.aA(D,D,T);const z=new s.P(C[0]/C[3],C[1]/C[3]),k=new s.P(R[0]/R[3],R[1]/R[3]),F=s.aC(_,z)&&C[3]<D[3],q=s.aC(_,k)&&R[3]<D[3];if(!F&&!q)return null;const $=function(Te,ye,xe){for(let ve=1;ve<Te.length;ve++){const Oe=cr(ye.pointCoordinate3D(Te[ve-1]).x),Pe=cr(ye.pointCoordinate3D(Te[ve]).x);if(xe<0){if(Oe<Pe)return{idx:ve,t:-Oe/(Pe-1-Oe)}}else if(Pe<Oe)return{idx:ve,t:(1-Oe)/(Pe+1-Oe)}}return null}(_,w,F?-1:1);if(!$)return null;const{idx:X,t:Z}=$;let ne=X>1?yr(_.slice(0,X),w):[],ae=X<_.length?yr(_.slice(X),w):[];ne=ne.map(Te=>new s.P(cr(Te.x),Te.y)),ae=ae.map(Te=>new s.P(cr(Te.x),Te.y));const de=[...ne];de.length===0&&de.push(ae[ae.length-1]);const _e=s.ai(de[de.length-1].y,(ae.length===0?ne[0]:ae[0]).y,Z);let be;return be=F?[new s.P(0,_e),new s.P(0,0),new s.P(1,0),new s.P(1,_e)]:[new s.P(1,_e),new s.P(1,1),new s.P(0,1),new s.P(0,_e)],de.push(...be),ae.length===0?de.push(ne[0]):de.push(...ae),{polygon:de.map(Te=>new s.ac(Te.x,Te.y)),unwrapped:!1}}(t,a);if(h)return h;const g=function(_,w){let T=!1,C=-1/0,R=0;for(let z=0;z<_.length-1;z++)_[z].x>C&&(C=_[z].x,R=z);for(let z=0;z<_.length-1;z++){const k=(R+z)%(_.length-1),F=_[k],q=_[k+1];Math.abs(F.x-q.x)>.5&&(F.x<q.x?(F.x+=1,k===0&&(_[_.length-1].x+=1)):(q.x+=1,k+1===_.length-1&&(_[0].x+=1)),T=!0)}const D=s.aD(w.center.lng);return T&&D<Math.abs(D-1)&&_.forEach(z=>{z.x-=1}),{polygon:_,unwrapped:T}}(yr(t,a).map(_=>new s.P(cr(_.x),_.y)),a);return{polygon:g.polygon.map(_=>new s.ac(_.x,_.y)),unwrapped:g.unwrapped}}}function yr(d,t){return s.aE(d,a=>{const h=t.pointCoordinate3D(a);a.x=h.x,a.y=h.y},1/256)}function cr(d){return d<0?1+d%1:d%1}function nr(d){return 100*d|0}function ls(d,t,a,h,g){const _=function(T,C){if(T)return g(T);if(C){if(d.url&&C.tiles&&d.tiles&&delete d.tiles,C.variants){if(!Array.isArray(C.variants))return g(new Error("variants must be an array"));for(const D of C.variants){if(D==null||typeof D!="object"||D.constructor!==Object)return g(new Error("variant must be an object"));if(!Array.isArray(D.capabilities))return g(new Error("capabilities must be an array"));if(D.capabilities.length===1&&D.capabilities[0]==="meshopt"){C=s.h(C,D);break}}}const R=s.aF(s.h({},C,d),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);R.tiles=t.canonicalizeTileset(R,d.url),g(null,R)}},w=function(T,C,R){if(!T)return null;if(!C&&!R)return T;R=R||T.worldview_default;const D=Object.values(T.language||{});if(D.length===0)return null;const z=Object.values(T.worldview||{});if(z.length===0)return null;const k=D.every(q=>q===C),F=z.every(q=>q===R);return k&&F?T:C in(T.language_options||{})||R in(T.worldview_options||{})?null:T.language_options&&T.worldview_options?T:null}(d.data,a,h);return w?s.q.frame(()=>_(null,w)):d.url?s.n(t.transformRequest(t.normalizeSourceURL(d.url,null,a,h),s.R.Source),_):s.q.frame(()=>{const{data:T,...C}=d;_(null,C)})}function ro(d,t){const a=Math.pow(2,t.z),h=Math.floor(s.aD(d.getWest())*a),g=Math.floor(s.aH(d.getNorth())*a),_=Math.ceil(s.aD(d.getEast())*a),w=Math.ceil(s.aH(d.getSouth())*a);return t.x>=h&&t.x<_&&t.y>=g&&t.y<w}class Ns{constructor(t,a,h){this.bounds=t?s.aG.convert(this.validateBounds(t)):null,this.minzoom=a||0,this.maxzoom=h||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const a of t)this.extraBounds.push(s.aG.convert(this.validateBounds(a)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!ro(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const a of this.extraBounds)if(ro(a,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const a=new Ns(t.bounds,t.minzoom,t.maxzoom);return a.addExtraBounds(t.extra_bounds),a}}class jd extends s.E{constructor(t,a,h,g){if(super(),this.id=t,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.h(this,s.aF(a,["url","scheme","tileSize","promoteId"])),this._options=s.h({type:"vector"},a),this._collectResourceTiming=!!a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new s.aI}load(t){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map.getWorldview();this._tileJSONRequest=ls(this._options,this.map._requestManager,a,h,(g,_)=>{if(this._tileJSONRequest=null,this._loaded=!0,g)a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),h&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new s.z(g));else if(_){if(s.h(this,_),this.hasWorldviews=!!_.worldview_options,_.worldview_default&&(this.worldviewDefault=_.worldview_default),_.vector_layers){this.vectorLayers=_.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const w of _.vector_layers)this.vectorLayerIds.push(w.id),_.worldview&&_.worldview[w.source]&&this.localizableLayerIds.add(w.id)}this.tileBounds=Ns.fromTileJSON(_),gi(_.tiles,this.map._requestManager._customAccessToken),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}t&&t(g)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return s.h({},this._options)}loadTile(t,a){const h=t.tileID.canonical.url(this.tiles,this.scheme),g=this.map._requestManager.normalizeTileURL(h),_=this.map._requestManager.transformRequest(g,s.R.Tile),w=this.map.style?this.map.style.getLut(this.scope):null,T=w?{image:w.image.clone()}:null,C={request:_,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:T,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&s.j(h)&&(C.localizableLayerIds=this.localizableLayerIds),C.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=a:t.request=t.actor.send("reloadTile",C,R.bind(this));else if(t.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",C,R.bind(this),void 0,!0);else{const D=s.aJ.call({deduped:this._deduped},C,(z,k)=>{z||!k?R.call(this,z):(C.data={cacheControl:k.cacheControl,expires:k.expires,rawData:k.rawData.slice(0)},t.actor&&t.actor.send("loadTile",C,R.bind(this),void 0,!0))},!0);t.request={cancel:D}}function R(D,z){return delete t.request,t.aborted?a(null):D&&D.status!==404?a(D):(z&&z.resourceTiming&&(t.resourceTiming=z.resourceTiming),this.map._refreshExpiredTiles&&z&&t.setExpiryData(z),t.loadVectorData(z,this.map.painter),s.aK(this.dispatcher),a(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,a){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class gs extends s.E{constructor(t,a,h,g){super(),this.id=t,this.dispatcher=h,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.h({type:"raster"},a),s.h(this,s.aF(a,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"}));const a=this.map.getWorldview();this._tileJSONRequest=ls(this._options,this.map._requestManager,null,a,(h,g)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new s.z(h)):g&&(s.h(this,g),g.raster_layers&&(this.rasterLayers=g.raster_layers,this.rasterLayerIds=this.rasterLayers.map(_=>_.id)),this.tileBounds=Ns.fromTileJSON(g),gi(g.tiles),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(h)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return s.h({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,a){const h=s.q.devicePixelRatio>=2,g=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),h,this.tileSize);t.request=s.o(this.map._requestManager.transformRequest(g,s.R.Tile),(_,w,T,C)=>(delete t.request,t.aborted?(t.state="unloaded",a(null)):_?(t.state="errored",a(_)):w?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:T,expires:C}),t.setTexture(w,this.map.painter),t.state="loaded",s.aK(this.dispatcher),void a(null)):a(null)))}abortTile(t,a){t.request&&(t.request.cancel(),delete t.request),a&&a()}unloadTile(t,a){t.texture&&t.texture instanceof s.T?(t.destroy(!0),t.texture&&t.texture instanceof s.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),a&&a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Pl extends gs{constructor(t,a,h,g){super(t,a,h,g),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=s.h({type:"raster-array"},a)}triggerRepaint(t){const a=this.map.painter._terrain,h=this.map.style.getSourceCache(this.id);a&&a.enabled&&h&&a._clearRenderCacheForTile(h.id,t.tileID),this.map.triggerRepaint()}loadTile(t,a){const h=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),g=this.map._requestManager.transformRequest(h,s.R.Tile),_={request:g,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=g,t.actor||(t.actor=this.dispatcher.getActor());const w=(T,C,R,D)=>{if(delete t.request,t.aborted)return t.state="unloaded",a(null);if(T)return T.name==="AbortError"?void 0:(t.state="errored",a(T));if(this.map._refreshExpiredTiles&&C&&t.setExpiryData({cacheControl:R,expires:D}),this.partial)t.state="empty";else{if(!C)return a(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=C}a(null)};t.request=this.partial?t.fetchHeader(void 0,w.bind(this)):t.actor.send("loadTile",_,w.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,a){const h=t.texturePerLayer;if(t.flushAllQueues(),h.size){t.destroy(!0);for(const g of h.values())this.map.painter.saveTileTexture(g)}else t.destroy()}prepareTile(t,a,h,g){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(a,h,g,(_,w)=>{if(_)return t.state="errored",this.fire(new s.z(_)),void this.triggerRepaint(t);w&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(h,w,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const a=this.rasterLayers.find(({id:_})=>_===t),h=a&&a.fields,g=h&&h.bands&&h.bands;return g?g[0]:0}getTextureDescriptor(t,a,h){if(!t)return;const g=a.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!g)return;let _=null;a instanceof s.aN?_=a.paint.get("raster-array-band"):a instanceof s.aO&&(_=a.paint.get("raster-particle-array-band"));const w=_||this.getInitialBand(g);if(w==null)return;if(!t.textureDescriptorPerLayer.get(a.id))return void this.prepareTile(t,g,a.id,w);if(t.updateNeeded(a.id,w)&&!h)return;const T=t.textureDescriptorPerLayer.get(a.id);return Object.assign({},T,{texture:t.texturePerLayer.get(a.id)})}getImages(t,a){const h=new Map;for(const g of t)for(const _ of a){const[w,T]=_.split("/"),C=g.getLayer(w);if(!C||!C.hasBand(T)||!C.hasDataForBand(T))continue;const{bytes:R,tileSize:D,buffer:z}=C.getBandView(T),k=D+2*z,F={data:new s.r({width:k,height:k},R),pixelRatio:2,sdf:!1,usvg:!1,version:0};h.set(_,F)}return h}}const cf={vector:jd,raster:gs,"raster-dem":class extends gs{constructor(d,t,a,h){super(d,t,a,h),this.type="raster-dem",this.maxzoom=22,this._options=s.h({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(d,t){const a=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function h(g,_){g&&(d.state="errored",t(g)),_&&(d.dem=_,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",t(null))}d.request=s.o(this.map._requestManager.transformRequest(a,s.R.Tile),(function(g,_,w,T){if(delete d.request,d.aborted)d.state="unloaded",t(null);else if(g)d.state="errored",t(g);else if(_){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:w,expires:T});const C=ImageBitmap&&_ instanceof ImageBitmap&&s.t(),R=1-(_.width-s.aL(_.width))/2;R<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const D=C?_:s.q.getImageData(_,R),z={uid:d.uid,tileID:d.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:D,encoding:this.encoding,padding:R};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadTile",z,h.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(d){const t=d.canonical,a=Math.pow(2,t.z),h=(t.x-1+a)%a,g=t.x===0?d.wrap-1:d.wrap,_=(t.x+1+a)%a,w=t.x+1===a?d.wrap+1:d.wrap,T={};return T[new s.aM(d.overscaledZ,g,t.z,h,t.y).key]={backfilled:!1},T[new s.aM(d.overscaledZ,w,t.z,_,t.y).key]={backfilled:!1},t.y>0&&(T[new s.aM(d.overscaledZ,g,t.z,h,t.y-1).key]={backfilled:!1},T[new s.aM(d.overscaledZ,d.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},T[new s.aM(d.overscaledZ,w,t.z,_,t.y-1).key]={backfilled:!1}),t.y+1<a&&(T[new s.aM(d.overscaledZ,g,t.z,h,t.y+1).key]={backfilled:!1},T[new s.aM(d.overscaledZ,d.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},T[new s.aM(d.overscaledZ,w,t.z,_,t.y+1).key]={backfilled:!1}),T}},"raster-array":Pl,geojson:class extends s.E{constructor(d,t,a,h){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(h),this._data=t.data,this._options=s.h({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const g=s.aj/this.tileSize;this.workerOptions=s.h({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*g,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*g,extent:s.aj,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:s.aj,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*g,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}updateData(d){if(!this._options.dynamic)return this.fire(new s.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof d!="string"&&(d.type==="Feature"&&(d={type:"FeatureCollection",features:[d]}),d.type!=="FeatureCollection"))return this.fire(new s.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof d!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const a of this._data.features)t.set(a.id,a);for(const a of d.features)t.set(a.id,a);this._data.features=[...t.values()]}else this._data=d;return this._updateWorkerData(!0),this}getClusterExpansionZoom(d,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id,scope:this.scope},t),this}getClusterChildren(d,t){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id,scope:this.scope},t),this}getClusterLeaves(d,t,a,h){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:d,limit:t,offset:a},h),this}_updateWorkerData(d=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.A("dataloading",{dataType:"source"})),this._loaded=!1;const t=s.h({append:d},this.workerOptions);t.scope=this.scope;const a=this._data;typeof a=="string"?(t.request=this.map._requestManager.transformRequest(s.q.resolveURL(a),s.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(h,g)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new s.z(h));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(_.resourceTiming=g.resourceTiming[this.id]),d&&(this._partialReload=!0),this.fire(new s.A("data",_)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(d),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const d=s.C(this.id,this.scope);this.map.style.clearSource(d),this._updateWorkerData()}loadTile(d,t){const a=d.actor?"reloadTile":"loadTile";d.actor=this.actor;const h=this.map.style?this.map.style.getLut(this.scope):null,g=h?{image:h.image.clone()}:null,_=this._partialReload,w={type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:g,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:d.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:_,worldview:this.map.getWorldview()};d.request=this.actor.send(a,w,(T,C)=>_&&!C?(d.state="loaded",t(null)):(delete d.request,d.destroy(),d.aborted?t(null):T?t(T):(d.loadVectorData(C,this.map.painter,a==="reloadTile"),t(null))),void 0,a==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d,t){this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope}),d.destroy()}onRemove(d){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.h({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aP{constructor(d,t,a,h){super(d,t,a,h),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const t of d.urls)this.urls.push(this.map._requestManager.transformRequest(t,s.R.Source).url);s.aQ(this.urls,(t,a)=>{this._loaded=!0,t?this.fire(new s.z(t)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const t=this.video.seekable;d<t.start(0)||d>t.end(0)?this.fire(new s.z(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,t=d.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(d,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aP,model:class extends s.E{constructor(d,t,a,h){super(),this.id=d,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const d=[];for(const t in this._options.models){const a=this._options.models[t],h=s.aS(this.map._requestManager.transformRequest(a.uri,s.R.Model).url).then(g=>{if(!g)return;const _=s.aT(g),w=new s.aU(t,a.position,a.orientation,_);w.computeBoundsAndApplyParent(),this.models.push(w)}).catch(g=>{this.fire(new s.z(new Error(`Could not load model ${t} from ${a.uri}: ${g.message}`)))});d.push(h)}Promise.allSettled(d).then(()=>{this._loaded=!0,this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this._loaded=!0,this.fire(new s.z(new Error(`Could not load models: ${t.message}`)))})}onAdd(d){this.map=d,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(d,t){}serialize(){return this._options}},"batched-model":class extends s.E{constructor(d,t,a,h){super(),this.type="batched-model",this.id=d,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=a,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(h)}onAdd(d){this.map=d,this.load()}reload(){this.cancelTileJSONRequest();const d=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(d))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(d){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map.getWorldview();this._tileJSONRequest=ls(this._options,this.map._requestManager,t,a,(h,g)=>{this._tileJSONRequest=null,this._loaded=!0,h?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new s.z(h))):g&&(s.h(this,g),g.bounds&&(this.tileBounds=new Ns(g.bounds,this.minzoom,this.maxzoom)),gi(g.tiles,this.map._requestManager._customAccessToken),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))),d&&d(h)})}hasTransition(){return!1}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}loaded(){return this._loaded}loadTile(d,t){const a=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),h={request:this.map._requestManager.transformRequest(a,s.R.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:d.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:s.q.devicePixelRatio,promoteId:this.promoteId};if(d.actor&&d.state!=="expired")if(d.state==="loading")d.reloadCallback=t;else{if(d.buckets){const _=Object.values(d.buckets);for(const w of _)w.dirty=!0;return void(d.state="loaded")}d.request=d.actor.send("reloadTile",h,g.bind(this))}else d.actor=this.dispatcher.getActor(),d.request=d.actor.send("loadTile",h,g.bind(this),void 0,!0);function g(_,w){return d.aborted?t(null):_&&_.status!==404?t(_):(this.map._refreshExpiredTiles&&w&&d.setExpiryData(w),d.loadModelData(w,this.map.painter),d.state="loaded",void t(null))}}serialize(){return s.h({},this._options)}},canvas:class extends s.aP{constructor(d,t,a,h){super(d,t,a,h),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(_=>typeof _!="number"))||this.fire(new s.z(new s.V(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.z(new s.V(`sources.${d}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new s.z(new s.V(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new s.z(new s.V(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.z(new s.V(`sources.${d}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(d){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!d&&!this._playing||this.texture instanceof s.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends s.E{constructor(d,t,a,h){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=t,this.setEventedParent(h),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ns(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),s.h(this,s.aF(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this.map=d,this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:t,y:a,z:h}=d.canonical;return this._implementation.hasTile({x:t,y:a,z:h})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,t){const{x:a,y:h,z:g}=d.tileID.canonical,_=new AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:a,y:h,z:g},{signal:_.signal})).then((function(w){return delete d.request,d.aborted?(d.state="unloaded",t(null)):w===void 0?(d.state="errored",t(null)):w===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",t(null)):function(T){return T instanceof ImageData||T instanceof HTMLCanvasElement||T instanceof ImageBitmap||T instanceof HTMLImageElement}(w)?(this.loadTileData(d,w),d.state="loaded",void t(null)):(d.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(w=>{w.name!=="AbortError"&&(d.state="errored",t(w))}),d.request.cancel=()=>_.abort()}loadTileData(d,t){d.setTexture(t,this.map.painter)}unloadTile(d,t){if(d.texture&&d.texture instanceof s.T?(d.destroy(!0),d.texture&&d.texture instanceof s.T&&this.map.painter.saveTileTexture(d.texture)):d.destroy(),this._implementation.unloadTile){const{x:a,y:h,z:g}=d.tileID.canonical;this._implementation.unloadTile({x:a,y:h,z:g})}t&&t()}abortTile(d,t){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){const d=s.C(this.id,this.scope);this.map.style.clearSource(d)}_update(){this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}}},Bd=function(d,t,a,h){const g=new cf[t.type](d,t,a,h);if(g.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${g.id}`);return s.aV(["load","abort","unload","serialize","prepare"],g),g};function Vd(d,t,a=""){return`${a}:${t.id||""}:${t.layer.id}:${function(h){if("layerId"in h)return`layer:${h.layerId}`;{const{featuresetId:g,importId:_}=h;return`featureset:${g}${_?`:import:${_}`:""}`}}(d.target)}`}function uf(d,t,a,h=""){if(d.uniqueFeatureID){const g=Vd(d,t,h);if(a.has(g))return!0;a.add(g)}return!1}function df(d,t,a,h,g=!1){const _=t.sourceCache.transform,w=t.sourceCache.tilesIn(d,t.has3DLayers,g);w.sort(hf);const T=[];for(const C of w){const R=C.tile.queryRenderedFeatures(t,C,a,h,_,g);Object.keys(R).length&&T.push({wrappedTileID:C.tile.tileID.wrapped().key,queryResults:R})}return T.length===0?{}:function(C){const R={},D={};for(const z of C){const k=z.queryResults,F=z.wrappedTileID,q=D[F]=D[F]||{};for(const $ in k){const X=k[$],Z=q[$]=q[$]||{},ne=R[$]=R[$]||[];for(const ae of X)Z[ae.featureIndex]||(Z[ae.featureIndex]=!0,ne.push(ae))}}return R}(T)}function pc(d,t,a,h,g,_){const w={},T=h.queryRenderedSymbols(d),C=[];for(const R of Object.keys(T).map(Number))C.push(g[R]);C.sort(hf);for(const R of C){const D=R.featureIndex.lookupSymbolFeatures(T[R.bucketInstanceId],R.bucketIndex,R.sourceLayerIndex,t,a,_);for(const z in D){const k=w[z]=w[z]||[],F=D[z];F.sort((q,$)=>{const X=R.featureSortOrder;if(X){const Z=X.indexOf(q.featureIndex);return X.indexOf($.featureIndex)-Z}return $.featureIndex-q.featureIndex});for(const q of F)k.push(q)}}return w}function Ud(d,t){const a=d.getRenderableIds().map(_=>d.getTileByID(_)),h=[],g={};for(let _=0;_<a.length;_++){const w=a[_],T=w.tileID.canonical.key;g[T]||(g[T]=!0,w.querySourceFeatures(h,t))}return h}function hf(d,t){const a=d.tileID,h=t.tileID;return a.overscaledZ-h.overscaledZ||a.canonical.y-h.canonical.y||a.wrap-h.wrap||a.canonical.x-h.canonical.x}function fa(d,t){const a={};if(!t)return a;for(const h of d){const g=h.layerIds.map(_=>t.getLayer(_)).filter(Boolean);if(g.length!==0){h.layers=g,h.stateDependentLayerIds&&(h.stateDependentLayers=h.stateDependentLayerIds.map(_=>g.filter(w=>w.id===_)[0]));for(const _ of g)a[_.fqid]=h}}return a}const Po=32,Yo=33,Ya=new Uint16Array(8184);for(let d=0;d<2046;d++){let t=d+2,a=0,h=0,g=0,_=0,w=0,T=0;for(1&t?g=_=w=Po:a=h=T=Po;(t>>=1)>1;){const R=a+g>>1,D=h+_>>1;1&t?(g=a,_=h,a=w,h=T):(a=g,h=_,g=w,_=T),w=R,T=D}const C=4*d;Ya[C+0]=a,Ya[C+1]=h,Ya[C+2]=g,Ya[C+3]=_}const pa=new Uint16Array(2178),Ja=new Uint8Array(1089),Gd=new Uint16Array(1089);function Da(d){return d===0?-.03125:d===32?.03125:0}const $d={type:2,extent:s.aj,loadGeometry:()=>[[new s.P(0,0),new s.P(s.aj+1,0),new s.P(s.aj+1,s.aj+1),new s.P(0,s.aj+1),new s.P(0,0)]]};class mc{constructor(t,a,h,g,_,w){this.tileID=t,this.uid=s.a$(),this.uses=0,this.tileSize=a,this.tileZoom=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=_,g&&g.style&&(this._lastUpdatedBrightness=g.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",g&&g.transform&&(this.projection=g.transform.projection),this.worldview=w}registerFadeDuration(t){const a=t+this.timeAdded;a<s.q.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,a,h){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=fa(t.buckets,a.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const _=this.buckets[g];if(_ instanceof s.b1){if(this.hasSymbolBuckets=!0,!h)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const _=this.buckets[g];if(_ instanceof s.b1&&_.hasRTLText){this.hasRTLText=!0,s.b2();break}}this.queryPadding=0;for(const g in this.buckets){const _=this.buckets[g],w=a.style.getOwnLayer(g);if(!w)continue;const T=w.queryRadius(_);this.queryPadding=Math.max(this.queryPadding,T)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new s.b0}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,a,h){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,fa(t.buckets,a.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const g in this.buckets){const _=this.buckets[g];_.uploadPending()&&_.upload(t)}const a=t.gl,h=this.imageAtlas;h&&!h.uploaded&&(this.imageAtlasTexture=new s.T(t,h.image,a.RGBA8,{useMipmap:!!h.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(t,this.glyphAtlasImage,a.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(t,this.lineAtlas.image,a.R8),this.lineAtlas.uploaded=!0)}prepare(t,a,h){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,h),!a||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const g=a.style.getBrightness();(this._lastUpdatedBrightness||g)&&(this._lastUpdatedBrightness&&g&&Math.abs(this._lastUpdatedBrightness-g)<.001||(this.updateBuckets(a,this._lastUpdatedBrightness!==g),this._lastUpdatedBrightness=g))}queryRenderedFeatures(t,a,h,g,_,w){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const T=function(C,R){const D=s.bn([],[.5*C.width,.5*-C.height,1]);return s.bo(D,D,[1,-1,0]),s.az(D,D,C.calculateProjMatrix(R.toUnwrapped())),Float32Array.from(D)}(_,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:a,pixelPosMatrix:T,transform:g,availableImages:h,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(t,a){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const g=h.loadVTLayers(),_=a?a.sourceLayer:"",w=g._geojsonTileLayer||g[_];if(!w)return;const T=s.b3(a&&a.filter),{z:C,x:R,y:D}=this.tileID.canonical,z={z:C,x:R,y:D};for(let k=0;k<w.length;k++){const F=w.feature(k);if(T.needGeometry){const X=s.b4(F,!0);if(!T.filter(new s.aa(this.tileID.overscaledZ,{worldview:this.worldview}),X,this.tileID.canonical))continue}else if(!T.filter(new s.aa(this.tileID.overscaledZ,{worldview:this.worldview}),F))continue;const q=h.getId(F,_),$=new s.b5(F,C,R,D,q);$.tile=z,t.push($)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const h=s.b6(t.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const h=Date.now();let g=!1;if(this.expirationTime>h)g=!1;else if(a)if(this.expirationTime<a)g=!0;else{const _=this.expirationTime-a;_?this.expirationTime=h+Math.max(_,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,a){if(!this.latestFeatureIndex||!t.style)return;const h=this.latestFeatureIndex.loadVTLayers(),g=t.style.listImages(),_=t.style.getBrightness();for(const w in this.buckets){if(!t.style.hasLayer(w))continue;const T=this.buckets[w],C=T.layers[0],R=C.sourceLayer||"_geojsonTileLayer",D=h[R],z=t.style.getLayerSourceCache(C);let k={};z&&(k=z._state.getState(R,void 0));const F=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},q=Object.keys(k).length>0&&!a;q&&!T.stateDependentLayers.length&&!a||T.update(k,D,g,F,q?T.stateDependentLayers:T.layers,a,_),(T instanceof s.b7||T instanceof s.b8)&&t._terrain&&t._terrain.enabled&&z&&T.uploadPending()&&t._terrain._clearRenderCacheForTile(z.id,this.tileID);const $=t&&t.style&&t.style.getOwnLayer(w);$&&(this.queryPadding=Math.max(this.queryPadding,$.queryRadius(T)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=s.q.now()+t}setTexture(t,a){const h=a.context,g=h.gl;this.texture=this.texture||a.getTileTexture(t.width),this.texture&&this.texture instanceof s.T?this.texture.update(t):(this.texture=new s.T(h,t,g.RGBA8,{useMipmap:!0}),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE))}setDependencies(t,a){const h={};for(const g of a)h[g]=!0;this.dependencies[t]=h}hasDependency(t,a){for(const h of t){const g=this.dependencies[h];if(g){for(const _ of a)if(g[_])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,a){if(!a||a.name==="mercator"||this._tileDebugBuffer)return;const h=s.b9($d,this.tileID.canonical,this.tileTransform)[0],g=new s.ba,_=new s.bb;for(let w=0;w<h.length;w++){const{x:T,y:C}=h[w];g.emplaceBack(T,C),_.emplaceBack(w)}_.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(_),this._tileDebugBuffer=t.createVertexBuffer(g,s.bc.members),this._tileDebugSegments=s.bd.simpleSegment(0,0,g.length,_.length)}_makeTileBoundsBuffers(t,a){if(this._tileBoundsBuffer||!a||a.name==="mercator")return;const h=s.b9($d,this.tileID.canonical,this.tileTransform)[0];let g,_;if(this.isRaster){const w=function(T,C){const R=s.aW(T,C),D=Math.pow(2,T.z);for(let X=0;X<Yo;X++)for(let Z=0;Z<Yo;Z++){const ne=s.aX((T.x+(Z+Da(Z))/Po)/D),ae=s.aY((T.y+(X+Da(X))/Po)/D),de=C.project(ne,ae),_e=X*Yo+Z;pa[2*_e+0]=Math.round((de.x*R.scale-R.x)*s.aj),pa[2*_e+1]=Math.round((de.y*R.scale-R.y)*s.aj)}Ja.fill(0),Gd.fill(0);for(let X=2045;X>=0;X--){const Z=4*X,ne=Ya[Z+0],ae=Ya[Z+1],de=Ya[Z+2],_e=Ya[Z+3],be=ne+de>>1,Te=ae+_e>>1,ye=be+Te-ae,xe=Te+ne-be,ve=ae*Yo+ne,Oe=_e*Yo+de,Pe=Te*Yo+be,Ye=Math.hypot((pa[2*ve+0]+pa[2*Oe+0])/2-pa[2*Pe+0],(pa[2*ve+1]+pa[2*Oe+1])/2-pa[2*Pe+1])>=16;Ja[Pe]=Ja[Pe]||(Ye?1:0),X<1022&&(Ja[Pe]=Ja[Pe]||Ja[(ae+xe>>1)*Yo+(ne+ye>>1)]||Ja[(_e+xe>>1)*Yo+(de+ye>>1)])}const z=new s.aZ,k=new s.a_;let F=0;function q(X,Z){const ne=Z*Yo+X;return Gd[ne]===0&&(z.emplaceBack(pa[2*ne+0],pa[2*ne+1],X*s.aj/Po,Z*s.aj/Po),Gd[ne]=++F),Gd[ne]-1}function $(X,Z,ne,ae,de,_e){const be=X+ne>>1,Te=Z+ae>>1;if(Math.abs(X-de)+Math.abs(Z-_e)>1&&Ja[Te*Yo+be])$(de,_e,X,Z,be,Te),$(ne,ae,de,_e,be,Te);else{const ye=q(X,Z),xe=q(ne,ae),ve=q(de,_e);k.emplaceBack(ye,xe,ve)}}return $(0,0,Po,Po,Po,0),$(Po,Po,0,0,0,Po),{vertices:z,indices:k}}(this.tileID.canonical,a);g=w.vertices,_=w.indices}else{g=new s.aZ,_=new s.a_;for(const{x:T,y:C}of h)g.emplaceBack(T,C,0,0);const w=s.be(g.int16.subarray(0,4*g.length),void 0,4);for(let T=0;T<w.length;T+=3)_.emplaceBack(w[T],w[T+1],w[T+2])}this._tileBoundsBuffer=t.createVertexBuffer(g,s.bf.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(_),this._tileBoundsSegments=s.bd.simpleSegment(0,0,g.length,_.length)}_makeGlobeTileDebugBuffers(t,a){const h=a.projection;if(!h||h.name!=="globe"||a.freezeTileCoverage)return;const g=this.tileID.canonical,_=s.bg(g,a),w=s.bh(_),T=s.ah(a.zoom);let C;T>0&&(C=s.bi(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,g,a,w,C,T),this._makeGlobeTileDebugTextBuffer(t,g,a,w,C,T)}_globePoint(t,a,h,g,_,w,T){let C=s.bj(t,a,h);if(w){const R=1<<h.z,D=s.aD(g.center.lng),z=s.aH(g.center.lat),k=(h.x+.5)/R-D;let F=0;k>.5?F=-1:k<-.5&&(F=1);let q=(t/s.aj+h.x)/R+F,$=(a/s.aj+h.y)/R;q=(q-D)*g._pixelsPerMercatorPixel+D,$=($-z)*g._pixelsPerMercatorPixel+z;const X=[q*g.worldSize,$*g.worldSize,0];s.ad(X,X,w),C=s.bk(C,X,T)}return s.ad(C,C,_)}_makeGlobeTileDebugBorderBuffer(t,a,h,g,_,w){const T=new s.ba,C=new s.bb,R=new s.bl,D=(k,F,q,$,X)=>{const Z=(q-k)/(X-1),ne=($-F)/(X-1),ae=T.length;for(let de=0;de<X;de++){const _e=k+de*Z,be=F+de*ne;T.emplaceBack(_e,be);const Te=this._globePoint(_e,be,a,h,g,_,w);R.emplaceBack(Te[0],Te[1],Te[2]),C.emplaceBack(ae+de)}},z=s.aj;D(0,0,z,0,16),D(z,0,z,z,16),D(z,z,0,z,16),D(0,z,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(C),this._tileDebugBuffer=t.createVertexBuffer(T,s.bc.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(R,s.bm.members),this._tileDebugSegments=s.bd.simpleSegment(0,0,T.length,C.length)}_makeGlobeTileDebugTextBuffer(t,a,h,g,_,w){const T=s.aj/4,C=new s.ba,R=new s.a_,D=new s.bl,z=25;R.reserve(32),C.reserve(z),D.reserve(z);const k=(F,q)=>z*F+q;for(let F=0;F<z;F++){const q=F*T;for(let $=0;$<z;$++){const X=$*T;C.emplaceBack(X,q);const Z=this._globePoint(X,q,a,h,g,_,w);D.emplaceBack(Z[0],Z[1],Z[2])}}for(let F=0;F<4;F++)for(let q=0;q<4;q++){const $=k(F,q),X=k(F,q+1),Z=k(F+1,q),ne=k(F+1,q+1);R.emplaceBack($,X,Z),R.emplaceBack(Z,X,ne)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(R),this._tileDebugTextBuffer=t.createVertexBuffer(C,s.bc.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(D,s.bm.members),this._tileDebugTextSegments=s.bd.simpleSegment(0,0,z,32)}destroy(t=!1){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.bp.setPbf(s.bq);class nu extends mc{constructor(t,a,h,g,_){super(t,a,h,g,_),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexturePerLayer(t,a,h){const g=h.context,_=g.gl;let w=this.texturePerLayer.get(t)||h.getTileTexture(a.width);w&&w instanceof s.T?w.update(a,{premultiply:!1}):w=new s.T(g,a,_.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,w)}flushQueues(t){const a=this._workQueuePerLayer.get(t)||[],h=this._fetchQueuePerLayer.get(t)||[];for(;a.length;)a.pop()();for(;h.length;)h.pop()()}flushAllQueues(){for(const t of this._workQueuePerLayer.keys()){const a=this._workQueuePerLayer.get(t)||[];for(;a.length;)a.pop()()}for(const t of this._fetchQueuePerLayer.keys()){const a=this._fetchQueuePerLayer.get(t)||[];for(;a.length;)a.pop()()}}fetchHeader(t=16384,a){const h=this._mrt=new s.bp(30),g=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=s.br(g,(_,w,T,C)=>{if(_)a(_);else try{const R=h.getHeaderLength(w);if(R>t)return void(this.request=this.fetchHeader(R,a));h.parseHeader(w),this._isHeaderLoaded=!0;let D=0;for(const z of Object.values(h.layers))D=Math.max(D,z.dataIndex[z.dataIndex.length-1].lastByte);w.byteLength>=D&&(this.entireBuffer=w),a(null,this.entireBuffer||w,T,C)}catch(R){a(R)}}),this.request}fetchBand(t,a,h,g){const _=this._mrt;if(!this._isHeaderLoaded||!_)return void g(new Error("Tile header is not ready"));const w=this.actor;if(!w)return void g(new Error("Can't fetch tile band without an actor"));let T;const C=(k,F)=>{if(T.complete(k,F),k)return void g(k);this.updateTextureDescriptor(t,a,h);const q=this.textureDescriptorPerLayer.get(a);g(null,q&&q.img)},R=(k,F)=>{if(k)return g(k);const q=w.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:F,task:T},C,void 0,!0),$=this._workQueuePerLayer.get(a)||[];$.push(()=>{q&&q.cancel(),T.cancel()}),this._workQueuePerLayer.has(a)||this._workQueuePerLayer.set(a,$)},D=_.getLayer(t);if(!D)return void g(new Error(`Unknown sourceLayer "${t}"`));if(D.hasDataForBand(h)){this.updateTextureDescriptor(t,a,h);const k=this.textureDescriptorPerLayer.get(a);return void g(null,k?k.img:null)}const z=D.getDataRange([h]);if(T=_.createDecodingTask(z),!T||T.tasks.length)if(this.flushQueues(a),this.entireBuffer)R(null,this.entireBuffer.slice(z.firstByte,z.lastByte+1));else{const k=Object.assign({},this.requestParams,{headers:{Range:`bytes=${z.firstByte}-${z.lastByte}`}}),F=s.br(k,R),q=this._fetchQueuePerLayer.get(a)||[];q.push(()=>{F.cancel(),T.cancel()}),this._fetchQueuePerLayer.has(a)||this._fetchQueuePerLayer.set(a,q)}else g(null)}updateNeeded(t,a){return(!this.textureDescriptorPerLayer.get(t)||this.textureDescriptorPerLayer.get(t).band!==a)&&this.state!=="errored"}updateTextureDescriptor(t,a,h){if(!this._mrt)return;const g=this._mrt.getLayer(t);if(!g||!g.hasBand(h)||!g.hasDataForBand(h))return;const{bytes:_,tileSize:w,buffer:T,offset:C,scale:R}=g.getBandView(h),D=w+2*T,z=new s.r({width:D,height:D},_),k=this.texturePerLayer.get(a);k&&k instanceof s.T&&k.update(z,{premultiply:!1}),this.textureDescriptorPerLayer.set(a,{layer:t,band:h,img:z,buffer:T,offset:C,tileSize:w,format:g.pixelFormat,mix:[R,256*R,65536*R,16777216*R]})}destroy(t=!1){if(super.destroy(t),delete this._mrt,!t)for(const a of this.texturePerLayer.values())a&&a instanceof s.T&&a.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Nm{constructor(t,a){this.max=t,this.onRemove=a,this.reset()}reset(){for(const t in this.data)for(const a of this.data[t])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(t,a,h){const g=t.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const _={value:a,timeout:void 0};if(h!==void 0&&(_.timeout=setTimeout(()=>{this.remove(t,_)},h)),this.data[g].push(_),this.order.push(g),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const a=this.data[t].shift();return a.timeout&&clearTimeout(a.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),a.value}getByKey(t){const a=this.data[t];return a?a[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,a){if(!this.has(t))return this;const h=t.wrapped().key,g=a===void 0?0:this.data[h].indexOf(a),_=this.data[h][g];return this.data[h].splice(g,1),_.timeout&&clearTimeout(_.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(_.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(t){const a=[];for(const h in this.data)for(const g of this.data[h])t(g.value)||a.push(g);for(const h of a)this.remove(h.value.tileID,h)}}class Lm{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,h){const g=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][g]=this.stateChanges[t][g]||{},s.h(this.stateChanges[t][g],h),this.deletedStates[t]===null){this.deletedStates[t]={};for(const _ in this.state[t])_!==g&&(this.deletedStates[t][_]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][g]===null){this.deletedStates[t][g]={};for(const _ in this.state[t][g])h[_]||(this.deletedStates[t][g][_]=null)}else for(const _ in h)this.deletedStates[t]&&this.deletedStates[t][g]&&this.deletedStates[t][g][_]===null&&delete this.deletedStates[t][g][_]}removeFeatureState(t,a,h){if(this.deletedStates[t]===null)return;const g=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},h&&a!==void 0)this.deletedStates[t][g]!==null&&(this.deletedStates[t][g]=this.deletedStates[t][g]||{},this.deletedStates[t][g][h]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][g])for(h in this.deletedStates[t][g]={},this.stateChanges[t][g])this.deletedStates[t][g][h]=null;else this.deletedStates[t][g]=null;else this.deletedStates[t]=null}getState(t,a){const h=this.state[t]||{},g=this.stateChanges[t]||{},_=this.deletedStates[t];if(_===null)return{};if(a!==void 0){const T=String(a),C=s.h({},h[T],g[T]);if(_){const R=_[a];if(R===null)return{};for(const D in R)delete C[D]}return C}const w=s.h({},h,g);if(_)for(const T in _)delete w[T];return w}initializeTileState(t,a){t.refreshFeatureState(a)}coalesceChanges(t,a){const h={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const _={};for(const w in this.stateChanges[g])this.state[g][w]||(this.state[g][w]={}),s.h(this.state[g][w],this.stateChanges[g][w]),_[w]=this.state[g][w];h[g]=_}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const _={};if(this.deletedStates[g]===null)for(const w in this.state[g])_[w]={},this.state[g][w]={};else for(const w in this.deletedStates[g]){if(this.deletedStates[g][w]===null)this.state[g][w]={};else if(this.state[g][w])for(const T of Object.keys(this.deletedStates[g][w]))delete this.state[g][w][T];_[w]=this.state[g][w]}h[g]=h[g]||{},s.h(h[g],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const g in t)t[g].refreshFeatureState(a)}}class so extends s.E{constructor(t,a,h){super(),this.id=t,this._onlySymbols=h,a.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new Nm(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Lm,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,a){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,a)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const h=this._tiles[a];h.upload(t),h.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(gc).map(t=>t.key)}getRenderableIds(t,a){const h=[];for(const g in this._tiles)this._isIdRenderable(+g,t,a)&&h.push(this._tiles[g]);return t?h.sort((g,_)=>{const w=g.tileID,T=_.tileID,C=new s.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),R=new s.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-T.overscaledZ||R.y-C.y||R.x-C.x}).map(g=>g.tileID.key):h.map(g=>g.tileID).sort(gc).map(g=>g.key)}hasRenderableParent(t){const a=this.findLoadedParent(t,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(t,a,h){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(a||!this._tiles[t].holdingForFade())&&(h||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,a){const h=this._tiles[t];h&&(h.state!=="loading"&&(h.state=a),this._loadTile(h,this._tileLoaded.bind(this,h,t,a)))}_tileLoaded(t,a,h,g){if(g)if(t.state="errored",g.status!==404)this._source.fire(new s.z(g,{tile:t}));else{if(this._source.fire(new s.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const _=this.map.painter.terrain;this.update(this.transform,_.getScaledDemTileSize(),!0),_.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=s.q.now(),h==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new s.A("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const a=this.getRenderableIds();for(let g=0;g<a.length;g++){const _=a[g];if(t.neighboringTiles&&t.neighboringTiles[_]){const w=this.getTileByID(_);h(t,w),h(w,t)}}function h(g,_){if(!g.dem||g.dem.borderReady)return;g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0;let w=_.tileID.canonical.x-g.tileID.canonical.x;const T=_.tileID.canonical.y-g.tileID.canonical.y,C=Math.pow(2,g.tileID.canonical.z),R=_.tileID.key;w===0&&T===0||Math.abs(T)>1||(Math.abs(w)>1&&(Math.abs(w+C)===1?w+=C:Math.abs(w-C)===1&&(w-=C)),_.dem&&g.dem&&(g.dem.backfillBorder(_.dem,w,T),g.neighboringTiles&&g.neighboringTiles[R]&&(g.neighboringTiles[R].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,a,h,g){for(const _ in this._tiles){let w=this._tiles[_];if(g[_]||!w.hasData()||w.tileID.overscaledZ<=a||w.tileID.overscaledZ>h)continue;let T=w.tileID;for(;w&&w.tileID.overscaledZ>a+1;){const R=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[R.key],w&&w.hasData()&&(T=R)}let C=T;for(;C.overscaledZ>a;)if(C=C.scaledTo(C.overscaledZ-1),t[C.key]){g[T.key]=T;break}}}findLoadedParent(t,a){if(t.key in this._loadedParentTiles){const h=this._loadedParentTiles[t.key];return h&&h.tileID.overscaledZ>=a?h:null}for(let h=t.overscaledZ-1;h>=a;h--){const g=t.scaledTo(h),_=this._getLoadedTile(g);if(_)return _}}_getLoadedTile(t){const a=this._tiles[t.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,a){a=a||this._source.tileSize;const h=Math.ceil(t.width/a)+1,g=Math.ceil(t.height/a)+1,_=Math.floor(h*g*5),w=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,_):_,T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(T)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,a){const h={};for(const g in this._tiles){const _=this._tiles[g];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+a),h[_.tileID.key]=_}this._tiles=h;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(+g,this._tiles[g])}}update(t,a,h,g,_){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!h)return;this.updateCacheSize(t,a),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const w=this._source.type==="batched-model";let T,C=this._source.maxzoom;const R=this.map&&this.map.painter?this.map.painter._terrain:null;if(R&&R.sourceCache===this&&R.attenuationRange()){const k=R.attenuationRange()[0],F=Math.floor(k)-Math.log2(R.getDemUpscale());C>F&&(C=F)}if(this.used||this.usedForTerrain){if(this._source.tileID)T=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(k=>new s.aM(k.canonical.z,k.wrap,k.canonical.z,k.canonical.x,k.canonical.y));else if(this.tileCoverLift!==0){const k=t.clone();k.tileCoverLift=this.tileCoverLift,T=k.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.minzoom<=1&&t.projection.name==="globe"&&(T.push(new s.aM(1,0,1,0,0)),T.push(new s.aM(1,0,1,1,0)),T.push(new s.aM(1,0,1,0,1)),T.push(new s.aM(1,0,1,1,1)))}else if(T=t.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.hasTile){const k=this._source.hasTile.bind(this._source);T=T.filter(F=>k(F))}}else T=[];if(T.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Hd(this._source.type)){const k=t.coveringZoomLevel({tileSize:a||this._source.tileSize,roundZoom:this._source.roundZoom&&!h}),F=Math.min(k,this._source.maxzoom);if(w){const q=t.extendTileCover(T,F);for(const $ of q)T.push($)}else if(_){const q=t.extendTileCoverToNearPlane(T,this.transform.getFrustum(F),F);for(const $ of q)T.push($)}else if(this.castsShadows&&g){const q=t.extendTileCover(T,F,g);for(const $ of q)this._shadowCasterTiles[$.key]=!0,T.push($)}}const D=this._updateRetainedTiles(T);if(Hd(this._source.type)&&T.length!==0){const k={},F={},q=Object.keys(D);for(const X of q){const Z=D[X],ne=this._tiles[X];if(!ne||ne.fadeEndTime&&ne.fadeEndTime<=s.q.now())continue;const ae=this.findLoadedParent(Z,Math.max(Z.overscaledZ-so.maxOverzooming,this._source.minzoom));ae&&(this._addTile(ae.tileID),k[ae.tileID.key]=ae.tileID),F[X]=Z}const $=T[T.length-1].overscaledZ;for(const X in this._tiles){const Z=this._tiles[X];if(D[X]||!Z.hasData())continue;let ne=Z.tileID;for(;ne.overscaledZ>$;){ne=ne.scaledTo(ne.overscaledZ-1);const ae=this._tiles[ne.key];if(ae&&ae.hasData()&&F[ne.key]){D[X]=Z.tileID;break}}}for(const X in k)D[X]||(this._coveredTiles[X]=!0,D[X]=k[X])}for(const k in D)this._tiles[k].clearFadeHold();const z=s.bs(this._tiles,D);for(const k of z){const F=this._tiles[k];F.hasSymbolBuckets&&!F.holdingForFade()?F.setHoldDuration(this.map._fadeDuration):F.hasSymbolBuckets&&!F.symbolFadeFinished()||this._removeTile(+k)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const a={};if(t.length===0)return a;const h={},g=t.reduce((R,D)=>Math.min(R,D.overscaledZ),1/0),_=t[0].overscaledZ,w=Math.max(_-so.maxOverzooming,this._source.minzoom),T=Math.max(_+so.maxUnderzooming,this._source.minzoom),C={};for(const R of t){const D=this._addTile(R);a[R.key]=R,D.hasData()||g<this._source.maxzoom&&(C[R.key]=R)}this._retainLoadedChildren(C,g,T,a);for(const R of t){let D=this._tiles[R.key];if(D.hasData())continue;if(R.canonical.z>=this._source.maxzoom){const k=R.children(this._source.maxzoom)[0],F=this.getTile(k);if(F&&F.hasData()){a[k.key]=k;continue}}else{const k=R.children(this._source.maxzoom);if(a[k[0].key]&&a[k[1].key]&&a[k[2].key]&&a[k[3].key])continue}let z=D.wasRequested();for(let k=R.overscaledZ-1;k>=w;--k){const F=R.scaledTo(k);if(h[F.key]||(h[F.key]=!0,D=this.getTile(F),!D&&z&&(D=this._addTile(F)),D&&(a[F.key]=F,z=D.wasRequested(),D.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const a=[];let h,g=this._tiles[t].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){h=this._loadedParentTiles[g.key];break}a.push(g.key);const _=g.scaledTo(g.overscaledZ-1);if(h=this._getLoadedTile(_),h)break;g=_}for(const _ of a)this._loadedParentTiles[_]=h}}_addTile(t){let a=this._tiles[t.key];if(a)return a.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),a;a=this._cache.getAndRemove(t),a&&(this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,a)));const h=!!a;if(!h){const g=this.map?this.map.painter:null,_=this._source.tileSize*t.overscaleFactor();a=this._source.type==="raster-array"?new nu(t,_,this.transform.tileZoom,g,this._isRaster):new mc(t,_,this.transform.tileZoom,g,this._isRaster,this._source.worldview),this._loadTile(a,this._tileLoaded.bind(this,a,t.key,a.state))}return a.uses++,this._tiles[t.key]=a,h||this._source.fire(new s.A("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const h=a.getExpiryTimeout();h&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},h))}_removeTile(t){const a=this._tiles[t];a&&(a.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),a.uses>0||(a.hasData()&&a.state!=="reloading"||a.state==="empty"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,a,h){const g=[],_=this.transform;if(!_)return g;const w=_.projection.name==="globe",T=s.aD(_.center.lng);for(const C in this._tiles){const R=this._tiles[C];if(h&&R.clearQueryDebugViz(),R.holdingForFade())continue;let D;if(w){const z=R.tileID.canonical;if(z.z===0){const k=[Math.abs(s.ay(T,...ru(z,-1))-T),Math.abs(s.ay(T,...ru(z,1))-T)];D=[0,2*k.indexOf(Math.min(...k))-1]}else{const k=[Math.abs(s.ay(T,...ru(z,-1))-T),Math.abs(s.ay(T,...ru(z,0))-T),Math.abs(s.ay(T,...ru(z,1))-T)];D=[k.indexOf(Math.min(...k))-1]}}else D=[0];for(const z of D){const k=t.containsTile(R,_,a,z);k&&g.push(k)}}return g}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,a){const h=this.getRenderableIds(t,a).map(_=>this._tiles[_].tileID),g=this.transform.projection.name==="globe";for(const _ of h)_.projMatrix=this.transform.calculateProjMatrix(_.toUnwrapped()),_.expandedProjMatrix=g?this.transform.calculateProjMatrix(_.toUnwrapped(),!1,!0):_.projMatrix;return h}sortCoordinatesByDistance(t){const a=t.slice(),h=this.transform._camera.position,g=this.transform._camera.forward(),_={};for(const w of a){const T=1/(1<<w.canonical.z);_[w.key]=((w.canonical.x+.5)*T+w.wrap-h[0])*g[0]+((w.canonical.y+.5)*T-h[1])*g[1]-h[2]*g[2]}return a.sort((w,T)=>_[w.key]-_[T.key]),a}hasTransition(){if(this._source.hasTransition())return!0;if(Hd(this._source.type))for(const t in this._tiles){const a=this._tiles[t];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=s.q.now())return!0}return!1}setFeatureState(t,a,h){this._state.updateState(t=t||"_geojsonTileLayer",a,h)}removeFeatureState(t,a,h){this._state.removeFeatureState(t=t||"_geojsonTileLayer",a,h)}getFeatureState(t,a){return this._state.getState(t=t||"_geojsonTileLayer",a)}setDependencies(t,a,h){const g=this._tiles[t];g&&g.setDependencies(a,h)}reloadTilesForDependencies(t,a){for(const h in this._tiles)this._tiles[h].hasDependency(t,a)&&this._reloadTile(+h,"reloading");this._cache.filter(h=>!h.hasDependency(t,a))}_preloadTiles(t,a){if(!this._sourceLoaded){const C=()=>{this._sourceLoaded&&(this._source.off("data",C),this._preloadTiles(t,a))};return void this._source.on("data",C)}const h=new Map,g=Array.isArray(t)?t:[t],_=this.map.painter.terrain,w=this.usedForTerrain&&_?_.getScaledDemTileSize():this._source.tileSize;for(const C of g){const R=C.coveringTiles({tileSize:w,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const D of R)h.set(D.key,D);this.usedForTerrain&&C.updateElevation(!1)}const T=Array.from(h.values());s.bt(T,(C,R)=>{const D=new mc(C,this._source.tileSize*C.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(D,z=>{this._source.type==="raster-dem"&&D.dem&&this._backfillDEM(D),R(z,D)})},a)}}function gc(d,t){const a=Math.abs(2*d.wrap)-+(d.wrap<0),h=Math.abs(2*t.wrap)-+(t.wrap<0);return d.overscaledZ-t.overscaledZ||h-a||t.canonical.y-d.canonical.y||t.canonical.x-d.canonical.x}function Hd(d){return d==="raster"||d==="image"||d==="video"||d==="custom"}function ru(d,t){const a=1<<d.z;return[d.x/a+t,(d.x+1)/a+t]}so.maxOverzooming=10,so.maxUnderzooming=3;class sx{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,a=!1;for(const h in this.style._mergedLayers){const g=this.style._mergedLayers[h];if(g.type==="fill-extrusion"||g.type==="building")this.layers.push({layer:g,visible:t,visibilityChanged:a});else if(g.type==="model"){const _=this.style.getLayerSource(g);_&&_.type==="batched-model"&&this.layers.push({layer:g,visible:t,visibilityChanged:a})}}}onNewFrame(t){this.layersGotHidden=!1;for(const a of this.layers){const h=a.layer;let g=!1;h.type==="fill-extrusion"?g=!h.isHidden(t)&&h.paint.get("fill-extrusion-opacity")>0:h.type==="building"?g=!h.isHidden(t)&&h.paint.get("building-opacity")>0:h.type==="model"&&(g=!h.isHidden(t)&&h.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!g&&a.visible,a.visible=g}}updateZOffset(t,a){this.currentBuildingBuckets=[];for(const g of this.layers){const _=g.layer,w=this.style.getLayerSourceCache(_);let T=1;_.type==="fill-extrusion"?T=g.visible?_.paint.get("fill-extrusion-vertical-scale"):0:_.type==="building"&&(T=g.visible?_.paint.get("building-vertical-scale"):0);let C=w?w.getTile(a):null;if(!C&&w)for(const R in w._tiles){const D=w._tiles[R];if(a.canonical.isChildOf(D.tileID.canonical)){C=D;break}}this.currentBuildingBuckets.push({bucket:C?C.getBucket(_):null,tileID:C?C.tileID:a,verticalScale:T})}t.hasAnyZOffset=!1;let h=!1;for(let g=0;g<t.symbolInstances.length;g++){const _=t.symbolInstances.get(g),w=_.zOffset,T=this._getHeightAtTileOffset(a,_.tileAnchorX,_.tileAnchorY);_.zOffset=T!==Number.NEGATIVE_INFINITY?T:w,h||w===_.zOffset||(h=!0),t.hasAnyZOffset||_.zOffset===0||(t.hasAnyZOffset=!0)}h&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,a,h,g){let _=a,w=h;if(t.canonical.z!==g.canonical.z){const T=g.canonical,C=1/(1<<t.canonical.z-T.z);_=(a+t.canonical.x*s.aj)*C-T.x*s.aj|0,w=(h+t.canonical.y*s.aj)*C-T.y*s.aj|0}return{tileX:_,tileY:w}}_getHeightAtTileOffset(t,a,h){let g,_;for(let w=0;w<this.layers.length;++w){const T=this.layers[w].layer;if(T.type!=="fill-extrusion"&&T.type!=="building")continue;const{bucket:C,tileID:R,verticalScale:D}=this.currentBuildingBuckets[w];if(!C)continue;const{tileX:z,tileY:k}=this._mapCoordToOverlappingTile(t,a,h,R),F=C.getHeightAtTileCoord(z,k);F&&F.height!==void 0&&(F.hidden?g=F.height:_=Math.max(F.height*D,_||0))}if(_!==void 0)return _;for(let w=0;w<this.layers.length;++w){const T=this.layers[w];if(T.layer.type!=="model"||!T.visible)continue;const{bucket:C,tileID:R}=this.currentBuildingBuckets[w];if(!C)continue;const{tileX:D,tileY:z}=this._mapCoordToOverlappingTile(t,a,h,R),k=C.getHeightAtTileCoord(D,z);if(k&&!k.hidden)return k.height===void 0&&g!==void 0?Math.min(k.maxHeight,g)*k.verticalScale:k.height?k.height*k.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function ox(d,t){const a={};for(const h in d)h!=="ref"&&(a[h]=d[h]);return s.bu.forEach(h=>{h in t&&(a[h]=t[h])}),a}function qd(d){d=d.slice();const t=Object.create(null);for(let a=0;a<d.length;a++)t[d[a].id]=d[a];for(let a=0;a<d.length;a++)"ref"in d[a]&&(d[a]=ox(d[a],t[d[a].ref]));return d}const ln={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function ff(d,t,a){a.push({command:ln.addSource,args:[d,t[d]]})}function su(d,t,a){t.push({command:ln.removeSource,args:[d]}),a[d]=!0}function Wd(d,t,a,h){su(d,a,h),ff(d,t,a)}function Uw(d,t,a){let h;for(h in d[a])if(d[a].hasOwnProperty(h)&&h!=="data"&&!s.bv(d[a][h],t[a][h]))return!1;for(h in t[a])if(t[a].hasOwnProperty(h)&&h!=="data"&&!s.bv(d[a][h],t[a][h]))return!1;return!0}function Zd(d,t,a,h,g,_){let w;for(w in t=t||{},d=d||{})d.hasOwnProperty(w)&&(s.bv(d[w],t[w])||a.push({command:_,args:[h,w,t[w],g]}));for(w in t)t.hasOwnProperty(w)&&!d.hasOwnProperty(w)&&(s.bv(d[w],t[w])||a.push({command:_,args:[h,w,t[w],g]}))}function _c(d){return d.id}function Ml(d,t){return d[t.id]=t,d}function Xd(d,t,a){const h=t.createTileMatrix(d,d.worldSize,a.toUnwrapped());return s.az(new Float32Array(16),d.projMatrix,h)}function ax(d,t,a){if(t.projection.name===a.projection.name)return d.projMatrix;const h=a.clone();return h.setProjection(t.projection),Xd(h,t.getProjection(),d)}function pf(d,t,a){return t.name===a.projection.name?d.projMatrix:Xd(a,t,d)}class lx{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=s.ay(t,0,1);let a=1,h=this._distances[a];const g=t*this.paddedLength+this.padding;for(;h<g&&a<this._distances.length;)h=this._distances[++a];const _=a-1,w=this._distances[_],T=h-w,C=T>0?(g-w)/T:0;return this.points[_].mult(1-C).add(this.points[a].mult(C))}}class ou{constructor(t,a,h){const g=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/h),this.yCellCount=Math.ceil(a/h);for(let w=0;w<this.xCellCount*this.yCellCount;w++)g.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,h,g,_){this._forEachCell(a,h,g,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(_)}insertCircle(t,a,h,g){this._forEachCell(a-g,h-g,a+g,h+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(h),this.circles.push(g)}_insertBoxCell(t,a,h,g,_,w){this.boxCells[_].push(w)}_insertCircleCell(t,a,h,g,_,w){this.circleCells[_].push(w)}_query(t,a,h,g,_,w){if(h<0||t>this.width||g<0||a>this.height)return!_&&[];const T=[];if(t<=0&&a<=0&&this.width<=h&&this.height<=g){if(_)return!0;for(let C=0;C<this.boxKeys.length;C++)T.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const R=this.circles[3*C],D=this.circles[3*C+1],z=this.circles[3*C+2];T.push({key:this.circleKeys[C],x1:R-z,y1:D-z,x2:R+z,y2:D+z})}return w?T.filter(w):T}return this._forEachCell(t,a,h,g,this._queryCell,T,{hitTest:_,seenUids:{box:{},circle:{}}},w),_?T.length>0:T}_queryCircle(t,a,h,g,_){const w=t-h,T=t+h,C=a-h,R=a+h;if(T<0||w>this.width||R<0||C>this.height)return!g&&[];const D=[];return this._forEachCell(w,C,T,R,this._queryCellCircle,D,{hitTest:g,circle:{x:t,y:a,radius:h},seenUids:{box:{},circle:{}}},_),g?D.length>0:D}query(t,a,h,g,_){return this._query(t,a,h,g,!1,_)}hitTest(t,a,h,g,_){return this._query(t,a,h,g,!0,_)}hitTestCircle(t,a,h,g){return this._queryCircle(t,a,h,!0,g)}_queryCell(t,a,h,g,_,w,T,C){const R=T.seenUids,D=this.boxCells[_];if(D!==null){const k=this.bboxes;for(const F of D)if(!R.box[F]){R.box[F]=!0;const q=4*F;if(t<=k[q+2]&&a<=k[q+3]&&h>=k[q+0]&&g>=k[q+1]&&(!C||C(this.boxKeys[F]))){if(T.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[F],x1:k[q],y1:k[q+1],x2:k[q+2],y2:k[q+3]})}}}const z=this.circleCells[_];if(z!==null){const k=this.circles;for(const F of z)if(!R.circle[F]){R.circle[F]=!0;const q=3*F;if(this._circleAndRectCollide(k[q],k[q+1],k[q+2],t,a,h,g)&&(!C||C(this.circleKeys[F]))){if(T.hitTest)return w.push(!0),!0;{const $=k[q],X=k[q+1],Z=k[q+2];w.push({key:this.circleKeys[F],x1:$-Z,y1:X-Z,x2:$+Z,y2:X+Z})}}}}}_queryCellCircle(t,a,h,g,_,w,T,C){const R=T.circle,D=T.seenUids,z=this.boxCells[_];if(z!==null){const F=this.bboxes;for(const q of z)if(!D.box[q]){D.box[q]=!0;const $=4*q;if(this._circleAndRectCollide(R.x,R.y,R.radius,F[$+0],F[$+1],F[$+2],F[$+3])&&(!C||C(this.boxKeys[q])))return w.push(!0),!0}}const k=this.circleCells[_];if(k!==null){const F=this.circles;for(const q of k)if(!D.circle[q]){D.circle[q]=!0;const $=3*q;if(this._circlesCollide(F[$],F[$+1],F[$+2],R.x,R.y,R.radius)&&(!C||C(this.circleKeys[q])))return w.push(!0),!0}}}_forEachCell(t,a,h,g,_,w,T,C){const R=this._convertToXCellCoord(t),D=this._convertToYCellCoord(a),z=this._convertToXCellCoord(h),k=this._convertToYCellCoord(g);for(let F=R;F<=z;F++)for(let q=D;q<=k;q++)if(_.call(this,t,a,h,g,this.xCellCount*q+F,w,T,C))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,h,g,_,w){const T=g-t,C=_-a,R=h+w;return R*R>T*T+C*C}_circleAndRectCollide(t,a,h,g,_,w,T){const C=(w-g)/2,R=Math.abs(t-(g+C));if(R>C+h)return!1;const D=(T-_)/2,z=Math.abs(a-(_+D));if(z>D+h)return!1;if(R<=C||z<=D)return!0;const k=R-C,F=z-D;return k*k+F*F<=h*h}}const yc={unknown:0,flipRequired:1,flipNotRequired:2},cx=Math.tan(85*Math.PI/180);function Kd(d,t,a,h,g,_,w){const T=s.bz();if(a)if(_.name==="globe"){const C=s.bA(g,t);s.az(T,T,C)}else{const C=s.bB([],w);T[0]=C[0],T[1]=C[1],T[4]=C[2],T[5]=C[3],h||s.by(T,T,g.angle)}else s.az(T,g.labelPlaneMatrix,d);return T}function au(d,t,a,h,g,_,w){const T=Kd(d,t,a,h,g,_,w);return _.name==="globe"&&a||(T[2]=T[6]=T[10]=T[14]=0),T}function Qa(d,t,a,h,g,_,w){if(a){if(_.name==="globe"){const T=Kd(d,t,a,h,g,_,w);return s.bi(T,T),s.az(T,d,T),T}{const T=s.bw(d),C=s.bx([]);return C[0]=w[0],C[1]=w[1],C[4]=w[2],C[5]=w[3],s.az(T,T,C),h||s.by(T,T,-g.angle),T}}return g.glCoordMatrix}function Mo(d,t,a,h){const g=[d,t,a,1];a?s.aA(g,g,h):ux(g,g,h);const _=g[3];return g[0]/=_,g[1]/=_,g[2]/=_,g}function zm(d,t){return Math.min(.5+d/t*.5,1.5)}function Om(d,t){const a=d[0]/d[3],h=d[1]/d[3];return a>=-t[0]&&a<=t[0]&&h>=-t[1]&&h<=t[1]}function xc(d,t,a,h,g,_,w,T,C,R){const D=a.transform,z=h?d.textSizeData:d.iconSizeData,k=s.bH(z,a.transform.zoom),F=D.projection.name==="globe",q=[256/a.width*2+1,256/a.height*2+1],$=h?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;$.clear();let X=null;F&&(X=h?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);const Z=d.lineVertexArray,ne=h?d.text.placedSymbolArray:d.icon.placedSymbolArray,ae=a.transform.width/a.transform.height;let de,_e=!1;for(let be=0;be<ne.length;be++){const Te=ne.get(be),{numGlyphs:ye,writingMode:xe}=Te;if(xe!==s.bI.vertical||_e||de===s.bI.horizontal||(_e=!0),de=xe,(Te.hidden||xe===s.bI.vertical)&&!_e){lu(ye,$);continue}_e=!1;const ve=new s.P(Te.tileAnchorX,Te.tileAnchorY);let{x:Oe,y:Pe,z:Ye}=D.projection.projectTilePoint(ve.x,ve.y,R.canonical);if(C){const[Ht,Qt,Lt]=C(ve);Oe+=Ht,Pe+=Qt,Ye+=Lt}const Ue=[Oe,Pe,Ye,1];if(s.aA(Ue,Ue,t),!Om(Ue,q)){lu(ye,$);continue}const Qe=Ue[3],_t=zm(a.transform.getCameraToCenterDistance(D.projection),Qe),Fe=s.bJ(z,k,Te),Ae=w?Fe/_t:Fe*_t,qe=Mo(Oe,Pe,Ye,g);if(qe[3]<=0){lu(ye,$);continue}let je={};const nt=s.al(d.layers[0].layout.get("text-max-angle")),st=Math.cos(nt),ct=w?null:C,St=mf(Te,Ae,!1,T,t,g,_,d.glyphOffsetArray,Z,$,X,qe,ve,je,ae,ct,D.projection,R,w,st);_e=St.useVertical,ct&&St.needsFlipping&&(je={}),(St.notEnoughRoom||_e||St.needsFlipping&&mf(Te,Ae,!0,T,t,g,_,d.glyphOffsetArray,Z,$,X,qe,ve,je,ae,ct,D.projection,R,w,st).notEnoughRoom)&&lu(ye,$)}h?(d.text.dynamicLayoutVertexBuffer.updateData($),X&&d.text.globeExtVertexBuffer&&d.text.globeExtVertexBuffer.updateData(X)):(d.icon.dynamicLayoutVertexBuffer.updateData($),X&&d.icon.globeExtVertexBuffer&&d.icon.globeExtVertexBuffer.updateData(X))}function _o(d,t,a,h,g,_,w,T,C,R,D,z,k,F,q,$,X){const{lineStartIndex:Z,glyphStartIndex:ne,segment:ae}=T,de=ne+T.numGlyphs,_e=Z+T.lineLength,be=t.getoffsetX(ne),Te=t.getoffsetX(de-1),ye=Yd(d*be,a,h,g,_,w,ae,Z,_e,C,R,D,z,k,!0,F,q,$,X);if(!ye)return null;const xe=Yd(d*Te,a,h,g,_,w,ae,Z,_e,C,R,D,z,k,!0,F,q,$,X);return xe?{first:ye,last:xe}:null}function Fm(d,t,a,h){return d===s.bI.horizontal&&Math.abs(h)>Math.abs(a)?{useVertical:!0}:d===s.bI.vertical?h>0?{needsFlipping:!0}:null:t!==yc.unknown&&function(g,_){return g===0||Math.abs(_/g)>cx}(a,h)?t===yc.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null}function mf(d,t,a,h,g,_,w,T,C,R,D,z,k,F,q,$,X,Z,ne,ae){const de=t/24,_e=d.lineOffsetX*de,be=d.lineOffsetY*de,{lineStartIndex:Te,glyphStartIndex:ye,numGlyphs:xe,segment:ve,writingMode:Oe,flipState:Pe}=d,Ye=Te+d.lineLength,Ue=Qe=>{if(D){const[qe,je,nt]=Qe.up,st=R.length;s.bK(D,st+0,qe,je,nt),s.bK(D,st+1,qe,je,nt),s.bK(D,st+2,qe,je,nt),s.bK(D,st+3,qe,je,nt)}const[_t,Fe,Ae]=Qe.point;s.bL(R,_t,Fe,Ae,Qe.angle)};if(xe>1){const Qe=_o(de,T,_e,be,a,z,k,d,C,_,F,$,!1,X,Z,ne,ae);if(!Qe)return{notEnoughRoom:!0};if(h&&!a){let[_t,Fe,Ae]=Qe.first.point,[qe,je,nt]=Qe.last.point;[_t,Fe]=Mo(_t,Fe,Ae,w),[qe,je]=Mo(qe,je,nt,w);const st=Fm(Oe,Pe,(qe-_t)*q,je-Fe);if(d.flipState=st&&st.needsFlipping?yc.flipRequired:yc.flipNotRequired,st)return st}Ue(Qe.first);for(let _t=ye+1;_t<ye+xe-1;_t++){const Fe=Yd(de*T.getoffsetX(_t),_e,be,a,z,k,ve,Te,Ye,C,_,F,$,!1,!1,X,Z,ne,ae);if(!Fe)return R.length-=4*(_t-ye),{notEnoughRoom:!0};Ue(Fe)}Ue(Qe.last)}else{if(h&&!a){const _t=Mo(k.x,k.y,0,g),Fe=Te+ve+1,Ae=new s.P(C.getx(Fe),C.gety(Fe)),qe=Mo(Ae.x,Ae.y,0,g),je=qe[3]>0?qe:bn(k,Ae,_t,1,g,void 0,X,Z.canonical),nt=Fm(Oe,Pe,(je[0]-_t[0])*q,je[1]-_t[1]);if(d.flipState=nt&&nt.needsFlipping?yc.flipRequired:yc.flipNotRequired,nt)return nt}const Qe=Yd(de*T.getoffsetX(ye),_e,be,a,z,k,ve,Te,Ye,C,_,F,$,!1,!1,X,Z,ne,ae);if(!Qe)return{notEnoughRoom:!0};Ue(Qe)}return{}}function jm(d,t,a,h,g){const{x:_,y:w,z:T}=h.projectTilePoint(d.x,d.y,t);if(!g)return Mo(_,w,T,a);const[C,R,D]=g(d);return Mo(_+C,w+R,T+D,a)}function bn(d,t,a,h,g,_,w,T){const C=jm(d.sub(t)._unit()._add(d),T,g,w,_);return s.at(C,a,C),s.au(C,C),s.bE(C,a,C,h)}function Yd(d,t,a,h,g,_,w,T,C,R,D,z,k,F,q,$,X,Z,ne){const ae=h?d-t:d+t;let de=ae>0?1:-1,_e=0;h&&(de*=-1,_e=Math.PI),de<0&&(_e+=Math.PI);let be=T+w+(de>0?0:1)|0,Te=g,ye=g,xe=0,ve=0;const Oe=Math.abs(ae),Pe=[],Ye=[];let Ue=_,Qe=Ue,_t=s.bC([]);const Fe=()=>bn(Qe,Ue,ye,Oe-xe+1,D,k,$,X.canonical);for(;xe+ve<=Oe;){if(be+=de,be<T||be>=C)return null;if(ye=Te,Qe=Ue,Pe.push(ye),F&&Ye.push(Qe),Ue=new s.P(R.getx(be),R.gety(be)),Te=z[be],!Te){const Lt=jm(Ue,X.canonical,D,$,k);Te=Lt[3]>0?z[be]=Lt:Fe()}xe+=ve;const Ht=s.at([],Te,ye),Qt=s.bD(ye,Te);if(a&&Qt>0&&ve>0&&s.bG(_t,Ht)/(ve*Qt)<ne)return null;ve=Qt,_t=Ht}q&&k&&(z[be]&&(Te=Fe(),ve=s.bD(ye,Te),_t=s.at([],Te,ye)),z[be]=Te);const Ae=(Oe-xe)/ve,qe=Ue.sub(Qe)._mult(Ae)._add(Qe),je=s.bE([],ye,_t,Ae);let nt=[0,0,1],st=_t[0],ct=_t[1];if(Z&&(nt=$.upVector(X.canonical,qe.x,qe.y),nt[0]!==0||nt[1]!==0||nt[2]!==1)){const Ht=[nt[2],0,-nt[0]],Qt=s.bF([],nt,Ht);s.au(Ht,Ht),s.au(Qt,Qt),st=s.bG(_t,Ht),ct=s.bG(_t,Qt)}if(a){const Ht=s.bF([],nt,_t);s.au(Ht,Ht),s.bE(je,je,Ht,a*de)}const St=_e+Math.atan2(ct,st);return Pe.push(je),F&&Ye.push(qe),{point:je,angle:St,path:Pe,tilePath:Ye,up:nt}}function lu(d,t){const a=t.length,h=a+4*d;t.resize(h),t.float32.fill(-1/0,4*a,4*h)}function ux(d,t,a){const h=t[0],g=t[1];return d[0]=a[0]*h+a[4]*g+a[12],d[1]=a[1]*h+a[5]*g+a[13],d[3]=a[3]*h+a[7]*g+a[15],d}const si=100;class dx{constructor(t,a,h=new ou(t.width+200,t.height+200,25),g=new ou(t.width+200,t.height+200,25)){this.transform=t,this.grid=h,this.ignoredGrid=g,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+si,this.screenBottomBoundary=t.height+si,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=a}placeCollisionBox(t,a,h,g,_,w,T,C,R,D,z){let k=h.projectedAnchorX,F=h.projectedAnchorY,q=h.projectedAnchorZ;const $=h.tileAnchorX,X=h.tileAnchorY,Z=h.elevation,ne=h.tileID,ae=t.getProjection();if(Z&&ne){const[Ye,Ue,Qe]=ae.upVector(ne.canonical,h.tileAnchorX,h.tileAnchorY),_t=ae.upVectorScale(ne.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;k+=Ye*Z*_t,F+=Ue*Z*_t,q+=Qe*Z*_t}const de=t.projection.name==="globe",_e=t.projection.name==="globe"?s.ah(this.transform.zoom):0;if(ne&&de&&_e<1&&!w){const Ye=1<<ne.canonical.z,Ue=s.bM($,X);s.bN(Ue,Ue,1/s.aj),s.bO(Ue,Ue,s.bM(ne.canonical.x,ne.canonical.y)),s.bN(Ue,Ue,1/Ye),s.bP(Ue,Ue,s.bM(g[0],g[1])),Ue[0]=s.bQ(Ue[0],-.5,.5),s.bN(Ue,Ue,s.aj);const Qe=s.bR(Ue[0],Ue[1],s.aj/(2*Math.PI),1);s.aA(Qe,Qe,_),k=s.ai(k,Qe[0],_e),F=s.ai(F,Qe[1],_e),q=s.ai(q,Qe[2],_e)}const be=this.projectAndGetPerspectiveRatio(D,k,F,q,h.tileID,ae.name==="globe"||!!Z||this.transform.pitch>0,ae),Te=R*be.perspectiveRatio,ye=(h.x1*a+T.x-h.padding)*Te+be.point.x,xe=(h.y1*a+T.y-h.padding)*Te+be.point.y,ve=(h.x2*a+T.x+h.padding)*Te+be.point.x,Oe=(h.y2*a+T.y+h.padding)*Te+be.point.y,Pe=be.perspectiveRatio<=.55||be.occluded;return!this.isInsideGrid(ye,xe,ve,Oe)||!C&&this.grid.hitTest(ye,xe,ve,Oe,z)||Pe?{box:[],offscreen:!1,occluded:be.occluded}:{box:[ye,xe,ve,Oe],offscreen:this.isOffscreen(ye,xe,ve,Oe),occluded:!1}}placeCollisionCircles(t,a,h,g,_,w,T,C,R,D,z,k,F,q,$){const X=[],Z=this.transform.elevation,ne=t.getProjection(),ae=Z?Z.getAtTileOffsetFunc($,this.transform.center.lat,this.transform.worldSize,ne):null,de=new s.P(h.tileAnchorX,h.tileAnchorY);let{x:_e,y:be,z:Te}=ne.projectTilePoint(de.x,de.y,$.canonical);if(ae){const[nt,st,ct]=ae(de);_e+=nt,be+=st,Te+=ct}const ye=ne.name==="globe",xe=this.projectAndGetPerspectiveRatio(T,_e,be,Te,$,ye||!!Z||this.transform.pitch>0,ne),{perspectiveRatio:ve}=xe,Oe=(z?w/ve:w*ve)/s.bU,Pe=Mo(_e,be,Te,C),Ye=h.lineOffsetX*Oe,Ue=h.lineOffsetY*Oe,Qe=s.al(t.layers[0].layout.get("text-max-angle")),_t=Math.cos(Qe),Fe=xe.signedDistanceFromCamera>0?_o(Oe,_,Ye,Ue,!1,Pe,de,h,g,C,{},Z&&!z?ae:null,z&&!!Z,ne,$,z,_t):null;let Ae=!1,qe=!1,je=!0;if(Fe&&!xe.occluded){const nt=.5*F*ve+q,st=new s.P(-100,-100),ct=new s.P(this.screenRightBoundary,this.screenBottomBoundary),St=new lx,{first:Ht,last:Qt}=Fe,Lt=Ht.path.length;let Yt=[];for(let Mi=Lt-1;Mi>=1;Mi--)Yt.push(Ht.path[Mi]);for(let Mi=1;Mi<Qt.path.length;Mi++)Yt.push(Qt.path[Mi]);const Wt=2.5*nt;R&&(Yt=Yt.map(([Mi,Ui,cn],Ei)=>(ae&&!ye&&(cn=ae(Ei<Lt-1?Ht.tilePath[Lt-1-Ei]:Qt.tilePath[Ei-Lt+2])[2]),Mo(Mi,Ui,cn,R))),Yt.some(Mi=>Mi[3]<=0)&&(Yt=[]));let xi=[];if(Yt.length>0){let Mi=1/0,Ui=-1/0,cn=1/0,Ei=-1/0;for(const un of Yt)Mi=Math.min(Mi,un[0]),cn=Math.min(cn,un[1]),Ui=Math.max(Ui,un[0]),Ei=Math.max(Ei,un[1]);Ui>=st.x&&Mi<=ct.x&&Ei>=st.y&&cn<=ct.y&&(xi=[Yt.map(un=>new s.P(un[0],un[1]))],(Mi<st.x||Ui>ct.x||cn<st.y||Ei>ct.y)&&(xi=s.bS(xi,st.x,st.y,ct.x,ct.y)))}for(const Mi of xi){St.reset(Mi,.25*nt);let Ui=0;Ui=St.length<=.5*nt?1:Math.ceil(St.paddedLength/Wt)+1;for(let cn=0;cn<Ui;cn++){const Ei=cn/Math.max(Ui-1,1),un=St.lerp(Ei),mn=un.x+si,Fn=un.y+si;X.push(mn,Fn,nt,0);const ji=mn-nt,dn=Fn-nt,hn=mn+nt,yn=Fn+nt;if(je=je&&this.isOffscreen(ji,dn,hn,yn),qe=qe||this.isInsideGrid(ji,dn,hn,yn),!a&&this.grid.hitTestCircle(mn,Fn,nt,k)&&(Ae=!0,!D))return{circles:[],offscreen:!1,collisionDetected:Ae,occluded:!1}}}}return{circles:!D&&Ae||!qe?[]:X,offscreen:je,collisionDetected:Ae,occluded:xe.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let h=1/0,g=1/0,_=-1/0,w=-1/0;for(const D of t){const z=new s.P(D.x+si,D.y+si);h=Math.min(h,z.x),g=Math.min(g,z.y),_=Math.max(_,z.x),w=Math.max(w,z.y),a.push(z)}const T=this.grid.query(h,g,_,w).concat(this.ignoredGrid.query(h,g,_,w)),C={},R={};for(const D of T){const z=D.key;if(C[z.bucketInstanceId]===void 0&&(C[z.bucketInstanceId]={}),C[z.bucketInstanceId][z.featureIndex])continue;const k=[new s.P(D.x1,D.y1),new s.P(D.x2,D.y1),new s.P(D.x2,D.y2),new s.P(D.x1,D.y2)];s.bT(a,k)&&(C[z.bucketInstanceId][z.featureIndex]=!0,R[z.bucketInstanceId]===void 0&&(R[z.bucketInstanceId]=[]),R[z.bucketInstanceId].push(z.featureIndex))}return R}insertCollisionBox(t,a,h,g,_){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:g,collisionGroupID:_},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,h,g,_){const w=a?this.ignoredGrid:this.grid,T={bucketInstanceId:h,featureIndex:g,collisionGroupID:_};for(let C=0;C<t.length;C+=4)w.insertCircle(T,t[C],t[C+1],t[C+2])}projectAndGetPerspectiveRatio(t,a,h,g,_,w,T){const C=[a,h,g,1];let R=!1;g||this.transform.pitch>0?(s.aA(C,C,t),this.fogState&&_&&T.name!=="globe"&&(R=function(k,F,q,$,X,Z){const ne=Z.calculateFogTileMatrix(X),ae=[F,q,$];return s.ad(ae,ae,ne),ei(k,s.ae(ae),Z.pitch,Z._fov)}(this.fogState,a,h,g,_.toUnwrapped(),this.transform)>.9)):ux(C,C,t);const D=C[3];return{point:new s.P((C[0]/D+1)/2*this.transform.width+si,(-C[1]/D+1)/2*this.transform.height+si),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(T)/D*.5,1.5),signedDistanceFromCamera:D,occluded:w&&C[2]>D||R}}isOffscreen(t,a,h,g){return h<si||t>=this.screenRightBoundary||g<si||a>this.screenBottomBoundary}isInsideGrid(t,a,h,g){return h>=0&&t<this.gridRightBoundary&&g>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=s.bx([]);return s.bo(t,t,[-100,-100,0]),t}}class Jd{constructor(t,a,h,g){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):g&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class vc{constructor(t,a,h,g,_,w=!1){this.text=new Jd(t?t.text:null,a,h,_),this.icon=new Jd(t?t.icon:null,a,g,_),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ro{constructor(t,a,h,g=!1){this.text=t,this.icon=a,this.skipFade=h,this.clipped=g}}class Bm{constructor(){this.invProjMatrix=s.bz(),this.viewportMatrix=s.bz(),this.circles=[]}}class cu{constructor(t,a,h,g,_){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=h,this.bucketIndex=g,this.tileID=_}}class Jt{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:h=>h.collisionGroupID===a}}return this.collisionGroups[t]}}function vn(d,t,a,h,g){const{horizontalAlign:_,verticalAlign:w}=s.bZ(d),T=-(_-.5)*t,C=-(w-.5)*a,R=s.b_(d,h);return new s.P(T+R[0]*g,C+R[1]*g)}function wn(d,t,a,h,g){const _=new s.P(d,t);return a&&_._rotate(h?g:-g),_}class yo{constructor(t,a,h,g,_,w){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new dx(this.transform,_),this.buildingIndex=w,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new Jt(h),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,a,h,g,_=1){const w=h.getBucket(a),T=h.latestFeatureIndex;if(!w||!T||a.fqid!==w.layerIds[0])return;const C=w.layers[0].layout,R=w.layers[0].paint,D=h.collisionBoxArray,z=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),k=h.tileSize/s.aj,F=h.tileID.toUnwrapped();this.transform.setProjection(w.projection);const q=($=h.tileID,X=w.getProjection(),Z=this.transform,X.name===this.projection?Z.calculateProjMatrix($.toUnwrapped()):Xd(Z,X,$));var $,X,Z;const ne=C.get("text-pitch-alignment")==="map",ae=C.get("text-rotation-alignment")==="map";a.compileFilter(a.options);const de=a.dynamicFilter(),_e=a.dynamicFilterNeedsFeature(),be=this.transform.calculatePixelsToTileUnitsMatrix(h),Te=au(q,h.tileID.canonical,ne,ae,this.transform,w.getProjection(),be);let ye=null;const xe=w.getProjection().createInversionMatrix(this.transform,h.tileID.canonical);if(ne){const Ae=Qa(q,h.tileID.canonical,ne,ae,this.transform,w.getProjection(),be);ye=s.az([],this.transform.labelPlaneMatrix,Ae)}let ve=null;de&&h.latestFeatureIndex&&(ve={unwrappedTileID:F,dynamicFilter:de,dynamicFilterNeedsFeature:_e}),this.retainedQueryData[w.bucketInstanceId]=new cu(w.bucketInstanceId,T,w.sourceLayerIndex,w.index,h.tileID);const[Oe,Pe]=w.layers[0].layout.get("text-size-scale-range"),Ye=s.ay(_,Oe,Pe),[Ue,Qe]=C.get("icon-size-scale-range"),_t=s.ay(_,Ue,Qe),Fe={bucket:w,layout:C,paint:R,posMatrix:q,invMatrix:xe,mercatorCenter:[s.aD(this.transform.center.lng),s.aH(this.transform.center.lat)],textLabelPlaneMatrix:Te,labelToScreenMatrix:ye,clippingData:ve,scale:z,textPixelRatio:k,holdingForFade:h.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:s.bH(w.textSizeData,this.transform.zoom,Ye),partiallyEvaluatedIconSize:s.bH(w.iconSizeData,this.transform.zoom,_t),collisionGroup:this.collisionGroups.get(w.sourceID),latestFeatureIndex:h.latestFeatureIndex};if(g)for(const Ae of w.sortKeyRanges){const{sortKey:qe,symbolInstanceStart:je,symbolInstanceEnd:nt}=Ae;t.push({sortKey:qe,symbolInstanceStart:je,symbolInstanceEnd:nt,parameters:Fe})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:Fe})}attemptAnchorPlacement(t,a,h,g,_,w,T,C,R,D,z,k,F,q,$,X,Z,ne,ae,de,_e){const{textOffset0:be,textOffset1:Te,crossTileID:ye}=$,xe=[be,Te],ve=vn(t,w,T,xe,C),Oe=this.collisionIndex.placeCollisionBox(Z,C,a,h,g,_,wn(ve.x,ve.y,R,D,this.transform.angle),q,z,k,F.predicate);if(ae){const Pe=Z.getSymbolInstanceIconSize(_e,this.transform.zoom,$.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Z,Pe,ae,h,g,_,wn(ve.x,ve.y,R,D,this.transform.angle),q,z,k,F.predicate).box.length===0)return}if(Oe.box.length>0){let Pe;return this.prevPlacement&&this.prevPlacement.variableOffsets[ye]&&this.prevPlacement.placements[ye]&&this.prevPlacement.placements[ye].text&&(Pe=this.prevPlacement.variableOffsets[ye].anchor),this.variableOffsets[ye]={textOffset:xe,width:w,height:T,anchor:t,textScale:C,prevAnchor:Pe},this.markUsedJustification(Z,t,$,ne),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,ne,$),this.placedOrientations[ye]=ne),{shift:ve,placedGlyphBoxes:Oe}}}placeLayerBucketPart(t,a,h,g,_=1){const{bucket:w,layout:T,paint:C,posMatrix:R,textLabelPlaneMatrix:D,labelToScreenMatrix:z,clippingData:k,textPixelRatio:F,mercatorCenter:q,invMatrix:$,holdingForFade:X,collisionBoxArray:Z,partiallyEvaluatedTextSize:ne,partiallyEvaluatedIconSize:ae,collisionGroup:de,latestFeatureIndex:_e}=t.parameters,be=T.get("text-optional"),Te=T.get("icon-optional"),ye=T.get("text-allow-overlap"),xe=T.get("icon-allow-overlap"),ve=T.get("text-rotation-alignment")==="map",Oe=T.get("icon-rotation-alignment")==="map",Pe=T.get("text-pitch-alignment")==="map",Ye=C.get("symbol-z-offset"),Ue=T.get("symbol-elevation-reference")==="sea",Qe=T.get("symbol-placement"),[_t,Fe]=T.get("text-size-scale-range"),[Ae,qe]=T.get("icon-size-scale-range"),je=s.ay(_,_t,Fe),nt=s.ay(_,Ae,qe),st=T.get("text-variable-anchor"),ct=ve&&Qe!=="point",St=Oe&&Qe!=="point",Ht=st&&w.hasTextData(),Qt=w.hasIconTextFit()&&Ht&&w.hasIconData();this.transform.setProjection(w.projection);const Lt=Ht||ct,Yt=St||Qt;let Wt=ye&&(xe||!w.hasIconData()||Te),xi=xe&&(ye||!w.hasTextData()||be);const Mi=!Ye.isConstant();!w.collisionArrays&&Z&&w.deserializeCollisionBoxes(Z),h&&g&&w.updateCollisionDebugBuffers(this.transform.zoom,Z,je,nt);const Ui=(Ei,un,mn)=>{const{crossTileID:Fn,numVerticalGlyphVertices:ji}=Ei;let dn=null;if(k&&k.dynamicFilterNeedsFeature||Mi){const Tr=this.retainedQueryData[w.bucketInstanceId];dn=_e.loadFeature({featureIndex:Ei.featureIndex,bucketIndex:Tr.bucketIndex,sourceLayerIndex:Tr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(k&&!(0,k.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},dn,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new s.P(Ei.tileAnchorX,Ei.tileAnchorY),this.transform.calculateDistanceTileData(k.unwrappedTileID)))return this.placements[Fn]=new Ro(!1,!1,!1,!0),void a.add(Fn);const hn=Ye.evaluate(dn,{});if(a.has(Fn))return;if(X)return void(this.placements[Fn]=new Ro(!1,!1,!1));let yn=!1,Gi=!1,An=!0,gn=!1,sr=!1,on=null,xn={box:null,offscreen:null,occluded:null},Ln={box:null},Dr=null,Ir=null,zr=null,us=0,_a=0,Xs=0;mn.textFeatureIndex?us=mn.textFeatureIndex:Ei.useRuntimeCollisionCircles&&(us=Ei.featureIndex),mn.verticalTextFeatureIndex&&(_a=mn.verticalTextFeatureIndex);const vo=Tr=>{Tr.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const fr=this.transform.elevation;Tr.elevation=Ue?hn:hn+(fr?fr.getAtTileOffset(Tr.tileID,Tr.tileAnchorX,Tr.tileAnchorY):0),Tr.elevation+=Ei.zOffset},Ts=mn.textBox;if(Ts){vo(Ts);const Tr=Bn=>{let Ur=s.bI.horizontal;if(w.allowVerticalPlacement&&!Bn&&this.prevPlacement){const ds=this.prevPlacement.placedOrientations[Fn];ds&&(this.placedOrientations[Fn]=ds,Ur=ds,this.markUsedOrientation(w,Ur,Ei))}return Ur},fr=(Bn,Ur)=>{if(w.allowVerticalPlacement&&ji>0&&mn.verticalTextBox){for(const ds of w.writingModes)if(ds===s.bI.vertical?(xn=Ur(),Ln=xn):xn=Bn(),xn&&xn.box&&xn.box.length)break}else xn=Bn()};if(st){let Bn=st;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Fn]){const Er=this.prevPlacement.variableOffsets[Fn];Bn.indexOf(Er.anchor)>0&&(Bn=Bn.filter(Oo=>Oo!==Er.anchor),Bn.unshift(Er.anchor))}const Ur=(Er,Oo,kc)=>{const Xl=w.getSymbolInstanceTextSize(ne,Ei,this.transform.zoom,un),Fu=(Er.x2-Er.x1)*Xl+2*Er.padding,ju=(Er.y2-Er.y1)*Xl+2*Er.padding,Fo=Ei.hasIconTextFit&&!xe?Oo:null;Fo&&vo(Fo);let Fa={box:[],offscreen:!1,occluded:!1};const Gr=ye?2*Bn.length:Bn.length;for(let jo=0;jo<Gr;++jo){const Nc=this.attemptAnchorPlacement(Bn[jo%Bn.length],Er,q,$,Lt,Fu,ju,Xl,ve,Pe,F,R,de,jo>=Bn.length,Ei,un,w,kc,Fo,ne,ae);if(Nc&&(Fa=Nc.placedGlyphBoxes,Fa&&Fa.box&&Fa.box.length)){yn=!0,on=Nc.shift;break}}return Fa};fr(()=>Ur(Ts,mn.iconBox,s.bI.horizontal),()=>{const Er=mn.verticalTextBox;return Er&&vo(Er),w.allowVerticalPlacement&&!(xn&&xn.box&&xn.box.length)&&ji>0&&Er?Ur(Er,mn.verticalIconBox,s.bI.vertical):{box:null,offscreen:null,occluded:null}}),xn&&(yn=xn.box,An=xn.offscreen,gn=xn.occluded);const ds=Tr(!(!xn||!xn.box));if(!yn&&this.prevPlacement){const Er=this.prevPlacement.variableOffsets[Fn];Er&&(this.variableOffsets[Fn]=Er,this.markUsedJustification(w,Er.anchor,Ei,ds))}}else{const Bn=(Ur,ds)=>{const Er=w.getSymbolInstanceTextSize(ne,Ei,this.transform.zoom,un,_),Oo=this.collisionIndex.placeCollisionBox(w,Er,Ur,q,$,Lt,new s.P(0,0),ye,F,R,de.predicate);return Oo&&Oo.box&&Oo.box.length&&(this.markUsedOrientation(w,ds,Ei),this.placedOrientations[Fn]=ds),Oo};fr(()=>Bn(Ts,s.bI.horizontal),()=>{const Ur=mn.verticalTextBox;return w.allowVerticalPlacement&&ji>0&&Ur?(vo(Ur),Bn(Ur,s.bI.vertical)):{box:null,offscreen:null,occluded:null}}),Tr(!!(xn&&xn.box&&xn.box.length))}}if(Dr=xn,yn=Dr&&Dr.box&&Dr.box.length>0,An=Dr&&Dr.offscreen,gn=Dr&&Dr.occluded,Ei.useRuntimeCollisionCircles){const Tr=w.text.placedSymbolArray.get(Ei.centerJustifiedTextSymbolIndex>=0?Ei.centerJustifiedTextSymbolIndex:Ei.verticalPlacedTextSymbolIndex),fr=s.bJ(w.textSizeData,ne,Tr),Bn=T.get("text-padding");Ir=this.collisionIndex.placeCollisionCircles(w,ye,Tr,w.lineVertexArray,w.glyphOffsetArray,fr,R,D,z,h,Pe,de.predicate,Ei.collisionCircleDiameter*fr/s.bU,Bn,this.retainedQueryData[w.bucketInstanceId].tileID),yn=ye||Ir.circles.length>0&&!Ir.collisionDetected,An=An&&Ir.offscreen,gn=Ir.occluded}if(mn.iconFeatureIndex&&(Xs=mn.iconFeatureIndex),mn.iconBox){const Tr=fr=>{vo(fr);const Bn=Ei.hasIconTextFit&&on?wn(on.x,on.y,ve,Pe,this.transform.angle):new s.P(0,0),Ur=w.getSymbolInstanceIconSize(ae,this.transform.zoom,Ei.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,Ur,fr,q,$,Yt,Bn,xe,F,R,de.predicate)};Ln&&Ln.box&&Ln.box.length&&mn.verticalIconBox?(zr=Tr(mn.verticalIconBox),Gi=zr.box.length>0):(zr=Tr(mn.iconBox),Gi=zr.box.length>0),An=An&&zr.offscreen,sr=zr.occluded}const zo=be||Ei.numHorizontalGlyphVertices===0&&ji===0,ra=Te||Ei.numIconVertices===0;if(zo||ra?ra?zo||(Gi=Gi&&yn):yn=Gi&&yn:Gi=yn=Gi&&yn,yn&&Dr&&Dr.box&&this.collisionIndex.insertCollisionBox(Dr.box,T.get("text-ignore-placement"),w.bucketInstanceId,Ln&&Ln.box&&_a?_a:us,de.ID),Gi&&zr&&this.collisionIndex.insertCollisionBox(zr.box,T.get("icon-ignore-placement"),w.bucketInstanceId,Xs,de.ID),Ir&&(yn&&this.collisionIndex.insertCollisionCircles(Ir.circles,T.get("text-ignore-placement"),w.bucketInstanceId,us,de.ID),h)){const Tr=w.bucketInstanceId;let fr=this.collisionCircleArrays[Tr];fr===void 0&&(fr=this.collisionCircleArrays[Tr]=new Bm);for(let Bn=0;Bn<Ir.circles.length;Bn+=4)fr.circles.push(Ir.circles[Bn+0]),fr.circles.push(Ir.circles[Bn+1]),fr.circles.push(Ir.circles[Bn+2]),fr.circles.push(Ir.collisionDetected?1:0)}const Es=w.projection.name!=="globe";Wt=Wt&&(Es||!gn),xi=xi&&(Es||!sr),this.placements[Fn]=new Ro(yn||Wt,Gi||xi,An||w.justReloaded),a.add(Fn)},cn=this.retainedQueryData[w.bucketInstanceId].tileID;if(w.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(w,cn),w.elevationType==="road"&&w.updateRoadElevation(cn.canonical),w.updateZOffset(),w.sortFeaturesByY){const Ei=w.getSortedSymbolIndexes(this.transform.angle);for(let un=Ei.length-1;un>=0;--un){const mn=Ei[un];Ui(w.symbolInstances.get(mn),mn,w.collisionArrays[mn])}w.hasAnyZOffset&&s.w(`${w.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(w.hasAnyZOffset){const Ei=w.getSortedIndexesByZOffset();for(let un=0;un<Ei.length;++un){const mn=Ei[un];Ui(w.symbolInstances.get(mn),mn,w.collisionArrays[mn])}}else for(let Ei=t.symbolInstanceStart;Ei<t.symbolInstanceEnd;Ei++)Ui(w.symbolInstances.get(Ei),Ei,w.collisionArrays[Ei]);if(h&&w.bucketInstanceId in this.collisionCircleArrays){const Ei=this.collisionCircleArrays[w.bucketInstanceId];s.bi(Ei.invProjMatrix,R),Ei.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(t,a,h,g){const{leftJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:T,verticalPlacedTextSymbolIndex:C,crossTileID:R}=h,D=s.b$(a),z=g===s.bI.vertical?C:D==="left"?_:D==="center"?w:D==="right"?T:-1;_>=0&&(t.text.placedSymbolArray.get(_).crossTileID=z>=0&&_!==z?0:R),w>=0&&(t.text.placedSymbolArray.get(w).crossTileID=z>=0&&w!==z?0:R),T>=0&&(t.text.placedSymbolArray.get(T).crossTileID=z>=0&&T!==z?0:R),C>=0&&(t.text.placedSymbolArray.get(C).crossTileID=z>=0&&C!==z?0:R)}markUsedOrientation(t,a,h){const g=a===s.bI.horizontal||a===s.bI.horizontalOnly?a:0,_=a===s.bI.vertical?a:0,{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:R}=h,D=t.text.placedSymbolArray;w>=0&&(D.get(w).placedOrientation=g),T>=0&&(D.get(T).placedOrientation=g),C>=0&&(D.get(C).placedOrientation=g),R>=0&&(D.get(R).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let h=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const g=a?a.symbolFadeChange(t):1,_=a?a.opacities:{},w=a?a.variableOffsets:{},T=a?a.placedOrientations:{};for(const C in this.placements){const R=this.placements[C],D=_[C];D?(this.opacities[C]=new vc(D,g,R.text,R.icon,null,R.clipped),h=h||R.text!==D.text.placed||R.icon!==D.icon.placed):(this.opacities[C]=new vc(null,g,R.text,R.icon,R.skipFade,R.clipped),h=h||R.text||R.icon)}for(const C in _){const R=_[C];if(!this.opacities[C]){const D=new vc(R,g,!1,!1);D.isHidden()||(this.opacities[C]=D,h=h||R.text.placed||R.icon.placed)}}for(const C in w)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=w[C]);for(const C in T)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=T[C]);h?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a,h,g){const _=new Set;for(const w of a){const T=w.getBucket(t);T&&w.latestFeatureIndex&&t.fqid===T.layerIds[0]&&(this.updateBucketOpacities(T,_,w,w.collisionBoxArray,h,g,w.tileID,t.scope),T.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(T,w.tileID),T.elevationType==="road"&&T.updateRoadElevation(w.tileID.canonical),T.updateZOffset())}}updateBucketOpacities(t,a,h,g,_,w,T,C){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const R=t.layers[0].layout,D=t.layers[0].paint,z=!!t.layers[0].dynamicFilter(),k=new vc(null,0,!1,!1,!0),F=R.get("text-allow-overlap"),q=R.get("icon-allow-overlap"),$=R.get("text-variable-anchor"),X=R.get("text-rotation-alignment")==="map",Z=R.get("text-pitch-alignment")==="map",ne=D.get("symbol-z-offset"),ae=R.get("symbol-elevation-reference")==="sea",de=!ne.isConstant(),_e=new vc(null,0,F&&(q||!t.hasIconData()||R.get("icon-optional")),q&&(F||!t.hasTextData()||R.get("text-optional")),!0);!t.collisionArrays&&g&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(g);const be=(ye,xe,ve)=>{for(let Oe=0;Oe<xe/4;Oe++)ye.opacityVertexArray.emplaceBack(ve)};let Te=0;w&&t.updateReplacement(T,w);for(let ye=0;ye<t.symbolInstances.length;ye++){const xe=t.symbolInstances.get(ye),{numHorizontalGlyphVertices:ve,numVerticalGlyphVertices:Oe,crossTileID:Pe,numIconVertices:Ye,tileAnchorX:Ue,tileAnchorY:Qe}=xe;let _t=null;const Fe=this.retainedQueryData[t.bucketInstanceId];de&&xe&&Fe&&(_t=h.latestFeatureIndex.loadFeature({featureIndex:xe.featureIndex,bucketIndex:Fe.bucketIndex,sourceLayerIndex:Fe.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ae=ne.evaluate(_t,{}),qe=a.has(Pe);let je=this.opacities[Pe];qe?je=k:je||(je=_e,this.opacities[Pe]=je),a.add(Pe);const nt=ve>0||Oe>0,st=Ye>0,ct=this.placedOrientations[Pe],St=ct===s.bI.vertical,Ht=ct===s.bI.horizontal||ct===s.bI.horizontalOnly;!nt&&!st||je.isHidden()||Te++;let Qt=!1;if((nt||st)&&w)for(const Lt of t.activeReplacements){if(s.bV(Lt,_,s.bW.Symbol,C)||Lt.min.x>Ue||Ue>Lt.max.x||Lt.min.y>Qe||Qe>Lt.max.y)continue;const Yt=s.bX(Ue,Qe,T.canonical,Lt.footprintTileId.canonical);if(Qt=s.bY(Yt,Lt.footprint),Qt)break}if(nt){const Lt=Qt?Rl:uu(je.text);be(t.text,ve,St?Rl:Lt),be(t.text,Oe,Ht?Rl:Lt);const Yt=je.text.isHidden(),{leftJustifiedTextSymbolIndex:Wt,centerJustifiedTextSymbolIndex:xi,rightJustifiedTextSymbolIndex:Mi,verticalPlacedTextSymbolIndex:Ui}=xe,cn=t.text.placedSymbolArray,Ei=Yt||St?1:0;Wt>=0&&(cn.get(Wt).hidden=Ei),xi>=0&&(cn.get(xi).hidden=Ei),Mi>=0&&(cn.get(Mi).hidden=Ei),Ui>=0&&(cn.get(Ui).hidden=Yt||Ht?1:0);const un=this.variableOffsets[Pe];un&&this.markUsedJustification(t,un.anchor,xe,ct);const mn=this.placedOrientations[Pe];mn&&(this.markUsedJustification(t,"left",xe,mn),this.markUsedOrientation(t,mn,xe))}if(st){const Lt=Qt?Rl:uu(je.icon),{placedIconSymbolIndex:Yt,verticalPlacedIconSymbolIndex:Wt}=xe,xi=t.icon.placedSymbolArray,Mi=je.icon.isHidden()?1:0;Yt>=0&&(be(t.icon,Ye,St?Rl:Lt),xi.get(Yt).hidden=Mi),Wt>=0&&(be(t.icon,xe.numVerticalIconVertices,Ht?Rl:Lt),xi.get(Wt).hidden=Mi)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Lt=t.collisionArrays[ye];if(Lt){let Yt=new s.P(0,0),Wt=!0;if(Lt.textBox||Lt.verticalTextBox){if($){const Mi=this.variableOffsets[Pe];Mi?(Yt=vn(Mi.anchor,Mi.width,Mi.height,Mi.textOffset,Mi.textScale),X&&Yt._rotate(Z?this.transform.angle:-this.transform.angle)):Wt=!1}z&&(Wt=!je.clipped),Lt.textBox&&el(t.textCollisionBox.collisionVertexArray,je.text.placed,!Wt||St,Ae,ae,Yt.x,Yt.y),Lt.verticalTextBox&&el(t.textCollisionBox.collisionVertexArray,je.text.placed,!Wt||Ht,Ae,ae,Yt.x,Yt.y)}const xi=Wt&&!!(!Ht&&Lt.verticalIconBox);Lt.iconBox&&el(t.iconCollisionBox.collisionVertexArray,je.icon.placed,xi,Ae,ae,xe.hasIconTextFit?Yt.x:0,xe.hasIconTextFit?Yt.y:0),Lt.verticalIconBox&&el(t.iconCollisionBox.collisionVertexArray,je.icon.placed,!xi,Ae,ae,xe.hasIconTextFit?Yt.x:0,xe.hasIconTextFit?Yt.y:0)}}}if(t.fullyClipped=Te===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const ye=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=ye.invProjMatrix,t.placementViewportMatrix=ye.viewportMatrix,t.collisionCircleArray=ye.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const h=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*h>t}setStale(){this.stale=!0}}function el(d,t,a,h,g,_,w){d.emplaceBack(t?1:0,a?1:0,_||0,w||0,h,g?1:0),d.emplaceBack(t?1:0,a?1:0,_||0,w||0,h,g?1:0),d.emplaceBack(t?1:0,a?1:0,_||0,w||0,h,g?1:0),d.emplaceBack(t?1:0,a?1:0,_||0,w||0,h,g?1:0)}const Sn=Math.pow(2,25),gf=Math.pow(2,24),Qd=Math.pow(2,17),eh=Math.pow(2,16),Ls=Math.pow(2,9),Vr=Math.pow(2,8),Gw=Math.pow(2,1);function uu(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const t=d.placed?1:0,a=Math.floor(127*d.opacity);return a*Sn+t*gf+a*Qd+t*eh+a*Ls+t*Vr+a*Gw+t}const Rl=0;class th{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,a,h,g,_,w){const T=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(T,g,t[this._currentTileIndex],this._sortAcrossTiles,w),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((C,R)=>C.sortKey-R.sortKey));this._currentPartIndex<T.length;){const C=T[this._currentPartIndex];if(a.placeLayerBucketPart(C,this._seenCrossTileIDs,h,C.symbolInstanceStart===0,w),this._currentPartIndex++,_())return!0}return!1}}class _f{constructor(t,a,h,g,_,w,T,C,R){this.placement=new yo(t,_,w,T,C,R),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(t,a,h,g,_){const w=s.q.now(),T=()=>{const C=s.q.now()-w;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=a[t[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=R)&&(!C.maxzoom||C.maxzoom>R)){const D=C,z=D.layout.get("symbol-z-elevate"),k=D.layout.get("symbol-sort-key").constantOr(1)!==void 0,F=D.layout.get("symbol-z-order"),q=F==="viewport-y"||F==="auto"&&!(F!=="viewport-y"&&k),$=D.layout.get("text-allow-overlap")||D.layout.get("icon-allow-overlap")||D.layout.get("text-ignore-placement")||D.layout.get("icon-ignore-placement"),X=q&&$,Z=this._inProgressLayer=this._inProgressLayer||new th(D),ne=s.C(C.source,C.scope);if(Z.continuePlacement(z||X?g[ne]:h[ne],this.placement,this._showCollisionBoxes,C,T,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const ih=512/s.aj/2;class yf{constructor(t,a,h){this.tileID=t,this.bucketInstanceId=h,this.index=new s.c0(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const g=t.canonical.x*s.aj,_=t.canonical.y*s.aj;for(let w=0;w<a.length;w++){const{key:T,crossTileID:C,tileAnchorX:R,tileAnchorY:D}=a.get(w),z=Math.floor((g+R)*ih),k=Math.floor((_+D)*ih);this.index.add(z,k),this.keys.push(T),this.crossTileIDs.push(C)}this.index.finish()}findMatches(t,a,h){const g=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),_=ih/Math.pow(2,a.canonical.z-this.tileID.canonical.z),w=a.canonical.x*s.aj,T=a.canonical.y*s.aj;for(let C=0;C<t.length;C++){const R=t.get(C);if(R.crossTileID)continue;const{key:D,tileAnchorX:z,tileAnchorY:k}=R,F=Math.floor((w+z)*_),q=Math.floor((T+k)*_),$=this.index.range(F-g,q-g,F+g,q+g).sort((X,Z)=>X-Z);for(const X of $){const Z=this.crossTileIDs[X];if(this.keys[X]===D&&!h.has(Z)){h.add(Z),R.crossTileID=Z;break}}}}}class Hs{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class tl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const h in this.indexes){const g=this.indexes[h],_={};for(const w in g){const T=g[w];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+a),_[T.tileID.key]=T}this.indexes[h]=_}this.lng=t}addBucket(t,a,h){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<a.symbolInstances.length;_++)a.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const g=this.usedCrossTileIDs[t.overscaledZ];for(const _ in this.indexes){const w=this.indexes[_];if(Number(_)>t.overscaledZ)for(const T in w){const C=w[T];C.tileID.isChildOf(t)&&C.findMatches(a.symbolInstances,t,g)}else{const T=w[t.scaledTo(Number(_)).key];T&&T.findMatches(a.symbolInstances,t,g)}}for(let _=0;_<a.symbolInstances.length;_++){const w=a.symbolInstances.get(_);w.crossTileID||(w.crossTileID=h.generate(),g.add(w.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new yf(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const h of a.crossTileIDs)this.usedCrossTileIDs[t].delete(h)}removeStaleBuckets(t){let a=!1;for(const h in this.indexes){const g=this.indexes[h];for(const _ in g)t[g[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,g[_]),delete g[_],a=!0)}return a}}class oo{constructor(){this.layerIndexes={},this.crossTileIDs=new Hs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,h,g){let _=this.layerIndexes[t.fqid];_===void 0&&(_=this.layerIndexes[t.fqid]=new tl);let w=!1;const T={};g.name!=="globe"&&_.handleWrapJump(h);for(const C of a){const R=C.getBucket(t);R&&t.fqid===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(C.tileID,R,this.crossTileIDs)&&(w=!0),T[R.bucketInstanceId]=!0)}return _.removeStaleBuckets(T)&&(w=!0),w}pruneUnusedLayers(t){const a={};t.forEach(h=>{a[h]=!0});for(const h in this.layerIndexes)a[h]||delete this.layerIndexes[h]}}const wc=771;class Ni{constructor(t,a,h,g){this.blendFunction=t,this.blendColor=a.toNonPremultipliedRenderColor(null),this.mask=h,this.blendEquation=g}}Ni.Replace=[1,0,1,0],Ni.disabled=new Ni(Ni.Replace,s.am.transparent,[!1,!1,!1,!1]),Ni.unblended=new Ni(Ni.Replace,s.am.transparent,[!0,!0,!0,!0]),Ni.alphaBlended=new Ni([1,wc,1,wc],s.am.transparent,[!0,!0,!0,!0]),Ni.alphaBlendedNonPremultiplied=new Ni([770,wc,770,wc],s.am.transparent,[!0,!0,!0,!0]),Ni.multiply=new Ni([774,0,774,0],s.am.transparent,[!0,!0,!0,!0]);class Ft{constructor(t,a,h){this.func=t,this.mask=a,this.range=h}}Ft.ReadOnly=!1,Ft.ReadWrite=!0,Ft.disabled=new Ft(519,Ft.ReadOnly,[0,1]);const Jo=7680;class pi{constructor(t,a,h,g,_,w){this.test=t,this.ref=a,this.mask=h,this.fail=g,this.depthFail=_,this.pass=w}}pi.disabled=new pi({func:519,mask:0},0,0,Jo,Jo,Jo);const Or=1029,nh=2305;class ai{constructor(t,a,h){this.enable=t,this.mode=a,this.frontFace=h}}function du(d,t){const a=s.c6(d,3);s.c8(d,t),s.cc(d,3,a)}function hu(d,t){const a=s.c3([]);return s.c4(a,a,-t),s.c5(a,a,-d),a}function Dl(d,t){const a=[d[0],d[1],0],h=[t[0],t[1],0];if(s.ae(a)>=1e-15){const w=s.au([],a);s.c1(h,w,s.bG(h,w)),t[0]=h[0],t[1]=h[1]}const g=s.bF([],t,d);if(s.c2(g)<1e-15)return null;const _=Math.atan2(-g[1],g[0]);return hu(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),_)}ai.disabled=new ai(!1,Or,nh),ai.backCCW=new ai(!0,Or,nh),ai.backCW=new ai(!0,Or,2304),ai.frontCW=new ai(!0,1028,2304),ai.frontCCW=new ai(!0,1028,nh);class hx{constructor(t,a){this.position=t,this.orientation=a}get position(){return this._position}set position(t){if(t){const a=t instanceof s.ac?t:new s.ac(t[0],t[1],t[2]);this._renderWorldCopies&&(a.x=s.bQ(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(t,a){if(this.orientation=null,!this.position)return;const h=this.position,g=this._elevation?this._elevation.getAtPointOrZero(s.ac.fromLngLat(t)):0,_=s.ac.fromLngLat(t,g),w=[_.x-h.x,_.y-h.y,_.z-h.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=Dl(w,a)}setPitchBearing(t,a){this.orientation=hu(s.al(t),s.al(-a))}}class Qo{constructor(t,a){this._transform=s.bx([]),this.orientation=a,this.position=t}get mercatorPosition(){const t=this.position;return new s.ac(t[0],t[1],t[2])}get position(){const t=s.c6(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var a;t&&s.cc(this._transform,3,[(a=t)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||s.c3([]),t&&du(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,a){this._orientation=hu(t,a),du(this._transform,this._orientation)}forward(){const t=s.c6(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=s.c6(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=s.c6(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,a){const h=new Float64Array(16);return s.bi(h,this.getWorldToCamera(t,a)),h}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,a,h){const g=this.position;s.c1(g,g,-t);const _=new Float64Array(16);return s.bn(_,[h,h,h]),s.bo(_,_,g),_[10]*=a,_}getWorldToCamera(t,a){const h=new Float64Array(16),g=new Float64Array(4),_=this.position;return s.c7(g,this._orientation),s.c1(_,_,-t),s.c8(h,g),s.bo(h,h,_),h[1]*=-1,h[5]*=-1,h[9]*=-1,h[13]*=-1,h[8]*=a,h[9]*=a,h[10]*=a,h[11]*=a,h}getCameraToClipPerspective(t,a,h,g){const _=new Float64Array(16);return s.c9(_,t,a,h,g),_}getCameraToClipOrthographic(t,a,h,g,_,w){const T=new Float64Array(16);return s.ca(T,t,a,h,g,_,w),T}getDistanceToElevation(t,a=!1){const h=t===0?0:s.cb(t,a?s.aY(this.position[1]):this.position[1]),g=this.forward();return(h-this.position[2])/g[2]}clone(){return new Qo([...this.position],[...this.orientation])}}const qs={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class rh{constructor(t=0,a=0,h=0,g=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(h)||h<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=h,this.right=g}interpolate(t,a,h){return a.top!=null&&t.top!=null&&(this.top=s.ai(t.top,a.top,h)),a.bottom!=null&&t.bottom!=null&&(this.bottom=s.ai(t.bottom,a.bottom,h)),a.left!=null&&t.left!=null&&(this.left=s.ai(t.left,a.left,h)),a.right!=null&&t.right!=null&&(this.right=s.ai(t.right,a.right,h)),this}getCenter(t,a){const h=s.ay((this.left+t-this.right)/2,0,t),g=s.ay((this.top+a-this.bottom)/2,0,a);return new s.P(h,g)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new rh(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const cs=15;class Vm{constructor(t,a,h,g,_,w,T){this.tileSize=512,this._renderWorldCopies=_===void 0||_,this._minZoom=t||0,this._maxZoom=a||22,this._minPitch=h??0,this._maxPitch=g??60,this.setProjection(w),this.setMaxBounds(T),this.width=0,this.height=0,this._center=new s.ci(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new rh,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Qo,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new Vm(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<cs}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,a=!1){const h=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||h)&&this._updateCameraOnTerrain(),(t||h)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return s.aF(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=s.cj(this.projectionOptions);const h=this.getProjection(),g=!s.bv(a,h);return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.cj({name:"mercator"});const a=t!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.cb(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bQ(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const a=-t*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=s.ck(),s.cl(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const a=s.ay(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=s.al(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const a=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,a=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!a||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const h=this._elevation;a||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&h.exaggeration()&&this._centerAltitudeValidForExaggeration!==h.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*h.exaggeration(),this._centerAltitudeValidForExaggeration=h.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=h.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],h=this.horizonLineFromTop();let g=0,_=0;for(let w=0;w<a.length;w++){const T=new s.P(a[w][0]*this.width,h+a[w][1]*(this.height-h)),C=t.pointCoordinate(T);if(!C)continue;const R=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);g+=C[3]*R,_+=R}return _===0?NaN:g/_}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),h=this.pixelsPerMeter/this.worldSize*a,g=this._mercatorZfromZoom(t),_=this._mercatorZfromZoom(this._maxZoom),w=Math.max(g-h,_);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let h;h=t.z<this._camera.position[2]?[a.x,a.y,a.z]:[t.x,t.y,t.z];const g=s.ae(s.at([],this._camera.position,h));return s.ay(this._zoomFromMercatorZ(g),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let a=!1;if(t.orientation&&!s.cm(t.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(t.orientation)),t.position){const h=[t.position.x,t.position.y,t.position.z];s.cn(h,this._camera.position)||(this._setCameraPosition(h),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,a=new hx;return a.position=new s.ac(t[0],t[1],t[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(t){if(!s.co(t))return!1;s.cp(t,t);const a=s.cq([],[0,0,-1],t),h=s.cq([],[0,-1,0],t);if(h[2]<0)return!1;const g=Dl(a,h);return!!g&&(this._camera.orientation=g,!0)}_setCameraPosition(t){const a=this.zoomScale(this.minZoom)*this.tileSize,h=this.zoomScale(this.maxZoom)*this.tileSize,g=this.cameraToCenterDistance;t[2]=s.ay(t[2],g/h,g/a),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,h){this._unmodified=!1,this._edgeInsets.interpolate(t,a,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const a=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(t){const a=[new s.cr(0,t)];if(this.renderWorldCopies){const h=this.pointCoordinate(new s.P(0,0)),g=this.pointCoordinate(new s.P(this.width,0)),_=this.pointCoordinate(new s.P(this.width,this.height)),w=this.pointCoordinate(new s.P(0,this.height)),T=Math.floor(Math.min(h.x,g.x,_.x,w.x)),C=Math.floor(Math.max(h.x,g.x,_.x,w.x)),R=1;for(let D=T-R;D<=C+R;D++)D!==0&&a.push(new s.cr(D,t))}return a}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,a,h){let g=[];const _=h!=null,w=!_;if(w&&this.zoom<a||_&&h[0]===0&&h[1]===0)return g;const T=new Set,C=(D,z,k,F,q)=>{const $=s.cV(z,D,k,F,q);T.has($)||(g.push(new s.aM(D,z,k,F,q)),T.add($))};for(let D=0;D<t.length;D++){const z=t[D];if(w&&z.canonical.z!==a)continue;const k=z.canonical,F=z.overscaledZ,q=z.wrap,$=1<<k.z,X=k.x+1<$,Z=k.x>0,ne=k.y+1<$,ae=k.y>0,de=z.wrap-(Z?0:1),_e=z.wrap+(X?0:1),be=Z?k.x-1:$-1,Te=X?k.x+1:0;if(_)h[0]<0?(C(F,_e,k.z,Te,k.y),h[1]<0&&ne&&(C(F,q,k.z,k.x,k.y+1),C(F,_e,k.z,Te,k.y+1)),h[1]>0&&ae&&(C(F,q,k.z,k.x,k.y-1),C(F,_e,k.z,Te,k.y-1))):h[0]>0?(C(F,de,k.z,be,k.y),h[1]<0&&ne&&(C(F,q,k.z,k.x,k.y+1),C(F,de,k.z,be,k.y+1)),h[1]>0&&ae&&(C(F,q,k.z,k.x,k.y-1),C(F,de,k.z,be,k.y-1))):h[1]<0&&ne?C(F,q,k.z,k.x,k.y+1):ae&&C(F,q,k.z,k.x,k.y-1);else{const ye=z.visibleQuadrants;1&ye&&(C(F,de,k.z,be,k.y),ae&&(C(F,q,k.z,k.x,k.y-1),C(F,de,k.z,be,k.y-1))),2&ye&&(C(F,_e,k.z,Te,k.y),ae&&(C(F,q,k.z,k.x,k.y-1),C(F,_e,k.z,Te,k.y-1))),4&ye&&(C(F,de,k.z,be,k.y),ne&&(C(F,q,k.z,k.x,k.y+1),C(F,de,k.z,be,k.y+1))),8&ye&&(C(F,_e,k.z,Te,k.y),ne&&(C(F,q,k.z,k.x,k.y+1),C(F,_e,k.z,Te,k.y+1)))}}const R=[];for(const D of g)g.some(z=>D.isChildOf(z))||R.push(D);if(g=R.filter(D=>!t.some(z=>!!(D.overscaledZ<a&&z.isChildOf(D))||D.equals(z)||D.isChildOf(z))),w){const D=1<<a,z=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),k=[D*z.x,D*z.y],F=4,q=F*F;g=g.filter($=>{const X=$.canonical.x+.5-k[0],Z=$.canonical.y+.5-k[1];return X*X+Z*Z<q})}return g}extendTileCoverToNearPlane(t,a,h){const g=[],_=new Set;for(const ne of t)_.add(ne.key);const w=(ne,ae,de,_e,be)=>{const Te=s.cV(ae,ne,de,_e,be);_.has(Te)||(g.push(new s.aM(ne,ae,de,_e,be)),_.add(Te))},T=t.reduce((ne,ae)=>Math.max(ne,ae.overscaledZ),h),C=1<<h,R=[new s.P(0,0),new s.P(s.aj,0),new s.P(s.aj,s.aj),new s.P(0,s.aj)],D=new s.P(0,0),z=new s.P(0,0),k=(ne,ae)=>{const de=Math.floor(ne[0]),_e=Math.floor(ne[1]),be=(ne[0]-de)*s.aj,Te=(ne[1]-_e)*s.aj,ye=Math.floor(ae[0]),xe=Math.floor(ae[1]),ve=(ae[0]-ye)*s.aj,Oe=(ae[1]-xe)*s.aj;for(let Pe=-1;Pe<=1;Pe++){const Ye=de+Pe;if(!(Ye<0||Ye>=C)){D.x=be-Pe*s.aj,z.x=ve-(Ye-ye)*s.aj;for(let Ue=-1;Ue<=1;Ue++){const Qe=_e+Ue;D.y=Te-Ue*s.aj,z.y=Oe-(Qe-xe)*s.aj,s.cW(D,z,R)&&w(T,0,h,Ye,Qe)}}}},F=a.points,q=F[s.cs],$=F[s.ct],X=this._projectToGround(q,F[s.cu]),Z=this._projectToGround($,F[s.cv]);return k(q,X),k($,Z),g}_projectToGround(t,a){return s.cw(s.cx(),t,a,t[2]/(t[2]-a[2]))}coveringTiles(t){let a=this.coveringZoomLevel(t);const h=a,g=this.elevation&&this.elevation.exaggeration(),_=g&&!t.isTerrainDEM,w=this.projection.name==="mercator";if(t.minzoom!==void 0&&a<t.minzoom)return[];t.maxzoom!==void 0&&a>t.maxzoom&&(a=t.maxzoom);const T=this.locationCoordinate(this.center),C=this.center.lat,R=1<<a,D=[R*T.x,R*T.y,0],z=this.projection.name==="globe",k=!z,F=s.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,k),q=z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),$=R*s.cb(1,this.center.lat),X=this._camera.position[2]/s.cb(1,this.center.lat),Z=[R*q.x,R*q.y,X*(k?1:$)],ne=z||g,ae=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),de=this.isLODDisabled(!0)?a:0;let _e;if(this._elevation&&t.isTerrainDEM)_e=1e4*this._elevation.exaggeration();else if(this._elevation){const Ae=this._elevation.getMinMaxForVisibleTiles();_e=Ae?Ae.max:this._centerAltitude}else _e=this._centerAltitude;const be=t.isTerrainDEM?-_e:this._elevation?this._elevation.getMinElevationBelowMSL():0,Te=this.projection.isReprojectedInTileSpace?s.cz(this):1,ye=Ae=>{const je=new s.ac(Ae.x+25e-6,Ae.y,Ae.z),nt=new s.ac(Ae.x,Ae.y+25e-6,Ae.z),st=Ae.toLngLat(),ct=je.toLngLat(),St=nt.toLngLat(),Ht=this.locationCoordinate(st),Qt=this.locationCoordinate(ct),Lt=this.locationCoordinate(St),Yt=Math.hypot(Qt.x-Ht.x,Qt.y-Ht.y),Wt=Math.hypot(Lt.x-Ht.x,Lt.y-Ht.y);return Math.sqrt(Yt*Wt)*Te/25e-6},xe=Ae=>{const qe=_e,je=be;return{aabb:s.cC(this,R,0,0,0,Ae,je,qe,this.projection),zoom:0,x:0,y:0,minZ:je,maxZ:qe,wrap:Ae,fullyVisible:!1}},ve=[];let Oe=[];const Pe=a,Ye=t.reparseOverscaled?h:a,Ue=(X-this._centerAltitude)*$,Qe=Ae=>{if(!this._elevation||!Ae.tileID||!w)return;const qe=this._elevation.getMinMaxForTile(Ae.tileID),je=Ae.aabb;qe?(je.min[2]=qe.min,je.max[2]=qe.max,je.center[2]=(je.min[2]+je.max[2])/2):(Ae.shouldSplit=Fe(Ae),Ae.shouldSplit||(je.min[2]=je.max[2]=je.center[2]=this._centerAltitude))},_t=(Ae,qe)=>{if(.707*qe<Ae)return 1;const je=qe/Ae;return je/(1.4144271570014144+(Math.pow(1.1,je-1.4144271570014144+1)-1)/(1.1-1)-1)},Fe=Ae=>{if(Ae.zoom<de)return!0;if(Ae.zoom===Pe)return!1;if(Ae.shouldSplit!=null)return Ae.shouldSplit;const qe=Ae.aabb.distanceX(Z),je=Ae.aabb.distanceY(Z);let nt=Ue,st=1;if(z){nt=Ae.aabb.distanceZ(Z);const Wt=Math.pow(2,Ae.zoom),xi=s.aY((Ae.y+1)/Wt),Mi=s.aY(Ae.y/Wt),Ui=Math.min(Math.max(C,xi),Mi),cn=s.c_(Ui)/s.c_(C);if(st=Ui===C?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,cn/this._mercatorScaleRatio),this.zoom<=s.cX&&Ae.zoom===Pe-1&&cn>=.9)return!0}else if(_&&(nt=Ae.aabb.distanceZ(Z)*$),this.projection.isReprojectedInTileSpace&&h<=5){const Wt=Math.pow(2,Ae.zoom),xi=ye(new s.ac((Ae.x+.5)/Wt,(Ae.y+.5)/Wt));st=xi>.85?1:xi}if(!w){const Wt=Math.sqrt(qe*qe+je*je+nt*nt);let xi=(1<<Pe-Ae.zoom)*ae*st;return xi*=_t(Math.max(nt,Ue),Wt),Wt<xi}let ct=Number.MAX_VALUE,St=0;const Ht=Ae.aabb.getCorners(),Qt=[];for(const Wt of Ht){s.at(Qt,Wt,Z),z||(_?Qt[2]*=$:Qt[2]=Ue);const xi=s.bG(Qt,this._camera.forward());xi<ct&&(ct=xi,St=Math.abs(Qt[2]))}let Lt=(1<<Pe-Ae.zoom)*ae*st;if(Lt*=_t(Math.max(St,Ue),ct),ct<Lt)return!0;const Yt=Ae.aabb.closestPoint(D);return Yt[0]===D[0]&&Yt[1]===D[1]};if(this.renderWorldCopies)for(let Ae=1;Ae<=3;Ae++)ve.push(xe(-Ae)),ve.push(xe(Ae));for(ve.push(xe(0));ve.length>0;){const Ae=ve.pop(),qe=Ae.x,je=Ae.y;let nt=Ae.fullyVisible;const st=()=>this.projection.name==="globe"&&(Ae.y===0||Ae.y===(1<<Ae.zoom)-1);if(!nt){let ct=ne?Ae.aabb.intersects(F):Ae.aabb.intersectsFlat(F);if(ct===0&&st()){const St=new s.cA(Ae.zoom,qe,je);ct=s.cB(this,R,St,!0).intersects(F)}if(ct===0)continue;nt=ct===2}if(Ae.zoom!==Pe&&Fe(Ae))for(let ct=0;ct<4;ct++){const St=(qe<<1)+ct%2,Ht=(je<<1)+(ct>>1),Qt={aabb:w?Ae.aabb.quadrant(ct):s.cC(this,R,Ae.zoom+1,St,Ht,Ae.wrap,Ae.minZ,Ae.maxZ,this.projection),zoom:Ae.zoom+1,x:St,y:Ht,wrap:Ae.wrap,fullyVisible:nt,tileID:void 0,shouldSplit:void 0,minZ:Ae.minZ,maxZ:Ae.maxZ};_&&!z&&(Qt.tileID=new s.aM(Ae.zoom+1===Pe?Ye:Ae.zoom+1,Ae.wrap,Ae.zoom+1,St,Ht),Qe(Qt)),ve.push(Qt)}else{const ct=Ae.zoom===Pe?Ye:Ae.zoom;if(t.minzoom&&t.minzoom>ct)continue;let St=0;if(!nt){let Yt=ne?Ae.aabb.intersectsPrecise(F):Ae.aabb.intersectsPreciseFlat(F);if(Yt===0&&st()){const Wt=new s.cA(Ae.zoom,qe,je);Yt=s.cB(this,R,Wt,!0).intersectsPrecise(F)}if(Yt===0)continue;if(t.calculateQuadrantVisibility)if(F.containsPoint(Ae.aabb.center))St=15;else for(let Wt=0;Wt<4;Wt++)Ae.aabb.quadrant(Wt).intersects(F)!==0&&(St|=1<<Wt)}const Ht=D[0]-(.5+qe+(Ae.wrap<<Ae.zoom))*(1<<a-Ae.zoom),Qt=D[1]-.5-je,Lt=Ae.tileID?Ae.tileID:new s.aM(ct,Ae.wrap,Ae.zoom,qe,je);t.calculateQuadrantVisibility&&(Lt.visibleQuadrants=St),Oe.push({tileID:Lt,distanceSq:Ht*Ht+Qt*Qt})}}if(this.fogCullDistSq){const Ae=this.fogCullDistSq,qe=this.horizonLineFromTop();Oe=Oe.filter(je=>{const nt=[0,0,0,1],st=[s.aj,s.aj,0,1],ct=this.calculateFogTileMatrix(je.tileID.toUnwrapped());s.aA(nt,nt,ct),s.aA(st,st,ct);const St=s.cD([],nt,st),Ht=s.cE([],nt,st),Qt=s.cY(St,Ht);if(Qt===0)return!0;let Lt=!1;const Yt=this._elevation;if(Yt&&Qt>Ae&&qe!==0){const Wt=this.calculateProjMatrix(je.tileID.toUnwrapped());let xi;t.isTerrainDEM||(xi=Yt.getMinMaxForTile(je.tileID)),xi||(xi={min:be,max:_e});const Mi=s.cF(this.rotation),Ui=[Mi[0]*s.aj,Mi[1]*s.aj,xi.max];s.ad(Ui,Ui,Wt),Lt=(1-Ui[1])*this.height*.5<qe}return Qt<Ae||Lt})}return Oe.sort((Ae,qe)=>Ae.distanceSq-qe.distanceSq).map(Ae=>Ae.tileID)}resize(t,a){this.width=t,this.height=a,this.pixelsToGLUnits=[2/t,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const a=s.ay(t.lat,-s.cG,s.cG),h=this.projection.project(t.lng,a);return new s.P(h.x*this.worldSize,h.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.cb(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,a){let h,g;const _=this.centerPoint;if(this.projection.name==="globe"){const T=this.worldSize;h=(a.x-_.x)/T,g=(a.y-_.y)/T}else{const T=this.pointCoordinate(a),C=this.pointCoordinate(_);h=T.x-C.x,g=T.y-C.y}const w=this.locationCoordinate(t);this.setLocation(new s.ac(w.x-h,w.y-g))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,a){return this.projection.locationPoint(this,t,a)}locationPoint3D(t,a){return this.projection.locationPoint(this,t,a,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,a){return this.coordinateLocation(this.pointCoordinate3D(t,a))}locationCoordinate(t,a){const h=a?s.cb(a,t.lat):void 0,g=this.projection.project(t.lng,t.lat);return new s.ac(g.x,g.y,h)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,a){const h=a??this._centerAltitude,g=[t.x,t.y,0,1],_=[t.x,t.y,1,1];s.aA(g,g,this.pixelMatrixInverse),s.aA(_,_,this.pixelMatrixInverse);const w=_[3];s.cH(g,g,1/g[3]),s.cH(_,_,1/w);const T=g[2],C=_[2];return{p0:g,p1:_,t:T===C?0:(h-T)/(C-T)}}screenPointToMercatorRay(t){const a=[t.x,t.y,0,1],h=[t.x,t.y,1,1];return s.aA(a,a,this.pixelMatrixInverse),s.aA(h,h,this.pixelMatrixInverse),s.cH(a,a,1/a[3]),s.cH(h,h,1/h[3]),a[2]=s.cb(a[2],this._center.lat)*this.worldSize,h[2]=s.cb(h[2],this._center.lat)*this.worldSize,s.cH(a,a,1/this.worldSize),s.cH(h,h,1/this.worldSize),new s.av([a[0],a[1],a[2]],s.au([],s.at([],h,a)))}rayIntersectionCoordinate(t){const{p0:a,p1:h,t:g}=t,_=s.cb(a[2],this._center.lat),w=s.cb(h[2],this._center.lat);return new s.ac(s.ai(a[0],h[0],g)/this.worldSize,s.ai(a[1],h[1],g)/this.worldSize,s.ai(_,w,g))}pointCoordinate(t,a=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,a)}pointCoordinate3D(t,a){if(!this.elevation)return this.pointCoordinate(t,a);let h=this.projection.pointCoordinate3D(this,t.x,t.y);if(h)return new s.ac(h[0],h[1],h[2]);let g=0,_=this.horizonLineFromTop();if(t.y>_)return this.pointCoordinate(t,a);const w=.02*_,T=t.clone();for(let C=0;C<10&&_-g>w;C++){T.y=s.ai(g,_,.66);const R=this.projection.pointCoordinate3D(this,T.x,T.y);R?(_=T.y,h=R):g=T.y}return h?new s.ac(h[0],h[1],h[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=s.cI)return!this.isPointAboveHorizon(t);const a=this.pointCoordinate(t);return a.y>=0&&a.y<=1}_coordinatePoint(t,a){const h=a&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,g=[t.x*this.worldSize,t.y*this.worldSize,h+t.toAltitude(),1];return s.aA(g,g,this.pixelMatrix),g[3]>0?new s.P(g[0]/g[3],g[1]/g[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:a}=this._edgeInsets,h=this.height-this._edgeInsets.bottom,g=this.width-this._edgeInsets.right,_=this.pointLocation3D(new s.P(a,t)),w=this.pointLocation3D(new s.P(g,t)),T=this.pointLocation3D(new s.P(g,h)),C=this.pointLocation3D(new s.P(a,h));let R=Math.min(_.lng,w.lng,T.lng,C.lng),D=Math.max(_.lng,w.lng,T.lng,C.lng),z=Math.min(_.lat,w.lat,T.lat,C.lat),k=Math.max(_.lat,w.lat,T.lat,C.lat);const F=Math.pow(2,-this.zoom)/16*270,q=this.projection.name==="globe"?1:4,$=(X,Z,ne,ae,de)=>{const _e=(X+ne)/2,be=(Z+ae)/2,Te=new s.P(_e,be),{lng:ye,lat:xe}=this.pointLocation3D(Te),ve=Math.max(0,R-ye,z-xe,ye-D,xe-k);R=Math.min(R,ye),D=Math.max(D,ye),z=Math.min(z,xe),k=Math.max(k,xe),(de<q||ve>F)&&($(X,Z,_e,be,de+1),$(_e,be,ne,ae,de+1))};if($(a,t,g,t,1),$(g,t,g,h,1),$(g,h,a,h,1),$(a,h,a,t,1),this.projection.name==="globe"){const[X,Z]=s.cJ(this);X?(k=90,D=180,R=-180):Z&&(z=-90,D=180,R=-180)}return new s.aG(new s.ci(R,z),new s.ci(D,k))}_getBoundsRectangular(t,a){const{top:h,left:g}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,T=new s.P(g,h),C=new s.P(w,h),R=new s.P(w,_),D=new s.P(g,_);let z=this.pointCoordinate(T,t),k=this.pointCoordinate(C,t);const F=this.pointCoordinate(R,a),q=this.pointCoordinate(D,a),$=(X,Z)=>(Z.y-X.y)/(Z.x-X.x);return z.y>1&&k.y>=0?z=new s.ac((1-q.y)/$(q,z)+q.x,1):z.y<0&&k.y<=1&&(z=new s.ac(-q.y/$(q,z)+q.x,0)),k.y>1&&z.y>=0?k=new s.ac((1-F.y)/$(F,k)+F.x,1):k.y<0&&z.y<=1&&(k=new s.ac(-F.y/$(F,k)+F.x,0)),new s.aG().extend(this.coordinateLocation(z)).extend(this.coordinateLocation(k)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(F))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const a=t.visibleDemTiles.reduce((h,g)=>{if(g.dem){const _=g.dem.tree;h.min=Math.min(h.min,_.minimums[0]),h.max=Math.max(h.max,_.maximums[0])}return h},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*t.exaggeration(),a.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,h=this.height/2-a*(1-this._horizonShift);return t?Math.max(0,h):h}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-s.cG,this.maxLat=s.cG,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.aD(this.minLng)*this.tileSize,this.worldMaxX=s.aD(this.maxLng)*this.tileSize,this.worldMinY=s.aH(this.maxLat)*this.tileSize,this.worldMaxY=s.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,a){return this.projection.createTileMatrix(this,a,t)}calculateDistanceTileData(t){const a=t.key,h=this._distanceTileDataCache;if(h[a])return h[a];const g=t.canonical,_=1/this.height,w=this.cameraWorldSize,T=w/this.zoomScale(g.z),C=(g.x+Math.pow(2,g.z)*t.wrap)*T,R=g.y*T,D=this.point;D.x*=w/this.worldSize,D.y*=w/this.worldSize;const z=this.angle,k=Math.sin(-z),F=-Math.cos(-z);return h[a]={bearing:[k,F],center:[(D.x-C)*_,(D.y-R)*_],scale:T/s.aj*_},h[a]}calculateFogTileMatrix(t){const a=t.key,h=this._fogTileMatrixCache;if(h[a])return h[a];const g=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return s.az(g,this.worldToFogMatrix,g),h[a]=new Float32Array(g),h[a]}calculateProjMatrix(t,a=!1,h=!1){const g=t.key;let _;if(_=h?this._expandedProjMatrixCache:a?this._alignedProjMatrixCache:this._projMatrixCache,_[g])return _[g];const w=this.calculatePosMatrix(t,this.worldSize);let T;return T=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.expandedFarZProjMatrix:a?this.alignedProjMatrix:this.projMatrix,s.az(w,T,w),_[g]=new Float32Array(w),_[g]}calculatePixelsToTileUnitsMatrix(t){const a=t.tileID.key,h=this._pixelsToTileUnitsCache;if(h[a])return h[a];const g=s.cK(t,this);return h[a]=g,h[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,a=s.bn([],[t,t,t]);return s.az(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const a=s.cb(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(a),g=this._camera.forward(),_=s.cb(1,this._center.lat);h[2]/=_,g[2]/=_,s.au(g,g);const w=t.raycast(h,g,t.exaggeration());if(w){const T=s.bE([],h,g,w),C=new s.ac(T[0],T[1],s.cb(T[2],s.aY(T[1]))),R=(C.z+s.ae([C.x-h[0],C.y-h[1],C.z-h[2]*_]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(R),this._centerAltitude=C.toAltitude(),this._center=this.coordinateLocation(C),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const a=this._elevation,h=s.cb(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(h),_=a.getAtPointOrZero(new s.ac(...g)),w=this.pixelsPerMeter/this.worldSize*_,T=this._minimumHeightOverTerrain(),C=g[2]-w;if(C<=T)if(C<0||t){const R=this.locationCoordinate(this._center,this._centerAltitude),D=[g[0],g[1],R.z-g[2]],z=s.ae(D);D[2]-=(T-C)/this._pixelsPerMercatorPixel;const k=s.ae(D);if(k===0)return;s.c1(D,D,z/k*this._pixelsPerMercatorPixel),this._camera.position=[g[0],g[1],R.z*this._pixelsPerMercatorPixel-D[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const k=this.center;return k.lat=s.ay(k.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(k.lng=s.ay(k.lng,this.minLng,this.maxLng)),this.center=k,void(this._constraining=!1)}const a=this._unmodified,{x:h,y:g}=this.point;let _=0,w=h,T=g;const C=this.width/2,R=this.height/2,D=this.worldMinY*this.scale,z=this.worldMaxY*this.scale;if(g-R<D&&(T=D+R),g+R>z&&(T=z-R),z-D<this.height&&(_=Math.max(_,this.height/(z-D)),T=(z+D)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const k=this.worldMinX*this.scale,F=this.worldMaxX*this.scale,q=this.worldSize/2-(k+F)/2;w=(h+q+this.worldSize)%this.worldSize-q,w-C<k&&(w=k+C),w+C>F&&(w=F-C),F-k<this.width&&(_=Math.max(_,this.width/(F-k)),w=(F+k)/2)}w===h&&T===g||this._allowWorldUnderZoom||(this.center=this.unproject(new s.P(w,T))),_&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(_)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,a=this.projection.name==="globe",h=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.cb(1,this.center.lat)/s.cb(1,s.c$));const g=s.cL(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this.projection.zAxisUnit==="meters"?h:1,w=this._camera.getWorldToCamera(this.worldSize,_);let T;const C=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(C[8]=2*-t.x/this.width,C[9]=2*t.y/this.height,this.isOrthographic){let xe=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ve=xe*this.aspect,Oe=-ve,Pe=-xe;ve-=t.x,Oe-=t.x,xe+=t.y,Pe+=t.y,T=this._camera.getCameraToClipOrthographic(Oe,ve,Pe,xe,this._nearZ,this._farZ),((Ye,Ue,Qe,_t)=>{for(let Fe=0;Fe<16;Fe++)Ye[Fe]=s.ai(Ue[Fe],Qe[Fe],_t)})(T,T,C,s.cZ(this.pitch>=cs?1:this.pitch/cs))}else T=C;const R=s.cM([],C,w);let D=s.cM([],T,w);if(this.projection.isReprojectedInTileSpace){const xe=this.locationCoordinate(this.center),ve=s.bx([]);s.bo(ve,ve,[xe.x*this.worldSize,xe.y*this.worldSize,0]),s.az(ve,ve,s.cN(this)),s.bo(ve,ve,[-xe.x*this.worldSize,-xe.y*this.worldSize,0]),s.az(D,D,ve),s.az(R,R,ve),this.inverseAdjustmentMatrix=s.cO(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.cP([],D,[this.worldSize,this.worldSize,this.worldSize/_,1]),this.projMatrix=D,this.invProjMatrix=s.bi(new Float64Array(16),this.projMatrix),a){const xe=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);xe[8]=2*-t.x/this.width,xe[9]=2*t.y/this.height,this.expandedFarZProjMatrix=s.cM([],xe,w)}else this.expandedFarZProjMatrix=this.projMatrix;const z=s.bi([],T);this.frustumCorners=s.cQ.fromInvProjectionMatrix(z,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!a);const k=new Float32Array(16);s.bx(k),s.cP(k,k,[1,-1,1]),s.cR(k,k,this._pitch),s.by(k,k,this.angle);const F=s.c9(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.bw(F);const q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;F[8]=2*-t.x/this.width,F[9]=2*(t.y+q)/this.height,this.skyboxMatrix=s.az(k,F,k);const $=this.point,X=$.x,Z=$.y,ne=this.width%2/2,ae=this.height%2/2,de=Math.cos(this.angle),_e=Math.sin(this.angle),be=X-Math.round(X)+de*ne+_e*ae,Te=Z-Math.round(Z)+de*ae+_e*ne,ye=new Float64Array(D);if(s.bo(ye,ye,[be>.5?be-1:be,Te>.5?Te-1:Te,0]),this.alignedProjMatrix=ye,D=s.bz(),s.cP(D,D,[this.width/2,-this.height/2,1]),s.bo(D,D,[1,-1,0]),this.labelPlaneMatrix=D,D=s.bz(),s.cP(D,D,[1,-1,1]),s.bo(D,D,[-1,-1,0]),s.cP(D,D,[2/this.width,2/this.height,1]),this.glCoordMatrix=D,this.pixelMatrix=s.az(new Float64Array(16),this.labelPlaneMatrix,R),this._calcFogMatrices(),this._distanceTileDataCache={},D=s.bi(new Float64Array(16),this.pixelMatrix),!D)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=D,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.cS(this);const xe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.ad(xe,xe,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=D;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,h=this._camera.position,g=1/this.height/this._pixelsPerMercatorPixel,_=[t,t,a];s.c1(_,_,g),s.c1(h,h,-1),s.cT(h,h,_);const w=s.bz();s.bo(w,w,h),s.cP(w,w,_),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,a,g)}_computeCameraPosition(t){const a=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,h=this._camera.forward(),g=this.point,_=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-t/this.worldSize*this._centerAltitude;return[g.x/this.worldSize-h[0]*_,g.y/this.worldSize-h[1]*_,t/this.worldSize*this._centerAltitude-h[2]*_]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),h=this._camera.position[2],g=t[2];let _=1;this.projection.wrap&&(this.center=this.center.wrap()),g>0&&(_=Math.min((a-h)/g,1)),this._camera.position=s.bE([],this._camera.position,t,_),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,a=this._camera.forward(),{pitch:h,bearing:g}=this._camera.getPitchBearing(),_=s.cb(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.al(this._maxPitch)),T=Math.max((t[2]-_)/Math.cos(h),w),C=this._zoomFromMercatorZ(T);s.bE(t,t,a,T),this._pitch=s.ay(h,s.al(this.minPitch),s.al(this.maxPitch)),this.angle=s.bQ(g,-Math.PI,Math.PI),this._setZoom(s.ay(C,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.ac(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let a=0,h=s.cI,g=0,_=1/0;for(;h-a>1e-6&&h>a;){const w=a+.5*(h-a),T=this.tileSize*Math.pow(2,w),C=this.getCameraToCenterDistance(this.projection,w,T),R=this.scaleZoom(C/(Math.max(0,t)*this.tileSize)),D=Math.abs(w-R);D<_&&(_=D,g=w),w<R?a=w:h=w}return g}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,a){const h=Math.min(t.x,a.x),g=Math.max(t.x,a.x),_=Math.min(t.y,a.y),w=Math.max(t.y,a.y);if(_<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const T=[new s.P(h,_),new s.P(g,w),new s.P(h,w),new s.P(g,_)],C=this.renderWorldCopies?-3:0,R=this.renderWorldCopies?4:1;for(const D of T){const z=this.pointRayIntersection(D);if(z.t<0)return!0;const k=this.rayIntersectionCoordinate(z);if(k.x<C||k.y<0||k.x>R||k.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.cU(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(t,a){const h=s.ae(s.at([],this._camera.position,t)),g=this._zoomFromMercatorZ(h)+a;return h-this._mercatorZfromZoom(g)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([a,h,g],_){const w=[a,h,g,1];s.aA(w,w,_);const T=w[3]=Math.max(w[3],1e-6);return w[0]/=T,w[1]/=T,w[2]/=T,w}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,t))}}getCameraToCenterDistance(t,a=this.zoom,h=this.worldSize){const g=s.cL(t,a,this.width,this.height,1024),_=t.pixelSpaceConversion(this.center.lat,h,g);let w=.5/Math.tan(.5*this._fov)*this.height*_;return this.isOrthographic&&(w=s.ai(1,w,s.cZ(this.pitch>=cs?1:this.pitch/cs))),w}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.az(t,t,this.globeMatrix),t}getFrustum(t){return s.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const ka=(d,t)=>{if(t>0&&d.terrain&&s.w("Cutoff is currently disabled on terrain"),t<=0||d.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const a=d.transform,h=Math.max(Math.abs(a._zoom-(d.minCutoffZoom-1)),1),g=a.isLODDisabled(!1)?s.af(60,45,a.pitch):s.af(30,15,a.pitch),_=a._farZ-a._nearZ,w=t*a.height,T=((1-(C=g))*a.cameraToCenterDistance+C*(a._farZ+w))*h;var C;return{shouldRenderCutoff:g<1,uniformValues:{u_cutoff_params:[a._nearZ,a._farZ,(T-a._nearZ)/_,(T-w-a._nearZ)/_]}}},zs={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class sh{constructor(t,a){this.aabb=t,this.lastCascade=a}}class $w{add(t,a){const h=this.receivers[t.key];h!==void 0?(h.aabb.min[0]=Math.min(h.aabb.min[0],a.min[0]),h.aabb.min[1]=Math.min(h.aabb.min[1],a.min[1]),h.aabb.min[2]=Math.min(h.aabb.min[2],a.min[2]),h.aabb.max[0]=Math.max(h.aabb.max[0],a.max[0]),h.aabb.max[1]=Math.max(h.aabb.max[1],a.max[1]),h.aabb.max[2]=Math.max(h.aabb.max[2],a.max[2])):this.receivers[t.key]=new sh(a,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,a,h){const g=s.d6.fromPoints(t.points);let _=0;for(const w in this.receivers){const T=this.receivers[w];if(!T||!g.intersectsAabb(T.aabb))continue;T.aabb.min=g.closestPoint(T.aabb.min),T.aabb.max=g.closestPoint(T.aabb.max);const C=T.aabb.getCorners();for(let R=0;R<h.length;R++){let D=!0;for(const z of C){const k=[z[0]*a,z[1]*a,z[2]];if(s.ad(k,k,h[R].matrix),k[0]<-1||k[0]>1||k[1]<-1||k[1]>1){D=!1;break}}if(T.lastCascade=R,_=Math.max(_,R),D)break}}return _+1}}class Hw{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new $w,this._depthMode=new Ft(t.context.gl.LEQUAL,Ft.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(zs,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(zs,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(zs,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,a){const h=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!a||!a.properties)return;const g=a.properties.get("shadow-intensity");if(!a.shadowsEnabled()||g<=0||(this._shadowLayerCount=h.style.order.reduce((q,$)=>{const X=h.style._mergedLayers[$];return q+(X.hasShadowPass()&&!X.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const _=h.context,w=zs.shadowMapResolution,T=zs.shadowMapResolution;if(this._cascades.length===0||zs.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let q=0;q<zs.cascadeCount;++q){const $=h._shadowMapDebug,X=_.gl,Z=_.createFramebuffer(w,T,$,"texture"),ne=new s.T(_,{width:w,height:T,data:null},X.DEPTH_COMPONENT16);if(Z.depthAttachment.set(ne.texture),$){const ae=new s.T(_,{width:w,height:T,data:null},X.RGBA8);Z.colorAttachment.set(ae.texture)}this._cascades.push({framebuffer:Z,texture:ne,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.cy,scale:0})}}this.shadowDirection=fu(a);let C=0;if(t.elevation){const q=t.elevation,$=[1e4,-1e4];q.visibleDemTiles.filter(X=>X.dem).forEach(X=>{const Z=X.dem.tree;$[0]=Math.min($[0],Z.minimums[0]),$[1]=Math.max($[1],Z.maximums[0])}),$[0]!==1e4&&(C=($[1]-$[0])*q.exaggeration())}const R=1.5*t.cameraToCenterDistance,D=3*R,z=new Float64Array(16);for(let q=0;q<this._cascades.length;++q){const $=this._cascades[q];let X=t.height/50,Z=1;zs.cascadeCount===1?Z=D:q===0?Z=R:(X=R,Z=D);const[ne,ae]=pu(t,this.shadowDirection,X,Z,zs.shadowMapResolution,C);$.scale=t.scale,$.matrix=ne,$.boundingSphereRadius=ae,s.bi(z,$.matrix),$.frustum=s.cy.fromInvProjectionMatrix(z,1,0,!0),$.far=Z}const k=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[k].far,this._cascades[k].far],this._uniformValues.u_shadow_intensity=g,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/zs.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=zs.shadowMapResolution,this._uniformValues.u_shadowmap_0=qs.ShadowMap0,this._uniformValues.u_shadowmap_1=qs.ShadowMap0+1,this._groundShadowTiles=h.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const F=h.transform.elevation;for(const q of this._groundShadowTiles){let $={min:0,max:0};if(F){const X=F.getMinMaxForTile(q);X&&($=X)}this.addShadowReceiver(q.toUnwrapped(),$.min,$.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,a){if(!this.enabled)return;const h=this.painter,g=h.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(h.transform.getFrustum(0),h.transform.worldSize,this._cascades),g.viewport.set([0,0,zs.shadowMapResolution,zs.shadowMapResolution]);for(let _=0;_<this._numCascadesToRender;++_){h.currentShadowCascade=_,g.bindFramebuffer.set(this._cascades[_].framebuffer.framebuffer),g.clear({color:s.am.white,depth:1});for(const w of t.order){const T=t._mergedLayers[w];if(!T.hasShadowPass()||T.isHidden(h.transform.zoom))continue;const C=t.getLayerSourceCache(T),R=C?a[C.id]:void 0;(T.type==="model"||R&&R.length)&&h.renderLayer(h,C,T,R)}}h.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,a=t.style,h=t.context,g=h.gl,_=a.directionalLight,w=a.ambientLight;if(!_||!w)return;const T=[],C=ka(t,t.longestCutoffRange);C.shouldRenderCutoff&&T.push("RENDER_CUTOFF"),T.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&T.push("NORMAL_OFFSET");const R=bc(a,_,w),D=new Ft(g.LEQUAL,Ft.ReadOnly,t.depthRangeFor3D),z=new pi({func:g.EQUAL,mask:255},0,255,g.KEEP,g.KEEP,g.KEEP);for(const k of this._groundShadowTiles){const F=k.toUnwrapped(),q=t.isTileAffectedByFog(k),$=t.getOrCreateProgram("groundShadow",{defines:T,overrideFog:q});this.setupShadows(F,$),t.uploadCommonUniforms(h,$,F,null,C);const X={u_matrix:t.transform.calculateProjMatrix(F),u_ground_shadow_factor:R};$.draw(t,g.TRIANGLES,D,z,Ni.multiply,ai.disabled,X,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Ni.unblended:Ni.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const a=this.painter.transform,h=a.calculatePosMatrix(t,a.worldSize);return s.az(h,this._cascades[this.painter.currentShadowCascade].matrix,h),Float32Array.from(h)}calculateShadowPassMatrixFromMatrix(t){return s.az(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,a,h){if(!this.enabled)return;const g=this.painter.transform,_=this.painter.context,w=_.gl,T=this._uniformValues,C=new Float64Array(16),R=g.calculatePosMatrix(t,g.worldSize);for(let D=0;D<this._cascades.length;D++)s.az(C,this._cascades[D].matrix,R),T[D===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),_.activeTexture.set(w.TEXTURE0+qs.ShadowMap0+D),this._cascades[D].texture.bindExtraParam(w.LINEAR,w.LINEAR,w.CLAMP_TO_EDGE,w.CLAMP_TO_EDGE,w.GREATER);if(this.useNormalOffset=!!h,this.useNormalOffset){const D=s.d4(t.canonical),z=2/g.tileSize*s.aj/zs.shadowMapResolution,k=z*this._cascades[0].boundingSphereRadius,F=z*this._cascades[this._cascades.length-1].boundingSphereRadius,q=(h==="vector-tile"?1:3)*function($,X,Z,ne,ae){const de=s.ay(($-22)/-22,0,1);return .125*(1-de)+4*de}(g.zoom);T.u_shadow_normal_offset=[D,k*q,F*q],T.u_shadow_bias=[1e-4,.0012,.012]}else T.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(_,T)}setupShadowsFromMatrix(t,a,h=!1){if(!this.enabled)return;const g=this.painter.context,_=g.gl,w=this._uniformValues,T=new Float64Array(16);for(let C=0;C<zs.cascadeCount;C++)s.az(T,this._cascades[C].matrix,t),w[C===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(T),g.activeTexture.set(_.TEXTURE0+qs.ShadowMap0+C),this._cascades[C].texture.bindExtraParam(_.LINEAR,_.LINEAR,_.CLAMP_TO_EDGE,_.CLAMP_TO_EDGE,_.GREATER);if(this.useNormalOffset=h,h){const C=zs.normalOffset;w.u_shadow_normal_offset=[1,C,C],w.u_shadow_bias=[6e-5,.0012,.012]}else w.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(g,w)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,a,h,g){if(g[2]>=0)return{};const _=function(C,R,D){const z=D/(1<<C.canonical.z);return new s.d6([C.canonical.x*z+C.wrap*D,C.canonical.y*z+C.wrap*D,0],[(C.canonical.x+1)*z+C.wrap*D,(C.canonical.y+1)*z+C.wrap*D,R])}(t,a,h).getCorners(),w=a/-g[2];g[0]<0?(s.d5(_[0],_[0],[g[0]*w,0,0]),s.d5(_[3],_[3],[g[0]*w,0,0])):g[0]>0&&(s.d5(_[1],_[1],[g[0]*w,0,0]),s.d5(_[2],_[2],[g[0]*w,0,0])),g[1]<0?(s.d5(_[0],_[0],[0,g[1]*w,0]),s.d5(_[1],_[1],[0,g[1]*w,0])):g[1]>0&&(s.d5(_[2],_[2],[0,g[1]*w,0]),s.d5(_[3],_[3],[0,g[1]*w,0]));const T={};return T.vertices=_,T.planes=[kl(_[1],_[0],_[4]),kl(_[2],_[1],_[5]),kl(_[3],_[2],_[6]),kl(_[0],_[3],_[7])],T}addShadowReceiver(t,a,h){this._receivers.add(t,s.d6.fromTileIdAndHeight(t,a,h))}getMaxCascadeForTile(t){const a=this._receivers.get(t);return a&&a.lastCascade?a.lastCascade:0}}function kl(d,t,a){const h=s.at([],a,t),g=s.at([],d,t),_=s.bF([],h,g),w=s.ae(_);return w===0?[0,0,1,0]:(s.c1(_,_,1/w),[_[0],_[1],_[2],-s.bG(_,t)])}function fu(d){const t=d.properties.get("direction"),a=s.d1(t.x,t.y,t.z);a[2]=s.ay(a[2],0,75);const h=s.d3([a[0],a[1],a[2]]);return s.d2(h.x,h.y,h.z)}function bc(d,t,a){const h=t.properties.get("color-use-theme")==="none",g=t.properties.get("color"),_=t.properties.get("intensity"),w=t.properties.get("direction"),T=[w.x,w.y,w.z],C=a.properties.get("color-use-theme")==="none",R=a.properties.get("color"),D=a.properties.get("intensity"),z=Math.max(s.bG([0,0,1],T),0),k=[0,0,0];s.c1(k,R.toPremultipliedRenderColor(C?null:d.getLut(t.scope)).toArray01Linear().slice(0,3),D);const F=[0,0,0];return s.c1(F,g.toPremultipliedRenderColor(h?null:d.getLut(a.scope)).toArray01Linear().slice(0,3),z*_),s.d8([k[0]>0?k[0]/(k[0]+F[0]):0,k[1]>0?k[1]/(k[1]+F[1]):0,k[2]>0?k[2]/(k[2]+F[2]):0])}function pu(d,t,a,h,g,_){const w=d.zoom,T=d.scale,C=d.worldSize,R=1/C,D=d.aspect,z=Math.sqrt(1+D*D)*Math.tan(.5*d.fovX),k=z*z,F=h-a,q=h+a;let $,X;k>F/q?($=h,X=h*z):($=.5*q*(1+k),X=.5*Math.sqrt(F*F+2*(h*h+a*a)*k+q*q*k*k));const Z=d.projection.pixelsPerMeter(d.center.lat,C),ne=d._camera.getCameraToWorldMercator(),ae=[0,0,-$*R];s.ad(ae,ae,ne);let de=X*R;const _e=d._edgeInsets;if(!(_e.left===0&&_e.top===0&&_e.right===0&&_e.bottom===0||_e.left===_e.right&&_e.top===_e.bottom)){const nt=d._camera.getWorldToCamera(d.worldSize,d.projection.zAxisUnit==="meters"?Z:1),st=d._camera.getCameraToClipPerspective(d._fov,d.width/d.height,a,h);st[8]=2*-d.centerOffset.x/d.width,st[9]=2*d.centerOffset.y/d.height;const ct=new Float64Array(16);s.cM(ct,st,nt);const St=new Float64Array(16);s.bi(St,ct);const Ht=s.cy.fromInvProjectionMatrix(St,C,w,!0);for(const Qt of Ht.points){const Lt=((be=Qt)[0]/=T,be[1]/=T,be[2]=s.cb(be[2],d._center.lat),be);de=Math.max(de,s.c2(s.d7([],ae,Lt)))}}var be;de*=g/(g-1);const Te=Math.acos(t[2]),ye=Math.atan2(-t[0],-t[1]),xe=new Qo;xe.position=ae,xe.setPitchBearing(Te,ye);const ve=xe.getWorldToCamera(C,Z),Oe=de*C,Pe=Math.min(d._mercatorZfromZoom(17)*C*-2,-2*Oe),Ye=xe.getCameraToClipOrthographic(-Oe,Oe,-Oe,Oe,Pe,(Oe+_*Z)/t[2]),Ue=new Float64Array(16);s.az(Ue,Ye,ve);const Qe=s.d2(Math.floor(1e6*ae[0])/1e6*C,Math.floor(1e6*ae[1])/1e6*C,0),_t=.5*g,Fe=[0,0,0];s.ad(Fe,Qe,Ue),s.c1(Fe,Fe,_t);const Ae=[Math.floor(Fe[0]),Math.floor(Fe[1]),Math.floor(Fe[2])],qe=[0,0,0];s.at(qe,Fe,Ae),s.c1(qe,qe,-1/_t);const je=new Float64Array(16);return s.bx(je),s.bo(je,je,qe),s.az(Ue,je,Ue),[Ue,Oe]}class fx extends s.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,a){return s.aS(this.requestManager.transformRequest(a,s.R.Model).url).then(h=>{if(!h)return;const g=s.aT(h),_=new s.aU(t,void 0,void 0,g);return _.computeBoundsAndApplyParent(),_}).catch(h=>{if(h&&h.status===404)return null;this.fire(new s.z(new Error(`Could not load model ${t} from ${a}: ${h.message}`)))})}load(t,a,h={forceReload:!1}){this.models[a]||(this.models[a]={});const g=Object.keys(t),_=[],w=[];for(const T of g){const C=t[T];this.hasURLBeenRequested(C)&&!h.forceReload||(this.modelByURL[C]={modelId:T,scope:a},_.push(this.loadModel(T,C)),w.push(T)),this.models[a][T]||(this.models[a][T]={model:null,numReferences:1})}this.numModelsLoading[a]=(this.numModelsLoading[a]||0)+w.length,Promise.allSettled(_).then(T=>{for(let C=0;C<T.length;C++){const{status:R}=T[C];if(R==="rejected")continue;const{value:D}=T[C];this.models[a][w[C]]||(this.models[a][w[C]]={model:null,numReferences:1}),this.models[a][w[C]].model=D}this.numModelsLoading[a]-=w.length,this.fire(new s.A("data",{dataType:"style"}))}).catch(T=>{this.fire(new s.z(new Error(`Could not load models: ${T.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,a,h={exactIdMatch:!1}){return!!(h.exactIdMatch?this.getModel(t,a):this.getModelByURL(this.modelUris[a][t]))}getModel(t,a){return this.models[a]||(this.models[a]={}),this.models[a][t]?this.models[a][t].model:void 0}getModelByURL(t){if(!t)return null;const a=this.modelByURL[t];return a?this.models[a.scope][a.modelId].model:null}hasModelBeenAdded(t,a){return this.models[a]&&this.models[a][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,a,h){this.models[h]||(this.models[h]={}),this.modelUris[h]||(this.modelUris[h]={});const g=this.requestManager.normalizeModelURL(a);if((this.hasModel(t,h,{exactIdMatch:!0})||this.hasModelBeenAdded(t,h))&&this.modelUris[h][t]===g)this.models[h][t].numReferences++;else if(this.hasURLBeenRequested(g)){const{scope:_,modelId:w}=this.modelByURL[g];this.models[_][w].numReferences++}else this.modelUris[h][t]=g,this.load({[t]:this.modelUris[h][t]},h)}addModelURLs(t,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const h=this.modelUris[a];for(const g in t)h[g]=this.requestManager.normalizeModelURL(t[g])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const h={};for(const g of t)this.hasModel(g,a,{exactIdMatch:!0})||this.hasURLBeenRequested(g)?this.models[a][g].numReferences++:this.modelUris[a][g]&&!this.hasURLBeenRequested(g)?h[g]=this.modelUris[a][g]:!this.hasURLBeenRequested(g)&&s.d9(g,!1)&&(this.modelUris[a][g]=this.requestManager.normalizeModelURL(g),h[g]=this.modelUris[a][g]);this.load(h,a)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,a,h=!1,g=!1){if(this.models[a]&&this.models[a][t]&&(this.models[a][t].numReferences--,this.models[a][t].numReferences===0||g)){const _=this.modelUris[a][t];h||delete this.modelUris[a][t],delete this.modelByURL[_];const w=this.models[a][t].model;if(!w)return;delete this.models[a][t],w.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const a of Object.keys(this.models[t])){const h=this.models[t][a].model;delete this.models[t][a],h&&h.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,a){this.models[a]||(this.models[a]={});for(const h in this.models[a])this.models[a][h].model&&this.models[a][h].model.upload(t.context)}}const xf=new s.a7({data:new s.a8(s.a5.colorTheme.data)});class Um{constructor(t){this._scope=t,this._buildingQueryParams={target:{featuresetId:"building-outline",importId:this._scope}},this._floorQueryParams={target:{featuresetId:"floor-outline",importId:this._scope}}}execute(t){const a=this._makeBuildingsQueryArea(t),h=this._makeFloorsQueryArea(t),g=t.queryRenderedFeatures(a,this._buildingQueryParams).filter(T=>T.properties.shape_type==="building").reduce((T,C)=>{const R=C.properties.id;return C.properties.shape_type!=="building"||T.some(D=>D.properties.id===R)||T.push(C),T},[]),_=t.queryRenderedFeatures(h,this._floorQueryParams).filter(T=>T.properties.shape_type==="floor").reduce((T,C)=>{const R=C.properties.id;return C.properties.shape_type!=="floor"||T.some(D=>D.properties.id===R)||T.push(C),T},[]),w=[t.getCenter().lng,t.getCenter().lat];return{floors:_,building:this._findBuildingAtCenter(w,g)||(g.length>0?g[0]:null)}}_makeBuildingsQueryArea(t){const a=t.transform.width,h=t.transform.height,g=Math.min(a,h),_=g*(1/8),w=g*(1/8),T=.5*(a-_),C=.5*(h-w);return[new s.P(T,C),new s.P(T+_,C+w)]}_makeFloorsQueryArea(t){const a=t.transform.width,h=t.transform.height,g=a*(2/3),_=h*(2/3),w=.5*(a-g),T=.5*(h-_);return[new s.P(w,T),new s.P(w+g,T+_)]}_findBuildingAtCenter(t,a){for(const h of a)if(h.geometry.type==="Polygon"&&this._pointInPolygon(t,h.geometry.coordinates[0]))return h;return null}_pointInPolygon(t,a){let h=!1;for(let g=0,_=a.length-1;g<a.length;_=g++){const w=a[g][0],T=a[g][1],C=a[_][1];T>t[1]!=C>t[1]&&t[0]<(a[_][0]-w)*(t[1]-T)/(C-T)+w&&(h=!h)}return h}}class Nl{constructor(){this._selectedFloorId=null,this._selectedBuildingId=null,this._floors=[]}setBuildingId(t){this._selectedBuildingId=t}setFloors(t){if(this._floors=t.filter(a=>a.properties.building_id===this._selectedBuildingId),!this._selectedFloorId||!this._floors.map(a=>a.properties.id).includes(this._selectedFloorId)){const a=this._floors.map(h=>({id:h.properties.id,level:h.properties.floor_level})).reduce((h,g)=>{const _=Math.abs(h.level-1),w=Math.abs(g.level-1);return w<_||w===_&&g.level>h.level?g:h});this._selectedFloorId=a.id}}setFloorId(t){this._selectedFloorId=t}getSelectedFloorId(){return this._selectedFloorId}getCurrentBuildingFloors(){return this._floors}reset(){this._selectedFloorId=null,this._selectedBuildingId=null,this._floors=[]}}const qw={"mbx-indoor-level-selected":{default:["literal",[]]}};function px(d){return d=d||{},Object.assign(d,qw)}class Ww extends s.E{constructor(t){super(),s.aV(["_onLoad","_onMove"],this),this._map=t,this._floorSelectionState=new Nl,this._queryIndoor(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=null,this._floorSelectionState=null}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._indoorDataQuery?this.fire(new s.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._scope=t.scope,this._indoorDataQuery=new Um(this._scope)))}),this._map._addIndoorControl(),this._queryIndoor()}_onMove(){this._queryIndoor()}_queryIndoor(){if(!this._indoorDataQuery||!this._map.isStyleLoaded())return;if(this._map.transform.zoom<16)return void this._clearIndoorData();const t=this._indoorDataQuery.execute(this._map);t&&t.floors.length!==0?(this._floorSelectionState.getSelectedFloorId()||this._map._addIndoorControl(),this._selectFloors(t)):this._clearIndoorData()}_selectFloors(t){if(t.building)this._floorSelectionState.setBuildingId(t.building.properties.id),this._floorSelectionState.setFloors(t.floors),this._updateUI();else{const a=this._floorSelectionState.getSelectedFloorId();if(a&&t.floors.some(h=>h.properties.id===a))return;this._clearIndoorData()}}_clearIndoorData(){this._floorSelectionState.reset(),this._map._removeIndoorControl(),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",[]])}_updateUI(){const t=this._floorSelectionState.getCurrentBuildingFloors().map(h=>({id:h.properties.id,name:h.properties.name,shortName:h.properties.floor_level,levelOrder:h.properties.floor_level})),a=this._floorSelectionState.getSelectedFloorId();a?(this._updateIndoorConfig(),this.fire(new s.A("indoorupdate",{selectedFloorId:a,floors:t}))):console.warn("IndoorManager: Selected floor is not set")}_updateIndoorConfig(){const t=this._floorSelectionState.getSelectedFloorId();t?this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",[t]]):console.warn("IndoorManager: Selected floor is not set")}selectFloor(t){this._floorSelectionState.setFloorId(t),this._updateIndoorConfig()}}function mx(d){if(!d.metadata||!d.metadata.content_area)return;const t=s.q.devicePixelRatio,{left:a,top:h,width:g,height:_}=d.metadata.content_area,w=a*t,T=h*t;return[w,T,w+g*t,T+_*t]}function gx(d){if(d)return d.map(([t,a])=>[t*s.q.devicePixelRatio,a*s.q.devicePixelRatio])}class Gm{constructor(t,a,h){this.id=t,this.scope=a,this.sourceCache=h,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const a=this.sourceCache.getVisibleCoordinates();if(a.length===0)return t;const h=this.sourceCache.getSource();if(!(h instanceof Pl))return t;const g=a.map(w=>this.sourceCache.getTile(w)),_=h.getImages(g,Array.from(this.pendingRequests));for(const[w,T]of _)t.set(s.I.from({name:w,iconsetId:this.id}),T),this.pendingRequests.delete(w);for(const w of this.pendingRequests)this.missingRequests.add(w);return this.pendingRequests.clear(),t}}const Ll=(d,t)=>ge(d,t&&t.filter(a=>a.identifier!=="source.canvas")),_x=s.aF(ln,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),yx=s.aF(ln,["setCenter","setZoom","setBearing","setPitch"]),vf=new Set(["background","sky","slot","custom"]),zl={version:8,layers:[],sources:{}},oh={duration:300,delay:0};class ea extends s.E{constructor(t,a={}){super(),this.map=t,this.scope=a.scope||"",this.globalId=null,this.fragments=[],this.importDepth=a.importDepth||0,this.importsCache=a.importsCache||new Map,this.resolvedImports=a.resolvedImports||new Set,this.transition=s.h({},oh),this._buildingIndex=new sx(this),this.crossTileSymbolIndex=new oo,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=a.styleChanges||new Zr,this.dispatcher=a.dispatcher?a.dispatcher:new s.D(s.db(),this),a.imageManager?this.imageManager=a.imageManager:(this.imageManager=new On(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=a.glyphManager?a.glyphManager:new s.dc(t._requestManager,a.localFontFamily?s.dd.all:a.localIdeographFontFamily?s.dd.ideographs:s.dd.none,a.localFontFamily||a.localIdeographFontFamily),a.modelManager?this.modelManager=a.modelManager:(this.modelManager=new fx(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=a.configOptions?a.configOptions:new Map,this._configDependentLayers=a.configDependentLayers?a.configDependentLayers:new Set,this._config=a.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:a.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=a.initialConfig,this.dispatcher.broadcast("setReferrer",s.de());const h=this;this._rtlTextPluginCallback=ea.registerForPluginStateChange(g=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(_,w)=>{if(s.df(_),w&&w.every(T=>T))for(const T in h._sourceCaches){const C=h._sourceCaches[T],R=C.getSource().type;R!=="vector"&&R!=="geojson"||C.reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const _=this.getOwnSource(g.sourceId);if(_&&_.vectorLayerIds)for(const w in this._layers){const T=this._layers[w];T.source===_.id&&this._validateLayer(T)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(s.j(t))return t;const a=s.dg(t);if(!a.startsWith("http"))try{return new URL(a,location.href).toString()}catch{return a}return a}return`json://${s.dh(JSON.stringify(t))}`}_diffStyle(t,a,h){this.globalId=this._getGlobalId(t);const g=(_,w)=>{try{w(null,this.setState(_,h))}catch(T){w(T,!1)}};if(typeof t=="string"){const _=this.map._requestManager.normalizeStyleURL(t),w=this.map._requestManager.transformRequest(_,s.R.Style);s.n(w,(T,C)=>{T?this.fire(new s.z(T)):C&&g(C,a)})}else typeof t=="object"&&g(t,a)}loadURL(t,a={}){this.fire(new s.A("dataloading",{dataType:"style"}));const h=typeof a.validate=="boolean"?a.validate:!s.j(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,a.accessToken),this.resolvedImports.add(t);const g=this.importsCache.get(t);if(g)return this._load(g,h);const _=this.map._requestManager.transformRequest(t,s.R.Style);this._request=s.n(_,(w,T)=>{if(this._request=null,w)this.fire(new s.z(w));else if(T)return this.importsCache.set(t,T),this._load(T,h)})}loadJSON(t,a={}){this.fire(new s.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=s.q.frame(()=>{this._request=null,this._load(t,a.validate!==!1)})}loadEmpty(){this.fire(new s.A("dataloading",{dataType:"style"})),this._load(zl,!1)}_loadImports(t,a,h){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const g=[];for(const _ of t){const w=this._createFragmentStyle(_),T=new Promise(D=>{w.once("style.import.load",D),w.once("error",D)}).then(()=>this.mergeAll());if(g.push(T),this.resolvedImports.has(_.url)){w.loadEmpty();continue}const C=_.data||this.importsCache.get(_.url);C?(w.loadJSON(C,{validate:a}),this._isInternalStyle(C)&&(w.globalId=null)):_.url?w.loadURL(_.url,{validate:a}):w.loadEmpty();const R={style:w,id:_.id,config:_.config};if(h){const D=this.fragments.findIndex(({id:z})=>z===h);this.fragments=this.fragments.slice(0,D).concat(R).concat(this.fragments.slice(D))}else this.fragments.push(R)}return Promise.allSettled(g)}getImportGlobalIds(t=this,a=new Set){for(const h of t.fragments)h.style.globalId&&a.add(h.style.globalId),this.getImportGlobalIds(h.style,a);return[...a.values()]}_createFragmentStyle(t){const a=this.scope?s.C(t.id,this.scope):t.id;let h;const g=this._initialConfig&&this._initialConfig[a];(t.config||g)&&(h=s.h({},t.config,g));const _=new ea(this.map,{scope:a,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:h,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return _.setEventedParent(this.map,{style:_}),_}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,a){const h=t.indoor?px(t.schema):t.schema;if(this._isInternalStyle(t)){const w=s.h({},zl,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(w,a)}if(this.updateConfig(this._config,h),a&&Ll(this,jr(t)))return;this._loaded=!0,this.stylesheet=s.di(t);const g=()=>{for(const R in t.sources)this.addSource(R,t.sources[R],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const R in t.iconsets)this.addIconset(R,t.iconsets[R]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const w=qd(this.stylesheet.layers);if(this._order=w.map(R=>R.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const R=this.stylesheet.lights[0];this.light=new $e(R.properties,R.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new $e(this.stylesheet.light)),this._layers={};for(const R of w){const D=s.dn(R,this.scope,this._styleColorTheme.lut,this.options);D.configDependencies.size!==0&&this._configDependentLayers.add(D.fqid),D.setEventedParent(this,{layer:{id:D.id}}),this._layers[D.id]=D;const z=this.getOwnLayerSourceCache(D),k=!!this.directionalLight&&this.directionalLight.shadowsEnabled();z&&D.canCastShadows()&&k&&(z.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const T=this.stylesheet.terrain;T&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(T,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.A("data",{dataType:"style"}));const C=this.isRootStyle();t.imports?this._loadImports(t.imports,a).then(()=>{this._reloadImports(),this.fire(new s.A(C?"style.load":"style.import.load"))}).catch(R=>{this.fire(new s.z(new Error("Failed to load imports",R))),this.fire(new s.A(C?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.A(C?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const _=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(_){const w=this._evaluateColorThemeData(_);this._loadColorTheme(w).then(()=>{g()}).catch(T=>{s.w(`Couldn't load color theme from the stylesheet: ${T}`),g()})}else this._styleColorTheme.lut=null,g()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,a,h,g,_,w,T,C,R,D;const z={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(k=>{if(k.stylesheet){if(k.light!=null&&(t=k.light),k.stylesheet.lights)for(const F of k.stylesheet.lights)F.type==="ambient"&&k.ambientLight!=null&&(a=k.ambientLight),F.type==="directional"&&k.directionalLight!=null&&(h=k.directionalLight);g=this._prioritizeTerrain(g,k.terrain,k.stylesheet.terrain),k.stylesheet.fog&&k.fog!=null&&(_=k.fog),k.stylesheet.snow&&k.snow!=null&&(w=k.snow),k.stylesheet.rain&&k.rain!=null&&(T=k.rain),k.stylesheet.camera!=null&&(D=k.stylesheet.camera),k.stylesheet.projection!=null&&(C=k.stylesheet.projection),k.stylesheet.transition!=null&&(R=k.stylesheet.transition),z[k.scope]=k._styleColorTheme}}),this.light=t,this.ambientLight=a,this.directionalLight=h,this.fog=_,this.snow=w,this.rain=T,this._styleColorThemeForScope=z,g===null?delete this.terrain:this.terrain=g,this.camera=D||{"camera-projection":"perspective"},this.projection=C||{name:"mercator"},this.transition=s.h({},oh,R),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const a=h=>{for(const g of h.fragments)a(g.style);t(h)};a(this)}_prioritizeTerrain(t,a,h){const g=t&&t.drapeRenderMode===0;return h===null?a&&a.drapeRenderMode===0?a:g?t:null:a!=null&&(!t||g||a&&a.drapeRenderMode===1)?a:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(a=>{t=this._prioritizeTerrain(t,a.terrain,a.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(a=>{a.stylesheet.projection!=null&&(t=a.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},a={},h={};this.forEachFragmentStyle(g=>{for(const _ in g._sourceCaches){const w=s.C(_,g.scope);t[w]=g._sourceCaches[_]}for(const _ in g._otherSourceCaches){const w=s.C(_,g.scope);a[w]=g._otherSourceCaches[_]}for(const _ in g._symbolSourceCaches){const w=s.C(_,g.scope);h[w]=g._symbolSourceCaches[_]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=a,this._mergedSymbolSourceCaches=h}mergeLayers(){const t={},a=[],h={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(_=>{for(const w of _._order){const T=_._layers[w];if(T.type==="slot"){const C=s.dj(w);if(t[C])continue;t[C]=[]}T.slot&&t[T.slot]?t[T.slot].push(T):a.push(T)}}),this._mergedOrder=[];const g=(_=[])=>{for(const w of _)if(w.type==="slot"){const T=s.dj(w.id);t[T]&&g(t[T]),this._mergedSlots.push(T)}else{const T=s.C(w.id,w.scope);this._mergedOrder.push(T),h[T]=w,w.is3D(!!this.terrain)&&(this._has3DLayers=!0),w.type==="circle"&&(this._hasCircleLayers=!0),w.type==="symbol"&&(this._hasSymbolLayers=!0),w.type==="clip"&&(this._clipLayerPresent=!0)}};g(a),this._mergedOrder.sort((_,w)=>{const T=h[_],C=h[w];return T.hasInitialOcclusionOpacityProperties?C.is3D(!!this.terrain)?1:0:T.is3D(!!this.terrain)&&C.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=h,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=s.h({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(a,h,g,_){const w=s.h({},h);for(const C of Object.keys(s.a5.colorTheme))w[C]===void 0&&(w[C]=s.a5.colorTheme[C].default);const T=new s.a6(xf,a,new Map(g));return T.setTransitionOrValue(w,g),T.untransitioned().possiblyEvaluate(new s.aa(0,{worldview:void 0}))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const a=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((h,g)=>{const _="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void h();let w=t;w.startsWith(_)||(w=_+w);const T=s.I.from("mapbox-reserved-lut"),C=new Image;C.src=w,C.onerror=()=>{this._styleColorTheme.lutLoading=!1,g(new Error("Failed to load image data"))},C.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==a)return void h();this._styleColorTheme.lutLoading=!1;const{width:R,height:D,data:z}=s.q.getImageData(C);if(D>32)return void g(new Error("The height of the image must be less than or equal to 32 pixels."));if(R!==D*D)return void g(new Error("The width of the image must be equal to the height squared."));this.getImage(T)&&this.removeImage(T),this.addImage(T,{data:new s.r({width:R,height:D},z),pixelRatio:1,sdf:!1,usvg:!1,version:0});const k=this.imageManager.getImage(T,this.scope);k?(this._styleColorTheme.lut={image:k.data,data:t},h()):g(new Error("Missing LUT image."))}})}getLut(t){const a=this._styleColorThemeForScope[t];return a?a.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(a,h,g){let _,w,T;const C=s.q.devicePixelRatio>1?"@2x":"";let R=s.n(h.transformRequest(h.normalizeSpriteURL(a,C,".json"),s.R.SpriteJSON),(k,F)=>{R=null,T||(T=k,_=F,z())}),D=s.o(h.transformRequest(h.normalizeSpriteURL(a,C,".png"),s.R.SpriteImage),(k,F)=>{D=null,T||(T=k,w=F,z())});function z(){if(T)g(T);else if(_&&w){const k=s.q.getImageData(w),F={};for(const q in _){const{width:$,height:X,x:Z,y:ne,sdf:ae,pixelRatio:de,stretchX:_e,stretchY:be,content:Te}=_[q],ye=new s.r({width:$,height:X});s.r.copy(k,ye,{x:Z,y:ne},{x:0,y:0},{width:$,height:X},null),F[q]={data:ye,pixelRatio:de,sdf:ae,stretchX:_e,stretchY:be,content:Te,usvg:!1}}g(null,F)}}return{cancel(){R&&(R.cancel(),R=null),D&&(D.cancel(),D=null)}}}(t,this.map._requestManager,(a,h)=>{if(this._spriteRequest=null,a)this.fire(new s.z(a));else if(h){const g=new Map;for(const _ in h)g.set(s.I.from(_),h[_]);this.addImages(g)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.A("data",{dataType:"style"}))})}addIconset(t,a){if(a.type==="sprite")return void this._loadSprite(a.url);const h=this.getOwnSourceCache(a.source);if(!h)return void this.fire(new s.z(new Error(`Source "${a.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const g=h.getSource();if(g.type!=="raster-array")return void this.fire(new s.z(new Error(`Source "${a.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));g.partial=!1;const _=new Gm(t,this.scope,h);this.imageManager.addImageProvider(_,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!s.j(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const a=this.map._spriteFormat==="auto";var h,g;this._spriteRequest=(g=(_,w)=>{if(this._spriteRequest=null,_)a?this._loadSprite(t):this.fire(new s.z(_));else if(w){const T=new Map;for(const C in w)T.set(s.I.from(C),w[C]);this.addImages(T)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.A("data",{dataType:"style"}))},s.br((h=this.map._requestManager).transformRequest(h.normalizeIconsetURL(t),s.R.Iconset),(_,w)=>{if(_)return void g(_);const T={},C=s.da(new s.bq(w));for(const R of C.icons){const D={version:1,pixelRatio:s.q.devicePixelRatio,content:mx(R),stretchX:R.metadata?gx(R.metadata.stretch_x_areas):void 0,stretchY:R.metadata?gx(R.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:R};T[R.name]=D}g(null,T)}))}_validateLayer(t){const a=this.getOwnSource(t.source);if(!a)return;const h=t.sourceLayer;h&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(h)===-1)&&this.fire(new s.z(new Error(`Source layer "${h}" does not exist on source "${a.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,a)=>{const h=this.fragments[a];return h&&h.style&&(t.data=h.style.serialize()),t})}_serializeSources(){const t={};for(const a in this._sourceCaches){const h=this._sourceCaches[a].getSource();t[h.id]||(t[h.id]=h.serialize())}return t}_serializeLayers(t){const a=[];for(const h of t){const g=this._layers[h];g&&g.type!=="custom"&&a.push(g.serialize())}return a}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const a=this.getOwnLayer(t);if(a)return a;this.fire(new s.z(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const a=this.getOwnSource(t);if(a)return a;this.fire(new s.z(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,a){const h=this.map.painter;if(h)for(let g=t.minzoom||0;g<(t.maxzoom||25.5);g++){const _=t.getProgramIds();if(_)for(const w of _){const T=t.getDefaultProgramParams(w,a.zoom,this._styleColorTheme.lut);T&&(h.style=this,this.fog&&(h._fogVisible=!0,T.overrideFog=!0,h.getOrCreateProgram(w,T)),h._fogVisible=!1,T.overrideFog=!1,h.getOrCreateProgram(w,T),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(T.overrideRtt=!0,h.getOrCreateProgram(w,T)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const a=this.calculateLightsBrightness();t.brightness=a||0,a!==this._brightness&&(this._brightness=a,this.dispatcher.broadcast("setBrightness",a)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const h=this._changes.isDirty();let g=!1;if(this._changes.isDirty()){const T=this._changes.getLayerUpdatesByScope();for(const C in T){const{updatedIds:R,removedIds:D}=T[C];(R||D)&&(this._updateWorkerLayers(C,R,D),g=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const _={};for(const T in this._mergedSourceCaches){const C=this._mergedSourceCaches[T];_[T]=C.used,C.used=!1,C.tileCoverLift=0}for(const T of this._mergedOrder){const C=this._mergedLayers[T];if(C.recalculate(t,this._availableImages),!C.isHidden(t.zoom)){const R=this.getLayerSourceCache(C);R&&(R.used=!0,R.tileCoverLift=Math.max(R.tileCoverLift,C.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(C,t)}):this.precompilePrograms(C,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&g&&this.mergeLayers();const w=this.imageManager.getPendingImageProviders();for(const T of w)T.sourceCache.used=!0;for(const T in _){const C=this._mergedSourceCaches[T];_[T]!==C.used&&C.getSource().fire(new s.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),h&&this.fire(new s.A("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const a of t){const h=a.resolvePendingRequests(),g=this.getFragmentStyle(a.scope);g&&g.addImages(h)}}_updateTilesForChangedImages(){const t={};for(const a in this._mergedSourceCaches){const h=this._mergedSourceCaches[a].getSource().scope;t[h]=t[h]||this._changes.getUpdatedImages(h),t[h].length!==0&&this._mergedSourceCaches[a].reloadTilesForDependencies(["icons","patterns"],t[h])}for(const a in t)this._changes.resetUpdatedImages(a)}_updateWorkerLayers(t,a,h){const g=this.getFragmentStyle(t);g&&this.dispatcher.broadcast("updateLayers",{layers:a?g._serializeLayers(a):[],scope:t,removedIds:h||[],options:g.options})}setState(t,a){if(this._checkLoaded(),Ll(this,jr(t)))return!1;(t=s.di(t)).layers=qd(t.layers);const h=function(w,T){if(!w)return[{command:ln.setStyle,args:[T]}];let C=[];try{if(!s.bv(w.version,T.version))return[{command:ln.setStyle,args:[T]}];if(s.bv(w.center,T.center)||C.push({command:ln.setCenter,args:[T.center]}),s.bv(w.zoom,T.zoom)||C.push({command:ln.setZoom,args:[T.zoom]}),s.bv(w.bearing,T.bearing)||C.push({command:ln.setBearing,args:[T.bearing]}),s.bv(w.pitch,T.pitch)||C.push({command:ln.setPitch,args:[T.pitch]}),s.bv(w.sprite,T.sprite)||C.push({command:ln.setSprite,args:[T.sprite]}),s.bv(w.glyphs,T.glyphs)||C.push({command:ln.setGlyphs,args:[T.glyphs]}),s.bv(w.imports,T.imports)||function(F=[],q=[],$){q=q||[];const X=(F=F||[]).map(_c),Z=q.map(_c),ne=F.reduce(Ml,{}),ae=q.reduce(Ml,{}),de=X.slice();let _e,be,Te,ye;for(_e=0,be=0;_e<X.length;_e++)Te=X[_e],ae.hasOwnProperty(Te)?be++:($.push({command:ln.removeImport,args:[Te]}),de.splice(de.indexOf(Te,be),1));for(_e=0,be=0;_e<Z.length;_e++)Te=Z[Z.length-1-_e],de[de.length-1-_e]!==Te&&(ne.hasOwnProperty(Te)?($.push({command:ln.removeImport,args:[Te]}),de.splice(de.lastIndexOf(Te,de.length-be),1)):be++,ye=de[de.length-_e],$.push({command:ln.addImport,args:[ae[Te],ye]}),de.splice(de.length-_e,0,Te));for(const xe of q){const ve=ne[xe.id];ve&&(delete ve.data,s.bv(ve,xe)||$.push({command:ln.updateImport,args:[xe.id,xe]}))}}(w.imports,T.imports,C),s.bv(w.transition,T.transition)||C.push({command:ln.setTransition,args:[T.transition]}),s.bv(w.light,T.light)||C.push({command:ln.setLight,args:[T.light]}),s.bv(w.fog,T.fog)||C.push({command:ln.setFog,args:[T.fog]}),s.bv(w.snow,T.snow)||C.push({command:ln.setSnow,args:[T.snow]}),s.bv(w.rain,T.rain)||C.push({command:ln.setRain,args:[T.rain]}),s.bv(w.projection,T.projection)||C.push({command:ln.setProjection,args:[T.projection]}),s.bv(w.lights,T.lights)||C.push({command:ln.setLights,args:[T.lights]}),s.bv(w.camera,T.camera)||C.push({command:ln.setCamera,args:[T.camera]}),s.bv(w.iconsets,T.iconsets)||function(F,q,$){let X;for(X in q=q||{},F=F||{})F.hasOwnProperty(X)&&(q.hasOwnProperty(X)||$.push({command:ln.removeIconset,args:[X]}));for(X in q){if(!q.hasOwnProperty(X))continue;const Z=q[X];F.hasOwnProperty(X)?s.bv(F[X],Z)||($.push({command:ln.removeIconset,args:[X]}),$.push({command:ln.addIconset,args:[X,Z]})):$.push({command:ln.addIconset,args:[X,Z]})}}(w.iconsets,T.iconsets,C),!s.bv(w["color-theme"],T["color-theme"]))return[{command:ln.setStyle,args:[T]}];const R={},D=[];(function(F,q,$,X){let Z;for(Z in q=q||{},F=F||{})F.hasOwnProperty(Z)&&(q.hasOwnProperty(Z)||su(Z,$,X));for(Z in q){if(!q.hasOwnProperty(Z))continue;const ne=q[Z];F.hasOwnProperty(Z)?s.bv(F[Z],ne)||(F[Z].type==="geojson"&&ne.type==="geojson"&&Uw(F,q,Z)?$.push({command:ln.setGeoJSONSourceData,args:[Z,ne.data]}):Wd(Z,q,$,X)):ff(Z,q,$)}})(w.sources,T.sources,D,R);const z=[];w.layers&&w.layers.forEach(F=>{F.source&&R[F.source]?C.push({command:ln.removeLayer,args:[F.id]}):z.push(F)});let k=w.terrain;k&&R[k.source]&&(C.push({command:ln.setTerrain,args:[void 0]}),k=void 0),C=C.concat(D),s.bv(k,T.terrain)||C.push({command:ln.setTerrain,args:[T.terrain]}),function(F,q,$){q=q||[];const X=(F=F||[]).map(_c),Z=q.map(_c),ne=F.reduce(Ml,{}),ae=q.reduce(Ml,{}),de=X.slice(),_e=Object.create(null);let be,Te,ye,xe,ve,Oe,Pe;for(be=0,Te=0;be<X.length;be++)ye=X[be],ae.hasOwnProperty(ye)?Te++:($.push({command:ln.removeLayer,args:[ye]}),de.splice(de.indexOf(ye,Te),1));for(be=0,Te=0;be<Z.length;be++)ye=Z[Z.length-1-be],de[de.length-1-be]!==ye&&(ne.hasOwnProperty(ye)?($.push({command:ln.removeLayer,args:[ye]}),de.splice(de.lastIndexOf(ye,de.length-Te),1)):Te++,Oe=de[de.length-be],$.push({command:ln.addLayer,args:[ae[ye],Oe]}),de.splice(de.length-be,0,ye),_e[ye]=!0);for(be=0;be<Z.length;be++)if(ye=Z[be],xe=ne[ye],ve=ae[ye],!_e[ye]&&!s.bv(xe,ve))if(s.bv(xe.source,ve.source)&&s.bv(xe["source-layer"],ve["source-layer"])&&s.bv(xe.type,ve.type)){for(Pe in Zd(xe.layout,ve.layout,$,ye,null,ln.setLayoutProperty),Zd(xe.paint,ve.paint,$,ye,null,ln.setPaintProperty),s.bv(xe.slot,ve.slot)||$.push({command:ln.setSlot,args:[ye,ve.slot]}),s.bv(xe.filter,ve.filter)||$.push({command:ln.setFilter,args:[ye,ve.filter]}),s.bv(xe.minzoom,ve.minzoom)&&s.bv(xe.maxzoom,ve.maxzoom)||$.push({command:ln.setLayerZoomRange,args:[ye,ve.minzoom,ve.maxzoom]}),xe)xe.hasOwnProperty(Pe)&&Pe!=="layout"&&Pe!=="paint"&&Pe!=="filter"&&Pe!=="metadata"&&Pe!=="minzoom"&&Pe!=="maxzoom"&&Pe!=="slot"&&(Pe.indexOf("paint.")===0?Zd(xe[Pe],ve[Pe],$,ye,Pe.slice(6),ln.setPaintProperty):s.bv(xe[Pe],ve[Pe])||$.push({command:ln.setLayerProperty,args:[ye,Pe,ve[Pe]]}));for(Pe in ve)ve.hasOwnProperty(Pe)&&!xe.hasOwnProperty(Pe)&&Pe!=="layout"&&Pe!=="paint"&&Pe!=="filter"&&Pe!=="metadata"&&Pe!=="minzoom"&&Pe!=="maxzoom"&&Pe!=="slot"&&(Pe.indexOf("paint.")===0?Zd(xe[Pe],ve[Pe],$,ye,Pe.slice(6),ln.setPaintProperty):s.bv(xe[Pe],ve[Pe])||$.push({command:ln.setLayerProperty,args:[ye,Pe,ve[Pe]]}))}else $.push({command:ln.removeLayer,args:[ye]}),Oe=de[de.lastIndexOf(ye)+1],$.push({command:ln.addLayer,args:[ve,Oe]})}(z,T.layers,C)}catch(R){console.warn("Unable to compute style diff:",R),C=[{command:ln.setStyle,args:[T]}]}return C}(this.serialize(),t).filter(w=>!(w.command in yx));if(h.length===0)return!1;const g=h.filter(w=>!(w.command in _x));if(g.length>0)throw new Error(`Unimplemented: ${g.map(w=>w.command).join(", ")}.`);const _=[];return h.forEach(w=>{_.push(this[w.command](...w.args))}),a&&Promise.all(_).then(a).catch(a),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(t.size===0)return this;for(const[a,h]of t.entries()){if(this.getImage(a))return this.fire(new s.z(new Error(`An image with the name "${a.name}" already exists.`)));this.imageManager.addImage(a,this.scope,h),this._changes.updateImage(a,this.scope)}return this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})),this}addImage(t,a){return this.getImage(t)?this.fire(new s.z(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,a),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})),this)}updateImage(t,a,h=!1){this.imageManager.updateImage(t,this.scope,a),h&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})),this):this.fire(new s.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new s.A("data",{dataType:"style"})),this}addModel(t,a,h={}){return this._checkLoaded(),this._validate(me,`models.${t}`,a,null,h)||(this.modelManager.addModel(t,a,this.scope),this.fire(new s.A("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope,!1,!0),this.fire(new s.A("data",{dataType:"style"})),this):this.fire(new s.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,a,h={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate($s,`sources.${t}`,a,null,h))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const g=Bd(t,a,this.dispatcher,this);g.scope=this.scope,g.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(g.id),source:g.serialize(),sourceId:g.id}));const _=w=>{const T=(w?"symbol:":"other:")+g.id,C=s.C(T,this.scope),R=this._sourceCaches[T]=new so(C,g,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[g.id]=R,R.onAdd(this.map)};_(!1),a.type!=="vector"&&a.type!=="geojson"||_(!0),g.onAdd&&g.onAdd(this.map),h.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const a=this.getOwnSource(t);if(!a)throw new Error("There is no source with this ID");for(const g in this._layers)if(this._layers[g].source===t)return this.fire(new s.z(new Error(`Source "${t}" cannot be removed while layer "${g}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new s.z(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const g=Object.entries(this.stylesheet.iconsets).find(([_,w])=>w.type==="source"&&w.source===t);if(g)return this.fire(new s.z(new Error(`Source "${t}" cannot be removed while iconset "${g[0]}" is using it.`)))}const h=this.getOwnSourceCaches(t);for(const g of h){const _=s.dj(g.id);delete this._sourceCaches[_],this._changes.discardSourceCacheUpdate(g.id),g.fire(new s.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:g.getSource().id})),g.setEventedParent(null),g.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,a){this._checkLoaded(),this.getOwnSource(t).setData(a),this._changes.setDirty()}getOwnSource(t){const a=this.getOwnSourceCache(t);return a&&a.getSource()}getOwnSources(){const t=[];for(const a in this._otherSourceCaches){const h=this.getOwnSourceCache(a);h&&t.push(h.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const a in t){const h=t[a]._tiles;for(const g in h){const _=h[g];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const a=this._getTransitionParameters();for(const _ of t){if(this._validate(Il,"lights",_))return;switch(_.type){case"ambient":if(this.ambientLight){const w=this.ambientLight;w.set(_),w.updateTransitions(a)}else this.ambientLight=new Nn(_,Ki||(Ki=new s.a7({color:new s.a8(s.a5.properties_light_ambient.color),"color-use-theme":new s.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.a8(s.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const w=this.directionalLight;w.set(_),w.updateTransitions(a)}else this.directionalLight=new Nn(_,Sr||(Sr=new s.a7({direction:new s.an(s.a5.properties_light_directional.direction),color:new s.a8(s.a5.properties_light_directional.color),"color-use-theme":new s.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.a8(s.a5.properties_light_directional.intensity),"cast-shadows":new s.a8(s.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new s.a8(s.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new s.a8(s.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const h=Object.assign(a,{worldview:this.map.getWorldview()}),g=new s.aa(this.z||0,h);this.ambientLight&&this.ambientLight.recalculate(g),this.directionalLight&&this.directionalLight.recalculate(g),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,a=this.ambientLight;if(!t||!a)return;const h=k=>.2126*(k[0]<=.03928?k[0]/12.92:Math.pow((k[0]+.055)/1.055,2.4))+.7152*(k[1]<=.03928?k[1]/12.92:Math.pow((k[1]+.055)/1.055,2.4))+.0722*(k[2]<=.03928?k[2]/12.92:Math.pow((k[2]+.055)/1.055,2.4)),g=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),_=t.properties.get("intensity"),w=t.properties.get("direction"),T=1-s.d1(w.x,w.y,w.z)[2]/90,C=h(g)*_*T,R=a.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),D=a.properties.get("intensity"),z=h(R)*D;return Number(((C+z)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(s.dk(t)){const a=s.dl(t),h=this.fragments.find(({id:_})=>_===a);if(!h)return;const g=s.dj(t);return h.style.getFragmentStyle(g)}{const a=this.fragments.find(({id:h})=>h===t);return a?a.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const a={},h=(g,_="")=>`${g}::${_}`;this._featuresetSelectors={};for(const g in t){const _=this._featuresetSelectors[g]=[];for(const w of t[g].selectors){if(w.featureNamespace){const C=this.getOwnLayer(w.layer);if(!C){s.w(`Layer is undefined for selector: ${w.layer}`);continue}const R=h(C.source,C.sourceLayer);if(R in a&&a[R]!==w.featureNamespace){s.w(`"featureNamespace ${w.featureNamespace} of featureset ${g}'s selector is not associated to the same source, skip this selector`);continue}a[R]=w.featureNamespace}let T;if(w.properties)for(const C in w.properties){const R=s.X(w.properties[C]);R.result==="success"&&(T=T||{},T[C]=R.value)}_.push({layerId:w.layer,namespace:w.featureNamespace,properties:T,uniqueFeatureID:w._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const a=this.getFragmentStyle(t);if(!a||!a.stylesheet.featuresets)return[];const h=[];for(const g in a.stylesheet.featuresets)h.push({featuresetId:g,importId:a.scope?a.scope:void 0});return h}getFeaturesetLayers(t,a){const h=this.getFragmentStyle(a),g=h.stylesheet.featuresets;if(!g||!g[t])return this.fire(new s.z(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const _=[];for(const w of g[t].selectors){const T=h.getOwnLayer(w.layer);T&&_.push(T)}return _}getConfigProperty(t,a){const h=this.getFragmentStyle(t);if(!h)return null;const g=s.C(a,h.scope),_=h.options.get(g),w=_?_.value||_.default:null;return w?w.serialize():null}setConfigProperty(t,a,h){const g=this.getFragmentStyle(t);if(!g)return;const _=g.stylesheet.indoor?px(g.stylesheet.schema):g.stylesheet.schema;if(!_||!_[a])return;const w=s.X(h);if(w.result!=="success")return void Ll(this,w.value);const T=w.value.expression,C=s.C(a,g.scope),R=g.options.get(C);if(!R)return;let D;const{minValue:z,maxValue:k,stepValue:F,type:q,values:$}=_[a],X=s.X(_[a].default);X.result==="success"&&(D=X.value.expression),D?(this.options.set(C,Object.assign({},R,{value:T,default:D,minValue:z,maxValue:k,stepValue:F,type:q,values:$})),this.updateConfigDependencies(a)):this.fire(new s.z(new Error(`No schema defined for the config option "${a}" in the "${t}" fragment.`)))}getConfig(t){const a=this.getFragmentStyle(t);if(!a)return null;const h=a.stylesheet.schema;if(!h)return null;const g={};for(const _ in h){const w=s.C(_,a.scope),T=a.options.get(w),C=T?T.value||T.default:null;g[_]=C?C.serialize():null}return g}setConfig(t,a){const h=this.getFragmentStyle(t);h&&(h.updateConfig(a,h.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const a=this.getFragmentStyle(t);return a?a.stylesheet.schema:null}setSchema(t,a){const h=this.getFragmentStyle(t);h&&(h.stylesheet.schema=a,h.updateConfig(h._config,a),this.updateConfigDependencies())}updateConfig(t,a){if(this._config=t,t||a)if(a)for(const h in a){let g,_;const w=s.X(a[h].default);if(w.result==="success"&&(g=w.value.expression),t&&t[h]!==void 0){const k=s.X(t[h]);k.result==="success"&&(_=k.value.expression)}const{minValue:T,maxValue:C,stepValue:R,type:D,values:z}=a[h];if(g){const k=s.C(h,this.scope);this.options.set(k,{default:g,value:_,minValue:T,maxValue:C,stepValue:R,type:D,values:z})}else this.fire(new s.z(new Error(`No schema defined for config option "${h}".`)))}else this.fire(new s.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const a of this._configDependentLayers){const h=this.getLayer(a);if(h){if(t&&!h.configDependencies.has(t))continue;h.possiblyEvaluateVisibility(),this._updateLayer(h)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(a=>{const h=a._styleColorTheme.colorThemeOverride?a._styleColorTheme.colorThemeOverride:a._styleColorTheme.colorTheme;if(h){const g=a._evaluateColorThemeData(h);(!a._styleColorTheme.lut&&g!==""||a._styleColorTheme.lut&&g!==a._styleColorTheme.lut.data)&&a.setColorTheme(h)}}),this._changes.setDirty()}addLayer(t,a,h={}){this._checkLoaded();const g=t.id;if(this._layers[g])return void this.fire(new s.z(new Error(`Layer with id "${g}" already exists on this map`)));let _;if(t.type==="custom"){if(Ll(this,s.dm(t)))return;_=s.dn(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(g,t.source),t=s.di(t),t=s.h(t,{source:g})),this._validate(pn,`layers.${g}`,t,{arrayIndex:-1},h))return;_=s.dn(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(_),_.setEventedParent(this,{layer:{id:g}})}_.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid);let w=this._order.length;if(a){const D=this._order.indexOf(a);if(D===-1)return void this.fire(new s.z(new Error(`Layer with id "${a}" does not exist on this map.`)));_.slot===this._layers[a].slot?w=D:s.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,g),this._layerOrderChanged=!0,this._layers[g]=_;const T=this.getOwnLayerSourceCache(_),C=!!this.directionalLight&&this.directionalLight.shadowsEnabled();T&&_.canCastShadows()&&C&&(T.castsShadows=!0);const R=this._changes.getRemovedLayer(_);if(R&&_.source&&T&&_.type!=="custom"){this._changes.discardLayerRemoval(_);const D=s.C(_.source,_.scope);R.type!==_.type?this._changes.updateSourceCache(D,"clear"):(this._changes.updateSourceCache(D,"reload"),T.pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map),_.scope=this.scope,this.mergeLayers()}moveLayer(t,a){this._checkLoaded();const h=this._checkLayer(t);if(!h||t===a)return;const g=this._order.indexOf(t);this._order.splice(g,1);let _=this._order.length;if(a){const w=this._order.indexOf(a);if(w===-1)return void this.fire(new s.z(new Error(`Layer with id "${a}" does not exist on this map.`)));h.slot===this._layers[a].slot?_=w:s.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(_,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const a=this._checkLayer(t);if(!a)return;a.setEventedParent(null);const h=this._order.indexOf(t);this._order.splice(h,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(a.fqid),this._changes.removeLayer(a);const g=this.getOwnLayerSourceCache(a);if(g&&g.castsShadows){let _=!1;for(const w in this._layers)if(this._layers[w].source===a.source&&this._layers[w].canCastShadows()){_=!0;break}g.castsShadows=_}a.onRemove&&a.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const a in this._layers)if(this._layers[a].type===t)return!0;return!1}setLayerZoomRange(t,a,h){this._checkLoaded();const g=this._checkLayer(t);g&&(g.minzoom===a&&g.maxzoom===h||(a!=null&&(g.minzoom=a),h!=null&&(g.maxzoom=h),this._updateLayer(g)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,a){this._checkLoaded();const h=this._checkLayer(t);h&&h.slot!==a&&(h.slot=a,this._updateLayer(h))}setFilter(t,a,h={}){this._checkLoaded();const g=this._checkLayer(t);if(g&&!s.bv(g.filter,a))return a==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(Be,`layers.${g.id}.filter`,a,{layerType:g.type},h)||(g.filter=s.di(a),this._updateLayer(g)))}getFilter(t){const a=this._checkLayer(t);if(a)return s.di(a.filter)}setLayoutProperty(t,a,h,g={}){this._checkLoaded();const _=this._checkLayer(t);if(_&&!s.bv(_.getLayoutProperty(a),h)){if(h!=null&&(!g||g.validate!==!1)&&Ll(_,ie.call(jr,{key:`layers.${t}.layout.${a}`,layerType:_.type,objectKey:a,value:h,styleSpec:s.a5,style:{glyphs:!0,sprite:!0}})))return;_.setLayoutProperty(a,h),_.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid),this._updateLayer(_)}}getLayoutProperty(t,a){const h=this._checkLayer(t);if(h)return h.getLayoutProperty(a)}setPaintProperty(t,a,h,g={}){this._checkLoaded();const _=this._checkLayer(t);if(!_||s.bv(_.getPaintProperty(a),h)||h!=null&&(!g||g.validate!==!1)&&Ll(_,Y.call(jr,{key:`layers.${t}.paint.${a}`,layerType:_.type,objectKey:a,value:h,styleSpec:s.a5})))return;const w=_.setPaintProperty(a,h);_.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid),w&&this._updateLayer(_),this._changes.updatePaintProperties(_)}getPaintProperty(t,a){const h=this._checkLayer(t);if(h)return h.getPaintProperty(a)}setFeatureState(t,a){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:C,importId:R}=t.target,D=this.getFragmentStyle(R),z=D.getFeaturesetLayers(C);for(const{source:k,sourceLayer:F}of z)D.setFeatureState({id:t.id,source:k,sourceLayer:F},a)}else if("layerId"in t.target){const{layerId:C}=t.target,R=this.getLayer(C);this.setFeatureState({id:t.id,source:R.source,sourceLayer:R.sourceLayer},a)}return}const h=t.source,g=t.sourceLayer,_=this._checkSource(h);if(!_)return;const w=_.type;if(w==="geojson"&&g)return void this.fire(new s.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!g)return void this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new s.z(new Error("The feature id parameter must be provided.")));const T=this.getOwnSourceCaches(h);for(const C of T)C.setFeatureState(g,t.id,a)}removeFeatureState(t,a){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:C,importId:R}=t.target,D=this.getFragmentStyle(R),z=D.getFeaturesetLayers(C);for(const{source:k,sourceLayer:F}of z)D.removeFeatureState({id:t.id,source:k,sourceLayer:F},a)}else if("layerId"in t.target){const{layerId:C}=t.target,R=this.getLayer(C);this.removeFeatureState({id:t.id,source:R.source,sourceLayer:R.sourceLayer},a)}return}const h=t.source,g=this._checkSource(h);if(!g)return;const _=g.type,w=_==="vector"?t.sourceLayer:void 0;if(_==="vector"&&!w)return void this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new s.z(new Error("A feature id is required to remove its specific state property.")));const T=this.getOwnSourceCaches(h);for(const C of T)C.removeFeatureState(w,t.id,a)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let _;if("featuresetId"in t.target){const{featuresetId:w,importId:T}=t.target,C=this.getFragmentStyle(T),R=C.getFeaturesetLayers(w);for(const{source:D,sourceLayer:z}of R){const k=C.getFeatureState({id:t.id,source:D,sourceLayer:z});if(k&&!_)_=k;else if(!s.bv(_,k))return void this.fire(new s.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:w}=t.target,T=this.getLayer(w);_=this.getFeatureState({id:t.id,source:T.source,sourceLayer:T.sourceLayer})}return _}const a=t.source,h=t.sourceLayer,g=this._checkSource(a);if(g){if(g.type!=="vector"||h)return t.id===void 0&&this.fire(new s.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(a)[0].getFeatureState(h,t.id);this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=s.h({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return s.h({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),a=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return s.dp({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:a,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},h=>h!==void 0)}_updateFilteredLayers(t){for(const a of Object.values(this._mergedLayers))t(a)&&this._updateLayer(a)}_updateLayer(t){this._changes.updateLayer(t);const a=this.getLayerSourceCache(t),h=s.C(t.source,t.scope),g=this._changes.getUpdatedSourceCaches();t.source&&!g[h]&&a&&a.getSource().type!=="raster"&&(this._changes.updateSourceCache(h,"reload"),a.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const a=T=>this._mergedLayers[T].is3D(!!this.terrain),h=this.order,g={},_=[];for(let T=h.length-1;T>=0;T--){const C=h[T];if(a(C)){g[C]=T;for(const R of t){const D=R[C];if(D)for(const z of D)_.push(z)}}}_.sort((T,C)=>C.intersectionZ-T.intersectionZ);const w=[];for(let T=h.length-1;T>=0;T--){const C=h[T];if(a(C))for(let R=_.length-1;R>=0;R--){const D=_[R].feature;if(D.layer&&g[D.layer.id]<T)break;w.push(D),_.pop()}else for(const R of t){const D=R[C];if(D)for(const z of D)w.push(z.feature)}}return w}queryRenderedFeatures(t,a,h){let g;a&&!Array.isArray(a)&&a.filter&&(this._validate(Be,"queryRenderedFeatures.filter",a.filter,null,a),g=s.b3(a.filter));const _={},w=D=>{if(vf.has(D.type))return;const z=this.getOwnLayerSourceCache(D),k=_[z.id]=_[z.id]||{sourceCache:z,layers:{},has3DLayers:!1};D.is3D(!!this.terrain)&&(k.has3DLayers=!0),k.layers[D.fqid]=k.layers[D.fqid]||{styleLayer:D,targets:[]},k.layers[D.fqid].targets.push({filter:g})};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new s.z(new Error("parameters.layers must be an Array."))),[];for(const D of a.layers){const z=this._layers[D];if(!z)return this.fire(new s.z(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];w(z)}}else for(const D in this._layers)w(this._layers[D]);const T=this._queryRenderedFeatures(t,_,h),C=this._flattenAndSortRenderedFeatures(T),R=[];for(const D of C)s.dq(D.layer.id)===this.scope&&R.push(D);return R}queryRenderedFeatureset(t,a,h){let g;a&&!Array.isArray(a)&&a.filter&&(this._validate(Be,"queryRenderedFeatures.filter",a.filter,null,a),g=s.b3(a.filter));const _="mock",w=[];if(a&&a.target)w.push(Object.assign({},a,{targetId:_,filter:g}));else{const D=this.getFeaturesetDescriptors();for(const z of D)w.push({targetId:_,filter:g,target:z});for(const{style:z}of this.fragments){const k=z.getFeaturesetDescriptors();for(const F of k)w.push({targetId:_,filter:g,target:F})}}const T=this.queryRenderedTargets(t,w,h),C=[],R=new Set;for(const D of T)for(const z of D.variants[_])uf(z,D,R)||C.push(new s.dr(D,z));return C}queryRenderedTargets(t,a,h){const g={},_=(T,C,R,D)=>{const z=g[C.id]=g[C.id]||{sourceCache:C,layers:{},has3DLayers:!1};if(z.layers[T.fqid]=z.layers[T.fqid]||{styleLayer:T,targets:[]},T.is3D(!!this.terrain)&&(z.has3DLayers=!0),!D)return R.uniqueFeatureID=!1,void z.layers[T.fqid].targets.push(R);z.layers[T.fqid].targets.push(Object.assign({},R,{namespace:D.namespace,properties:D.properties,uniqueFeatureID:D.uniqueFeatureID}))};for(const T of a)if("featuresetId"in T.target){const{featuresetId:C,importId:R}=T.target,D=this.getFragmentStyle(R);if(!D||!D._featuresetSelectors)continue;const z=D._featuresetSelectors[C];if(!z){this.fire(new s.z(new Error(`The featureset '${C}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const k of z){const F=D.getOwnLayer(k.layerId);F&&!vf.has(F.type)&&_(F,D.getOwnLayerSourceCache(F),T,k)}}else if("layerId"in T.target){const{layerId:C}=T.target,R=this.getLayer(C);if(!R||vf.has(R.type))continue;_(R,this.getLayerSourceCache(R),T)}const w=this._queryRenderedFeatures(t,g,h);return this._flattenAndSortRenderedFeatures(w)}_queryRenderedFeatures(t,a,h){const g=[],_=!!this.map._showQueryGeometry,w=_n.createFromScreenPoints(t,h);for(const T in a){const C=df(w,a[T],this._availableImages,h,_);Object.keys(C).length&&g.push(C)}if(this.placement)for(const T in a){if(!a[T].sourceCache._onlySymbols)continue;const C=pc(w.screenGeometry,a[T],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(C).length&&g.push(C)}return g}querySourceFeatures(t,a){const h=a&&a.filter;h&&this._validate(Be,"querySourceFeatures.filter",h,null,a);let g=[];const _=this.getOwnSourceCaches(t);for(const w of _)g=g.concat(Ud(w,a));return g}addSourceType(t,a,h){return ea.getSourceType(t)?h(new Error(`A source type called "${t}" already exists.`)):(ea.setSourceType(t,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:a.workerSourceURL},h):h(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,a,h={}){this._checkLoaded();const g=this.light.getLight();let _=!1;for(const T in t)if(!s.bv(t[T],g[T])){_=!0;break}if(!_)return;const w=this._getTransitionParameters();this.light.setLight(t,a,h),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,a=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),a===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let h=t;const g=t.source==null;if(a===1){if(this.disableElevatedTerrain)return;if(typeof h.source=="object"){const T="terrain-dem-src";this.addSource(T,h.source),h=s.di(h),h=s.h(h,{source:T})}const _=s.h({},h),w={};if(this.terrain&&g){_.source=this.terrain.get().source;const T=this.terrain?this.getFragmentStyle(this.terrain.scope):null;T&&(w.style=T.serialize())}if(this._validate(ht,"terrain",_,w))return}if(!this.terrain||this.terrain.scope!==this.scope&&!g||this.terrain&&a!==this.terrain.drapeRenderMode){if(!h)return;this._createTerrain(h,a),this.fire(new s.A("data",{dataType:"style"}))}else{const _=this.terrain,w=_.get();for(const T of Object.keys(s.a5.terrain))!h.hasOwnProperty(T)&&s.a5.terrain[T].default&&(h[T]=s.a5.terrain[T].default);for(const T in t)if(!s.bv(t[T],w[T])){_.set(t,this.options),this.stylesheet.terrain=t;const C=this._getTransitionParameters({duration:0});_.updateTransitions(C),this.fire(new s.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const a=this.fog=new Vi(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=a.get();const h=this._getTransitionParameters({duration:0});a.updateTransitions(h)}_createSnow(t){const a=this.snow=new Xr(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=a.get();const h=this._getTransitionParameters({duration:0});a.updateTransitions(h)}_createRain(t){const a=this.rain=new Br(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=a.get();const h=this._getTransitionParameters({duration:0});a.updateTransitions(h)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog;if(!s.bv(a.get(),t)){a.set(t,this.options),this.stylesheet.fog=a.get();const h=this._getTransitionParameters({duration:0});a.updateTransitions(h)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const a=this.snow;if(!s.bv(a.get(),t)){a.set(t,this.options),this.stylesheet.snow=a.get();const h=this._getTransitionParameters({duration:0});a.updateTransitions(h)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const a=this.rain;if(!s.bv(a.get(),t)){a.set(t,this.options),this.stylesheet.rain=a.get();const h=this._getTransitionParameters({duration:0});a.updateTransitions(h)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const g in this._layers)this._layers[g].lut=this._styleColorTheme.lut;for(const g in this._sourceCaches)this._sourceCaches[g].clearTiles()},a=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!a)return this._styleColorTheme.lut=null,void t();const h=this._evaluateColorThemeData(a);this._loadColorTheme(h).then(()=>{this.fire(new s.A("colorthemeset")),t()}).catch(g=>{s.w(`Couldn't set color theme: ${g}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&s.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,a){const h=this.getFragmentStyle(t);h&&(h._styleColorTheme.colorThemeOverride=a,h._reloadColorTheme())}_getTransitionParameters(t){return{now:s.q.now(),transition:s.h(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],a=[];for(const h of this._mergedOrder)this.isLayerDraped(this._mergedLayers[h])?t.push(h):a.push(h);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...a)}_createTerrain(t,a){const h=this.terrain=new ke(t,a,this.scope,this.options,this.map.getWorldview());a===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const g=this._getTransitionParameters({duration:0});h.updateTransitions(g)}_force3DLayerUpdate(){for(const t in this._layers){const a=this._layers[t];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const a=this._layers[t];a.type==="symbol"&&this._updateLayer(a)}}_validate(t,a,h,g,_={}){if(_&&_.validate===!1)return!1;const w=s.h({},this.serialize());return Ll(this,t.call(jr,s.h({key:a,style:w,value:h,styleSpec:s.a5},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.ds.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const a=this.getSourceCaches(t);for(const h of a)h.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}clearLayers(){for(const t in this._mergedLayers){const a=this._mergedLayers[t];a._clear&&a._clear()}}reloadSource(t){const a=this.getSourceCaches(t);for(const h of a)h.resume(),h.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let a;this.directionalLight&&(a=fu(this.directionalLight));const h=new Set;for(const g in this._mergedLayers){const _=this._mergedLayers[g];_.hasElevation()&&!h.has(_.source)&&h.add(_.source)}for(const g in this._mergedSourceCaches){const _=this._mergedSourceCaches[g],w=h.has(_._source.id);_.update(t,void 0,void 0,a,w)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const a=this._sourceCaches[t];a.resume(),a.reload()}}_updatePlacement(t,a,h,g,_,w,T=!1){let C=!1,R=!1;const D={},z={};for(const k of this._mergedOrder){const F=this._mergedLayers[k];if(F.type!=="symbol")continue;const q=s.C(F.source,F.scope);let $=D[q];if(!$){const Z=this.getLayerSourceCache(F);if(!Z)continue;const ne=Z.getRenderableIds(!0).map(ae=>Z.getTileByID(ae));z[q]=ne.slice(),$=D[q]=ne.sort((ae,de)=>de.tileID.overscaledZ-ae.tileID.overscaledZ||(ae.tileID.isLessThan(de.tileID)?-1:1))}const X=this.crossTileSymbolIndex.addLayer(F,$,a.center.lng,a.projection);C=C||X}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),T=T||this._layerOrderChanged||g===0,this._layerOrderChanged&&this.fire(new s.A("neworder")),(T||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.q.now(),a.zoom))&&(this.pauseablePlacement=new _f(a,this._mergedOrder,T,h,g,_,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,D,z,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.q.now()),R=!0),C&&this.pauseablePlacement.placement.setStale()),R||C){this._buildingIndex.onNewFrame(a.zoom);for(let k=0;k<this._mergedOrder.length;k++){const F=this._mergedLayers[this._mergedOrder[k]];if(F.type!=="symbol")continue;const q=this.isLayerClipped(F);this.placement.updateLayerOpacities(F,D[s.C(F.source,F.scope)],k,q?w:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,a){this._checkLoaded();const h=this.stylesheet.imports=this.stylesheet.imports||[];if(h.findIndex(({id:_})=>_===t.id)!==-1)return void this.fire(new s.z(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!a)return h.push(t),this._loadImports([t],!0);const g=h.findIndex(({id:_})=>_===a);return g===-1&&this.fire(new s.z(new Error(`Import with id "${a}" does not exist on this map.`))),this.stylesheet.imports=h.slice(0,g).concat(t).concat(h.slice(g)),this._loadImports([t],!0,a)}updateImport(t,a){this._checkLoaded();const h=this.stylesheet.imports||[],g=this.getImportIndex(t);return g===-1?this:typeof a=="string"?(this.setImportUrl(t,a),this):(a.url&&a.url!==h[g].url&&this.setImportUrl(t,a.url),s.bv(a.config,h[g].config)||this.setImportConfig(t,a.config,a.data.schema),s.bv(a.data,h[g].data)||this.setImportData(t,a.data),this)}moveImport(t,a){this._checkLoaded();let h=this.stylesheet.imports||[];const g=this.getImportIndex(t);if(g===-1)return this;const _=this.getImportIndex(a);if(_===-1)return this;const w=h[g],T=this.fragments[g];return h=h.filter(({id:C})=>C!==t),this.fragments=this.fragments.filter(({id:C})=>C!==t),this.stylesheet.imports=h.slice(0,_).concat(w).concat(h.slice(_)),this.fragments=this.fragments.slice(0,_).concat(T).concat(this.fragments.slice(_)),this.mergeLayers(),this}setImportUrl(t,a){this._checkLoaded();const h=this.stylesheet.imports||[],g=this.getImportIndex(t);if(g===-1)return this;h[g].url=a;const _=this.fragments[g];return _.style=this._createFragmentStyle(h[g]),_.style.on("style.import.load",()=>this.mergeAll()),_.style.loadURL(a),this}setImportData(t,a){this._checkLoaded();const h=this.getImportIndex(t),g=this.stylesheet.imports||[];return h===-1?this:a?(this.fragments[h].style.setState(a),this._reloadImports(),this):(delete g[h].data,this.setImportUrl(t,g[h].url))}setImportConfig(t,a,h){this._checkLoaded();const g=this.getImportIndex(t),_=this.stylesheet.imports||[];if(g===-1)return this;a?_[g].config=a:delete _[g].config;const w=this.fragments[g];h&&w.style.stylesheet&&(w.style.stylesheet.schema=h);const T=w.style.stylesheet&&w.style.stylesheet.schema;return w.config=a,w.style.updateConfig(a,T),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const a=this.stylesheet.imports||[],h=this.getImportIndex(t);h!==-1&&(a.splice(h,1),this.fragments[h].style._remove(),this.fragments.splice(h,1),this._reloadImports())}getImportIndex(t){const a=(this.stylesheet.imports||[]).findIndex(h=>h.id===t);return a===-1&&this.fire(new s.z(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),a}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const a in this._mergedOtherSourceCaches){const h=this._mergedOtherSourceCaches[a];h&&t.push(h.getSource())}return t}getSource(t,a){const h=this.getSourceCache(t,a);return h&&h.getSource()}getLayerSource(t){const a=this.getLayerSourceCache(t);return a&&a.getSource()}getSourceCache(t,a){const h=s.C(t,a);return this._mergedOtherSourceCaches[h]}getLayerSourceCache(t){const a=s.C(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[a]:this._mergedOtherSourceCaches[a]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const a=[];return this._mergedOtherSourceCaches[t]&&a.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&a.push(this._mergedSymbolSourceCaches[t]),a}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const a in t){const h=t[a];h==="reload"?this.reloadSource(a):h==="clear"&&this.clearSource(a)}}updateLayers(t){const a=this._changes.getUpdatedPaintProperties();for(const h of a){const g=this.getLayer(h);g&&g.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t)}getImages(t,a,h){this.imageManager.getImages(a.images,a.scope,h),this._updateTilesForChangedImages();const g=w=>{if(w){const T=a.images.map(C=>s.I.toString(C));w.setDependencies(a.tileID.key,a.type,T)}},_=s.C(a.source,a.scope);g(this._mergedOtherSourceCaches[_]),g(this._mergedSymbolSourceCaches[_]),a.images.some(w=>w.iconsetId)&&this.fire(new s.A("data",{dataType:"style"}))}rasterizeImages(t,a,h){this.imageManager.rasterizeImages(a,h)}getGlyphs(t,a,h){this.glyphManager.getGlyphs(a.stacks,h)}getResource(t,a,h){return s.dt(a,h)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const a=[];return this._otherSourceCaches[t]&&a.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&a.push(this._symbolSourceCaches[t]),a}_isSourceCacheLoaded(t){const a=this.getOwnSourceCaches(t);return a.length===0?(this.fire(new s.z(new Error(`There is no source with ID '${t}'`))),!1):a.every(h=>h.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,a){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const h=t.type==="fill-extrusion"&&(t.sourceLayer==="building"||t.sourceLayer==="procedural_buildings"),g=t.type==="building";if(t.is3D(!!this.terrain)){if(h||g||a&&a.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ea.getSourceType=function(d){return cf[d]},ea.setSourceType=function(d,t){cf[d]=t},ea.registerForPluginStateChange=s.du;var $m=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,mu=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,gu=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Hm="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",wf=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Do=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,bf=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Et=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,qm=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Sf=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Tf=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const ah=[];ma($m,ah),ma(gu,ah),ma(mu,ah);const Sc={"_prelude_fog.vertex.glsl":Do,"_prelude_terrain.vertex.glsl":wf,"_prelude_shadow.vertex.glsl":Sf,"_prelude_fog.fragment.glsl":bf,"_prelude_shadow.fragment.glsl":Tf,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Et,"_prelude_raster_particle.glsl":qm},ta={};Ji("",wf),Ji(bf,Do),Ji(Tf,Sf),Ji(Et,""),Ji(qm,"");const Ef=Ji(mu,gu),Ol=$m;var lh={background:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,base_color.rgb,emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:Ji(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:Ji(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ji("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ji(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ji(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ji("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ji("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ji("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Ji(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Ji(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Ji(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Ji(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Ji(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Ji(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Ji("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Ji("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Ji(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Ji(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Ji("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Ji(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Hm),skyboxGradient:Ji(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Hm),skyboxCapture:Ji(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ji(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Ji(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Ji(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Ji(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Ji("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Ji("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Ji("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Ji("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function ma(d,t){const a=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let h of a)if(h=h.trim(),h[0]==="#"&&h.includes("if")&&!h.includes("endif")){h=h.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const g=h.split(" ");for(const _ of g)t.includes(_)||t.push(_)}}function Ji(d,t){const a=/#include\s+"([^"]+)"/g,h=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let g=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);g&&(g=g.map(R=>{const D=R.split(" ");return D[D.length-1]}),g=[...new Set(g)]);const _={},w=[],T=[];if(d=d.replace(a,(R,D)=>(T.push(D),"")),(t=t.replace(a,(R,D)=>(w.push(D),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let C=[...ah];ma(d,C),ma(t,C);for(const R of[...w,...T])Sc[R]||console.error(`Undefined include: ${R}`),ta[R]||(ta[R]=[],ma(Sc[R],ta[R])),C=[...C,...ta[R]];return{fragmentSource:d=d.replace(h,(R,D,z,k,F)=>(_[F]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${F}
in ${z} ${k} ${F};
#else
uniform ${z} ${k} u_${F};
#endif
`:D==="initialize"?`
#ifdef HAS_UNIFORM_u_${F}
    ${z} ${k} ${F} = u_${F};
#endif
`:D==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    in ${z} ${k} ${F};
#endif
`:D==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(h,(R,D,z,k,F)=>{const q=k==="float"?"vec2":k,$=F.match(/color/)?"color":q;return D==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${F}
in ${z} ${k} a_${F};
#endif
`:_[F]?D==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
in ${z} ${q} a_${F};
out ${z} ${k} ${F};
#else
uniform ${z} ${k} u_${F};
#endif
`:D==="initialize"?$==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${z} ${k} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${$}(a_${F}, u_${F}_t);
#else
    ${z} ${k} ${F} = u_${F};
#endif
`:D==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    in ${z} ${k} a_${F};
    out ${z} ${k} ${F};
#endif
`:D==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    ${F} = a_${F};
#endif
`:void 0:D==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
in ${z} ${q} a_${F};
#else
uniform ${z} ${k} u_${F};
#endif
`:D==="define-instanced"?$==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${F}0;
in vec4 a_${F}1;
in vec4 a_${F}2;
in vec4 a_${F}3;
#else
uniform ${z} ${k} u_${F};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${z} ${q} a_${F};
#else
uniform ${z} ${k} u_${F};
#endif
`:D==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    ${z} ${k} ${F} = a_${F};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${z} ${k} ${F} = a_${F};
#else
    ${z} ${k} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${z} ${k} ${F} = unpack_mix_${$}(a_${F}, u_${F}_t);
#else
    ${z} ${k} ${F} = u_${F};
#endif
`}),staticAttributes:g,usedDefines:C,vertexIncludes:w,fragmentIncludes:T}}class Zw{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,a,h,g,_,w,T,C){this.context=t;let R=this.boundPaintVertexBuffers.length!==g.length;for(let z=0;!R&&z<g.length;z++)this.boundPaintVertexBuffers[z]!==g[z]&&(R=!0);let D=this.boundDynamicVertexBuffers.length!==T.length;for(let z=0;!D&&z<T.length;z++)this.boundDynamicVertexBuffers[z]!==T[z]&&(D=!0);if(!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==h||R||D||this.boundIndexBuffer!==_||this.boundVertexOffset!==w)this.freshBind(a,h,g,_,w,T,C);else{t.bindVertexArrayOES.set(this.vao);for(const z of T)z&&(z.bind(),C&&z.instanceCount&&z.setVertexAttribDivisor(t.gl,a,C));_&&_.dynamicDraw&&_.bind()}}freshBind(t,a,h,g,_,w,T){const C=t.numAttributes,R=this.context,D=R.gl;this.vao&&this.destroy(),this.vao=R.gl.createVertexArray(),R.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=g,this.boundVertexOffset=_,this.boundDynamicVertexBuffers=w,a.enableAttributes(D,t),a.bind(),a.setVertexAttribPointers(D,t,_);for(const z of h)z.enableAttributes(D,t),z.bind(),z.setVertexAttribPointers(D,t,_);for(const z of w)z&&(z.enableAttributes(D,t),z.bind(),z.setVertexAttribPointers(D,t,_),T&&z.instanceCount&&z.setVertexAttribDivisor(D,t,T));g&&g.bind(),R.currentNumAttributes=C}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Wm(d,t){const a=Math.pow(2,t.canonical.z),h=t.canonical.y;return[new s.ac(0,h/a).toLngLat().lat,new s.ac(0,(h+1)/a).toLngLat().lat]}function Xw(d,t,a,h,g,_,w){const T=d.context,C=T.gl,R=a.hillshadeFBO;if(!R)return;d.prepareDrawTile();const D=d.isTileAffectedByFog(t),z=d.getOrCreateProgram("hillshade",{overrideFog:D});T.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,R.colorAttachment.get());const k=((X,Z,ne,ae)=>{const de=ne.paint.get("hillshade-shadow-color"),_e=ne.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",be=ne.paint.get("hillshade-highlight-color"),Te=ne.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ye=ne.paint.get("hillshade-accent-color"),xe=ne.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",ve=ne.paint.get("hillshade-emissive-strength");let Oe=s.al(ne.paint.get("hillshade-illumination-direction"));if(ne.paint.get("hillshade-illumination-anchor")==="viewport")Oe-=X.transform.angle;else if(X.style&&X.style.enable3dLights()&&X.style.directionalLight){const Ye=X.style.directionalLight.properties.get("direction"),Ue=s.d1(Ye.x,Ye.y,Ye.z);Oe=s.al(Ue[1])}const Pe=!X.options.moving;return{u_matrix:ae||X.transform.calculateProjMatrix(Z.tileID.toUnwrapped(),Pe),u_image:0,u_latrange:Wm(0,Z.tileID),u_light:[ne.paint.get("hillshade-exaggeration"),Oe],u_shadow:de.toPremultipliedRenderColor(_e?null:ne.lut),u_highlight:be.toPremultipliedRenderColor(Te?null:ne.lut),u_emissive_strength:ve,u_accent:ye.toPremultipliedRenderColor(xe?null:ne.lut)}})(d,a,h,d.terrain?t.projMatrix:null);d.uploadCommonUniforms(T,z,t.toUnwrapped());const{tileBoundsBuffer:F,tileBoundsIndexBuffer:q,tileBoundsSegments:$}=d.getTileBoundsBuffers(a);z.draw(d,C.TRIANGLES,g,_,w,ai.disabled,k,h.id,F,q,$)}function Zm(d,t,a){if(!t.needsDEMTextureUpload)return;const h=d.context,g=h.gl;h.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||d.getTileTexture(a.stride);const _=a.getPixels();t.demTexture?t.demTexture.update(_,{premultiply:!1}):t.demTexture=new s.T(h,_,g.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function xx(d,t,a){const h=d.context,g=h.gl;if(!t.dem)return;const _=t.dem;if(h.activeTexture.set(g.TEXTURE1),Zm(d,t,_),!t.demTexture)return;t.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE);const w=_.dim;h.activeTexture.set(g.TEXTURE0);let T=t.hillshadeFBO;if(!T){const k=new s.T(h,{width:w,height:w,data:null},g.RGBA8);k.bind(g.LINEAR,g.CLAMP_TO_EDGE),T=t.hillshadeFBO=h.createFramebuffer(w,w,!0,"renderbuffer"),T.colorAttachment.set(k.texture)}h.bindFramebuffer.set(T.framebuffer),h.viewport.set([0,0,w,w]);const{tileBoundsBuffer:C,tileBoundsIndexBuffer:R,tileBoundsSegments:D}=d.getMercatorTileBoundsBuffers(),z=[];d.linearFloatFilteringSupported()&&z.push("TERRAIN_DEM_FLOAT_FORMAT"),d.getOrCreateProgram("hillshadePrepare",{defines:z}).draw(d,g.TRIANGLES,Ft.disabled,pi.disabled,Ni.unblended,ai.disabled,((k,F)=>{const q=F.stride,$=s.bz();return s.ca($,0,s.aj,-s.aj,0,0,1),s.bo($,$,[0,-s.aj,0]),{u_matrix:$,u_image:1,u_dimension:[q,q],u_zoom:k.overscaledZ}})(t.tileID,_),a.id,C,R,D),t.needsHillshadePrepare=!1}class tr{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Kw extends tr{getDefault(){return s.am.transparent.toNonPremultipliedRenderColor(null)}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Yw extends tr{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Jw extends tr{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Qw extends tr{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class vx extends tr{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class eb extends tr{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Cf extends tr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class tb extends tr{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class wx extends tr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class Xm extends tr{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Af extends tr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class Km extends tr{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Tc extends tr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class _u extends tr{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class If extends tr{getDefault(){return s.am.transparent.toNonPremultipliedRenderColor(null)}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Pf extends tr{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class yu extends tr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class bx extends tr{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Ym extends tr{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let Sx=class extends tr{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class xu extends tr{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Mf extends tr{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Rf extends tr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Jm extends tr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Df extends tr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class ch extends tr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Tx extends tr{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ex extends tr{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class Cx extends tr{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class vu extends tr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Ax extends tr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Qm extends tr{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class ib extends Qm{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ix extends Qm{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class eg extends Qm{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,this.attachment(),a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class tg extends Ix{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const ig=(d,t,a)=>({u_matrix:d,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:a}),kf=(d,t,a,h,g,_,w,T,C,R,D,z,k,F,q,$)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(h),u_merc_matrix:a,u_zoom_transition:g,u_merc_center:_,u_image0:0,u_frustum_tl:w,u_frustum_tr:T,u_frustum_br:C,u_frustum_bl:R,u_globe_pos:D,u_globe_radius:z,u_viewport:k,u_grid_matrix:$?Float32Array.from($):new Float32Array(9),u_skirt_height:F,u_far_z_cutoff:q});function ng(d,t){return d!=null&&t!=null&&!(!d.hasData()||!t.hasData())&&d.demTexture!=null&&t.demTexture!=null&&d.tileID.key!==t.tileID.key}const Ec=new class{constructor(){this.operations={}}newMorphing(d,t,a,h,g){if(d in this.operations){const _=this.operations[d];_.to.tileID.key!==a.tileID.key&&(_.queued=a)}else this.operations[d]={startTime:h,phase:0,duration:g,from:t,to:a,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const t=this.operations[d];return{from:t.from,to:t.to,phase:t.phase}}update(d){for(const t in this.operations){const a=this.operations[t];for(a.phase=(d-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,d)){delete this.operations[t];break}}}_nextOp(d,t){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=t,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},Px={0:null,1:"TERRAIN_VERTEX_MORPHING"};function wu(d,t,a){if(t===0)return 0;const h=t<1&&a===514?.25/t:1;return 6*Math.pow(1.5,22-d)*Math.max(t,1)*h}function uh(d,t){const a=1<<d.z;return!t&&(d.x===0||d.x===a-1)||d.y===0||d.y===a-1}const Nf=d=>({u_matrix:d});function ao(d,t,a,h,g){if(g>0){const _=s.q.now(),w=(_-d.timeAdded)/g,T=t?(_-t.timeAdded)/g:-1,C=a.getSource(),R=h.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),D=!t||Math.abs(t.tileID.overscaledZ-R)>Math.abs(d.tileID.overscaledZ-R),z=D&&d.refreshedUponExpiration?1:s.ay(D?w:1-T,0,1);return d.refreshedUponExpiration&&w>=1&&(d.refreshedUponExpiration=!1),t?{opacity:1,mix:1-z}:{opacity:z,mix:0}}return{opacity:1,mix:0}}class rg extends so{constructor(t){const a=Bd("mock-dem",{type:"raster-dem",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("mock-dem",a,!1),a.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,a){t.state="loaded",a(null)}}class Lf extends so{constructor(t){const a=Bd("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,a,h){if(t.freezeTileCoverage)return;this.transform=t;const g=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((_,w)=>{if(_[w.key]="",!this._tiles[w.key]){const T=new mc(w,this._source.tileSize*w.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);T.state="loaded",this._tiles[w.key]=T}return _},{});for(const _ in this._tiles)_ in g||(this.freeFBO(_),this._tiles[_].unloadVectorData(),delete this._tiles[_])}freeFBO(t){const a=this.proxyCachedFBO[t];if(a!==void 0){const h=Object.values(a);this.renderCachePool.push(...h),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class dh extends s.aM{constructor(t,a,h){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=a,this.projMatrix=h}}class zf extends s.dF{constructor(t,a){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[h,g,_]=function(C){const R=new s.ba,D=new s.a_,z=131;R.reserve(17161),D.reserve(33800);const k=s.aj/128,F=s.aj+k/2,q=F+k;for(let X=-k;X<q;X+=k)for(let Z=-k;Z<q;Z+=k){const ne=Z<0||Z>F||X<0||X>F?24575:0,ae=s.ay(Math.round(Z),0,s.aj),de=s.ay(Math.round(X),0,s.aj);R.emplaceBack(ae+ne,de)}const $=(X,Z)=>{const ne=Z*z+X;D.emplaceBack(ne+1,ne,ne+z),D.emplaceBack(ne+z,ne+z+1,ne+1)};for(let X=1;X<129;X++)for(let Z=1;Z<129;Z++)$(Z,X);return[0,129].forEach(X=>{for(let Z=0;Z<130;Z++)$(Z,X),$(X,Z)}),[R,D,32768]}(),w=t.context;this.gridBuffer=w.createVertexBuffer(h,s.bc.members),this.gridIndexBuffer=w.createIndexBuffer(g),this.gridSegments=s.bd.simpleSegment(0,0,h.length,g.length),this.gridNoSkirtSegments=s.bd.simpleSegment(0,0,h.length,_),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Lf(a.map),this.orthoMatrix=s.bz(),s.ca(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.aj,0,s.aj,0,1);const T=w.gl;this._overlapStencilMode=new pi({func:T.GEQUAL,mask:255},0,255,T.KEEP,T.KEEP,T.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new rg(a.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,a,h){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const g=t.terrain.properties,_=t.terrain.drapeRenderMode===0,w=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.q.now();const T=t.terrain&&t.terrain.scope,C=g.get("source"),R=_?this._mockSourceCache:t.getSourceCache(C,T);if(!R)return void s.w(`Couldn't find terrain source "${C}".`);if(this.sourceCache=R,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=w?this.calculateExaggeration(a):g.get("exaggeration"),!a.projection.requiresDraping&&w&&this._exaggeration===0)return void this._disable();this.enabled=!0;const D=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const z=this.getScaledDemTileSize();this.sourceCache.update(a,z,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,D(),this._initializing=!0),D(),a.updateElevation(!0,h),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0,this._previousZoom=a.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const a=this._previousCameraAltitude,h=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=h;const g=a!=null?h-a:Number.MAX_VALUE;if(Math.abs(g)<2)return this._exaggeration;const _=t.zoom,w=this._style.terrain;if(!this._previousUpdateTimestamp)return w.getExaggeration(_);let T=_-this._previousZoom;const C=this._previousUpdateTimestamp;let R=_;this._evaluationZoom!=null&&(R=this._evaluationZoom,Math.abs(_-R)>.5&&(T=.5*(_-R+T)),T*g<0&&(R+=T)),this._evaluationZoom=R;const D=w.getExaggeration(R),z=D===w.getExaggeration(Math.max(0,R-.1));if(z&&Math.abs(D-this._exaggeration)<.01)return D;let k=Math.min(.1,.00375*(this._updateTimestamp-C));return(z||D<.1||Math.abs(T)<1e-4)&&(k=Math.min(.2,4*k)),s.ai(this._exaggeration,D,k)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,h=this.painter.transform;this._initializing&&(this._initializing=h._centerAltitude===0&&this.getAtPointOrZero(s.ac.fromLngLat(h.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const g=this.proxyCoords=a.getIds().map(C=>{const R=a.getTileByID(C).tileID;return R.projMatrix=h.calculateProjMatrix(R.toUnwrapped()),R});(function(C,R){const D=R.transform.pointCoordinate(R.transform.getCameraPoint()),z=new s.P(D.x,D.y);C.sort((k,F)=>{if(F.overscaledZ-k.overscaledZ)return F.overscaledZ-k.overscaledZ;const q=new s.P(k.canonical.x+(1<<k.canonical.z)*k.wrap,k.canonical.y),$=new s.P(F.canonical.x+(1<<F.canonical.z)*F.wrap,F.canonical.y),X=z.mult(1<<k.canonical.z);return X.x-=.5,X.y-=.5,X.distSqr(q)-X.distSqr($)})})(g,this.painter);const _=this.proxyToSource||{};this.proxyToSource={},g.forEach(C=>{this.proxyToSource[C.key]={}}),this.terrainTileForTile={};const w=this._style._mergedSourceCaches;for(const C in w){const R=w[C];if(!R.used||(R!==this.sourceCache&&this.resetTileLookupCache(R.id),this._setupProxiedCoordsForOrtho(R,t[C],_),R.usedForTerrain))continue;const D=t[C];R.getSource().reparseOverscaled&&this._assignTerrainTiles(D)}this.proxiedCoords[a.id]=g.map(C=>new dh(C,C.key,this.orthoMatrix)),this._assignTerrainTiles(g),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(_),this.renderingToTexture=!1;const T={};this._visibleDemTiles=[];for(const C of this.proxyCoords){const R=this.terrainTileForTile[C.key];if(!R)continue;const D=R.tileID.key;D in T||(this._visibleDemTiles.push(R),T[D]=D)}}_assignTerrainTiles(t){this._initializing||t.forEach(a=>{if(this.terrainTileForTile[a.key])return;const h=this._findTileCoveringTileID(a,this.sourceCache);h&&(this.terrainTileForTile[a.key]=h)})}_prepareDEMTextures(){const t=this.painter.context,a=t.gl;for(const h in this.terrainTileForTile){const g=this.terrainTileForTile[h],_=g.dem;!_||g.demTexture&&!g.needsDEMTextureUpload||(t.activeTexture.set(a.TEXTURE1),Zm(this.painter,g,_))}}_prepareDemTileUniforms(t,a,h,g){if(!a||a.demTexture==null)return!1;const _=t.tileID.canonical,w=Math.pow(2,a.tileID.canonical.z-_.z),T=g||"";return h[`u_dem_tl${T}`]=[_.x*w%1,_.y*w%1],h[`u_dem_scale${T}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const a=this._visibleDemTiles.reduce((h,g)=>{if(!g.dem)return h;const _=g.dem.tree.minimums[0];return _>0&&t++,h+_},0);return t?a/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,a=t.gl;t.activeTexture.set(a.TEXTURE2);const h=this._getLoadedAreaMinimum(),g=new s.dG({width:1,height:1},new Float32Array([h]));this._emptyDEMTextureDirty=!1;let _=this._emptyDEMTexture;return _?_.update(g,{premultiply:!1}):_=this._emptyDEMTexture=new s.T(t,g,a.R32F,{premultiply:!1}),_}setupElevationDraw(t,a,h){const g=this.painter.context,_=g.gl,w={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};w.u_exaggeration=this.exaggeration();let T=null,C=null,R=1;if(h&&h.morphing&&this._useVertexMorphing){const F=h.morphing.srcDemTile,q=h.morphing.dstDemTile;R=h.morphing.phase,F&&q&&(this._prepareDemTileUniforms(t,F,w,"_prev")&&(C=F),this._prepareDemTileUniforms(t,q,w)&&(T=q))}const D=F=>F&&F.demTexture&&this.painter.linearFloatFilteringSupported()?_.LINEAR:_.NEAREST;let z=null;var k;if(this.enabled?C&&T?(z=T.demTexture,g.activeTexture.set(_.TEXTURE4),C.demTexture.bind(D(C),_.CLAMP_TO_EDGE),w.u_dem_lerp=R):(T=this.terrainTileForTile[t.tileID.key],z=this._prepareDemTileUniforms(t,T,w)?T.demTexture:this.emptyDEMTexture):z=this.emptyDEMTexture,g.activeTexture.set(_.TEXTURE2),z&&(w.u_dem_size=(k=z).size[0]===1?1:k.size[0]-2,z.bind(D(T),_.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(h&&h.useDepthForOcclusion,a,w),h&&h.useMeterToDem&&T){const F=(1<<T.tileID.canonical.z)*s.cb(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=F}if(h&&h.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=h.labelPlaneMatrixInv),a.setTerrainUniformValues(g,w),this.painter.transform.projection.name==="globe"){const F=this.globeUniformValues(this.painter.transform,t.tileID.canonical,h&&h.useDenormalizedUpVectorScale);a.setGlobeUniformValues(g,F)}}globeUniformValues(t,a,h){const g=t.projection;return{u_tile_tl_up:g.upVector(a,0,0),u_tile_tr_up:g.upVector(a,s.aj,0),u_tile_br_up:g.upVector(a,s.aj,s.aj),u_tile_bl_up:g.upVector(a,0,s.aj),u_tile_up_scale:h?s.dH(1):g.upVectorScale(a,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const a=this.painter,h=this.painter.context;t.length!==0&&(h.bindFramebuffer.set(null),h.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(g,_,w,T,C){if(g.transform.projection.name==="globe")(function(R,D,z,k,F){const q=R.context,$=q.gl;let X,Z;const ne=R.transform,ae=s.dy(R,q,ne),de=(Ye,Ue)=>{if(Z===Ue)return;const Qe=[Px[Ue],"PROJECTION_GLOBE_VIEW"];ae&&Qe.push("CUSTOM_ANTIALIASING");const _t=R.isTileAffectedByFog(Ye);X=R.getOrCreateProgram("globeRaster",{defines:Qe,overrideFog:_t}),Z=Ue},_e=R.colorModeForRenderPass(),be=new Ft($.LEQUAL,Ft.ReadWrite,R.depthRangeFor3D);Ec.update(F);const Te=s.dz(ne),ye=[s.aD(ne.center.lng),s.aH(ne.center.lat)],xe=R.globeSharedBuffers,ve=[ne.width*s.q.devicePixelRatio,ne.height*s.q.devicePixelRatio],Oe=Float32Array.from(ne.globeMatrix),Pe={useDenormalizedUpVectorScale:!0};{const Ye=R.transform,Ue=wu(Ye.zoom,D.exaggeration(),D.sourceCache._source.tileSize);Z=-1;const Qe=$.TRIANGLES;for(const _t of k){const Fe=z.getTile(_t),Ae=pi.disabled,qe=D.prevTerrainTileForTile[_t.key],je=D.terrainTileForTile[_t.key];ng(qe,je)&&Ec.newMorphing(_t.key,qe,je,F,250),q.activeTexture.set($.TEXTURE0),Fe.texture&&Fe.texture.bind($.LINEAR,$.CLAMP_TO_EDGE);const nt=Ec.getMorphValuesForProxy(_t.key),st=nt?1:0;nt&&s.L(Pe,{morphing:{srcDemTile:nt.from,dstDemTile:nt.to,phase:s.dx(nt.phase)}});const ct=s.dA(_t.canonical),St=s.dB(ct.getCenter().lat),Ht=s.dC(_t.canonical,ct,St,Ye.worldSize/Ye._pixelsPerMercatorPixel),Qt=s.bh(s.dD(_t.canonical)),Lt=kf(Ye.expandedFarZProjMatrix,Oe,Te,Qt,s.ah(Ye.zoom),ye,Ye.frustumCorners.TL,Ye.frustumCorners.TR,Ye.frustumCorners.BR,Ye.frustumCorners.BL,Ye.globeCenterInViewSpace,Ye.globeRadius,ve,Ue,Ye._farZ,Ht);if(de(_t,st),X&&(D.setupElevationDraw(Fe,X,Pe),R.uploadCommonUniforms(q,X,_t.toUnwrapped()),xe)){const[Yt,Wt,xi]=xe.getGridBuffers(St,Ue!==0);X.draw(R,Qe,be,Ae,_e,ai.backCCW,Lt,"globe_raster",Yt,Wt,xi)}}}if(xe&&(R.renderDefaultNorthPole||R.renderDefaultSouthPole)){const Ye=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ae&&Ye.push("CUSTOM_ANTIALIASING"),X=R.getOrCreateProgram("globeRaster",{defines:Ye});for(const Ue of k){const{x:Qe,y:_t,z:Fe}=Ue.canonical,Ae=_t===0,qe=_t===(1<<Fe)-1,[je,nt,st,ct]=xe.getPoleBuffers(Fe,!1);if(ct&&(Ae||qe)){const St=z.getTile(Ue);q.activeTexture.set($.TEXTURE0),St.texture&&St.texture.bind($.LINEAR,$.CLAMP_TO_EDGE);let Ht=s.dE(Fe,Qe,ne);const Qt=s.bh(s.dD(Ue.canonical)),Lt=(Yt,Wt)=>Yt.draw(R,$.TRIANGLES,be,pi.disabled,_e,ai.disabled,kf(ne.expandedFarZProjMatrix,Ht,Ht,Qt,0,ye,ne.frustumCorners.TL,ne.frustumCorners.TR,ne.frustumCorners.BR,ne.frustumCorners.BL,ne.globeCenterInViewSpace,ne.globeRadius,ve,0,ne._farZ),"globe_pole_raster",Wt,st,ct);D.setupElevationDraw(St,X,Pe),R.uploadCommonUniforms(q,X,Ue.toUnwrapped()),Ae&&R.renderDefaultNorthPole&&Lt(X,je),qe&&R.renderDefaultSouthPole&&(Ht=s.cP(s.bz(),Ht,[1,-1,1]),Lt(X,nt))}}}})(g,_,w,T,C);else{const R=g.context,D=R.gl;let z,k;const F=g.shadowRenderer,q=ka(g,g.longestCutoffRange),$=_e=>{if(k===_e)return;const be=[];be.push(Px[_e]),q.shouldRenderCutoff&&be.push("RENDER_CUTOFF"),F&&(be.push("RENDER_SHADOWS","DEPTH_TEXTURE"),F.useNormalOffset&&be.push("NORMAL_OFFSET")),z=g.getOrCreateProgram("terrainRaster",{defines:be}),k=_e},X=g.colorModeForRenderPass(),Z=new Ft(D.LEQUAL,Ft.ReadWrite,g.depthRangeFor3D);Ec.update(C);const ne=g.transform,ae=wu(ne.zoom,_.exaggeration(),_.sourceCache._source.tileSize);let de=[0,0,0];if(F){const _e=g.style.directionalLight,be=g.style.ambientLight;_e&&be&&(de=bc(g.style,_e,be))}{k=-1;const _e=D.TRIANGLES,[be,Te]=[_.gridIndexBuffer,_.gridSegments];for(const ye of T){const xe=w.getTile(ye),ve=pi.disabled,Oe=_.prevTerrainTileForTile[ye.key],Pe=_.terrainTileForTile[ye.key];ng(Oe,Pe)&&Ec.newMorphing(ye.key,Oe,Pe,C,250),R.activeTexture.set(D.TEXTURE0),xe.texture&&xe.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE);const Ye=Ec.getMorphValuesForProxy(ye.key),Ue=Ye?1:0;let Qe;Ye&&(Qe={morphing:{srcDemTile:Ye.from,dstDemTile:Ye.to,phase:s.dx(Ye.phase)}});const _t=ig(ye.projMatrix,uh(ye.canonical,ne.renderWorldCopies)?ae/10:ae,de);if($(Ue),!z)continue;_.setupElevationDraw(xe,z,Qe);const Fe=ye.toUnwrapped();F&&F.setupShadows(Fe,z),g.uploadCommonUniforms(R,z,Fe,null,q),z.draw(g,_e,Z,ve,X,ai.backCCW,_t,"terrain_raster",_.gridBuffer,be,Te)}}}}(a,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const a=this.painter,h=this.painter.context,g=this.proxySourceCache,_=this.proxiedCoords[g.id],w=this._drapedRenderBatches.shift(),T=a.style.order,C=[];let R=0;for(const D of _){const z=g.getTileByID(D.proxyTileKey),k=g.proxyCachedFBO[D.key]?g.proxyCachedFBO[D.key][t]:void 0,F=k!==void 0?g.renderCache[k]:this.pool[R++],q=k!==void 0;if(z.texture=F.tex,q&&!F.dirty){C.push(z.tileID);continue}let $;h.bindFramebuffer.set(F.fb.framebuffer),this.renderedToTile=!1,F.dirty&&(h.clear({color:s.am.transparent,stencil:0}),F.dirty=!1);for(let X=w.start;X<=w.end;++X){const Z=a.style._mergedLayers[T[X]];if(Z.isHidden(a.transform.zoom))continue;const ne=a.style.getLayerSourceCache(Z),ae=ne?this.proxyToSource[D.key][ne.id]:[D];if(!ae)continue;const de=ae;h.viewport.set([0,0,F.fb.width,F.fb.height]),$!==(ne?ne.id:null)&&(this._setupStencil(F,ae,Z,ne),$=ne?ne.id:null),a.renderLayer(a,ne,Z,de)}if(this._drapedRenderBatches.length===0)for(const X of this._pendingGroundEffectLayers){const Z=a.style._mergedLayers[T[X]];if(Z.isHidden(a.transform.zoom))continue;const ne=a.style.getLayerSourceCache(Z),ae=ne?this.proxyToSource[D.key][ne.id]:[D];if(!ae)continue;const de=ae;h.viewport.set([0,0,F.fb.width,F.fb.height]),$!==(ne?ne.id:null)&&(this._setupStencil(F,ae,Z,ne),$=ne?ne.id:null),a.renderLayer(a,ne,Z,de)}this.renderedToTile?(F.dirty=!0,C.push(z.tileID)):q||--R,R===5&&(R=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,h.bindFramebuffer.set(null),h.viewport.set([0,0,a.width,a.height]),w.end+1}postRender(){}isLayerOrderingCorrect(t){const a=t.order.length;let h=-1,g=a;for(let _=0;_<a;++_)this._style.isLayerDraped(t._mergedLayers[t.order[_]])?h=Math.max(h,_):g=Math.min(g,_);return g>h}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{t=Math.min(t,a.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,a,h){if(!this._visibleDemTiles)return null;const g=this._visibleDemTiles.filter(_=>_.dem).map(_=>{const w=_.tileID,T=1<<w.overscaledZ,{x:C,y:R}=w.canonical,D=C/T,z=(C+1)/T,k=R/T,F=(R+1)/T;return{minx:D,miny:k,maxx:z,maxy:F,t:_.dem.tree.raycastRoot(D,k,z,F,t,a,h),tile:_}});g.sort((_,w)=>(_.t!==null?_.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE));for(const _ of g){if(_.t==null)return null;const w=_.tile.dem.tree.raycast(_.minx,_.miny,_.maxx,_.maxy,t,a,h);if(w!=null)return w}return null}_createFBO(){const t=this.painter.context,a=t.gl,h=this.drapeBufferSize;t.activeTexture.set(a.TEXTURE0);const g=new s.T(t,{width:h[0],height:h[1],data:null},a.RGBA8);g.bind(a.LINEAR,a.CLAMP_TO_EDGE);const _=t.createFramebuffer(h[0],h[1],!0,null);return _.colorAttachment.set(g.texture),_.depthAttachment=new tg(t,_.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,h[0],h[1]),this._stencilRef=0,_.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):_.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:_,tex:g,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const a=this._style._mergedLayers[t],h=a.isHidden(this.painter.transform.zoom);return a.type==="hillshade"||a.type==="custom"?!h&&a.shouldRedrape():!h&&a.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const h of this._style.getSources())if(h instanceof jd){t=!0;break}if(!t)return;const a={};for(let h=0;h<this._style.order.length;++h){const g=this._style._mergedLayers[this._style.order[h]],_=this._style.getLayerSourceCache(g);if(_&&!a[_.id]&&!g.isHidden(this.painter.transform.zoom)&&g.type==="line"&&g.widthExpression()instanceof s.ab){a[_.id]=!0;for(const w of this.proxyCoords){const T=this.proxyToSource[w.key][_.id];if(T)for(const C of T)this._clearRenderCacheForTile(_.id,C)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const h in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[h]._source instanceof gs){t=!0;break}if(!t)return;const a={};for(let h=0;h<this._style.order.length;++h){const g=this._style._mergedLayers[this._style.order[h]],_=this._style.getLayerSourceCache(g);if(!_||a[_.id]||g.isHidden(this.painter.transform.zoom)||g.type!=="raster")continue;const w=g.paint.get("raster-fade-duration");for(const T of this.proxyCoords){const C=this.proxyToSource[T.key][_.id];if(C)for(const R of C){const D=ao(_.getTile(R),_.findLoadedParent(R,0),_,this.painter.transform,w);(D.opacity!==1||D.mix!==0)&&this._clearRenderCacheForTile(_.id,R)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,a=t.length;if(a===0)return;const h=[];this._pendingGroundEffectLayers=[];let g,_=0,w=this._style._mergedLayers[t[_]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++_<a;)w=this._style._mergedLayers[t[_]];for(;_<a;++_){const T=this._style._mergedLayers[t[_]];T.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(T)?g===void 0&&(g=_):(T.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(_),g!==void 0&&(h.push({start:g,end:_-1}),g=void 0)))}if(g!==void 0&&h.push({start:g,end:_-1}),h.length!==0){const T=h[h.length-1];this._pendingGroundEffectLayers.every(C=>C>T.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=h}_setupRenderCache(t){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const w=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let T=0;T<w.length;++T){const C=Object.values(w[T]);a.renderCachePool.push(...C)}}return}this._clearRasterLayersFromRenderCache();const h=this.proxyCoords,g=this._tilesDirty;for(let w=h.length-1;w>=0;w--){const T=h[w];if(a.getTileByID(T.key),a.proxyCachedFBO[T.key]!==void 0){const C=t[T.key],R=this.proxyToSource[T.key];let D=0;for(const z in R){const k=R[z],F=C[z];if(!F||F.length!==k.length||k.some((q,$)=>q!==F[$]||g[z]&&g[z].hasOwnProperty(q.key))){D=-1;break}++D}for(const z in a.proxyCachedFBO[T.key])a.renderCache[a.proxyCachedFBO[T.key][z]].dirty=D<0||D!==Object.values(C).length}}const _=[...this._drapedRenderBatches];_.sort((w,T)=>T.end-T.start-(w.end-w.start));for(const w of _)for(const T of h){if(a.proxyCachedFBO[T.key])continue;let C=a.renderCachePool.pop();C===void 0&&a.renderCache.length<50&&(C=a.renderCache.length,a.renderCache.push(this._createFBO())),C!==void 0&&(a.proxyCachedFBO[T.key]={},a.proxyCachedFBO[T.key][w.start]=C,a.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(t,a,h,g){if(!g||!this._sourceTilesOverlap[g.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const _=this.painter.context,w=_.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let T;if(h.isTileClipped())T=a.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);T=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+T>255&&(_.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=T,this._overlapStencilMode.ref=this._stencilRef,h.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):pi.disabled}_renderTileClippingMasks(t,a){const h=this.painter,g=this.painter.context,_=g.gl;h._tileClippingMaskIDs={},g.setColorMode(Ni.disabled),g.setDepthMode(Ft.disabled);const w=h.getOrCreateProgram("clippingMask");for(const T of t){const C=h._tileClippingMaskIDs[T.key]=--a;w.draw(h,_.TRIANGLES,Ft.disabled,new pi({func:_.ALWAYS,mask:0},C,255,_.KEEP,_.KEEP,_.REPLACE),Ni.disabled,ai.disabled,Nf(T.projMatrix),"$clipping",h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}pointCoordinate(t){const a=this.painter.transform;if(t.x<0||t.x>a.width||t.y<0||t.y>a.height)return null;const h=[t.x,t.y,1,1];s.aA(h,h,a.pixelMatrixInverse),s.cH(h,h,1/h[3]),h[0]/=a.worldSize,h[1]/=a.worldSize;const g=a._camera.position,_=s.cb(1,a.center.lat),w=[g[0],g[1],g[2]/_,0],T=s.d7([],h.slice(0,3),w);s.au(T,T);const C=this.raycast(w,T,this._exaggeration);return C!==null&&C?(s.bE(w,w,T,C),w[3]=w[2],w[2]*=_,w):null}_setupProxiedCoordsForOrtho(t,a,h){if(t.getSource()instanceof s.aP)return this._setupProxiedCoordsForImageSource(t,a,h);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const g=this.proxiedCoords[t.id]=[],_=this.proxyCoords;for(let C=0;C<_.length;C++){const R=_[C],D=this._findTileCoveringTileID(R,t);if(D){const z=this._createProxiedId(R,D,h[R.key]&&h[R.key][t.id]);g.push(z),this.proxyToSource[R.key][t.id]=[z]}}let w=!1;const T=new Set;for(let C=0;C<a.length;C++){const R=t.getTile(a[C]);if(!R||!R.hasData())continue;const D=this._findTileCoveringTileID(R.tileID,this.proxySourceCache);if(D&&D.tileID.canonical.z!==R.tileID.canonical.z){const z=this.proxyToSource[D.tileID.key][t.id],k=this._createProxiedId(D.tileID,R,h[D.tileID.key]&&h[D.tileID.key][t.id]);z?z.splice(z.length-1,0,k):this.proxyToSource[D.tileID.key][t.id]=[k];const F=this.proxyToSource[D.tileID.key][t.id];T.has(F)||T.add(F),g.push(k),w=!0}}if(this._sourceTilesOverlap[t.id]=w,w&&this._debugParams.sortTilesHiZFirst)for(const C of T)C.sort((R,D)=>D.overscaledZ-R.overscaledZ)}_setupProxiedCoordsForImageSource(t,a,h){if(!t.getSource().loaded())return;const g=this.proxiedCoords[t.id]=[],_=this.proxyCoords,w=t.getSource(),T=w.tileID;if(!T)return;const C=new s.P(T.x,T.y)._div(1<<T.z),R=w.coordinates.map(s.ac.fromLngLat).reduce((z,k)=>(z.min.x=Math.min(z.min.x,k.x-C.x),z.min.y=Math.min(z.min.y,k.y-C.y),z.max.x=Math.max(z.max.x,k.x-C.x),z.max.y=Math.max(z.max.y,k.y-C.y),z),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),D=(z,k)=>{const F=z.wrap+z.canonical.x/(1<<z.canonical.z),q=z.canonical.y/(1<<z.canonical.z),$=s.aj/(1<<z.canonical.z),X=k.wrap+k.canonical.x/(1<<k.canonical.z),Z=k.canonical.y/(1<<k.canonical.z);return F+$<X+R.min.x||F>X+R.max.x||q+$<Z+R.min.y||q>Z+R.max.y};for(let z=0;z<_.length;z++){const k=_[z];for(let F=0;F<a.length;F++){const q=t.getTile(a[F]);if(!q||!q.hasData()||D(k,q.tileID))continue;const $=this._createProxiedId(k,q,h[k.key]&&h[k.key][t.id]),X=this.proxyToSource[k.key][t.id];X?X.push($):this.proxyToSource[k.key][t.id]=[$],g.push($)}}}_createProxiedId(t,a,h){let g=this.orthoMatrix;if(h){const _=h.find(w=>w.key===a.tileID.key);if(_)return _}if(a.tileID.key!==t.key){const _=t.canonical.z-a.tileID.canonical.z;let w,T,C;g=s.bz();const R=a.tileID.wrap-t.wrap<<t.overscaledZ;_>0?(w=s.aj>>_,T=w*((a.tileID.canonical.x<<_)-t.canonical.x+R),C=w*((a.tileID.canonical.y<<_)-t.canonical.y)):(w=s.aj<<-_,T=s.aj*(a.tileID.canonical.x-(t.canonical.x+R<<-_)),C=s.aj*(a.tileID.canonical.y-(t.canonical.y<<-_))),s.ca(g,0,w,0,w,0,1),s.bo(g,g,[T,C,0])}return new dh(a.tileID,t.key,g)}_findTileCoveringTileID(t,a){let h=a.getTile(t);if(h&&h.hasData())return h;const g=this._findCoveringTileCache[a.id],_=g[t.key];if(h=_?a.getTileByID(_):null,h&&h.hasData()||_===null)return h;let w=h?h.tileID:t,T=w.overscaledZ;const C=a.getSource().minzoom,R=[];if(!_){const z=a.getSource().maxzoom;if(t.canonical.z>=z){const k=t.canonical.z-z;a.getSource().reparseOverscaled?(T=Math.max(t.canonical.z+2,a.transform.tileZoom),w=new s.aM(T,t.wrap,z,t.canonical.x>>k,t.canonical.y>>k)):k!==0&&(T=z,w=new s.aM(T,t.wrap,z,t.canonical.x>>k,t.canonical.y>>k))}w.key!==t.key&&(R.push(w.key),h=a.getTile(w))}const D=z=>{R.forEach(k=>{g[k]=z}),R.length=0};for(T-=1;T>=C&&(!h||!h.hasData());T--){h&&D(h.tileID.key);const z=w.calculateScaledKey(T);if(h=a.getTileByID(z),h&&h.hasData())break;const k=g[z];if(k===null)break;k===void 0?R.push(z):h=a.getTileByID(k)}return D(h?h.tileID.key:null),h&&h.hasData()?h:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,a){let h=this._tilesDirty[t];h||(h=this._tilesDirty[t]={}),h[a.key]=!0}}function sg(d,t,a){const h=function(T,C,R){const D=s.bG(C,T),z=s.bG(R,[.2126,.7152,.0722]),k=(q,$,X)=>(1-X)*q+X*$,F=k(1-.3*Math.min(z,1),1,Math.min(D+1,1));return k(.92,1,Math.asin(s.ay(C[2],-1,1))/Math.PI+.5)*F}(d,[0,0,1],t),g=[0,0,0];s.c1(g,a.slice(0,3),h);const _=[0,0,0];s.c1(_,t.slice(0,3),d[2]);const w=[0,0,0];return s.d5(w,g,_),s.d8(w)}const og=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Of=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Ff{static cacheKey(t,a,h,g){let _=`${a}${g?g.cacheKey:""}`;for(const w of h)t.usedDefines.includes(w)&&(_+=`/${w}`);return _}constructor(t,a,h,g,_,w){const T=t.gl;this.program=T.createProgram(),this.configuration=g,this.name=a,this.fixedDefines=[...w];const C=g?g.getBinderAttributes():[],R=(h.staticAttributes||[]).concat(C);let D=g?g.defines():[];D=D.concat(w.map(X=>`#define ${X}`));const z=`#version 300 es
`;let k=z+D.concat("precision mediump float;",Ol,Ef.fragmentSource).join(`
`);for(const X of h.fragmentIncludes)k+=`
${Sc[X]}`;k+=`
${h.fragmentSource}`;let F=z+D.concat("precision highp float;",Ol,Ef.vertexSource).join(`
`);for(const X of h.vertexIncludes)F+=`
${Sc[X]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&h.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(F+=`
uniform int u_instanceID;
`),F+=`
${h.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(F=F.replaceAll("gl_InstanceID","u_instanceID"));const q=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);T.shaderSource(q,k),T.compileShader(q),T.attachShader(this.program,q);const $=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource($,F),T.compileShader($),T.attachShader(this.program,$),this.attributes={},this.numAttributes=R.length;for(let X=0;X<this.numAttributes;X++)if(R[X]){const Z=R[X].startsWith("a_")?R[X]:`a_${R[X]}`;T.bindAttribLocation(this.program,X,Z),this.attributes[Z]=X}T.linkProgram(this.program),T.deleteShader($),T.deleteShader(q),this.fixedUniforms=_(t),this.binderUniforms=g?g.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(X=>({u_instanceID:new s.cd(X)}))(t)),(w.includes("TERRAIN")||a.indexOf("symbol")!==-1||a.indexOf("circle")!==-1)&&(this.terrainUniforms=(X=>({u_dem:new s.cd(X),u_dem_prev:new s.cd(X),u_dem_tl:new s.cg(X),u_dem_scale:new s.cf(X),u_dem_tl_prev:new s.cg(X),u_dem_scale_prev:new s.cf(X),u_dem_size:new s.cf(X),u_dem_lerp:new s.cf(X),u_exaggeration:new s.cf(X),u_depth:new s.cd(X),u_depth_size_inv:new s.cg(X),u_depth_range_unpack:new s.cg(X),u_occluder_half_size:new s.cf(X),u_occlusion_depth_offset:new s.cf(X),u_meter_to_dem:new s.cf(X),u_label_plane_matrix_inv:new s.ch(X)}))(t)),w.includes("GLOBE")&&(this.globeUniforms=(X=>({u_tile_tl_up:new s.ce(X),u_tile_tr_up:new s.ce(X),u_tile_br_up:new s.ce(X),u_tile_bl_up:new s.ce(X),u_tile_up_scale:new s.cf(X)}))(t)),w.includes("FOG")&&(this.fogUniforms=(X=>({u_fog_matrix:new s.ch(X),u_fog_range:new s.cg(X),u_fog_color:new s.d0(X),u_fog_horizon_blend:new s.cf(X),u_fog_vertical_limit:new s.cg(X),u_fog_temporal_offset:new s.cf(X),u_frustum_tl:new s.ce(X),u_frustum_tr:new s.ce(X),u_frustum_br:new s.ce(X),u_frustum_bl:new s.ce(X),u_globe_pos:new s.ce(X),u_globe_radius:new s.cf(X),u_globe_transition:new s.cf(X),u_is_globe:new s.cd(X),u_viewport:new s.cg(X)}))(t)),w.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(X=>({u_cutoff_params:new s.d0(X)}))(t)),w.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(X=>({u_lighting_ambient_color:new s.ce(X),u_lighting_directional_dir:new s.ce(X),u_lighting_directional_color:new s.ce(X),u_ground_radiance:new s.ce(X)}))(t)),w.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(X=>({u_light_matrix_0:new s.ch(X),u_light_matrix_1:new s.ch(X),u_fade_range:new s.cg(X),u_shadow_normal_offset:new s.ce(X),u_shadow_intensity:new s.cf(X),u_shadow_texel_size:new s.cf(X),u_shadow_map_resolution:new s.cf(X),u_shadow_direction:new s.ce(X),u_shadow_bias:new s.ce(X),u_shadowmap_0:new s.cd(X),u_shadowmap_1:new s.cd(X)}))(t))}}setTerrainUniformValues(t,a){if(!this.terrainUniforms)return;const h=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in a)h[g]&&h[g].set(this.program,g,a[g])}}setGlobeUniformValues(t,a){if(!this.globeUniforms)return;const h=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in a)h[g]&&h[g].set(this.program,g,a[g])}}setFogUniformValues(t,a){if(!this.fogUniforms)return;const h=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in a)h[g].set(this.program,g,a[g])}}setCutoffUniformValues(t,a){if(!this.cutoffUniforms)return;const h=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in a)h[g].set(this.program,g,a[g])}}setLightsUniformValues(t,a){if(!this.lightsUniforms)return;const h=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in a)h[g].set(this.program,g,a[g])}}setShadowUniformValues(t,a){if(this.failedToCreate||!this.shadowUniforms)return;const h=this.shadowUniforms;t.program.set(this.program);for(const g in a)h[g].set(this.program,g,a[g])}_drawDebugWireframe(t,a,h,g,_,w,T,C,R,D){const z=t.options.wireframe;if(z.terrain===!1&&z.layers2D===!1&&z.layers3D===!1)return;const k=t.context;if(!(!(!z.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!z.layers2D||t._terrain&&t._terrain.renderingToTexture||!og.includes(this.name))||!(!z.layers3D||!Of.includes(this.name))))return;const F=k.gl,q=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,_,k);if(!q)return;const $=[...this.fixedDefines];$.push("DEBUG_WIREFRAME");const X=t.getOrCreateProgram(this.name,{config:this.configuration,defines:$});k.program.set(X.program);const Z=(de,_e,be)=>{if(_e[de]&&be[de])for(const Te in _e[de])be[de][Te]&&be[de][Te].set(be.program,Te,_e[de][Te].current)};R&&R.setUniforms(X.program,k,X.binderUniforms,T,{zoom:C}),Z("fixedUniforms",this,X),Z("terrainUniforms",this,X),Z("globeUniforms",this,X),Z("fogUniforms",this,X),Z("lightsUniforms",this,X),Z("shadowUniforms",this,X),q.bind(),k.setColorMode(new Ni([F.ONE,F.ONE_MINUS_SRC_ALPHA,F.ZERO,F.ONE],s.am.transparent,[!0,!0,!0,!1])),k.setDepthMode(new Ft(a.func===F.LESS?F.LEQUAL:a.func,Ft.ReadOnly,a.range)),k.setStencilMode(pi.disabled);const ne=3*w.primitiveLength*2,ae=3*w.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const de=D||1;for(let _e=0;_e<de;++_e)X.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",_e),F.drawElements(F.LINES,ne,F.UNSIGNED_SHORT,ae)}else D&&D>1?F.drawElementsInstanced(F.LINES,ne,F.UNSIGNED_SHORT,ae,D):F.drawElements(F.LINES,ne,F.UNSIGNED_SHORT,ae);_.bind(),k.program.set(this.program),k.setDepthMode(a),k.setStencilMode(h),k.setColorMode(g)}checkUniforms(t,a,h){if(this.fixedDefines.includes(a)){for(const g of Object.keys(h))if(!h[g].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${g} not set but required by ${a} being defined`)}}draw(t,a,h,g,_,w,T,C,R,D,z,k,F,q,$,X){const Z=t.context,ne=Z.gl;if(this.failedToCreate)return;Z.program.set(this.program),Z.setDepthMode(h),Z.setStencilMode(g),Z.setColorMode(_),Z.setCullFace(w);for(const _e of Object.keys(this.fixedUniforms))this.fixedUniforms[_e].set(this.program,_e,T[_e]);q&&q.setUniforms(this.program,Z,this.binderUniforms,k,{zoom:F});const ae={[ne.POINTS]:1,[ne.LINES]:2,[ne.TRIANGLES]:3,[ne.LINE_STRIP]:1}[a];this.checkUniforms(C,"RENDER_SHADOWS",this.shadowUniforms);const de=X&&X>0?1:void 0;for(const _e of z.get()){const be=_e.vaos||(_e.vaos={});if((be[C]||(be[C]=new Zw)).bind(Z,this,R,q?q.getPaintVertexBuffers():[],D,_e.vertexOffset,$||[],de),this.forceManualRenderingForInstanceIDShaders){const Te=X||1;for(let ye=0;ye<Te;++ye)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ye),D?ne.drawElements(a,_e.primitiveLength*ae,ne.UNSIGNED_SHORT,_e.primitiveOffset*ae*2):ne.drawArrays(a,_e.vertexOffset,_e.vertexLength)}else X&&X>1?ne.drawElementsInstanced(a,_e.primitiveLength*ae,ne.UNSIGNED_SHORT,_e.primitiveOffset*ae*2,X):D?ne.drawElements(a,_e.primitiveLength*ae,ne.UNSIGNED_SHORT,_e.primitiveOffset*ae*2):ne.drawArrays(a,_e.vertexOffset,_e.vertexLength);a===ne.TRIANGLES&&D&&this._drawDebugWireframe(t,h,g,_,D,_e,k,F,q,X)}}}function jf(d,t,a=0){const h=Math.pow(2,t.tileID.overscaledZ),g=t.tileSize*Math.pow(2,d.transform.tileZoom)/h,_=g*(t.tileID.canonical.x+t.tileID.wrap*h),w=g*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.aw(t,1,d.transform.tileZoom),u_pixel_coord_upper:[_>>16,w>>16],u_pixel_coord_lower:[65535&_,65535&w],u_pattern_transition:a}}const Cc={terrain:0,flat:1},ag=s.bz(),lg=(d,t,a,h,g,_,w,T,C,R,D,z,k,F,q,$,X,Z)=>{const ne=t.style.light,ae=ne.properties.get("position"),de=[ae.x,ae.y,ae.z],_e=s.dJ();ne.properties.get("anchor")==="viewport"&&(s.dK(_e,-t.transform.angle),s.dL(de,de,_e));const be=ne.properties.get("color").toPremultipliedRenderColor(null),Te=t.transform,ye={u_matrix:d,u_lightpos:de,u_lightintensity:ne.properties.get("intensity"),u_lightcolor:[be.r,be.g,be.b],u_vertical_gradient:+a,u_opacity:h,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ag,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Cc[R],u_base_type:Cc[D],u_ao:g,u_edge_radius:_,u_width_scale:w,u_flood_light_color:q,u_vertical_scale:$,u_flood_light_intensity:X,u_ground_shadow_factor:Z};return Te.projection.name==="globe"&&(ye.u_tile_id=[T.canonical.x,T.canonical.y,1<<T.canonical.z],ye.u_zoom_transition=z,ye.u_inv_rot_matrix=F,ye.u_merc_center=k,ye.u_up_dir=Te.projection.upVector(new s.cA(0,0,0),k[0]*s.aj,k[1]*s.aj),ye.u_height_lift=C),ye},Mx=(d,t,a,h,g,_)=>({u_matrix:d,u_edge_radius:t,u_width_scale:a,u_vertical_scale:h,u_height_type:Cc[g],u_base_type:Cc[_]}),bu=(d,t,a,h,g,_,w,T,C,R,D,z,k,F,q,$,X,Z)=>{const ne=lg(d,t,a,h,g,_,w,T,R,D,z,k,F,q,$,X,1,[0,0,0]),ae={u_height_factor:-Math.pow(2,T.overscaledZ)/C.tileSize/8};return s.h(ne,jf(t,C,Z),ae)},Rx=(d,t,a)=>({u_matrix:d,u_emissive_strength:t,u_ground_shadow_factor:a}),Dx=(d,t,a,h,g,_=0)=>s.h(Rx(d,t,g),jf(a,h,_)),nb=(d,t,a,h)=>({u_matrix:d,u_world:a,u_emissive_strength:t,u_ground_shadow_factor:h}),rb=(d,t,a,h,g,_,w=0)=>s.h(Dx(d,t,a,h,_,w),{u_world:g}),sb=(d,t)=>({u_matrix:d,u_ground_shadow_factor:t}),Bf=(d,t,a,h,g)=>({u_matrix:d,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:a,u_height_scale:h,u_reset_depth:g}),cg=(d,t)=>({u_matrix:d,u_normal_matrix:t,u_opacity:1}),ug=d=>({u_matrix:d}),kx=d=>({u_matrix:d}),Su=(d,t,a,h,g,_,w,T)=>{const C=s.aj/_.tileSize;return{u_matrix:d,u_inv_rot_matrix:t,u_camera_to_center_distance:a.getCameraToCenterDistance(T),u_extrude_scale:[a.pixelsToGLUnits[0]/C,a.pixelsToGLUnits[1]/C],u_zoom_transition:h,u_tile_id:w,u_merc_center:g}},dg=(d,t,a=1)=>({u_matrix:d,u_color:t,u_overlay:0,u_overlay_scale:a}),Nx=s.bz(),Lx=(d,t,a,h,g,_,w)=>{const T=d.transform,C=T.projection.name==="globe",R=C?s.dM(T.zoom,t.canonical)*T._pixelsPerMercatorPixel:s.aw(a,1,_),D={u_matrix:t.projMatrix,u_extrude_scale:R,u_intensity:w,u_inv_rot_matrix:Nx,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){D.u_inv_rot_matrix=h,D.u_merc_center=g,D.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],D.u_zoom_transition=s.ah(T.zoom);const z=g[0]*s.aj,k=g[1]*s.aj;D.u_up_dir=T.projection.upVector(new s.cA(0,0,0),z,k)}return D};function Vf(d,[t,a,h,g],[_,w]){if(_===w)return[0,0,0,0];const T=255*(d-1)/(d*(w-_));return[t*T,a*T,h*T,g*T]}function Fl(d,t,[a,h]){return a===h?0:.5/d+(t-a)*(d-1)/(d*(h-a))}const hg=(d,t,a,h,g,_,w,T,C,R,D,z,k,F,q,$,X,Z,ne,ae,de)=>({u_matrix:d,u_normalize_matrix:t,u_globe_matrix:a,u_merc_matrix:h,u_grid_matrix:g,u_tl_parent:_,u_scale_parent:R,u_fade_t:D.mix,u_opacity:D.opacity*z.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:z.paint.get("raster-brightness-min"),u_brightness_high:z.paint.get("raster-brightness-max"),u_saturation_factor:s.dO(z.paint.get("raster-saturation")),u_contrast_factor:s.dN(z.paint.get("raster-contrast")),u_spin_weights:jl(z.paint.get("raster-hue-rotate")),u_perspective_transform:k,u_raster_elevation:F,u_zoom_transition:w,u_merc_center:T,u_cutoff_params:C,u_colorization_mix:Vf(s.dP,$,Z),u_colorization_offset:Fl(s.dP,X,Z),u_color_ramp:q,u_texture_offset:[ae/(ne+2*ae),ne/(ne+2*ae)],u_texture_res:[ne+2*ae,ne+2*ae],u_emissive_strength:de});function jl(d){d*=Math.PI/180;const t=Math.sin(d),a=Math.cos(d);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const Bl=.05,Uf=(d,t,a,h,g,_,w,T,C,R,D,z)=>({u_matrix:d,u_normalize_matrix:t,u_globe_matrix:a,u_merc_matrix:h,u_grid_matrix:g,u_tl_parent:_,u_scale_parent:R,u_fade_t:D.mix,u_opacity:D.opacity,u_image0:0,u_image1:1,u_raster_elevation:z,u_zoom_transition:w,u_merc_center:T,u_cutoff_params:C}),zx=(d,t,a,h,g,_,w,T,C,R)=>({u_particle_texture:d,u_particle_texture_side_len:t,u_tile_offset:a,u_velocity:h,u_color_ramp:_,u_velocity_res:g,u_max_speed:w,u_uv_offset:T,u_data_scale:[255*C[0],255*C[1]],u_data_offset:R,u_particle_pos_scale:1.1,u_particle_pos_offset:[Bl,Bl]}),Ox=(d,t,a,h,g,_,w,T,C,R)=>({u_particle_texture:d,u_particle_texture_side_len:t,u_velocity:a,u_velocity_res:h,u_max_speed:g,u_speed_factor:_,u_reset_rate:w,u_rand_seed:Math.random(),u_uv_offset:T,u_data_scale:[255*C[0],255*C[1]],u_data_offset:R,u_particle_pos_scale:1.1,u_particle_pos_offset:[Bl,Bl]}),Gf=s.bz(),$f=(d,t,a,h,g,_,w,T,C,R,D,z,k,F,q,$,X,Z,ne,ae,de,_e,be,Te)=>{const ye=g.transform,xe={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:ye.getCameraToCenterDistance(ne),u_rotate_symbol:+a,u_aspect_ratio:ye.width/ye.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:w,u_coord_matrix:T,u_is_text:+R,u_elevation_from_sea:C?1:0,u_pitch_with_map:+h,u_texsize:D,u_texsize_icon:z,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Gf,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Gf,u_up_vector:[0,-1,0],u_color_adj_mat:_e,u_icon_transition:be||0,u_gamma_scale:h?g.transform.getCameraToCenterDistance(ne)*Math.cos(g.terrain?0:g.transform._pitch):1,u_device_pixel_ratio:s.q.devicePixelRatio,u_is_halo:1,u_scale_factor:Te||1,u_ground_shadow_factor:ae,u_inv_matrix:s.bi(s.bz(),w),u_normal_scale:de};return ne.name==="globe"&&(xe.u_tile_id=[F.canonical.x,F.canonical.y,1<<F.canonical.z],xe.u_zoom_transition=q,xe.u_inv_rot_matrix=X,xe.u_merc_center=$,xe.u_camera_forward=ye._camera.forward(),xe.u_ecef_origin=s.dQ(ye.globeMatrix,F.toUnwrapped()),xe.u_tile_matrix=Float32Array.from(ye.globeMatrix),xe.u_up_vector=Z),xe},Fx=(d,t,a,h)=>({u_matrix:d,u_emissive_strength:t,u_opacity:a,u_color:h}),fg=(d,t,a,h,g,_,w,T,C)=>s.h(function(R,D,z,k,F,q){const{width:$,height:X}=k.imageManager.getPixelSize(D),Z=Math.pow(2,q.tileID.overscaledZ),ne=q.tileSize*Math.pow(2,k.transform.tileZoom)/Z,ae=ne*(q.tileID.canonical.x+q.tileID.wrap*Z),de=ne*q.tileID.canonical.y;return{u_image:0,u_pattern_tl:z.tl,u_pattern_br:z.br,u_texsize:[$,X],u_pattern_size:z.displaySize,u_pattern_units_to_pixels:F?[k.transform.width,-1*k.transform.height]:[1/s.aw(q,1,k.transform.tileZoom),1/s.aw(q,1,k.transform.tileZoom)],u_pixel_coord_upper:[ae>>16,de>>16],u_pixel_coord_lower:[65535&ae,65535&de]}}(0,_,w,h,T,C),{u_matrix:d,u_emissive_strength:t,u_opacity:a}),Ac=new Float32Array(s.bx([])),pg=(d,t,a,h,g,_,w,T,C,R,D,z,k,F=[0,0,0],q)=>{const $=g.style.light,X=$.properties.get("position"),Z=[-X.x,-X.y,X.z],ne=s.dJ();$.properties.get("anchor")==="viewport"&&(s.dK(ne,-g.transform.angle),s.dL(Z,Z,ne));const ae=D.alphaMode==="MASK",de=$.properties.get("color").toNonPremultipliedRenderColor(null),_e=k.paint.get("model-ambient-occlusion-intensity"),be=k.paint.get("model-color").constantOr(s.am.white).toNonPremultipliedRenderColor(null);return be.a=k.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:d,u_lighting_matrix:t,u_normal_matrix:a,u_node_matrix:h||Ac,u_lightpos:Z,u_lightintensity:$.properties.get("intensity"),u_lightcolor:[de.r,de.g,de.b],u_camera_pos:F,u_opacity:_,u_baseTextureIsAlpha:0,u_alphaMask:+ae,u_alphaCutoff:D.alphaCutoff,u_baseColorFactor:w.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:T.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:C,u_roughnessFactor:R,u_baseColorTexture:qs.BaseColor,u_metallicRoughnessTexture:qs.MetallicRoughness,u_normalTexture:qs.Normal,u_occlusionTexture:qs.Occlusion,u_emissionTexture:qs.Emission,u_lutTexture:qs.LUT,u_color_mix:be.toArray01(),u_aoIntensity:_e,u_emissive_strength:z,u_occlusionTextureTransform:q||[0,0,0,0]}},jx=(d,t=Ac,a=Ac)=>({u_matrix:d,u_instance:t,u_node_matrix:a}),Bx={fillExtrusion:d=>({u_matrix:new s.ch(d),u_lightpos:new s.ce(d),u_lightintensity:new s.cf(d),u_lightcolor:new s.ce(d),u_vertical_gradient:new s.cf(d),u_opacity:new s.cf(d),u_edge_radius:new s.cf(d),u_width_scale:new s.cf(d),u_ao:new s.cg(d),u_height_type:new s.cd(d),u_base_type:new s.cd(d),u_tile_id:new s.ce(d),u_zoom_transition:new s.cf(d),u_inv_rot_matrix:new s.ch(d),u_merc_center:new s.cg(d),u_up_dir:new s.ce(d),u_height_lift:new s.cf(d),u_flood_light_color:new s.ce(d),u_vertical_scale:new s.cf(d),u_flood_light_intensity:new s.cf(d),u_ground_shadow_factor:new s.ce(d)}),fillExtrusionDepth:d=>({u_matrix:new s.ch(d),u_edge_radius:new s.cf(d),u_width_scale:new s.cf(d),u_vertical_scale:new s.cf(d),u_height_type:new s.cd(d),u_base_type:new s.cd(d)}),fillExtrusionPattern:d=>({u_matrix:new s.ch(d),u_lightpos:new s.ce(d),u_lightintensity:new s.cf(d),u_lightcolor:new s.ce(d),u_vertical_gradient:new s.cf(d),u_height_factor:new s.cf(d),u_edge_radius:new s.cf(d),u_width_scale:new s.cf(d),u_ao:new s.cg(d),u_height_type:new s.cd(d),u_base_type:new s.cd(d),u_tile_id:new s.ce(d),u_zoom_transition:new s.cf(d),u_inv_rot_matrix:new s.ch(d),u_merc_center:new s.cg(d),u_up_dir:new s.ce(d),u_height_lift:new s.cf(d),u_image:new s.cd(d),u_texsize:new s.cg(d),u_pixel_coord_upper:new s.cg(d),u_pixel_coord_lower:new s.cg(d),u_tile_units_to_pixels:new s.cf(d),u_opacity:new s.cf(d),u_pattern_transition:new s.cf(d)}),fillExtrusionGroundEffect:d=>({u_matrix:new s.ch(d),u_opacity:new s.cf(d),u_ao_pass:new s.cf(d),u_meter_to_tile:new s.cf(d),u_ao:new s.cg(d),u_flood_light_intensity:new s.cf(d),u_flood_light_color:new s.ce(d),u_attenuation:new s.cf(d),u_edge_radius:new s.cf(d),u_fb:new s.cd(d),u_fb_size:new s.cf(d),u_dynamic_offset:new s.cf(d)}),fill:d=>({u_matrix:new s.ch(d),u_emissive_strength:new s.cf(d),u_ground_shadow_factor:new s.ce(d)}),fillPattern:d=>({u_matrix:new s.ch(d),u_emissive_strength:new s.cf(d),u_image:new s.cd(d),u_texsize:new s.cg(d),u_pixel_coord_upper:new s.cg(d),u_pixel_coord_lower:new s.cg(d),u_tile_units_to_pixels:new s.cf(d),u_ground_shadow_factor:new s.ce(d),u_pattern_transition:new s.cf(d)}),fillOutline:d=>({u_matrix:new s.ch(d),u_emissive_strength:new s.cf(d),u_world:new s.cg(d),u_ground_shadow_factor:new s.ce(d)}),fillOutlinePattern:d=>({u_matrix:new s.ch(d),u_emissive_strength:new s.cf(d),u_world:new s.cg(d),u_image:new s.cd(d),u_texsize:new s.cg(d),u_pixel_coord_upper:new s.cg(d),u_pixel_coord_lower:new s.cg(d),u_tile_units_to_pixels:new s.cf(d),u_ground_shadow_factor:new s.ce(d),u_pattern_transition:new s.cf(d)}),building:d=>({u_matrix:new s.ch(d),u_normal_matrix:new s.ch(d),u_opacity:new s.cf(d)}),buildingBloom:d=>({u_matrix:new s.ch(d)}),buildingDepth:d=>({u_matrix:new s.ch(d)}),elevatedStructuresDepth:d=>({u_matrix:new s.ch(d),u_depth_bias:new s.cf(d)}),elevatedStructures:d=>({u_matrix:new s.ch(d),u_ground_shadow_factor:new s.ce(d)}),elevatedStructuresDepthReconstruct:d=>({u_matrix:new s.ch(d),u_camera_pos:new s.ce(d),u_depth_bias:new s.cf(d),u_height_scale:new s.cf(d),u_reset_depth:new s.cf(d)}),circle:s.dT,collisionBox:d=>({u_matrix:new s.ch(d),u_inv_rot_matrix:new s.ch(d),u_camera_to_center_distance:new s.cf(d),u_extrude_scale:new s.cg(d),u_zoom_transition:new s.cf(d),u_merc_center:new s.cg(d),u_tile_id:new s.ce(d)}),collisionCircle:d=>({u_matrix:new s.ch(d),u_inv_matrix:new s.ch(d),u_camera_to_center_distance:new s.cf(d),u_viewport_size:new s.cg(d)}),debug:d=>({u_color:new s.dv(d),u_matrix:new s.ch(d),u_overlay:new s.cd(d),u_overlay_scale:new s.cf(d)}),clippingMask:d=>({u_matrix:new s.ch(d)}),heatmap:d=>({u_extrude_scale:new s.cf(d),u_intensity:new s.cf(d),u_matrix:new s.ch(d),u_inv_rot_matrix:new s.ch(d),u_merc_center:new s.cg(d),u_tile_id:new s.ce(d),u_zoom_transition:new s.cf(d),u_up_dir:new s.ce(d)}),heatmapTexture:d=>({u_image:new s.cd(d),u_color_ramp:new s.cd(d),u_opacity:new s.cf(d)}),hillshade:d=>({u_matrix:new s.ch(d),u_image:new s.cd(d),u_latrange:new s.cg(d),u_light:new s.cg(d),u_shadow:new s.dv(d),u_highlight:new s.dv(d),u_emissive_strength:new s.cf(d),u_accent:new s.dv(d)}),hillshadePrepare:d=>({u_matrix:new s.ch(d),u_image:new s.cd(d),u_dimension:new s.cg(d),u_zoom:new s.cf(d)}),line:s.dS,linePattern:s.dR,raster:d=>({u_matrix:new s.ch(d),u_normalize_matrix:new s.ch(d),u_globe_matrix:new s.ch(d),u_merc_matrix:new s.ch(d),u_grid_matrix:new s.dw(d),u_tl_parent:new s.cg(d),u_scale_parent:new s.cf(d),u_fade_t:new s.cf(d),u_opacity:new s.cf(d),u_image0:new s.cd(d),u_image1:new s.cd(d),u_brightness_low:new s.cf(d),u_brightness_high:new s.cf(d),u_saturation_factor:new s.cf(d),u_contrast_factor:new s.cf(d),u_spin_weights:new s.ce(d),u_perspective_transform:new s.cg(d),u_raster_elevation:new s.cf(d),u_zoom_transition:new s.cf(d),u_merc_center:new s.cg(d),u_cutoff_params:new s.d0(d),u_colorization_mix:new s.d0(d),u_colorization_offset:new s.cf(d),u_color_ramp:new s.cd(d),u_texture_offset:new s.cg(d),u_texture_res:new s.cg(d),u_emissive_strength:new s.cf(d)}),rasterParticle:d=>({u_matrix:new s.ch(d),u_normalize_matrix:new s.ch(d),u_globe_matrix:new s.ch(d),u_merc_matrix:new s.ch(d),u_grid_matrix:new s.dw(d),u_tl_parent:new s.cg(d),u_scale_parent:new s.cf(d),u_fade_t:new s.cf(d),u_opacity:new s.cf(d),u_image0:new s.cd(d),u_image1:new s.cd(d),u_raster_elevation:new s.cf(d),u_zoom_transition:new s.cf(d),u_merc_center:new s.cg(d),u_cutoff_params:new s.d0(d)}),rasterParticleTexture:d=>({u_texture:new s.cd(d),u_opacity:new s.cf(d)}),rasterParticleDraw:d=>({u_particle_texture:new s.cd(d),u_particle_texture_side_len:new s.cf(d),u_tile_offset:new s.cg(d),u_velocity:new s.cd(d),u_color_ramp:new s.cd(d),u_velocity_res:new s.cg(d),u_max_speed:new s.cf(d),u_uv_offset:new s.cg(d),u_data_scale:new s.cg(d),u_data_offset:new s.cf(d),u_particle_pos_scale:new s.cf(d),u_particle_pos_offset:new s.cg(d)}),rasterParticleUpdate:d=>({u_particle_texture:new s.cd(d),u_particle_texture_side_len:new s.cf(d),u_velocity:new s.cd(d),u_velocity_res:new s.cg(d),u_max_speed:new s.cf(d),u_speed_factor:new s.cf(d),u_reset_rate:new s.cf(d),u_rand_seed:new s.cf(d),u_uv_offset:new s.cg(d),u_data_scale:new s.cg(d),u_data_offset:new s.cf(d),u_particle_pos_scale:new s.cf(d),u_particle_pos_offset:new s.cg(d)}),symbol:d=>({u_is_size_zoom_constant:new s.cd(d),u_is_size_feature_constant:new s.cd(d),u_size_t:new s.cf(d),u_size:new s.cf(d),u_camera_to_center_distance:new s.cf(d),u_rotate_symbol:new s.cd(d),u_aspect_ratio:new s.cf(d),u_fade_change:new s.cf(d),u_matrix:new s.ch(d),u_label_plane_matrix:new s.ch(d),u_coord_matrix:new s.ch(d),u_is_text:new s.cd(d),u_elevation_from_sea:new s.cd(d),u_pitch_with_map:new s.cd(d),u_texsize:new s.cg(d),u_texsize_icon:new s.cg(d),u_texture:new s.cd(d),u_texture_icon:new s.cd(d),u_gamma_scale:new s.cf(d),u_device_pixel_ratio:new s.cf(d),u_tile_id:new s.ce(d),u_zoom_transition:new s.cf(d),u_inv_rot_matrix:new s.ch(d),u_merc_center:new s.cg(d),u_camera_forward:new s.ce(d),u_tile_matrix:new s.ch(d),u_up_vector:new s.ce(d),u_ecef_origin:new s.ce(d),u_is_halo:new s.cd(d),u_icon_transition:new s.cf(d),u_color_adj_mat:new s.ch(d),u_scale_factor:new s.cf(d),u_ground_shadow_factor:new s.ce(d),u_inv_matrix:new s.ch(d),u_normal_scale:new s.cf(d)}),background:d=>({u_matrix:new s.ch(d),u_emissive_strength:new s.cf(d),u_opacity:new s.cf(d),u_color:new s.dv(d)}),backgroundPattern:d=>({u_matrix:new s.ch(d),u_emissive_strength:new s.cf(d),u_opacity:new s.cf(d),u_image:new s.cd(d),u_pattern_tl:new s.cg(d),u_pattern_br:new s.cg(d),u_texsize:new s.cg(d),u_pattern_size:new s.cg(d),u_pixel_coord_upper:new s.cg(d),u_pixel_coord_lower:new s.cg(d),u_pattern_units_to_pixels:new s.cg(d)}),terrainRaster:d=>({u_matrix:new s.ch(d),u_image0:new s.cd(d),u_skirt_height:new s.cf(d),u_ground_shadow_factor:new s.ce(d)}),skybox:d=>({u_matrix:new s.ch(d),u_sun_direction:new s.ce(d),u_cubemap:new s.cd(d),u_opacity:new s.cf(d),u_temporal_offset:new s.cf(d)}),skyboxGradient:d=>({u_matrix:new s.ch(d),u_color_ramp:new s.cd(d),u_center_direction:new s.ce(d),u_radius:new s.cf(d),u_opacity:new s.cf(d),u_temporal_offset:new s.cf(d)}),skyboxCapture:d=>({u_matrix_3f:new s.dw(d),u_sun_direction:new s.ce(d),u_sun_intensity:new s.cf(d),u_color_tint_r:new s.d0(d),u_color_tint_m:new s.d0(d),u_luminance:new s.cf(d)}),globeRaster:d=>({u_proj_matrix:new s.ch(d),u_globe_matrix:new s.ch(d),u_normalize_matrix:new s.ch(d),u_merc_matrix:new s.ch(d),u_zoom_transition:new s.cf(d),u_merc_center:new s.cg(d),u_image0:new s.cd(d),u_grid_matrix:new s.dw(d),u_skirt_height:new s.cf(d),u_far_z_cutoff:new s.cf(d),u_frustum_tl:new s.ce(d),u_frustum_tr:new s.ce(d),u_frustum_br:new s.ce(d),u_frustum_bl:new s.ce(d),u_globe_pos:new s.ce(d),u_globe_radius:new s.cf(d),u_viewport:new s.cg(d)}),globeAtmosphere:d=>({u_frustum_tl:new s.ce(d),u_frustum_tr:new s.ce(d),u_frustum_br:new s.ce(d),u_frustum_bl:new s.ce(d),u_horizon:new s.cf(d),u_transition:new s.cf(d),u_fadeout_range:new s.cf(d),u_color:new s.d0(d),u_high_color:new s.d0(d),u_space_color:new s.d0(d),u_temporal_offset:new s.cf(d),u_horizon_angle:new s.cf(d)}),model:d=>({u_matrix:new s.ch(d),u_lighting_matrix:new s.ch(d),u_normal_matrix:new s.ch(d),u_node_matrix:new s.ch(d),u_lightpos:new s.ce(d),u_lightintensity:new s.cf(d),u_lightcolor:new s.ce(d),u_camera_pos:new s.ce(d),u_opacity:new s.cf(d),u_baseColorFactor:new s.d0(d),u_emissiveFactor:new s.d0(d),u_metallicFactor:new s.cf(d),u_roughnessFactor:new s.cf(d),u_baseTextureIsAlpha:new s.cd(d),u_alphaMask:new s.cd(d),u_alphaCutoff:new s.cf(d),u_baseColorTexture:new s.cd(d),u_metallicRoughnessTexture:new s.cd(d),u_normalTexture:new s.cd(d),u_occlusionTexture:new s.cd(d),u_emissionTexture:new s.cd(d),u_lutTexture:new s.cd(d),u_color_mix:new s.d0(d),u_aoIntensity:new s.cf(d),u_emissive_strength:new s.cf(d),u_occlusionTextureTransform:new s.d0(d)}),modelDepth:d=>({u_matrix:new s.ch(d),u_instance:new s.ch(d),u_node_matrix:new s.ch(d)}),groundShadow:d=>({u_matrix:new s.ch(d),u_ground_shadow_factor:new s.ce(d)}),stars:d=>({u_matrix:new s.ch(d),u_up:new s.ce(d),u_right:new s.ce(d),u_intensity_multiplier:new s.cf(d)}),snowParticle:d=>({u_modelview:new s.ch(d),u_projection:new s.ch(d),u_time:new s.cf(d),u_cam_pos:new s.ce(d),u_velocityConeAperture:new s.cf(d),u_velocity:new s.cf(d),u_horizontalOscillationRadius:new s.cf(d),u_horizontalOscillationRate:new s.cf(d),u_boxSize:new s.cf(d),u_billboardSize:new s.cf(d),u_simpleShapeParameters:new s.cg(d),u_screenSize:new s.cg(d),u_thinningCenterPos:new s.cg(d),u_thinningShape:new s.ce(d),u_thinningAffectedRatio:new s.cf(d),u_thinningParticleOffset:new s.cf(d),u_particleColor:new s.d0(d),u_direction:new s.ce(d)}),rainParticle:d=>({u_modelview:new s.ch(d),u_projection:new s.ch(d),u_time:new s.cf(d),u_cam_pos:new s.ce(d),u_texScreen:new s.cd(d),u_velocityConeAperture:new s.cf(d),u_velocity:new s.cf(d),u_boxSize:new s.cf(d),u_rainDropletSize:new s.cg(d),u_distortionStrength:new s.cf(d),u_rainDirection:new s.ce(d),u_color:new s.d0(d),u_screenSize:new s.cg(d),u_thinningCenterPos:new s.cg(d),u_thinningShape:new s.ce(d),u_thinningAffectedRatio:new s.cf(d),u_thinningParticleOffset:new s.cf(d),u_shapeDirectionalPower:new s.cf(d),u_shapeNormalPower:new s.cf(d),u_mode:new s.cf(d)}),vignette:d=>({u_vignetteShape:new s.ce(d),u_vignetteColor:new s.d0(d)}),occlusion:d=>({u_matrix:new s.ch(d),u_anchorPos:new s.ce(d),u_screenSizePx:new s.cg(d),u_occluderSizePx:new s.cg(d),u_color:new s.d0(d)})};class Vl{constructor(t,a,h,g){this.id=Vl.uniqueIdxCounter,Vl.uniqueIdxCounter++,this.context=t;const _=t.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||g||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Vl.uniqueIdxCounter,Vl.uniqueIdxCounter++;const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Vl.uniqueIdxCounter=0;const mg={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class gg{constructor(t,a,h,g,_,w){this.length=a.length,this.attributes=h,this.itemSize=a.bytesPerElement,this.dynamicDraw=g,this.instanceCount=w,this.context=t;const T=t.gl;this.buffer=T.createBuffer(),t.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||_||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let h=0;h<this.attributes.length;h++){const g=a.attributes[this.attributes[h].name];g!==void 0&&t.enableVertexAttribArray(g)}}setVertexAttribPointers(t,a,h){for(let g=0;g<this.attributes.length;g++){const _=this.attributes[g],w=a.attributes[_.name];w!==void 0&&t.vertexAttribPointer(w,_.components,t[mg[_.type]],!1,this.itemSize,_.offset+this.itemSize*(h||0))}}setVertexAttribDivisor(t,a,h){for(let g=0;g<this.attributes.length;g++){const _=a.attributes[this.attributes[g].name];_!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(_,h)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ic{constructor(t,a,h,g,_){this.context=t,this.width=a,this.height=h;const w=this.framebuffer=t.gl.createFramebuffer();g&&(this.colorAttachment=new ib(t,w)),_&&(this.depthAttachmentType=_,this.depthAttachment=_==="renderbuffer"?new Ix(t,w):new eg(t,w))}destroy(){const t=this.context.gl;if(this.colorAttachment){const a=this.colorAttachment.get();a&&t.deleteTexture(a)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const a=this.depthAttachment.get();a&&t.deleteRenderbuffer(a)}else{const a=this.depthAttachment.get();a&&t.deleteTexture(a)}t.deleteFramebuffer(this.framebuffer)}}class Hf{constructor(t,a){this.gl=t,this.clearColor=new Kw(this),this.clearDepth=new Yw(this),this.clearStencil=new Jw(this),this.colorMask=new Qw(this),this.depthMask=new vx(this),this.stencilMask=new eb(this),this.stencilFunc=new Cf(this),this.stencilOp=new tb(this),this.stencilTest=new wx(this),this.depthRange=new Xm(this),this.depthTest=new Af(this),this.depthFunc=new Km(this),this.blend=new Tc(this),this.blendFunc=new _u(this),this.blendColor=new If(this),this.blendEquation=new Pf(this),this.cullFace=new yu(this),this.cullFaceSide=new bx(this),this.frontFace=new Ym(this),this.program=new Sx(this),this.activeTexture=new xu(this),this.viewport=new Mf(this),this.bindFramebuffer=new Rf(this),this.bindRenderbuffer=new Jm(this),this.bindTexture=new Df(this),this.bindVertexBuffer=new ch(this),this.bindElementBuffer=new Tx(this),this.bindVertexArrayOES=new Ex(this),this.pixelStoreUnpack=new Cx(this),this.pixelStoreUnpackPremultiplyAlpha=new vu(this),this.pixelStoreUnpackFlipY=new Ax(this),this.options=a?Object.assign({},a):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=a&&!!a.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a,h){return new Vl(this,t,a,h)}createVertexBuffer(t,a,h,g,_){return new gg(this,t,a,h,g,_)}createRenderbuffer(t,a,h){const g=this.gl,_=g.createRenderbuffer();return this.bindRenderbuffer.set(_),g.renderbufferStorage(g.RENDERBUFFER,t,a,h),this.bindRenderbuffer.set(null),_}createFramebuffer(t,a,h,g){return new Ic(this,t,a,h,g)}clear({color:t,depth:a,stencil:h,colorMask:g}){const _=this.gl;let w=0;t&&(w|=_.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(g||[!0,!0,!0,!0])),a!==void 0&&(w|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),h!==void 0&&(w|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),_.clear(w)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){s.bv(t.blendFunction,Ni.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Ul;function _g(d,t,a,h,g,_,w){const T=d.context,C=T.gl,R=d.transform,D=[s.aD(R.center.lng),s.aH(R.center.lat)],z=a.layout.get("symbol-placement"),k=a.layout.get("text-variable-anchor"),F=a.layout.get("icon-rotation-alignment")==="map",q=a.layout.get("text-rotation-alignment")==="map",$=z!=="point",X=[];let Z=0,ne=0;for(let xe=0;xe<h.length;xe++){const ve=h[xe],Oe=t.getTile(ve),Pe=Oe.getBucket(a);if(!Pe)continue;const Ye=Pe.getProjection().createInversionMatrix(R,ve.canonical),Ue=[],Qe=ax(ve,Pe,R),_t=!w&&F&&$,Fe=w&&q&&$,Ae=k&&Pe.hasTextData(),qe=Pe.hasIconTextFit()&&Ae&&Pe.hasIconData(),je=_t||Fe||w&&Ae||qe,nt=Pe.projection.name==="globe",st=nt?s.ah(R.zoom):0;nt&&(Ue.push("PROJECTION_GLOBE_VIEW"),je&&Ue.push("PROJECTED_POS_ON_VIEWPORT"));const ct=d.getOrCreateProgram("collisionBox",{defines:Ue});let St=Qe;g[0]===0&&g[1]===0||(St=d.translatePosMatrix(Qe,Oe,g,_));const Ht=w?Pe.textCollisionBox:Pe.iconCollisionBox,Qt=Pe.collisionCircleArray;if(Qt.length>0){const Yt=s.bz(),Wt=St;s.cM(Yt,Pe.placementInvProjMatrix,R.glCoordMatrix),s.cM(Yt,Yt,Pe.placementViewportMatrix),X.push({circleArray:Qt,circleOffset:ne,transform:Wt,invTransform:Yt,projection:Pe.getProjection()}),Z+=Qt.length/4,ne=Z}if(!Ht)continue;d.terrain&&d.terrain.setupElevationDraw(Oe,ct);const Lt=nt?[ve.canonical.x,ve.canonical.y,1<<ve.canonical.z]:[0,0,0];ct.draw(d,C.LINES,Ft.disabled,pi.disabled,d.colorModeForRenderPass(),ai.disabled,Su(St,Ye,R,st,D,Oe,Lt,Pe.getProjection()),a.id,Ht.layoutVertexBuffer,Ht.indexBuffer,Ht.segments,null,R.zoom,null,[Ht.collisionVertexBuffer,Ht.collisionVertexBufferExt])}if(!w||!X.length)return;const ae=d.getOrCreateProgram("collisionCircle"),de=new s.dU;de.resize(4*Z),de._trim();let _e=0;for(const xe of X)for(let ve=0;ve<xe.circleArray.length/4;ve++){const Oe=4*ve,Pe=xe.circleArray[Oe+0],Ye=xe.circleArray[Oe+1],Ue=xe.circleArray[Oe+2],Qe=xe.circleArray[Oe+3];de.emplace(_e++,Pe,Ye,Ue,Qe,0),de.emplace(_e++,Pe,Ye,Ue,Qe,1),de.emplace(_e++,Pe,Ye,Ue,Qe,2),de.emplace(_e++,Pe,Ye,Ue,Qe,3)}(!Ul||Ul.length<2*Z)&&(Ul=function(xe){const ve=2*xe,Oe=new s.a_;Oe.resize(ve),Oe._trim();for(let Pe=0;Pe<ve;Pe++){const Ye=6*Pe;Oe.uint16[Ye+0]=4*Pe+0,Oe.uint16[Ye+1]=4*Pe+1,Oe.uint16[Ye+2]=4*Pe+2,Oe.uint16[Ye+3]=4*Pe+2,Oe.uint16[Ye+4]=4*Pe+3,Oe.uint16[Ye+5]=4*Pe+0}return Oe}(Z));const be=T.createIndexBuffer(Ul,!0),Te=T.createVertexBuffer(de,s.dV.members,!0);for(const xe of X){const ve={u_matrix:xe.transform,u_inv_matrix:xe.invTransform,u_camera_to_center_distance:(ye=R).getCameraToCenterDistance(xe.projection),u_viewport_size:[ye.width,ye.height]};ae.draw(d,C.TRIANGLES,Ft.disabled,pi.disabled,d.colorModeForRenderPass(),ai.disabled,ve,a.id,Te,be,s.bd.simpleSegment(0,2*xe.circleOffset,xe.circleArray.length,xe.circleArray.length/2),null,R.zoom)}var ye;Te.destroy(),be.destroy()}const Pc=s.bz();function hh(d){const t=d._camera.getWorldToCamera(d.worldSize,1),a=s.az([],t,d.globeMatrix);s.bi(a,a);const h=[0,0,0],g=[0,1,0,0];return s.aA(g,g,a),h[0]=g[0],h[1]=g[1],h[2]=g[2],s.au(h,h),h}function yg({width:d,height:t,anchor:a,textOffset:h,textScale:g},_){const{horizontalAlign:w,verticalAlign:T}=s.bZ(a),C=-(w-.5)*d,R=-(T-.5)*t,D=s.b_(a,h);return new s.P((C/g+D[0])*_,(R/g+D[1])*_)}function Vx(d,t,a,h,g,_,w,T,C,R){const D=d.text.placedSymbolArray,z=d.text.dynamicLayoutVertexArray,k=d.icon.dynamicLayoutVertexArray,F={},q=d.getProjection(),$=pf(w,q,g),X=g.elevation,Z=q.upVectorScale(w.canonical,g.center.lat,g.worldSize).metersToTile;z.clear();for(let ne=0;ne<D.length;ne++){const ae=D.get(ne),{tileAnchorX:de,tileAnchorY:_e,numGlyphs:be}=ae,Te=ae.hidden||!ae.crossTileID||d.allowVerticalPlacement&&!ae.placedOrientation?null:h[ae.crossTileID];if(Te){let ye=0,xe=0,ve=0;if(X){const qe=X?X.getAtTileOffset(w,de,_e):0,[je,nt,st]=q.upVector(w.canonical,de,_e);ye=qe*je*Z,xe=qe*nt*Z,ve=qe*st*Z}let[Oe,Pe,Ye,Ue]=Mo(ae.projectedAnchorX+ye,ae.projectedAnchorY+xe,ae.projectedAnchorZ+ve,a?$:_);const Qe=zm(g.getCameraToCenterDistance(q),Ue);let _t=s.bJ(d.textSizeData,C,ae)*Qe/s.bU;a&&(_t*=d.tilePixelRatio/T);const Fe=yg(Te,_t);a?({x:Oe,y:Pe,z:Ye}=q.projectTilePoint(de+Fe.x,_e+Fe.y,w.canonical),[Oe,Pe,Ye]=Mo(Oe+ye,Pe+xe,Ye+ve,_)):(t&&Fe._rotate(-g.angle),Oe+=Fe.x,Pe+=Fe.y,Ye=0);const Ae=d.allowVerticalPlacement&&ae.placedOrientation===s.bI.vertical?Math.PI/2:0;for(let qe=0;qe<be;qe++)s.bL(z,Oe,Pe,Ye,Ae);R&&ae.associatedIconIndex>=0&&(F[ae.associatedIconIndex]={x:Oe,y:Pe,z:Ye,angle:Ae})}else lu(be,z)}if(R){k.clear();const ne=d.icon.placedSymbolArray;for(let ae=0;ae<ne.length;ae++){const de=ne.get(ae),{numGlyphs:_e}=de,be=F[ae];if(de.hidden||!be)lu(_e,k);else{const{x:Te,y:ye,z:xe,angle:ve}=be;for(let Oe=0;Oe<_e;Oe++)s.bL(k,Te,ye,xe,ve)}}d.icon.dynamicLayoutVertexBuffer.updateData(k)}d.text.dynamicLayoutVertexBuffer.updateData(z)}function xg(d,t,a,h,g,_,w={}){const T=a.paint.get("icon-translate"),C=a.paint.get("text-translate"),R=a.paint.get("icon-translate-anchor"),D=a.paint.get("text-translate-anchor"),z=a.layout.get("icon-rotation-alignment"),k=a.layout.get("text-rotation-alignment"),F=a.layout.get("icon-pitch-alignment"),q=a.layout.get("text-pitch-alignment"),$=a.layout.get("icon-keep-upright"),X=a.layout.get("text-keep-upright"),Z=a.paint.get("icon-color-saturation"),ne=a.paint.get("icon-color-contrast"),ae=a.paint.get("icon-color-brightness-min"),de=a.paint.get("icon-color-brightness-max"),_e=a.layout.get("symbol-elevation-reference")==="sea",be=d.context,Te=be.gl,ye=d.transform,xe=z==="map",ve=k==="map",Oe=F==="map",Pe=q==="map",Ye=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Ue=!1;const Qe=d.depthModeForSublayer(0,Ft.ReadOnly),_t=new Ft(d.context.gl.LEQUAL,Ft.ReadOnly,d.depthRangeFor3D),Fe=[s.aD(ye.center.lng),s.aH(ye.center.lat)],Ae=a.layout.get("text-variable-anchor"),qe=ye.projection.name==="globe",je=[],nt=[0,-1,0];for(const st of h){const ct=t.getTile(st),St=ct.getBucket(a);if(!St||St.projection.name==="mercator"&&qe||St.fullyClipped)continue;const Ht=St.projection.name==="globe",Qt=Ht?s.ah(ye.zoom):0,Lt=pf(st,St.getProjection(),ye),Yt=ye.calculatePixelsToTileUnitsMatrix(ct),Wt=Ae&&St.hasTextData(),xi=St.hasIconTextFit()&&Wt&&St.hasIconData(),Mi=St.getProjection().createInversionMatrix(ye,st.canonical),Ui=(1<<ct.tileID.canonical.z)*s.aj/d.transform.worldSize,cn=An=>{let gn=[0,0,0];if(An){const sr=d.style.directionalLight,on=d.style.ambientLight;sr&&on&&(gn=bc(d.style,sr,on))}return gn},Ei=An=>{ye.depthOcclusionForSymbolsAndCircles&&(a.hasInitialOcclusionOpacityProperties||d.terrain)&&(An.push("DEPTH_D24"),An.push("DEPTH_OCCLUSION"))},un=()=>{const An=xe&&a.layout.get("symbol-placement")!=="point",gn=[];Ei(gn);const sr=An||xi,on=St.elevationType==="road",xn=d.shadowRenderer,Ln=on&&Oe&&!!xn&&xn.enabled,Dr=cn(Ln),Ir=on&&Oe&&!d.terrain?_t:Qe,zr=a.paint.get("icon-image-cross-fade");d.terrainRenderModeElevated()&&Oe&&gn.push("PITCH_WITH_MAP_TERRAIN"),Ht&&(gn.push("PROJECTION_GLOBE_VIEW"),sr&&gn.push("PROJECTED_POS_ON_VIEWPORT")),zr>0&&St.hasAnySecondaryIcon&&gn.push("ICON_TRANSITION"),!St.icon.zOffsetVertexBuffer||on&&d.terrain||gn.push("Z_OFFSET"),Z===0&&ne===0&&ae===0&&de===1||gn.push("COLOR_ADJUSTMENT"),St.sdfIcons&&gn.push("RENDER_SDF"),Ln&&gn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),on&&Oe&&!d.terrain&&St.icon.orientationVertexBuffer&&gn.push("ELEVATED_ROADS");const us=St.icon.programConfigurations.get(a.id),_a=d.getOrCreateProgram("symbol",{config:us,defines:gn}),Xs=ct.imageAtlasTexture?ct.imageAtlasTexture.size:[0,0],vo=St.iconSizeData,Ts=s.bH(vo,ye.zoom),zo=Oe||!ye.isOrthographic,ra=Kd(Lt,ct.tileID.canonical,Oe,xe,ye,St.getProjection(),Yt),Es=Qa(Lt,ct.tileID.canonical,Oe,xe,ye,St.getProjection(),Yt),Tr=d.translatePosMatrix(Es,ct,T,R,!0),fr=d.translatePosMatrix(Lt,ct,T,R),Bn=sr?Pc:ra,Ur=xe&&!Oe&&!An;let ds=nt;!qe&&!ye.mercatorFromTransition||xe||(ds=hh(ye));const Er=Ht?ds:nt,Oo=a.getColorAdjustmentMatrix(Z,ne,ae,de),kc=$f(vo.kind,Ts,Ur,Oe,d,fr,Bn,Tr,_e,!1,Xs,[0,0],0,st,Qt,Fe,Mi,Er,St.getProjection(),Dr,Ui,Oo,zr,null),Xl=ct.imageAtlasTexture?ct.imageAtlasTexture:null,Fu=a.layout.get("icon-size").constantOr(0)!==1||St.iconsNeedLinear,ju=St.sdfIcons||d.options.rotating||d.options.zooming||Fu||zo?Te.LINEAR:Te.NEAREST,Fo=St.sdfIcons&&a.paint.get("icon-halo-width").constantOr(1)!==0,Fa=d.terrain&&Oe&&An?s.bi(s.bz(),ra):Pc;if(An&&St.icon){const Gr=ye.elevation,jo=Gr?Gr.getAtTileOffsetFunc(st,ye.center.lat,ye.worldSize,St.getProjection()):null,Nc=au(Lt,ct.tileID.canonical,Oe,xe,ye,St.getProjection(),Yt);xc(St,Lt,d,!1,Nc,Es,Oe,$,jo,st)}return{program:_a,buffers:St.icon,uniformValues:kc,atlasTexture:Xl,atlasTextureIcon:null,atlasInterpolation:ju,atlasInterpolationIcon:null,isSDF:St.sdfIcons,hasHalo:Fo,depthMode:Ir,tile:ct,renderWithShadows:Ln,labelPlaneMatrixInv:Fa}},mn=()=>{const An=ve&&a.layout.get("symbol-placement")!=="point",gn=[],sr=An||Ae||xi,on=St.elevationType==="road",xn=d.shadowRenderer,Ln=on&&Pe&&!!xn&&xn.enabled,Dr=cn(Ln),Ir=on&&Pe&&!d.terrain?_t:Qe;d.terrainRenderModeElevated()&&Pe&&gn.push("PITCH_WITH_MAP_TERRAIN"),Ht&&(gn.push("PROJECTION_GLOBE_VIEW"),sr&&gn.push("PROJECTED_POS_ON_VIEWPORT")),!St.text.zOffsetVertexBuffer||on&&d.terrain||gn.push("Z_OFFSET"),St.iconsInText&&gn.push("RENDER_TEXT_AND_SYMBOL"),gn.push("RENDER_SDF"),Ln&&gn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),on&&Pe&&!d.terrain&&St.text.orientationVertexBuffer&&gn.push("ELEVATED_ROADS"),Ei(gn);const zr=St.text.programConfigurations.get(a.id),us=d.getOrCreateProgram("symbol",{config:zr,defines:gn});let _a,Xs=[0,0],vo=null;const Ts=St.textSizeData;St.iconsInText&&(Xs=ct.imageAtlasTexture?ct.imageAtlasTexture.size:[0,0],vo=ct.imageAtlasTexture?ct.imageAtlasTexture:null,_a=Pe||!ye.isOrthographic||d.options.rotating||d.options.zooming||Ts.kind==="composite"||Ts.kind==="camera"?Te.LINEAR:Te.NEAREST);const zo=ct.glyphAtlasTexture?ct.glyphAtlasTexture.size:[0,0],ra=a.layout.get("text-size-scale-range"),Es=s.ay(d.scaleFactor,ra[0],ra[1]),Tr=s.bH(Ts,ye.zoom,Es),fr=Kd(Lt,ct.tileID.canonical,Pe,ve,ye,St.getProjection(),Yt),Bn=Qa(Lt,ct.tileID.canonical,Pe,ve,ye,St.getProjection(),Yt),Ur=d.translatePosMatrix(Bn,ct,C,D,!0),ds=d.translatePosMatrix(Lt,ct,C,D),Er=sr?Pc:fr,Oo=ve&&!Pe&&!An;let kc=nt;!qe&&!ye.mercatorFromTransition||ve||(kc=hh(ye));const Xl=$f(Ts.kind,Tr,Oo,Pe,d,ds,Er,Ur,_e,!0,zo,Xs,0,st,Qt,Fe,Mi,Ht?kc:nt,St.getProjection(),Dr,Ui,null,null,Es),Fu=ct.glyphAtlasTexture?ct.glyphAtlasTexture:null,ju=Te.LINEAR,Fo=a.paint.get("text-halo-width").constantOr(1)!==0,Fa=d.terrain&&Pe&&An?s.bi(s.bz(),fr):Pc;if(An&&St.text){const Gr=ye.elevation,jo=Gr?Gr.getAtTileOffsetFunc(st,ye.center.lat,ye.worldSize,St.getProjection()):null,Nc=au(Lt,ct.tileID.canonical,Pe,ve,ye,St.getProjection(),Yt);xc(St,Lt,d,!0,Nc,Bn,Pe,X,jo,st)}return{program:us,buffers:St.text,uniformValues:Xl,atlasTexture:Fu,atlasTextureIcon:vo,atlasInterpolation:ju,atlasInterpolationIcon:_a,isSDF:!0,hasHalo:Fo,depthMode:Ir,tile:ct,renderWithShadows:Ln,labelPlaneMatrixInv:Fa}},Fn=St.icon.segments.get().length,ji=St.text.segments.get().length,dn=Fn&&!w.onlyText?un():null,hn=ji&&!w.onlyIcons?mn():null,yn=a.paint.get("icon-opacity").constantOr(1),Gi=a.paint.get("text-opacity").constantOr(1);if(Ye&&St.canOverlap){Ue=!0;const An=yn&&!w.onlyText?St.icon.segments.get():[],gn=Gi&&!w.onlyIcons?St.text.segments.get():[];for(const sr of An)je.push({segments:new s.bd([sr]),sortKey:sr.sortKey,state:dn});for(const sr of gn)je.push({segments:new s.bd([sr]),sortKey:sr.sortKey,state:hn})}else w.onlyText||je.push({segments:yn?St.icon.segments:new s.bd([]),sortKey:0,state:dn}),w.onlyIcons||je.push({segments:Gi?St.text.segments:new s.bd([]),sortKey:0,state:hn})}Ue&&je.sort((st,ct)=>st.sortKey-ct.sortKey);for(const st of je){const ct=st.state;if(ct)if(d.terrain?d.terrain.setupElevationDraw(ct.tile,ct.program,{useDepthForOcclusion:ye.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:ct.labelPlaneMatrixInv}):d.setupDepthForOcclusion(ye.depthOcclusionForSymbolsAndCircles,ct.program),be.activeTexture.set(Te.TEXTURE0),ct.atlasTexture&&ct.atlasTexture.bind(ct.atlasInterpolation,Te.CLAMP_TO_EDGE,!0),ct.atlasTextureIcon&&(be.activeTexture.set(Te.TEXTURE1),ct.atlasTextureIcon&&ct.atlasTextureIcon.bind(ct.atlasInterpolationIcon,Te.CLAMP_TO_EDGE,!0)),ct.renderWithShadows&&d.shadowRenderer.setupShadows(ct.tile.tileID.toUnwrapped(),ct.program,"vector-tile"),d.uploadCommonLightUniforms(d.context,ct.program),ct.hasHalo){const St=ct.uniformValues;St.u_is_halo=1,Gl(ct.buffers,st.segments,a,d,ct.program,ct.depthMode,g,_,St,2),St.u_is_halo=0}else{if(ct.isSDF){const St=ct.uniformValues;ct.hasHalo&&(St.u_is_halo=1,Gl(ct.buffers,st.segments,a,d,ct.program,ct.depthMode,g,_,St,1)),St.u_is_halo=0}Gl(ct.buffers,st.segments,a,d,ct.program,ct.depthMode,g,_,ct.uniformValues,1)}}}function Gl(d,t,a,h,g,_,w,T,C,R){const D=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.iconTransitioningVertexBuffer,d.globeExtVertexBuffer,d.zOffsetVertexBuffer,d.orientationVertexBuffer];g.draw(h,h.context.gl.TRIANGLES,_,w,T,ai.disabled,C,a.id,d.layoutVertexBuffer,d.indexBuffer,t,a.paint,h.transform.zoom,d.programConfigurations.get(a.id),D,R)}function fh(d,t){const a=1<<d.canonical.z,h=(t.x*a-d.canonical.x-d.wrap*a)*s.aj,g=(t.y*a-d.canonical.y)*s.aj,_=s.e2(t.z,t.y);return s.d2(h,g,_)}function Bt(d,t,a,h,g){if(!a.layout||a.layout.get("fill-elevation-reference")==="none")return;const _=d.context.gl,w=new Ft(d.context.gl.LEQUAL,Ft.ReadWrite,d.depthRangeFor3D),T=new Ft(d.context.gl.GREATER,Ft.ReadWrite,d.depthRangeFor3D),C=function(F){const q=s.cU(F.pitch);let $=.01;return F.isOrthographic&&($=s.ai(1e-4,$,s.cZ(q>=cs?1:q/cs))),2*$}(d.transform),R=d.transform.getFreeCameraOptions().position,D="elevatedStructuresDepthReconstruct",z=d.getOrCreateProgram(D,{defines:["DEPTH_RECONSTRUCTION"]}),k=d.getOrCreateProgram(D);for(const F of h){const q=t.getTile(F),$=q.getBucket(a);if(!$)continue;const X=$.elevatedStructures;if(!X)continue;const Z=$.elevationBufferData.heightRange,ne=fh(F.toUnwrapped(),R),ae=d.translatePosMatrix(F.projMatrix,q,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));let de,_e,be,Te;if(g==="initialize"){if(!Z||Z.min>=1||X.depthSegments.segments[0].primitiveLength===0)continue;de=Bf(ae,ne,C,1,0),_e=w,be=X.depthSegments,Te=z}else if(g==="reset"){if(!Z||Z.min>=0||X.maskSegments.segments[0].primitiveLength===0)continue;de=Bf(ae,ne,0,0,1),_e=T,be=X.maskSegments,Te=z}else if(g==="geometry"){if(X.depthSegments.segments[0].primitiveLength===0)continue;de=Bf(ae,ne,C,1,0),_e=w,be=X.depthSegments,Te=k}Te.draw(d,_.TRIANGLES,_e,pi.disabled,Ni.disabled,ai.disabled,de,a.id,X.vertexBuffer,X.indexBuffer,be,a.paint,d.transform.zoom)}}function qf(d,t,a){const{painter:h,sourceCache:g,layer:_,coords:w,colorMode:T,elevationType:C,terrainEnabled:R,pass:D}=d,z=h.context.gl,k=_.paint.get("fill-pattern"),F=_.paint.get("fill-pattern-cross-fade"),q=k.constantOr(null);let $=C;C!=="road"||t&&!R||($="none");const X=$==="road",Z=d.painter.shadowRenderer,ne=X&&!!Z&&Z.enabled,ae=new Ft(h.context.gl.LEQUAL,Ft.ReadOnly,h.depthRangeFor3D);let de=[0,0,0];if(ne){const Te=h.style.directionalLight,ye=h.style.ambientLight;Te&&ye&&(de=bc(h.style,Te,ye))}const _e=k&&k.constantOr(1),be=(Te,ye)=>{let xe,ve,Oe,Pe,Ye;ye?(xe=_e&&!_.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Oe=z.LINES):(xe=_e?"fillPattern":"fill",Oe=z.TRIANGLES);for(const Ue of w){const Qe=g.getTile(Ue);if(_e&&!Qe.patternsLoaded())continue;const _t=Qe.getBucket(_);if(!_t)continue;const Fe=t?_t.elevationBufferData:_t.bufferData;if(Fe.isEmpty())continue;h.prepareDrawTile();const Ae=Fe.programConfigurations.get(_.id),qe=h.isTileAffectedByFog(Ue),je=[],nt=[];X&&(je.push("ELEVATED_ROADS"),nt.push(Fe.elevatedLayoutVertexBuffer)),ne&&je.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),_e&&(h.context.activeTexture.set(z.TEXTURE0),Qe.imageAtlasTexture&&Qe.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Ae.updatePaintBuffers());let st=!1;if(q&&Qe.imageAtlas){const Lt=Qe.imageAtlas,Yt=s.dZ.from(q),Wt=Yt.getPrimary().scaleSelf(s.q.devicePixelRatio).toString(),xi=Yt.getSecondary(),Mi=Lt.patternPositions.get(Wt),Ui=xi?Lt.patternPositions.get(xi.scaleSelf(s.q.devicePixelRatio).toString()):null;st=!!Mi&&!!Ui,Mi&&Ae.setConstantPatternPositions(Mi,Ui)}F>0&&(st||Ae.getPatternTransitionVertexBuffer("fill-pattern"))&&je.push("FILL_PATTERN_TRANSITION");const ct=h.getOrCreateProgram(xe,{config:Ae,overrideFog:qe,defines:je}),St=h.translatePosMatrix(Ue.projMatrix,Qe,_.paint.get("fill-translate"),_.paint.get("fill-translate-anchor"));ne&&Z.setupShadows(Qe.tileID.toUnwrapped(),ct,"vector-tile");const Ht=_.paint.get("fill-emissive-strength");if(ye){Pe=Fe.lineIndexBuffer,Ye=Fe.lineSegments;const Lt=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[z.drawingBufferWidth,z.drawingBufferHeight];ve=xe==="fillOutlinePattern"&&_e?rb(St,Ht,h,Qe,Lt,de,F):nb(St,Ht,Lt,de)}else Pe=Fe.indexBuffer,Ye=Fe.triangleSegments,ve=_e?Dx(St,Ht,h,Qe,de,F):Rx(St,Ht,de);h.uploadCommonUniforms(h.context,ct,Ue.toUnwrapped());let Qt=Te;(C==="road"&&!R||C==="offset")&&(Qt=ae),ct.draw(h,Oe,Qt,a||h.stencilModeForClipping(Ue),T,ai.disabled,ve,_.id,Fe.layoutVertexBuffer,Pe,Ye,_.paint,h.transform.zoom,Ae,nt)}};h.renderPass===D&&be(h.depthModeForSublayer(1,h.renderPass==="opaque"?Ft.ReadWrite:Ft.ReadOnly),!1),$==="none"&&h.renderPass==="translucent"&&_.paint.get("fill-antialias")&&be(h.depthModeForSublayer(_.getPaintProperty("fill-outline-color")?2:0,Ft.ReadOnly),!0)}function ph(d,t,a,h,g,_,w,T){a.resetLayerRenderingStats(d);const C=d.context,R=C.gl,D=d.transform,z=a.paint.get("fill-extrusion-pattern"),k=a.paint.get("fill-extrusion-pattern-cross-fade"),F=z.constantOr(null),q=z.constantOr(1),$=a.paint.get("fill-extrusion-opacity"),X=d.style.enable3dLights(),Z=a.paint.get(X&&!q?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ne=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),Z],ae=a.layout.get("fill-extrusion-edge-radius"),de=ae>0&&!a.paint.get("fill-extrusion-rounded-roof"),_e=de?0:ae,be=D.projection.name==="globe"?s.e5():0,Te=D.projection.name==="globe",ye=Te?s.ah(D.zoom):0,xe=[s.aD(D.center.lng),s.aH(D.center.lat)],ve=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Oe=a.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ve?null:a.lut).toArray01().slice(0,3),Pe=a.paint.get("fill-extrusion-flood-light-intensity"),Ye=a.paint.get("fill-extrusion-vertical-scale"),Ue=a.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Qe=a.paint.get("fill-extrusion-height-alignment"),_t=a.paint.get("fill-extrusion-base-alignment"),Fe=ka(d,a.paint.get("fill-extrusion-cutoff-fade-range")),Ae=[];let qe;Te&&Ae.push("PROJECTION_GLOBE_VIEW"),ne[0]>0&&Ae.push("FAUX_AO"),de&&Ae.push("ZERO_ROOF_RADIUS"),T&&Ae.push("HAS_CENTROID"),Pe>0&&Ae.push("FLOOD_LIGHT"),Fe.shouldRenderCutoff&&Ae.push("RENDER_CUTOFF"),Ue&&Ae.push("RENDER_WALL_MODE");const je=d.renderPass==="shadow",nt=d.shadowRenderer,st=je&&!!nt,ct=je?ai.disabled:ai.backCCW;d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!0);let St=[0,0,0];if(nt){const Lt=d.style.directionalLight,Yt=d.style.ambientLight;Lt&&Yt&&(St=bc(d.style,Lt,Yt)),je||(Ae.push("RENDER_SHADOWS","DEPTH_TEXTURE"),nt.useNormalOffset&&Ae.push("NORMAL_OFFSET")),qe=Ae.concat(["SHADOWS_SINGLE_CASCADE"])}const Ht=st?"fillExtrusionDepth":q?"fillExtrusionPattern":"fillExtrusion",Qt=a.getLayerRenderingStats();for(const Lt of h){const Yt=t.getTile(Lt),Wt=Yt.getBucket(a);if(!Wt||Wt.projection.name!==D.projection.name)continue;let xi=!1;nt&&(xi=nt.getMaxCascadeForTile(Lt.toUnwrapped())===0);const Mi=d.isTileAffectedByFog(Lt),Ui=Wt.programConfigurations.get(a.id);let cn=!1;if(F&&Yt.imageAtlas){const hn=Yt.imageAtlas,yn=s.dZ.from(F),Gi=yn.getPrimary().scaleSelf(s.q.devicePixelRatio).toString(),An=yn.getSecondary(),gn=hn.patternPositions.get(Gi),sr=An?hn.patternPositions.get(An.scaleSelf(s.q.devicePixelRatio).toString()):null;cn=!!gn&&!!sr,gn&&Ui.setConstantPatternPositions(gn,sr)}k>0&&(cn||Ui.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ae.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Ei=d.getOrCreateProgram(Ht,{config:Ui,defines:xi?qe:Ae,overrideFog:Mi});if(d.terrain&&d.terrain.setupElevationDraw(Yt,Ei,{useMeterToDem:!0}),!Wt.centroidVertexBuffer){const hn=Ei.attributes.a_centroid_pos;hn!==void 0&&R.vertexAttrib2f(hn,0,0)}!je&&nt&&nt.setupShadows(Yt.tileID.toUnwrapped(),Ei,"vector-tile"),q&&(d.context.activeTexture.set(R.TEXTURE0),Yt.imageAtlasTexture&&Yt.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),Ui.updatePaintBuffers());const un=a.paint.get("fill-extrusion-vertical-gradient"),mn=1/Wt.tileToMeter;let Fn;if(je&&nt){if(Wf(Yt.tileID,Wt.maxHeight,d))continue;const hn=nt.calculateShadowPassMatrixFromTile(Yt.tileID.toUnwrapped());Fn=Mx(hn,_e,mn,Ye,Qe,_t)}else{const hn=d.translatePosMatrix(Lt.expandedProjMatrix,Yt,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),yn=D.projection.createInversionMatrix(D,Lt.canonical);Fn=q?bu(hn,d,un,$,ne,_e,mn,Lt,Yt,be,Qe,_t,ye,xe,yn,Oe,Ye,k):lg(hn,d,un,$,ne,_e,mn,Lt,be,Qe,_t,ye,xe,yn,Oe,Ye,Pe,St)}d.uploadCommonUniforms(C,Ei,Lt.toUnwrapped(),null,Fe);let ji=Wt.segments;if(D.projection.name==="mercator"&&!je&&(ji=Wt.getVisibleSegments(Yt.tileID,d.terrain,d.transform.getFrustum(0)),!ji.get().length))continue;if(Qt)if(je)for(const hn of ji.get())Qt.numRenderedVerticesInShadowPass+=hn.primitiveLength;else for(const hn of ji.get())Qt.numRenderedVerticesInTransparentPass+=hn.primitiveLength;const dn=[];(d.terrain||T)&&dn.push(Wt.centroidVertexBuffer),Te&&dn.push(Wt.layoutVertexExtBuffer),Ue&&dn.push(Wt.wallVertexBuffer),Ei.draw(d,C.gl.TRIANGLES,g,_,w,ct,Fn,a.id,Wt.layoutVertexBuffer,Wt.indexBuffer,ji,a.paint,d.transform.zoom,Ui,dn)}d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!1)}class il{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function lo(d,t,a,h,g,_,w,T,C,R,D,z,k,F,q,$,X,Z,ne,ae){const de=t.context,_e=de.gl,be=t.transform,Te=t.transform.zoom,ye=[],xe=d.translate,ve=d.translateAnchor,Oe=d.edgeRadius,Pe=ka(t,d.cutoffFadeRange);D==="clear"?(ye.push("CLEAR_SUBPASS"),ae&&(ye.push("CLEAR_FROM_TEXTURE"),de.activeTexture.set(_e.TEXTURE0),ae.bind(_e.LINEAR,_e.CLAMP_TO_EDGE))):D==="sdf"&&ye.push("SDF_SUBPASS"),Z&&ye.push("HAS_CENTROID"),Pe.shouldRenderCutoff&&ye.push("RENDER_CUTOFF");const Ye=(Ue,Qe,_t,Fe,Ae)=>{const qe=Qe.programConfigurations.get(h.id),je=t.isTileAffectedByFog(Ue),nt=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:qe,defines:ye,overrideFog:je}),st=((St,Ht,Qt,Lt,Yt,Wt,xi,Mi,Ui,cn,Ei)=>({u_matrix:Ht,u_opacity:Qt,u_ao_pass:Lt?1:0,u_meter_to_tile:Yt,u_ao:Wt,u_flood_light_intensity:xi,u_flood_light_color:Mi,u_attenuation:Ui,u_edge_radius:cn,u_fb:0,u_fb_size:Ei,u_dynamic_offset:1}))(0,Fe,z,R,Ae,[k,F*Ae],q,$,X,Te>=17?0:Oe*Ae,ae?ae.size[0]:0),ct=[];Z&&ct.push(Qe.hiddenByLandmarkVertexBuffer),t.uploadCommonUniforms(de,nt,Ue.toUnwrapped(),null,Pe),nt.draw(t,de.gl.TRIANGLES,_,w,T,C,st,h.id,Qe.vertexBuffer,Qe.indexBuffer,_t,h.paint,Te,qe,ct)};for(const Ue of g){const Qe=a.getTile(Ue),_t=Qe.getBucket(h);if(!_t||_t.projection.name!==be.projection.name||!_t.groundEffect||_t.groundEffect&&!_t.groundEffect.hasData())continue;const Fe=_t.groundEffect,Ae=1/_t.tileToMeter;{const qe=t.translatePosMatrix(Ue.projMatrix,Qe,xe,ve),je=Fe.getDefaultSegment();Ye(Ue,Fe,je,qe,Ae)}if(ne)for(let qe=0;qe<4;qe++){const je=s.e3[qe](Ue),nt=a.getTile(je);if(!nt)continue;const st=nt.getBucket(h);if(!st||st.projection.name!==be.projection.name||!st.groundEffect||st.groundEffect&&!st.groundEffect.hasData())continue;const ct=st.groundEffect;let St,Ht;qe===0?(St=[-s.aj,0,0],Ht=1):qe===1?(St=[s.aj,0,0],Ht=0):qe===2?(St=[0,-s.aj,0],Ht=3):(St=[0,s.aj,0],Ht=2);const Qt=ct.regionSegments[Ht];if(!Qt)continue;const Lt=new Float32Array(16);s.bo(Lt,Ue.projMatrix,St),Ye(Ue,ct,Qt,t.translatePosMatrix(Lt,Qe,xe,ve),Ae)}}}function ci(d,t,a,h,g,_,w){h.centroidVertexArray.length===0&&h.createCentroidsBuffer();const T=_?_.findDEMTileFor(a):null;if(!(T&&T.dem||w))return;_&&T&&T.dem&&h.selfDEMTileTimestamp!==T.dem._timestamp&&(h.borderDoneWithNeighborZ=[-1,-1,-1,-1],h.selfDEMTileTimestamp=T.dem._timestamp);const C=Z=>new s.P(Math.ceil((Z+s.e7)*s.e8),0),R=Z=>{const ne=t.getSource().minzoom,ae=_e=>{const be=t.getTileByID(_e);if(be&&be.hasData())return be.getBucket(g)},de=[0,-1,1];for(const _e of de){if(Z.overscaledZ+_e<ne)continue;const be=ae(Z.calculateScaledKey(Z.overscaledZ+_e));if(be)return be}},D=[0,0,0],z=(Z,ne)=>(D[0]=Math.min(Z.min.y,ne.min.y),D[1]=Math.max(Z.max.y,ne.max.y),D[2]=s.aj-ne.min.x>Z.max.x?ne.min.x-s.aj:Z.max.x,D),k=(Z,ne)=>(D[0]=Math.min(Z.min.x,ne.min.x),D[1]=Math.max(Z.max.x,ne.max.x),D[2]=s.aj-ne.min.y>Z.max.y?ne.min.y-s.aj:Z.max.y,D),F=[(Z,ne)=>z(Z,ne),(Z,ne)=>z(ne,Z),(Z,ne)=>k(Z,ne),(Z,ne)=>k(ne,Z)],q=(Z,ne,ae,de,_e,be,Te)=>{if(!_)return 0;const ye=[[be?ae:Z,be?Z:ae,0],[be?ae:ne,be?ne:ae,0]],xe=Te<0?s.aj+Te:Te,ve=[be?xe:(Z+ne)/2,be?(Z+ne)/2:xe,0];return ae===0&&Te<0||ae!==0&&Te>0?_.getForTilePoints(_e,[ve],!0,de):ye.push(ve),_.getForTilePoints(a,ye,!0,T),Math.max(ye[0][2],ye[1][2],ve[2])/_.exaggeration()};for(let Z=0;Z<4;Z++){const ne=h.borderFeatureIndices[Z];if(ne.length===0)continue;const ae=s.e3[Z](a),de=R(ae);if(!(de&&de instanceof s.e4))continue;const _e=_?_.findDEMTileFor(ae):null;if(!(_e&&_e.dem||w)||(_&&_e&&_e.dem&&h.borderDEMTileTimestamp[Z]!==_e.dem._timestamp&&(h.borderDoneWithNeighborZ[Z]=-1,h.borderDEMTileTimestamp[Z]=_e.dem._timestamp),h.borderDoneWithNeighborZ[Z]===de.canonical.z))continue;de.centroidVertexArray.length===0&&de.createCentroidsBuffer();const be=(Z<2?1:5)-Z,Te=de.borderDoneWithNeighborZ[be]!==h.canonical.z,ye=de.borderFeatureIndices[be];let xe=0;if(h.canonical.z!==de.canonical.z){for(const ve of ne)h.showCentroid(h.featuresOnBorder[ve]);if(Te)for(const ve of ye)de.showCentroid(de.featuresOnBorder[ve]);h.borderDoneWithNeighborZ[Z]=de.canonical.z,de.borderDoneWithNeighborZ[be]=h.canonical.z}for(const ve of ne){const Oe=h.featuresOnBorder[ve],Pe=h.centroidData[Oe.centroidDataIndex],Ye=Oe.borders[Z];let Ue;for(;xe<ye.length;){Ue=de.featuresOnBorder[ye[xe]];const Qe=Ue.borders[be];if(Qe[1]>Ye[0]+3||Qe[0]>Ye[0]-3)break;de.showCentroid(Ue),xe++}if(Ue&&xe<ye.length){const Qe=xe;let _t=0;for(;!(Ue.borders[be][0]>Ye[1]-3)&&(_t++,++xe!==ye.length);)Ue=de.featuresOnBorder[ye[xe]];Ue=de.featuresOnBorder[ye[Qe]];let Fe=!1;if(_t>=1){const je=Ue.borders[be];Math.abs(Ye[0]-je[0])<3&&Math.abs(Ye[1]-je[1])<3&&(_t=1,Fe=!0,xe=Qe+1)}else if(_t===0){h.showCentroid(Oe);continue}const Ae=de.centroidData[Ue.centroidDataIndex];w&&Fe&&((($=Pe).flags|(X=Ae).flags)&s.e6?($.flags|=s.e6,X.flags|=s.e6):($.flags&=~s.e6,X.flags&=~s.e6));const qe=Oe.intersectsCount()>1||Ue.intersectsCount()>1;if(_t>1)xe=Qe,Pe.centroidXY=Ae.centroidXY=new s.P(0,0);else if(_e&&_e.dem&&!qe){const je=F[Z](Pe,Ae),nt=Z%2?s.aj-1:0,st=q(je[0],Math.min(s.aj-1,je[1]),nt,_e,ae,Z<2,je[2]);Pe.centroidXY=Ae.centroidXY=C(st)}else qe?Pe.centroidXY=Ae.centroidXY=new s.P(0,0):(Pe.centroidXY=h.encodeBorderCentroid(Oe),Ae.centroidXY=de.encodeBorderCentroid(Ue));h.writeCentroidToBuffer(Pe),de.writeCentroidToBuffer(Ae)}else h.showCentroid(Oe)}h.borderDoneWithNeighborZ[Z]=de.canonical.z,de.borderDoneWithNeighborZ[be]=h.canonical.z}var $,X;(h.needsCentroidUpdate||!h.centroidVertexBuffer&&h.centroidVertexArray.length!==0)&&h.uploadCentroid(d)}const vg=[1,0,0],ob=[0,1,0],ab=[0,0,1];function Wf(d,t,a){const h=a.transform,g=a.shadowRenderer;if(!g)return!0;const _=d.toUnwrapped(),w=h.tileSize*g._cascades[a.currentShadowCascade].scale;let T=t;if(h.elevation){const $=h.elevation.getMinMaxForTile(d);$&&(T+=$.max)}const C=[...g.shadowDirection];C[2]=-C[2];const R=g.computeSimplifiedTileShadowVolume(_,T,w,C);if(!R)return!1;const D=[vg,ob,ab,C,[C[0],0,C[2]],[0,C[1],C[2]]],z=h.projection.name==="globe",k=h.scaleZoom(w),F=s.cy.fromInvProjectionMatrix(h.invProjMatrix,h.worldSize,k,!z),q=g.getCurrentCascadeFrustum();return F.intersectsPrecise(R.vertices,R.planes,D)===0||q.intersectsPrecise(R.vertices,R.planes,D)===0}function Zf(d){const{painter:t,source:a,layer:h,coords:g}=d,_=d.defines,w=t.context,T=t.renderPass==="shadow",C=t.renderPass==="light-beam",R=t.shadowRenderer;let D;R&&(D=_.concat(["SHADOWS_SINGLE_CASCADE"]));const z=s.e9(t.transform.center.lat,t.transform.zoom);for(const k of g){const F=a.getTile(k),q=F.getBucket(h);if(!q)continue;let $=!1;R&&($=R.getMaxCascadeForTile(k.toUnwrapped())===0);const X=q.programConfigurations.get(h.id);let Z,ne,ae=t.translatePosMatrix(k.expandedProjMatrix,F,[0,0],"map");if(ae=s.cP(s.bz(),ae,[1,1,d.verticalScale]),T&&R){if(Wf(F.tileID,q.maxHeight*z,t))continue;let de=R.calculateShadowPassMatrixFromTile(F.tileID.toUnwrapped());de=s.cP(s.bz(),de,[1,1,d.verticalScale]),ne=kx(de),Z=t.getOrCreateProgram("buildingDepth",{config:X,defines:$?D:_,overrideFog:!1})}else if(C)Z=t.getOrCreateProgram("buildingBloom",{config:X,defines:$?D:_,overrideFog:!1}),ne=ug(ae);else{const de=t.transform.calculatePosMatrix(k.toUnwrapped(),t.transform.worldSize);s.cP(de,de,[1,1,d.verticalScale]);const _e=s.bz();s.cP(_e,de,[1,-1,1/z]),s.bi(_e,_e),s.ea(_e,_e),ne=cg(ae,_e),Z=t.getOrCreateProgram("building",{config:X,defines:$?D:_,overrideFog:!1}),R&&R.setupShadowsFromMatrix(de,Z,!0)}if(t.uploadCommonUniforms(w,Z,k.toUnwrapped(),null,null),C){const de=q.bloomGeometry;Z.draw(t,w.gl.TRIANGLES,d.depthMode,pi.disabled,d.blendMode,ai.disabled,ne,h.id,de.layoutVertexBuffer,de.indexBuffer,de.segmentsBucket,h.paint,t.transform.zoom,X,[de.layoutAttenuationBuffer,de.layoutColorBuffer])}else Z.draw(t,w.gl.TRIANGLES,d.depthMode,pi.disabled,d.blendMode,T?ai.disabled:ai.backCW,ne,h.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,h.paint,t.transform.zoom,X,[q.layoutNormalBuffer,q.layoutColorBuffer])}}function Ux(d){return[d[0]*s.eb,d[1]*s.eb,d[2]*s.eb,0]}function Xf(d,t,a,h,g,_,w,T,C){const R=h.getSource(),D=a.globeSharedBuffers;if(!D)return;let z,k,F;if(t&&(z=h.getTile(t)),R instanceof s.aP?(k=R.texture,F=s.dE(0,0,a.transform)):z&&t&&(k=z.texture,F=s.dE(t.canonical.z,t.canonical.x,a.transform)),!k||!F)return;d||(F=s.cP(s.bz(),F,[1,-1,1]));const q=a.context,$=q.gl,X=g.paint.get("raster-resampling")==="nearest"?$.NEAREST:$.LINEAR,Z=a.colorModeForDrapableLayerRenderPass(_),ne=w.defines;ne.push("GLOBE_POLES");const ae=new Ft($.LEQUAL,Ft.ReadWrite,a.depthRangeFor3D),de=Float32Array.from(a.transform.expandedFarZProjMatrix),_e=Float32Array.from(s.bh(s.dD(new s.cA(0,0,0))));a.terrain&&a.terrain.prepareDrawTile(),q.activeTexture.set($.TEXTURE0),k.bind(X,$.CLAMP_TO_EDGE),q.activeTexture.set($.TEXTURE1),k.bind(X,$.CLAMP_TO_EDGE),"useMipmap"in k&&q.extTextureFilterAnisotropic&&a.transform.pitch>20&&$.texParameterf($.TEXTURE_2D,q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,q.extTextureFilterAnisotropicMax);const[be,Te,ye,xe]=t?D.getPoleBuffers(t.canonical.z,!1):D.getPoleBuffers(0,!0),ve=g.paint.get("raster-elevation");let Oe;d?(Oe=be,a.renderDefaultNorthPole=ve!==0):(Oe=Te,a.renderDefaultSouthPole=ve!==0);const Pe=Ux(w.mix),Ye=((Qe,_t,Fe,Ae,qe,je,nt,st,ct,St,Ht,Qt,Lt)=>hg(Qe,_t,Fe,new Float32Array(16),new Float32Array(9),[0,0],Ae,[0,0],[0,0,0,0],1,{opacity:1,mix:0},je,[0,0],st,2,St,Ht,Qt,1,0,Lt))(de,_e,F,s.ah(a.transform.zoom),0,g,0,ve,0,Pe,w.offset,w.range,_),Ue=a.getOrCreateProgram("raster",{defines:ne});a.uploadCommonUniforms(q,Ue,null),Ue.draw(a,$.TRIANGLES,ae,C,Z,T,Ye,g.id,Oe,ye,xe)}function lb(d){const t=d._nearZ,a=d.projection.farthestPixelDistance(d),h=a-t,g=.2*d.height,_=t+g;return[t,a,(_-g-t)/h,(_-t)/h]}function cb(d,t,a,h){if(d)return t instanceof Pl&&d instanceof nu?t.getTextureDescriptor(d,a,!0):{texture:d.texture,mix:Ux(h.mix),offset:h.offset,buffer:0,tileSize:1}}var xo=s.ec([{name:"a_index",type:"Int16",components:1}]);class wg{constructor(t,a,h,g){const _={width:h[0],height:h[1],data:null},w=t.gl;this.targetColorTexture=new s.T(t,_,w.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(t,_,w.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(a,g),this.lastInvalidatedAt=0}updateParticleTexture(t,a){if(this.particleTextureDimension===a.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const h=this.context.gl,g=a.width*a.height;this.particleTexture0=new s.T(this.context,a,h.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,a,h.RGBA8,{premultiply:!1,useMipmap:!1});const _=new s.ed;_.reserve(g);for(let w=0;w<g;w++)_.emplaceBack(w);this.particleIndexBuffer=this.context.createVertexBuffer(_,xo.members,!0),this.particleSegment=s.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=a.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=s.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Ws(d,t,a){if(!d)return null;const h=t.getTextureDescriptor(d,a,!0);if(!h)return null;let{texture:g,mix:_,offset:w,tileSize:T,buffer:C,format:R}=h;if(!g||!R)return null;let D=!1;return R==="uint32"&&(D=!0,_[3]=0,_=Vf(s.ee,_,[0,a.paint.get("raster-particle-max-speed")]),w=Fl(s.ee,w,[0,a.paint.get("raster-particle-max-speed")])),{texture:g,textureOffset:[C/(T+2*C),T/(T+2*C)],tileSize:T,scalarData:D,scale:_,offset:w,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[R]]}}function $l(d){const t=d._nearZ,a=d.projection.farthestPixelDistance(d),h=a-t,g=.2*d.height,_=t+g;return[t,a,(_-g-t)/h,(_-t)/h]}const Gx=new s.am(1,0,0,1),bg=new s.am(0,1,0,1),Sg=new s.am(0,0,1,1),Tg=new s.am(1,0,1,1),$x=new s.am(0,1,1,1);function Na(d,t,a,h,g,_){for(let w=0;w<a.length;w++)if(g){const R=new s.am(h.r*.8,h.g*.8,h.b*.8,1);Pn(d,t,a[w],h,-1,-1,_),Pn(d,t,a[w],h,-1,1,_),Pn(d,t,a[w],h,1,1,_),Pn(d,t,a[w],h,1,-1,_),Pn(d,t,a[w],R,0,0,_)}else Pn(d,t,a[w],h,0,0,_)}function Pn(d,t,a,h,g,_,w){const T=d.context,C=d.transform,R=T.gl,D=C.projection.name==="globe",z=D?["PROJECTION_GLOBE_VIEW"]:[];let k=s.bw(a.projMatrix);if(D&&s.ah(C.zoom)>0){const Pe=s.bg(a.canonical,C),Ye=s.ef(Pe);k=s.az(new Float32Array(16),C.globeMatrix,Ye),s.az(k,C.projMatrix,k)}const F=s.bz();F[12]+=2*g/(s.q.devicePixelRatio*C.width),F[13]+=2*_/(s.q.devicePixelRatio*C.height),s.az(k,F,k);const q=d.getOrCreateProgram("debug",{defines:z}),$=t.getTileByID(a.key);d.terrain&&d.terrain.setupElevationDraw($,q);const X=Ft.disabled,Z=pi.disabled,ne=d.colorModeForRenderPass(),ae="$debug";T.activeTexture.set(R.TEXTURE0),d.emptyTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),D?$._makeGlobeTileDebugBuffers(d.context,C):$._makeDebugTileBoundsBuffers(d.context,C.projection);const de=$._tileDebugBuffer||d.debugBuffer,_e=$._tileDebugIndexBuffer||d.debugIndexBuffer,be=$._tileDebugSegments||d.debugSegments;if(q.draw(d,R.LINE_STRIP,X,Z,ne,ai.disabled,dg(k,h.toPremultipliedRenderColor(null)),ae,de,_e,be,null,null,null,[$._globeTileDebugBorderBuffer]),w){const Pe=$.latestRawTileData,Ye=Math.floor((Pe&&Pe.byteLength||0)/1024);let Ue=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(Ue+=` => ${a.overscaledZ}`),Ue+=` ${$.state}`,Ue+=` ${Ye}kb`,function(Qe,_t){Qe.initDebugOverlayCanvas();const Fe=Qe.debugOverlayCanvas,Ae=Qe.context.gl,qe=Qe.debugOverlayCanvas.getContext("2d");qe.clearRect(0,0,Fe.width,Fe.height),qe.shadowColor="white",qe.shadowBlur=2,qe.lineWidth=1.5,qe.strokeStyle="white",qe.textBaseline="top",qe.font="bold 36px Open Sans, sans-serif",qe.fillText(_t,5,5),qe.strokeText(_t,5,5),Qe.debugOverlayTexture.update(Fe),Qe.debugOverlayTexture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE)}(d,Ue)}const Te=t.getTile(a).tileSize,ye=512/Math.min(Te,512)*(a.overscaledZ/C.zoom)*.5,xe=$._tileDebugTextBuffer||d.debugBuffer,ve=$._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,Oe=$._tileDebugTextSegments||d.debugSegments;q.draw(d,R.TRIANGLES,X,Z,Ni.alphaBlended,ai.disabled,dg(k,s.am.transparent.toPremultipliedRenderColor(null),ye),ae,xe,ve,Oe,null,null,null,[$._globeTileDebugTextBuffer])}function mh(d,t,a,h){gh(d,0,t+a/2,d.transform.width,a,h)}function Kf(d,t,a,h){gh(d,t-a/2,0,a,d.transform.height,h)}function gh(d,t,a,h,g,_){const w=d.context,T=w.gl;T.enable(T.SCISSOR_TEST),T.scissor(t*s.q.devicePixelRatio,a*s.q.devicePixelRatio,h*s.q.devicePixelRatio,g*s.q.devicePixelRatio),w.clear({color:_}),T.disable(T.SCISSOR_TEST)}const Hx=s.ec([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:qx}=Hx;function Hl(d,t,a,h){d.emplaceBack(t,a,h)}class Mc{constructor(t){this.vertexArray=new s.eg,this.indices=new s.a_,Hl(this.vertexArray,-1,-1,1),Hl(this.vertexArray,1,-1,1),Hl(this.vertexArray,-1,1,1),Hl(this.vertexArray,1,1,1),Hl(this.vertexArray,-1,-1,-1),Hl(this.vertexArray,1,-1,-1),Hl(this.vertexArray,-1,1,-1),Hl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,qx),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=s.bd.simpleSegment(0,0,36,12)}}function ga(d,t,a,h,g,_){const w=d.context.gl,T=t.paint.get("sky-atmosphere-color"),C=t.paint.get("sky-atmosphere-halo-color"),R=t.paint.get("sky-atmosphere-sun-intensity"),D=((z,k,F,q,$)=>({u_matrix_3f:z,u_sun_direction:k,u_sun_intensity:F,u_color_tint_r:[q.r,q.g,q.b,q.a],u_color_tint_m:[$.r,$.g,$.b,$.a],u_luminance:5e-5}))(s.ei(s.dJ(),h),g,R,T.toPremultipliedRenderColor(null),C.toPremultipliedRenderColor(null));w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+_,t.skyboxTexture,0),a.draw(d,w.TRIANGLES,Ft.disabled,pi.disabled,Ni.unblended,ai.frontCW,D,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const xt=s.ec([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class kt{constructor(t){const a=new s.ej;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const h=new s.a_;h.emplaceBack(0,1,2),h.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(a,xt.members),this.indexBuffer=t.createIndexBuffer(h),this.segments=s.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Tu=s.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class xr{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Ne{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Ni([1,wc,1,wc],s.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Ni([1,0,1,0],s.am.transparent,[!1,!1,!1,!0]),this.params=new xr,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const a=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new kt(a);const h=this.params.sizeRange,g=this.params.intensityRange,_=function(D){const z=s.el(30),k=[];for(let F=0;F<D;++F){const q=2*Math.PI*z(),$=Math.acos(1-2*z())-.5*Math.PI;k.push(s.d2(Math.cos($)*Math.cos(q),Math.cos($)*Math.sin(q),Math.sin($)))}return k}(this.params.starsCount),w=s.el(300),T=new s.ek,C=new s.a_;let R=0;for(let D=0;D<_.length;++D){const z=s.c1([],_[D],200),k=Math.max(0,1+.01*h*(1*w()-.5)),F=Math.max(0,1+.01*g*(1*w()-.5));T.emplaceBack(z[0],z[1],z[2],-1,-1,k,F),T.emplaceBack(z[0],z[1],z[2],1,-1,k,F),T.emplaceBack(z[0],z[1],z[2],1,1,k,F),T.emplaceBack(z[0],z[1],z[2],-1,1,k,F),C.emplaceBack(R+0,R+1,R+2),C.emplaceBack(R+0,R+2,R+3),R+=4}this.starsVx=a.createVertexBuffer(T,Tu.members),this.starsIdx=a.createIndexBuffer(C),this.starsSegments=s.bd.simpleSegment(0,0,T.length,C.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,a){const h=t.context,g=h.gl,_=t.transform,w=new Ft(g.LEQUAL,Ft.ReadOnly,[0,1]),T=s.ah(_.zoom),C=t.style.getLut(a.scope),R=a.properties.get("color-use-theme")==="none",D=a.properties.get("color").toNonPremultipliedRenderColor(R?null:C).toArray01(),z=a.properties.get("high-color-use-theme")==="none",k=a.properties.get("high-color").toNonPremultipliedRenderColor(z?null:C).toArray01(),F=a.properties.get("space-color-use-theme")==="none",q=a.properties.get("space-color").toNonPremultipliedRenderColor(F?null:C).toArray01(),$=5e-4,X=s.em(a.properties.get("horizon-blend"),0,1,$,.25),Z=s.dy(t,h,_)&&X===$?_.worldSize/(2*Math.PI*1.025)-1:_.globeRadius,ne=t.frameCounter/1e3%1,ae=s.ae(_.globeCenterInViewSpace),de=Math.sqrt(Math.pow(ae,2)-Math.pow(Z,2)),_e=Math.acos(de/ae),be=Te=>{const ye=_.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Te&&ye.push("ALPHA_PASS");const xe=t.getOrCreateProgram("globeAtmosphere",{defines:ye}),ve=((Pe,Ye,Ue,Qe,_t,Fe,Ae,qe,je,nt,st,ct)=>({u_frustum_tl:Pe,u_frustum_tr:Ye,u_frustum_br:Ue,u_frustum_bl:Qe,u_horizon:_t,u_transition:Fe,u_fadeout_range:Ae,u_color:qe,u_high_color:je,u_space_color:nt,u_temporal_offset:st,u_horizon_angle:ct}))(_.frustumCorners.TL,_.frustumCorners.TR,_.frustumCorners.BR,_.frustumCorners.BL,_.frustumCorners.horizon,T,X,D,k,q,ne,_e);t.uploadCommonUniforms(h,xe);const Oe=this.atmosphereBuffer;Oe&&xe.draw(t,g.TRIANGLES,w,pi.disabled,Te?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,ai.backCW,ve,Te?"atmosphere_glow_alpha":"atmosphere_glow",Oe.vertexBuffer,Oe.indexBuffer,Oe.segments)};be(!1),be(!0)}drawStars(t,a){const h=s.ay(a.properties.get("star-intensity"),0,1);if(h===0)return;const g=t.context,_=g.gl,w=t.transform,T=t.getOrCreateProgram("stars"),C=s.c3([]);s.c5(C,C,-w._pitch),s.c4(C,C,-w.angle),s.c5(C,C,s.al(w._center.lat)),s.en(C,C,-s.al(w._center.lng));const R=s.c8(new Float32Array(16),C),D=s.az([],w.starsProjMatrix,R),z=s.ei([],R),k=s.eo([],z),F=[0,1,0];s.dL(F,F,k),s.c1(F,F,this.params.sizeMultiplier);const q=[1,0,0];s.dL(q,q,k),s.c1(q,q,this.params.sizeMultiplier);const $=(X=F,Z=q,ne=h,{u_matrix:Float32Array.from(D),u_up:X,u_right:Z,u_intensity_multiplier:ne});var X,Z,ne;t.uploadCommonUniforms(g,T),this.starsVx&&this.starsIdx&&T.draw(t,_.TRIANGLES,Ft.disabled,pi.disabled,this.colorModeAlphaBlendedWriteRGB,ai.disabled,$,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Wx{constructor(){this.visibleTiles=[]}updateBorders(t,a){const h=[],g=[],_=t._getRenderableCoordinates(!1,!0);for(const C of _){const R=t.getTile(C);if(!R.hasData())continue;const D=R.getBucket(a);D&&(D.isEmpty()||(h.push(C.key),g.push({bucket:D,tileID:C.canonical})))}let w=h.length!==this.visibleTiles.length;if(!w){h.sort();for(let C=0;C<h.length;C++)if(h[C]!==this.visibleTiles[C]){w=!0;break}}if(!w)return;const T=new Set;this.visibleTiles=h,g.sort((C,R)=>C.tileID.z-R.tileID.z||C.tileID.x-R.tileID.x||C.tileID.y-R.tileID.y);for(const C of g){const R=new Array,D=new Array,z=C.bucket;for(const k of z.featuresOnBorder)T.has(k.featureId)?D.push(k.footprintIndex):(T.add(k.featureId),R.push(k.footprintIndex));z.updateFootprintHiddenFlags(R,s.ep,!1),z.updateFootprintHiddenFlags(D,s.ep,!0)}}}function _h(d,t){const a=[...d],h=t.cameraWorldSizeForFog/t.worldSize,g=s.bx([]);return s.cP(g,g,[h,h,1]),s.az(a,g,a),s.az(a,t.worldToFogMatrix,a),a}function yh(d,t,a,h,g){const _=a.material,w=h.context,{baseColorTexture:T,metallicRoughnessTexture:C}=_.pbrMetallicRoughness,{normalTexture:R,occlusionTexture:D,emissionTexture:z}=_;function k(q,$,X){if(q&&(d.push($),w.activeTexture.set(w.gl.TEXTURE0+X),q.gfxTexture)){const{minFilter:Z,magFilter:ne,wrapS:ae,wrapT:de}=q.sampler;q.gfxTexture.bindExtraParam(Z,ne,ae,de)}}k(T,"HAS_TEXTURE_u_baseColorTexture",qs.BaseColor),k(C,"HAS_TEXTURE_u_metallicRoughnessTexture",qs.MetallicRoughness),k(R,"HAS_TEXTURE_u_normalTexture",qs.Normal),k(D,"HAS_TEXTURE_u_occlusionTexture",qs.Occlusion),k(z,"HAS_TEXTURE_u_emissionTexture",qs.Emission),g&&(g.texture||(g.texture=new s.et(h.context,g.image,[g.image.height,g.image.height,g.image.height],w.gl.RGBA8)),w.activeTexture.set(w.gl.TEXTURE0+qs.LUT),g.texture&&g.texture.bind(w.gl.LINEAR,w.gl.CLAMP_TO_EDGE),d.push("APPLY_LUT_ON_GPU")),a.texcoordBuffer&&(d.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(a.texcoordBuffer)),a.colorBuffer&&(d.push(a.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(a.colorBuffer)),a.normalBuffer&&(d.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(a.normalBuffer)),a.pbrBuffer&&(d.push("HAS_ATTRIBUTE_a_pbr"),d.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(a.pbrBuffer)),_.alphaMode!=="OPAQUE"&&_.alphaMode!=="MASK"||d.push("UNPREMULT_TEXTURE_IN_SHADER"),_.defined||d.push("DIFFUSE_SHADED");const F=h.shadowRenderer;F&&(d.push("RENDER_SHADOWS","DEPTH_TEXTURE"),F.useNormalOffset&&d.push("NORMAL_OFFSET"))}function Eu(d,t,a,h,g,_){const w=a.paint.get("model-opacity").constantOr(1),T=t.context,C=new Ft(t.context.gl.LEQUAL,Ft.ReadWrite,t.depthRangeFor3D),R=t.transform,D=d.mesh,z=D.material,k=z.pbrMetallicRoughness,F=t.style.fog;let q;q=t.transform.projection.zAxisUnit==="pixels"?[...d.nodeModelMatrix]:s.az([],h.zScaleMatrix,d.nodeModelMatrix),s.az(q,h.negCameraPosMatrix,q);const $=s.bi([],q);s.ea($,$);const X=a.paint.get("model-color-use-theme").constantOr("default")==="none",Z=a.paint.get("model-emissive-strength").constantOr(0),ne=pg(new Float32Array(d.worldViewProjection),new Float32Array(q),new Float32Array($),null,t,w,k.baseColorFactor,z.emissiveFactor,k.metallicFactor,k.roughnessFactor,z,Z,a),ae={defines:[]},de=[],_e=t.shadowRenderer;_e&&(_e.useNormalOffset=!1),yh(ae.defines,de,D,t,X?null:a.lut);let be=null;if(F){const xe=_h(d.nodeModelMatrix,t.transform);if(be=new Float32Array(xe),R.projection.name!=="globe"){const ve=D.aabb.min,Oe=D.aabb.max,[Pe,Ye]=F.getOpacityForBounds(xe,ve[0],ve[1],Oe[0],Oe[1]);ae.overrideFog=Pe>=it||Ye>=it}}const Te=ka(t,a.paint.get("model-cutoff-fade-range"));Te.shouldRenderCutoff&&ae.defines.push("RENDER_CUTOFF");const ye=t.getOrCreateProgram("model",ae);t.uploadCommonUniforms(T,ye,null,be,Te),t.renderPass!=="shadow"&&_e&&_e.setupShadowsFromMatrix(d.nodeModelMatrix,ye),ye.draw(t,T.gl.TRIANGLES,C,g,_,D.material.doubleSided?ai.disabled:ai.backCCW,ne,a.id,D.vertexBuffer,D.indexBuffer,D.segments,a.paint,t.transform.zoom,void 0,de)}function Eg(d,t,a,h,g,_,w){let T;T=d.projection.name==="globe"?s.er(a,d):[...a],s.az(T,T,t.matrix);const C=s.az([],h,T);if(t.meshes)for(const R of t.meshes){if(R.material.alphaMode!=="BLEND"){w.push({mesh:R,depth:0,modelIndex:g,worldViewProjection:C,nodeModelMatrix:T});continue}const D=s.ad([],R.centroid,C);!d.isOrthographic&&D[2]<=0||_.push({mesh:R,depth:D[2],modelIndex:g,worldViewProjection:C,nodeModelMatrix:T})}if(t.children)for(const R of t.children)Eg(d,R,a,h,g,_,w)}function Yf(d,t,a,h){const g=a.shadowRenderer;if(!g)return;const _=g.getShadowPassDepthMode(),w=g.getShadowPassColorMode(),T=g.calculateShadowPassMatrixFromMatrix(t),C=jx(T);a.getOrCreateProgram("modelDepth",{defines:a._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(a,a.context.gl.TRIANGLES,_,pi.disabled,w,ai.backCCW,C,h.id,d.vertexBuffer,d.indexBuffer,d.segments,h.paint,a.transform.zoom,void 0,void 0)}function Cu(d,t,a){const h=t.updateZoomBasedPaintProperties(),g=function(_,w,T){let C,R,D,z=_.terrain?_.terrain.exaggeration():0;if(_.terrain&&z>0){const k=_.terrain,F=k.findDEMTileFor(T);F&&F.dem?C=s.eu.create(k,T,F):z=0}if(z===0&&(w.terrainElevationMin=0,w.terrainElevationMax=0),z===w.validForExaggeration&&(z===0||C&&C._demTile&&C._demTile.tileID===w.validForDEMTile.id&&C._dem._timestamp===w.validForDEMTile.timestamp))return!1;for(const k in w.instancesPerModel){const F=w.instancesPerModel[k];for(let q=0;q<F.instancedDataArray.length;++q){const $=(C?z*C.getElevationAt(0|F.instancedDataArray.float32[16*q],0|F.instancedDataArray.float32[16*q+1],!0,!0):0)+F.instancesEvaluatedElevation[q];F.instancedDataArray.float32[16*q+6]=$,R=R?Math.min(w.terrainElevationMin,$):$,D=D?Math.max(w.terrainElevationMax,$):$}}return w.terrainElevationMin=R||0,w.terrainElevationMax=D||0,w.validForExaggeration=z,w.validForDEMTile=C&&C._demTile?{id:C._demTile.tileID,timestamp:C._dem._timestamp}:{id:void 0,timestamp:0},!0}(d,t,a);(h||g)&&(t.uploaded=!1,t.upload(d.context))}const La={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.d6([0,0,0],[s.aj,s.aj,0])};function ub(d,t){const a=1<<d.canonical.z,h=t.getFreeCameraOptions().position,g=t.elevation,_=d.canonical.x/a,w=(d.canonical.x+1)/a,T=d.canonical.y/a,C=(d.canonical.y+1)/a;let R=t._centerAltitude;if(g){const F=g.getMinMaxForTile(d);F&&F.max>R&&(R=F.max)}const D=s.ay(h.x,_,w)-h.x,z=s.ay(h.y,T,C)-h.y,k=s.cb(R,t.center.lat)-h.z;return t._zoomFromMercatorZ(Math.sqrt(D*D+z*z+k*k))}function Cg(d,t,a,h,g,_,w){const T=d.context,C=d.renderPass==="shadow",R=d.shadowRenderer,D=C&&R?R.getShadowPassDepthMode():new Ft(T.gl.LEQUAL,Ft.ReadWrite,d.depthRangeFor3D),z=d.isTileAffectedByFog(_);if(a.meshes)for(const k of a.meshes){const F=["MODEL_POSITION_ON_GPU"],q=[];let $,X,Z;h.instancedDataArray.length>20&&F.push("INSTANCED_ARRAYS");const ne=ka(d,t.paint.get("model-cutoff-fade-range"));if(ne.shouldRenderCutoff&&F.push("RENDER_CUTOFF"),C&&R)$=d.getOrCreateProgram("modelDepth",{defines:F}),X=jx(w.shadowTileMatrix,w.shadowTileMatrix,Float32Array.from(a.matrix)),Z=R.getShadowPassColorMode();else{yh(F,q,k,d,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),$=d.getOrCreateProgram("model",{defines:F,overrideFog:z});const de=k.material,_e=de.pbrMetallicRoughness,be=t.paint.get("model-opacity").constantOr(1),Te=t.paint.get("model-emissive-strength").constantOr(0);X=pg(_.expandedProjMatrix,Float32Array.from(a.matrix),new Float32Array(16),null,d,be,_e.baseColorFactor,de.emissiveFactor,_e.metallicFactor,_e.roughnessFactor,de,Te,t,g),R&&(w.shadowUniformsInitialized?$.setShadowUniformValues(T,R.getShadowUniformValues()):(R.setupShadows(_.toUnwrapped(),$,"model-tile"),w.shadowUniformsInitialized=!0)),Z=ne.shouldRenderCutoff||be<1||de.alphaMode!=="OPAQUE"?Ni.alphaBlended:Ni.unblended}d.uploadCommonUniforms(T,$,_.toUnwrapped(),null,ne);const ae=k.material.doubleSided?ai.disabled:ai.backCCW;if(h.instancedDataArray.length>20)q.push(h.instancedDataBuffer),$.draw(d,T.gl.TRIANGLES,D,pi.disabled,Z,ae,X,t.id,k.vertexBuffer,k.indexBuffer,k.segments,t.paint,d.transform.zoom,void 0,q,h.instancedDataArray.length);else{const de=C?"u_instance":"u_normal_matrix";for(let _e=0;_e<h.instancedDataArray.length;++_e)X[de]=new Float32Array(h.instancedDataArray.arrayBuffer,64*_e,16),$.draw(d,T.gl.TRIANGLES,D,pi.disabled,Z,ae,X,t.id,k.vertexBuffer,k.indexBuffer,k.segments,t.paint,d.transform.zoom,void 0,q)}}if(a.children)for(const k of a.children)Cg(d,t,k,h,g,_,w)}const Jf=[1,-1,1];function Ag(d,t,a,h){if(!a.modelManager)return!0;const g=a.modelManager;if(!a.shadowRenderer)return!0;const _=a.shadowRenderer,w=t.aabb;let T=!0,C=d.maxHeight;if(C===0){let D=0;for(const z in d.instancesPerModel){const k=g.getModel(z,h);k?D=Math.max(D,Math.max(Math.max(k.aabb.max[0],k.aabb.max[1]),k.aabb.max[2])):T=!1}C=d.maxScale*D*1.41+d.maxVerticalOffset,T&&(d.maxHeight=C)}w.max[2]=C,w.min[2]+=d.terrainElevationMin,w.max[2]+=d.terrainElevationMax,s.ad(w.min,w.min,t.tileMatrix),s.ad(w.max,w.max,t.tileMatrix);const R=w.intersects(_.getCurrentCascadeFrustum());return a.currentShadowCascade===0&&(d.isInsideFirstShadowMapFrustum=R===2),R===0}function Zx(d,t){const a=d.uniformValues.u_cutoff_params[0],h=d.uniformValues.u_cutoff_params[1],g=d.uniformValues.u_cutoff_params[2],_=d.uniformValues.u_cutoff_params[3];return h===a||_===g?1:s.ay(((t-a)/(h-a)-g)/(_-g),0,1)}function Xx(d,t,a,h){if(t.pitch<20)return 1;const g=t.getWorldToCameraMatrix();s.az(g,g,d);const _=s.bR(a.min[0],a.min[1],a.min[2],1);let w=s.aA(s.ev(),_,g),T=w,C=w;_[1]=a.max[1],w=s.aA(s.ev(),_,g),T=w[1]<T[1]?w:T,C=w[1]>C[1]?w:C,_[0]=a.max[0],w=s.aA(s.ev(),_,g),T=w[1]<T[1]?w:T,C=w[1]>C[1]?w:C,_[1]=a.min[1],w=s.aA(s.ev(),_,g),T=w[1]<T[1]?w:T,C=w[1]>C[1]?w:C;const R=s.ay(h[0],0,1),D=100*t.pixelsPerMeter*s.ay(h[1],0,1),z=s.ay(h[2],0,1),k=s.ew(s.ev(),T,C,R),F=Math.tan(.5*t.fovX),q=-k[2]*F;if(D===0)return k[1]<-Math.abs(q)?z:1;const $=(-Math.abs(q)-k[1])/D,X=(ne,ae,de)=>(1-de)*ne+de*ae,Z=s.ay(X(1,z,$),z,1);return X(1,Z,s.ay((t.pitch-20)/20,0,1))}class Qf{}class xh{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,a,h){{const z=this._storage.get(a.id);if(z)return z.lastUsedFrameIdx=t,z.buf}const g=h.gl,_=g.getBufferParameter(g.ELEMENT_ARRAY_BUFFER,g.BUFFER_SIZE),w=new ArrayBuffer(_),T=new Int16Array(w);g.getBufferSubData(g.ELEMENT_ARRAY_BUFFER,0,new Int16Array(w));const C=new s.ey;for(let z=0;z<_/2;z+=3){const k=T[z],F=T[z+1],q=T[z+2];C.emplaceBack(k,F),C.emplaceBack(F,q),C.emplaceBack(q,k)}const R=h.bindVertexArrayOES.current,D=new Qf;return D.buf=new Vl(h,C),D.lastUsedFrameIdx=t,this._storage.set(a.id,D),h.bindVertexArrayOES.set(R),D.buf}update(t){for(const[a,h]of this._storage)t-h.lastUsedFrameIdx>30&&(h.buf.destroy(),this._storage.delete(a))}destroy(){for(const[t,a]of this._storage)a.buf.destroy(),this._storage.delete(t)}}class Au{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Kx=s.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class db{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Os{constructor(t,a){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...a,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...a,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const hb=s.ec([{type:"Float32",name:"a_pos_2f",components:2}]);class vh{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,a){const h=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const w=new s.ez,T=new s.a_;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(1,1),w.emplaceBack(-1,1),T.emplaceBack(0,1,2),T.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(w,hb.members),this.vignetteIdx=t.context.createIndexBuffer(T)}const g=s.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,h);const w={u_vignetteShape:(_={vignetteShape:[a.start,a.range,Math.pow(10,a.fadePower)],vignetteColor:[a.color.r,a.color.g,a.color.b,a.color.a*a.strength]}).vignetteShape,u_vignetteColor:_.vignetteColor};h.draw(t,t.context.gl.TRIANGLES,Ft.disabled,pi.disabled,Ni.alphaBlended,ai.disabled,w,"vignette",this.vignetteVx,this.vignetteIdx,g)}var _}}class Xn{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,a){const h=t.getFreeCameraOptions().position,g=h.toAltitude(),_=h.toLngLat(),w=s.al(_.lng),T=s.al(_.lat),C=t.pixelsPerMeter/a,R=w*s.eB,D=s.eB*Math.log(Math.tan(Math.PI/4+T/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const z=-this._offsetYPrev+D,k=-this._elevationPrev+g;this._accumulatedOffsetX+=(-this._offsetXPrev+R)*C,this._accumulatedOffsetY+=z*C,this._accumulatedElevation+=k*C,this._offsetXPrev=R,this._offsetYPrev=D,this._elevationPrev=g}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Qi(d,t){return[-(d[0]-Math.floor(d[0]/t)*t),-(d[1]-Math.floor(d[1]/t)*t),-(d[2]-Math.floor(d[2]/t)*t)]}function Ig(d){const t=s.el(1323123451230),a=[];for(let h=0;h<d;++h){const g=2*t()-1,_=2*t()-1,w=2*t()-1;a.push(s.d2(g,_,w))}return a}function co(d,t,a,h,g){const _=s.ay((g-a)/(h-a),0,1);return(1-_)*d+_*t}class Iu{constructor(t){this._movement=new Xn,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new vh,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,a){const h=t.transform;this._movement.update(h,this._ppmScaleFactor);const g=h.starsProjMatrix,_=s.c3([]);s.c5(_,_,s.al(90)-h._pitch),s.c4(_,_,-h.angle);const w=s.c8(new Float32Array(16),_),T=s.eA(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),C=s.ea([],T),R=s.az([],C,w),D=Date.now()/1e3;return this._accumulatedTimeFromStart+=(D-this._prevTime)*a,this._prevTime=D,{projectionMatrix:g,modelviewMatrix:R}}}class Pu extends Iu{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Os(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const a=t.context;if(!this.particlesVx){const h=Ig(this.particlesCount),g=new s.eC,_=new s.a_;let w=0;const T=s.el(1323123451230);for(let C=0;C<h.length;++C){const R=h[C],D=[2*T()-1,T(),T(),T()];g.emplaceBack(R[0],R[1],R[2],-1,-1,...D),g.emplaceBack(R[0],R[1],R[2],1,-1,...D),g.emplaceBack(R[0],R[1],R[2],1,1,...D),g.emplaceBack(R[0],R[1],R[2],-1,1,...D),_.emplaceBack(w+0,w+1,w+2),_.emplaceBack(w+0,w+2,w+3),w+=4}this.particlesVx=a.createVertexBuffer(g,Kx.members),this.particlesIdx=a.createIndexBuffer(_)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const a=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},h=t.transform.zoom;if(a.revealStart>h)return;const g=co(0,1,a.revealStart,a.revealStart+a.revealRange,h);if(!this.particlesVx||!this.particlesIdx)return;const _=structuredClone(this._params);let w=[-_.direction.x,_.direction.y,-100];s.au(w,w);const T=structuredClone(this._vignetteParams);T.strength*=g,_.overrideStyleParameters||(_.intensity=t.style.rain.state.density,_.timeFactor=t.style.rain.state.intensity,_.color=structuredClone(t.style.rain.state.color),w=structuredClone(t.style.rain.state.direction),_.screenThinning.intensity=t.style.rain.state.centerThinning,_.dropletSizeX=t.style.rain.state.dropletSize[0],_.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],_.distortionStrength=100*t.style.rain.state.distortionStrength,T.strength=1,T.color=structuredClone(t.style.rain.state.vignetteColor));const C=this.updateOnRender(t,_.timeFactor),R=t.context,D=R.gl,z=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new s.T(R,{width:t.width,height:t.height,data:null},D.RGBA8)),_.distortionStrength>0&&(R.activeTexture.set(D.TEXTURE0),this.screenTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),D.copyTexSubImage2D(D.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const k=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(R,k),R.activeTexture.set(D.TEXTURE0),this.screenTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE);const F=[_.color.r,_.color.g,_.color.b,_.color.a],q=($,X)=>{const Z=Qi(this._movement.getPosition(),$),ne=_.dropletSizeX,ae=_.dropletSizeX*_.dropletSizeYScale,de=t.width/2,_e=t.height/2,be=co(0,_.screenThinning.start,0,1,_.screenThinning.intensity),Te=co(.001,_.screenThinning.range,0,1,_.screenThinning.intensity),ye=co(0,_.screenThinning.particleOffset,0,1,_.screenThinning.intensity),xe=(ve={modelview:C.modelviewMatrix,projection:C.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Z,velocityConeAperture:_.velocityConeAperture,velocity:_.velocity,boxSize:$,rainDropletSize:[ne,ae],distortionStrength:_.distortionStrength,rainDirection:w,color:F,screenSize:[z.width,z.height],thinningCenterPos:[de,_e],thinningShape:[be,Te,Math.pow(10,_.screenThinning.fadePower)],thinningAffectedRatio:_.screenThinning.affectedRatio,thinningParticleOffset:ye,shapeDirectionalPower:_.shapeDirPower,shapeNormalPower:_.shapeNormalPower,mode:X?0:1},{u_modelview:Float32Array.from(ve.modelview),u_projection:Float32Array.from(ve.projection),u_time:ve.time,u_cam_pos:ve.camPos,u_texScreen:0,u_velocityConeAperture:ve.velocityConeAperture,u_velocity:ve.velocity,u_boxSize:ve.boxSize,u_rainDropletSize:ve.rainDropletSize,u_distortionStrength:ve.distortionStrength,u_rainDirection:ve.rainDirection,u_color:ve.color,u_screenSize:ve.screenSize,u_thinningCenterPos:ve.thinningCenterPos,u_thinningShape:ve.thinningShape,u_thinningAffectedRatio:ve.thinningAffectedRatio,u_thinningParticleOffset:ve.thinningParticleOffset,u_shapeDirectionalPower:ve.shapeDirectionalPower,u_shapeNormalPower:ve.shapeNormalPower,u_mode:ve.mode});var ve;const Oe=Math.round(_.intensity*this.particlesCount),Pe=s.bd.simpleSegment(0,0,4*Oe,2*Oe);k.draw(t,D.TRIANGLES,Ft.disabled,pi.disabled,Ni.alphaBlended,ai.disabled,xe,"rain_particles",this.particlesVx,this.particlesIdx,Pe)};_.distortionStrength>0&&q(_.boxSize,!0),q(_.boxSize,!1),this._vignette.draw(t,T)}}const Rc=s.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Pg extends Iu{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Os(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const a=t.context;if(!this.particlesVx){const h=Ig(this.particlesCount),g=new s.eD,_=new s.a_;let w=0;const T=s.el(1323123451230);for(let C=0;C<h.length;++C){const R=h[C],D=T(),z=T(),k=T(),F=[C/h.length,D,z,k],q=[T(),T()];g.emplaceBack(R[0],R[1],R[2],-1,-1,...F,...q),g.emplaceBack(R[0],R[1],R[2],1,-1,...F,...q),g.emplaceBack(R[0],R[1],R[2],1,1,...F,...q),g.emplaceBack(R[0],R[1],R[2],-1,1,...F,...q),_.emplaceBack(w+0,w+1,w+2),_.emplaceBack(w+0,w+2,w+3),w+=4}this.particlesVx=a.createVertexBuffer(g,Rc.members),this.particlesIdx=a.createIndexBuffer(_)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const a=structuredClone(this._params);let h=[-a.direction.x,a.direction.y,-100];s.au(h,h);const g=structuredClone(this._vignetteParams),_=a.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},w=t.transform.zoom;if(_.revealStart>w)return;const T=co(0,1,_.revealStart,_.revealStart+_.revealRange,w);g.strength*=T,a.overrideStyleParameters||(a.intensity=t.style.snow.state.density,a.timeFactor=t.style.snow.state.intensity,a.color=structuredClone(t.style.snow.state.color),h=structuredClone(t.style.snow.state.direction),a.screenThinning.intensity=t.style.snow.state.centerThinning,a.billboardSize=2.79*t.style.snow.state.flakeSize,g.strength=1,g.color=structuredClone(t.style.snow.state.vignetteColor));const C=this.updateOnRender(t,a.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const R=t.context,D=R.gl,z=t.transform,k=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(R,k),((F,q,$)=>{const X=Qi(this._movement.getPosition(),F),Z=z.width/2,ne=z.height/2,ae=co(0,$.screenThinning.start,0,1,$.screenThinning.intensity),de=co(.001,$.screenThinning.range,0,1,$.screenThinning.intensity),_e=co(0,$.screenThinning.particleOffset,0,1,$.screenThinning.intensity),be=(Te={modelview:C.modelviewMatrix,projection:C.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:X,velocityConeAperture:$.velocityConeAperture,velocity:$.velocity,horizontalOscillationRadius:$.horizontalOscillationRadius,horizontalOscillationRate:$.horizontalOscillationRate,boxSize:F,billboardSize:1*$.billboardSize,simpleShapeParameters:[$.shapeFadeStart,$.shapeFadePower],screenSize:[z.width,z.height],thinningCenterPos:[Z,ne],thinningShape:[ae,de,Math.pow(10,$.screenThinning.fadePower)],thinningAffectedRatio:$.screenThinning.affectedRatio,thinningParticleOffset:_e,color:[$.color.r,$.color.g,$.color.b,$.color.a],direction:h},{u_modelview:Float32Array.from(Te.modelview),u_projection:Float32Array.from(Te.projection),u_time:Te.time,u_cam_pos:Te.camPos,u_velocityConeAperture:Te.velocityConeAperture,u_velocity:Te.velocity,u_horizontalOscillationRadius:Te.horizontalOscillationRadius,u_horizontalOscillationRate:Te.horizontalOscillationRate,u_boxSize:Te.boxSize,u_billboardSize:Te.billboardSize,u_simpleShapeParameters:Te.simpleShapeParameters,u_screenSize:Te.screenSize,u_thinningCenterPos:Te.thinningCenterPos,u_thinningShape:Te.thinningShape,u_thinningAffectedRatio:Te.thinningAffectedRatio,u_thinningParticleOffset:Te.thinningParticleOffset,u_particleColor:Te.color,u_direction:Te.direction});var Te;const ye=Math.round($.intensity*this.particlesCount),xe=s.bd.simpleSegment(0,0,4*ye,2*ye);this.particlesVx&&this.particlesIdx&&k.draw(t,D.TRIANGLES,Ft.disabled,pi.disabled,Ni.alphaBlended,ai.disabled,be,"snow_particles",this.particlesVx,this.particlesIdx,xe)})(a.boxSize,0,a),this._vignette.draw(t,g)}}const Mg={symbol:function(d,t,a,h,g){if(d.renderPass!=="translucent")return;const _=pi.disabled,w=d.colorModeForRenderPass(),T=a.layout.get("text-variable-anchor"),C=a.layout.get("text-size-scale-range"),R=s.ay(d.scaleFactor,C[0],C[1]);T&&function(k,F,q,$,X,Z,ne,ae){const de=F.transform,_e=X==="map",be=Z==="map";for(const Te of k){const ye=$.getTile(Te),xe=ye.getBucket(q);if(!xe||!xe.text||!xe.text.segments.get().length)continue;const ve=s.bH(xe.textSizeData,de.zoom,ae),Oe=pf(Te,xe.getProjection(),de),Pe=de.calculatePixelsToTileUnitsMatrix(ye),Ye=Kd(Oe,ye.tileID.canonical,be,_e,de,xe.getProjection(),Pe),Ue=xe.hasIconTextFit()&&xe.hasIconData();ve&&Vx(xe,_e,be,ne,de,Ye,Te,Math.pow(2,de.zoom-ye.tileID.overscaledZ),ve,Ue)}}(h,d,a,t,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),g,R);const D=a.paint.get("icon-opacity").constantOr(1)!==0,z=a.paint.get("text-opacity").constantOr(1)!==0;a.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(D||z)?xg(d,t,a,h,_,w):(D&&xg(d,t,a,h,_,w,{onlyIcons:!0}),z&&xg(d,t,a,h,_,w,{onlyText:!0})),t.map.showCollisionBoxes&&(_g(d,t,a,h,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),_g(d,t,a,h,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(d,t,a,h){if(d.renderPass!=="translucent")return;const g=a.paint.get("circle-opacity"),_=a.paint.get("circle-stroke-width"),w=a.paint.get("circle-stroke-opacity"),T=a.layout.get("circle-sort-key").constantOr(1)!==void 0,C=a.paint.get("circle-emissive-strength");if(g.constantOr(1)===0&&(_.constantOr(1)===0||w.constantOr(1)===0))return;const R=d.context,D=R.gl,z=d.transform,k=!(!d.terrain||!d.terrain.enabled),F=a.layout.get("circle-elevation-reference"),q=d.depthModeForSublayer(0,Ft.ReadOnly),$=new Ft(d.context.gl.LEQUAL,Ft.ReadOnly,d.depthRangeFor3D),X=F==="none"||k?q:$,Z=pi.disabled,ne=d.colorModeForDrapableLayerRenderPass(C),ae=z.projection.name==="globe",de=[s.aD(z.center.lng),s.aH(z.center.lat)],_e=[];for(let Te=0;Te<h.length;Te++){const ye=h[Te],xe=t.getTile(ye),ve=xe.getBucket(a);if(!ve||ve.projection.name!==z.projection.name)continue;const Oe=ve.programConfigurations.get(a.id),Pe=ve.layoutVertexBuffer,Ye=ve.globeExtVertexBuffer,Ue=ve.indexBuffer,Qe=s.dW(a),_t=[Ye],Fe=d.isTileAffectedByFog(ye);ae&&Qe.push("PROJECTION_GLOBE_VIEW"),Qe.push("DEPTH_D24"),d.terrain&&z.depthOcclusionForSymbolsAndCircles&&Qe.push("DEPTH_OCCLUSION"),ve.hasElevation&&!d.terrain&&(Qe.push("ELEVATED_ROADS"),_t.push(ve.elevatedLayoutVertexBuffer));const Ae=d.getOrCreateProgram("circle",{config:Oe,defines:Qe,overrideFog:Fe}),qe=z.projection.createInversionMatrix(z,ye.canonical),je={programConfiguration:Oe,program:Ae,layoutVertexBuffer:Pe,dynamicBuffers:_t,indexBuffer:Ue,uniformValues:s.dX(d,ye,xe,qe,de,a),tile:xe};if(T){const nt=ve.segments.get();for(const st of nt)_e.push({segments:new s.bd([st]),sortKey:st.sortKey,state:je})}else _e.push({segments:ve.segments,sortKey:0,state:je})}T&&_e.sort((Te,ye)=>Te.sortKey-ye.sortKey);const be={useDepthForOcclusion:z.depthOcclusionForSymbolsAndCircles};for(const Te of _e){const{programConfiguration:ye,program:xe,layoutVertexBuffer:ve,dynamicBuffers:Oe,indexBuffer:Pe,uniformValues:Ye,tile:Ue}=Te.state,Qe=Te.segments;d.terrain&&d.terrain.setupElevationDraw(Ue,xe,be),d.uploadCommonUniforms(R,xe,Ue.tileID.toUnwrapped()),xe.draw(d,D.TRIANGLES,X,Z,ne,ai.disabled,Ye,a.id,ve,Pe,Qe,a.paint,z.zoom,ye,Oe)}},heatmap:function(d,t,a,h){if(a.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const g=d.context,_=g.gl,w=pi.disabled,T=new Ni([_.ONE,_.ONE,_.ONE,_.ONE],s.am.transparent,[!0,!0,!0,!0]);(function(F,q,$,X){const Z=F.gl,ne=q.width*X,ae=q.height*X;F.activeTexture.set(Z.TEXTURE1),F.viewport.set([0,0,ne,ae]);let de=$.heatmapFbo;if(!de||de&&(de.width!==ne||de.height!==ae)){de&&de.destroy();const _e=Z.createTexture();Z.bindTexture(Z.TEXTURE_2D,_e),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MAG_FILTER,Z.LINEAR),de=$.heatmapFbo=F.createFramebuffer(ne,ae,!0,null),function(be,Te,ye,xe,ve,Oe){const Pe=be.gl;Pe.texImage2D(Pe.TEXTURE_2D,0,be.extRenderToTextureHalfFloat?Pe.RGBA16F:Pe.RGBA,ve,Oe,0,Pe.RGBA,be.extRenderToTextureHalfFloat?Pe.HALF_FLOAT:Pe.UNSIGNED_BYTE,null),xe.colorAttachment.set(ye)}(F,0,_e,de,ne,ae)}else Z.bindTexture(Z.TEXTURE_2D,de.colorAttachment.get()),F.bindFramebuffer.set(de.framebuffer)})(g,d,a,d.transform.projection.name==="globe"?.5:.25),g.clear({color:s.am.transparent});const C=d.transform,R=C.projection.name==="globe",D=R?["PROJECTION_GLOBE_VIEW"]:[],z=R?ai.frontCCW:ai.disabled,k=[s.aD(C.center.lng),s.aH(C.center.lat)];for(let F=0;F<h.length;F++){const q=h[F];if(t.hasRenderableParent(q))continue;const $=t.getTile(q),X=$.getBucket(a);if(!X||X.projection.name!==C.projection.name)continue;const Z=d.isTileAffectedByFog(q),ne=X.programConfigurations.get(a.id),ae=d.getOrCreateProgram("heatmap",{config:ne,defines:D,overrideFog:Z}),{zoom:de}=d.transform;d.terrain&&d.terrain.setupElevationDraw($,ae),d.uploadCommonUniforms(g,ae,q.toUnwrapped());const _e=C.projection.createInversionMatrix(C,q.canonical);ae.draw(d,_.TRIANGLES,Ft.disabled,w,T,z,Lx(d,q,$,_e,k,de,a.paint.get("heatmap-intensity")),a.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,a.paint,d.transform.zoom,ne,R?[X.globeExtVertexBuffer]:null)}g.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(g,_){const w=g.context,T=w.gl,C=_.heatmapFbo;if(!C)return;w.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,C.colorAttachment.get()),w.activeTexture.set(T.TEXTURE1);let R=_.colorRampTexture;R||(R=_.colorRampTexture=new s.T(w,_.colorRamp,T.RGBA8)),R.bind(T.LINEAR,T.CLAMP_TO_EDGE),g.getOrCreateProgram("heatmapTexture").draw(g,T.TRIANGLES,Ft.disabled,pi.disabled,g.colorModeForRenderPass(),ai.disabled,((D,z,k,F)=>({u_image:0,u_color_ramp:1,u_opacity:z.paint.get("heatmap-opacity")}))(0,_),_.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,_.paint,g.transform.zoom)}(d,a))},line:function(d,t,a,h){if(d.renderPass!=="translucent")return;const g=a.paint.get("line-opacity"),_=a.paint.get("line-width");if(g.constantOr(1)===0||_.constantOr(1)===0)return;const w=a.paint.get("line-emissive-strength"),T=a.paint.get("line-occlusion-opacity"),C=a.layout.get("line-elevation-reference"),R=a.layout.get("line-width-unit")==="meters",D=C==="sea",z=!(!d.terrain||!d.terrain.enabled),k=d.context,F=k.gl;if(a.hasElevatedBuckets&&d.transform.projection.name==="globe")return;const q=a.layout.get("line-cross-slope"),$=q!==void 0,X=q<1,Z=d.colorModeForDrapableLayerRenderPass(w),ne=d.terrain&&d.terrain.renderingToTexture,ae=ne?1:s.q.devicePixelRatio,de=a.paint.get("line-dasharray"),_e=de.constantOr(1),be=a.layout.get("line-cap"),Te=de.constantOr(null),ye=be.constantOr(null),xe=a.paint.get("line-pattern"),ve=xe.constantOr(1),Oe=a.paint.get("line-pattern-cross-fade"),Pe=xe.constantOr(null),Ye=a.paint.get("line-opacity").constantOr(1);let Ue=!ve&&Ye!==1||d.depthOcclusion&&T>0&&T<1;const Qe=a.paint.get("line-gradient"),_t=ve?"linePattern":"line",Fe=s.dY(a);let Ae;if(ne&&d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(Ue=!1),T!==0&&d.depthOcclusion){const st=a.paint._values["line-opacity"];st&&st.value&&st.value.kind==="constant"?Ae=st.value:s.w(`Occlusion opacity for layer ${a.id} is supported only when line-opacity isn't data-driven.`)}_.value.kind!=="constant"&&_.value.isLineProgressConstant===!1&&Fe.push("VARIABLE_LINE_WIDTH");const qe=(st,ct,St,Ht,Qt,Lt)=>{for(const Yt of st){const Wt=t.getTile(Yt);if(ve&&!Wt.patternsLoaded())continue;const xi=Wt.getBucket(a);if(!xi||xi.elevationType!=="none"&&!Qt||xi.elevationType==="none"&&Qt)continue;d.prepareDrawTile();const Mi=[...ct],Ui=d.shadowRenderer,cn=xi.elevationType==="road"&&!!Ui&&Ui.enabled;let Ei=[0,0,0];if(cn){const on=d.style.directionalLight,xn=d.style.ambientLight;on&&xn&&(Ei=bc(d.style,on,xn)),Mi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const un=xi.programConfigurations.get(a.id);let mn=!1;if(Pe&&Wt.imageAtlas){const on=s.dZ.from(Pe),xn=on.getPrimary().scaleSelf(ae).toString(),Ln=Wt.imageAtlas.patternPositions.get(xn),Dr=on.getSecondary(),Ir=Dr?Wt.imageAtlas.patternPositions.get(Dr.scaleSelf(ae).toString()):null;mn=!!Ln&&!!Ir,Ln&&un.setConstantPatternPositions(Ln,Ir)}Oe>0&&(mn||un.getPatternTransitionVertexBuffer("line-pattern"))&&Mi.push("LINE_PATTERN_TRANSITION");const Fn=d.isTileAffectedByFog(Yt),ji=d.getOrCreateProgram(_t,{config:un,defines:Mi,overrideFog:Fn});if(!ve&&Te&&ye&&Wt.lineAtlas){const on=Wt.lineAtlas.getDash(Te,ye);on&&un.setConstantPatternPositions(on)}cn&&Ui.setupShadows(Wt.tileID.toUnwrapped(),ji,"vector-tile");let[dn,hn]=a.paint.get("line-trim-offset");(ye==="round"||ye==="square")&&dn!==hn&&(dn===0&&(dn-=1),hn===1&&(hn+=1));const yn=ne?Yt.projMatrix:null,Gi=R?1/xi.tileToMeter/s.aw(Wt,1,d.transform.zoom):1,An=R?1/xi.tileToMeter/s.aw(Wt,1,Math.floor(d.transform.zoom)):1,gn=ve?s.d_(d,Wt,a,yn,ae,Gi,An,[dn,hn],Ei,Oe):s.d$(d,Wt,a,yn,xi.lineClipsArray.length,ae,Gi,An,[dn,hn],Ei);if(Qe){const on=xi.gradients[a.id];let xn=on.texture;if(a.gradientVersion!==on.version){let Ln=256;if(a.stepInterpolant){const Dr=t.getSource().maxzoom,Ir=Yt.canonical.z===Dr?Math.ceil(1<<d.transform.maxZoom-Yt.canonical.z):1;Ln=s.ay(s.e0(xi.maxLineLength/s.aj*1024*Ir),256,k.maxTextureSize)}on.gradient=s.e1({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:Ln,image:on.gradient||void 0,clips:xi.lineClipsArray}),on.texture?on.texture.update(on.gradient):on.texture=new s.T(k,on.gradient,F.RGBA8),on.version=a.gradientVersion,xn=on.texture}k.activeTexture.set(F.TEXTURE1),xn.bind(a.stepInterpolant?F.NEAREST:F.LINEAR,F.CLAMP_TO_EDGE)}_e&&(k.activeTexture.set(F.TEXTURE0),Wt.lineAtlasTexture&&Wt.lineAtlasTexture.bind(F.LINEAR,F.REPEAT),un.updatePaintBuffers()),ve&&(k.activeTexture.set(F.TEXTURE0),Wt.imageAtlasTexture&&Wt.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),un.updatePaintBuffers()),Qt&&!D&&d.terrain.setupElevationDraw(Wt,ji),d.uploadCommonUniforms(k,ji,Yt.toUnwrapped());const sr=on=>{Ae!=null&&(Ae.value=Ye*T),ji.draw(d,F.TRIANGLES,St,on,Z,ai.disabled,gn,a.id,xi.layoutVertexBuffer,xi.indexBuffer,xi.segments,a.paint,d.transform.zoom,un,[xi.layoutVertexBuffer2,xi.patternVertexBuffer,xi.zOffsetVertexBuffer]),Ae!=null&&(Ae.value=Ye)};if(Ue&&!Qt){const on=d.stencilModeForClipping(Yt).ref;on===0&&ne&&k.clear({stencil:0});const xn={func:F.EQUAL,mask:255};gn.u_alpha_discard_threshold=.8,sr(new pi(xn,on,255,F.KEEP,F.KEEP,F.INVERT)),gn.u_alpha_discard_threshold=0,sr(new pi(xn,on,255,F.KEEP,F.KEEP,F.KEEP))}else gn.u_alpha_discard_threshold=Ue&&Qt&&Lt?.8:0,sr(Qt?Ht:d.stencilModeForClipping(Yt))}};let je=d.depthModeForSublayer(0,Ft.ReadOnly);const nt=new Ft(d.depthOcclusion?F.GREATER:F.LEQUAL,Ft.ReadOnly,d.depthRangeFor3D);if(a.hasNonElevatedBuckets){const st=!ne&&d.terrain;T!==0&&st?s.w(`Occlusion opacity for layer ${a.id} is supported on terrain only if the layer has line-z-offset enabled.`):st?s.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${a.id}.`):qe(h,Fe,je,pi.disabled,!1,!0)}if(a.hasElevatedBuckets){C==="hd-road-markup"?z||(je=nt,Fe.push("ELEVATED_ROADS")):(Fe.push("ELEVATED"),je=nt,$&&Fe.push(X?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),D&&Fe.push("ELEVATION_REFERENCE_SEA"));const st=Ue?d.stencilModeFor3D():pi.disabled;d.forceTerrainMode=!0,qe(h,Fe,je,st,!0,!0),Ue&&qe(h,Fe,je,st,!0,!1),d.forceTerrainMode=!1}Ue&&(d.resetStencilClippingMasks(),ne&&k.clear({stencil:0})),T===0||d.depthOcclusion||ne||d.layersWithOcclusionOpacity.push(d.currentLayer)},fill:function(d,t,a,h){const g=a.paint.get("fill-color"),_=a.paint.get("fill-opacity");if(_.constantOr(1)===0)return;const w=a.paint.get("fill-emissive-strength"),T=d.colorModeForDrapableLayerRenderPass(w),C=a.paint.get("fill-pattern"),R=d.opaquePassEnabledForLayer()&&!C.constantOr(1)&&g.constantOr(s.am.transparent).a===1&&_.constantOr(0)===1?"opaque":"translucent";let D="none";a.layout.get("fill-elevation-reference")!=="none"?D="road":a.paint.get("fill-z-offset").constantOr(1)!==0&&(D="offset");const z=!(!d.terrain||!d.terrain.enabled),k={painter:d,sourceCache:t,layer:a,coords:h,colorMode:T,elevationType:D,terrainEnabled:z,pass:R};if(d.renderPass!=="shadow")if(D!=="offset"){if(qf(k,!1),D==="road"){const F=!z&&d.renderPass==="translucent";F&&Bt(d,t,a,h,"geometry"),qf(k,!0,pi.disabled),F&&function(q){const{painter:$,sourceCache:X,layer:Z,coords:ne,colorMode:ae}=q,de=$.context.gl,_e=q.painter.shadowRenderer,be=!!_e&&_e.enabled,Te=new Ft($.context.gl.LEQUAL,Ft.ReadOnly,$.depthRangeFor3D);let ye=[0,0,0];if(be){const ve=$.style.directionalLight,Oe=$.style.ambientLight;ve&&Oe&&(ye=bc($.style,ve,Oe))}const xe=ve=>{for(const Oe of ne){const Pe=X.getTile(Oe),Ye=Pe.getBucket(Z);if(!Ye)continue;const Ue=Ye.elevatedStructures;if(!Ue)continue;let Qe,_t;if(ve?(Qe=Ue.renderableBridgeSegments,_t=Ue.bridgeProgramConfigurations.get(Z.id)):(Qe=Ue.renderableTunnelSegments,_t=Ue.tunnelProgramConfigurations.get(Z.id)),!Qe||Qe.segments[0].primitiveLength===0)continue;_t.updatePaintBuffers(),$.prepareDrawTile();const Fe=$.isTileAffectedByFog(Oe),Ae=[];be&&Ae.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const qe=$.getOrCreateProgram("elevatedStructures",{config:_t,overrideFog:Fe,defines:Ae}),je=$.translatePosMatrix(Oe.projMatrix,Pe,Z.paint.get("fill-translate"),Z.paint.get("fill-translate-anchor"));be&&_e.setupShadows(Pe.tileID.toUnwrapped(),qe,"vector-tile");const nt=sb(je,ye);$.uploadCommonUniforms($.context,qe,Oe.toUnwrapped()),qe.draw($,de.TRIANGLES,Te,pi.disabled,ae,ai.backCCW,nt,Z.id,Ue.vertexBuffer,Ue.indexBuffer,Qe,Z.paint,$.transform.zoom,_t,[Ue.vertexBufferNormal])}};xe(!0),xe(!1)}(k)}}else qf(k,!1,d.stencilModeFor3D());else d.shadowRenderer&&D==="road"&&!z&&function(F){const{painter:q,sourceCache:$,layer:X,coords:Z}=F,ne=q.context.gl,ae=F.painter.shadowRenderer;for(const de of Z){const _e=$.getTile(de),be=_e.getBucket(X);if(!be)continue;const Te=be.elevatedStructures;if(!Te||!Te.shadowCasterSegments||Te.shadowCasterSegments.segments[0].primitiveLength===0)continue;q.prepareDrawTile();const ye=be.bufferData.programConfigurations.get(X.id),xe=q.isTileAffectedByFog(de),ve=q.getOrCreateProgram("elevatedStructuresDepth",{config:ye,overrideFog:xe}),Oe=ae.calculateShadowPassMatrixFromTile(_e.tileID.toUnwrapped());q.uploadCommonUniforms(q.context,ve,de.toUnwrapped());const Pe={u_matrix:Oe,u_depth_bias:0};ve.draw(q,ne.TRIANGLES,ae.getShadowPassDepthMode(),pi.disabled,ae.getShadowPassColorMode(),ai.disabled,Pe,X.id,Te.vertexBuffer,Te.indexBuffer,Te.shadowCasterSegments,X.paint,q.transform.zoom,ye)}}(k)},"fill-extrusion":function(d,t,a,h){const g=a.paint.get("fill-extrusion-opacity"),_=d.context,w=_.gl,T=d.terrain,C=T&&T.renderingToTexture;if(g===0)return;const R=d.conflationActive&&d.style.isLayerClipped(a,t.getSource()),D=d.style.order.indexOf(a.fqid);if(R&&function(z,k,F,q,$){for(const X of q){const Z=k.getTile(X).getBucket(F);Z&&(Z.updateReplacement(X,z.replacementSource,$),Z.uploadCentroid(z.context))}}(d,t,a,h,D),T||R)for(const z of h){const k=t.getTile(z).getBucket(a);k&&ci(d.context,t,z,k,a,T,R)}if(d.renderPass==="shadow"&&d.shadowRenderer){const z=d.shadowRenderer;if(T&&g<.65&&a._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.ab)return;const k=z.getShadowPassDepthMode(),F=z.getShadowPassColorMode();ph(d,t,a,h,k,pi.disabled,F,R)}else if(d.renderPass==="translucent"){const z=!a.paint.get("fill-extrusion-pattern").constantOr(1),k=a.paint.get("fill-extrusion-color").constantOr(s.am.white);if(!C&&k.a!==0){const F=new Ft(d.context.gl.LEQUAL,Ft.ReadWrite,d.depthRangeFor3D);g===1&&z?ph(d,t,a,h,F,pi.disabled,Ni.unblended,R):(ph(d,t,a,h,F,pi.disabled,Ni.disabled,R),ph(d,t,a,h,F,d.stencilModeFor3D(),d.colorModeForRenderPass(),R),d.resetStencilClippingMasks())}if(d.style.enable3dLights()&&z&&(!T&&d.transform.projection.name!=="globe"||C)){const F=a.paint.get("fill-extrusion-opacity"),q=a.paint.get("fill-extrusion-ambient-occlusion-intensity"),$=a.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),X=a.paint.get("fill-extrusion-flood-light-intensity"),Z=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ne=a.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Z?null:a.lut).toArray01().slice(0,3),ae=q>0&&$>0,de=X>0,_e=(ye,xe,ve)=>(1-ve)*ye+ve*xe,be=new il;be.translate=a.paint.get("fill-extrusion-translate"),be.translateAnchor=a.paint.get("fill-extrusion-translate-anchor"),be.edgeRadius=a.layout.get("fill-extrusion-edge-radius"),be.cutoffFadeRange=a.paint.get("fill-extrusion-cutoff-fade-range");const Te=ye=>{const xe=d.depthModeForSublayer(1,Ft.ReadOnly,w.LEQUAL,!0),ve=a.paint.get(ye?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Oe=_e(.1,3,ve),Pe=d._showOverdrawInspector;if(!Pe){const Ye=new pi({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),Ue=new Ni([w.ONE,w.ONE,w.ONE,w.ONE],s.am.transparent,[!1,!1,!1,!0],w.MIN);lo(be,d,t,a,h,xe,Ye,Ue,ai.disabled,ye,"sdf",F,q,$,X,ne,Oe,R,!1)}{const Ye=Pe?pi.disabled:new pi({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),Ue=Pe?d.colorModeForRenderPass():new Ni([w.ONE_MINUS_DST_ALPHA,w.DST_ALPHA,w.ONE,w.ONE],s.am.transparent,[!0,!0,!0,!0]);lo(be,d,t,a,h,xe,Ye,Ue,ai.disabled,ye,"color",F,q,$,X,ne,Oe,R,!1)}};if(C){const ye=(xe,ve,Oe)=>{const Pe=d.depthModeForSublayer(1,Ft.ReadOnly,w.LEQUAL,!1),Ye=a.paint.get(xe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ue=_e(.1,3,Ye);{const Qe=new Ni([w.ONE,w.ONE,w.ONE,w.ONE],s.am.transparent,[!1,!1,!1,!0]);lo(be,d,t,a,h,Pe,pi.disabled,Qe,ai.disabled,xe,"clear",F,q,$,X,ne,Ue,R,ve)}{const Qe=new pi({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),_t=new Ni([w.ONE,w.ONE,w.ONE,w.ONE],s.am.transparent,[!1,!1,!1,!0],w.MIN);lo(be,d,t,a,h,Pe,Qe,_t,ai.disabled,xe,"sdf",F,q,$,X,ne,Ue,R,ve)}{const Qe=xe?w.ZERO:w.ONE_MINUS_DST_ALPHA,_t=new pi({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),Fe=new Ni([Qe,w.DST_ALPHA,w.ONE_MINUS_DST_ALPHA,w.ZERO],s.am.transparent,[!0,!0,!0,!0]);lo(be,d,t,a,h,Pe,_t,Fe,ai.disabled,xe,"color",F,q,$,X,ne,Ue,R,ve)}{const Qe=new Ni([w.ONE,w.ONE,w.ONE,xe?w.ZERO:w.ONE],s.am.transparent,[!1,!1,!1,!0],xe?w.FUNC_ADD:w.MAX);lo(be,d,t,a,h,Pe,pi.disabled,Qe,ai.disabled,xe,"clear",F,q,$,X,ne,Ue,R,ve,Oe)}};if(ae||de){let xe;if(d.prepareDrawTile(),T){const ve=T.drapeBufferSize[0],Oe=T.drapeBufferSize[1];xe=T.framebufferCopyTexture,xe&&(!xe||xe.size[0]===ve&&xe.size[1]===Oe)||(xe&&xe.destroy(),xe=T.framebufferCopyTexture=new s.T(_,new s.r({width:ve,height:Oe}),w.RGBA8)),xe.bind(w.LINEAR,w.CLAMP_TO_EDGE),w.copyTexSubImage2D(w.TEXTURE_2D,0,0,0,0,0,ve,Oe)}ae&&ye(!0,!1,xe),de&&ye(!1,!0,xe)}}else ae&&Te(!0),de&&Te(!1),(ae||de)&&d.resetStencilClippingMasks()}}},building:function(d,t,a,h){d.currentLayer<d.firstLightBeamLayer&&(d.firstLightBeamLayer=d.currentLayer);const g=a.paint.get("building-ambient-occlusion-ground-intensity"),_=a.paint.get("building-ambient-occlusion-ground-radius"),w=a.paint.get("building-ambient-occlusion-ground-attenuation");let T=g>0&&_>0,C=!0;const R=a.paint.get("building-vertical-scale");R<1&&(C=!1);const D=d.conflationActive&&d.style.isLayerClipped(a,t.getSource()),z=d.style.order.indexOf(a.fqid);if(function(k,F,q,$,X,Z){for(const ne of Z){const ae=F.getTile(ne).getBucket(q);ae&&(X&&ae.updateReplacement(ne,k.replacementSource,$),ae.uploadUpdatedIndexBuffer(k.context))}}(d,t,a,z,D,h),function(k,F,q,$){for(const X of $){const Z=F.getTile(X).getBucket(q);Z&&Z.needsEvaluation(k,q)&&(Z.evaluate(q),Z.uploadUpdatedColorBuffer(k.context))}}(d,t,a,h),a.resetLayerRenderingStats(d),d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!0),d.renderPass==="shadow"&&d.shadowRenderer){const k=d.shadowRenderer,F=[],q=k.getShadowPassDepthMode();Zf({painter:d,source:t,layer:a,coords:h,defines:F,blendMode:k.getShadowPassColorMode(),depthMode:q,verticalScale:R})}else if(d.renderPass==="translucent"){T&&function($,X,Z,ne,ae,de,_e,be,Te,ye,xe,ve,Oe){const Pe=$.context.gl,Ye=$.depthModeForSublayer(1,Ft.ReadOnly,Pe.LEQUAL,!0),Ue=.1*(1-(Qe=xe))+3*Qe;var Qe;const _t=$._showOverdrawInspector,Fe=ve,Ae=new il;_t||lo(Ae,$,X,Z,ne,Ye,new pi({func:Pe.ALWAYS,mask:255},255,255,Pe.KEEP,Pe.KEEP,Pe.REPLACE),new Ni([Pe.ONE,Pe.ONE,Pe.ONE,Pe.ONE],s.am.transparent,[!1,!1,!1,!0],Pe.MIN),ai.disabled,ae,"sdf",1,_e,be,0,ye,Ue,Fe,!1);{const qe=_t?pi.disabled:new pi({func:Pe.EQUAL,mask:255},255,255,Pe.KEEP,Pe.DECR,Pe.DECR),je=_t?$.colorModeForRenderPass():new Ni([Pe.ONE_MINUS_DST_ALPHA,Pe.DST_ALPHA,Pe.ONE,Pe.ONE],s.am.transparent,[!0,!0,!0,!0]);lo(Ae,$,X,Z,ne,Ye,qe,je,ai.disabled,ae,"color",1,_e,be,0,ye,Ue,Fe,!1)}}(d,t,a,h,!0,0,g,_,0,[0,0,0],w,D);let k=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];C&&(k=k.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),d.shadowRenderer.useNormalOffset&&(k=k.concat("NORMAL_OFFSET"));const F=new Ft(d.context.gl.LEQUAL,Ft.ReadWrite,d.depthRangeFor3D),q=d.colorModeForRenderPass();Zf({painter:d,source:t,layer:a,coords:h,defines:k,blendMode:q,depthMode:F,verticalScale:R})}else if(d.renderPass==="light-beam"){const k=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],F=new Ft(d.context.gl.LEQUAL,Ft.ReadOnly,d.depthRangeFor3D);Zf({painter:d,source:t,layer:a,coords:h,defines:k,blendMode:Ni.alphaBlended,depthMode:F,verticalScale:R})}d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!1),d.resetStencilClippingMasks()},hillshade:function(d,t,a,h){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent"||d.style.disableElevatedTerrain)return;const g=d.context,_=d.terrain&&d.terrain.renderingToTexture,[w,T]=d.renderPass!=="translucent"||_?[{},h]:d.stencilConfigForOverlap(h);for(const C of T){const R=t.getTile(C);if(R.needsHillshadePrepare&&d.renderPass==="offscreen")xx(d,R,a);else if(d.renderPass==="translucent"){const D=d.depthModeForSublayer(0,Ft.ReadOnly),z=a.paint.get("hillshade-emissive-strength"),k=d.colorModeForDrapableLayerRenderPass(z),F=_&&d.terrain?d.terrain.stencilModeForRTTOverlap(C):w[C.overscaledZ];Xw(d,C,R,a,D,F,k)}}g.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,t,a,h,g,_){if(d.renderPass!=="translucent"||a.paint.get("raster-opacity")===0)return;const w=d.transform.projection.name==="globe",T=a.paint.get("raster-elevation")!==0,C=T&&w;if(d.renderElevatedRasterBackface&&!C)return;const R=d.context,D=R.gl,z=t.getSource(),k=function(be,Te,ye,xe){const ve=Te.paint.get("raster-color"),Oe=be.type==="raster-array",Pe=[],Ye=Te.paint.get("raster-resampling"),Ue=Te.paint.get("raster-color-mix");let Qe=Te.paint.get("raster-color-range");const _t=[Ue[0],Ue[1],Ue[2],0],Fe=Ue[3];let Ae=Ye==="nearest"?xe.NEAREST:xe.LINEAR;if(Oe&&(Pe.push("RASTER_ARRAY"),ve||Pe.push("RASTER_COLOR"),Ye==="linear"&&Pe.push("RASTER_ARRAY_LINEAR"),Ae=xe.NEAREST,!Qe&&be.rasterLayers)){const qe=be.rasterLayers.find(({id:je})=>je===Te.sourceLayer);qe&&qe.fields&&qe.fields.range&&(Qe=qe.fields.range)}if(Qe=Qe||[0,1],ve){Pe.push("RASTER_COLOR"),ye.activeTexture.set(xe.TEXTURE2),Te.updateColorRamp(Qe);let qe=Te.colorRampTexture;qe||(qe=Te.colorRampTexture=new s.T(ye,Te.colorRamp,xe.RGBA8)),qe.bind(xe.LINEAR,xe.CLAMP_TO_EDGE)}return{mix:_t,range:Qe,offset:Fe,defines:Pe,resampling:Ae}}(z,a,R,D);if(z instanceof s.aP&&!h.length&&!w)return;const F=a.paint.get("raster-emissive-strength"),q=d.colorModeForDrapableLayerRenderPass(F),$=d.terrain&&d.terrain.renderingToTexture,X=!d.options.moving,Z=a.paint.get("raster-resampling")==="nearest"?D.NEAREST:D.LINEAR;if(z instanceof s.aP&&!h.length&&(z.onNorthPole||z.onSouthPole)){const be=T?d.stencilModeFor3D():pi.disabled;return void Xf(!!z.onNorthPole,null,d,t,a,F,k,ai.disabled,be)}if(!h.length)return;const[ne,ae]=z instanceof s.aP||$?[{},h]:d.stencilConfigForOverlap(h),de=ae[ae.length-1].overscaledZ;C&&k.defines.push("PROJECTION_GLOBE_VIEW"),T&&k.defines.push("RENDER_CUTOFF");const _e=(be,Te,ye)=>{for(const xe of be){const ve=xe.toUnwrapped(),Oe=t.getTile(xe);if($&&(!Oe||!Oe.hasData()))continue;R.activeTexture.set(D.TEXTURE0);const Pe=cb(Oe,z,a,k);if(!Pe||!Pe.texture)continue;const{texture:Ye,mix:Ue,offset:Qe,tileSize:_t,buffer:Fe}=Pe;let Ae,qe;$?(Ae=Ft.disabled,qe=xe.projMatrix):T?(Ae=new Ft(D.LEQUAL,Ft.ReadWrite,d.depthRangeFor3D),qe=w?Float32Array.from(d.transform.expandedFarZProjMatrix):d.transform.calculateProjMatrix(ve,X)):(Ae=d.depthModeForSublayer(xe.overscaledZ-de,a.paint.get("raster-opacity")===1?Ft.ReadWrite:Ft.ReadOnly,D.LESS),qe=d.transform.calculateProjMatrix(ve,X));const je=d.terrain&&$?d.terrain.stencilModeForRTTOverlap(xe):ne[xe.overscaledZ],nt=_?0:a.paint.get("raster-fade-duration");Oe.registerFadeDuration(nt);const st=t.findLoadedParent(xe,0),ct=ao(Oe,st,t,d.transform,nt);let St,Ht;d.terrain&&d.terrain.prepareDrawTile(),R.activeTexture.set(D.TEXTURE0),Ye.bind(Z,D.CLAMP_TO_EDGE),R.activeTexture.set(D.TEXTURE1),st?(st.texture&&st.texture.bind(Z,D.CLAMP_TO_EDGE),St=Math.pow(2,st.tileID.overscaledZ-Oe.tileID.overscaledZ),Ht=[Oe.tileID.canonical.x*St%1,Oe.tileID.canonical.y*St%1]):Ye.bind(Z,D.CLAMP_TO_EDGE),"useMipmap"in Ye&&R.extTextureFilterAnisotropic&&d.transform.pitch>20&&D.texParameterf(D.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax);const Qt=d.transform;let Lt;const Yt=T?lb(Qt):[0,0,0,0];let Wt,xi,Mi,Ui,cn,Ei=0;if(C&&z instanceof s.aP&&z.coordinates.length>3)Wt=Float32Array.from(s.bh(s.dD(new s.cA(0,0,0)))),xi=Float32Array.from(Qt.globeMatrix),Mi=Float32Array.from(s.dz(Qt)),Ui=[s.aD(Qt.center.lng),s.aH(Qt.center.lat)],Lt=z.elevatedGlobePerspectiveTransform,cn=z.elevatedGlobeGridMatrix||new Float32Array(9);else if(C){const ji=s.dA(xe.canonical);Ei=s.dB(ji.getCenter().lat),Wt=Float32Array.from(s.bh(s.dD(xe.canonical))),xi=Float32Array.from(Qt.globeMatrix),Mi=Float32Array.from(s.dz(Qt)),Ui=[s.aD(Qt.center.lng),s.aH(Qt.center.lat)],Lt=[0,0],cn=Float32Array.from(s.dC(xe.canonical,ji,Ei,Qt.worldSize/Qt._pixelsPerMercatorPixel))}else Lt=z instanceof s.aP?z.perspectiveTransform:[0,0],Wt=new Float32Array(16),xi=new Float32Array(9),Mi=new Float32Array(16),Ui=[0,0],cn=new Float32Array(9);const un=hg(qe,Wt,xi,Mi,cn,Ht||[0,0],s.ah(d.transform.zoom),Ui,Yt,St||1,ct,a,Lt,T?a.paint.get("raster-elevation"):0,2,Ue,Qe,k.range,_t,Fe,F),mn=d.isTileAffectedByFog(xe),Fn=d.getOrCreateProgram("raster",{defines:k.defines,overrideFog:mn});if(d.uploadCommonUniforms(R,Fn,ve),z instanceof s.aP){const ji=z.elevatedGlobeVertexBuffer,dn=z.elevatedGlobeIndexBuffer;if($||!w)z.boundsBuffer&&z.boundsSegments&&Fn.draw(d,D.TRIANGLES,Ae,pi.disabled,q,ai.disabled,un,a.id,z.boundsBuffer,d.quadTriangleIndexBuffer,z.boundsSegments);else if(ji&&dn){const hn=Qt.zoom<=s.cX?z.elevatedGlobeSegments:z.getSegmentsForLongitude(Qt.center.lng);hn&&Fn.draw(d,D.TRIANGLES,Ae,pi.disabled,q,Te,un,a.id,ji,dn,hn)}}else if(C){Ae=new Ft(D.LEQUAL,Ft.ReadOnly,d.depthRangeFor3D);const ji=d.globeSharedBuffers;if(ji){const[dn,hn,yn]=ji.getGridBuffers(Ei,!1);Fn.draw(d,D.TRIANGLES,Ae,ye||je,d.colorModeForRenderPass(),Te,un,a.id,dn,hn,yn)}}else{const{tileBoundsBuffer:ji,tileBoundsIndexBuffer:dn,tileBoundsSegments:hn}=d.getTileBoundsBuffers(Oe);Fn.draw(d,D.TRIANGLES,Ae,je,q,ai.disabled,un,a.id,ji,dn,hn)}}if(!(z instanceof s.aP)&&C)for(const xe of be){const ve=xe.canonical.y===(1<<xe.canonical.z)-1;xe.canonical.y===0&&Xf(!0,xe,d,t,a,F,k,Te,ye||pi.disabled),ve&&Xf(!1,xe,d,t,a,F,k,Te===ai.frontCW?ai.backCW:ai.frontCW,ye||pi.disabled)}};C?_e(ae,d.renderElevatedRasterBackface?ai.backCW:ai.frontCW,d.stencilModeFor3D()):_e(ae,ai.disabled,void 0),d.resetStencilClippingMasks()},"raster-particle":function(d,t,a,h,g,_){d.renderPass==="offscreen"&&function(w,T,C,R){if(!R.length)return;const D=w.context,z=D.gl,k=T.getSource();if(!(k instanceof Pl))return;const F=Math.ceil(Math.sqrt(C.paint.get("raster-particle-count")));let q=C.particlePositionRGBAImage;if(!q||q.width!==F){const ae=function(de){const _e=de*de,be=new Uint8Array(4*_e),Te=function(xe){return xe|=0,xe=Math.imul(2747636419^xe,2654435769),xe=Math.imul(xe^xe>>>16,2654435769),((xe=Math.imul(xe^xe>>>16,2654435769))>>>0)/4294967296},ye=1/1.1;for(let xe=0;xe<_e;xe++){const ve=ye*(Te(2*xe+0)+Bl),Oe=ye*(Te(2*xe+1)+Bl),Pe=255*ve%1,Ye=255*Oe%1,Ue=Pe,Qe=Oe-Ye/255,_t=Ye;be[4*xe+0]=255*(ve-Pe/255),be[4*xe+1]=255*Ue,be[4*xe+2]=255*Qe,be[4*xe+3]=255*_t}return be}(F);q=C.particlePositionRGBAImage=new s.r({width:F,height:F},ae)}let $=C.particleFramebuffer;$?$.width!==F&&($.destroy(),$=C.particleFramebuffer=D.createFramebuffer(F,F,!0,null)):$=C.particleFramebuffer=D.createFramebuffer(F,F,!0,null);const X=[];for(const ae of R){const de=T.getTile(ae);if(!(de instanceof nu))continue;const _e=Ws(de,k,C);if(!_e)continue;const be=[de.tileSize,de.tileSize];let Te=C.tileFramebuffer;Te||(Te=C.tileFramebuffer=D.createFramebuffer(be[0],be[1],!0,null));let ye=de.rasterParticleState;ye||(ye=de.rasterParticleState=new wg(D,ae,be,q));const xe=ye.update(C.lastInvalidatedAt);ye.particleTextureDimension!==F&&ye.updateParticleTexture(ae,q);const ve=ye.targetColorTexture;ye.targetColorTexture=ye.backgroundColorTexture,ye.backgroundColorTexture=ve;const Oe=ye.particleTexture0;ye.particleTexture0=ye.particleTexture1,ye.particleTexture1=Oe,X.push([ae,_e,ye,xe])}if(X.length===0)return;const Z=s.q.now(),ne=C.previousDrawTimestamp?.001*(Z-C.previousDrawTimestamp):.0167;if(C.previousDrawTimestamp=Z,C.hasColorMap()){D.activeTexture.set(z.TEXTURE0+2);let ae=C.colorRampTexture;ae||(ae=C.colorRampTexture=new s.T(D,C.colorRamp,z.RGBA8)),ae.bind(z.LINEAR,z.CLAMP_TO_EDGE)}D.bindFramebuffer.set(C.tileFramebuffer.framebuffer),function(ae,de,_e){const be=ae.context,Te=be.gl,ye=de.tileFramebuffer;be.activeTexture.set(Te.TEXTURE0);const xe={u_texture:0,u_opacity:1.05*(Oe=de.paint.get("raster-particle-fade-opacity-factor"))/(Oe+.05)},ve=ae.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Oe;for(const Pe of _e){const[,,Ye,Ue]=Pe;ye.colorAttachment.set(Ye.targetColorTexture.texture),be.viewport.set([0,0,ye.width,ye.height]),be.clear({color:s.am.transparent}),Ue&&(Ye.backgroundColorTexture.bind(Te.NEAREST,Te.CLAMP_TO_EDGE),ve.draw(ae,Te.TRIANGLES,Ft.disabled,pi.disabled,Ni.alphaBlended,ai.disabled,xe,de.id,ae.viewportBuffer,ae.quadTriangleIndexBuffer,ae.viewportSegments))}}(w,C,X),function(ae,de,_e,be){const Te=ae.context,ye=Te.gl,xe=_e.tileFramebuffer,ve=ae.transform.projection.name==="globe",Oe=_e.paint.get("raster-particle-max-speed");for(const Pe of be){const[Ye,Ue,Qe]=Pe;Te.activeTexture.set(ye.TEXTURE0+0),Ue.texture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),xe.colorAttachment.set(Qe.targetColorTexture.texture);const _t=ae.getOrCreateProgram("rasterParticleDraw",{defines:Ue.defines,overrideFog:!1});Te.activeTexture.set(ye.TEXTURE0+1);const Fe=Ue.scalarData?[]:[0,1,2,3].map(je=>s.e3[je](Ye));Fe.push(Ye);const Ae=Ye.canonical.x,qe=Ye.canonical.y;for(const je of Fe){const nt=de.getTile(ve?je.wrapped():je);if(!nt)continue;const st=nt.rasterParticleState;if(!st)continue;const ct=je.canonical.x+(1<<je.canonical.z)*(je.wrap-Ye.wrap),St=je.canonical.y;st.particleTexture0.bind(ye.NEAREST,ye.CLAMP_TO_EDGE);const Ht=zx(1,st.particleTexture0.size[0],[ct-Ae,St-qe],0,Ue.texture.size,2,Oe,Ue.textureOffset,Ue.scale,Ue.offset);_t.draw(ae,ye.POINTS,Ft.disabled,pi.disabled,Ni.alphaBlended,ai.disabled,Ht,_e.id,st.particleIndexBuffer,void 0,st.particleSegment)}}}(w,T,C,X),D.bindFramebuffer.set(C.particleFramebuffer.framebuffer),function(ae,de,_e,be){const Te=ae.context,ye=Te.gl,xe=de.paint.get("raster-particle-max-speed"),ve=be*de.paint.get("raster-particle-speed-factor")*.15,Oe=function(Ye){return Math.pow(Ye,6)}(.01+1*de.paint.get("raster-particle-reset-rate-factor")),Pe=de.particleFramebuffer;Te.viewport.set([0,0,Pe.width,Pe.height]);for(const Ye of _e){const[,Ue,Qe]=Ye;Te.activeTexture.set(ye.TEXTURE0+0),Ue.texture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),Te.activeTexture.set(ye.TEXTURE0+1);const _t=Qe.particleTexture0;_t.bind(ye.NEAREST,ye.CLAMP_TO_EDGE);const Fe=Ox(1,_t.size[0],0,Ue.texture.size,xe,ve,Oe,Ue.textureOffset,Ue.scale,Ue.offset);Pe.colorAttachment.set(Qe.particleTexture1.texture),Te.clear({color:s.am.transparent}),ae.getOrCreateProgram("rasterParticleUpdate",{defines:Ue.defines}).draw(ae,ye.TRIANGLES,Ft.disabled,pi.disabled,Ni.unblended,ai.disabled,Fe,de.id,ae.viewportBuffer,ae.quadTriangleIndexBuffer,ae.viewportSegments)}}(w,C,X,ne)}(d,t,a,h),d.renderPass==="translucent"&&(function(w,T,C,R,D){const z=w.context,k=z.gl,F=T.getSource().tileSize,q=5*(1-s.af(s.cI,s.cI+1,w.transform.zoom))*F+C.paint.get("raster-particle-elevation"),$=!w.options.moving,X=w.transform.projection.name==="globe";if(!R.length)return;const[Z,ne]=w.stencilConfigForOverlap(R),ae=[];X&&ae.push("PROJECTION_GLOBE_VIEW");const de=w.stencilModeFor3D();for(const _e of ne){const be=_e.toUnwrapped(),Te=T.getTile(_e);if(!Te.rasterParticleState)continue;const ye=Te.rasterParticleState,xe=100;Te.registerFadeDuration(xe);const ve=T.findLoadedParent(_e,0),Oe=ao(Te,ve,T,w.transform,xe);let Pe,Ye;w.terrain&&w.terrain.prepareDrawTile(),z.activeTexture.set(k.TEXTURE0),ye.targetColorTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),z.activeTexture.set(k.TEXTURE1),ve&&ve.rasterParticleState?(ve.rasterParticleState.targetColorTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Pe=Math.pow(2,ve.tileID.overscaledZ-Te.tileID.overscaledZ),Ye=[Te.tileID.canonical.x*Pe%1,Te.tileID.canonical.y*Pe%1]):ye.targetColorTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE);const Ue=X?Float32Array.from(w.transform.expandedFarZProjMatrix):w.transform.calculateProjMatrix(be,$),Qe=w.transform,_t=$l(Qe),Fe=s.dA(_e.canonical),Ae=s.dB(Fe.getCenter().lat);let qe,je,nt,st,ct;X?(qe=Float32Array.from(s.bh(s.dD(_e.canonical))),je=Float32Array.from(Qe.globeMatrix),nt=Float32Array.from(s.dz(Qe)),st=[s.aD(Qe.center.lng),s.aH(Qe.center.lat)],ct=Float32Array.from(s.dC(_e.canonical,Fe,Ae,Qe.worldSize/Qe._pixelsPerMercatorPixel))):(qe=new Float32Array(16),je=new Float32Array(9),nt=new Float32Array(16),st=[0,0],ct=new Float32Array(9));const St=Uf(Ue,qe,je,nt,ct,Ye||[0,0],s.ah(w.transform.zoom),st,_t,Pe||1,Oe,q),Ht=w.isTileAffectedByFog(_e),Qt=w.getOrCreateProgram("rasterParticle",{defines:ae,overrideFog:Ht});if(w.uploadCommonUniforms(z,Qt,be),X){const Lt=new Ft(k.LEQUAL,Ft.ReadOnly,w.depthRangeFor3D),Yt=0,Wt=w.globeSharedBuffers;if(Wt){const[xi,Mi,Ui]=Wt.getGridBuffers(Ae,Yt!==0);Qt.draw(w,k.TRIANGLES,Lt,de,Ni.alphaBlended,w.renderElevatedRasterBackface?ai.frontCCW:ai.backCCW,St,C.id,xi,Mi,Ui)}}else{const Lt=w.depthModeForSublayer(0,Ft.ReadOnly),Yt=Z[_e.overscaledZ],{tileBoundsBuffer:Wt,tileBoundsIndexBuffer:xi,tileBoundsSegments:Mi}=w.getTileBoundsBuffers(Te);Qt.draw(w,k.TRIANGLES,Lt,Yt,Ni.alphaBlended,ai.disabled,St,C.id,Wt,xi,Mi)}}w.resetStencilClippingMasks()}(d,t,a,h),d.style.map.triggerRepaint())},background:function(d,t,a,h){const g=a.paint.get("background-color"),_=a.paint.get("background-color-use-theme").constantOr("default")==="none",w=a.paint.get("background-opacity"),T=a.paint.get("background-emissive-strength"),C=a.paint.get("background-pitch-alignment")==="viewport";if(w===0)return;const R=d.context,D=R.gl,z=d.transform,k=z.tileSize,F=a.paint.get("background-pattern");let q;if(F!==void 0&&(F===null||(q=d.imageManager.getPattern(s.I.from(F.toString()),a.scope,d.style.getLut(a.scope)),!q)))return;const $=!F&&g.a===1&&w===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==$)return;const X=pi.disabled,Z=d.depthModeForSublayer(0,$==="opaque"?Ft.ReadWrite:Ft.ReadOnly),ne=d.colorModeForDrapableLayerRenderPass(T),ae=F?"backgroundPattern":"background";let de,_e=h;if(_e||(de=d.getBackgroundTiles(),_e=Object.values(de).map(be=>be.tileID)),F&&(R.activeTexture.set(D.TEXTURE0),d.imageManager.bind(d.context,a.scope)),C){const be=d.getOrCreateProgram(ae,{overrideFog:!1,overrideRtt:!0}),Te=new Float32Array(s.bx([])),ye=new s.aM(0,0,0,0,0),xe=F?fg(Te,T,w,d,0,a.scope,q,C,{tileID:ye,tileSize:k}):Fx(Te,T,w,g.toPremultipliedRenderColor(_?null:a.lut));be.draw(d,D.TRIANGLES,Z,X,ne,ai.disabled,xe,a.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments)}else for(const be of _e){const Te=d.isTileAffectedByFog(be),ye=d.getOrCreateProgram(ae,{overrideFog:Te}),xe=be.toUnwrapped(),ve=h?be.projMatrix:d.transform.calculateProjMatrix(xe);d.prepareDrawTile();const Oe=t?t.getTile(be):de?de[be.key]:new mc(be,k,z.zoom,d),Pe=F?fg(ve,T,w,d,0,a.scope,q,C,{tileID:be,tileSize:k}):Fx(ve,T,w,g.toPremultipliedRenderColor(_?null:a.lut));d.uploadCommonUniforms(R,ye,xe);const{tileBoundsBuffer:Ye,tileBoundsIndexBuffer:Ue,tileBoundsSegments:Qe}=d.getTileBoundsBuffers(Oe);ye.draw(d,D.TRIANGLES,Z,X,ne,ai.disabled,Pe,a.id,Ye,Ue,Qe)}},sky:function(d,t,a){const h=d._atmosphere?s.ah(d.transform.zoom):1,g=a.paint.get("sky-opacity")*h;if(g===0)return;const _=d.context,w=a.paint.get("sky-type"),T=new Ft(_.gl.LEQUAL,Ft.ReadOnly,[0,1]),C=d.frameCounter/1e3%1;w==="atmosphere"?d.renderPass==="offscreen"?a.needsSkyboxCapture(d)&&(function(R,D,z,k){const F=R.context,q=F.gl;let $=D.skyboxFbo;if(!$){$=D.skyboxFbo=F.createFramebuffer(32,32,!0,null),D.skyboxGeometry=new Mc(F),D.skyboxTexture=F.gl.createTexture(),q.bindTexture(q.TEXTURE_CUBE_MAP,D.skyboxTexture),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MAG_FILTER,q.LINEAR);for(let ae=0;ae<6;++ae)q.texImage2D(q.TEXTURE_CUBE_MAP_POSITIVE_X+ae,0,q.RGBA,32,32,0,q.RGBA,q.UNSIGNED_BYTE,null)}F.bindFramebuffer.set($.framebuffer),F.viewport.set([0,0,32,32]);const X=D.getCenter(R,!0),Z=R.getOrCreateProgram("skyboxCapture"),ne=new Float64Array(16);s.bx(ne),s.eh(ne,ne,.5*-Math.PI),ga(R,D,Z,ne,X,0),s.bx(ne),s.eh(ne,ne,.5*Math.PI),ga(R,D,Z,ne,X,1),s.bx(ne),s.cR(ne,ne,.5*-Math.PI),ga(R,D,Z,ne,X,2),s.bx(ne),s.cR(ne,ne,.5*Math.PI),ga(R,D,Z,ne,X,3),s.bx(ne),ga(R,D,Z,ne,X,4),s.bx(ne),s.eh(ne,ne,Math.PI),ga(R,D,Z,ne,X,5),F.viewport.set([0,0,R.width,R.height])}(d,a),a.markSkyboxValid(d)):d.renderPass==="sky"&&function(R,D,z,k,F){const q=R.context,$=q.gl,X=R.transform,Z=R.getOrCreateProgram("skybox");q.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_CUBE_MAP,D.skyboxTexture);const ne=((ae,de,_e,be,Te)=>({u_matrix:ae,u_sun_direction:de,u_cubemap:0,u_opacity:be,u_temporal_offset:Te}))(X.skyboxMatrix,D.getCenter(R,!1),0,k,F);R.uploadCommonUniforms(q,Z),Z.draw(R,$.TRIANGLES,z,pi.disabled,R.colorModeForRenderPass(),ai.backCW,ne,"skybox",D.skyboxGeometry.vertexBuffer,D.skyboxGeometry.indexBuffer,D.skyboxGeometry.segment)}(d,a,T,g,C):w==="gradient"&&d.renderPass==="sky"&&function(R,D,z,k,F){const q=R.context,$=q.gl,X=R.transform,Z=R.getOrCreateProgram("skyboxGradient");D.skyboxGeometry||(D.skyboxGeometry=new Mc(q)),q.activeTexture.set($.TEXTURE0);let ne=D.colorRampTexture;ne||(ne=D.colorRampTexture=new s.T(q,D.colorRamp,$.RGBA8)),ne.bind($.LINEAR,$.CLAMP_TO_EDGE);const ae=((de,_e,be,Te,ye)=>({u_matrix:de,u_color_ramp:0,u_center_direction:_e,u_radius:s.al(be),u_opacity:Te,u_temporal_offset:ye}))(X.skyboxMatrix,D.getCenter(R,!1),D.paint.get("sky-gradient-radius"),k,F);R.uploadCommonUniforms(q,Z),Z.draw(R,$.TRIANGLES,z,pi.disabled,R.colorModeForRenderPass(),ai.backCW,ae,"skyboxGradient",D.skyboxGeometry.vertexBuffer,D.skyboxGeometry.indexBuffer,D.skyboxGeometry.segment)}(d,a,T,g,C)},custom:function(d,t,a,h){const g=d.context,_=a.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&a.isDraped(t)){if(d.renderPass==="offscreen"){const w=_.prerender;if(w){if(d.setCustomLayerDefaults(),g.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){const T=d.transform.pointMerc;w.call(_,g.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),s.ah(d.transform.zoom),[T.x,T.y],d.transform.pixelsPerMeterRatio)}else w.call(_,g.gl,d.transform.customLayerMatrix());g.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){const T=_.renderToTile;if(T){const C=h[0].canonical,R={x:C.x+h[0].wrap*(_.wrapTileId?0:1<<C.z),y:C.y,z:C.z};g.setDepthMode(Ft.disabled),g.setStencilMode(pi.disabled),g.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),T.call(_,g.gl,R),g.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),g.setColorMode(d.colorModeForRenderPass()),g.setStencilMode(pi.disabled);const w=_.renderingMode==="3d"?new Ft(d.context.gl.LEQUAL,Ft.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,Ft.ReadOnly);if(g.setDepthMode(w),d.transform.projection.name==="globe"){const T=d.transform.pointMerc;_.render(g.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),s.ah(d.transform.zoom),[T.x,T.y],d.transform.pixelsPerMeterRatio)}else _.render(g.gl,d.transform.customLayerMatrix());g.setDirty(),d.setBaseState(),g.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(d,t,a,h){if(d.renderPass==="opaque")return;const g=a.paint.get("model-opacity").constantOr(1);if(g===0)return;const _=a.paint.get("model-cast-shadows");if(d.renderPass==="shadow"&&(!_||d.terrain&&g<.65&&a._transitionablePaint._values["model-opacity"].value.expression instanceof s.ab))return;const w=d.shadowRenderer,T=a.paint.get("model-receive-shadows");w&&(w.useNormalOffset=!0,T||(w.enabled=!1));const C=()=>{w&&(w.useNormalOffset=!0,T||(w.enabled=!0))},R=t.getSource();if(d.renderPass==="light-beam"&&R.type!=="batched-model")return;if(R.type==="vector"||R.type==="geojson")return function(Z,ne,ae,de,_e){const be=Z.transform;if(be.projection.name!=="mercator")return void s.w(`Drawing 3D models for ${be.projection.name} projection is not yet implemented`);const Te=be.getFreeCameraOptions().position;if(!Z.modelManager)return;const ye=Z.modelManager;ae.modelManager=ye;const xe=Z.shadowRenderer;if(!ae._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const ve=ae._unevaluatedLayout._values["model-id"],Oe=Object.assign({},ae.layout.get("model-id").parameters),Pe=Z.style.order.indexOf(ae.fqid);for(const Ye of de){const Ue=ne.getTile(Ye).getBucket(ae);if(!Ue||Ue.projection.name!==be.projection.name)continue;const Qe=Ue.getModelUris();Qe&&!Ue.modelsRequested&&(ye.addModelsFromBucket(Qe,_e),Ue.modelsRequested=!0);const _t=ub(Ye,be);Oe.zoom=_t;const Fe=ve.possiblyEvaluate(Oe);if(Cu(Z,Ue,Ye),La.shadowUniformsInitialized=!1,La.useSingleShadowCascade=!!xe&&xe.getMaxCascadeForTile(Ye.toUnwrapped())===0,Z.renderPass==="shadow"&&xe){if(Z.currentShadowCascade===1&&Ue.isInsideFirstShadowMapFrustum)continue;const je=be.calculatePosMatrix(Ye.toUnwrapped(),be.worldSize);if(La.tileMatrix.set(je),La.shadowTileMatrix=Float32Array.from(xe.calculateShadowPassMatrixFromMatrix(je)),La.aabb.min.fill(0),La.aabb.max[0]=La.aabb.max[1]=s.aj,La.aabb.max[2]=0,Ag(Ue,La,Z,ae.scope))continue}const Ae=1<<Ye.canonical.z,qe=[((Te.x-Ye.wrap)*Ae-Ye.canonical.x)*s.aj,(Te.y*Ae-Ye.canonical.y)*s.aj,Te.z*Ae*s.aj];Z.conflationActive&&Object.keys(Ue.instancesPerModel).length>0&&Z.style.isLayerClipped(ae,ne.getSource())&&Ue.updateReplacement(Ye,Z.replacementSource,Pe,_e)&&(Ue.uploaded=!1,Ue.upload(Z.context));for(let je in Ue.instancesPerModel){const nt=Ue.instancesPerModel[je];nt.features.length>0&&(je=Fe.evaluate(nt.features[0].feature,{}));const st=ye.getModel(je,_e);if(st||ye.hasURLBeenRequested(je)||Ue.modelUris.includes(je)||(Ue.modelUris.push(je),Ue.modelsRequested=!1),st&&st.uploaded)for(const ct of st.nodes)Cg(Z,ae,ct,nt,qe,Ye,La)}}}(d,t,a,h,R.type==="vector"?a.scope:""),void C();if(!R.loaded())return;if(R.type==="batched-model")return function(Z,ne,ae,de){ae.resetLayerRenderingStats(Z);const _e=Z.context,be=Z.transform,Te=Z.style.fog,ye=Z.shadowRenderer;if(be.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${be.projection.name} projection is not yet implemented`);const xe=Z.transform.getFreeCameraOptions().position,ve=s.c1([],[xe.x,xe.y,xe.z],Z.transform.worldSize),Oe=s.eq([],ve),Pe=s.bx([]),Ye=s.e9(be.center.lat,be.zoom),Ue=s.bn([],[1,1,1/Ye]);s.bo(Pe,Pe,Oe);const Qe=ae.paint.get("model-opacity").constantOr(1),_t=new Ft(_e.gl.LEQUAL,Ft.ReadWrite,Z.depthRangeFor3D),Fe=new Ft(_e.gl.LEQUAL,Ft.ReadOnly,Z.depthRangeFor3D),Ae=new s.d6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),qe=Z.renderPass==="shadow",je=qe&&ye?ye.getCurrentCascadeFrustum():be.getFrustum(be.scaleZoom(be.worldSize)),nt=ae.paint.get("model-front-cutoff"),st=nt[2]<1,ct=ka(Z,ae.paint.get("model-cutoff-fade-range")),St=ae.getLayerRenderingStats();(function(Ht,Qt,Lt,Yt){const Wt=Ht.terrain?Ht.terrain.exaggeration():0,xi=Ht.transform.zoom;for(const Mi of Yt){const Ui=Qt.getTile(Mi).getBucket(Lt);Ui&&(Ui.setFilter(Lt.filter),Ht.conflationActive&&Ui.updateReplacement(Mi,Ht.replacementSource),Ui.evaluateTransform(Ht,Lt),Ht.terrain&&Wt>0&&Ui.elevationUpdate(Ht.terrain,Wt,Mi,Lt.source),Ui.needsReEvaluation(Ht,xi,Lt)&&Ui.evaluate(Lt))}})(Z,ne,ae,de),function(){let Ht,Qt,Lt;st?(Ht=de.length-1,Qt=-1,Lt=-1):(Ht=0,Qt=de.length,Lt=1);const Yt=new Float64Array(16),Wt=s.cx(),xi=new s.P(0,0);for(let Mi=Ht;Mi!==Qt;Mi+=Lt){const Ui=de[Mi],cn=ne.getTile(Ui).getBucket(ae);if(!cn||!cn.uploaded)continue;let Ei=!1;ye&&(Ei=ye.getMaxCascadeForTile(Ui.toUnwrapped())===0);const un=be.calculatePosMatrix(Ui.toUnwrapped(),be.worldSize),mn=cn.modelTraits;!qe&&st&&(s.bi(Yt,un),s.ad(Wt,ve,Yt),xi.x=Wt[0],xi.y=Wt[1]);const Fn=[];cn.setFilter(ae.filter);for(const ji of cn.getNodesInfo()){if(ji.hiddenByReplacement||!ji.node.meshes)continue;const dn=ji.node;let hn=0;Z.terrain&&dn.elevation&&(hn=dn.elevation*Z.terrain.exaggeration());const yn=(()=>{const us=ji.aabb;return Ae.min=[...us.min],Ae.max=[...us.max],Ae.min[2]+=hn,Ae.max[2]+=hn,s.ad(Ae.min,Ae.min,un),s.ad(Ae.max,Ae.max,un),Ae})(),Gi=ji.evaluatedScale;if(Gi[0]<=1&&Gi[1]<=1&&Gi[2]<=1&&yn.intersects(je)===0)continue;if(!qe&&st){const us=.16666666666666666;ji.cameraCollisionOpacity=ve[0]>yn.min[0]&&ve[0]<yn.max[0]&&ve[1]>yn.min[1]&&ve[1]<yn.max[1]&&ve[2]*Ye<yn.max[2]&&dn.footprint&&s.bY(xi,dn.footprint)?Math.max(ji.cameraCollisionOpacity-us,0):Math.min(1,ji.cameraCollisionOpacity+us)}const An=[...un],gn=1/s.d4(Ui.canonical),sr=dn.anchor?dn.anchor[0]:0,on=dn.anchor?dn.anchor[1]:0;s.bo(An,An,[sr*(Gi[0]-1)+ji.evaluatedTranslation[0]*gn,on*(Gi[1]-1)+ji.evaluatedTranslation[1]*gn,hn+ji.evaluatedTranslation[2]]),s.cn(Gi,s.es)||s.cP(An,An,Gi);const xn=s.az([],An,dn.matrix),Ln=s.az([],be.expandedFarZProjMatrix,xn),Dr=s.az([],be.expandedFarZProjMatrix,An),Ir=s.aA([],[sr,on,hn,1],Ln)[2];dn.hidden=!1;let zr=Qe;qe||(st&&(zr*=ji.cameraCollisionOpacity,zr*=Xx(An,be,ji.aabb,nt)),zr*=Zx(ct,Ir)),zr!==0?Fn.push({nodeInfo:ji,depth:Ir,opacity:zr,wvpForNode:Ln,wvpForTile:Dr,nodeModelMatrix:xn,tileModelMatrix:An}):dn.hidden=!0}qe||Fn.sort((ji,dn)=>!st||ji.opacity===1&&dn.opacity===1?ji.depth<dn.depth?-1:1:ji.opacity===1?-1:dn.opacity===1?1:ji.depth>dn.depth?-1:1);for(const ji of Fn){const dn=ji.nodeInfo,hn=dn.node;let yn=s.az([],Ue,ji.tileModelMatrix);s.az(yn,Pe,yn);const Gi=s.bi([],yn);s.ea(Gi,Gi),s.cP(Gi,Gi,Jf),yn=s.az(yn,yn,hn.matrix);const An=Z.renderPass==="light-beam",gn=ae.paint.get("model-color-use-theme").constantOr("default")==="none",sr=mn&s.ex.HasMapboxMeshFeatures,on=sr?0:dn.evaluatedRMEA[0][2];for(let xn=0;xn<hn.meshes.length;++xn){const Ln=hn.meshes[xn],Dr=xn===hn.lightMeshIndex;let Ir=ji.wvpForNode;if(Dr){if(!An&&!Z.terrain&&Z.shadowRenderer){Z.currentLayer<Z.firstLightBeamLayer&&(Z.firstLightBeamLayer=Z.currentLayer);continue}Ir=ji.wvpForTile}else if(An)continue;const zr={defines:[]},us=[];if(!qe&&ye&&(ye.useNormalOffset=!!Ln.normalBuffer),yh(zr.defines,us,Ln,Z,gn?null:ae.lut),sr||zr.defines.push("DIFFUSE_SHADED"),Ei&&zr.defines.push("SHADOWS_SINGLE_CASCADE"),St&&(qe?St.numRenderedVerticesInShadowPass+=Ln.vertexArray.length:St.numRenderedVerticesInTransparentPass+=Ln.vertexArray.length),qe){Yf(Ln,ji.nodeModelMatrix,Z,ae);continue}let _a=null;if(Te){const Es=_h(ji.nodeModelMatrix,Z.transform);if(_a=new Float32Array(Es),be.projection.name!=="globe"){const Tr=Ln.aabb.min,fr=Ln.aabb.max,[Bn,Ur]=Te.getOpacityForBounds(Es,Tr[0],Tr[1],fr[0],fr[1]);zr.overrideFog=Bn>=it||Ur>=it}}const Xs=Ln.material;let vo;Xs.occlusionTexture&&Xs.occlusionTexture.offsetScale&&(vo=Xs.occlusionTexture.offsetScale,zr.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Ts=Z.getOrCreateProgram("model",zr);!qe&&ye&&ye.setupShadowsFromMatrix(ji.tileModelMatrix,Ts,ye.useNormalOffset),Z.uploadCommonUniforms(_e,Ts,null,_a);const zo=Xs.pbrMetallicRoughness;zo.metallicFactor=.9,zo.roughnessFactor=.5;const ra=pg(new Float32Array(Ir),new Float32Array(yn),new Float32Array(Gi),new Float32Array(hn.matrix),Z,ji.opacity,zo.baseColorFactor,Xs.emissiveFactor,zo.metallicFactor,zo.roughnessFactor,Xs,on,ae,[0,0,0],vo);!Dr&&(dn.hasTranslucentParts||ji.opacity<1)&&Ts.draw(Z,_e.gl.TRIANGLES,_t,pi.disabled,Ni.disabled,ai.backCCW,ra,ae.id,Ln.vertexBuffer,Ln.indexBuffer,Ln.segments,ae.paint,Z.transform.zoom,void 0,us),Ts.draw(Z,_e.gl.TRIANGLES,Dr?Fe:_t,pi.disabled,Dr||ji.opacity<1||dn.hasTranslucentParts?Ni.alphaBlended:Ni.unblended,ai.backCCW,ra,ae.id,Ln.vertexBuffer,Ln.indexBuffer,Ln.segments,ae.paint,Z.transform.zoom,void 0,us)}}}}()}(d,t,a,h),void C();if(R.type!=="model")return;const D=R.getModels(),z=[],k=d.transform.getFreeCameraOptions().position,F=s.c1([],[k.x,k.y,k.z],d.transform.worldSize);s.eq(F,F);const q=[],$=[];let X=0;for(const Z of D){const ne=a.paint.get("model-rotation").constantOr(null),ae=a.paint.get("model-scale").constantOr(null),de=a.paint.get("model-translation").constantOr(null);Z.computeModelMatrix(d,ne,ae,de,!0,!0,!1);const _e=s.bx([]),be=s.e9(Z.position.lat,d.transform.zoom),Te=s.bn([],[1,1,1/be]);s.bo(_e,_e,F),z.push({zScaleMatrix:Te,negCameraPosMatrix:_e});for(const ye of Z.nodes)Eg(d.transform,ye,Z.matrix,d.transform.expandedFarZProjMatrix,X,q,$);X++}if(q.sort((Z,ne)=>ne.depth-Z.depth),d.renderPass!=="shadow"){if(g===1)for(const Z of $)Eu(Z,d,a,z[Z.modelIndex],pi.disabled,d.colorModeForRenderPass());else{for(const Z of $)Eu(Z,d,a,z[Z.modelIndex],pi.disabled,Ni.disabled);for(const Z of $)Eu(Z,d,a,z[Z.modelIndex],d.stencilModeFor3D(),d.colorModeForRenderPass());d.resetStencilClippingMasks()}for(const Z of q)Eu(Z,d,a,z[Z.modelIndex],pi.disabled,d.colorModeForRenderPass());C()}else{for(const Z of $)Yf(Z.mesh,Z.nodeModelMatrix,d,a);for(const Z of q)Yf(Z.mesh,Z.nodeModelMatrix,d,a);C()}}},ep={line:function(d,t,a){if(d.hasElevatedBuckets=!1,d.hasNonElevatedBuckets=!1,d._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||d._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const h=t.getVisibleCoordinates();for(const g of h){const _=t.getTile(g).getBucket(d);if(_&&(_.elevationType!=="none"?d.hasElevatedBuckets=!0:d.hasNonElevatedBuckets=!0,d.hasElevatedBuckets&&d.hasNonElevatedBuckets))break}}}else d.hasNonElevatedBuckets=!0},model:function(d,t,a){const h=t.getSource();if(!h.loaded())return;if(h.type==="vector"||h.type==="geojson")return void(a.modelManager&&a.modelManager.upload(a,h.type==="vector"?d.scope:""));if(h.type==="batched-model"||h.type!=="model")return;const g=h.getModels();for(const _ of g)_.upload(a.context)},raster:function(d,t,a){const h=t.getSource();if(!(h instanceof Pl&&h.loaded()))return;const g=d.sourceLayer||h.rasterLayerIds&&h.rasterLayerIds[0];if(!g)return;const _=d.paint.get("raster-array-band")||h.getInitialBand(g);if(_==null)return;const w=t.getIds().map(T=>t.getTileByID(T));for(const T of w)T.updateNeeded(d.id,_)&&h.prepareTile(T,g,d.id,_)},"raster-particle":function(d,t,a){const h=t.getSource();if(!(h instanceof Pl&&h.loaded()))return;const g=d.sourceLayer||h.rasterLayerIds&&h.rasterLayerIds[0];if(!g)return;const _=d.paint.get("raster-particle-array-band")||h.getInitialBand(g);if(_==null)return;const w=t.getIds().map(T=>t.getTileByID(T));for(const T of w)T.updateNeeded(d.id,_)&&h.prepareTile(T,g,d.id,_)}},tp={fill:Bt},ko={fill:function(d,t,a,h){if(!a.layout||a.layout.get("fill-elevation-reference")==="none")return;const g=d.context.gl,_=new Ft(g.LEQUAL,Ft.ReadOnly,d.depthRangeFor3D),w=new pi({func:g.ALWAYS,mask:255},255,255,g.KEEP,g.KEEP,g.REPLACE),T=d.transform.getFreeCameraOptions().position,C=d.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const R of h){const D=t.getTile(R),z=D.getBucket(a);if(!z)continue;const k=z.elevatedStructures;if(!k||k.depthSegments.segments[0].primitiveLength===0)continue;const F=fh(R.toUnwrapped(),T),q=d.translatePosMatrix(R.projMatrix,D,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor")),$=Bf(q,F,0,1,0);C.draw(d,g.TRIANGLES,_,w,Ni.disabled,ai.disabled,$,a.id,k.vertexBuffer,k.indexBuffer,k.depthSegments,a.paint,d.transform.zoom)}}};class ql{constructor(t,a,h,g,_,w){this.context=new Hf(t,a),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=_,this._timeStamp=s.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const T=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const R of T)this._debugParams.enabledLayers[R]=!0;_.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),_.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),_.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),_.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const R of T)_.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],R);this.occlusionParams=new Au(_),this.setup(),this.numSublayers=so.maxUnderzooming+so.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.eE,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Hw(this),this._wireframeDebugCache=new xh,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const C=new s.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,C,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=g,this.worldview=w}updateTerrain(t,a){const h=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(h||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new zf(this,t));const g=this._terrain;this.transform.elevation=h?g:null,g.update(t,this.transform,a),this.transform.elevation&&!g.enabled&&(this.transform.elevation=null)}_updateFog(t){const a=t.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[h,g]=a.getFovAdjustedRange(this.transform._fov);if(h>g)return void(this.transform.fogCullDistSq=null);const _=h+.78*(g-h);this.transform.fogCullDistSq=_*_}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new zf(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,a){if(this.width=t*s.q.devicePixelRatio,this.height=a*s.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style.order)this.style._mergedLayers[h].resize()}setup(){const t=this.context,a=new s.ba;a.emplaceBack(0,0),a.emplaceBack(s.aj,0),a.emplaceBack(0,s.aj),a.emplaceBack(s.aj,s.aj),this.tileExtentBuffer=t.createVertexBuffer(a,s.bc.members),this.tileExtentSegments=s.bd.simpleSegment(0,0,4,2);const h=new s.ba;h.emplaceBack(0,0),h.emplaceBack(s.aj,0),h.emplaceBack(0,s.aj),h.emplaceBack(s.aj,s.aj),this.debugBuffer=t.createVertexBuffer(h,s.bc.members),this.debugSegments=s.bd.simpleSegment(0,0,4,5);const g=new s.ba;g.emplaceBack(-1,-1),g.emplaceBack(1,-1),g.emplaceBack(-1,1),g.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(g,s.bc.members),this.viewportSegments=s.bd.simpleSegment(0,0,4,2);const _=new s.aZ;_.emplaceBack(0,0,0,0),_.emplaceBack(s.aj,0,s.aj,0),_.emplaceBack(0,s.aj,0,s.aj),_.emplaceBack(s.aj,s.aj,s.aj,s.aj),this.mercatorBoundsBuffer=t.createVertexBuffer(_,s.bf.members),this.mercatorBoundsSegments=s.bd.simpleSegment(0,0,4,2);const w=new s.a_;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(w);const T=new s.bb;for(const R of[0,1,3,2,0])T.emplaceBack(R);this.debugIndexBuffer=t.createIndexBuffer(T),this.emptyTexture=new s.T(t,new s.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=s.bz();const C=this.context.gl;this.stencilClearMode=new pi({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Ft.disabled,this.stencilClearMode,Ni.disabled,ai.disabled,Nf(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,a,h){if(!a||this.currentStencilSource===a.id||!t.isTileClipped()||!h||h.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let T=!1;for(const C of h)if(this._tileClippingMaskIDs[C.key]===void 0){T=!0;break}if(!T)return}this.currentStencilSource=a.id;const g=this.context,_=g.gl;this.nextStencilID+h.length>256&&this.clearStencil(),g.setColorMode(Ni.disabled),g.setDepthMode(Ft.disabled);const w=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const T of h){const C=a.getTile(T),R=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,{tileBoundsBuffer:D,tileBoundsIndexBuffer:z,tileBoundsSegments:k}=this.getTileBoundsBuffers(C);w.draw(this,_.TRIANGLES,Ft.disabled,new pi({func:_.ALWAYS,mask:0},R,255,_.KEEP,_.KEEP,_.REPLACE),Ni.disabled,ai.disabled,Nf(T.projMatrix),"$clipping",D,z,k)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new pi({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const a=this.context.gl;return new pi({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(t){const a=this.context.gl,h=t.sort((w,T)=>T.overscaledZ-w.overscaledZ),g=h[h.length-1].overscaledZ,_=h[0].overscaledZ-g+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const w={};for(let T=0;T<_;T++)w[T+g]=new pi({func:a.GEQUAL,mask:255},T+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=_,[w,h]}return[{[g]:pi.disabled},h]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Ni([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new s.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ni.unblended:Ni.alphaBlended}colorModeForDrapableLayerRenderPass(t){const a=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Ni([a.ONE,a.ONE_MINUS_SRC_ALPHA,a.CONSTANT_ALPHA,a.ONE_MINUS_SRC_ALPHA],new s.am(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,a,h,g=!1){if(this.depthOcclusion)return new Ft(this.context.gl.GREATER,Ft.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!g)return Ft.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Ft(h||this.context.gl.LEQUAL,a,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,a=Math.ceil(this.width),h=Math.ceil(this.height),g=this.context.bindFramebuffer.get(),_=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===a&&this.depthFBO.height===h||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),a!==0&&h!==0&&(this.depthFBO=new Ic(this.context,a,h,!1,"texture"),this.depthTexture=new s.T(this.context,{width:a,height:h,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(g),t.bindTexture(t.TEXTURE_2D,_),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,a,h,0,0,a,h,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,a)=>t+a/this._fpsHistory.length,0))}render(t,a){const h=s.q.now();this._dt=h-this._timeStamp,this._timeStamp=h,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=a;const g=this.style._mergedLayers,_=!(!this.terrain||!this.terrain.enabled),w=()=>this.style._getOrder(_).filter(Fe=>{const Ae=g[Fe];return!(Ae.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ae.type]});let T=w(),C=!1,R=!1,D=null;for(const Fe of T){const Ae=g[Fe];Ae.type==="circle"?C=!0:Ae.type==="building"?D=Ae:Ae.type==="symbol"&&(Ae.hasInitialOcclusionOpacityProperties?R=!0:C=!0)}let z=T.map(Fe=>g[Fe]);const k=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(s.q.now()),this.imageManager.beginFrame();let F=0,q=!1;for(const Fe in k){const Ae=k[Fe];Ae.used&&(Ae.prepare(this.context),Ae.getSource().usedInConflation&&++F)}let $=!1;for(const Fe of z)Fe.isHidden(this.transform.zoom)||(Fe.type==="clip"&&($=!0),this.prepareLayer(Fe));const X={},Z={},ne={},ae={},de={};for(const Fe in k){const Ae=k[Fe];X[Fe]=Ae.getVisibleCoordinates(),Z[Fe]=X[Fe].slice().reverse(),ne[Fe]=Ae.getVisibleCoordinates(!0).reverse(),ae[Fe]=Ae.getShadowCasterCoordinates(),de[Fe]=Ae.sortCoordinatesByDistance(X[Fe])}const _e=Fe=>{const Ae=this.style.getLayerSourceCache(Fe);return Ae&&Ae.used?Ae.getSource():null};if(F||$||this._clippingActiveLastFrame){const Fe=[],Ae=[];let qe=0;for(const je of z)this.isSourceForClippingOrConflation(je,_e(je))&&(Fe.push(je),Ae.push(qe)),qe++;if(Fe&&($||Fe.length>1)||this._clippingActiveLastFrame){$=!1;const je=[];for(let nt=0;nt<Fe.length;nt++){const st=Fe[nt],ct=Ae[nt],St=this.style.getLayerSourceCache(st);if(!St||!St.used||!St.getSource().usedInConflation&&st.type!=="clip"&&st.type!=="building")continue;let Ht=s.eF,Qt=s.bW.None;const Lt=[];let Yt=!0;if(st.type==="building")Ht=s.eH;else if(st.type==="clip"){Ht=ct;for(const Wt of st.layout.get("clip-layer-types"))Qt|=Wt==="model"?s.bW.Model:Wt==="symbol"?s.bW.Symbol:s.bW.FillExtrusion;for(const Wt of st.layout.get("clip-layer-scope"))Lt.push(Wt);st.isHidden(this.transform.zoom)?Yt=!1:$=!0}Yt&&je.push({layer:st.fqid,cache:St,order:Ht,clipMask:Qt,clipScope:Lt})}this.replacementSource.setSources(je),q=!0}}this._clippingActiveLastFrame=$,q||this.replacementSource.clear(),this.conflationActive=q,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Fe=0;Fe<z.length;Fe++){const Ae=z[Fe],qe=Ae.cutoffRange();if(this.longestCutoffRange=Math.max(qe,this.longestCutoffRange),qe>0){const je=_e(Ae);je&&(this.minCutoffZoom=Math.max(je.minzoom,this.minCutoffZoom)),Ae.minzoom&&(this.minCutoffZoom=Math.max(Ae.minzoom,this.minCutoffZoom))}Ae.is3D(_)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Fe),this._lastOcclusionLayer=Fe)}const be=this.style&&this.style.fog;be?(this._fogVisible=be.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=be.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ne),this.opaquePassCutoff=0,T=w(),z=T.map(Fe=>g[Fe]));const Te=this._shadowRenderer;if(Te){Te.updateShadowParameters(this.transform,this.style.directionalLight);for(const Fe in k)for(const Ae of X[Fe]){let qe={min:0,max:0};this.terrain&&(qe=this.terrain.getMinMaxForTile(Ae)||qe),Te.addShadowReceiver(Ae.toUnwrapped(),qe.min,qe.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.eG(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Ne(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const ye=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),xe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(ye&&!this._snow&&(this._snow=new Pg(this)),!ye&&this._snow&&(this._snow.destroy(),delete this._snow),xe&&!this._rain&&(this._rain=new Pu(this)),!xe&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),D){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Wx);const Fe=this.style.getLayerSourceCache(D);this.buildingTileBorderManager.updateBorders(Fe,D)}if(!kn.has(this.context.gl))return;this.renderPass="offscreen";for(const Fe of z){const Ae=t.getLayerSourceCache(Fe);if(!Fe.hasOffscreenPass()||Fe.isHidden(this.transform.zoom))continue;const qe=Ae?Z[Ae.id]:void 0;(Fe.type==="custom"||Fe.type==="raster"||Fe.type==="raster-particle"||Fe.isSky()||qe&&qe.length)&&this.renderLayer(this,Ae,Fe,qe)}this.depthRangeFor3D=[0,1-(z.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ae)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const ve=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Oe=(()=>{if(a.showOverdrawInspector)return s.am.black;const Fe=this.style.fog;if(Fe&&this.transform.projection.supportsFog){const Ae=this.style.getLut(Fe.scope);if(!ve){const qe=Fe.properties.get("color-use-theme")==="none",je=Fe.properties.get("color").toNonPremultipliedRenderColor(qe?null:Ae).toArray01();return new s.am(...je)}if(ve){const qe=Fe.properties.get("space-color-use-theme")==="none",je=Fe.properties.get("space-color").toNonPremultipliedRenderColor(qe?null:Ae).toArray01();return new s.am(...je)}}return s.am.transparent})();if(this.context.clear({color:Oe,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ve&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=T.length-1;this.currentLayer>=0;this.currentLayer--){const Fe=z[this.currentLayer],Ae=t.getLayerSourceCache(Fe);if(Fe.isSky())continue;const qe=Ae?(Fe.is3D(_)?de:Z)[Ae.id]:void 0;this._renderTileClippingMasks(Fe,Ae,qe),this.renderLayer(this,Ae,Fe,qe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ve&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<T.length;this.currentLayer++){const Fe=z[this.currentLayer],Ae=t.getLayerSourceCache(Fe);Fe.isSky()&&this.renderLayer(this,Ae,Fe,Ae?Z[Ae.id]:void 0)}function Pe(Fe,Ae){let qe;return Ae&&(qe=(Fe.type==="symbol"?ne:Fe.is3D(_)?de:Z)[Ae.id]),qe}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<T.length;){const Fe=z[this.currentLayer];if(Fe.type==="raster"||Fe.type==="raster-particle"){const Ae=t.getLayerSourceCache(Fe);this.renderLayer(this,Ae,Fe,Pe(Fe,Ae))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Ye=0;Te&&(Ye=Te.getShadowCastingLayerCount());let Ue=!1,Qe=-1;for(let Fe=0;Fe<T.length;++Fe){const Ae=z[Fe];Ae.isHidden(this.transform.zoom)||Ae.is3D(_)&&(Qe=Fe)}R&&Qe===-1&&(C=!0);let _t=!1;for(;this.currentLayer<T.length;){const Fe=z[this.currentLayer],Ae=t.getLayerSourceCache(Fe);if(Fe.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Fe)){if(Fe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!_t&&Fe.is3D(_)&&!_){const qe=this.currentLayer,je=nt=>{for(this.currentLayer=0;this.currentLayer<z.length;this.currentLayer++){const st=z[this.currentLayer];if(tp[st.type]){const ct=this.style.getLayerSourceCache(st);tp[st.type](this,ct,st,Pe(st,ct),nt)}}};je("initialize"),je("reset"),this.currentLayer=qe,_t=!0}if(C&&!Ue&&this.terrain&&!this.transform.isOrthographic&&(Ue=!0,this.blitDepth()),R&&Qe!==-1&&this.currentLayer===Qe+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Fe,Ae,Ae?X[Ae.id]:void 0),this.renderLayer(this,Ae,Fe,Pe(Fe,Ae)),!this.terrain&&Te&&Ye>0&&Fe.hasShadowPass()&&--Ye==0){{this.clearStencil(),this.resetStencilClippingMasks();const qe=this.currentLayer;for(this.currentLayer=0;this.currentLayer<z.length;this.currentLayer++){const je=z[this.currentLayer];if(ko[je.type]){const nt=this.style.getLayerSourceCache(je);ko[je.type](this,nt,je,Pe(je,nt))}}this.currentLayer=qe}if(Te.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const qe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=qe;this.currentLayer++){const je=z[this.currentLayer];if(!je.hasLightBeamPass())continue;const nt=t.getLayerSourceCache(je);this.renderLayer(this,nt,je,nt?Z[nt.id]:void 0)}this.currentLayer=qe,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const qe=this.currentLayer;this.depthOcclusion=!0;for(const je of this.layersWithOcclusionOpacity){this.currentLayer=je;const nt=z[this.currentLayer],st=t.getLayerSourceCache(nt),ct=st?Z[st.id]:void 0;this.terrain||this._renderTileClippingMasks(nt,st,st?X[st.id]:void 0),this.renderLayer(this,st,nt,ct)}this.depthOcclusion=!1,this.currentLayer=qe,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Fe=null;z.forEach(Ae=>{const qe=t.getLayerSourceCache(Ae);qe&&!Ae.isHidden(this.transform.zoom)&&qe.getVisibleCoordinates().length&&(!Fe||Fe.getSource().maxzoom<qe.getSource().maxzoom)&&(Fe=qe)}),Fe&&this.options.showTileBoundaries&&Na(this,Fe,Fe.getVisibleCoordinates(),s.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Na(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Fe){const Ae=Fe.transform.padding;mh(Fe,Fe.transform.height-(Ae.top||0),3,Gx),mh(Fe,Ae.bottom||0,3,bg),Kf(Fe,Ae.left||0,3,Sg),Kf(Fe,Fe.transform.width-(Ae.right||0),3,Tg);const qe=Fe.transform.centerPoint;(function(je,nt,st,ct){gh(je,nt-1,st-10,2,20,ct),gh(je,nt-10,st-1,20,2,ct)})(Fe,qe.x,Fe.transform.height-qe.y,$x)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),q||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:a}=this.transform.projection,h=!a||!a.includes(t.type);if(ep[t.type]&&(h||this.terrain&&t.type==="custom")){const g=this.style.getLayerSourceCache(t);ep[t.type](t,g,this)}this.gpuTimingEnd()}renderLayer(t,a,h,g){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="sky"||h.type==="custom"||h.type==="model"||h.type==="raster"||h.type==="raster-particle"||g&&g.length)&&(this.id=h.id,this.gpuTimingStart(h),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(h.type)&&(!t.terrain||h.type!=="custom")||h.type==="clip"||Mg[h.type](t,a,h,g,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery,h=this.context.gl;let g=this.gpuTimers[t.id];g||(g=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:h.createQuery()}),g.calls++,h.beginQuery(a.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,a=this.context.gl,h=a.createQuery();this.deferredRenderGpuTimeQueries.push(h),a.beginQuery(t.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const a={};for(const h in t){const g=t[h],_=this.context.extTimerQuery,w=_.getQueryParameter(g.query,this.context.gl.QUERY_RESULT)/1e6;_.deleteQueryEXT(g.query),a[h]=w}return a}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.gl;let h=0;for(const g of t)h+=a.getQueryParameter(g,a.QUERY_RESULT)/1e6,a.deleteQuery(g);return h}translatePosMatrix(t,a,h,g,_){if(!h[0]&&!h[1])return t;const w=_?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(w){const R=Math.sin(w),D=Math.cos(w);h=[h[0]*D-h[1]*R,h[0]*R+h[1]*D]}const T=[_?h[0]:s.aw(a,h[0],this.transform.zoom),_?h[1]:s.aw(a,h[1],this.transform.zoom),0],C=new Float32Array(16);return s.bo(C,t,T),C}saveTileTexture(t){if(t.context!==this.context)return;const a=t.size[0],h=this._tileTextures[a];h?h.push(t):this._tileTextures[a]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,a,h){const g=h===void 0?this.terrain&&this.terrain.renderingToTexture:h,_=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(_.push("LIGHTING_3D_MODE"),_.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):g||_.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||_.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(_.push("TERRAIN"),this.linearFloatFilteringSupported()&&_.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&_.push("GLOBE"),!this._fogVisible||g||a!==void 0&&!a||_.push("FOG","FOG_DITHERING"),g&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}getOrCreateProgram(t,a){this.cache=this.cache||{};const h=a&&a.defines||[],g=a&&a.config,_=this.currentGlobalDefines(t,a&&a.overrideFog,a&&a.overrideRtt).concat(h),w=Ff.cacheKey(lh[t],t,_,g);return this.cache[w]||(this.cache[w]=new Ff(this.context,t,lh[t],g,Bx[t],_)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,a){if(this.style.enable3dLights()){const h=this.style.directionalLight,g=this.style.ambientLight;if(h&&g){const _=((w,T,C)=>{const R=w.properties.get("direction"),D=w.properties.get("color-use-theme")==="none",z=w.properties.get("color").toNonPremultipliedRenderColor(D?null:C.getLut(w.scope)).toArray01(),k=w.properties.get("intensity"),F=T.properties.get("color-use-theme")==="none",q=T.properties.get("color").toNonPremultipliedRenderColor(F?null:C.getLut(T.scope)).toArray01(),$=T.properties.get("intensity"),X=[R.x,R.y,R.z],Z=s.dI(q,$),ne=s.dI(z,k);return{u_lighting_ambient_color:Z,u_lighting_directional_dir:X,u_lighting_directional_color:ne,u_ground_radiance:sg(X,ne,Z)}})(h,g,this.style);a.setLightsUniformValues(t,_)}}}uploadCommonUniforms(t,a,h,g,_){if(this.uploadCommonLightUniforms(t,a),this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const T=w.getOpacity(this.transform.pitch),C=((R,D,z,k,F,q,$,X,Z,ne,ae,de)=>{const _e=R.transform,be=D.properties.get("color-use-theme")==="none",Te=D.properties.get("color").toNonPremultipliedRenderColor(be?null:R.style.getLut(D.scope)).toArray01();Te[3]=k;const ye=R.frameCounter/1e3%1,[xe,ve]=D.properties.get("vertical-range");return{u_fog_matrix:z?_e.calculateFogTileMatrix(z):de||R.identityMat,u_fog_range:D.getFovAdjustedRange(_e._fov),u_fog_color:Te,u_fog_horizon_blend:D.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(xe,ve),ve],u_fog_temporal_offset:ye,u_frustum_tl:F,u_frustum_tr:q,u_frustum_br:$,u_frustum_bl:X,u_globe_pos:Z,u_globe_radius:ne,u_viewport:ae,u_globe_transition:s.ah(_e.zoom),u_is_globe:+(_e.projection.name==="globe")}})(this,w,h,T,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.q.devicePixelRatio,this.transform.height*s.q.devicePixelRatio],g);a.setFogUniformValues(t,C)}_&&a.setCutoffUniformValues(t,_.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,a=t.createTexture();return t.bindTexture(t.TEXTURE_2D,a),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,a=this._backgroundTiles={},h=this.transform.coveringTiles({tileSize:512});for(const g of h)a[g.key]=t[g.key]||new mc(g,512,this.transform.tileZoom,this,void 0,this.worldview);return a}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,a){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&t.type!=="building"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building"&&t.sourceLayer!=="procedural_buildings")&&(!a||a.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let a=this._cachedTileFogOpacities[t.key];return a||(this._cachedTileFogOpacities[t.key]=a=this.style.fog.getOpacityForTile(t)),a[0]>=it||a[1]>=it}setupDepthForOcclusion(t,a,h){const g=this.context,_=g.gl,w=!!h;var T;h||(h={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),g.activeTexture.set(_.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),h.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],h.u_depth_range_unpack=[2/((T=this.depthRangeFor3D)[1]-T[0]),-1-2*T[0]/(T[1]-T[0])],h.u_occluder_half_size=.5*this.occlusionParams.occluderSize,h.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),g.activeTexture.set(_.TEXTURE0),w||a.setTerrainUniformValues(g,h)}}function Mu(d,t){let a=!1,h=null;const g=()=>{h=null,a&&(d(),h=setTimeout(g,t),a=!1)};return()=>(a=!0,h||g(),h)}class ip{constructor(t){this._hashName=t&&encodeURIComponent(t),s.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Mu(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const a=np(t);if(this._hashName){const h=this._hashName;let g=!1;const _=location.hash.slice(1).split("&").map(w=>{const T=w.split("=")[0];return T===h?(g=!0,`${T}=${a}`):w}).filter(w=>w);return g||_.push(`${h}=${a}`),`#${_.join("&")}`}return`#${a}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let a;return t.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(a=h)}),(a&&a[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some(h=>isNaN(Number(h)))){const h=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(a[3]||0):t.getBearing();return t.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:h,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function np(d,t){const a=d.getCenter(),h=Math.round(100*d.getZoom())/100,g=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,g),w=Math.round(a.lng*_)/_,T=Math.round(a.lat*_)/_,C=d.getBearing(),R=d.getPitch();let D=t?`/${w}/${T}/${h}`:`${h}/${T}/${w}`;return(C||R)&&(D+="/"+Math.round(10*C)/10),R&&(D+=`/${Math.round(R)}`),D}const Ru={linearity:.3,easing:s.eI(0,0,.3,1)},Wl=s.h({deceleration:2500,maxSpeed:1400},Ru),Rg=s.h({deceleration:20,maxSpeed:1400},Ru),za=s.h({deceleration:1e3,maxSpeed:360},Ru),Dg=s.h({deceleration:1e3,maxSpeed:90},Ru);class rp{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=s.q.now();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const a={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)a.zoom+=_.zoomDelta||0,a.bearing+=_.bearingDelta||0,a.pitch+=_.pitchDelta||0,_.panDelta&&a.pan._add(_.panDelta),_.around&&(a.around=_.around),_.pinchAround&&(a.pinchAround=_.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(a.pan.mag()){const _=ku(a.pan.mag(),h,s.h({},Wl,t||{}));g.offset=a.pan.mult(_.amount/a.pan.mag()),g.center=this._map.transform.center,Du(g,_)}if(a.zoom){const _=ku(a.zoom,h,Rg);g.zoom=this._map.transform.zoom+_.amount,Du(g,_)}if(a.bearing){const _=ku(a.bearing,h,za);g.bearing=this._map.transform.bearing+s.ay(_.amount,-179,179),Du(g,_)}if(a.pitch){const _=ku(a.pitch,h,Dg);g.pitch=this._map.transform.pitch+_.amount,Du(g,_)}if(g.zoom||g.bearing){const _=a.pinchAround===void 0?a.around:a.pinchAround;g.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),g.noMoveStart=!0,g}}function Du(d,t){(!d.duration||d.duration<t.duration)&&(d.duration=t.duration,d.easing=t.easing)}function ku(d,t,a){const{maxSpeed:h,linearity:g,deceleration:_}=a,w=s.ay(d*g/(t/1e3),-h,h),T=Math.abs(w)/(_*g);return{easing:a.easing,duration:1e3*T,amount:w*(T/2)}}class Qn extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,h,g={}){const _=at(a.getCanvasContainer(),h),w=a.unproject(_);super(t,s.h({point:_,lngLat:w,originalEvent:h},g)),this._defaultPrevented=!1,this.target=a}}class Nu extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,h){const g=t==="touchend"?h.changedTouches:h.touches,_=Xt(a.getCanvasContainer(),g),w=_.map(C=>a.unproject(C)),T=_.reduce((C,R,D,z)=>C.add(R.div(z.length)),new s.P(0,0));super(t,{points:_,point:T,lngLats:w,lngLat:a.unproject(T),originalEvent:h}),this._defaultPrevented=!1}}class kg extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a){super("wheel",{originalEvent:a}),this._defaultPrevented=!1}}class Ng{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new kg(this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new Qn(t.type,this._map,t))}mouseup(t){this._map.fire(new Qn(t.type,this._map,t))}preclick(t){const a=s.h({},t);a.type="preclick",this._map.fire(new Qn(a.type,this._map,a))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Qn(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Qn(t.type,this._map,t))}mouseover(t){this._map.fire(new Qn(t.type,this._map,t))}mouseout(t){this._map.fire(new Qn(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Nu(t.type,this._map,t))}touchmove(t){this._map.fire(new Nu(t.type,this._map,t))}touchend(t){this._map.fire(new Nu(t.type,this._map,t))}touchcancel(t){this._map.fire(new Nu(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Dc{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Qn(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Qn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Qn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Lg{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(Ie(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const h=a,g=this._startPos,_=this._lastPos;if(!g||!_||_.equals(h)||!this._box&&h.dist(g)<this._clickTolerance)return;this._lastPos=h,this._box||(this._box=J("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const w=Math.min(g.x,h.x),T=Math.max(g.x,h.x),C=Math.min(g.y,h.y),R=Math.max(g.y,h.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${w}px,${C}px)`,this._box.style.width=T-w+"px",this._box.style.height=R-C+"px")})}mouseupWindow(t,a){if(!this._active)return;const h=this._startPos,g=a;if(h&&t.button===0){if(this.reset(),et(),h.x!==g.x||h.y!==g.y)return this._map.fire(new s.A("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(h,g,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),pe(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new s.A(t,{originalEvent:a}))}}function wh(d,t){const a={};for(let h=0;h<d.length;h++)a[d[h].identifier]=t[h];return a}class zg{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,a,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),h.length===this.numTouches&&(this.centroid=function(g){const _=new s.P(0,0);for(const w of g)_._add(w);return _.div(g.length)}(a),this.touches=wh(h,a)))}touchmove(t,a,h){if(this.aborted||!this.centroid)return;const g=wh(h,a);for(const _ in this.touches){const w=g[_];(!w||w.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(t,a,h){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class Zl{constructor(t){this.singleTap=new zg(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,a,h){this.singleTap.touchstart(t,a,h)}touchmove(t,a,h){this.singleTap.touchmove(t,a,h)}touchend(t,a,h){const g=this.singleTap.touchend(t,a,h);if(g){const _=t.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(g)<30;if(_&&w||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class Og{constructor(){this._zoomIn=new Zl({numTouches:1,numTaps:2}),this._zoomOut=new Zl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,h){this._zoomIn.touchstart(t,a,h),this._zoomOut.touchstart(t,a,h)}touchmove(t,a,h){this._zoomIn.touchmove(t,a,h),this._zoomOut.touchmove(t,a,h)}touchend(t,a,h){const g=this._zoomIn.touchend(t,a,h),_=this._zoomOut.touchend(t,a,h);return g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(g)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Fg={0:1,2:2},sp={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Lu{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,a){return!1}_move(t,a){return{}}mousedown(t,a){if(this._lastPoint)return;const h=Ct(t);this._correctButton(t,h)&&(this._lastPoint=a,this._eventButton=h)}mousemoveWindow(t,a){const h=this._lastPoint;if(h){if(t.preventDefault(),this._eventButton!=null&&function(g,_){const w=Fg[_];return g.buttons===void 0||(g.buttons&w)!==w}(t,this._eventButton))this.reset();else if(this._moved||!(a.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(h,a)}}mouseupWindow(t){this._lastPoint&&Ct(t)===this._eventButton&&(this._moved&&et(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class jg extends Lu{mousedown(t,a){super.mousedown(t,a),this._lastPoint&&(this._active=!0)}_correctButton(t,a){return a===0&&!t.ctrlKey}_move(t,a){return{around:a,panDelta:a.sub(t)}}}class op extends Lu{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?sp[t.pitchRotateKey]:void 0}_correctButton(t,a){return this._pitchRotateKey?a===0&&t[this._pitchRotateKey]:a===0&&t.ctrlKey||a===2}_move(t,a){const h=.8*(a.x-t.x);if(h)return this._active=!0,{bearingDelta:h}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Bg extends Lu{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?sp[t.pitchRotateKey]:void 0}_correctButton(t,a){return this._pitchRotateKey?a===0&&t[this._pitchRotateKey]:a===0&&t.ctrlKey||a===2}_move(t,a){const h=-.5*(a.y-t.y);if(h)return this._active=!0,{pitchDelta:h}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Yx{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),s.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(t,a,h){return this._calculateTransform(t,a,h)}touchmove(t,a,h){if(this._active&&!(h.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(h.length===1&&!s.eJ())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,a,h)}}touchend(t,a,h){this._calculateTransform(t,a,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,h){h.length>0&&(this._active=!0);const g=wh(h,a),_=new s.P(0,0),w=new s.P(0,0);let T=0;for(const R in g){const D=g[R],z=this._touches[R];z&&(_._add(D),w._add(D.sub(z)),T++,g[R]=D)}if(this._touches=g,T<this._minTouches||!w.mag())return;const C=w.div(T);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(T),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=J("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class ap{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,a,h){return{}}touchstart(t,a,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,h){const g=this._firstTwoTouches;if(!g)return;t.preventDefault();const[_,w]=g,T=bh(h,a,_),C=bh(h,a,w);if(!T||!C)return;const R=this._aroundCenter?null:T.add(C).div(2);return this._move([T,C],R,t)}touchend(t,a,h){if(!this._firstTwoTouches)return;const[g,_]=this._firstTwoTouches,w=bh(h,a,g),T=bh(h,a,_);w&&T||(this._active&&et(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function bh(d,t,a){for(let h=0;h<d.length;h++)if(d[h].identifier===a)return t[h]}function Vg(d,t){return Math.log(d/t)/Math.LN2}class Jx extends ap{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const h=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Vg(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Vg(this._distance,h),pinchAround:a}}}function Ug(d,t){return 180*d.angleWith(t)/Math.PI}class Qx extends ap{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a){const h=this._vector;if(this._vector=t[0].sub(t[1]),h&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Ug(this._vector,h),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,h=this._startVector;if(!h)return!1;const g=Ug(t,h);return Math.abs(g)<a}}function lp(d){return Math.abs(d.y)>Math.abs(d.x)}class ev extends ap{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,lp(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,h){const g=this._lastPoints;if(!g)return;const _=t[0].sub(g[0]),w=t[1].sub(g[1]);return this._map._cooperativeGestures&&!s.eJ()&&h.touches.length<3||(this._valid=this.gestureBeginsVertically(_,w,h.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(_.y+w.y)/2*-.5})}gestureBeginsVertically(t,a,h){if(this._valid!==void 0)return this._valid;const g=t.mag()>=2,_=a.mag()>=2;if(!g&&!_)return;if(!g||!_)return this._firstMove==null&&(this._firstMove=h),h-this._firstMove<100&&void 0;const w=t.y>0==a.y>0;return lp(t)&&lp(a)&&w}}const tv={panStep:100,bearingStep:15,pitchStep:10};class iv{constructor(){const t=tv;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,h=0,g=0,_=0,w=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?h=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?h=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?g=1:(t.preventDefault(),w=-1);break;case 40:t.shiftKey?g=-1:(t.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(h=0,g=0),{cameraAnimation:T=>{const C=T.getZoom();T.easeTo({duration:300,easeId:"keyboardHandler",easing:nv,zoom:a?Math.round(C)+a*(t.shiftKey?2:1):C,bearing:T.getBearing()+h*this._bearingStep,pitch:T.getPitch()+g*this._pitchStep,offset:[-_*this._panStep,-w*this._panStep],center:T.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function nv(d){return d*(2-d)}const rv=4.000244140625,fb=1/450;class pb{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._handler=a,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=fb,s.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||s.eJ()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const h=s.q.now(),g=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,a!==0&&a%rv==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=a,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(g*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=at(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const a=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const R=this._type==="wheel"&&Math.abs(this._delta)>rv?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&D!==0&&(D=1/D);const z=a(),k=Math.pow(2,z),F=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):k;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(F*D))),this._type==="wheel"&&(this._startZoom=z,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:a(),g=this._startZoom,_=this._easing;let w,T=!1;if(this._type==="wheel"&&g&&_){const R=Math.min((s.q.now()-this._lastWheelEventTime)/200,1),D=_(R);w=s.ai(g,h,D),R<1?this._frameId||(this._frameId=!0):T=!0}else w=h,T=!0;this._active=!0,T&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let C=w-a();return C*this._lastDelta<0&&(C=0),{noInertia:!0,needsRenderFrame:!T,zoomDelta:C,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=s.eK;if(this._prevEase){const h=this._prevEase,g=(s.q.now()-h.start)/h.duration,_=h.easing(g+.01)-h.easing(g),w=.27/Math.sqrt(_*_+1e-4)*.01,T=Math.sqrt(.0729-w*w);a=s.eI(w,T,.25,1)}return this._prevEase={start:s.q.now(),duration:t,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=J("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class rr{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class sv{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,a){return t.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:h.getZoom()+(t.shiftKey?-1:1),around:h.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mb{constructor(){this._tap=new Zl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,a,h){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=a[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(t,a,h))}touchmove(t,a,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const g=a[0],_=g.y-this._swipePoint.y;return this._swipePoint=g,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,a,h)}touchend(t,a,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(t,a,h)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gg{constructor(t,a,h){this._el=t,this._mousePan=a,this._touchPan=h}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class gb{constructor(t,a,h){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=a,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Sh{constructor(t,a,h,g){this._el=t,this._touchZoom=a,this._touchRotate=h,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Th=d=>d.zoom||d.drag||d.pitch||d.rotate;class $g extends s.A{}class cp{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,a){const h=s.at([],a,t);this.radius=s.ae(h[2]<0?s.eM([],h,this.constants):[h[0],h[1],0])}projectRay(t){s.eM(t,t,this.constants),s.au(t,t),s.eN(t,t,this.constants);const a=s.c1([],t,this.radius);if(a[2]>0){const h=s.c1([],[0,0,1],s.bG(a,[0,0,1])),g=s.c1([],s.au([],[a[0],a[1],0]),this.radius),_=s.d5([],a,s.c1([],s.at([],s.d5([],g,h),a),2));a[0]=_[0],a[1]=_[1]}return a}}function ia(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class up{constructor(t,a){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new rp(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new cp,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),s.aV(["handleEvent","handleWindowEvent"],this);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,_,w]of this._listeners){const T=g===document?this.handleWindowEvent:this.handleEvent;g.addEventListener(_,T,w)}}destroy(){for(const[t,a,h]of this._listeners){const g=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(a,g,h)}}_addDefaultHandlers(t){const a=this._map,h=a.getCanvasContainer();this._add("mapEvent",new Ng(a,t));const g=a.boxZoom=new Lg(a,t);this._add("boxZoom",g);const _=new Og,w=new sv;a.doubleClickZoom=new rr(w,_),this._add("tapZoom",_),this._add("clickZoom",w);const T=new mb;this._add("tapDragZoom",T);const C=a.touchPitch=new ev(a);this._add("touchPitch",C);const R=new op(t),D=new Bg(t);a.dragRotate=new gb(t,R,D),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]);const z=new jg(t),k=new Yx(a,t);a.dragPan=new Gg(h,z,k),this._add("mousePan",z),this._add("touchPan",k,["touchZoom","touchRotate"]);const F=new Qx,q=new Jx;a.touchZoomRotate=new Sh(h,q,F,T),this._add("touchRotate",F,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Dc(a));const $=a.scrollZoom=new pb(a,this);this._add("scrollZoom",$,["mousePan"]);const X=a.keyboard=new iv;this._add("keyboard",X);for(const Z of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[Z]&&a[Z].enable(t[Z])}_add(t,a,h){this._handlers.push({handlerName:t,handler:a,allowed:h}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Th(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,a,h){for(const g in t)if(g!==h&&(!a||a.indexOf(g)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const a=[];for(const h of t)this._el.contains(h.target)&&a.push(h);return a}handleEvent(t,a){this._updatingCamera=!0;const h=t.type==="renderFrame",g=h?void 0:t,_={needsRenderFrame:!1},w={},T={},C=t.touches?this._getMapTouches(t.touches):void 0,R=C?Xt(this._el,C):h?void 0:at(this._el,t);for(const{handlerName:k,handler:F,allowed:q}of this._handlers){if(!F.isEnabled())continue;let $;this._blockedByActive(T,q,k)?F.reset():F[a||t.type]&&($=F[a||t.type](t,R,C),this.mergeHandlerResult(_,w,$,k,g),$&&$.needsRenderFrame&&this._triggerRenderFrame()),($||F.isActive())&&(T[k]=F)}const D={};for(const k in this._previousActiveHandlers)T[k]||(D[k]=g);this._previousActiveHandlers=T,(Object.keys(D).length||ia(_))&&(this._changes.push([_,w,D]),this._triggerRenderFrame()),(Object.keys(T).length||ia(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:z}=_;z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],z(this._map))}mergeHandlerResult(t,a,h,g,_){if(!h)return;s.h(t,h);const w={handlerName:g,originalEvent:h.originalEvent||_};h.zoomDelta!==void 0&&(a.zoom=w),h.panDelta!==void 0&&(a.drag=w),h.pitchDelta!==void 0&&(a.pitch=w),h.bearingDelta!==void 0&&(a.rotate=w)}_applyChanges(){const t={},a={},h={};for(const[g,_,w]of this._changes)g.panDelta&&(t.panDelta=(t.panDelta||new s.P(0,0))._add(g.panDelta)),g.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(t.around=g.around),g.aroundCoord!==void 0&&(t.aroundCoord=g.aroundCoord),g.pinchAround!==void 0&&(t.pinchAround=g.pinchAround),g.noInertia&&(t.noInertia=g.noInertia),s.h(a,_),s.h(h,w);this._updateMapTransform(t,a,h),this._changes=[]}_updateMapTransform(t,a,h){const g=this._map,_=g.transform,w=ne=>[ne.x,ne.y,ne.z];if((ne=>{const ae=this._eventsInProgress.drag;return ae&&!this._handlersById[ae.handlerName].isActive()})()&&!ia(t)){const ne=_.zoom;_.cameraElevationReference="sea",this._originalZoom!=null&&_._orthographicProjectionAtLowPitch&&_.projection.name!=="globe"&&_.pitch===0?(_.cameraElevationReference="ground",_.zoom=this._originalZoom):(_.recenterOnTerrain(),_.cameraElevationReference="ground"),ne!==_.zoom&&this._map._update(!0)}if(_._isCameraConstrained&&g._stop(!0),!ia(t))return void this._fireEvents(a,h,!0);let{panDelta:T,zoomDelta:C,bearingDelta:R,pitchDelta:D,around:z,aroundCoord:k,pinchAround:F}=t;_._isCameraConstrained&&(C>0&&(C=0),_._isCameraConstrained=!1),F!==void 0&&(z=F),(C||(ne=>a[ne]&&!this._eventsInProgress[ne])("drag"))&&z&&(this._dragOrigin=w(_.pointCoordinate3D(z)),this._originalZoom=_.zoom,this._trackingEllipsoid.setup(_._camera.position,this._dragOrigin)),_.cameraElevationReference="sea",g._stop(!0),z=z||g.transform.centerPoint,R&&(_.bearing+=R),D&&(_.pitch+=D),_._updateCameraState();const q=[0,0,0];if(T)if(_.projection.name==="mercator"){const ne=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(z).dir),ae=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(z.sub(T)).dir);q[0]=ae[0]-ne[0],q[1]=ae[1]-ne[1]}else{const ne=_.pointCoordinate(z);if(_.projection.name==="globe"){T=T.rotate(-_.angle);const ae=_._pixelsPerMercatorPixel/_.worldSize;q[0]=-T.x*s.eL(s.aY(ne.y))*ae,q[1]=-T.y*s.eL(_.center.lat)*ae}else{const ae=_.pointCoordinate(z.sub(T));ne&&ae&&(q[0]=ae.x-ne.x,q[1]=ae.y-ne.y)}}const $=_.zoom,X=[0,0,0];if(C){const ne=w(k||_.pointCoordinate3D(z)),ae={dir:s.au([],s.at([],ne,_._camera.position))};if(ae.dir[2]<0){const de=_.zoomDeltaToMovement(ne,C);s.c1(X,ae.dir,de)}}const Z=s.d5(q,q,X);_._translateCameraConstrained(Z),C&&Math.abs(_.zoom-$)>1e-4&&_.recenterOnTerrain(),_.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,h,!0)}_fireEvents(t,a,h){const g=Th(this._eventsInProgress),_=Th(t),w={};for(const D in t){const{originalEvent:z}=t[D];this._eventsInProgress[D]||(w[`${D}start`]=z),this._eventsInProgress[D]=t[D]}!g&&_&&this._fireEvent("movestart",_.originalEvent);for(const D in w)this._fireEvent(D,w[D]);_&&this._fireEvent("move",_.originalEvent);for(const D in t){const{originalEvent:z}=t[D];this._fireEvent(D,z)}const T={};let C;for(const D in this._eventsInProgress){const{handlerName:z,originalEvent:k}=this._eventsInProgress[D];this._handlersById[z].isActive()||(delete this._eventsInProgress[D],C=a[z]||k,T[`${D}end`]=C)}for(const D in T)this._fireEvent(D,T[D]);const R=Th(this._eventsInProgress);if(h&&(g||_)&&!R){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=k=>k!==0&&-this._bearingSnap<k&&k<this._bearingSnap;D?(z(D.bearing||this._map.getBearing())&&(D.bearing=0),this._map.easeTo(D,{originalEvent:C})):(this._map.fire(new s.A("moveend",{originalEvent:C})),z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new s.A(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new $g("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Rr="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Oa extends s.E{constructor(t,a){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=a.respectPrefersReducedMotion!==!1,s.aV(["_renderFrameCallback"],this)}getCenter(){return new s.ci(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}panBy(t,a,h){return t=s.P.convert(t).mult(-1),this.panTo(this.transform.center,s.h({offset:t},a),h)}panTo(t,a,h){return this.easeTo(s.h({center:t},a),h)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,h){return this.easeTo(s.h({zoom:t},a),h)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,h){return this.easeTo(s.h({bearing:t},a),h)}resetNorth(t,a){return this.rotateTo(0,s.h({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(s.h({bearing:0,pitch:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}cameraForBounds(t,a){t=s.aG.convert(t);const h=a&&a.bearing||0,g=a&&a.pitch||0,_=t.getNorthWest(),w=t.getSouthEast();return this._cameraForBounds(this.transform,_,w,h,g,a)}_extendPadding(t){const a={top:0,right:0,bottom:0,left:0};return t==null?s.h({},a,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:s.h({},a,t)}_extendCameraOptions(t){return(t=s.h({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,a){const h=a.max[0]-a.min[0],g=a.max[1]-a.min[1];return h/g>t.aspect?h/(2*Math.tan(.5*t.fovX)*t.aspect):g/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,a,h,g,_,w){const T=t.clone(),C=this._extendCameraOptions(w);T.bearing=g,T.pitch=_;const R=s.ci.convert(a),D=s.ci.convert(h),z=.5*(R.lat+D.lat),k=.5*(R.lng+D.lng),F=s.eO(z,k),q=s.au([],F),$=s.au([],s.bF([],q,[0,1,0])),X=s.bF([],$,q),Z=[$[0],$[1],$[2],0,X[0],X[1],X[2],0,q[0],q[1],q[2],0,0,0,0,1],ne=[F,s.eO(R.lat,R.lng),s.eO(D.lat,R.lng),s.eO(D.lat,D.lng),s.eO(R.lat,D.lng),s.eO(z,R.lng),s.eO(z,D.lng),s.eO(R.lat,k),s.eO(D.lat,k)];let ae=s.d6.fromPoints(ne.map(je=>[s.bG($,je),s.bG(X,je),s.bG(q,je)]));const de=s.ad([],ae.center,Z);s.eP(de)===0&&s.eQ(de,0,0,1),s.au(de,de),s.c1(de,de,s.aB),T.center=s.eR(de);const _e=T.getWorldToCameraMatrix(),be=s.bi(new Float64Array(16),_e);ae=s.d6.applyTransform(ae,s.az([],_e,Z));const Te=this._extendAABB(ae,T,C,g);if(!Te)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ae=Te,s.ad(de,de,_e);const ye=.5*(ae.max[2]-ae.min[2]),xe=this._minimumAABBFrustumDistance(T,ae),ve=s.c1([],[0,0,1],ye),Oe=s.d5(ve,de,ve),Pe=xe+(T.pitch===0?0:s.bD(de,Oe)),Ye=T.globeCenterInViewSpace,Ue=s.at([],de,[Ye[0],Ye[1],Ye[2]]);s.au(Ue,Ue),s.c1(Ue,Ue,Pe);const Qe=s.d5([],de,Ue);s.ad(Qe,Qe,be);const _t=s.eB/s.aB,Fe=s.ae(Qe),Ae=s.cb(Math.max(Fe*_t-s.eB,Number.EPSILON),0),qe=Math.min(T.zoomFromMercatorZAdjusted(Ae),C.maxZoom);return qe>.5*(s.cX+s.cI)?(T.setProjection({name:"mercator"}),T.zoom=qe,this._cameraForBounds(T,a,h,g,_,w)):{center:T.center,zoom:qe,bearing:g,pitch:_}}_extendAABB(t,a,h,g){const _=.5*((h.padding.left||0)+(h.padding.right||0)),w=.5*((h.padding.top||0)+(h.padding.bottom||0)),T=w,C=_,R=_,D=w,z=a.width-(C+R),k=a.height-(T+D),F=s.at([],t.max,t.min),q=Math.min(z/F[0],k/F[1]),$=Math.min(a.scaleZoom(a.scale*q),h.maxZoom);if(isNaN($))return null;const X=a.scale/a.zoomScale($),Z=new s.d6([t.min[0]-C*X,t.min[1]-D*X,t.min[2]],[t.max[0]+R*X,t.max[1]+T*X,t.max[2]]),ne=(typeof h.offset.x=="number"&&typeof h.offset.y=="number"?new s.P(h.offset.x,h.offset.y):s.P.convert(h.offset)).rotate(-s.al(g));return Z.center[0]-=ne.x*X,Z.center[1]+=ne.y*X,Z}queryTerrainElevation(t,a){const h=this.transform.elevation;return h?(a=s.h({},{exaggerated:!0},a),h.getAtPoint(s.ac.fromLngLat(t),null,a.exaggerated)):null}_cameraForBounds(t,a,h,g,_,w){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,a,h,g,_,w);const T=t.clone(),C=this._extendCameraOptions(w);T.bearing=g,T.pitch=_;const R=s.ci.convert(a),D=s.ci.convert(h),z=new s.ci(R.lng,D.lat),k=new s.ci(D.lng,R.lat),F=T.project(R),q=T.project(D),$=this.queryTerrainElevation(R),X=this.queryTerrainElevation(D),Z=this.queryTerrainElevation(z),ne=this.queryTerrainElevation(k),ae=[[F.x,F.y,Math.min($||0,X||0,Z||0,ne||0)],[q.x,q.y,Math.max($||0,X||0,Z||0,ne||0)]];let de=s.d6.fromPoints(ae);const _e=T.getWorldToCameraMatrix(),be=s.bi(new Float64Array(16),_e);de=s.d6.applyTransform(de,_e);const Te=this._extendAABB(de,T,C,g);if(!Te)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");de=Te;const ye=.5*s.at([],de.max,de.min)[2],xe=this._minimumAABBFrustumDistance(T,de),ve=[0,0,1,0];s.aA(ve,ve,_e),s.eS(ve,ve);const Oe=s.c1([],ve,xe+ye),Pe=s.d5([],de.center,Oe);s.ad(de.center,de.center,be),s.ad(Pe,Pe,be);const Ye=T.unproject(new s.P(de.center[0],de.center[1])),Ue=s.eT(T.projection,Ye),Qe=Math.pow(2,Ue),_t=Math.min(T._zoomFromMercatorZ(Pe[2]*T.pixelsPerMeter*Qe/T.worldSize),C.maxZoom);return T.mercatorFromTransition&&_t<.5*(s.cX+s.cI)?(T.setProjection({name:"globe"}),T.zoom=_t,this._cameraForBounds(T,a,h,g,_,w)):{center:Ye,zoom:_t,bearing:g,pitch:_}}fitBounds(t,a,h){const g=this.cameraForBounds(t,a);return this._fitInternal(g,a,h)}fitScreenCoordinates(t,a,h,g,_){const w=s.P.convert(t),T=s.P.convert(a),C=new s.P(Math.min(w.x,T.x),Math.min(w.y,T.y)),R=new s.P(Math.max(w.x,T.x),Math.max(w.y,T.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(w,T))return this;const D=this.transform.pointLocation3D(C),z=this.transform.pointLocation3D(R),k=this.transform.pointLocation3D(new s.P(C.x,R.y)),F=this.transform.pointLocation3D(new s.P(R.x,C.y)),q=[Math.min(D.lng,z.lng,k.lng,F.lng),Math.min(D.lat,z.lat,k.lat,F.lat)],$=[Math.max(D.lng,z.lng,k.lng,F.lng),Math.max(D.lat,z.lat,k.lat,F.lat)],X=g&&g.pitch?g.pitch:this.getPitch(),Z=this._cameraForBounds(this.transform,q,$,h,X,g);return this._fitInternal(Z,g,_)}_fitInternal(t,a,h){return t?(a=s.h(t,a)).linear?this.easeTo(a,h):this.flyTo(a,h):this}jumpTo(t,a){this.stop();const h=t.preloadOnly?this.transform.clone():this.transform;let g=!1,_=!1,w=!1;"zoom"in t&&h.zoom!==+t.zoom&&(g=!0,h.zoom=+t.zoom),t.center!==void 0&&(h.center=s.ci.convert(t.center)),"bearing"in t&&h.bearing!==+t.bearing&&(_=!0,h.bearing=+t.bearing),"pitch"in t&&h.pitch!==+t.pitch&&(w=!0,h.pitch=+t.pitch);const T=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!h.isPaddingEqual(T))if(t.retainPadding===!1){const C=h.clone();C.padding=T,h.setLocationAtPoint(h.center,C.centerPoint)}else h.padding=T;return t.preloadOnly?(this._preloadTiles(h),this):(this.fire(new s.A("movestart",a)).fire(new s.A("move",a)),g&&this.fire(new s.A("zoomstart",a)).fire(new s.A("zoom",a)).fire(new s.A("zoomend",a)),_&&this.fire(new s.A("rotatestart",a)).fire(new s.A("rotate",a)).fire(new s.A("rotateend",a)),w&&this.fire(new s.A("pitchstart",a)).fire(new s.A("pitch",a)).fire(new s.A("pitchend",a)),this.fire(new s.A("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(Rr),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,a){const h=this.transform;if(!h.projection.supportsFreeCamera)return s.w(Rr),this;this.stop();const g=h.zoom,_=h.pitch,w=h.bearing;h.setFreeCameraOptions(t);const T=g!==h.zoom,C=_!==h.pitch,R=w!==h.bearing;return this.fire(new s.A("movestart",a)).fire(new s.A("move",a)),T&&this.fire(new s.A("zoomstart",a)).fire(new s.A("zoom",a)).fire(new s.A("zoomend",a)),R&&this.fire(new s.A("rotatestart",a)).fire(new s.A("rotate",a)).fire(new s.A("rotateend",a)),C&&this.fire(new s.A("pitchstart",a)).fire(new s.A("pitch",a)).fire(new s.A("pitchend",a)),this.fire(new s.A("moveend",a)),this}easeTo(t,a){this._stop(!1,t.easeId),((t=s.h({offset:[0,0],duration:500,easing:s.eK},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const h=this.transform,g=this.getZoom(),_=this.getBearing(),w=this.getPitch(),T=this.getPadding(),C="zoom"in t?+t.zoom:g,R="bearing"in t?this._normalizeBearing(t.bearing,_):_,D="pitch"in t?+t.pitch:w,z=this._extendPadding(t.padding),k=s.P.convert(t.offset);let F,q,$;if(h.projection.name==="globe"){const ve=s.ac.fromLngLat(h.center),Oe=k.rotate(-h.angle);ve.x+=Oe.x/h.worldSize,ve.y+=Oe.y/h.worldSize;const Pe=ve.toLngLat(),Ye=s.ci.convert(t.center||Pe);this._normalizeCenter(Ye),F=h.centerPoint.add(Oe),q=new s.P(ve.x,ve.y).mult(h.worldSize),$=new s.P(s.aD(Ye.lng),s.aH(Ye.lat)).mult(h.worldSize).sub(q)}else{F=h.centerPoint.add(k);const ve=h.pointLocation(F),Oe=s.ci.convert(t.center||ve);this._normalizeCenter(Oe),q=h.project(ve),$=h.project(Oe).sub(q)}const X=h.zoomScale(C-g);let Z,ne;t.around&&(Z=s.ci.convert(t.around),ne=h.locationPoint(Z));const ae=this._zooming||C!==g,de=this._rotating||_!==R,_e=this._pitching||D!==w,be=!h.isPaddingEqual(z),Te=t.retainPadding===!1?h.clone():h,ye=ve=>Oe=>{if(ae&&(ve.zoom=s.ai(g,C,Oe)),de&&(ve.bearing=s.ai(_,R,Oe)),_e&&(ve.pitch=s.ai(w,D,Oe)),be&&(Te.interpolatePadding(T,z,Oe),F=Te.centerPoint.add(k)),Z)ve.setLocationAtPoint(Z,ne);else{const Pe=ve.zoomScale(ve.zoom-g),Ye=C>g?Math.min(2,X):Math.max(.5,X),Ue=Math.pow(Ye,1-Oe),Qe=ve.unproject(q.add($.mult(Oe*Ue)).mult(Pe));ve.setLocationAtPoint(ve.renderWorldCopies?Qe.wrap():Qe,F)}return t.preloadOnly||this._fireMoveEvents(a),ve};if(t.preloadOnly){const ve=this._emulate(ye,t.duration,h);return this._preloadTiles(ve),this}const xe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ae,this._rotating=de,this._pitching=_e,this._padding=be,this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,xe),this._ease(ye(h),ve=>{h.cameraElevationReference==="sea"&&h.recenterOnTerrain(),this._afterEase(a,ve)},t),this}_prepareEase(t,a,h={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),a||h.moving||this.fire(new s.A("movestart",t)),this._zooming&&!h.zooming&&this.fire(new s.A("zoomstart",t)),this._rotating&&!h.rotating&&this.fire(new s.A("rotatestart",t)),this._pitching&&!h.pitching&&this.fire(new s.A("pitchstart",t))}_fireMoveEvents(t){this.fire(new s.A("move",t)),this._zooming&&this.fire(new s.A("zoom",t)),this._rotating&&this.fire(new s.A("rotate",t)),this._pitching&&this.fire(new s.A("pitch",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const h=this._zooming,g=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new s.A("zoomend",t)),g&&this.fire(new s.A("rotateend",t)),_&&this.fire(new s.A("pitchend",t)),this.fire(new s.A("moveend",t))}flyTo(t,a){if(this._prefersReducedMotion(t)){const je=s.aF(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(je,a)}this.stop(),t=s.h({offset:[0,0],speed:1.2,curve:1.42,easing:s.eK},t);const h=this.transform,g=this.getZoom(),_=this.getBearing(),w=this.getPitch(),T=this.getPadding(),C="zoom"in t?s.ay(+t.zoom,h.minZoom,h.maxZoom):g,R="bearing"in t?this._normalizeBearing(t.bearing,_):_,D="pitch"in t?+t.pitch:w,z=this._extendPadding(t.padding),k=h.zoomScale(C-g),F=s.P.convert(t.offset);let q=h.centerPoint.add(F);const $=h.pointLocation(q),X=s.ci.convert(t.center||$);this._normalizeCenter(X);const Z=h.project($),ne=h.project(X).sub(Z);let ae=t.curve;const de=Math.max(h.width,h.height),_e=de/k,be=ne.mag();if("minZoom"in t){const je=s.ay(Math.min(t.minZoom,g,C),h.minZoom,h.maxZoom),nt=de/h.zoomScale(je-g);ae=Math.sqrt(nt/be*2)}const Te=ae*ae;function ye(je){const nt=(_e*_e-de*de+(je?-1:1)*Te*Te*be*be)/(2*(je?_e:de)*Te*be);return Math.log(Math.sqrt(nt*nt+1)-nt)}function xe(je){return(Math.exp(je)-Math.exp(-je))/2}function ve(je){return(Math.exp(je)+Math.exp(-je))/2}const Oe=ye(0);let Pe=function(je){return ve(Oe)/ve(Oe+ae*je)},Ye=function(je){return de*((ve(Oe)*(xe(nt=Oe+ae*je)/ve(nt))-xe(Oe))/Te)/be;var nt},Ue=(ye(1)-Oe)/ae;if(Math.abs(be)<1e-6||!isFinite(Ue)){if(Math.abs(de-_e)<1e-6)return this.easeTo(t,a);const je=_e<de?-1:1;Ue=Math.abs(Math.log(_e/de))/ae,Ye=function(){return 0},Pe=function(nt){return Math.exp(je*ae*nt)}}t.duration="duration"in t?+t.duration:1e3*Ue/("screenSpeed"in t?+t.screenSpeed/ae:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const Qe=_!==R,_t=D!==w,Fe=!h.isPaddingEqual(z),Ae=t.retainPadding===!1?h.clone():h,qe=je=>nt=>{const st=nt*Ue,ct=1/Pe(st);je.zoom=nt===1?C:g+je.scaleZoom(ct),Qe&&(je.bearing=s.ai(_,R,nt)),_t&&(je.pitch=s.ai(w,D,nt)),Fe&&(Ae.interpolatePadding(T,z,nt),q=Ae.centerPoint.add(F));const St=nt===1?X:je.unproject(Z.add(ne.mult(Ye(st))).mult(ct));return je.setLocationAtPoint(je.renderWorldCopies?St.wrap():St,q),je._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(a),je};if(t.preloadOnly){const je=this._emulate(qe,t.duration,h);return this._preloadTiles(je),this}return this._zooming=!0,this._rotating=Qe,this._pitching=_t,this._padding=Fe,this._prepareEase(a,!1),this._ease(qe(h),()=>this._afterEase(a),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const h=this._onEaseEnd;this._onEaseEnd=void 0,h.call(this,a)}if(!t){const h=this.handlers;h&&h.stop(!1)}return this}_ease(t,a,h){h.animate===!1||h.duration===0?(t(1),a()):(this._easeStart=s.q.now(),this._easeOptions=h,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((s.q.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,a){t=s.bQ(t,-180,180);const h=Math.abs(t-a);return Math.abs(t-360-a)<h&&(t-=360),Math.abs(t+360-a)<h&&(t+=360),t}_normalizeCenter(t){const a=this.transform;if(a.maxBounds||a.projection.name!=="globe"&&!a.renderWorldCopies)return;const h=t.lng-a.center.lng;t.lng+=h>180?-360:h<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&s.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,a,h){const g=Math.ceil(15*a/1e3),_=[],w=t(h.clone());for(let T=0;T<=g;T++){const C=w(T/g);_.push(C.clone())}return _}_preloadTiles(t,a){}}class zu{constructor(t={}){this.options=t,s.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const a=this.options&&this.options.compact,h=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=J("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=J("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",h);const g=J("span","mapboxgl-ctrl-icon",this._compactButton);return g.setAttribute("aria-hidden","true"),g.setAttribute("title",h),this._innerContainer=J("div","mapboxgl-ctrl-attrib-inner",this._container),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(t){const h=a.reduce((g,_,w)=>(_.value&&(g+=`${_.key}=${_.value}${w<a.length-1?"&":""}`),g),"?");t.href=`${s.e.FEEDBACK_URL}/${h}#${np(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const a=this._map.style._mergedSourceCaches;for(const g in a){const _=a[g];if(_.used){const w=_.getSource();w.attribution&&t.indexOf(w.attribution)<0&&t.push(w.attribution)}}t.sort((g,_)=>g.length-_.length),t=t.filter((g,_)=>{for(let w=_+1;w<t.length;w++)if(t[w].indexOf(g)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const h=t.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,t.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Eh{constructor(){s.aV(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=J("div","mapboxgl-ctrl");const a=J("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const a in t){const h=t[a].getSource();if(h.hasOwnProperty("mapbox_logo")&&!h.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const a=t[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class Hg{constructor(){s.aV(["_onIndoorUpdate"],this)}onAdd(t){return this._map=t,this._container=J("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("indoorupdate",a=>this._onIndoorUpdate({selectedFloorId:a.selectedFloorId,floors:a.floors})),this._container}_createButton(t,a){const h=J("button",t,this._container);return h.type="button",h.addEventListener("click",a),h}_setButtonTitle(t,a){this._map&&(t.setAttribute("aria-label",a),t.innerHTML=`<strong>${a}</strong>`,t.firstElementChild&&t.firstElementChild.setAttribute("title",a))}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("indoorupdate",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(t){if(!t||!t.floors)return void(this._container.style.display="none");const a=this._model;this._model=t,this._container.style.display="inline-block";const h=t.floors.sort((g,_)=>g.levelOrder-_.levelOrder);a?(Array.from(this._container.children).forEach(g=>g.remove()),this.addCurrentFloors(h)):this.addCurrentFloors(h)}addCurrentFloors(t){for(const a of t){const h=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(a.id),Array.from(this._container.children).forEach(g=>{g.classList.remove("mapboxgl-ctrl-level-button-selected")}),h.classList.add("mapboxgl-ctrl-level-button-selected")});this._setButtonTitle(h,a.shortName),this._model&&a.id===this._model.selectedFloorId&&(this._map._selectIndoorFloor(a.id),h.classList.add("mapboxgl-ctrl-level-button-selected")),this._container.append(h)}}}class ov{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,h=a?this._queue.concat(a):this._queue;for(const g of h)if(g.id===t)return void(g.cancelled=!0)}run(t=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const h of a)if(!h.cancelled&&(h.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Ch{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const a=s.dx((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,a,h){this._start=this.getValue(a),this._end=t,this._startTime=a,this._endTime=a+h}}const _b={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class av extends s.A{constructor(t,a,h,g){const{point:_,lngLat:w,originalEvent:T,target:C}=t;super(t.type,{point:_,lngLat:w,originalEvent:T,target:C}),this.preventDefault=()=>{t.preventDefault()},this.id=a,this.interaction=h,this.feature=g}}class qg{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,a){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const h=a.filter;let g=a.type;h&&this.filters.set(t,s.b3(h)),g==="mouseover"&&(g="mouseenter"),g==="mouseout"&&(g="mouseleave");const _=this.interactionsByType.get(g)||new Map;g==="mouseenter"||g==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,a)):_.size===0&&this.map.on(g,this.handleType),_.size===0&&this.interactionsByType.set(g,_),_.set(t,a),this.typeById.set(t,g)}get(t){const a=this.typeById.get(t);if(!a)return;const h=this.interactionsByType.get(a);return h?h.get(t):void 0}remove(t){const a=this.typeById.get(t);if(!a)return;this.typeById.delete(t),this.filters.delete(t);const h=this.interactionsByType.get(a);h&&(h.delete(t),a==="mouseenter"||a==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):h.size===0&&this.map.off(a,this.handleType))}queryTargets(t,a){const h=[];for(const[g,_]of a)_.target&&h.push({targetId:g,target:_.target,filter:this.filters.get(g)});return this.map.style.queryRenderedTargets(t,h,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const a=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());a.length&&(t.type="mouseenter",this.handleType(t,a));const h=new Map;for(const[g,{feature:_}]of this.prevHoveredFeatures)this.hoveredFeatures.has(g)||h.set(_.id,_);h.size&&(t.type="mouseleave",this.handleType(t,Array.from(h.values())))}handleOut(t){const a=Array.from(this.hoveredFeatures.values()).map(({feature:h})=>h);a.length&&(t.type="mouseleave",this.handleType(t,a)),this.hoveredFeatures.clear()}handleType(t,a){const h=t.type==="mouseenter";if(h&&!this.interactionsByType.has(t.type))return void s.w("mouseenter interaction required for mouseleave to work.");const g=Array.from(this.interactionsByType.get(t.type)).reverse(),_=!!a;a=a||this.queryTargets(t.point,g);let w=!1;const T=new Set;for(const C of a){for(const[R,D]of g){if(!D.target)continue;const z=C.variants?C.variants[R]:null;if(z){for(const k of z){if(uf(k,C,T,R))continue;const F=new s.dr(C,k),q=Vd(k,C,R);_&&(F.state=this.map.getFeatureState(F));const $=h?this.prevHoveredFeatures.get(q):null,X=new av(t,R,D,F),Z=$?$.stop:D.handler(X);if(h&&this.hoveredFeatures.set(q,{feature:C,stop:Z}),Z!==!1){w=!0;break}}if(w)break}}if(w)break}if(!w)for(const[C,R]of g){const{handler:D,target:z}=R;if(!z&&D(new av(t,C,R,null))!==!1)break}}}function Wg(d,t){if(Array.isArray(d)&&Array.isArray(t)){const a=new Set(d),h=new Set(t);return a.size===h.size&&d.every(g=>h.has(g))}return s.bv(d,t)}const Ah={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Ou={showCompass:!0,showZoom:!0,visualizePitch:!1};class nl{constructor(t,a,h=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new op({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,h&&(this.mousePitch=new Bg({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),s.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(t,a){this.mouseRotate.mousedown(t,a),this.mousePitch&&this.mousePitch.mousedown(t,a),Ie()}move(t,a){const h=this.map,g=this.mouseRotate.mousemoveWindow(t,a),_=g&&g.bearingDelta;if(_&&h.setBearing(h.getBearing()+_),this.mousePitch){const w=this.mousePitch.mousemoveWindow(t,a),T=w&&w.pitchDelta;T&&h.setPitch(h.getPitch()+T)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){pe(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(s.h({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),at(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,at(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Xt(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Xt(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function na(d,t,a){if(d=new s.ci(d.lng,d.lat),t){const h=new s.ci(d.lng-360,d.lat),g=new s.ci(d.lng+360,d.lat),_=360*Math.ceil(Math.abs(d.lng-a.center.lng)/360),w=a.locationPoint3D(d).distSqr(t),T=t.x<0||t.y<0||t.x>a.width||t.y>a.height;a.locationPoint3D(h).distSqr(t)<w&&(T||Math.abs(h.lng-a.center.lng)<_)?d=h:a.locationPoint3D(g).distSqr(t)<w&&(T||Math.abs(g.lng-a.center.lng)<_)&&(d=g)}for(;Math.abs(d.lng-a.center.lng)>180;){const h=a.locationPoint3D(d);if(h.x>=0&&h.y>=0&&h.x<=a.width&&h.y<=a.height)break;d.lng>a.center.lng?d.lng-=360:d.lng+=360}return d}const No={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Zs={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Lo extends s.E{constructor(t,a){super(),(t instanceof HTMLElement||a)&&(t=s.h({element:t},a)),s.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:h="center",color:g="#3FB1CE",scale:_=1,draggable:w=!1,clickTolerance:T=0,rotation:C=Zs.rotation,rotationAlignment:R=Zs.rotationAlignment,pitchAlignment:D=Zs.pitchAlignment,occludedOpacity:z=Zs.occludedOpacity,altitude:k=Zs.altitude}=t||{};this._anchor=h,this._color=g,this._scale=_,this._draggable=w,this._clickTolerance=T,this._rotation=C,this._rotationAlignment=R,this._pitchAlignment=D,this._occludedOpacity=z,this._altitude=k,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=s.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=s.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",$=>{$.preventDefault()}),this._element.addEventListener("mousedown",$=>{$.preventDefault()});const F=this._element.classList;for(const $ in No)F.remove(`mapboxgl-marker-anchor-${$}`);F.add(`mapboxgl-marker-anchor-${this._anchor}`);const q=t&&t.className?t.className.trim().split(/\s+/):[];F.add(...q),this._popup=null}_createDefaultMarker(){const t=J("div"),a=ce("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const h=ce("radialGradient",{id:"shadowGradient"},ce("defs",{},a));ce("stop",{offset:"10%","stop-opacity":.4},h),ce("stop",{offset:"100%","stop-opacity":.05},h),ce("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},a)}return ce("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},a),ce("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},a),ce("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},a),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=s.ci.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||Zs.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const g=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const a=t.code,h=t.charCode||t.keyCode;a!=="Space"&&a!=="Enter"&&h!==32&&h!==13||this.togglePopup()}_onMapClick(t){const a=t.originalEvent.target,h=this._element;this._popup&&(a===h||h.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,a=this._pos;if(!t||!a)return!1;const h=t.unproject(a,this._altitude),g=t.getFreeCameraOptions();if(!g.position)return!1;const _=g.position.toLngLat();return _.distanceTo(h)<.9*_.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const a=this._pos;if(!a||a.x<0||a.x>t.transform.width||a.y<0||a.y>t.transform.height)return void this._clearFadeTimer();const h=t.unproject(a,this._altitude);let g;t._showingGlobe()&&s.eW(t.transform,this._lngLat)?g=0:(g=1-t._queryFogOpacity(h),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(g*=this._occludedOpacity)),this._element.style.opacity=`${g}`,this._element.style.pointerEvents=g>0?"auto":"none",this._popup&&this._popup._setOpacity(g),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${No[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){const t=this._pos,a=this._map,h=this.getPitchAlignment();if(!a||!t||h!=="map")return"";if(!a._showingGlobe()){const C=a.getPitch();return C?`rotateX(${C}deg)`:""}const g=s.cU(s.eX(a.transform,this._lngLat)),_=t.sub(s.eY(a.transform)),w=Math.abs(_.x)+Math.abs(_.y);if(w===0)return"";const T=g/w;return`rotateX(${-_.y*T}deg) rotateY(${_.x*T}deg)`}_calculateZTransform(){const t=this._pos,a=this._map;if(!a||!t)return"";let h=0;const g=this.getRotationAlignment();if(g==="map")if(a._showingGlobe()){const _=a.project(new s.ci(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),w=a.project(new s.ci(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(_);h=s.cU(Math.atan2(w.y,w.x))-90}else h=-a.getBearing();else if(g==="horizon"){const _=s.af(4,6,a.getZoom()),w=s.eY(a.transform);w.y+=_*a.transform.height;const T=t.sub(w),C=s.cU(Math.atan2(T.y,T.x));h=(C>90?C-270:C+90)*(1-_)}return h+=this._rotation,h?`rotateZ(${h}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=na(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=s.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const a=this._map;if(!a)return;const h=this._pointerdownPos,g=this._positionDelta;if(h&&g){if(!this._isDragging){const _=this._clickTolerance||a._clickTolerance;if(t.point.dist(h)<_)return;this._isDragging=!0}this._pos=t.point.sub(g),this._lngLat=a.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.A("dragstart"))),this.fire(new s.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.A("dragend")),this._state="inactive"}_addDragHandler(t){const a=this._map,h=this._pos;a&&h&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(h),this._pointerdownPos=t.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const a=this._map;return a&&(t?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||Zs.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||Zs.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||Zs.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||Zs.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const yb={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},xb={maxWidth:100,unit:"metric"},vb={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},wb={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},lv=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Fs(d=new s.P(0,0),t="bottom"){if(typeof d=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(t){case"top":return new s.P(0,d);case"top-left":return new s.P(a,a);case"top-right":return new s.P(-a,a);case"bottom":return new s.P(0,-d);case"bottom-left":return new s.P(a,-a);case"bottom-right":return new s.P(-a,-a);case"left":return new s.P(d,0);case"right":return new s.P(-d,0)}return new s.P(0,0)}return d instanceof s.P||Array.isArray(d)?s.P.convert(d):s.P.convert(d[t]||[0,0])}return{version:O,supported:ue.supported,setRTLTextPlugin:s.f0,getRTLTextPluginStatus:s.e$,Map:class extends Oa{constructor(d){G.mark(j.create);const t=d;if((d=s.h({},Ah,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&s.eU(window)&&(d.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Vm(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies,null,null),d),this._repaint=!!d.repaint,this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new ov,this._domRenderTaskQueue=new ov,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.a$(),this._locale=s.h({},_b,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._tessellationStep=d.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=d.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Ch(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=d.scaleFactor,this._requestManager=new Pt(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,this._contextCreateOptions=d.contextCreateOptions?Object.assign({},d.contextCreateOptions):{},typeof d.container=="string"){const a=document.getElementById(d.container);if(!a)throw new Error(`Container '${d.container.toString()}' not found.`);this._container=a}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),this._spriteFormat=d.spriteFormat,s.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new db),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new up(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,(d.style||!d.testMode)&&this.setStyle(d.style||s.e.DEFAULT_STYLE,{config:d.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this.indoor=new Ww(this),d.hash&&(this._hash=new ip(typeof d.hash=="string"&&d.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch});const a=d.bounds;a&&(this.resize(),this.fitBounds(a,s.h({},d.fitBoundsOptions,{duration:0})))}this.resize(),d.attributionControl&&this.addControl(new zu({customAttribution:d.customAttribution})),this._logoControl=new Eh,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new s.A(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new s.A(`${a.dataType}dataloading`,a))}),this._interactions=new qg(this)}_getMapId(){return this._mapId}addControl(d,t){if(t===void 0&&(t=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new s.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=d.onAdd(this);this._controls.push(d);const h=this._controlPositions[t];return t.indexOf("bottom")!==-1?h.insertBefore(a,h.firstChild):h.appendChild(a),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new s.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(d);return t>-1&&this._controls.splice(t,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new s.A("movestart",d)).fire(new s.A("move",d)),this.fire(new s.A("resize",d)),t&&this.fire(new s.A("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(s.aG.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new s.A("zoomstart")).fire(new s.A("zoom")).fire(new s.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new s.A("zoomstart")).fire(new s.A("zoom")).fire(new s.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new s.A("pitchstart")).fire(new s.A("pitch")).fire(new s.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new s.A("pitchstart")).fire(new s.A("pitch")).fire(new s.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(d){return this._scaleFactor=d,this.painter.scaleFactor=d,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(t=>t==="auto"?navigator.language:t):d}setLanguage(d){const t=this._parseLanguage(d);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const d=this.transform,t=d.projection.name;let a;t==="globe"&&d.zoom>=s.cI?(d.setMercatorFromTransition(),a=!0):t==="mercator"&&d.zoom<s.cI&&(d.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(d,t){return this._updateProjection(d||t||{name:"mercator"})}_updateProjection(d){let t;return t=d.name==="globe"&&this.transform.zoom>=s.cI?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(d,t){return this.transform.locationPoint3D(s.ci.convert(d),t)}unproject(d,t){return this.transform.pointLocation3D(s.P.convert(d),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,t,a){const h=g=>{let _=[];if(Array.isArray(t)){const w=t.filter(T=>this.getLayer(T));_=w.length?this.queryRenderedFeatures(g,{layers:w}):[]}else _=this.queryRenderedFeatures(g,{target:t});return _};if(d==="mouseenter"||d==="mouseover"){let g=!1;return{listener:a,targets:t,delegates:{mousemove:w=>{const T=h(w.point);T.length?g||(g=!0,a.call(this,new Qn(d,this,w.originalEvent,{features:T}))):g=!1},mouseout:()=>{g=!1}}}}if(d==="mouseleave"||d==="mouseout"){let g=!1;return{listener:a,targets:t,delegates:{mousemove:T=>{h(T.point).length?g=!0:g&&(g=!1,a.call(this,new Qn(d,this,T.originalEvent)))},mouseout:T=>{g&&(g=!1,a.call(this,new Qn(d,this,T.originalEvent)))}}}}{const g=_=>{const w=h(_.point);w.length&&(_.features=w,a.call(this,_),delete _.features)};return{listener:a,targets:t,delegates:{[d]:g}}}}on(d,t,a){if(typeof t=="function"||a===void 0)return super.on(d,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const h=this._createDelegatedListener(d,t,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(h);for(const g in h.delegates)this.on(g,h.delegates[g]);return this}once(d,t,a){if(typeof t=="function"||a===void 0)return super.once(d,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const h=this._createDelegatedListener(d,t,a);for(const g in h.delegates)this.once(g,h.delegates[g]);return this}off(d,t,a){if(typeof t=="function"||a===void 0)return super.off(d,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const h=this._delegatedListeners?this._delegatedListeners[d]:void 0;return h&&(g=>{for(let _=0;_<g.length;_++){const w=g[_];if(w.listener===a&&Wg(w.targets,t)){for(const T in w.delegates)this.off(T,w.delegates[T]);return g.splice(_,1),this}}})(h),this}queryRenderedFeatures(d,t){if(!this.style)return[];if(d===void 0||d instanceof s.P||Array.isArray(d)||t!==void 0||(t=d,d=void 0),d=d||[[0,0],[this.transform.width,this.transform.height]],!t){const _=this.style.queryRenderedFeatures(d,void 0,this.transform),w=this.style.queryRenderedFeatureset(d,void 0,this.transform);return _.concat(w)}let a=!0;if(t.target&&(a=this._isTargetValid(t.target),a&&!t.layers))return this.style.queryRenderedFeatureset(d,t,this.transform);let h=!0;if(t.layers&&Array.isArray(t.layers)){for(const _ of t.layers)if(!this._isValidId(_)){h=!1;break}if(h&&!t.target)return this.style.queryRenderedFeatures(d,t,this.transform)}let g=[];return h&&(g=g.concat(this.style.queryRenderedFeatures(d,t,this.transform))),a&&(g=g.concat(this.style.queryRenderedFeatureset(d,t,this.transform))),g}querySourceFeatures(d,t){return!d||typeof d=="string"&&!this._isValidId(d)?[]:this.style.querySourceFeatures(d,t)}isPointOnSurface(d){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&s.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(d))}addInteraction(d,t){return this._interactions.add(d,t),this}removeInteraction(d){return this._interactions.remove(d),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(d){return this._cooperativeGestures=d,this}setStyle(d,t){return t=s.h({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&d&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(d,(a,h)=>{if(a){const g=typeof a=="string"?a:a instanceof Error?a.message:a.error;s.w(`Unable to perform style diff: ${g}. Rebuilding the style from scratch.`),this._updateStyle(d,t)}else h&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(d,t))}_getUIString(d){const t=this._locale[d];if(t==null)throw new Error(`Missing UI string '${d}'`);return t}_updateStyle(d,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d){const a=s.h({},t);t&&t.config&&(a.initialConfig=t.config,delete a.config),this.style=new ea(this,a).load(d),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ea(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(d){return d==null?(this.fire(new s.z(new Error("IDs can't be empty."))),!1):!s.dk(d)||(this.fire(new s.z(new Error(`IDs can't contain special symbols: "${d}".`))),!1)}_isTargetValid(d){return"featuresetId"in d?this._isValidId("importId"in d?d.importId:d.featuresetId):"layerId"in d&&this._isValidId(d.layerId)}_areTargetsValid(d){if(Array.isArray(d)){for(const t of d)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(d)}addSource(d,t){return this._isValidId(d)?(this._lazyInitEmptyStyle(),this.style.addSource(d,t),this._update(!0)):this}isSourceLoaded(d){return!!this._isValidId(d)&&!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(d,t,a){this._lazyInitEmptyStyle(),this.style.addSourceType(d,t,a)}removeSource(d){return this._isValidId(d)?(this.style.removeSource(d),this._updateTerrain(),this._update(!0)):this}getSource(d){return this._isValidId(d)?this.style.getOwnSource(d):null}addImage(d,t,{pixelRatio:a=1,sdf:h=!1,stretchX:g,stretchY:_,content:w}={}){this._lazyInitEmptyStyle();const T=s.I.from(d);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:C,height:R,data:D}=s.q.getImageData(t);this.style.addImage(T,{data:new s.r({width:C,height:R},D),pixelRatio:a,stretchX:g,stretchY:_,content:w,sdf:h,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new s.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:R}=t,D=t;this.style.addImage(T,{data:new s.r({width:C,height:R},new Uint8Array(D.data)),pixelRatio:a,stretchX:g,stretchY:_,content:w,sdf:h,usvg:!1,version:0,userImage:D}),D.onAdd&&D.onAdd(this,d)}}updateImage(d,t){this._lazyInitEmptyStyle();const a=s.I.from(d),h=this.style.getImage(a);if(!h)return void this.fire(new s.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?s.q.getImageData(t):t,{width:_,height:w,data:T}=g;if(_===void 0||w===void 0)return void this.fire(new s.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==(h.usvg?h.icon.usvg_tree.width:h.data.width)||w!==(h.usvg?h.icon.usvg_tree.height:h.data.height))return void this.fire(new s.z(new Error(`The width and height of the updated image (${_}, ${w})
                must be that same as the previous version of the image
                (${h.data.width}, ${h.data.height})`)));const C=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let R=!1;h.usvg?(h.data=new s.r({width:_,height:w},new Uint8Array(T)),h.usvg=!1,h.icon=void 0,R=!0):h.data.replace(T,C),this.style.updateImage(a,h,R)}hasImage(d){return d?!!this.style&&!!this.style.getImage(s.I.from(d)):(this.fire(new s.z(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(s.I.from(d))}loadImage(d,t){s.o(this._requestManager.transformRequest(d,s.R.Image),(a,h)=>{t(a,h instanceof HTMLImageElement?s.q.getImageData(h):h)})}listImages(){return this.style.listImages().map(d=>d.name)}addModel(d,t){this._lazyInitEmptyStyle(),this.style.addModel(d,t)}hasModel(d){return d?this.style.hasModel(d):(this.fire(new s.z(new Error("Missing required model id"))),!1)}removeModel(d){this.style.removeModel(d)}listModels(){return this.style.listModels()}addLayer(d,t){return this._isValidId(d.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(d,t),this._update(!0)):this}getSlot(d){const t=this.getLayer(d);return t&&t.slot||null}setSlot(d,t){return this.style.setSlot(d,t),this.style.mergeLayers(),this._update(!0)}addImport(d,t){return this.style.addImport(d,t).catch(a=>this.fire(new s.z(new Error("Failed to add import",a)))),this}updateImport(d,t){return typeof t!="string"&&t.id!==d?(this.removeImport(d),this.addImport(t)):(this.style.updateImport(d,t),this._update(!0))}removeImport(d){return this.style.removeImport(d),this}moveImport(d,t){return this.style.moveImport(d,t),this._update(!0)}moveLayer(d,t){return this._isValidId(d)?(this.style.moveLayer(d,t),this._update(!0)):this}removeLayer(d){return this._isValidId(d)?(this.style.removeLayer(d),this._update(!0)):this}getLayer(d){if(!this._isValidId(d))return null;const t=this.style.getOwnLayer(d);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(d,t,a){return this._isValidId(d)?(this.style.setLayerZoomRange(d,t,a),this._update(!0)):this}setFilter(d,t,a={}){return this._isValidId(d)?(this.style.setFilter(d,t,a),this._update(!0)):this}getFilter(d){return this._isValidId(d)?this.style.getFilter(d):null}setPaintProperty(d,t,a,h={}){return this._isValidId(d)?(this.style.setPaintProperty(d,t,a,h),this._update(!0)):this}getPaintProperty(d,t){return this._isValidId(d)?this.style.getPaintProperty(d,t):null}setLayoutProperty(d,t,a,h={}){return this._isValidId(d)?(this.style.setLayoutProperty(d,t,a,h),this._update(!0)):this}getLayoutProperty(d,t){return this._isValidId(d)?this.style.getLayoutProperty(d,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(d){return this.style.setGlyphsUrl(d),this._update(!0)}getSchema(d){return this.style.getSchema(d)}setSchema(d,t){return this.style.setSchema(d,t),this._update(!0)}getConfig(d){return this.style.getConfig(d)}setConfig(d,t){return this.style.setConfig(d,t),this._update(!0)}getConfigProperty(d,t){return this.style.getConfigProperty(d,t)}setConfigProperty(d,t,a){return this.style.setConfigProperty(d,t,a),this._update(!0)}getFeaturesetDescriptors(d){return this.style.getFeaturesetDescriptors(d)}setLights(d){if(this._lazyInitEmptyStyle(),d&&d.length===1&&d[0].type==="flat"){const t=d[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(d),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const d=this.style.getLights()||[];return d.length===0&&d.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),d}setLight(d,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:d}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(d){return this._lazyInitEmptyStyle(),this.style.setSnow(d),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(d){return this._lazyInitEmptyStyle(),this.style.setRain(d),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(d){return this._lazyInitEmptyStyle(),this.style.setColorTheme(d),this._update(!0)}setImportColorTheme(d,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(d,t),this._update(!0)}setCamera(d){return this.style.setCamera(d),this._triggerCameraUpdate(d)}_triggerCameraUpdate(d){return this._update(this.transform.setOrthographicProjectionAtLowPitch(d["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.ci.convert(d),this.transform):0}setFeatureState(d,t){return d.source&&!this._isValidId(d.source)?this:(this.style.setFeatureState(d,t),this._update())}removeFeatureState(d,t){return d.source&&!this._isValidId(d.source)?this:(this.style.removeFeatureState(d,t),this._update())}getFeatureState(d){return d.source&&!this._isValidId(d.source)?null:this.style.getFeatureState(d)}_selectIndoorFloor(d){this.indoor.selectFloor(d)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Hg),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let a,h,g,_=this._container;for(;_&&(!h||!g);){const w=window.getComputedStyle(_).transform;w&&w!=="none"&&(a=w.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(h=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(g=a[3])),_=_.parentElement}this._containerWidth=h?Math.abs(d/h):d,this._containerHeight=g?Math.abs(t/g):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=J("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=J("div","mapboxgl-canvas-container",d);this._canvas=J("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=J("div","mapboxgl-control-container",d),h=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(g=>{h[g]=J("div",`mapboxgl-ctrl-${g}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,t){const a=s.q.devicePixelRatio||1;this._canvas.width=a*Math.ceil(d),this._canvas.height=a*Math.ceil(t),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${t}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const t=this._markers.indexOf(d);t!==-1&&this._markers.splice(t,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){const t=this._popups.indexOf(d);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const d=s.h({},ue.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",d);t?(Cn(t,!0),this.painter=new ql(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.l.testSupport(t)):this.fire(new s.z(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.A("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new s.A("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let t;this.fire(new s.A("renderstart")),++this._frameId;const a=this.painter.context.extTimerQuery,h=s.q.now(),g=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=g.createQuery(),g.beginQuery(a.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();const _=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,D=this.transform.pitch,z=s.q.now(),k=new s.aa(R,{now:z,fadeDuration:_,pitch:D,transition:this.style.transition,worldview:this._worldview});this.style.update(k)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(h),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):w=this._updateAverageElevation(h);const T=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,_,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),T&&(this._placementDirty=T.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,G.mark(j.load),this.fire(new s.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const R=s.q.now()-h;g.endQuery(a.TIME_ELAPSED_EXT),setTimeout(()=>{const D=g.getQueryParameter(t,g.QUERY_RESULT)/1e6;g.deleteQuery(t),this.fire(new s.A("gpu-timing-frame",{cpuTime:R,gpuTime:D}))},50)}if(this.listens("gpu-timing-layer")){const R=this.painter.collectGpuTimers();setTimeout(()=>{const D=this.painter.queryGpuTimers(R);this.fire(new s.A("gpu-timing-layer",{layerTimes:D}))},50)}if(this.listens("gpu-timing-deferred-render")){const R=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const D=this.painter.queryGpuTimeDeferredRender(R);this.fire(new s.A("gpu-timing-deferred-render",{gpuTime:D}))},50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(C||this._repaint)this.triggerRepaint();else{const R=this.idle();if(R&&(w=this._updateAverageElevation(h,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),R&&(this.fire(new s.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const D=this._calculateSpeedIndex();this.fire(new s.A("speedindexcompleted",{speedIndex:D})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,G.mark(j.fullLoad),this._performanceMetricsCollection&&Fi(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(const t of this._markers)d&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!d||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(d,t=!1){const a=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);const h=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(h||(t||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const g=this.transform.averageElevation;let _=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=d;const w=Math.abs(g-_);if(w>1){if(this._isInitialLoad||h)return this._averageElevation.jumpTo(_),a(_);this._averageElevation.easeTo(_,d,300)}else if(w>1e-4)return this._averageElevation.jumpTo(_),a(_)}return!!this._averageElevation.isEasing(d)&&a(this._averageElevation.getValue(d))}_authenticate(){Ri(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===Kt||d.status===401)){const t=this.painter.context.gl;Cn(t,!1),this._logoControl instanceof Eh&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Dn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&wi(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const a=this.painter.context.gl,h=a.createFramebuffer();function g(_){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,_,0);const w=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,w),w}return a.bindFramebuffer(a.FRAMEBUFFER,h),this._canvasPixelComparison(g(d),t.canvasCopies.map(g),t.timeStamps)}_canvasPixelComparison(d,t,a){let h=a[1]-a[0];const g=d.length/4;for(let _=0;_<t.length;_++){const w=t[_];let T=0;for(let C=0;C<w.length;C+=4)w[C]===d[C]&&w[C+1]===d[C+1]&&w[C+2]===d[C+2]&&w[C+3]===d[C+3]&&(T+=1);h+=(a[_+2]-a[_+1])*(1-T/g)}return h}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),kn.delete(this.painter.context.gl),nn.remove(),en.remove(),this._removed=!0,this.fire(new s.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=s.q.frame(t=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(t)}))}_preloadTiles(d){const t=this.style?this.style.getSourceCaches():[];return s.bt(t,(a,h)=>a._preloadTiles(d,h),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(d){this._showParseStatus!==d&&(this._showParseStatus=d,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(d){this._showLayers2DWireframe!==d&&(this._showLayers2DWireframe=d,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(d){this._showLayers3DWireframe!==d&&(this._showLayers3DWireframe=d,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,this._tp.refreshUI(),d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,this._tp.refreshUI(),d&&this._update())}_setCacheLimits(d,t){s.eV(d,t)}get version(){return O}},NavigationControl:class{constructor(d={}){this.options=s.h({},Ou,d),this._container=J("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(s.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),J("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),J("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:t}):a.resetNorth({},{originalEvent:t}))}),this._compassIcon=J("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const t=d.getZoom(),a=t===d.getMaxZoom(),h=t===d.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new nl(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,t){const a=J("button",d,this._container);return a.type="button",a.addEventListener("click",t),a}_setButtonTitle(d,t){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${t}`);d.setAttribute("aria-label",a),d.firstElementChild&&d.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends s.E{constructor(d={}){super();const t=navigator.geolocation;this.options=s.h({geolocation:t},yb,d),s.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Mu(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=J("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){const t=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,d(a)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(a=>t(a.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(d){const t=this._map.getMaxBounds(),a=d.coords;return!!t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new s.A("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.A("geolocate",d)),this._finish()}}_updateCamera(d){const t=new s.ci(d.coords.longitude,d.coords.latitude),a=d.coords.accuracy,h=this._map.getBearing(),g=s.h({bearing:h},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(a),g,{geolocateSource:!0})}_updateMarker(d){if(d){const t=new s.ci(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.transform,t=s.cb(1,d._center.lat)*d.worldSize,a=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.A("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=J("button","mapboxgl-ctrl-geolocate",this._container),J("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=J("div","mapboxgl-user-location"),this._dotElement.appendChild(J("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(J("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Lo({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=J("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Lo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.A("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:zu,ScaleControl:class{constructor(d={}){this.options=s.h({},xb,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const d=this.options.maxWidth||100,t=this._map,a=t._containerHeight/2,h=t._containerWidth/2-d/2,g=t.unproject([h,a]),_=t.unproject([h+d,a]),w=g.distanceTo(_);if(this.options.unit==="imperial"){const T=3.2808*w;T>5280?this._setScale(d,T/5280,"mile"):this._setScale(d,T,"foot")}else this.options.unit==="nautical"?this._setScale(d,w/1852,"nautical-mile"):w>=1e3?this._setScale(d,w/1e3,"kilometer"):this._setScale(d,w,"meter")}_setScale(d,t,a){this._map._requestDomTask(()=>{const h=function(_){const w=Math.pow(10,`${Math.floor(_)}`.length-1);let T=_/w;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(C){const R=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*R)/R}(T),w*T}(t),g=h/t;this._container.innerHTML=this._isNumberFormatSupported&&a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(h):`${h}&nbsp;${vb[a]}`,this._container.style.width=d*g+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=J("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d={}){this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:s.w("Full screen control 'container' must be a DOM element.")),s.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=J("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=J("button","mapboxgl-ctrl-fullscreen",this._controlContainer);J("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Hg,Popup:class extends s.E{constructor(d){super(),this.options=s.h(Object.create(wb),d),this._altitude=this.options.altitude,s.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new s.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new s.A("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=s.ci.convert(d),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(d){return this._altitude=d,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const t=document.createDocumentFragment(),a=document.createElement("body");let h;for(a.innerHTML=d;h=a.firstChild,h;)t.appendChild(h);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=J("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(d),this.options.closeButton){const a=this._closeButton=J("button","mapboxgl-popup-close-button",t);a.type="button",a.setAttribute("aria-label","Close popup"),a.innerHTML='<span aria-hidden="true">&#215;</span>',a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let t;return this._classList.delete(d)?t=!1:(this._classList.add(d),t=!0),this._updateClassList(),t}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const t=this._map,a=this._container,h=this._pos;if(!t||!a||!h)return"bottom";const g=a.offsetWidth,_=a.offsetHeight,w=h.x<g/2,T=h.x>t.transform.width-g/2;if(h.y+d<_)return w?"top-left":T?"top-right":"top";if(h.y>t.transform.height-_){if(w)return"bottom-left";if(T)return"bottom-right"}return w?"left":T?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),d.className=t.join(" ")}_update(d){const t=this._map,a=this._content;if(!t||!this._lngLat&&!this._trackPointer||!a)return;let h=this._container;if(h||(h=this._container=J("div","mapboxgl-popup",t.getContainer()),this._tip=J("div","mapboxgl-popup-tip",h),h.appendChild(a)),this.options.maxWidth&&h.style.maxWidth!==this.options.maxWidth&&(h.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=na(this._lngLat,this._pos,t.transform)),!this._trackPointer||d){const g=this._pos=this._trackPointer&&d instanceof s.P?d:t.project(this._lngLat,this._altitude),_=Fs(this.options.offset),w=this._anchor=this._getAnchor(_.y),T=Fs(this.options.offset,w),C=g.add(T).round();t._requestDomTask(()=>{this._container&&w&&(this._container.style.transform=`${No[w]} translate(${C.x}px,${C.y}px)`)})}if(!this._marker&&t._showingGlobe()){const g=s.eW(t.transform,this._lngLat)?0:1;this._setOpacity(g)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(lv);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:Lo,Style:ea,LngLat:s.ci,LngLatBounds:s.aG,Point:s.P,MercatorCoordinate:s.ac,FreeCameraOptions:hx,Evented:s.E,config:s.e,prewarm:s.e_,clearPrewarmedResources:s.eZ,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(d){s.e.ACCESS_TOKEN=d},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(d){s.e.API_URL=d},get workerCount(){return s.f7.workerCount},set workerCount(d){s.f7.workerCount=d},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){s.e.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){s.f6(d)},get workerUrl(){return s.f5.workerUrl},set workerUrl(d){s.f5.workerUrl=d},get workerClass(){return s.f5.workerClass},set workerClass(d){s.f5.workerClass=d},get workerParams(){return s.f5.workerParams},set workerParams(d){s.f5.workerParams=d},get dracoUrl(){return s.f4()},set dracoUrl(d){s.f3(d)},get meshoptUrl(){return s.f2()},set meshoptUrl(d){s.f1(d)},setNow:s.q.setNow,restoreNow:s.q.restoreNow}});var I=v;return I})})(Vj);var QX=Vj.exports;const D0=eE(QX),pk=[{id:"ORD001",customerId:"1",customerName:"John Doe",customerMobile:"+91 9876543210",items:[{meatId:"1",meatName:"Chicken Breast",price:280,weight:1.5,total:420},{meatId:"2",meatName:"Mutton Leg",price:650,weight:1,total:650}],totalAmount:1070,status:"pending",orderDate:"2024-03-01T10:30:00Z",deliveryDate:"2024-03-02T18:00:00Z",deliveryAddress:"123 Main Street, Sector 14, Gurgaon, Haryana 122001",paymentMethod:"cod",paymentStatus:"pending"},{id:"ORD002",customerId:"2",customerName:"Jane Smith",customerMobile:"+91 8765432109",items:[{meatId:"3",meatName:"Fish Fillet",price:420,weight:.8,total:336}],totalAmount:336,status:"confirmed",orderDate:"2024-03-01T14:15:00Z",deliveryDate:"2024-03-03T16:00:00Z",deliveryAddress:"456 Park Avenue, Phase 2, DLF City, Gurgaon, Haryana 122002",paymentMethod:"online",paymentStatus:"paid"},{id:"ORD003",customerId:"3",customerName:"Mike Johnson",customerMobile:"+91 7654321098",items:[{meatId:"4",meatName:"Beef Steak",price:750,weight:2,total:1500},{meatId:"1",meatName:"Chicken Breast",price:280,weight:1,total:280}],totalAmount:1780,status:"processing",orderDate:"2024-02-29T09:45:00Z",deliveryDate:"2024-03-02T20:00:00Z",deliveryAddress:"789 Golf Course Road, Sector 43, Gurgaon, Haryana 122003",paymentMethod:"online",paymentStatus:"paid"},{id:"ORD004",customerId:"4",customerName:"Sarah Wilson",customerMobile:"+91 6543210987",items:[{meatId:"2",meatName:"Mutton Leg",price:650,weight:2.5,total:1625}],totalAmount:1625,status:"shipped",orderDate:"2024-02-28T16:20:00Z",deliveryDate:"2024-03-01T19:00:00Z",deliveryAddress:"321 Cyber Hub, Sector 29, Gurgaon, Haryana 122004",paymentMethod:"cod",paymentStatus:"pending"},{id:"ORD005",customerId:"5",customerName:"David Brown",customerMobile:"+91 5432109876",items:[{meatId:"3",meatName:"Fish Fillet",price:420,weight:1.2,total:504},{meatId:"1",meatName:"Chicken Breast",price:280,weight:.5,total:140}],totalAmount:644,status:"delivered",orderDate:"2024-02-27T11:10:00Z",deliveryDate:"2024-02-28T17:30:00Z",deliveryAddress:"654 MG Road, Sector 28, Gurgaon, Haryana 122005",paymentMethod:"online",paymentStatus:"paid"}],eK=()=>{const[i,o]=V.useState(!0),[c,m]=V.useState([]),[v,E]=V.useState(""),[I,s]=V.useState("all"),[O,j]=V.useState([]),[G,W]=V.useState(null),[B,te]=V.useState(!1),ue=V.useRef(null),J=V.useRef(null),{toast:ce}=ha();V.useEffect(()=>{(async()=>{o(!0),await new Promise(Ke=>setTimeout(Ke,1e3)),m(pk),j(pk),o(!1)})()},[]),V.useEffect(()=>{let pe=c;v&&(pe=pe.filter(Ke=>Ke.id.toLowerCase().includes(v.toLowerCase())||Ke.customerName.toLowerCase().includes(v.toLowerCase())||Ke.customerMobile.includes(v))),I!=="all"&&(pe=pe.filter(Ke=>Ke.status===I)),j(pe)},[v,I,c]),V.useEffect(()=>{B&&G&&ue.current&&!J.current&&(D0.accessToken="pk.eyJ1IjoibWFwYm94LWdsLWpzIiwiYSI6ImNrcDk3aHJ1dTE4ZGczNXBpZ2NkMXFlbWEifQ.Lau_nzsm7p6-RBCqMyZGKQ",J.current=new D0.Map({container:ue.current,style:"mapbox://styles/mapbox/streets-v11",center:[77.0266,28.4595],zoom:12}),new D0.Marker({color:"#ef4444"}).setLngLat([77.0266+Math.random()*.1,28.4595+Math.random()*.1]).setPopup(new D0.Popup({offset:25}).setHTML(`<p><strong>${G.customerName}</strong><br/>${G.deliveryAddress}</p>`)).addTo(J.current))},[B,G]);const oe=pe=>{switch(pe){case"pending":return"bg-yellow-100 text-yellow-800";case"confirmed":return"bg-blue-100 text-blue-800";case"processing":return"bg-purple-100 text-purple-800";case"packed":return"bg-indigo-100 text-indigo-800";case"shipped":return"bg-orange-100 text-orange-800";case"delivered":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},ee=pe=>{switch(pe){case"pending":return Sd;case"confirmed":return sd;case"processing":return ml;case"packed":return ml;case"shipped":return qc;case"delivered":return sd;case"cancelled":return XG;default:return Sd}},Q=(pe,Ke)=>{m(et=>et.map(at=>at.id===pe?{...at,status:Ke}:at)),ce({title:"Order Status Updated",description:`Order ${pe} status updated to ${Ke}`})},Ie=pe=>{W(pe),te(!0)};return i?x.jsxs("div",{className:"space-y-6",children:[x.jsx("div",{className:"flex justify-between items-center",children:x.jsx(Cr,{className:"h-8 w-48"})}),x.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[...Array(4)].map((pe,Ke)=>x.jsx(Cr,{className:"h-24"},Ke))}),x.jsxs($i,{children:[x.jsx(dr,{children:x.jsx(Cr,{className:"h-6 w-32"})}),x.jsx(Hi,{children:x.jsx("div",{className:"space-y-4",children:[...Array(5)].map((pe,Ke)=>x.jsx(Cr,{className:"h-16 w-full"},Ke))})})]})]}):x.jsxs("div",{className:"space-y-6",children:[x.jsx("div",{className:"flex justify-between items-center",children:x.jsxs("div",{children:[x.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Manage Orders"}),x.jsx("p",{className:"text-muted-foreground",children:"Track and manage customer orders with delivery tracking"})]})}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[x.jsx($i,{children:x.jsxs(Hi,{className:"p-4",children:[x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx(Sd,{className:"h-4 w-4 text-yellow-600"}),x.jsx("div",{className:"text-2xl font-bold",children:c.filter(pe=>pe.status==="pending").length})]}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"Pending Orders"})]})}),x.jsx($i,{children:x.jsxs(Hi,{className:"p-4",children:[x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx(ml,{className:"h-4 w-4 text-purple-600"}),x.jsx("div",{className:"text-2xl font-bold",children:c.filter(pe=>pe.status==="processing").length})]}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"Processing"})]})}),x.jsx($i,{children:x.jsxs(Hi,{className:"p-4",children:[x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx(qc,{className:"h-4 w-4 text-orange-600"}),x.jsx("div",{className:"text-2xl font-bold",children:c.filter(pe=>pe.status==="shipped").length})]}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"Shipped"})]})}),x.jsx($i,{children:x.jsxs(Hi,{className:"p-4",children:[x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx(sd,{className:"h-4 w-4 text-green-600"}),x.jsx("div",{className:"text-2xl font-bold",children:c.filter(pe=>pe.status==="delivered").length})]}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"Delivered"})]})})]}),x.jsxs($i,{children:[x.jsxs(dr,{children:[x.jsx(Mr,{children:"Orders Management"}),x.jsxs("div",{className:"flex gap-4",children:[x.jsxs("div",{className:"relative flex-1 max-w-md",children:[x.jsx(Am,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),x.jsx(tn,{placeholder:"Search by order ID, customer name, or mobile...",value:v,onChange:pe=>E(pe.target.value),className:"pl-10"})]}),x.jsxs(Oj,{value:I,onValueChange:s,children:[x.jsx(eA,{className:"w-48",children:x.jsx(Fj,{placeholder:"Filter by status"})}),x.jsxs(tA,{children:[x.jsx(Va,{value:"all",children:"All Orders"}),x.jsx(Va,{value:"pending",children:"Pending"}),x.jsx(Va,{value:"confirmed",children:"Confirmed"}),x.jsx(Va,{value:"processing",children:"Processing"}),x.jsx(Va,{value:"packed",children:"Packed"}),x.jsx(Va,{value:"shipped",children:"Shipped"}),x.jsx(Va,{value:"delivered",children:"Delivered"}),x.jsx(Va,{value:"cancelled",children:"Cancelled"})]})]}),x.jsxs(Si,{variant:"outline",children:[x.jsx(lw,{className:"h-4 w-4 mr-2"}),"More Filters"]})]})]}),x.jsxs(Hi,{children:[x.jsx("div",{className:"rounded-md border",children:x.jsxs(Zy,{children:[x.jsx(Xy,{children:x.jsxs(eu,{children:[x.jsx(kr,{children:"Order ID"}),x.jsx(kr,{children:"Customer"}),x.jsx(kr,{children:"Items"}),x.jsx(kr,{children:"Total"}),x.jsx(kr,{children:"Status"}),x.jsx(kr,{children:"Date"}),x.jsx(kr,{children:"Payment"}),x.jsx(kr,{className:"text-right",children:"Actions"})]})}),x.jsx(Ky,{children:O.map(pe=>{const Ke=ee(pe.status);return x.jsxs(eu,{children:[x.jsx(Nr,{children:x.jsx("div",{className:"font-medium",children:pe.id})}),x.jsx(Nr,{children:x.jsxs("div",{children:[x.jsx("div",{className:"font-medium",children:pe.customerName}),x.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[x.jsx(uw,{className:"h-3 w-3"}),pe.customerMobile]})]})}),x.jsx(Nr,{children:x.jsxs("div",{className:"text-sm",children:[pe.items.length," item",pe.items.length>1?"s":"",x.jsx("div",{className:"text-muted-foreground",children:pe.items.map(et=>et.meatName).join(", ")})]})}),x.jsx(Nr,{children:x.jsxs("div",{className:"flex items-center gap-1",children:[x.jsx(id,{className:"h-3 w-3"}),x.jsx("span",{className:"font-semibold",children:pe.totalAmount})]})}),x.jsx(Nr,{children:x.jsxs(es,{className:oe(pe.status),children:[x.jsx(Ke,{className:"h-3 w-3 mr-1"}),pe.status]})}),x.jsx(Nr,{children:x.jsxs("div",{className:"text-sm",children:[x.jsxs("div",{className:"flex items-center gap-1",children:[x.jsx(wz,{className:"h-3 w-3"}),new Date(pe.orderDate).toLocaleDateString()]}),x.jsx("div",{className:"text-muted-foreground",children:new Date(pe.orderDate).toLocaleTimeString()})]})}),x.jsx(Nr,{children:x.jsxs("div",{className:"text-sm",children:[x.jsx(es,{variant:pe.paymentStatus==="paid"?"default":"outline",children:pe.paymentStatus}),x.jsx("div",{className:"text-muted-foreground mt-1",children:pe.paymentMethod})]})}),x.jsx(Nr,{className:"text-right",children:x.jsxs(kw,{children:[x.jsx(Nw,{asChild:!0,children:x.jsx(Si,{variant:"ghost",size:"icon",children:x.jsx(aw,{className:"h-4 w-4"})})}),x.jsxs(Qy,{align:"end",children:[x.jsxs(Qs,{onClick:()=>Ie(pe),children:[x.jsx(Qh,{className:"h-4 w-4 mr-2"}),"View Details"]}),x.jsxs(Qs,{onClick:()=>Q(pe.id,"confirmed"),children:[x.jsx(sd,{className:"h-4 w-4 mr-2"}),"Confirm Order"]}),x.jsxs(Qs,{onClick:()=>Q(pe.id,"processing"),children:[x.jsx(ml,{className:"h-4 w-4 mr-2"}),"Start Processing"]}),x.jsxs(Qs,{onClick:()=>Q(pe.id,"shipped"),children:[x.jsx(qc,{className:"h-4 w-4 mr-2"}),"Mark as Shipped"]}),x.jsxs(Qs,{onClick:()=>Q(pe.id,"delivered"),children:[x.jsx(sd,{className:"h-4 w-4 mr-2"}),"Mark as Delivered"]})]})]})})]},pe.id)})})]})}),O.length===0&&x.jsxs("div",{className:"text-center py-8",children:[x.jsx(ml,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),x.jsx("p",{className:"text-muted-foreground",children:v||I!=="all"?"No orders found matching your criteria.":"No orders yet."})]})]})]}),x.jsx(Lw,{open:B,onOpenChange:te,children:x.jsxs(ex,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[x.jsx(tx,{children:x.jsxs(ix,{children:["Order Details - ",G==null?void 0:G.id]})}),G&&x.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[x.jsxs("div",{className:"space-y-4",children:[x.jsxs($i,{children:[x.jsx(dr,{children:x.jsx(Mr,{className:"text-lg",children:"Customer Information"})}),x.jsxs(Hi,{className:"space-y-3",children:[x.jsxs("div",{children:[x.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Name"}),x.jsx("p",{className:"font-medium",children:G.customerName})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Mobile"}),x.jsx("p",{children:G.customerMobile})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Delivery Address"}),x.jsx("p",{className:"text-sm",children:G.deliveryAddress})]})]})]}),x.jsxs($i,{children:[x.jsx(dr,{children:x.jsx(Mr,{className:"text-lg",children:"Order Items"})}),x.jsx(Hi,{children:x.jsxs("div",{className:"space-y-3",children:[G.items.map((pe,Ke)=>x.jsxs("div",{className:"flex justify-between items-center p-3 border rounded-lg",children:[x.jsxs("div",{children:[x.jsx("p",{className:"font-medium",children:pe.meatName}),x.jsxs("p",{className:"text-sm text-muted-foreground",children:[pe.weight,"kg × ₹",pe.price,"/kg"]})]}),x.jsxs("p",{className:"font-semibold",children:["₹",pe.total]})]},Ke)),x.jsx("div",{className:"border-t pt-3",children:x.jsxs("div",{className:"flex justify-between items-center font-bold text-lg",children:[x.jsx("span",{children:"Total Amount:"}),x.jsxs("span",{children:["₹",G.totalAmount]})]})})]})})]}),x.jsxs($i,{children:[x.jsx(dr,{children:x.jsx(Mr,{className:"text-lg",children:"Order Status"})}),x.jsx(Hi,{children:x.jsxs("div",{className:"space-y-3",children:[x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{children:"Current Status:"}),x.jsx(es,{className:oe(G.status),children:G.status})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{children:"Payment Method:"}),x.jsx("span",{children:G.paymentMethod})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{children:"Payment Status:"}),x.jsx(es,{variant:G.paymentStatus==="paid"?"default":"outline",children:G.paymentStatus})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{children:"Order Date:"}),x.jsx("span",{children:new Date(G.orderDate).toLocaleString()})]}),G.deliveryDate&&x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{children:"Expected Delivery:"}),x.jsx("span",{children:new Date(G.deliveryDate).toLocaleString()})]})]})})]})]}),x.jsxs("div",{className:"space-y-4",children:[x.jsxs($i,{children:[x.jsx(dr,{children:x.jsxs(Mr,{className:"text-lg flex items-center gap-2",children:[x.jsx(cw,{className:"h-5 w-5"}),"Delivery Location"]})}),x.jsxs(Hi,{children:[x.jsx("div",{className:"h-64 rounded-lg overflow-hidden border",children:x.jsx("div",{ref:ue,className:"w-full h-full"})}),x.jsxs("div",{className:"mt-4",children:[x.jsx("p",{className:"text-sm text-muted-foreground",children:"Distance from store:"}),x.jsx("p",{className:"font-medium",children:"~12.5 km (25-30 mins)"})]})]})]}),x.jsxs($i,{children:[x.jsx(dr,{children:x.jsx(Mr,{className:"text-lg",children:"Update Status"})}),x.jsx(Hi,{children:x.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[x.jsx(Si,{variant:"outline",size:"sm",onClick:()=>Q(G.id,"confirmed"),disabled:G.status==="confirmed",children:"Confirm"}),x.jsx(Si,{variant:"outline",size:"sm",onClick:()=>Q(G.id,"processing"),disabled:G.status==="processing",children:"Process"}),x.jsx(Si,{variant:"outline",size:"sm",onClick:()=>Q(G.id,"packed"),disabled:G.status==="packed",children:"Pack"}),x.jsx(Si,{variant:"outline",size:"sm",onClick:()=>Q(G.id,"shipped"),disabled:G.status==="shipped",children:"Ship"}),x.jsx(Si,{variant:"meat",size:"sm",onClick:()=>Q(G.id,"delivered"),disabled:G.status==="delivered",className:"col-span-2",children:"Mark as Delivered"})]})})]})]})]})]})})]})},tK=()=>{const{toast:i}=ha(),[o,c]=V.useState(!1),[m,v]=V.useState({name:"MeatShop Premium",phone:"+91 98765 43210",email:"admin@meatshop.com",address:"123 Market Street, Food Zone, Mumbai - 400001",website:"www.meatshop.com",gstNumber:"27AAAAA0000A1Z5",panNumber:"AAAAA0000A"}),[E,I]=V.useState({gstRate:12,deliveryCharges:50,freeDeliveryAbove:500,packagingCharges:25,minimumOrderAmount:300}),[s,O]=V.useState({maxDeliveryDistance:25,estimatedDeliveryTime:60,emergencyDeliveryCharges:100,deliverySlots:["9:00 AM - 12:00 PM","12:00 PM - 3:00 PM","3:00 PM - 6:00 PM","6:00 PM - 9:00 PM"]}),[j,G]=V.useState({orderNotifications:!0,lowStockAlerts:!0,dailyReports:!0,emailNotifications:!0,smsNotifications:!1}),W=async B=>{c(!0);try{await new Promise(te=>setTimeout(te,1e3)),i({title:"Settings Saved",description:`${B} settings have been updated successfully.`})}catch{i({title:"Error",description:"Failed to save settings. Please try again.",variant:"destructive"})}finally{c(!1)}};return x.jsxs("div",{className:"space-y-8",children:[x.jsxs("div",{className:"space-y-2",children:[x.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Settings"}),x.jsx("p",{className:"text-muted-foreground",children:"Manage your shop configuration, pricing, and system preferences."})]}),x.jsxs($i,{children:[x.jsxs(dr,{children:[x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx(JG,{className:"h-5 w-5"}),x.jsx(Mr,{children:"Shop Information"})]}),x.jsx(Ha,{children:"Basic information about your meat shop"})]}),x.jsxs(Hi,{className:"space-y-6",children:[x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[x.jsxs("div",{className:"space-y-2",children:[x.jsx(En,{htmlFor:"shopName",children:"Shop Name"}),x.jsx(tn,{id:"shopName",value:m.name,onChange:B=>v(te=>({...te,name:B.target.value}))})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx(En,{htmlFor:"phone",children:"Phone Number"}),x.jsx(tn,{id:"phone",value:m.phone,onChange:B=>v(te=>({...te,phone:B.target.value}))})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx(En,{htmlFor:"email",children:"Email Address"}),x.jsx(tn,{id:"email",type:"email",value:m.email,onChange:B=>v(te=>({...te,email:B.target.value}))})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx(En,{htmlFor:"website",children:"Website"}),x.jsx(tn,{id:"website",value:m.website,onChange:B=>v(te=>({...te,website:B.target.value}))})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx(En,{htmlFor:"gst",children:"GST Number"}),x.jsx(tn,{id:"gst",value:m.gstNumber,onChange:B=>v(te=>({...te,gstNumber:B.target.value}))})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx(En,{htmlFor:"pan",children:"PAN Number"}),x.jsx(tn,{id:"pan",value:m.panNumber,onChange:B=>v(te=>({...te,panNumber:B.target.value}))})]})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx(En,{htmlFor:"address",children:"Complete Address"}),x.jsx(tn,{id:"address",value:m.address,onChange:B=>v(te=>({...te,address:B.target.value}))})]}),x.jsxs(Si,{onClick:()=>W("Shop Information"),disabled:o,children:[x.jsx(Z_,{className:"h-4 w-4 mr-2"}),"Save Shop Info"]})]})]}),x.jsxs($i,{children:[x.jsxs(dr,{children:[x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx(id,{className:"h-5 w-5"}),x.jsx(Mr,{children:"Pricing Configuration"})]}),x.jsx(Ha,{children:"Configure taxes, delivery charges, and minimum order amounts"})]}),x.jsxs(Hi,{className:"space-y-6",children:[x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[x.jsxs("div",{className:"space-y-2",children:[x.jsx(En,{htmlFor:"gstRate",children:"GST Rate (%)"}),x.jsxs("div",{className:"relative",children:[x.jsx(T1,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),x.jsx(tn,{id:"gstRate",type:"number",className:"pl-10",value:E.gstRate,onChange:B=>I(te=>({...te,gstRate:Number(B.target.value)}))})]})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx(En,{htmlFor:"deliveryCharges",children:"Delivery Charges (₹)"}),x.jsxs("div",{className:"relative",children:[x.jsx(id,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),x.jsx(tn,{id:"deliveryCharges",type:"number",className:"pl-10",value:E.deliveryCharges,onChange:B=>I(te=>({...te,deliveryCharges:Number(B.target.value)}))})]})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx(En,{htmlFor:"freeDelivery",children:"Free Delivery Above (₹)"}),x.jsxs("div",{className:"relative",children:[x.jsx(id,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),x.jsx(tn,{id:"freeDelivery",type:"number",className:"pl-10",value:E.freeDeliveryAbove,onChange:B=>I(te=>({...te,freeDeliveryAbove:Number(B.target.value)}))})]})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx(En,{htmlFor:"packaging",children:"Packaging Charges (₹)"}),x.jsxs("div",{className:"relative",children:[x.jsx(id,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),x.jsx(tn,{id:"packaging",type:"number",className:"pl-10",value:E.packagingCharges,onChange:B=>I(te=>({...te,packagingCharges:Number(B.target.value)}))})]})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx(En,{htmlFor:"minOrder",children:"Minimum Order (₹)"}),x.jsxs("div",{className:"relative",children:[x.jsx(id,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),x.jsx(tn,{id:"minOrder",type:"number",className:"pl-10",value:E.minimumOrderAmount,onChange:B=>I(te=>({...te,minimumOrderAmount:Number(B.target.value)}))})]})]})]}),x.jsxs(Si,{onClick:()=>W("Pricing Configuration"),disabled:o,children:[x.jsx(Z_,{className:"h-4 w-4 mr-2"}),"Save Pricing"]})]})]}),x.jsxs($i,{children:[x.jsxs(dr,{children:[x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx(qc,{className:"h-5 w-5"}),x.jsx(Mr,{children:"Delivery Settings"})]}),x.jsx(Ha,{children:"Configure delivery zones, timing, and charges"})]}),x.jsxs(Hi,{className:"space-y-6",children:[x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[x.jsxs("div",{className:"space-y-2",children:[x.jsx(En,{htmlFor:"maxDistance",children:"Max Delivery Distance (km)"}),x.jsxs("div",{className:"relative",children:[x.jsx(cw,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),x.jsx(tn,{id:"maxDistance",type:"number",className:"pl-10",value:s.maxDeliveryDistance,onChange:B=>O(te=>({...te,maxDeliveryDistance:Number(B.target.value)}))})]})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx(En,{htmlFor:"deliveryTime",children:"Est. Delivery Time (min)"}),x.jsxs("div",{className:"relative",children:[x.jsx(Sd,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),x.jsx(tn,{id:"deliveryTime",type:"number",className:"pl-10",value:s.estimatedDeliveryTime,onChange:B=>O(te=>({...te,estimatedDeliveryTime:Number(B.target.value)}))})]})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx(En,{htmlFor:"emergencyCharges",children:"Emergency Delivery (₹)"}),x.jsxs("div",{className:"relative",children:[x.jsx(id,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),x.jsx(tn,{id:"emergencyCharges",type:"number",className:"pl-10",value:s.emergencyDeliveryCharges,onChange:B=>O(te=>({...te,emergencyDeliveryCharges:Number(B.target.value)}))})]})]})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx(En,{children:"Delivery Time Slots"}),x.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:s.deliverySlots.map((B,te)=>x.jsx(es,{variant:"outline",className:"justify-center py-2",children:B},te))})]}),x.jsxs(Si,{onClick:()=>W("Delivery Settings"),disabled:o,children:[x.jsx(Z_,{className:"h-4 w-4 mr-2"}),"Save Delivery"]})]})]}),x.jsxs($i,{children:[x.jsxs(dr,{children:[x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx(nC,{className:"h-5 w-5"}),x.jsx(Mr,{children:"Notification Settings"})]}),x.jsx(Ha,{children:"Configure when and how you receive notifications"})]}),x.jsxs(Hi,{className:"space-y-6",children:[x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{children:[x.jsx(En,{htmlFor:"orderNotifs",children:"Order Notifications"}),x.jsx("p",{className:"text-sm text-muted-foreground",children:"Get notified about new orders"})]}),x.jsx("input",{id:"orderNotifs",type:"checkbox",checked:j.orderNotifications,onChange:B=>G(te=>({...te,orderNotifications:B.target.checked})),className:"toggle"})]}),x.jsx(ac,{}),x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{children:[x.jsx(En,{htmlFor:"stockAlerts",children:"Low Stock Alerts"}),x.jsx("p",{className:"text-sm text-muted-foreground",children:"Alert when inventory is low"})]}),x.jsx("input",{id:"stockAlerts",type:"checkbox",checked:j.lowStockAlerts,onChange:B=>G(te=>({...te,lowStockAlerts:B.target.checked})),className:"toggle"})]}),x.jsx(ac,{}),x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{children:[x.jsx(En,{htmlFor:"dailyReports",children:"Daily Reports"}),x.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive daily sales reports"})]}),x.jsx("input",{id:"dailyReports",type:"checkbox",checked:j.dailyReports,onChange:B=>G(te=>({...te,dailyReports:B.target.checked})),className:"toggle"})]}),x.jsx(ac,{}),x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{children:[x.jsx(En,{htmlFor:"emailNotifs",children:"Email Notifications"}),x.jsx("p",{className:"text-sm text-muted-foreground",children:"Send notifications via email"})]}),x.jsx("input",{id:"emailNotifs",type:"checkbox",checked:j.emailNotifications,onChange:B=>G(te=>({...te,emailNotifications:B.target.checked})),className:"toggle"})]}),x.jsx(ac,{}),x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{children:[x.jsx(En,{htmlFor:"smsNotifs",children:"SMS Notifications"}),x.jsx("p",{className:"text-sm text-muted-foreground",children:"Send notifications via SMS"})]}),x.jsx("input",{id:"smsNotifs",type:"checkbox",checked:j.smsNotifications,onChange:B=>G(te=>({...te,smsNotifications:B.target.checked})),className:"toggle"})]})]}),x.jsxs(Si,{onClick:()=>W("Notification Settings"),disabled:o,children:[x.jsx(Z_,{className:"h-4 w-4 mr-2"}),"Save Notifications"]})]})]})]})},iK=[{id:"1",orderNumber:"ORD001",date:"2024-01-15",status:"delivered",items:[{id:"1",name:"Chicken Breast",quantity:2,price:280,image:"https://images.unsplash.com/photo-1604503468506-a8da13d82791?w=200"},{id:"2",name:"Mutton Leg",quantity:1,price:650,image:"https://images.unsplash.com/photo-1529692236671-f1f6cf9683ba?w=200"}],total:1210,deliveryAddress:"123 Main St, Mumbai, Maharashtra 400001",estimatedDelivery:"2024-01-16",trackingNumber:"TRK123456789"},{id:"2",orderNumber:"ORD002",date:"2024-01-20",status:"shipped",items:[{id:"3",name:"Fish Fillet",quantity:1.5,price:400,image:"https://images.unsplash.com/photo-1544943910-4c1dc44aab44?w=200"}],total:600,deliveryAddress:"456 Park Ave, Mumbai, Maharashtra 400002",estimatedDelivery:"2024-01-21",trackingNumber:"TRK987654321"},{id:"3",orderNumber:"ORD003",date:"2024-01-22",status:"processing",items:[{id:"4",name:"Chicken Wings",quantity:1,price:320,image:"https://images.unsplash.com/photo-1548550023-2bdb3c5beed7?w=200"}],total:320,deliveryAddress:"789 Beach Rd, Mumbai, Maharashtra 400003",estimatedDelivery:"2024-01-23"}],nK=()=>{const[i,o]=V.useState(!0),[c,m]=V.useState([]);V.useState(null);const{toast:v}=ha();V.useEffect(()=>{(async()=>{o(!0),await new Promise(j=>setTimeout(j,1e3)),m(iK),o(!1)})()},[]);const E=O=>{switch(O){case"pending":return"warning";case"confirmed":return"success";case"processing":return"default";case"shipped":return"default";case"delivered":return"success";case"cancelled":return"destructive";default:return"default"}},I=O=>{switch(O){case"pending":return Sd;case"confirmed":return sd;case"processing":return ml;case"shipped":return qc;case"delivered":return sd;case"cancelled":return vD;default:return ml}},s=O=>{v({title:"Items Added to Cart",description:`${O.items.length} items from order ${O.orderNumber} added to your cart.`,position:"top-center"})};return i?x.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-6",children:[x.jsx(Cr,{className:"h-8 w-48"}),x.jsx("div",{className:"space-y-4",children:[...Array(3)].map((O,j)=>x.jsx(Cr,{className:"h-32"},j))})]}):x.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-8 pb-20 md:pb-8",children:[x.jsxs("div",{className:"space-y-2",children:[x.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"My Orders"}),x.jsx("p",{className:"text-muted-foreground",children:"Track your orders and view order history"})]}),c.length===0?x.jsx($i,{className:"text-center py-12",children:x.jsxs(Hi,{children:[x.jsx(ml,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),x.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Orders Yet"}),x.jsx("p",{className:"text-muted-foreground mb-4",children:"Start shopping to see your orders here"}),x.jsx(Si,{children:"Start Shopping"})]})}):x.jsx("div",{className:"space-y-6",children:c.map(O=>{const j=I(O.status);return x.jsxs($i,{className:"hover:shadow-lg transition-shadow",children:[x.jsx(dr,{children:x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{className:"space-y-1",children:[x.jsxs(Mr,{className:"text-lg",children:["Order #",O.orderNumber]}),x.jsxs("p",{className:"text-sm text-muted-foreground",children:["Placed on ",new Date(O.date).toLocaleDateString()]})]}),x.jsxs(es,{variant:E(O.status),className:"gap-1",children:[x.jsx(j,{className:"h-3 w-3"}),O.status.charAt(0).toUpperCase()+O.status.slice(1)]})]})}),x.jsxs(Hi,{className:"space-y-6",children:[x.jsxs("div",{className:"space-y-3",children:[x.jsx("h4",{className:"font-medium",children:"Items Ordered"}),x.jsx("div",{className:"grid gap-3",children:O.items.map(G=>x.jsxs("div",{className:"flex items-center gap-4 p-3 bg-accent/50 rounded-lg",children:[x.jsx("img",{src:G.image,alt:G.name,className:"w-12 h-12 object-cover rounded"}),x.jsxs("div",{className:"flex-1",children:[x.jsx("h5",{className:"font-medium",children:G.name}),x.jsxs("p",{className:"text-sm text-muted-foreground",children:["Quantity: ",G.quantity,"kg"]})]}),x.jsxs("div",{className:"text-right",children:[x.jsxs("p",{className:"font-medium",children:["₹",G.price*G.quantity]}),x.jsxs("p",{className:"text-sm text-muted-foreground",children:["₹",G.price,"/kg"]})]})]},G.id))})]}),x.jsxs("div",{className:"flex items-center justify-between pt-3 border-t",children:[x.jsxs("div",{className:"space-y-1",children:[x.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Amount"}),x.jsxs("p",{className:"text-xl font-bold text-primary",children:["₹",O.total]})]}),x.jsxs("div",{className:"text-right space-y-1",children:[x.jsx("p",{className:"text-sm text-muted-foreground",children:"Estimated Delivery"}),x.jsx("p",{className:"font-medium",children:new Date(O.estimatedDelivery).toLocaleDateString()})]})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[x.jsx(cw,{className:"h-4 w-4"}),"Delivery Address"]}),x.jsx("p",{className:"text-sm text-muted-foreground pl-6",children:O.deliveryAddress})]}),O.trackingNumber&&x.jsxs("div",{className:"bg-primary/10 p-4 rounded-lg",children:[x.jsxs("h4",{className:"font-medium flex items-center gap-2 mb-2",children:[x.jsx(qc,{className:"h-4 w-4"}),"Tracking Information"]}),x.jsxs("p",{className:"text-sm",children:["Tracking Number: ",x.jsx("span",{className:"font-mono",children:O.trackingNumber})]})]}),x.jsxs("div",{className:"flex gap-3 pt-3",children:[x.jsxs(Si,{variant:"outline",size:"sm",className:"flex-1",children:[x.jsx(Qh,{className:"h-4 w-4 mr-2"}),"View Details"]}),O.status==="delivered"&&x.jsxs(x.Fragment,{children:[x.jsxs(Si,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>s(O),children:[x.jsx(vD,{className:"h-4 w-4 mr-2"}),"Reorder"]}),x.jsxs(Si,{variant:"outline",size:"sm",className:"flex-1",children:[x.jsx(sC,{className:"h-4 w-4 mr-2"}),"Rate Order"]})]}),(O.status==="shipped"||O.status==="processing")&&x.jsxs(Si,{variant:"outline",size:"sm",className:"flex-1",children:[x.jsx(uw,{className:"h-4 w-4 mr-2"}),"Contact Support"]})]})]})]},O.id)})})]})},rK=()=>{const{user:i,logout:o}=Ld(),{toast:c}=ha(),[m,v]=V.useState(!1),[E,I]=V.useState(!1),[s,O]=V.useState(null),j=V.useRef(null),[G,W]=V.useState({name:"John Doe",email:"john.doe@example.com",phone:(i==null?void 0:i.mobile)||"9876543210",dateOfBirth:"1990-01-15",anniversary:"2020-06-20"}),[B,te]=V.useState([{id:"1",type:"HOME",address:"123 Main Street, Apartment 4B, Near Central Mall, Mumbai, Maharashtra - 400001",isDefault:!0}]),[ue,J]=V.useState({type:"HOME",line1:"",line2:"",city:"",state:"",pincode:"",isDefault:!1});V.useEffect(()=>{E&&j.current&&setTimeout(()=>{var Ct;(Ct=j.current)==null||Ct.scrollIntoView({behavior:"smooth",block:"center"})},100)},[E]),V.useEffect(()=>{if(s){const Ct=B.find(mt=>mt.id===s);if(Ct){const mt=Ct.address.split(", "),Dt=mt[0]||"",Kt=mt[1]&&!mt[1].includes("-")?mt[1]:"",ti=mt[mt.length-1].split(" - "),Nt=ti[0]||"",bi=ti[1]||"",ot=mt[mt.length-2]||"";J({type:Ct.type,line1:Dt,line2:Kt,city:ot,state:Nt,pincode:bi,isDefault:Ct.isDefault})}}},[s,B]);const[ce,oe]=V.useState(G),ee=()=>{oe(G),v(!0)},Q=()=>{v(!1),oe(G)},Ie=()=>{W(ce),v(!1),c({title:"Profile updated successfully!",duration:3e3})},pe=()=>{O(null),J({type:"HOME",line1:"",line2:"",city:"",state:"",pincode:"",isDefault:!1}),I(!0)},Ke=Ct=>{O(Ct),I(!0)},et=()=>{if(!ue.line1||!ue.city||!ue.state||!ue.pincode){c({title:"Please fill all required fields",duration:3e3});return}const Ct=`${ue.line1}${ue.line2?", "+ue.line2:""}, ${ue.city}, ${ue.state} - ${ue.pincode}`;if(s)te(mt=>mt.map(Dt=>Dt.id===s?{...Dt,type:ue.type,address:Ct,isDefault:ue.isDefault}:Dt)),c({title:"Address updated successfully!",duration:3e3});else{const mt={id:Date.now().toString(),type:ue.type,address:Ct,isDefault:ue.isDefault};te(Dt=>[...Dt,mt]),c({title:"Address added successfully!",duration:3e3})}J({type:"HOME",line1:"",line2:"",city:"",state:"",pincode:"",isDefault:!1}),I(!1),O(null)},at=()=>{J({type:"HOME",line1:"",line2:"",city:"",state:"",pincode:"",isDefault:!1}),I(!1),O(null)},Xt=Ct=>{te(mt=>mt.filter(Dt=>Dt.id!==Ct)),c({title:"Address deleted successfully!",duration:3e3})};return x.jsxs("div",{className:"w-full",children:[x.jsxs("div",{children:[x.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"My Profile"}),x.jsx("p",{className:"text-muted-foreground",children:"Manage your account settings and preferences"})]}),x.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 mt-8",children:[x.jsxs("div",{className:"lg:col-span-2",children:[x.jsxs($i,{children:[x.jsxs(dr,{children:[x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx(E1,{className:"h-5 w-5"}),x.jsx(Mr,{children:"Profile Details"}),!m&&x.jsxs(Si,{size:"sm",variant:"outline",className:"ml-auto",onClick:ee,children:[x.jsx(Py,{className:"h-4 w-4 mr-1"})," Edit"]})]}),x.jsx(Ha,{children:"View and edit your personal details"})]}),x.jsx(Hi,{children:m?x.jsxs("form",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",onSubmit:Ct=>{Ct.preventDefault(),Ie()},children:[x.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[x.jsx(En,{htmlFor:"name",children:"Name"}),x.jsx(tn,{id:"name",value:ce.name,onChange:Ct=>oe(mt=>({...mt,name:Ct.target.value}))})]}),x.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[x.jsx(En,{htmlFor:"email",children:"Email"}),x.jsx(tn,{id:"email",value:ce.email,onChange:Ct=>oe(mt=>({...mt,email:Ct.target.value}))})]}),x.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[x.jsx(En,{htmlFor:"phone",children:"Mobile Number"}),x.jsx(tn,{id:"phone",value:ce.phone,disabled:!0})]}),x.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[x.jsx(En,{htmlFor:"dob",children:"Date of Birth"}),x.jsx(tn,{id:"dob",type:"date",value:ce.dateOfBirth,onChange:Ct=>oe(mt=>({...mt,dateOfBirth:Ct.target.value}))})]}),x.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[x.jsx(En,{htmlFor:"anniv",children:"Anniversary"}),x.jsx(tn,{id:"anniv",type:"date",value:ce.anniversary,onChange:Ct=>oe(mt=>({...mt,anniversary:Ct.target.value}))})]}),x.jsxs("div",{className:"flex gap-4 col-span-1 md:col-span-2 mt-4",children:[x.jsxs(Si,{type:"submit",className:"text-sm",children:[x.jsx(Z_,{className:"h-4 w-4 mr-1"})," Save"]}),x.jsx(Si,{type:"button",variant:"outline",className:"text-sm",onClick:Q,children:"Cancel"})]})]}):x.jsxs("div",{children:[x.jsxs("div",{className:"flex justify-between items-center mb-2",children:[x.jsx("span",{className:"font-medium",children:"Name:"}),x.jsx("span",{children:G.name})]}),x.jsxs("div",{className:"flex justify-between items-center mb-2",children:[x.jsx("span",{className:"font-medium",children:"Email:"}),x.jsx("span",{children:G.email})]}),x.jsxs("div",{className:"flex justify-between items-center mb-2",children:[x.jsx("span",{className:"font-medium",children:"Mobile:"}),x.jsx("span",{children:G.phone})]}),x.jsxs("div",{className:"flex justify-between items-center mb-2",children:[x.jsx("span",{className:"font-medium",children:"Date of Birth:"}),x.jsx("span",{children:G.dateOfBirth})]}),x.jsxs("div",{className:"flex justify-between items-center mb-2",children:[x.jsx("span",{className:"font-medium",children:"Anniversary:"}),x.jsx("span",{children:G.anniversary})]})]})})]}),x.jsxs($i,{className:"mt-8",children:[x.jsxs(dr,{children:[x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx(cw,{className:"h-5 w-5"}),x.jsx(Mr,{children:"My Addresses"}),x.jsxs(Si,{size:"sm",variant:"outline",className:"ml-auto",onClick:pe,children:[x.jsx(bl,{className:"h-4 w-4 mr-1"})," Add New"]})]}),x.jsx(Ha,{children:"Manage your delivery addresses"})]}),x.jsx(Hi,{children:x.jsxs("div",{children:[B.map(Ct=>x.jsx("div",{className:"p-4 mb-4 border rounded-lg",children:x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{children:[x.jsx("div",{className:"font-semibold mb-1",children:Ct.type}),x.jsx("div",{className:"text-sm text-muted-foreground mb-2",children:Ct.address}),Ct.isDefault&&x.jsx(es,{variant:"default",className:"mt-2",children:"Default"})]}),x.jsxs("div",{className:"flex gap-2",children:[x.jsx(Si,{size:"sm",variant:"outline",onClick:()=>Ke(Ct.id),children:x.jsx(Py,{className:"h-4 w-4"})}),x.jsx(Si,{size:"sm",variant:"outline",onClick:()=>Xt(Ct.id),children:x.jsx(Hy,{className:"h-4 w-4"})})]})]})},Ct.id)),E&&x.jsxs("div",{ref:j,className:"p-4 border-2 border-gray-300 rounded-lg bg-gray-50 mb-4",children:[x.jsx("h4",{className:"font-medium mb-4",children:s?"Edit Address":"Add New Address"}),x.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[x.jsxs("div",{className:"mb-2",children:[x.jsx(En,{htmlFor:"addressType",children:"Address Type"}),x.jsxs("select",{id:"addressType",className:"w-full p-2 border rounded",value:ue.type,onChange:Ct=>J(mt=>({...mt,type:Ct.target.value})),children:[x.jsx("option",{value:"HOME",children:"Home"}),x.jsx("option",{value:"WORK",children:"Work"}),x.jsx("option",{value:"OTHER",children:"Other"})]})]}),x.jsxs("div",{className:"mb-2",children:[x.jsx(En,{htmlFor:"line1",children:"Address Line 1 *"}),x.jsx(tn,{id:"line1",placeholder:"Street address, apartment, suite, unit, building, floor, etc.",value:ue.line1,onChange:Ct=>J(mt=>({...mt,line1:Ct.target.value}))})]}),x.jsxs("div",{className:"mb-2",children:[x.jsx(En,{htmlFor:"line2",children:"Address Line 2"}),x.jsx(tn,{id:"line2",placeholder:"Landmark, nearby location (optional)",value:ue.line2,onChange:Ct=>J(mt=>({...mt,line2:Ct.target.value}))})]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[x.jsxs("div",{className:"mb-2",children:[x.jsx(En,{htmlFor:"city",children:"City *"}),x.jsx(tn,{id:"city",placeholder:"City",value:ue.city,onChange:Ct=>J(mt=>({...mt,city:Ct.target.value}))})]}),x.jsxs("div",{className:"mb-2",children:[x.jsx(En,{htmlFor:"state",children:"State *"}),x.jsx(tn,{id:"state",placeholder:"State",value:ue.state,onChange:Ct=>J(mt=>({...mt,state:Ct.target.value}))})]}),x.jsxs("div",{className:"mb-2",children:[x.jsx(En,{htmlFor:"pincode",children:"Pincode *"}),x.jsx(tn,{id:"pincode",placeholder:"Pincode",value:ue.pincode,onChange:Ct=>J(mt=>({...mt,pincode:Ct.target.value}))})]})]}),x.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[x.jsx("input",{type:"checkbox",id:"isDefault",checked:ue.isDefault,onChange:Ct=>J(mt=>({...mt,isDefault:Ct.target.checked})),className:"rounded"}),x.jsx(En,{htmlFor:"isDefault",className:"text-sm",children:"Set as default address"})]}),x.jsxs("div",{className:"flex gap-4 pt-4",children:[x.jsx(Si,{onClick:et,className:"flex-1",children:s?"Update Address":"Save Address"}),x.jsx(Si,{variant:"outline",onClick:at,className:"flex-1",children:"Cancel"})]})]})]})]})})]}),x.jsxs($i,{className:"mt-8",children:[x.jsxs(dr,{children:[x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx(nC,{className:"h-5 w-5"}),x.jsx(Mr,{children:"Notification Preferences"})]}),x.jsx(Ha,{children:"Choose how you want to receive updates about your orders"})]}),x.jsx(Hi,{children:x.jsxs("div",{children:[x.jsxs("div",{className:"flex items-center justify-between mb-4",children:[x.jsxs("div",{children:[x.jsx(En,{htmlFor:"orderNotifs",children:"Order Notifications"}),x.jsx("p",{className:"text-sm text-muted-foreground",children:"Get notified about order status updates"})]}),x.jsx("input",{id:"orderNotifs",type:"checkbox",defaultChecked:!0,className:"toggle"})]}),x.jsx(ac,{className:"my-2"}),x.jsxs("div",{className:"flex items-center justify-between mb-4",children:[x.jsxs("div",{children:[x.jsx(En,{htmlFor:"promoEmails",children:"Promotional Emails"}),x.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive offers and deals via email"})]}),x.jsx("input",{id:"promoEmails",type:"checkbox",className:"toggle"})]}),x.jsx(ac,{className:"my-2"}),x.jsxs("div",{className:"flex items-center justify-between mb-4",children:[x.jsxs("div",{children:[x.jsx(En,{htmlFor:"smsNotifs",children:"SMS Notifications"}),x.jsx("p",{className:"text-sm text-muted-foreground",children:"Get order updates via SMS"})]}),x.jsx("input",{id:"smsNotifs",type:"checkbox",defaultChecked:!0,className:"toggle"})]})]})})]})]}),x.jsx("div",{className:"lg:order-last order-first",children:x.jsxs($i,{children:[x.jsx(dr,{children:x.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[x.jsx(Mr,{className:"text-lg",children:"Account Summary"}),x.jsx(Si,{variant:"outline",size:"sm",className:"text-destructive hover:text-destructive",onClick:o,children:"Logout"})]})}),x.jsxs(Hi,{children:[x.jsxs("div",{className:"text-center",children:[x.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4",children:x.jsx(E1,{className:"h-8 w-8 text-primary"})}),x.jsxs("div",{children:[x.jsx("h3",{className:"font-semibold",children:G.name}),x.jsx("p",{className:"text-sm text-muted-foreground",children:G.phone})]})]}),x.jsx(ac,{className:"my-4"}),x.jsxs("div",{children:[x.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[x.jsx("span",{className:"text-muted-foreground",children:"Member Since"}),x.jsx("span",{children:"Jan 2024"})]}),x.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[x.jsx("span",{className:"text-muted-foreground",children:"Total Orders"}),x.jsx("span",{children:"12"})]}),x.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[x.jsx("span",{className:"text-muted-foreground",children:"Total Savings"}),x.jsx("span",{className:"text-primary font-medium",children:"₹2,450"})]})]})]})]})})]})]})},sK=()=>{const i=Nd();return V.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",i.pathname)},[i.pathname]),x.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:x.jsxs("div",{className:"text-center",children:[x.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),x.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),x.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})},mk=({onSuccess:i})=>{const[o,c]=V.useState("login"),[m,v]=V.useState(""),[E,I]=V.useState(""),[s,O]=V.useState(""),[j,G]=V.useState(""),[W,B]=V.useState(!1),{login:te,register:ue}=Ld(),{toast:J}=ha(),ce=()=>{if(!m||m.length!==10)return J({title:"Invalid Mobile Number",description:"Please enter a valid 10-digit mobile number",variant:"destructive"}),!1;if(!E)return J({title:"Password Required",description:"Please enter your password",variant:"destructive"}),!1;if(o==="register"){if(!j.trim())return J({title:"Name Required",description:"Please enter your name",variant:"destructive"}),!1;if(E!==s)return J({title:"Password Mismatch",description:"Passwords do not match",variant:"destructive"}),!1}return!0},oe=async()=>{if(ce()){B(!0);try{await te(m,E)?(J({title:"Login Successful",description:"Welcome back!"}),i()):J({title:"Login Failed",description:"Invalid mobile number or password. Try: 9876543210/customer123 or 9999999999/admin123",variant:"destructive"})}catch{J({title:"Error",description:"Login failed. Please try again.",variant:"destructive"})}B(!1)}},ee=async()=>{if(ce()){B(!0);try{await ue(m,j,E)?(J({title:"Registration Successful",description:"Welcome to Butcher Blend!"}),i()):J({title:"Registration Failed",description:"Please try again.",variant:"destructive"})}catch{J({title:"Error",description:"Registration failed. Please try again.",variant:"destructive"})}B(!1)}};return x.jsx("div",{className:"w-full max-w-md mx-auto min-h-screen flex items-center justify-center",children:x.jsxs($i,{children:[x.jsxs(dr,{className:"text-center",children:[x.jsx(Mr,{className:"text-2xl",children:o==="login"?"Welcome to Butcher Blend":"Create Account"}),x.jsx(Ha,{children:o==="login"?"Enter your credentials to continue":"Sign up for a new account"})]}),x.jsxs(Hi,{className:"space-y-4",children:[x.jsxs("div",{className:"space-y-2",children:[x.jsx(En,{htmlFor:"mobile",children:"Mobile Number"}),x.jsxs("div",{className:"relative",children:[x.jsx(uw,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),x.jsx(tn,{id:"mobile",type:"tel",placeholder:"Enter 10-digit mobile number",className:"pl-10",value:m,onChange:Q=>v(Q.target.value.replace(/\D/g,"").slice(0,10)),disabled:W})]})]}),o==="register"&&x.jsxs("div",{className:"space-y-2",children:[x.jsx(En,{htmlFor:"name",children:"Full Name"}),x.jsxs("div",{className:"relative",children:[x.jsx(E1,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),x.jsx(tn,{id:"name",type:"text",placeholder:"Enter your full name",className:"pl-10",value:j,onChange:Q=>G(Q.target.value),disabled:W})]})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx(En,{htmlFor:"password",children:"Password"}),x.jsxs("div",{className:"relative",children:[x.jsx(S1,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),x.jsx(tn,{id:"password",type:"password",placeholder:o==="login"?"Enter your password":"Create a password",className:"pl-10",value:E,onChange:Q=>I(Q.target.value),disabled:W})]})]}),o==="register"&&x.jsxs("div",{className:"space-y-2",children:[x.jsx(En,{htmlFor:"confirmPassword",children:"Confirm Password"}),x.jsxs("div",{className:"relative",children:[x.jsx(S1,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),x.jsx(tn,{id:"confirmPassword",type:"password",placeholder:"Confirm your password",className:"pl-10",value:s,onChange:Q=>O(Q.target.value),disabled:W})]})]}),o==="login"&&x.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg text-sm text-blue-800",children:[x.jsx("p",{className:"font-medium mb-1",children:"Demo Accounts:"}),x.jsx("p",{children:"Customer: 9876543210 / customer123"}),x.jsx("p",{children:"Admin: 9999999999 / admin123"})]}),x.jsx(Si,{onClick:o==="login"?oe:ee,disabled:W,className:"w-full",size:"lg",children:W?"Processing...":o==="login"?"Login":"Create Account"}),x.jsx("div",{className:"text-center",children:x.jsx(Si,{variant:"link",onClick:()=>c(o==="login"?"register":"login"),disabled:W,children:o==="login"?"Don't have an account? Sign up":"Already have an account? Login"})})]})]})})},oK=({onSuccess:i})=>{const o=iw(),[c,m]=V.useState(""),[v,E]=V.useState(""),[I,s]=V.useState(""),[O,j]=V.useState(""),[G,W]=V.useState(!1),{register:B}=Ld(),{toast:te}=ha(),ue=async()=>{if(!c||c.length!==10){te({title:"Invalid Mobile Number",description:"Please enter a valid 10-digit mobile number",variant:"destructive"});return}if(!v.trim()){te({title:"Name Required",description:"Please enter your name",variant:"destructive"});return}if(!I){te({title:"Password Required",description:"Please create a password",variant:"destructive"});return}if(I!==O){te({title:"Passwords Don't Match",description:"Please make sure your passwords match",variant:"destructive"});return}W(!0);try{await B(c,v,I)?(te({title:"Registration Successful",description:"Your account has been created successfully!"}),i?i():o("/")):te({title:"Registration Failed",description:"There was an error creating your account. Please try again.",variant:"destructive"})}catch{te({title:"Error",description:"Registration failed. Please try again later.",variant:"destructive"})}W(!1)};return x.jsxs($i,{className:"w-full max-w-md mx-auto min-h-screen flex items-center justify-center",children:[x.jsxs(dr,{children:[x.jsx(Mr,{children:"Create an Account"}),x.jsx(Ha,{children:"Sign up for Butcher Blend"})]}),x.jsxs(Hi,{className:"space-y-4",children:[x.jsxs("div",{className:"space-y-2",children:[x.jsx(En,{htmlFor:"mobile",children:"Mobile Number"}),x.jsxs("div",{className:"relative",children:[x.jsx(uw,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),x.jsx(tn,{id:"mobile",type:"tel",placeholder:"Enter 10-digit mobile number",className:"pl-10",value:c,onChange:J=>m(J.target.value.replace(/\D/g,"").slice(0,10)),disabled:G})]})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx(En,{htmlFor:"name",children:"Full Name"}),x.jsxs("div",{className:"relative",children:[x.jsx(E1,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),x.jsx(tn,{id:"name",type:"text",placeholder:"Enter your full name",className:"pl-10",value:v,onChange:J=>E(J.target.value),disabled:G})]})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx(En,{htmlFor:"password",children:"Password"}),x.jsxs("div",{className:"relative",children:[x.jsx(S1,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),x.jsx(tn,{id:"password",type:"password",placeholder:"Create a password",className:"pl-10",value:I,onChange:J=>s(J.target.value),disabled:G})]})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx(En,{htmlFor:"confirmPassword",children:"Confirm Password"}),x.jsxs("div",{className:"relative",children:[x.jsx(S1,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),x.jsx(tn,{id:"confirmPassword",type:"password",placeholder:"Confirm your password",className:"pl-10",value:O,onChange:J=>j(J.target.value),disabled:G})]})]}),x.jsx(Si,{onClick:ue,disabled:G,className:"w-full",size:"lg",children:G?"Creating Account...":"Register"}),x.jsx("div",{className:"flex justify-center",children:x.jsx(Ho,{to:"/login",className:"text-sm text-blue-600 hover:underline",children:"Already have an account? Login here"})})]})]})},aK=new m9,lK=Vt.lazy(()=>q8(()=>import("./LoyaltyRewards-COLmuONX.js"),[])),cK=()=>{const{isAdmin:i,loading:o}=Ld();return o?x.jsx("div",{className:"min-h-screen flex items-center justify-center",children:"Loading..."}):x.jsxs(k8,{children:[i?x.jsxs(x.Fragment,{children:[x.jsxs(fs,{path:"/admin",element:x.jsx(iW,{}),children:[x.jsx(fs,{index:!0,element:x.jsx(MW,{})}),x.jsx(fs,{path:"meats",element:x.jsx(bX,{})}),x.jsx(fs,{path:"categories",element:x.jsx(SX,{})}),x.jsx(fs,{path:"offers",element:x.jsx(JX,{})}),x.jsx(fs,{path:"orders",element:x.jsx(eK,{})}),x.jsx(fs,{path:"loyalty-rewards",element:x.jsx(Vt.Suspense,{fallback:x.jsx("div",{children:"Loading..."}),children:x.jsx(lK,{})})}),x.jsx(fs,{path:"settings",element:x.jsx(tK,{})})]}),x.jsx(fs,{path:"/",element:x.jsx(oD,{to:"/admin",replace:!0})})]}):x.jsxs(x.Fragment,{children:[x.jsx(fs,{path:"/auth",element:x.jsx(mk,{onSuccess:()=>window.location.replace("/")})}),x.jsx(fs,{path:"/login",element:x.jsx(mk,{onSuccess:()=>window.location.replace("/")})}),x.jsx(fs,{path:"/register",element:x.jsx(oK,{onSuccess:()=>window.location.replace("/login")})}),x.jsxs(fs,{path:"/",element:x.jsx(Rq,{}),children:[x.jsx(fs,{index:!0,element:x.jsx(wW,{})}),x.jsx(fs,{path:"cart",element:x.jsx(CW,{})}),x.jsx(fs,{path:"orders",element:x.jsx(nK,{})}),x.jsx(fs,{path:"profile",element:x.jsx(rK,{})}),x.jsx(fs,{path:"category/:id",element:x.jsx("div",{children:"Category Page"})}),x.jsx(fs,{path:"product/:id",element:x.jsx(EW,{})})]}),x.jsx(fs,{path:"/admin/*",element:x.jsx(oD,{to:"/",replace:!0})})]}),x.jsx(fs,{path:"*",element:x.jsx(sK,{})})]})},uK=()=>x.jsx(_9,{client:aK,children:x.jsxs(c3,{children:[x.jsx(G$,{}),x.jsx(yH,{}),x.jsx(y9,{children:x.jsx(x9,{children:x.jsx(cK,{})})})]})}),dK=FL(document.getElementById("root"));dK.render(x.jsx(B8,{children:x.jsx(uK,{})}));export{$i as C,tn as I,dr as a,Mr as b,Ha as c,Hi as d,x as j,V as r};
